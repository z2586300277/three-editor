const __vite__fileDeps=["assets/scene-wnN8WF_W.js","assets/index-1WxgUDhr.js","assets/index-CdmrMRTt.css","assets/scene-DagzqBN8.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as Ks,s as zg,r as Mt,o as Xe,c as lt,F as Wi,a as gr,b as Ie,d as gt,t as Qi,e as Ue,u as xt,w as He,E as Gr,f as jd,p as Wd,g as Xd,h as qd,i as ds,j as Vg,v as dx,n as Xw,k as vf,l as Fo,m as qw,T as px,q as _f,x as Ch,y as Yw,z as Zw,A as Kw,B as vv}from"./index-1WxgUDhr.js";const yf=localStorage.getItem("dev_local_server_url"),Qw=yf||"https://z2586300277.github.io/three-editor/dist/files/";function Jw(i){function e(s){const n=new DOMParser().parseFromString(s,"text/html");return Array.from(n.querySelectorAll("a")).map(l=>l.textContent).filter(l=>l!=="../"&&l.endsWith("/")).map(l=>l.slice(0,-1))}function t(s){const a=/<a href="([^"]+)">([^<]+)<\/a>\s+(\d{2}-[A-Za-z]{3}-\d{4} \d{2}:\d{2})\s+(\d+)/g,n=[];let o;for(;(o=a.exec(s))!==null;)n.push(o[2]);return n}const r=new XMLHttpRequest;return r.open("GET",i),r.send(),new Promise((s,a)=>r.onload=()=>{r.status===200?i.indexOf("scene")!==-1?s(e(r.responseText)):s(t(r.responseText)):s([])})}const yl=i=>yf?Jw(i):fetch(i+"index.json").then(e=>e.json()),_v={skyUrl:"scene/",buildUrl:"resource/",editorJsonUrl:"editorJson/",fontUrl:"font/",channelUrl:"channels/",iconUrl:"icon/",videoUrl:"video/"},ni=Object.keys(_v).reduce((i,e)=>(i[e]=Qw+_v[e],i),{}),$w={class:"skyList"},eS={class:"item"},tS={class:"title"},iS={class:"flex"},rS={class:"resource"},sS=["src"],aS={__name:"sky",props:["emitEditor"],setup(i){const e=i,t=a=>e.emitEditor.threeEditor.scene.setSceneBackground([0,1,2,3,4,5].map(n=>ni.skyUrl+a+"/"+(n+1)+".png")),r=a=>{const{scene:n}=e.emitEditor.threeEditor;n.setEnvBackground([0,1,2,3,4,5].map(o=>ni.skyUrl+a+"/"+(o+1)+".png")),n.environmentEnabled=!0,n.environment=n.envBackground},s=zg({list:[]});return yl(ni.skyUrl).then(a=>s.list=a),(a,n)=>{const o=Mt("el-button");return Xe(),lt("div",$w,[(Xe(!0),lt(Wi,null,gr(xt(s).list,l=>(Xe(),lt("div",eS,[Ie("div",tS,[gt(Qi(l)+" ",1),Ie("div",iS,[Ue(o,{onClick:c=>t(l),icon:"CircleCheckFilled",style:{height:"30px",width:"30px"},title:"设为天空"},null,8,["onClick"]),Ue(o,{onClick:c=>r(l),icon:"StarFilled",style:{height:"30px",width:"30px"},title:"设置为环境"},null,8,["onClick"])])]),Ie("div",rS,[(Xe(),lt(Wi,null,gr(6,(c,h)=>Ie("div",null,[Ie("img",{class:"img",src:xt(ni).skyUrl+l+"/"+(h+1)+".png",alt:""},null,8,sS)])),64))])]))),256))])}}},nS=Ks(aS,[["__scopeId","data-v-e8a0bf13"]]);var oS=Object.defineProperty,lS=Object.defineProperties,cS=Object.getOwnPropertyDescriptors,yv=Object.getOwnPropertySymbols,hS=Object.prototype.hasOwnProperty,uS=Object.prototype.propertyIsEnumerable,dS=Math.pow,xf=(i,e,t)=>e in i?oS(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ne=(i,e)=>{for(var t in e||(e={}))hS.call(e,t)&&xf(i,t,e[t]);if(yv)for(var t of yv(e))uS.call(e,t)&&xf(i,t,e[t]);return i},yi=(i,e)=>lS(i,cS(e)),xv=(i,e,t)=>(xf(i,typeof e!="symbol"?e+"":e,t),t),Wr=(i,e,t)=>new Promise((r,s)=>{var a=l=>{try{o(t.next(l))}catch(c){s(c)}},n=l=>{try{o(t.throw(l))}catch(c){s(c)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(a,n);o((t=t.apply(i,e)).next())});const pd="165",mn={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},fn={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Yd=1,Hg=2,Vr=3,Ir=0,Di=1,It=2,js=2,Ko=5,ur=100,pS=101,mS=102,Qo=200,nh=201,Zd=202,Kd=203,Pa=204,Ia=205,oh=206,Qd=207,lh=208,Jd=209,fS=210,gS=211,vS=212,_S=213,yS=214,ch=0,mx=1,fx=2,ms=0,$d=1,ep=2,tp=3,ip=4,Gg=5,rp=6,jg=7,bf="attached",gx="detached",sp=300,Ws=301,La=302,Jo=303,Ac=304,xl=306,$t=1e3,Ai=1001,Na=1002,dt=1003,ap=1004,Tn=1005,Kt=1006,Bo=1007,fs=1008,zn=1009,$o=1012,Wg=1013,Vn=1014,mr=1015,Qt=1016,Xg=1017,qg=1018,Da=1020,Pr=1023,el=1026,Oa=1027,Yg=1028,Zg=1029,Kg=1031,Qg=1033,Ku=33776,Qu=33777,Ju=33778,$u=33779,Mf=35840,wf=35841,Sf=35842,Tf=35843,Af=36196,Ef=37492,Cf=37496,Rf=37808,Pf=37809,If=37810,Lf=37811,Nf=37812,Df=37813,Of=37814,Uf=37815,kf=37816,Ff=37817,Bf=37818,zf=37819,Vf=37820,Hf=37821,ed=36492,Gf=36494,jf=36495,Wf=36284,Xf=36285,qf=36286,Jg=2200,$g=2201,tl=2300,il=2301,td=2302,An=2400,En=2401,Ec=2402,vx=2500,e0=2501,t0=3201,xn="",Tt="srgb",oi="srgb-linear",np="display-p3",hh="display-p3-linear",Cc="linear",St="srgb",Rc="rec709",Pc="p3",gn=7680,xS=512,bS=513,MS=514,wS=515,SS=516,TS=517,AS=518,ES=519,Ic=35044,Yf="300 es",Hn=2e3,Lc=2001;class ys{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const r=t.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}}const Ci=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let bv=1234567;const Pn=Math.PI/180,rl=180/Math.PI;function vr(){const i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Ci[255&i]+Ci[i>>8&255]+Ci[i>>16&255]+Ci[i>>24&255]+"-"+Ci[255&e]+Ci[e>>8&255]+"-"+Ci[e>>16&15|64]+Ci[e>>24&255]+"-"+Ci[63&t|128]+Ci[t>>8&255]+"-"+Ci[t>>16&255]+Ci[t>>24&255]+Ci[255&r]+Ci[r>>8&255]+Ci[r>>16&255]+Ci[r>>24&255]).toLowerCase()}function Vt(i,e,t){return Math.max(e,Math.min(t,i))}function Zf(i,e){return(i%e+e)%e}function dc(i,e,t){return(1-t)*i+t*e}function Gi(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Ge(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(4294967295*i);case Uint16Array:return Math.round(65535*i);case Uint8Array:return Math.round(255*i);case Int32Array:return Math.round(2147483647*i);case Int16Array:return Math.round(32767*i);case Int8Array:return Math.round(127*i);default:throw new Error("Invalid component type.")}}const ui={DEG2RAD:Pn,RAD2DEG:rl,generateUUID:vr,clamp:Vt,euclideanModulo:Zf,mapLinear:function(i,e,t,r,s){return r+(i-e)*(s-r)/(t-e)},inverseLerp:function(i,e,t){return i!==e?(t-i)/(e-i):0},lerp:dc,damp:function(i,e,t,r){return dc(i,e,1-Math.exp(-t*r))},pingpong:function(i,e=1){return e-Math.abs(Zf(i,2*e)-e)},smoothstep:function(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e))*i*(3-2*i)},smootherstep:function(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e))*i*i*(i*(6*i-15)+10)},randInt:function(i,e){return i+Math.floor(Math.random()*(e-i+1))},randFloat:function(i,e){return i+Math.random()*(e-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){i!==void 0&&(bv=i);let e=bv+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(i){return i*Pn},radToDeg:function(i){return i*rl},isPowerOfTwo:function(i){return!(i&i-1)&&i!==0},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,e,t,r,s){const a=Math.cos,n=Math.sin,o=a(t/2),l=n(t/2),c=a((e+r)/2),h=n((e+r)/2),u=a((e-r)/2),d=n((e-r)/2),p=a((r-e)/2),f=n((r-e)/2);switch(s){case"XYX":i.set(o*h,l*u,l*d,o*c);break;case"YZY":i.set(l*d,o*h,l*u,o*c);break;case"ZXZ":i.set(l*u,l*d,o*h,o*c);break;case"XZX":i.set(o*h,l*f,l*p,o*c);break;case"YXY":i.set(l*p,o*h,l*f,o*c);break;case"ZYZ":i.set(l*f,l*p,o*h,o*c)}},normalize:Ge,denormalize:Gi};class ne{constructor(e=0,t=0){ne.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6],this.y=s[1]*t+s[4]*r+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Vt(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),s=Math.sin(t),a=this.x-e.x,n=this.y-e.y;return this.x=a*r-n*s+e.x,this.y=a*s+n*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ve{constructor(e,t,r,s,a,n,o,l,c){Ve.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,s,a,n,o,l,c)}set(e,t,r,s,a,n,o,l,c){const h=this.elements;return h[0]=e,h[1]=s,h[2]=o,h[3]=t,h[4]=a,h[5]=l,h[6]=r,h[7]=n,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,s=t.elements,a=this.elements,n=r[0],o=r[3],l=r[6],c=r[1],h=r[4],u=r[7],d=r[2],p=r[5],f=r[8],g=s[0],m=s[3],v=s[6],_=s[1],y=s[4],x=s[7],b=s[2],M=s[5],T=s[8];return a[0]=n*g+o*_+l*b,a[3]=n*m+o*y+l*M,a[6]=n*v+o*x+l*T,a[1]=c*g+h*_+u*b,a[4]=c*m+h*y+u*M,a[7]=c*v+h*x+u*T,a[2]=d*g+p*_+f*b,a[5]=d*m+p*y+f*M,a[8]=d*v+p*x+f*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],c=e[7],h=e[8];return t*n*h-t*o*c-r*a*h+r*o*l+s*a*c-s*n*l}invert(){const e=this.elements,t=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=h*n-o*c,d=o*l-h*a,p=c*a-n*l,f=t*u+r*d+s*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/f;return e[0]=u*g,e[1]=(s*c-h*r)*g,e[2]=(o*r-s*n)*g,e[3]=d*g,e[4]=(h*t-s*l)*g,e[5]=(s*a-o*t)*g,e[6]=p*g,e[7]=(r*l-c*t)*g,e[8]=(n*t-r*a)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,s,a,n,o){const l=Math.cos(a),c=Math.sin(a);return this.set(r*l,r*c,-r*(l*n+c*o)+n+e,-s*c,s*l,-s*(-c*n+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Fp.makeScale(e,t)),this}rotate(e){return this.premultiply(Fp.makeRotation(-e)),this}translate(e,t){return this.premultiply(Fp.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let s=0;s<9;s++)if(t[s]!==r[s])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Fp=new Ve;function _x(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const CS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Co(i,e){return new CS[i](e)}function Nc(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function yx(){const i=Nc("canvas");return i.style.display="block",i}const Mv={};function i0(i){i in Mv||(Mv[i]=!0)}const wv=new Ve().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Sv=new Ve().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Rh={[oi]:{transfer:Cc,primaries:Rc,toReference:i=>i,fromReference:i=>i},[Tt]:{transfer:St,primaries:Rc,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[hh]:{transfer:Cc,primaries:Pc,toReference:i=>i.applyMatrix3(Sv),fromReference:i=>i.applyMatrix3(wv)},[np]:{transfer:St,primaries:Pc,toReference:i=>i.convertSRGBToLinear().applyMatrix3(Sv),fromReference:i=>i.applyMatrix3(wv).convertLinearToSRGB()}},RS=new Set([oi,hh]),ht={enabled:!0,_workingColorSpace:oi,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!RS.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const r=Rh[e].toReference;return(0,Rh[t].fromReference)(r(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this._workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this._workingColorSpace)},getPrimaries:function(i){return Rh[i].primaries},getTransfer:function(i){return i===xn?Cc:Rh[i].transfer}};function zo(i){return i<.04045?.0773993808*i:Math.pow(.9478672986*i+.0521327014,2.4)}function Bp(i){return i<.0031308?12.92*i:1.055*Math.pow(i,.41666)-.055}let $n;class xx{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{$n===void 0&&($n=Nc("canvas")),$n.width=e.width,$n.height=e.height;const r=$n.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=$n}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Nc("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height),a=s.data;for(let n=0;n<a.length;n++)a[n]=255*zo(a[n]/255);return r.putImageData(s,0,0),t}if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(255*zo(t[r]/255)):t[r]=zo(t[r]);return{data:t,width:e.width,height:e.height}}return e}}let PS=0;class bn{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:PS++}),this.uuid=vr(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},s=this.data;if(s!==null){let a;if(Array.isArray(s)){a=[];for(let n=0,o=s.length;n<o;n++)s[n].isDataTexture?a.push(zp(s[n].image)):a.push(zp(s[n]))}else a=zp(s);r.url=a}return t||(e.images[this.uuid]=r),r}}function zp(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?xx.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:{}}let IS=0;class wt extends ys{constructor(e=wt.DEFAULT_IMAGE,t=wt.DEFAULT_MAPPING,r=Ai,s=Ai,a=1006,n=1008,o=1023,l=1009,c=wt.DEFAULT_ANISOTROPY,h=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:IS++}),this.uuid=vr(),this.name="",this.source=new bn(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=a,this.minFilter=n,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new ne(0,0),this.repeat=new ne(1,1),this.center=new ne(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ve,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==sp)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case $t:e.x=e.x-Math.floor(e.x);break;case Ai:e.x=e.x<0?0:1;break;case Na:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case $t:e.y=e.y-Math.floor(e.y);break;case Ai:e.y=e.y<0?0:1;break;case Na:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}wt.DEFAULT_IMAGE=null,wt.DEFAULT_MAPPING=sp,wt.DEFAULT_ANISOTROPY=1;class qe{constructor(e=0,t=0,r=0,s=1){qe.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,s){return this.x=e,this.y=t,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,s=this.z,a=this.w,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*s+n[12]*a,this.y=n[1]*t+n[5]*r+n[9]*s+n[13]*a,this.z=n[2]*t+n[6]*r+n[10]*s+n[14]*a,this.w=n[3]*t+n[7]*r+n[11]*s+n[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,s,a;const n=e.elements,o=n[0],l=n[4],c=n[8],h=n[1],u=n[5],d=n[9],p=n[2],f=n[6],g=n[10];if(Math.abs(l-h)<.01&&Math.abs(c-p)<.01&&Math.abs(d-f)<.01){if(Math.abs(l+h)<.1&&Math.abs(c+p)<.1&&Math.abs(d+f)<.1&&Math.abs(o+u+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const v=(o+1)/2,_=(u+1)/2,y=(g+1)/2,x=(l+h)/4,b=(c+p)/4,M=(d+f)/4;return v>_&&v>y?v<.01?(r=0,s=.707106781,a=.707106781):(r=Math.sqrt(v),s=x/r,a=b/r):_>y?_<.01?(r=.707106781,s=0,a=.707106781):(s=Math.sqrt(_),r=x/s,a=M/s):y<.01?(r=.707106781,s=.707106781,a=0):(a=Math.sqrt(y),r=b/a,s=M/a),this.set(r,s,a,t),this}let m=Math.sqrt((f-d)*(f-d)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(m)<.001&&(m=1),this.x=(f-d)/m,this.y=(c-p)/m,this.z=(h-l)/m,this.w=Math.acos((o+u+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class bx extends ys{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new qe(0,0,e,t),this.scissorTest=!1,this.viewport=new qe(0,0,e,t);const s={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Kt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const a=new wt(s,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);a.flipY=!1,a.generateMipmaps=r.generateMipmaps,a.internalFormat=r.internalFormat,this.textures=[];const n=r.count;for(let o=0;o<n;o++)this.textures[o]=a.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let s=0,a=this.textures.length;s<a;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,s=e.textures.length;r<s;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new bn(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ft extends bx{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class md extends wt{constructor(e=null,t=1,r=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:s},this.magFilter=dt,this.minFilter=dt,this.wrapR=Ai,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Kf extends wt{constructor(e=null,t=1,r=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:s},this.magFilter=dt,this.minFilter=dt,this.wrapR=Ai,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class it{constructor(e=0,t=0,r=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=s}static slerpFlat(e,t,r,s,a,n,o){let l=r[s+0],c=r[s+1],h=r[s+2],u=r[s+3];const d=a[n+0],p=a[n+1],f=a[n+2],g=a[n+3];if(o===0)return e[t+0]=l,e[t+1]=c,e[t+2]=h,void(e[t+3]=u);if(o===1)return e[t+0]=d,e[t+1]=p,e[t+2]=f,void(e[t+3]=g);if(u!==g||l!==d||c!==p||h!==f){let m=1-o;const v=l*d+c*p+h*f+u*g,_=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){const b=Math.sqrt(y),M=Math.atan2(b,v*_);m=Math.sin(m*M)/b,o=Math.sin(o*M)/b}const x=o*_;if(l=l*m+d*x,c=c*m+p*x,h=h*m+f*x,u=u*m+g*x,m===1-o){const b=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=b,c*=b,h*=b,u*=b}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,r,s,a,n){const o=r[s],l=r[s+1],c=r[s+2],h=r[s+3],u=a[n],d=a[n+1],p=a[n+2],f=a[n+3];return e[t]=o*f+h*u+l*p-c*d,e[t+1]=l*f+h*d+c*u-o*p,e[t+2]=c*f+h*p+o*d-l*u,e[t+3]=h*f-o*u-l*d-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,s){return this._x=e,this._y=t,this._z=r,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,s=e._y,a=e._z,n=e._order,o=Math.cos,l=Math.sin,c=o(r/2),h=o(s/2),u=o(a/2),d=l(r/2),p=l(s/2),f=l(a/2);switch(n){case"XYZ":this._x=d*h*u+c*p*f,this._y=c*p*u-d*h*f,this._z=c*h*f+d*p*u,this._w=c*h*u-d*p*f;break;case"YXZ":this._x=d*h*u+c*p*f,this._y=c*p*u-d*h*f,this._z=c*h*f-d*p*u,this._w=c*h*u+d*p*f;break;case"ZXY":this._x=d*h*u-c*p*f,this._y=c*p*u+d*h*f,this._z=c*h*f+d*p*u,this._w=c*h*u-d*p*f;break;case"ZYX":this._x=d*h*u-c*p*f,this._y=c*p*u+d*h*f,this._z=c*h*f-d*p*u,this._w=c*h*u+d*p*f;break;case"YZX":this._x=d*h*u+c*p*f,this._y=c*p*u+d*h*f,this._z=c*h*f-d*p*u,this._w=c*h*u-d*p*f;break;case"XZY":this._x=d*h*u-c*p*f,this._y=c*p*u-d*h*f,this._z=c*h*f+d*p*u,this._w=c*h*u+d*p*f}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],s=t[4],a=t[8],n=t[1],o=t[5],l=t[9],c=t[2],h=t[6],u=t[10],d=r+o+u;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(h-l)*p,this._y=(a-c)*p,this._z=(n-s)*p}else if(r>o&&r>u){const p=2*Math.sqrt(1+r-o-u);this._w=(h-l)/p,this._x=.25*p,this._y=(s+n)/p,this._z=(a+c)/p}else if(o>u){const p=2*Math.sqrt(1+o-r-u);this._w=(a-c)/p,this._x=(s+n)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+u-r-o);this._w=(n-s)/p,this._x=(a+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Vt(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const s=Math.min(1,t/r);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,s=e._y,a=e._z,n=e._w,o=t._x,l=t._y,c=t._z,h=t._w;return this._x=r*h+n*o+s*c-a*l,this._y=s*h+n*l+a*o-r*c,this._z=a*h+n*c+r*l-s*o,this._w=n*h-r*o-s*l-a*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,s=this._y,a=this._z,n=this._w;let o=n*e._w+r*e._x+s*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=n,this._x=r,this._y=s,this._z=a,this;const l=1-o*o;if(l<=Number.EPSILON){const p=1-t;return this._w=p*n+t*this._w,this._x=p*r+t*this._x,this._y=p*s+t*this._y,this._z=p*a+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,o),u=Math.sin((1-t)*h)/c,d=Math.sin(t*h)/c;return this._w=n*u+this._w*d,this._x=r*u+this._x*d,this._y=s*u+this._y*d,this._z=a*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),s=Math.sqrt(1-r),a=Math.sqrt(r);return this.set(s*Math.sin(e),s*Math.cos(e),a*Math.sin(t),a*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class R{constructor(e=0,t=0,r=0){R.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Tv.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Tv.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,s=this.z,a=e.elements;return this.x=a[0]*t+a[3]*r+a[6]*s,this.y=a[1]*t+a[4]*r+a[7]*s,this.z=a[2]*t+a[5]*r+a[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,s=this.z,a=e.elements,n=1/(a[3]*t+a[7]*r+a[11]*s+a[15]);return this.x=(a[0]*t+a[4]*r+a[8]*s+a[12])*n,this.y=(a[1]*t+a[5]*r+a[9]*s+a[13])*n,this.z=(a[2]*t+a[6]*r+a[10]*s+a[14])*n,this}applyQuaternion(e){const t=this.x,r=this.y,s=this.z,a=e.x,n=e.y,o=e.z,l=e.w,c=2*(n*s-o*r),h=2*(o*t-a*s),u=2*(a*r-n*t);return this.x=t+l*c+n*u-o*h,this.y=r+l*h+o*c-a*u,this.z=s+l*u+a*h-n*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,s=this.z,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*s,this.y=a[1]*t+a[5]*r+a[9]*s,this.z=a[2]*t+a[6]*r+a[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,s=e.y,a=e.z,n=t.x,o=t.y,l=t.z;return this.x=s*l-a*o,this.y=a*n-r*l,this.z=r*o-s*n,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Vp.copy(this).projectOnVector(e),this.sub(Vp)}reflect(e){return this.sub(Vp.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Vt(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,s=this.z-e.z;return t*t+r*r+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const s=Math.sin(t)*e;return this.x=s*Math.sin(r),this.y=Math.cos(t)*e,this.z=s*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Vp=new R,Tv=new it;class Et{constructor(e=new R(1/0,1/0,1/0),t=new R(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Ur.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Ur.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Ur.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const a=r.getAttribute("position");if(t===!0&&a!==void 0&&e.isInstancedMesh!==!0)for(let n=0,o=a.count;n<o;n++)e.isMesh===!0?e.getVertexPosition(n,Ur):Ur.fromBufferAttribute(a,n),Ur.applyMatrix4(e.matrixWorld),this.expandByPoint(Ur);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Ph.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Ph.copy(r.boundingBox)),Ph.applyMatrix4(e.matrixWorld),this.union(Ph)}const s=e.children;for(let a=0,n=s.length;a<n;a++)this.expandByObject(s[a],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ur),Ur.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(El),Ih.subVectors(this.max,El),eo.subVectors(e.a,El),to.subVectors(e.b,El),io.subVectors(e.c,El),ia.subVectors(to,eo),ra.subVectors(io,to),Za.subVectors(eo,io);let t=[0,-ia.z,ia.y,0,-ra.z,ra.y,0,-Za.z,Za.y,ia.z,0,-ia.x,ra.z,0,-ra.x,Za.z,0,-Za.x,-ia.y,ia.x,0,-ra.y,ra.x,0,-Za.y,Za.x,0];return!!Hp(t,eo,to,io,Ih)&&(t=[1,0,0,0,1,0,0,0,1],!!Hp(t,eo,to,io,Ih)&&(Lh.crossVectors(ia,ra),t=[Lh.x,Lh.y,Lh.z],Hp(t,eo,to,io,Ih)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ur).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Ur).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ts[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ts[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ts[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ts[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ts[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ts[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ts[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ts[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ts)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ts=[new R,new R,new R,new R,new R,new R,new R,new R],Ur=new R,Ph=new Et,eo=new R,to=new R,io=new R,ia=new R,ra=new R,Za=new R,El=new R,Ih=new R,Lh=new R,Ka=new R;function Hp(i,e,t,r,s){for(let a=0,n=i.length-3;a<=n;a+=3){Ka.fromArray(i,a);const o=s.x*Math.abs(Ka.x)+s.y*Math.abs(Ka.y)+s.z*Math.abs(Ka.z),l=e.dot(Ka),c=t.dot(Ka),h=r.dot(Ka);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>o)return!1}return!0}const LS=new Et,Cl=new R,Gp=new R;class di{constructor(e=new R,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):LS.setFromPoints(e).getCenter(r);let s=0;for(let a=0,n=e.length;a<n;a++)s=Math.max(s,r.distanceToSquared(e[a]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Cl.subVectors(e,this.center);const t=Cl.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),s=.5*(r-this.radius);this.center.addScaledVector(Cl,s/r),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Gp.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Cl.copy(e.center).add(Gp)),this.expandByPoint(Cl.copy(e.center).sub(Gp))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const As=new R,jp=new R,Nh=new R,sa=new R,Wp=new R,Dh=new R,Xp=new R;class Zn{constructor(e=new R,t=new R(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,As)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=As.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(As.copy(this.origin).addScaledVector(this.direction,t),As.distanceToSquared(e))}distanceSqToSegment(e,t,r,s){jp.copy(e).add(t).multiplyScalar(.5),Nh.copy(t).sub(e).normalize(),sa.copy(this.origin).sub(jp);const a=.5*e.distanceTo(t),n=-this.direction.dot(Nh),o=sa.dot(this.direction),l=-sa.dot(Nh),c=sa.lengthSq(),h=Math.abs(1-n*n);let u,d,p,f;if(h>0)if(u=n*l-o,d=n*o-l,f=a*h,u>=0)if(d>=-f)if(d<=f){const g=1/h;u*=g,d*=g,p=u*(u+n*d+2*o)+d*(n*u+d+2*l)+c}else d=a,u=Math.max(0,-(n*d+o)),p=-u*u+d*(d+2*l)+c;else d=-a,u=Math.max(0,-(n*d+o)),p=-u*u+d*(d+2*l)+c;else d<=-f?(u=Math.max(0,-(-n*a+o)),d=u>0?-a:Math.min(Math.max(-a,-l),a),p=-u*u+d*(d+2*l)+c):d<=f?(u=0,d=Math.min(Math.max(-a,-l),a),p=d*(d+2*l)+c):(u=Math.max(0,-(n*a+o)),d=u>0?a:Math.min(Math.max(-a,-l),a),p=-u*u+d*(d+2*l)+c);else d=n>0?-a:a,u=Math.max(0,-(n*d+o)),p=-u*u+d*(d+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,u),s&&s.copy(jp).addScaledVector(Nh,d),p}intersectSphere(e,t){As.subVectors(e.center,this.origin);const r=As.dot(this.direction),s=As.dot(As)-r*r,a=e.radius*e.radius;if(s>a)return null;const n=Math.sqrt(a-s),o=r-n,l=r+n;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0?!0:e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,s,a,n,o,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(r=(e.min.x-d.x)*c,s=(e.max.x-d.x)*c):(r=(e.max.x-d.x)*c,s=(e.min.x-d.x)*c),h>=0?(a=(e.min.y-d.y)*h,n=(e.max.y-d.y)*h):(a=(e.max.y-d.y)*h,n=(e.min.y-d.y)*h),r>n||a>s?null:((a>r||isNaN(r))&&(r=a),(n<s||isNaN(s))&&(s=n),u>=0?(o=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),r>l||o>s?null:((o>r||r!=r)&&(r=o),(l<s||s!=s)&&(s=l),s<0?null:this.at(r>=0?r:s,t)))}intersectsBox(e){return this.intersectBox(e,As)!==null}intersectTriangle(e,t,r,s,a){Wp.subVectors(t,e),Dh.subVectors(r,e),Xp.crossVectors(Wp,Dh);let n,o=this.direction.dot(Xp);if(o>0){if(s)return null;n=1}else{if(!(o<0))return null;n=-1,o=-o}sa.subVectors(this.origin,e);const l=n*this.direction.dot(Dh.crossVectors(sa,Dh));if(l<0)return null;const c=n*this.direction.dot(Wp.cross(sa));if(c<0||l+c>o)return null;const h=-n*sa.dot(Xp);return h<0?null:this.at(h/o,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Me{constructor(e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m){Me.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m)}set(e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m){const v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=s,v[1]=a,v[5]=n,v[9]=o,v[13]=l,v[2]=c,v[6]=h,v[10]=u,v[14]=d,v[3]=p,v[7]=f,v[11]=g,v[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Me().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,s=1/ro.setFromMatrixColumn(e,0).length(),a=1/ro.setFromMatrixColumn(e,1).length(),n=1/ro.setFromMatrixColumn(e,2).length();return t[0]=r[0]*s,t[1]=r[1]*s,t[2]=r[2]*s,t[3]=0,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=0,t[8]=r[8]*n,t[9]=r[9]*n,t[10]=r[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,s=e.y,a=e.z,n=Math.cos(r),o=Math.sin(r),l=Math.cos(s),c=Math.sin(s),h=Math.cos(a),u=Math.sin(a);if(e.order==="XYZ"){const d=n*h,p=n*u,f=o*h,g=o*u;t[0]=l*h,t[4]=-l*u,t[8]=c,t[1]=p+f*c,t[5]=d-g*c,t[9]=-o*l,t[2]=g-d*c,t[6]=f+p*c,t[10]=n*l}else if(e.order==="YXZ"){const d=l*h,p=l*u,f=c*h,g=c*u;t[0]=d+g*o,t[4]=f*o-p,t[8]=n*c,t[1]=n*u,t[5]=n*h,t[9]=-o,t[2]=p*o-f,t[6]=g+d*o,t[10]=n*l}else if(e.order==="ZXY"){const d=l*h,p=l*u,f=c*h,g=c*u;t[0]=d-g*o,t[4]=-n*u,t[8]=f+p*o,t[1]=p+f*o,t[5]=n*h,t[9]=g-d*o,t[2]=-n*c,t[6]=o,t[10]=n*l}else if(e.order==="ZYX"){const d=n*h,p=n*u,f=o*h,g=o*u;t[0]=l*h,t[4]=f*c-p,t[8]=d*c+g,t[1]=l*u,t[5]=g*c+d,t[9]=p*c-f,t[2]=-c,t[6]=o*l,t[10]=n*l}else if(e.order==="YZX"){const d=n*l,p=n*c,f=o*l,g=o*c;t[0]=l*h,t[4]=g-d*u,t[8]=f*u+p,t[1]=u,t[5]=n*h,t[9]=-o*h,t[2]=-c*h,t[6]=p*u+f,t[10]=d-g*u}else if(e.order==="XZY"){const d=n*l,p=n*c,f=o*l,g=o*c;t[0]=l*h,t[4]=-u,t[8]=c*h,t[1]=d*u+g,t[5]=n*h,t[9]=p*u-f,t[2]=f*u-p,t[6]=o*h,t[10]=g*u+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(NS,e,DS)}lookAt(e,t,r){const s=this.elements;return ar.subVectors(e,t),ar.lengthSq()===0&&(ar.z=1),ar.normalize(),aa.crossVectors(r,ar),aa.lengthSq()===0&&(Math.abs(r.z)===1?ar.x+=1e-4:ar.z+=1e-4,ar.normalize(),aa.crossVectors(r,ar)),aa.normalize(),Oh.crossVectors(ar,aa),s[0]=aa.x,s[4]=Oh.x,s[8]=ar.x,s[1]=aa.y,s[5]=Oh.y,s[9]=ar.y,s[2]=aa.z,s[6]=Oh.z,s[10]=ar.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,s=t.elements,a=this.elements,n=r[0],o=r[4],l=r[8],c=r[12],h=r[1],u=r[5],d=r[9],p=r[13],f=r[2],g=r[6],m=r[10],v=r[14],_=r[3],y=r[7],x=r[11],b=r[15],M=s[0],T=s[4],E=s[8],C=s[12],N=s[1],D=s[5],A=s[9],L=s[13],w=s[2],B=s[6],$=s[10],K=s[14],ae=s[3],se=s[7],me=s[11],H=s[15];return a[0]=n*M+o*N+l*w+c*ae,a[4]=n*T+o*D+l*B+c*se,a[8]=n*E+o*A+l*$+c*me,a[12]=n*C+o*L+l*K+c*H,a[1]=h*M+u*N+d*w+p*ae,a[5]=h*T+u*D+d*B+p*se,a[9]=h*E+u*A+d*$+p*me,a[13]=h*C+u*L+d*K+p*H,a[2]=f*M+g*N+m*w+v*ae,a[6]=f*T+g*D+m*B+v*se,a[10]=f*E+g*A+m*$+v*me,a[14]=f*C+g*L+m*K+v*H,a[3]=_*M+y*N+x*w+b*ae,a[7]=_*T+y*D+x*B+b*se,a[11]=_*E+y*A+x*$+b*me,a[15]=_*C+y*L+x*K+b*H,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],s=e[8],a=e[12],n=e[1],o=e[5],l=e[9],c=e[13],h=e[2],u=e[6],d=e[10],p=e[14];return e[3]*(+a*l*u-s*c*u-a*o*d+r*c*d+s*o*p-r*l*p)+e[7]*(+t*l*p-t*c*d+a*n*d-s*n*p+s*c*h-a*l*h)+e[11]*(+t*c*u-t*o*p-a*n*u+r*n*p+a*o*h-r*c*h)+e[15]*(-s*o*h-t*l*u+t*o*d+s*n*u-r*n*d+r*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],v=e[15],_=u*m*c-g*d*c+g*l*p-o*m*p-u*l*v+o*d*v,y=f*d*c-h*m*c-f*l*p+n*m*p+h*l*v-n*d*v,x=h*g*c-f*u*c+f*o*p-n*g*p-h*o*v+n*u*v,b=f*u*l-h*g*l-f*o*d+n*g*d+h*o*m-n*u*m,M=t*_+r*y+s*x+a*b;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/M;return e[0]=_*T,e[1]=(g*d*a-u*m*a-g*s*p+r*m*p+u*s*v-r*d*v)*T,e[2]=(o*m*a-g*l*a+g*s*c-r*m*c-o*s*v+r*l*v)*T,e[3]=(u*l*a-o*d*a-u*s*c+r*d*c+o*s*p-r*l*p)*T,e[4]=y*T,e[5]=(h*m*a-f*d*a+f*s*p-t*m*p-h*s*v+t*d*v)*T,e[6]=(f*l*a-n*m*a-f*s*c+t*m*c+n*s*v-t*l*v)*T,e[7]=(n*d*a-h*l*a+h*s*c-t*d*c-n*s*p+t*l*p)*T,e[8]=x*T,e[9]=(f*u*a-h*g*a-f*r*p+t*g*p+h*r*v-t*u*v)*T,e[10]=(n*g*a-f*o*a+f*r*c-t*g*c-n*r*v+t*o*v)*T,e[11]=(h*o*a-n*u*a-h*r*c+t*u*c+n*r*p-t*o*p)*T,e[12]=b*T,e[13]=(h*g*s-f*u*s+f*r*d-t*g*d-h*r*m+t*u*m)*T,e[14]=(f*o*s-n*g*s-f*r*l+t*g*l+n*r*m-t*o*m)*T,e[15]=(n*u*s-h*o*s+h*r*l-t*u*l-n*r*d+t*o*d)*T,this}scale(e){const t=this.elements,r=e.x,s=e.y,a=e.z;return t[0]*=r,t[4]*=s,t[8]*=a,t[1]*=r,t[5]*=s,t[9]*=a,t[2]*=r,t[6]*=s,t[10]*=a,t[3]*=r,t[7]*=s,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,s))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),s=Math.sin(t),a=1-r,n=e.x,o=e.y,l=e.z,c=a*n,h=a*o;return this.set(c*n+r,c*o-s*l,c*l+s*o,0,c*o+s*l,h*o+r,h*l-s*n,0,c*l-s*o,h*l+s*n,a*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,s,a,n){return this.set(1,r,a,0,e,1,n,0,t,s,1,0,0,0,0,1),this}compose(e,t,r){const s=this.elements,a=t._x,n=t._y,o=t._z,l=t._w,c=a+a,h=n+n,u=o+o,d=a*c,p=a*h,f=a*u,g=n*h,m=n*u,v=o*u,_=l*c,y=l*h,x=l*u,b=r.x,M=r.y,T=r.z;return s[0]=(1-(g+v))*b,s[1]=(p+x)*b,s[2]=(f-y)*b,s[3]=0,s[4]=(p-x)*M,s[5]=(1-(d+v))*M,s[6]=(m+_)*M,s[7]=0,s[8]=(f+y)*T,s[9]=(m-_)*T,s[10]=(1-(d+g))*T,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,r){const s=this.elements;let a=ro.set(s[0],s[1],s[2]).length();const n=ro.set(s[4],s[5],s[6]).length(),o=ro.set(s[8],s[9],s[10]).length();this.determinant()<0&&(a=-a),e.x=s[12],e.y=s[13],e.z=s[14],kr.copy(this);const l=1/a,c=1/n,h=1/o;return kr.elements[0]*=l,kr.elements[1]*=l,kr.elements[2]*=l,kr.elements[4]*=c,kr.elements[5]*=c,kr.elements[6]*=c,kr.elements[8]*=h,kr.elements[9]*=h,kr.elements[10]*=h,t.setFromRotationMatrix(kr),r.x=a,r.y=n,r.z=o,this}makePerspective(e,t,r,s,a,n,o=2e3){const l=this.elements,c=2*a/(t-e),h=2*a/(r-s),u=(t+e)/(t-e),d=(r+s)/(r-s);let p,f;if(o===Hn)p=-(n+a)/(n-a),f=-2*n*a/(n-a);else{if(o!==Lc)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);p=-n/(n-a),f=-n*a/(n-a)}return l[0]=c,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=h,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,r,s,a,n,o=2e3){const l=this.elements,c=1/(t-e),h=1/(r-s),u=1/(n-a),d=(t+e)*c,p=(r+s)*h;let f,g;if(o===Hn)f=(n+a)*u,g=-2*u;else{if(o!==Lc)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);f=a*u,g=-1*u}return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=g,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let s=0;s<16;s++)if(t[s]!==r[s])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const ro=new R,kr=new Me,NS=new R(0,0,0),DS=new R(1,1,1),aa=new R,Oh=new R,ar=new R,Av=new Me,Ev=new it;class Rt{constructor(e=0,t=0,r=0,s=Rt.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,s=this._order){return this._x=e,this._y=t,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const s=e.elements,a=s[0],n=s[4],o=s[8],l=s[1],c=s[5],h=s[9],u=s[2],d=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(Vt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-n,a)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Vt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,a),this._z=0);break;case"ZXY":this._x=Math.asin(Vt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-n,c)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-Vt(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-n,c));break;case"YZX":this._z=Math.asin(Vt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-Vt(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-h,p),this._y=0)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return Av.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Av,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ev.setFromEuler(this),this.setFromQuaternion(Ev,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Rt.DEFAULT_ORDER="XYZ";class op{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let OS=0;const Cv=new R,so=new it,Es=new Me,Uh=new R,Rl=new R,US=new R,kS=new it,Rv=new R(1,0,0),Pv=new R(0,1,0),Iv=new R(0,0,1),Lv={type:"added"},FS={type:"removed"},ao={type:"childadded",child:null},qp={type:"childremoved",child:null};class je extends ys{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:OS++}),this.uuid=vr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=je.DEFAULT_UP.clone();const e=new R,t=new Rt,r=new it,s=new R(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Me},normalMatrix:{value:new Ve}}),this.matrix=new Me,this.matrixWorld=new Me,this.matrixAutoUpdate=je.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=je.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new op,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return so.setFromAxisAngle(e,t),this.quaternion.multiply(so),this}rotateOnWorldAxis(e,t){return so.setFromAxisAngle(e,t),this.quaternion.premultiply(so),this}rotateX(e){return this.rotateOnAxis(Rv,e)}rotateY(e){return this.rotateOnAxis(Pv,e)}rotateZ(e){return this.rotateOnAxis(Iv,e)}translateOnAxis(e,t){return Cv.copy(e).applyQuaternion(this.quaternion),this.position.add(Cv.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Rv,e)}translateY(e){return this.translateOnAxis(Pv,e)}translateZ(e){return this.translateOnAxis(Iv,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Es.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?Uh.copy(e):Uh.set(e,t,r);const s=this.parent;this.updateWorldMatrix(!0,!1),Rl.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Es.lookAt(Rl,Uh,this.up):Es.lookAt(Uh,Rl,this.up),this.quaternion.setFromRotationMatrix(Es),s&&(Es.extractRotation(s.matrixWorld),so.setFromRotationMatrix(Es),this.quaternion.premultiply(so.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this||e&&e.isObject3D&&(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Lv),ao.child=e,this.dispatchEvent(ao),ao.child=null),this}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(FS),qp.child=e,this.dispatchEvent(qp),qp.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Es.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Es.multiply(e.parent.matrixWorld)),e.applyMatrix4(Es),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Lv),ao.child=e,this.dispatchEvent(ao),ao.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const s=this.children;for(let a=0,n=s.length;a<n;a++)s[a].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rl,e,US),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rl,kS,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,s=t.length;r<s;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,s=t.length;r<s;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,s=t.length;r<s;r++){const a=t[r];a.matrixWorldAutoUpdate!==!0&&e!==!0||a.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let a=0,n=s.length;a<n;a++){const o=s[a];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};function a(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=a(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];a(e.shapes,u)}else a(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(a(e.materials,this.material[l]));s.material=o}else s.material=a(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];s.animations.push(a(e.animations,l))}}if(t){const o=n(e.geometries),l=n(e.materials),c=n(e.textures),h=n(e.images),u=n(e.shapes),d=n(e.skeletons),p=n(e.animations),f=n(e.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),h.length>0&&(r.images=h),u.length>0&&(r.shapes=u),d.length>0&&(r.skeletons=d),p.length>0&&(r.animations=p),f.length>0&&(r.nodes=f)}return r.object=s,r;function n(o){const l=[];for(const c in o){const h=o[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const s=e.children[r];this.add(s.clone())}return this}}je.DEFAULT_UP=new R(0,1,0),je.DEFAULT_MATRIX_AUTO_UPDATE=!0,je.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Fr=new R,Cs=new R,Yp=new R,Rs=new R,no=new R,oo=new R,Nv=new R,Zp=new R,Kp=new R,Qp=new R;class dr{constructor(e=new R,t=new R,r=new R){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,s){s.subVectors(r,t),Fr.subVectors(e,t),s.cross(Fr);const a=s.lengthSq();return a>0?s.multiplyScalar(1/Math.sqrt(a)):s.set(0,0,0)}static getBarycoord(e,t,r,s,a){Fr.subVectors(s,t),Cs.subVectors(r,t),Yp.subVectors(e,t);const n=Fr.dot(Fr),o=Fr.dot(Cs),l=Fr.dot(Yp),c=Cs.dot(Cs),h=Cs.dot(Yp),u=n*c-o*o;if(u===0)return a.set(0,0,0),null;const d=1/u,p=(c*l-o*h)*d,f=(n*h-o*l)*d;return a.set(1-p-f,f,p)}static containsPoint(e,t,r,s){return this.getBarycoord(e,t,r,s,Rs)!==null&&Rs.x>=0&&Rs.y>=0&&Rs.x+Rs.y<=1}static getInterpolation(e,t,r,s,a,n,o,l){return this.getBarycoord(e,t,r,s,Rs)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(a,Rs.x),l.addScaledVector(n,Rs.y),l.addScaledVector(o,Rs.z),l)}static isFrontFacing(e,t,r,s){return Fr.subVectors(r,t),Cs.subVectors(e,t),Fr.cross(Cs).dot(s)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,s){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,r,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Fr.subVectors(this.c,this.b),Cs.subVectors(this.a,this.b),.5*Fr.cross(Cs).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return dr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return dr.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,s,a){return dr.getInterpolation(e,this.a,this.b,this.c,t,r,s,a)}containsPoint(e){return dr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return dr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,s=this.b,a=this.c;let n,o;no.subVectors(s,r),oo.subVectors(a,r),Zp.subVectors(e,r);const l=no.dot(Zp),c=oo.dot(Zp);if(l<=0&&c<=0)return t.copy(r);Kp.subVectors(e,s);const h=no.dot(Kp),u=oo.dot(Kp);if(h>=0&&u<=h)return t.copy(s);const d=l*u-h*c;if(d<=0&&l>=0&&h<=0)return n=l/(l-h),t.copy(r).addScaledVector(no,n);Qp.subVectors(e,a);const p=no.dot(Qp),f=oo.dot(Qp);if(f>=0&&p<=f)return t.copy(a);const g=p*c-l*f;if(g<=0&&c>=0&&f<=0)return o=c/(c-f),t.copy(r).addScaledVector(oo,o);const m=h*f-p*u;if(m<=0&&u-h>=0&&p-f>=0)return Nv.subVectors(a,s),o=(u-h)/(u-h+(p-f)),t.copy(s).addScaledVector(Nv,o);const v=1/(m+g+d);return n=g*v,o=d*v,t.copy(r).addScaledVector(no,n).addScaledVector(oo,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Mx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},na={h:0,s:0,l:0},kh={h:0,s:0,l:0};function Jp(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+6*(e-i)*t:t<.5?e:t<2/3?i+6*(e-i)*(2/3-t):i}let fe=class{constructor(i,e,t){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(i,e,t)}set(i,e,t){if(e===void 0&&t===void 0){const r=i;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(i,e,t);return this}setScalar(i){return this.r=i,this.g=i,this.b=i,this}setHex(i,e=Tt){return i=Math.floor(i),this.r=(i>>16&255)/255,this.g=(i>>8&255)/255,this.b=(255&i)/255,ht.toWorkingColorSpace(this,e),this}setRGB(i,e,t,r=ht.workingColorSpace){return this.r=i,this.g=e,this.b=t,ht.toWorkingColorSpace(this,r),this}setHSL(i,e,t,r=ht.workingColorSpace){if(i=Zf(i,1),e=Vt(e,0,1),t=Vt(t,0,1),e===0)this.r=this.g=this.b=t;else{const s=t<=.5?t*(1+e):t+e-t*e,a=2*t-s;this.r=Jp(a,s,i+1/3),this.g=Jp(a,s,i),this.b=Jp(a,s,i-1/3)}return ht.toWorkingColorSpace(this,r),this}setStyle(i,e=Tt){function t(s){}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(i)){let s;const a=r[1],n=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return s[4],this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return s[4],this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return s[4],this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(i)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(s,16),e)}else if(i&&i.length>0)return this.setColorName(i,e);return this}setColorName(i,e=Tt){const t=Mx[i.toLowerCase()];return t!==void 0&&this.setHex(t,e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(i){return this.r=i.r,this.g=i.g,this.b=i.b,this}copySRGBToLinear(i){return this.r=zo(i.r),this.g=zo(i.g),this.b=zo(i.b),this}copyLinearToSRGB(i){return this.r=Bp(i.r),this.g=Bp(i.g),this.b=Bp(i.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(i=Tt){return ht.fromWorkingColorSpace(Ri.copy(this),i),65536*Math.round(Vt(255*Ri.r,0,255))+256*Math.round(Vt(255*Ri.g,0,255))+Math.round(Vt(255*Ri.b,0,255))}getHexString(i=Tt){return("000000"+this.getHex(i).toString(16)).slice(-6)}getHSL(i,e=ht.workingColorSpace){ht.fromWorkingColorSpace(Ri.copy(this),e);const t=Ri.r,r=Ri.g,s=Ri.b,a=Math.max(t,r,s),n=Math.min(t,r,s);let o,l;const c=(n+a)/2;if(n===a)o=0,l=0;else{const h=a-n;switch(l=c<=.5?h/(a+n):h/(2-a-n),a){case t:o=(r-s)/h+(r<s?6:0);break;case r:o=(s-t)/h+2;break;case s:o=(t-r)/h+4}o/=6}return i.h=o,i.s=l,i.l=c,i}getRGB(i,e=ht.workingColorSpace){return ht.fromWorkingColorSpace(Ri.copy(this),e),i.r=Ri.r,i.g=Ri.g,i.b=Ri.b,i}getStyle(i=Tt){ht.fromWorkingColorSpace(Ri.copy(this),i);const e=Ri.r,t=Ri.g,r=Ri.b;return i!==Tt?`color(${i} ${e.toFixed(3)} ${t.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*t)},${Math.round(255*r)})`}offsetHSL(i,e,t){return this.getHSL(na),this.setHSL(na.h+i,na.s+e,na.l+t)}add(i){return this.r+=i.r,this.g+=i.g,this.b+=i.b,this}addColors(i,e){return this.r=i.r+e.r,this.g=i.g+e.g,this.b=i.b+e.b,this}addScalar(i){return this.r+=i,this.g+=i,this.b+=i,this}sub(i){return this.r=Math.max(0,this.r-i.r),this.g=Math.max(0,this.g-i.g),this.b=Math.max(0,this.b-i.b),this}multiply(i){return this.r*=i.r,this.g*=i.g,this.b*=i.b,this}multiplyScalar(i){return this.r*=i,this.g*=i,this.b*=i,this}lerp(i,e){return this.r+=(i.r-this.r)*e,this.g+=(i.g-this.g)*e,this.b+=(i.b-this.b)*e,this}lerpColors(i,e,t){return this.r=i.r+(e.r-i.r)*t,this.g=i.g+(e.g-i.g)*t,this.b=i.b+(e.b-i.b)*t,this}lerpHSL(i,e){this.getHSL(na),i.getHSL(kh);const t=dc(na.h,kh.h,e),r=dc(na.s,kh.s,e),s=dc(na.l,kh.l,e);return this.setHSL(t,r,s),this}setFromVector3(i){return this.r=i.x,this.g=i.y,this.b=i.z,this}applyMatrix3(i){const e=this.r,t=this.g,r=this.b,s=i.elements;return this.r=s[0]*e+s[3]*t+s[6]*r,this.g=s[1]*e+s[4]*t+s[7]*r,this.b=s[2]*e+s[5]*t+s[8]*r,this}equals(i){return i.r===this.r&&i.g===this.g&&i.b===this.b}fromArray(i,e=0){return this.r=i[e],this.g=i[e+1],this.b=i[e+2],this}toArray(i=[],e=0){return i[e]=this.r,i[e+1]=this.g,i[e+2]=this.b,i}fromBufferAttribute(i,e){return this.r=i.getX(e),this.g=i.getY(e),this.b=i.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Ri=new fe;fe.NAMES=Mx;let BS=0;class ti extends ys{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:BS++}),this.uuid=vr(),this.name="",this.type="Material",this.blending=1,this.side=Ir,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Pa,this.blendDst=Ia,this.blendEquation=ur,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new fe(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=gn,this.stencilZFail=gn,this.stencilZPass=gn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0)continue;const s=this[t];s!==void 0&&(s&&s.isColor?s.set(r):s&&s.isVector3&&r&&r.isVector3?s.copy(r):this[t]=r)}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function s(a){const n=[];for(const o in a){const l=a[o];delete l.metadata,n.push(l)}return n}if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(r.blending=this.blending),this.side!==Ir&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==Pa&&(r.blendSrc=this.blendSrc),this.blendDst!==Ia&&(r.blendDst=this.blendDst),this.blendEquation!==ur&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==3&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==519&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==gn&&(r.stencilFail=this.stencilFail),this.stencilZFail!==gn&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==gn&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){const a=s(e.textures),n=s(e.images);a.length>0&&(r.textures=a),n.length>0&&(r.images=n)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const s=t.length;r=new Array(s);for(let a=0;a!==s;++a)r[a]=t[a].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class ei extends ti{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rt,this.combine=ch,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Fs=zS();function zS(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),r=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[256|l]=32768,s[l]=24,s[256|l]=24):c<-14?(r[l]=1024>>-c-14,r[256|l]=1024>>-c-14|32768,s[l]=-c-1,s[256|l]=-c-1):c<=15?(r[l]=c+15<<10,r[256|l]=c+15<<10|32768,s[l]=13,s[256|l]=13):c<128?(r[l]=31744,r[256|l]=64512,s[l]=24,s[256|l]=24):(r[l]=31744,r[256|l]=64512,s[l]=13,s[256|l]=13)}const a=new Uint32Array(2048),n=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(8388608&c);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,a[l]=c|h}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)n[l]=l<<23;n[31]=1199570944,n[32]=2147483648;for(let l=33;l<63;++l)n[l]=2147483648+(l-32<<23);n[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:r,shiftTable:s,mantissaTable:a,exponentTable:n,offsetTable:o}}function Yi(i){i=Vt(i,-65504,65504),Fs.floatView[0]=i;const e=Fs.uint32View[0],t=e>>23&511;return Fs.baseTable[t]+((8388607&e)>>Fs.shiftTable[t])}function ic(i){const e=i>>10;return Fs.uint32View[0]=Fs.mantissaTable[Fs.offsetTable[e]+(1023&i)]+Fs.exponentTable[e],Fs.floatView[0]}const VS={toHalfFloat:Yi,fromHalfFloat:ic},ri=new R,Fh=new ne;class tt{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=Ic,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=mr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return i0("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let s=0,a=this.itemSize;s<a;s++)this.array[e+s]=t.array[r+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)Fh.fromBufferAttribute(this,t),Fh.applyMatrix3(e),this.setXY(t,Fh.x,Fh.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)ri.fromBufferAttribute(this,t),ri.applyMatrix3(e),this.setXYZ(t,ri.x,ri.y,ri.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)ri.fromBufferAttribute(this,t),ri.applyMatrix4(e),this.setXYZ(t,ri.x,ri.y,ri.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)ri.fromBufferAttribute(this,t),ri.applyNormalMatrix(e),this.setXYZ(t,ri.x,ri.y,ri.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)ri.fromBufferAttribute(this,t),ri.transformDirection(e),this.setXYZ(t,ri.x,ri.y,ri.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=Gi(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Ge(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Gi(t,this.array)),t}setX(e,t){return this.normalized&&(t=Ge(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Gi(t,this.array)),t}setY(e,t){return this.normalized&&(t=Ge(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Gi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Ge(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Gi(t,this.array)),t}setW(e,t){return this.normalized&&(t=Ge(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Ge(t,this.array),r=Ge(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,s){return e*=this.itemSize,this.normalized&&(t=Ge(t,this.array),r=Ge(r,this.array),s=Ge(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=s,this}setXYZW(e,t,r,s,a){return e*=this.itemSize,this.normalized&&(t=Ge(t,this.array),r=Ge(r,this.array),s=Ge(s,this.array),a=Ge(a,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=s,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Ic&&(e.usage=this.usage),e}}class lp extends tt{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class r0 extends tt{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Se extends tt{constructor(e,t,r){super(new Float32Array(e),t,r)}}let HS=0;const br=new Me,$p=new je,lo=new R,nr=new Et,Pl=new Et,gi=new R;class Oe extends ys{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:HS++}),this.uuid=vr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(_x(e)?r0:lp)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const a=new Ve().getNormalMatrix(e);r.applyNormalMatrix(a),r.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return br.makeRotationFromQuaternion(e),this.applyMatrix4(br),this}rotateX(e){return br.makeRotationX(e),this.applyMatrix4(br),this}rotateY(e){return br.makeRotationY(e),this.applyMatrix4(br),this}rotateZ(e){return br.makeRotationZ(e),this.applyMatrix4(br),this}translate(e,t,r){return br.makeTranslation(e,t,r),this.applyMatrix4(br),this}scale(e,t,r){return br.makeScale(e,t,r),this.applyMatrix4(br),this}lookAt(e){return $p.lookAt(e),$p.updateMatrix(),this.applyMatrix4($p.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(lo).negate(),this.translate(lo.x,lo.y,lo.z),this}setFromPoints(e){const t=[];for(let r=0,s=e.length;r<s;r++){const a=e[r];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Se(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Et);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingBox.set(new R(-1/0,-1/0,-1/0),new R(1/0,1/0,1/0));else{if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,s=t.length;r<s;r++){const a=t[r];nr.setFromBufferAttribute(a),this.morphTargetsRelative?(gi.addVectors(this.boundingBox.min,nr.min),this.boundingBox.expandByPoint(gi),gi.addVectors(this.boundingBox.max,nr.max),this.boundingBox.expandByPoint(gi)):(this.boundingBox.expandByPoint(nr.min),this.boundingBox.expandByPoint(nr.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new di);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingSphere.set(new R,1/0);else if(e){const r=this.boundingSphere.center;if(nr.setFromBufferAttribute(e),t)for(let a=0,n=t.length;a<n;a++){const o=t[a];Pl.setFromBufferAttribute(o),this.morphTargetsRelative?(gi.addVectors(nr.min,Pl.min),nr.expandByPoint(gi),gi.addVectors(nr.max,Pl.max),nr.expandByPoint(gi)):(nr.expandByPoint(Pl.min),nr.expandByPoint(Pl.max))}nr.getCenter(r);let s=0;for(let a=0,n=e.count;a<n;a++)gi.fromBufferAttribute(e,a),s=Math.max(s,r.distanceToSquared(gi));if(t)for(let a=0,n=t.length;a<n;a++){const o=t[a],l=this.morphTargetsRelative;for(let c=0,h=o.count;c<h;c++)gi.fromBufferAttribute(o,c),l&&(lo.fromBufferAttribute(e,c),gi.add(lo)),s=Math.max(s,r.distanceToSquared(gi))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0)return;const r=t.position,s=t.normal,a=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new tt(new Float32Array(4*r.count),4));const n=this.getAttribute("tangent"),o=[],l=[];for(let E=0;E<r.count;E++)o[E]=new R,l[E]=new R;const c=new R,h=new R,u=new R,d=new ne,p=new ne,f=new ne,g=new R,m=new R;function v(E,C,N){c.fromBufferAttribute(r,E),h.fromBufferAttribute(r,C),u.fromBufferAttribute(r,N),d.fromBufferAttribute(a,E),p.fromBufferAttribute(a,C),f.fromBufferAttribute(a,N),h.sub(c),u.sub(c),p.sub(d),f.sub(d);const D=1/(p.x*f.y-f.x*p.y);isFinite(D)&&(g.copy(h).multiplyScalar(f.y).addScaledVector(u,-p.y).multiplyScalar(D),m.copy(u).multiplyScalar(p.x).addScaledVector(h,-f.x).multiplyScalar(D),o[E].add(g),o[C].add(g),o[N].add(g),l[E].add(m),l[C].add(m),l[N].add(m))}let _=this.groups;_.length===0&&(_=[{start:0,count:e.count}]);for(let E=0,C=_.length;E<C;++E){const N=_[E],D=N.start;for(let A=D,L=D+N.count;A<L;A+=3)v(e.getX(A+0),e.getX(A+1),e.getX(A+2))}const y=new R,x=new R,b=new R,M=new R;function T(E){b.fromBufferAttribute(s,E),M.copy(b);const C=o[E];y.copy(C),y.sub(b.multiplyScalar(b.dot(C))).normalize(),x.crossVectors(M,C);const N=x.dot(l[E])<0?-1:1;n.setXYZW(E,y.x,y.y,y.z,N)}for(let E=0,C=_.length;E<C;++E){const N=_[E],D=N.start;for(let A=D,L=D+N.count;A<L;A+=3)T(e.getX(A+0)),T(e.getX(A+1)),T(e.getX(A+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new tt(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);const s=new R,a=new R,n=new R,o=new R,l=new R,c=new R,h=new R,u=new R;if(e)for(let d=0,p=e.count;d<p;d+=3){const f=e.getX(d+0),g=e.getX(d+1),m=e.getX(d+2);s.fromBufferAttribute(t,f),a.fromBufferAttribute(t,g),n.fromBufferAttribute(t,m),h.subVectors(n,a),u.subVectors(s,a),h.cross(u),o.fromBufferAttribute(r,f),l.fromBufferAttribute(r,g),c.fromBufferAttribute(r,m),o.add(h),l.add(h),c.add(h),r.setXYZ(f,o.x,o.y,o.z),r.setXYZ(g,l.x,l.y,l.z),r.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,p=t.count;d<p;d+=3)s.fromBufferAttribute(t,d+0),a.fromBufferAttribute(t,d+1),n.fromBufferAttribute(t,d+2),h.subVectors(n,a),u.subVectors(s,a),h.cross(u),r.setXYZ(d+0,h.x,h.y,h.z),r.setXYZ(d+1,h.x,h.y,h.z),r.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)gi.fromBufferAttribute(e,t),gi.normalize(),e.setXYZ(t,gi.x,gi.y,gi.z)}toNonIndexed(){function e(o,l){const c=o.array,h=o.itemSize,u=o.normalized,d=new c.constructor(l.length*h);let p=0,f=0;for(let g=0,m=l.length;g<m;g++){p=o.isInterleavedBufferAttribute?l[g]*o.data.stride+o.offset:l[g]*h;for(let v=0;v<h;v++)d[f++]=c[p++]}return new tt(d,h,u)}if(this.index===null)return this;const t=new Oe,r=this.index.array,s=this.attributes;for(const o in s){const l=e(s[o],r);t.setAttribute(o,l)}const a=this.morphAttributes;for(const o in a){const l=[],c=a[o];for(let h=0,u=c.length;h<u;h++){const d=e(c[h],r);l.push(d)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const n=this.groups;for(let o=0,l=n.length;o<l;o++){const c=n[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let a=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,d=c.length;u<d;u++){const p=c[u];h.push(p.toJSON(e.data))}h.length>0&&(s[l]=h,a=!0)}a&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const n=this.groups;n.length>0&&(e.data.groups=JSON.parse(JSON.stringify(n)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const s=e.attributes;for(const c in s){const h=s[c];this.setAttribute(c,h.clone(t))}const a=e.morphAttributes;for(const c in a){const h=[],u=a[c];for(let d=0,p=u.length;d<p;d++)h.push(u[d].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const n=e.groups;for(let c=0,h=n.length;c<h;c++){const u=n[c];this.addGroup(u.start,u.count,u.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Dv=new Me,Qa=new Zn,Bh=new di,Ov=new R,co=new R,ho=new R,uo=new R,em=new R,zh=new R,Vh=new ne,Hh=new ne,Gh=new ne,Uv=new R,kv=new R,Fv=new R,jh=new R,Wh=new R;class ye extends je{constructor(e=new Oe,t=new ei){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}getVertexPosition(e,t){const r=this.geometry,s=r.attributes.position,a=r.morphAttributes.position,n=r.morphTargetsRelative;t.fromBufferAttribute(s,e);const o=this.morphTargetInfluences;if(a&&o){zh.set(0,0,0);for(let l=0,c=a.length;l<c;l++){const h=o[l],u=a[l];h!==0&&(em.fromBufferAttribute(u,e),n?zh.addScaledVector(em,h):zh.addScaledVector(em.sub(t),h))}t.add(zh)}return t}raycast(e,t){const r=this.geometry,s=this.material,a=this.matrixWorld;if(s!==void 0){if(r.boundingSphere===null&&r.computeBoundingSphere(),Bh.copy(r.boundingSphere),Bh.applyMatrix4(a),Qa.copy(e.ray).recast(e.near),Bh.containsPoint(Qa.origin)===!1&&(Qa.intersectSphere(Bh,Ov)===null||Qa.origin.distanceToSquared(Ov)>dS(e.far-e.near,2)))return;Dv.copy(a).invert(),Qa.copy(e.ray).applyMatrix4(Dv),r.boundingBox!==null&&Qa.intersectsBox(r.boundingBox)===!1||this._computeIntersections(e,t,Qa)}}_computeIntersections(e,t,r){let s;const a=this.geometry,n=this.material,o=a.index,l=a.attributes.position,c=a.attributes.uv,h=a.attributes.uv1,u=a.attributes.normal,d=a.groups,p=a.drawRange;if(o!==null)if(Array.isArray(n))for(let f=0,g=d.length;f<g;f++){const m=d[f],v=n[m.materialIndex];for(let _=Math.max(m.start,p.start),y=Math.min(o.count,Math.min(m.start+m.count,p.start+p.count));_<y;_+=3)s=Xh(this,v,e,r,c,h,u,o.getX(_),o.getX(_+1),o.getX(_+2)),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=m.materialIndex,t.push(s))}else for(let f=Math.max(0,p.start),g=Math.min(o.count,p.start+p.count);f<g;f+=3)s=Xh(this,n,e,r,c,h,u,o.getX(f),o.getX(f+1),o.getX(f+2)),s&&(s.faceIndex=Math.floor(f/3),t.push(s));else if(l!==void 0)if(Array.isArray(n))for(let f=0,g=d.length;f<g;f++){const m=d[f],v=n[m.materialIndex];for(let _=Math.max(m.start,p.start),y=Math.min(l.count,Math.min(m.start+m.count,p.start+p.count));_<y;_+=3)s=Xh(this,v,e,r,c,h,u,_,_+1,_+2),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=m.materialIndex,t.push(s))}else for(let f=Math.max(0,p.start),g=Math.min(l.count,p.start+p.count);f<g;f+=3)s=Xh(this,n,e,r,c,h,u,f,f+1,f+2),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}function Xh(i,e,t,r,s,a,n,o,l,c){i.getVertexPosition(o,co),i.getVertexPosition(l,ho),i.getVertexPosition(c,uo);const h=function(u,d,p,f,g,m,v,_){let y;if(y=d.side===Di?f.intersectTriangle(v,m,g,!0,_):f.intersectTriangle(g,m,v,d.side===Ir,_),y===null)return null;Wh.copy(_),Wh.applyMatrix4(u.matrixWorld);const x=p.ray.origin.distanceTo(Wh);return x<p.near||x>p.far?null:{distance:x,point:Wh.clone(),object:u}}(i,e,t,r,co,ho,uo,jh);if(h){s&&(Vh.fromBufferAttribute(s,o),Hh.fromBufferAttribute(s,l),Gh.fromBufferAttribute(s,c),h.uv=dr.getInterpolation(jh,co,ho,uo,Vh,Hh,Gh,new ne)),a&&(Vh.fromBufferAttribute(a,o),Hh.fromBufferAttribute(a,l),Gh.fromBufferAttribute(a,c),h.uv1=dr.getInterpolation(jh,co,ho,uo,Vh,Hh,Gh,new ne)),n&&(Uv.fromBufferAttribute(n,o),kv.fromBufferAttribute(n,l),Fv.fromBufferAttribute(n,c),h.normal=dr.getInterpolation(jh,co,ho,uo,Uv,kv,Fv,new R),h.normal.dot(r.direction)>0&&h.normal.multiplyScalar(-1));const u={a:o,b:l,c,normal:new R,materialIndex:0};dr.getNormal(co,ho,uo,u.normal),h.face=u}return h}class Ot extends Oe{constructor(e=1,t=1,r=1,s=1,a=1,n=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:s,heightSegments:a,depthSegments:n};const o=this;s=Math.floor(s),a=Math.floor(a),n=Math.floor(n);const l=[],c=[],h=[],u=[];let d=0,p=0;function f(g,m,v,_,y,x,b,M,T,E,C){const N=x/T,D=b/E,A=x/2,L=b/2,w=M/2,B=T+1,$=E+1;let K=0,ae=0;const se=new R;for(let me=0;me<$;me++){const H=me*D-L;for(let W=0;W<B;W++){const ce=W*N-A;se[g]=ce*_,se[m]=H*y,se[v]=w,c.push(se.x,se.y,se.z),se[g]=0,se[m]=0,se[v]=M>0?1:-1,h.push(se.x,se.y,se.z),u.push(W/T),u.push(1-me/E),K+=1}}for(let me=0;me<E;me++)for(let H=0;H<T;H++){const W=d+H+B*me,ce=d+H+B*(me+1),te=d+(H+1)+B*(me+1),k=d+(H+1)+B*me;l.push(W,ce,k),l.push(ce,te,k),ae+=6}o.addGroup(p,ae,C),p+=ae,d+=K}f("z","y","x",-1,-1,r,t,e,n,a,0),f("z","y","x",1,-1,r,t,-e,n,a,1),f("x","z","y",1,1,e,r,t,s,n,2),f("x","z","y",1,-1,e,r,-t,s,n,3),f("x","y","z",1,-1,e,t,r,s,a,4),f("x","y","z",-1,-1,e,t,-r,s,a,5),this.setIndex(l),this.setAttribute("position",new Se(c,3)),this.setAttribute("normal",new Se(h,3)),this.setAttribute("uv",new Se(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ot(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function sl(i){const e={};for(const t in i){e[t]={};for(const r in i[t]){const s=i[t][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?e[t][r]=null:e[t][r]=s.clone():Array.isArray(s)?e[t][r]=s.slice():e[t][r]=s}}return e}function Fi(i){const e={};for(let t=0;t<i.length;t++){const r=sl(i[t]);for(const s in r)e[s]=r[s]}return e}function wx(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ht.workingColorSpace}const ai={clone:sl,merge:Fi};class ct extends ti{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=sl(e.uniforms),this.uniformsGroups=function(t){const r=[];for(let s=0;s<t.length;s++)r.push(t[s].clone());return r}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?t.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[s]={type:"m4",value:a.toArray()}:t.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const s in this.extensions)this.extensions[s]===!0&&(r[s]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class cp extends je{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Me,this.projectionMatrix=new Me,this.projectionMatrixInverse=new Me,this.coordinateSystem=Hn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const oa=new R,Bv=new ne,zv=new ne;class Jt extends cp{constructor(e=50,t=1,r=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*rl*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Pn*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*rl*Math.atan(Math.tan(.5*Pn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){oa.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(oa.x,oa.y).multiplyScalar(-e/oa.z),oa.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(oa.x,oa.y).multiplyScalar(-e/oa.z)}getViewSize(e,t){return this.getViewBounds(e,Bv,zv),t.subVectors(zv,Bv)}setViewOffset(e,t,r,s,a,n){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=s,this.view.width=a,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Pn*this.fov)/this.zoom,r=2*t,s=this.aspect*r,a=-.5*s;const n=this.view;if(this.view!==null&&this.view.enabled){const l=n.fullWidth,c=n.fullHeight;a+=n.offsetX*s/l,t-=n.offsetY*r/c,s*=n.width/l,r*=n.height/c}const o=this.filmOffset;o!==0&&(a+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+s,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const po=-90;class Sx extends je{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Jt(po,1,e,t);s.layers=this.layers,this.add(s);const a=new Jt(po,1,e,t);a.layers=this.layers,this.add(a);const n=new Jt(po,1,e,t);n.layers=this.layers,this.add(n);const o=new Jt(po,1,e,t);o.layers=this.layers,this.add(o);const l=new Jt(po,1,e,t);l.layers=this.layers,this.add(l);const c=new Jt(po,1,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,s,a,n,o,l]=t;for(const c of t)this.remove(c);if(e===Hn)r.up.set(0,1,0),r.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),n.up.set(0,0,1),n.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else{if(e!==Lc)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),n.up.set(0,0,-1),n.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1)}for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[a,n,o,l,c,h]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const g=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,s),e.render(t,a),e.setRenderTarget(r,1,s),e.render(t,n),e.setRenderTarget(r,2,s),e.render(t,o),e.setRenderTarget(r,3,s),e.render(t,l),e.setRenderTarget(r,4,s),e.render(t,c),r.texture.generateMipmaps=g,e.setRenderTarget(r,5,s),e.render(t,h),e.setRenderTarget(u,d,p),e.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class Dc extends wt{constructor(e,t,r,s,a,n,o,l,c,h){super(e=e!==void 0?e:[],t=t!==void 0?t:Ws,r,s,a,n,o,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Tx extends ft{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},s=[r,r,r,r,r,r];this.texture=new Dc(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0&&t.generateMipmaps,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Kt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Ot(5,5,5),a=new ct({name:"CubemapFromEquirect",uniforms:sl(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Di,blending:0});a.uniforms.tEquirect.value=t;const n=new ye(s,a),o=t.minFilter;return t.minFilter===fs&&(t.minFilter=Kt),new Sx(1,10,this).update(e,n),t.minFilter=o,n.geometry.dispose(),n.material.dispose(),this}clear(e,t,r,s){const a=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,r,s);e.setRenderTarget(a)}}const tm=new R,GS=new R,jS=new Ve;class jr{constructor(e=new R(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,s){return this.normal.set(e,t,r),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const s=tm.subVectors(r,t).cross(GS.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(tm),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/s;return a<0||a>1?null:t.copy(e.start).addScaledVector(r,a)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||jS.getNormalMatrix(e),s=this.coplanarPoint(tm).applyMatrix4(e),a=this.normal.applyMatrix3(r).normalize();return this.constant=-s.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Ja=new di,qh=new R;class uh{constructor(e=new jr,t=new jr,r=new jr,s=new jr,a=new jr,n=new jr){this.planes=[e,t,r,s,a,n]}set(e,t,r,s,a,n){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(s),o[4].copy(a),o[5].copy(n),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=2e3){const r=this.planes,s=e.elements,a=s[0],n=s[1],o=s[2],l=s[3],c=s[4],h=s[5],u=s[6],d=s[7],p=s[8],f=s[9],g=s[10],m=s[11],v=s[12],_=s[13],y=s[14],x=s[15];if(r[0].setComponents(l-a,d-c,m-p,x-v).normalize(),r[1].setComponents(l+a,d+c,m+p,x+v).normalize(),r[2].setComponents(l+n,d+h,m+f,x+_).normalize(),r[3].setComponents(l-n,d-h,m-f,x-_).normalize(),r[4].setComponents(l-o,d-u,m-g,x-y).normalize(),t===Hn)r[5].setComponents(l+o,d+u,m+g,x+y).normalize();else{if(t!==Lc)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(o,u,g,y).normalize()}return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Ja.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Ja.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Ja)}intersectsSprite(e){return Ja.center.set(0,0,0),Ja.radius=.7071067811865476,Ja.applyMatrix4(e.matrixWorld),this.intersectsSphere(Ja)}intersectsSphere(e){const t=this.planes,r=e.center,s=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(r)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const s=t[r];if(qh.x=s.normal.x>0?e.max.x:e.min.x,qh.y=s.normal.y>0?e.max.y:e.min.y,qh.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(qh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function Ax(){let i=null,e=!1,t=null,r=null;function s(a,n){t(a,n),r=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(r=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(a){t=a},setContext:function(a){i=a}}}function WS(i){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const r=e.get(t);r&&(i.deleteBuffer(r.buffer),e.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const a=e.get(t);return void((!a||a.version<t.version)&&e.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=e.get(t);if(s===void 0)e.set(t,function(a,n){const o=a.array,l=a.usage,c=o.byteLength,h=i.createBuffer();let u;if(i.bindBuffer(n,h),i.bufferData(n,o,l),a.onUploadCallback(),o instanceof Float32Array)u=i.FLOAT;else if(o instanceof Uint16Array)u=a.isFloat16BufferAttribute?i.HALF_FLOAT:i.UNSIGNED_SHORT;else if(o instanceof Int16Array)u=i.SHORT;else if(o instanceof Uint32Array)u=i.UNSIGNED_INT;else if(o instanceof Int32Array)u=i.INT;else if(o instanceof Int8Array)u=i.BYTE;else if(o instanceof Uint8Array)u=i.UNSIGNED_BYTE;else{if(!(o instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+o);u=i.UNSIGNED_BYTE}return{buffer:h,type:u,bytesPerElement:o.BYTES_PER_ELEMENT,version:a.version,size:c}}(t,r));else if(s.version<t.version){if(s.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(a,n,o){const l=n.array,c=n._updateRange,h=n.updateRanges;if(i.bindBuffer(o,a),c.count===-1&&h.length===0&&i.bufferSubData(o,0,l),h.length!==0){for(let u=0,d=h.length;u<d;u++){const p=h[u];i.bufferSubData(o,p.start*l.BYTES_PER_ELEMENT,l,p.start,p.count)}n.clearUpdateRanges()}c.count!==-1&&(i.bufferSubData(o,c.offset*l.BYTES_PER_ELEMENT,l,c.offset,c.count),c.count=-1),n.onUploadCallback()})(s.buffer,t,r),s.version=t.version}}}}class ws extends Oe{constructor(e=1,t=1,r=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:s};const a=e/2,n=t/2,o=Math.floor(r),l=Math.floor(s),c=o+1,h=l+1,u=e/o,d=t/l,p=[],f=[],g=[],m=[];for(let v=0;v<h;v++){const _=v*d-n;for(let y=0;y<c;y++){const x=y*u-a;f.push(x,-_,0),g.push(0,0,1),m.push(y/o),m.push(1-v/l)}}for(let v=0;v<l;v++)for(let _=0;_<o;_++){const y=_+c*v,x=_+c*(v+1),b=_+1+c*(v+1),M=_+1+c*v;p.push(y,x,M),p.push(x,b,M)}this.setIndex(p),this.setAttribute("position",new Se(f,3)),this.setAttribute("normal",new Se(g,3)),this.setAttribute("uv",new Se(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ws(e.width,e.height,e.widthSegments,e.heightSegments)}}const We={alphahash_fragment:`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment:`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex:`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex:`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,begin_vertex:`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( batchId );
	vColor.xyz *= batchingColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex:`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},Te={common:{diffuse:{value:new fe(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Ve},alphaMap:{value:null},alphaMapTransform:{value:new Ve},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Ve}},envmap:{envMap:{value:null},envMapRotation:{value:new Ve},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Ve}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Ve}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Ve},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Ve},normalScale:{value:new ne(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Ve},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Ve}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Ve}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Ve}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new fe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new fe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Ve},alphaTest:{value:0},uvTransform:{value:new Ve}},sprite:{diffuse:{value:new fe(16777215)},opacity:{value:1},center:{value:new ne(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Ve},alphaMap:{value:null},alphaMapTransform:{value:new Ve},alphaTest:{value:0}}},Vi={basic:{uniforms:Fi([Te.common,Te.specularmap,Te.envmap,Te.aomap,Te.lightmap,Te.fog]),vertexShader:We.meshbasic_vert,fragmentShader:We.meshbasic_frag},lambert:{uniforms:Fi([Te.common,Te.specularmap,Te.envmap,Te.aomap,Te.lightmap,Te.emissivemap,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.fog,Te.lights,{emissive:{value:new fe(0)}}]),vertexShader:We.meshlambert_vert,fragmentShader:We.meshlambert_frag},phong:{uniforms:Fi([Te.common,Te.specularmap,Te.envmap,Te.aomap,Te.lightmap,Te.emissivemap,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.fog,Te.lights,{emissive:{value:new fe(0)},specular:{value:new fe(1118481)},shininess:{value:30}}]),vertexShader:We.meshphong_vert,fragmentShader:We.meshphong_frag},standard:{uniforms:Fi([Te.common,Te.envmap,Te.aomap,Te.lightmap,Te.emissivemap,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.roughnessmap,Te.metalnessmap,Te.fog,Te.lights,{emissive:{value:new fe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:We.meshphysical_vert,fragmentShader:We.meshphysical_frag},toon:{uniforms:Fi([Te.common,Te.aomap,Te.lightmap,Te.emissivemap,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.gradientmap,Te.fog,Te.lights,{emissive:{value:new fe(0)}}]),vertexShader:We.meshtoon_vert,fragmentShader:We.meshtoon_frag},matcap:{uniforms:Fi([Te.common,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.fog,{matcap:{value:null}}]),vertexShader:We.meshmatcap_vert,fragmentShader:We.meshmatcap_frag},points:{uniforms:Fi([Te.points,Te.fog]),vertexShader:We.points_vert,fragmentShader:We.points_frag},dashed:{uniforms:Fi([Te.common,Te.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:We.linedashed_vert,fragmentShader:We.linedashed_frag},depth:{uniforms:Fi([Te.common,Te.displacementmap]),vertexShader:We.depth_vert,fragmentShader:We.depth_frag},normal:{uniforms:Fi([Te.common,Te.bumpmap,Te.normalmap,Te.displacementmap,{opacity:{value:1}}]),vertexShader:We.meshnormal_vert,fragmentShader:We.meshnormal_frag},sprite:{uniforms:Fi([Te.sprite,Te.fog]),vertexShader:We.sprite_vert,fragmentShader:We.sprite_frag},background:{uniforms:{uvTransform:{value:new Ve},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:We.background_vert,fragmentShader:We.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Ve}},vertexShader:We.backgroundCube_vert,fragmentShader:We.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:We.cube_vert,fragmentShader:We.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:We.equirect_vert,fragmentShader:We.equirect_frag},distanceRGBA:{uniforms:Fi([Te.common,Te.displacementmap,{referencePosition:{value:new R},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:We.distanceRGBA_vert,fragmentShader:We.distanceRGBA_frag},shadow:{uniforms:Fi([Te.lights,Te.fog,{color:{value:new fe(0)},opacity:{value:1}}]),vertexShader:We.shadow_vert,fragmentShader:We.shadow_frag}};Vi.physical={uniforms:Fi([Vi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Ve},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Ve},clearcoatNormalScale:{value:new ne(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Ve},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Ve},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Ve},sheen:{value:0},sheenColor:{value:new fe(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Ve},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Ve},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Ve},transmissionSamplerSize:{value:new ne},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Ve},attenuationDistance:{value:0},attenuationColor:{value:new fe(0)},specularColor:{value:new fe(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Ve},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Ve},anisotropyVector:{value:new ne},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Ve}}]),vertexShader:We.meshphysical_vert,fragmentShader:We.meshphysical_frag};const Yh={r:0,b:0,g:0},$a=new Rt,XS=new Me;function qS(i,e,t,r,s,a,n){const o=new fe(0);let l,c,h=a===!0?0:1,u=null,d=0,p=null;function f(m){let v=m.isScene===!0?m.background:null;return v&&v.isTexture&&(v=(m.backgroundBlurriness>0?t:e).get(v)),v}function g(m,v){m.getRGB(Yh,wx(i)),r.buffers.color.setClear(Yh.r,Yh.g,Yh.b,v,n)}return{getClearColor:function(){return o},setClearColor:function(m,v=1){o.set(m),h=v,g(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(m){h=m,g(o,h)},render:function(m){let v=!1;const _=f(m);_===null?g(o,h):_&&_.isColor&&(g(_,1),v=!0);const y=i.xr.getEnvironmentBlendMode();y==="additive"?r.buffers.color.setClear(0,0,0,1,n):y==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,n),(i.autoClear||v)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil))},addToRenderList:function(m,v){const _=f(v);_&&(_.isCubeTexture||_.mapping===xl)?(c===void 0&&(c=new ye(new Ot(1,1,1),new ct({name:"BackgroundCubeMaterial",uniforms:sl(Vi.backgroundCube.uniforms),vertexShader:Vi.backgroundCube.vertexShader,fragmentShader:Vi.backgroundCube.fragmentShader,side:Di,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(y,x,b){this.matrixWorld.copyPosition(b.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(c)),$a.copy(v.backgroundRotation),$a.x*=-1,$a.y*=-1,$a.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&($a.y*=-1,$a.z*=-1),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(XS.makeRotationFromEuler($a)),c.material.toneMapped=ht.getTransfer(_.colorSpace)!==St,u===_&&d===_.version&&p===i.toneMapping||(c.material.needsUpdate=!0,u=_,d=_.version,p=i.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(l===void 0&&(l=new ye(new ws(2,2),new ct({name:"BackgroundMaterial",uniforms:sl(Vi.background.uniforms),vertexShader:Vi.background.vertexShader,fragmentShader:Vi.background.fragmentShader,side:Ir,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,l.material.toneMapped=ht.getTransfer(_.colorSpace)!==St,_.matrixAutoUpdate===!0&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),u===_&&d===_.version&&p===i.toneMapping||(l.material.needsUpdate=!0,u=_,d=_.version,p=i.toneMapping),l.layers.enableAll(),m.unshift(l,l.geometry,l.material,0,0,null))}}}function YS(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),r={},s=c(null);let a=s,n=!1;function o(v){return i.bindVertexArray(v)}function l(v){return i.deleteVertexArray(v)}function c(v){const _=[],y=[],x=[];for(let b=0;b<t;b++)_[b]=0,y[b]=0,x[b]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:_,enabledAttributes:y,attributeDivisors:x,object:v,attributes:{},index:null}}function h(){const v=a.newAttributes;for(let _=0,y=v.length;_<y;_++)v[_]=0}function u(v){d(v,0)}function d(v,_){const y=a.newAttributes,x=a.enabledAttributes,b=a.attributeDivisors;y[v]=1,x[v]===0&&(i.enableVertexAttribArray(v),x[v]=1),b[v]!==_&&(i.vertexAttribDivisor(v,_),b[v]=_)}function p(){const v=a.newAttributes,_=a.enabledAttributes;for(let y=0,x=_.length;y<x;y++)_[y]!==v[y]&&(i.disableVertexAttribArray(y),_[y]=0)}function f(v,_,y,x,b,M,T){T===!0?i.vertexAttribIPointer(v,_,y,b,M):i.vertexAttribPointer(v,_,y,x,b,M)}function g(){m(),n=!0,a!==s&&(a=s,o(a.object))}function m(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:function(v,_,y,x,b){let M=!1;const T=function(E,C,N){const D=N.wireframe===!0;let A=r[E.id];A===void 0&&(A={},r[E.id]=A);let L=A[C.id];L===void 0&&(L={},A[C.id]=L);let w=L[D];return w===void 0&&(w=c(i.createVertexArray()),L[D]=w),w}(x,y,_);a!==T&&(a=T,o(a.object)),M=function(E,C,N,D){const A=a.attributes,L=C.attributes;let w=0;const B=N.getAttributes();for(const $ in B)if(B[$].location>=0){const K=A[$];let ae=L[$];if(ae===void 0&&($==="instanceMatrix"&&E.instanceMatrix&&(ae=E.instanceMatrix),$==="instanceColor"&&E.instanceColor&&(ae=E.instanceColor)),K===void 0||K.attribute!==ae||ae&&K.data!==ae.data)return!0;w++}return a.attributesNum!==w||a.index!==D}(v,x,y,b),M&&function(E,C,N,D){const A={},L=C.attributes;let w=0;const B=N.getAttributes();for(const $ in B)if(B[$].location>=0){let K=L[$];K===void 0&&($==="instanceMatrix"&&E.instanceMatrix&&(K=E.instanceMatrix),$==="instanceColor"&&E.instanceColor&&(K=E.instanceColor));const ae={};ae.attribute=K,K&&K.data&&(ae.data=K.data),A[$]=ae,w++}a.attributes=A,a.attributesNum=w,a.index=D}(v,x,y,b),b!==null&&e.update(b,i.ELEMENT_ARRAY_BUFFER),(M||n)&&(n=!1,function(E,C,N,D){h();const A=D.attributes,L=N.getAttributes(),w=C.defaultAttributeValues;for(const B in L){const $=L[B];if($.location>=0){let K=A[B];if(K===void 0&&(B==="instanceMatrix"&&E.instanceMatrix&&(K=E.instanceMatrix),B==="instanceColor"&&E.instanceColor&&(K=E.instanceColor)),K!==void 0){const ae=K.normalized,se=K.itemSize,me=e.get(K);if(me===void 0)continue;const H=me.buffer,W=me.type,ce=me.bytesPerElement,te=W===i.INT||W===i.UNSIGNED_INT||K.gpuType===Wg;if(K.isInterleavedBufferAttribute){const k=K.data,z=k.stride,ee=K.offset;if(k.isInstancedInterleavedBuffer){for(let re=0;re<$.locationSize;re++)d($.location+re,k.meshPerAttribute);E.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=k.meshPerAttribute*k.count)}else for(let re=0;re<$.locationSize;re++)u($.location+re);i.bindBuffer(i.ARRAY_BUFFER,H);for(let re=0;re<$.locationSize;re++)f($.location+re,se/$.locationSize,W,ae,z*ce,(ee+se/$.locationSize*re)*ce,te)}else{if(K.isInstancedBufferAttribute){for(let k=0;k<$.locationSize;k++)d($.location+k,K.meshPerAttribute);E.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=K.meshPerAttribute*K.count)}else for(let k=0;k<$.locationSize;k++)u($.location+k);i.bindBuffer(i.ARRAY_BUFFER,H);for(let k=0;k<$.locationSize;k++)f($.location+k,se/$.locationSize,W,ae,se*ce,se/$.locationSize*k*ce,te)}}else if(w!==void 0){const ae=w[B];if(ae!==void 0)switch(ae.length){case 2:i.vertexAttrib2fv($.location,ae);break;case 3:i.vertexAttrib3fv($.location,ae);break;case 4:i.vertexAttrib4fv($.location,ae);break;default:i.vertexAttrib1fv($.location,ae)}}}}p()}(v,_,y,x),b!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(b).buffer))},reset:g,resetDefaultState:m,dispose:function(){g();for(const v in r){const _=r[v];for(const y in _){const x=_[y];for(const b in x)l(x[b].object),delete x[b];delete _[y]}delete r[v]}},releaseStatesOfGeometry:function(v){if(r[v.id]===void 0)return;const _=r[v.id];for(const y in _){const x=_[y];for(const b in x)l(x[b].object),delete x[b];delete _[y]}delete r[v.id]},releaseStatesOfProgram:function(v){for(const _ in r){const y=r[_];if(y[v.id]===void 0)continue;const x=y[v.id];for(const b in x)l(x[b].object),delete x[b];delete y[v.id]}},initAttributes:h,enableAttribute:u,disableUnusedAttributes:p}}function ZS(i,e,t){let r;function s(a,n,o){o!==0&&(i.drawArraysInstanced(r,a,n,o),t.update(n,r,o))}this.setMode=function(a){r=a},this.render=function(a,n){i.drawArrays(r,a,n),t.update(n,r,1)},this.renderInstances=s,this.renderMultiDraw=function(a,n,o){if(o===0)return;const l=e.get("WEBGL_multi_draw");if(l===null)for(let c=0;c<o;c++)this.render(a[c],n[c]);else{l.multiDrawArraysWEBGL(r,a,0,n,0,o);let c=0;for(let h=0;h<o;h++)c+=n[h];t.update(c,r,1)}},this.renderMultiDrawInstances=function(a,n,o,l){if(o===0)return;const c=e.get("WEBGL_multi_draw");if(c===null)for(let h=0;h<a.length;h++)s(a[h],n[h],l[h]);else{c.multiDrawArraysInstancedWEBGL(r,a,0,n,0,l,0,o);let h=0;for(let u=0;u<o;u++)h+=n[u];for(let u=0;u<l.length;u++)t.update(h,r,l[u])}}}function KS(i,e,t,r){let s;function a(u){if(u==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";u="mediump"}return u==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let n=t.precision!==void 0?t.precision:"highp";const o=a(n);o!==n&&(n=o);const l=t.logarithmicDepthBuffer===!0,c=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),h=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const u=e.get("EXT_texture_filter_anisotropic");s=i.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s},getMaxPrecision:a,textureFormatReadable:function(u){return u===Pr||r.convert(u)===i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(u){const d=u===Qt&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(u!==zn&&r.convert(u)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&u!==mr&&!d)},precision:n,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:i.getParameter(i.MAX_TEXTURE_SIZE),maxCubemapSize:i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:i.getParameter(i.MAX_VERTEX_ATTRIBS),maxVertexUniforms:i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:i.getParameter(i.MAX_VARYING_VECTORS),maxFragmentUniforms:i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:i.getParameter(i.MAX_SAMPLES)}}function QS(i){const e=this;let t=null,r=0,s=!1,a=!1;const n=new jr,o=new Ve,l={value:null,needsUpdate:!1};function c(h,u,d,p){const f=h!==null?h.length:0;let g=null;if(f!==0){if(g=l.value,p!==!0||g===null){const m=d+4*f,v=u.matrixWorldInverse;o.getNormalMatrix(v),(g===null||g.length<m)&&(g=new Float32Array(m));for(let _=0,y=d;_!==f;++_,y+=4)n.copy(h[_]).applyMatrix4(v,o),n.normal.toArray(g,y),g[y+3]=n.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=f,e.numIntersection=0,g}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,u){const d=h.length!==0||u||r!==0||s;return s=u,r=h.length,d},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(h,u){t=c(h,u,0)},this.setState=function(h,u,d){const p=h.clippingPlanes,f=h.clipIntersection,g=h.clipShadows,m=i.get(h);if(!s||p===null||p.length===0||a&&!g)a?c(null):function(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}();else{const v=a?0:r,_=4*v;let y=m.clippingState||null;l.value=y,y=c(p,u,_,d);for(let x=0;x!==_;++x)y[x]=t[x];m.clippingState=y,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=v}}}function JS(i){let e=new WeakMap;function t(s,a){return a===Jo?s.mapping=Ws:a===Ac&&(s.mapping=La),s}function r(s){const a=s.target;a.removeEventListener("dispose",r);const n=e.get(a);n!==void 0&&(e.delete(a),n.dispose())}return{get:function(s){if(s&&s.isTexture){const a=s.mapping;if(a===Jo||a===Ac){if(e.has(s))return t(e.get(s).texture,s.mapping);{const n=s.image;if(n&&n.height>0){const o=new Tx(n.height);return o.fromEquirectangularTexture(i,s),e.set(s,o),s.addEventListener("dispose",r),t(o.texture,s.mapping)}return null}}}return s},dispose:function(){e=new WeakMap}}}class Gn extends cp{constructor(e=-1,t=1,r=1,s=-1,a=.1,n=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=s,this.near=a,this.far=n,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,s,a,n){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=s,this.view.width=a,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let a=r-e,n=r+e,o=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=c*this.view.offsetX,n=a+c*this.view.width,o-=h*this.view.offsetY,l=o-h*this.view.height}this.projectionMatrix.makeOrthographic(a,n,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Vv=[.125,.215,.35,.446,.526,.582],Zh=20,im=new Gn,Hv=new fe;let rm=null,sm=0,am=0,nm=!1;const vn=(1+Math.sqrt(5))/2,mo=1/vn,Gv=[new R(-vn,mo,0),new R(vn,mo,0),new R(-mo,0,vn),new R(mo,0,vn),new R(0,vn,-mo),new R(0,vn,mo),new R(-1,1,-1),new R(1,1,-1),new R(-1,1,1),new R(1,1,1)];class Qf{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,s=100){rm=this._renderer.getRenderTarget(),sm=this._renderer.getActiveCubeFace(),am=this._renderer.getActiveMipmapLevel(),nm=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,r,s,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Xv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Wv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(rm,sm,am),this._renderer.xr.enabled=nm,e.scissorTest=!1,Kh(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ws||e.mapping===La?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),rm=this._renderer.getRenderTarget(),sm=this._renderer.getActiveCubeFace(),am=this._renderer.getActiveMipmapLevel(),nm=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Kt,minFilter:Kt,generateMipmaps:!1,type:Qt,format:Pr,colorSpace:oi,depthBuffer:!1},s=jv(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=jv(e,t,r);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(n){const o=[],l=[],c=[];let h=n;const u=n-4+1+Vv.length;for(let d=0;d<u;d++){const p=Math.pow(2,h);l.push(p);let f=1/p;d>n-4?f=Vv[d-n+4-1]:d===0&&(f=0),c.push(f);const g=1/(p-2),m=-g,v=1+g,_=[m,m,v,m,v,v,m,m,v,v,m,v],y=6,x=6,b=3,M=2,T=1,E=new Float32Array(b*x*y),C=new Float32Array(M*x*y),N=new Float32Array(T*x*y);for(let A=0;A<y;A++){const L=A%3*2/3-1,w=A>2?0:-1,B=[L,w,0,L+2/3,w,0,L+2/3,w+1,0,L,w,0,L+2/3,w+1,0,L,w+1,0];E.set(B,b*x*A),C.set(_,M*x*A);const $=[A,A,A,A,A,A];N.set($,T*x*A)}const D=new Oe;D.setAttribute("position",new tt(E,b)),D.setAttribute("uv",new tt(C,M)),D.setAttribute("faceIndex",new tt(N,T)),o.push(D),h>4&&h--}return{lodPlanes:o,sizeLods:l,sigmas:c}}(a)),this._blurMaterial=function(n,o,l){const c=new Float32Array(Zh),h=new R(0,1,0);return new ct({name:"SphericalGaussianBlur",defines:{n:Zh,CUBEUV_TEXEL_WIDTH:1/o,CUBEUV_TEXEL_HEIGHT:1/l,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:c},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:h}},vertexShader:s0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}(a,e,t)}return s}_compileMaterial(e){const t=new ye(this._lodPlanes[0],e);this._renderer.compile(t,im)}_sceneToCubeUV(e,t,r,s){const a=new Jt(90,1,t,r),n=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.toneMapping;l.getClearColor(Hv),l.toneMapping=ms,l.autoClear=!1;const u=new ei({name:"PMREM.Background",side:Di,depthWrite:!1,depthTest:!1}),d=new ye(new Ot,u);let p=!1;const f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,p=!0):(u.color.copy(Hv),p=!0);for(let g=0;g<6;g++){const m=g%3;m===0?(a.up.set(0,n[g],0),a.lookAt(o[g],0,0)):m===1?(a.up.set(0,0,n[g]),a.lookAt(0,o[g],0)):(a.up.set(0,n[g],0),a.lookAt(0,0,o[g]));const v=this._cubeSize;Kh(s,m*v,g>2?v:0,v,v),l.setRenderTarget(s),p&&l.render(d,a),l.render(e,a)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=h,l.autoClear=c,e.background=f}_textureToCubeUV(e,t){const r=this._renderer,s=e.mapping===Ws||e.mapping===La;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=Xv()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Wv());const a=s?this._cubemapMaterial:this._equirectMaterial,n=new ye(this._lodPlanes[0],a);a.uniforms.envMap.value=e;const o=this._cubeSize;Kh(t,0,0,3*o,2*o),r.setRenderTarget(t),r.render(n,im)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let a=1;a<s;a++){const n=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),o=Gv[(s-a-1)%Gv.length];this._blur(e,a-1,a,n,o)}t.autoClear=r}_blur(e,t,r,s,a){const n=this._pingPongRenderTarget;this._halfBlur(e,n,t,r,s,"latitudinal",a),this._halfBlur(n,e,r,r,s,"longitudinal",a)}_halfBlur(e,t,r,s,a,n,o){const l=this._renderer,c=this._blurMaterial,h=new ye(this._lodPlanes[s],c),u=c.uniforms,d=this._sizeLods[r]-1,p=isFinite(a)?Math.PI/(2*d):2*Math.PI/39,f=a/p,g=isFinite(a)?1+Math.floor(3*f):Zh,m=[];let v=0;for(let x=0;x<Zh;++x){const b=x/f,M=Math.exp(-b*b/2);m.push(M),x===0?v+=M:x<g&&(v+=2*M)}for(let x=0;x<m.length;x++)m[x]=m[x]/v;u.envMap.value=e.texture,u.samples.value=g,u.weights.value=m,u.latitudinal.value=n==="latitudinal",o&&(u.poleAxis.value=o);const{_lodMax:_}=this;u.dTheta.value=p,u.mipInt.value=_-r;const y=this._sizeLods[s];Kh(t,3*y*(s>_-4?s-_+4:0),4*(this._cubeSize-y),3*y,2*y),l.setRenderTarget(t),l.render(h,im)}}function jv(i,e,t){const r=new ft(i,e,t);return r.texture.mapping=xl,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Kh(i,e,t,r,s){i.viewport.set(e,t,r,s),i.scissor.set(e,t,r,s)}function Wv(){return new ct({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:s0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function Xv(){return new ct({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:s0(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function s0(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function $S(i){let e=new WeakMap,t=null;function r(s){const a=s.target;a.removeEventListener("dispose",r);const n=e.get(a);n!==void 0&&(e.delete(a),n.dispose())}return{get:function(s){if(s&&s.isTexture){const a=s.mapping,n=a===Jo||a===Ac,o=a===Ws||a===La;if(n||o){let l=e.get(s);const c=l!==void 0?l.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==c)return t===null&&(t=new Qf(i)),l=n?t.fromEquirectangular(s,l):t.fromCubemap(s,l),l.texture.pmremVersion=s.pmremVersion,e.set(s,l),l.texture;if(l!==void 0)return l.texture;{const h=s.image;return n&&h&&h.height>0||o&&h&&function(u){let d=0;const p=6;for(let f=0;f<p;f++)u[f]!==void 0&&d++;return d===p}(h)?(t===null&&(t=new Qf(i)),l=n?t.fromEquirectangular(s):t.fromCubemap(s),l.texture.pmremVersion=s.pmremVersion,e.set(s,l),s.addEventListener("dispose",r),l.texture):null}}}return s},dispose:function(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}}}function e2(i){const e={};function t(r){if(e[r]!==void 0)return e[r];let s;switch(r){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(r)}return e[r]=s,s}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const s=t(r);return s===null&&i0("THREE.WebGLRenderer: "+r+" extension not supported."),s}}}function t2(i,e,t,r){const s={},a=new WeakMap;function n(l){const c=l.target;c.index!==null&&e.remove(c.index);for(const u in c.attributes)e.remove(c.attributes[u]);for(const u in c.morphAttributes){const d=c.morphAttributes[u];for(let p=0,f=d.length;p<f;p++)e.remove(d[p])}c.removeEventListener("dispose",n),delete s[c.id];const h=a.get(c);h&&(e.remove(h),a.delete(c)),r.releaseStatesOfGeometry(c),c.isInstancedBufferGeometry===!0&&delete c._maxInstanceCount,t.memory.geometries--}function o(l){const c=[],h=l.index,u=l.attributes.position;let d=0;if(h!==null){const g=h.array;d=h.version;for(let m=0,v=g.length;m<v;m+=3){const _=g[m+0],y=g[m+1],x=g[m+2];c.push(_,y,y,x,x,_)}}else{if(u===void 0)return;{const g=u.array;d=u.version;for(let m=0,v=g.length/3-1;m<v;m+=3){const _=m+0,y=m+1,x=m+2;c.push(_,y,y,x,x,_)}}}const p=new(_x(c)?r0:lp)(c,1);p.version=d;const f=a.get(l);f&&e.remove(f),a.set(l,p)}return{get:function(l,c){return s[c.id]===!0||(c.addEventListener("dispose",n),s[c.id]=!0,t.memory.geometries++),c},update:function(l){const c=l.attributes;for(const u in c)e.update(c[u],i.ARRAY_BUFFER);const h=l.morphAttributes;for(const u in h){const d=h[u];for(let p=0,f=d.length;p<f;p++)e.update(d[p],i.ARRAY_BUFFER)}},getWireframeAttribute:function(l){const c=a.get(l);if(c){const h=l.index;h!==null&&c.version<h.version&&o(l)}else o(l);return a.get(l)}}}function i2(i,e,t){let r,s,a;function n(o,l,c){c!==0&&(i.drawElementsInstanced(r,l,s,o*a,c),t.update(l,r,c))}this.setMode=function(o){r=o},this.setIndex=function(o){s=o.type,a=o.bytesPerElement},this.render=function(o,l){i.drawElements(r,l,s,o*a),t.update(l,r,1)},this.renderInstances=n,this.renderMultiDraw=function(o,l,c){if(c===0)return;const h=e.get("WEBGL_multi_draw");if(h===null)for(let u=0;u<c;u++)this.render(o[u]/a,l[u]);else{h.multiDrawElementsWEBGL(r,l,0,s,o,0,c);let u=0;for(let d=0;d<c;d++)u+=l[d];t.update(u,r,1)}},this.renderMultiDrawInstances=function(o,l,c,h){if(c===0)return;const u=e.get("WEBGL_multi_draw");if(u===null)for(let d=0;d<o.length;d++)n(o[d]/a,l[d],h[d]);else{u.multiDrawElementsInstancedWEBGL(r,l,0,s,o,0,h,0,c);let d=0;for(let p=0;p<c;p++)d+=l[p];for(let p=0;p<h.length;p++)t.update(d,r,h[p])}}}function r2(i){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,r,s){switch(e.calls++,r){case i.TRIANGLES:e.triangles+=s*(t/3);break;case i.LINES:e.lines+=s*(t/2);break;case i.LINE_STRIP:e.lines+=s*(t-1);break;case i.LINE_LOOP:e.lines+=s*t;break;case i.POINTS:e.points+=s*t}}}}function s2(i,e,t){const r=new WeakMap,s=new qe;return{update:function(a,n,o){const l=a.morphTargetInfluences,c=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,h=c!==void 0?c.length:0;let u=r.get(n);if(u===void 0||u.count!==h){u!==void 0&&u.texture.dispose();const d=n.morphAttributes.position!==void 0,p=n.morphAttributes.normal!==void 0,f=n.morphAttributes.color!==void 0,g=n.morphAttributes.position||[],m=n.morphAttributes.normal||[],v=n.morphAttributes.color||[];let _=0;d===!0&&(_=1),p===!0&&(_=2),f===!0&&(_=3);let y=n.attributes.position.count*_,x=1;y>e.maxTextureSize&&(x=Math.ceil(y/e.maxTextureSize),y=e.maxTextureSize);const b=new Float32Array(y*x*4*h),M=new md(b,y,x,h);M.type=mr,M.needsUpdate=!0;const T=4*_;for(let E=0;E<h;E++){const C=g[E],N=m[E],D=v[E],A=y*x*4*E;for(let L=0;L<C.count;L++){const w=L*T;d===!0&&(s.fromBufferAttribute(C,L),b[A+w+0]=s.x,b[A+w+1]=s.y,b[A+w+2]=s.z,b[A+w+3]=0),p===!0&&(s.fromBufferAttribute(N,L),b[A+w+4]=s.x,b[A+w+5]=s.y,b[A+w+6]=s.z,b[A+w+7]=0),f===!0&&(s.fromBufferAttribute(D,L),b[A+w+8]=s.x,b[A+w+9]=s.y,b[A+w+10]=s.z,b[A+w+11]=D.itemSize===4?s.w:1)}}u={count:h,texture:M,size:new ne(y,x)},r.set(n,u),n.addEventListener("dispose",function E(){M.dispose(),r.delete(n),n.removeEventListener("dispose",E)})}if(a.isInstancedMesh===!0&&a.morphTexture!==null)o.getUniforms().setValue(i,"morphTexture",a.morphTexture,t);else{let d=0;for(let f=0;f<l.length;f++)d+=l[f];const p=n.morphTargetsRelative?1:1-d;o.getUniforms().setValue(i,"morphTargetBaseInfluence",p),o.getUniforms().setValue(i,"morphTargetInfluences",l)}o.getUniforms().setValue(i,"morphTargetsTexture",u.texture,t),o.getUniforms().setValue(i,"morphTargetsTextureSize",u.size)}}}function a2(i,e,t,r){let s=new WeakMap;function a(n){const o=n.target;o.removeEventListener("dispose",a),t.remove(o.instanceMatrix),o.instanceColor!==null&&t.remove(o.instanceColor)}return{update:function(n){const o=r.render.frame,l=n.geometry,c=e.get(n,l);if(s.get(c)!==o&&(e.update(c),s.set(c,o)),n.isInstancedMesh&&(n.hasEventListener("dispose",a)===!1&&n.addEventListener("dispose",a),s.get(n)!==o&&(t.update(n.instanceMatrix,i.ARRAY_BUFFER),n.instanceColor!==null&&t.update(n.instanceColor,i.ARRAY_BUFFER),s.set(n,o))),n.isSkinnedMesh){const h=n.skeleton;s.get(h)!==o&&(h.update(),s.set(h,o))}return c},dispose:function(){s=new WeakMap}}}class dh extends wt{constructor(e,t,r,s,a,n,o,l,c,h=1026){if(h!==el&&h!==Oa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&h===el&&(r=Vn),r===void 0&&h===Oa&&(r=Da),super(null,s,a,n,o,l,h,r,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:dt,this.minFilter=l!==void 0?l:dt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const Ex=new wt,Cx=new dh(1,1);Cx.compareFunction=515;const Rx=new md,Px=new Kf,Ix=new Dc,qv=[],Yv=[],Zv=new Float32Array(16),Kv=new Float32Array(9),Qv=new Float32Array(4);function bl(i,e,t){const r=i[0];if(r<=0||r>0)return i;const s=e*t;let a=qv[s];if(a===void 0&&(a=new Float32Array(s),qv[s]=a),e!==0){r.toArray(a,0);for(let n=1,o=0;n!==e;++n)o+=t,i[n].toArray(a,o)}return a}function pi(i,e){if(i.length!==e.length)return!1;for(let t=0,r=i.length;t<r;t++)if(i[t]!==e[t])return!1;return!0}function mi(i,e){for(let t=0,r=e.length;t<r;t++)i[t]=e[t]}function hp(i,e){let t=Yv[e];t===void 0&&(t=new Int32Array(e),Yv[e]=t);for(let r=0;r!==e;++r)t[r]=i.allocateTextureUnit();return t}function n2(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function o2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(pi(t,e))return;i.uniform2fv(this.addr,e),mi(t,e)}}function l2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)t[0]===e.r&&t[1]===e.g&&t[2]===e.b||(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(pi(t,e))return;i.uniform3fv(this.addr,e),mi(t,e)}}function c2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(pi(t,e))return;i.uniform4fv(this.addr,e),mi(t,e)}}function h2(i,e){const t=this.cache,r=e.elements;if(r===void 0){if(pi(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),mi(t,e)}else{if(pi(t,r))return;Qv.set(r),i.uniformMatrix2fv(this.addr,!1,Qv),mi(t,r)}}function u2(i,e){const t=this.cache,r=e.elements;if(r===void 0){if(pi(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),mi(t,e)}else{if(pi(t,r))return;Kv.set(r),i.uniformMatrix3fv(this.addr,!1,Kv),mi(t,r)}}function d2(i,e){const t=this.cache,r=e.elements;if(r===void 0){if(pi(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),mi(t,e)}else{if(pi(t,r))return;Zv.set(r),i.uniformMatrix4fv(this.addr,!1,Zv),mi(t,r)}}function p2(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function m2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(pi(t,e))return;i.uniform2iv(this.addr,e),mi(t,e)}}function f2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(pi(t,e))return;i.uniform3iv(this.addr,e),mi(t,e)}}function g2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(pi(t,e))return;i.uniform4iv(this.addr,e),mi(t,e)}}function v2(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function _2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(pi(t,e))return;i.uniform2uiv(this.addr,e),mi(t,e)}}function y2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(pi(t,e))return;i.uniform3uiv(this.addr,e),mi(t,e)}}function x2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(pi(t,e))return;i.uniform4uiv(this.addr,e),mi(t,e)}}function b2(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s);const a=this.type===i.SAMPLER_2D_SHADOW?Cx:Ex;t.setTexture2D(e||a,s)}function M2(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),t.setTexture3D(e||Px,s)}function w2(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),t.setTextureCube(e||Ix,s)}function S2(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),t.setTexture2DArray(e||Rx,s)}function T2(i,e){i.uniform1fv(this.addr,e)}function A2(i,e){const t=bl(e,this.size,2);i.uniform2fv(this.addr,t)}function E2(i,e){const t=bl(e,this.size,3);i.uniform3fv(this.addr,t)}function C2(i,e){const t=bl(e,this.size,4);i.uniform4fv(this.addr,t)}function R2(i,e){const t=bl(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function P2(i,e){const t=bl(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function I2(i,e){const t=bl(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function L2(i,e){i.uniform1iv(this.addr,e)}function N2(i,e){i.uniform2iv(this.addr,e)}function D2(i,e){i.uniform3iv(this.addr,e)}function O2(i,e){i.uniform4iv(this.addr,e)}function U2(i,e){i.uniform1uiv(this.addr,e)}function k2(i,e){i.uniform2uiv(this.addr,e)}function F2(i,e){i.uniform3uiv(this.addr,e)}function B2(i,e){i.uniform4uiv(this.addr,e)}function z2(i,e,t){const r=this.cache,s=e.length,a=hp(t,s);pi(r,a)||(i.uniform1iv(this.addr,a),mi(r,a));for(let n=0;n!==s;++n)t.setTexture2D(e[n]||Ex,a[n])}function V2(i,e,t){const r=this.cache,s=e.length,a=hp(t,s);pi(r,a)||(i.uniform1iv(this.addr,a),mi(r,a));for(let n=0;n!==s;++n)t.setTexture3D(e[n]||Px,a[n])}function H2(i,e,t){const r=this.cache,s=e.length,a=hp(t,s);pi(r,a)||(i.uniform1iv(this.addr,a),mi(r,a));for(let n=0;n!==s;++n)t.setTextureCube(e[n]||Ix,a[n])}function G2(i,e,t){const r=this.cache,s=e.length,a=hp(t,s);pi(r,a)||(i.uniform1iv(this.addr,a),mi(r,a));for(let n=0;n!==s;++n)t.setTexture2DArray(e[n]||Rx,a[n])}class j2{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=function(s){switch(s){case 5126:return n2;case 35664:return o2;case 35665:return l2;case 35666:return c2;case 35674:return h2;case 35675:return u2;case 35676:return d2;case 5124:case 35670:return p2;case 35667:case 35671:return m2;case 35668:case 35672:return f2;case 35669:case 35673:return g2;case 5125:return v2;case 36294:return _2;case 36295:return y2;case 36296:return x2;case 35678:case 36198:case 36298:case 36306:case 35682:return b2;case 35679:case 36299:case 36307:return M2;case 35680:case 36300:case 36308:case 36293:return w2;case 36289:case 36303:case 36311:case 36292:return S2}}(t.type)}}class W2{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(s){switch(s){case 5126:return T2;case 35664:return A2;case 35665:return E2;case 35666:return C2;case 35674:return R2;case 35675:return P2;case 35676:return I2;case 5124:case 35670:return L2;case 35667:case 35671:return N2;case 35668:case 35672:return D2;case 35669:case 35673:return O2;case 5125:return U2;case 36294:return k2;case 36295:return F2;case 36296:return B2;case 35678:case 36198:case 36298:case 36306:case 35682:return z2;case 35679:case 36299:case 36307:return V2;case 35680:case 36300:case 36308:case 36293:return H2;case 36289:case 36303:case 36311:case 36292:return G2}}(t.type)}}class X2{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const s=this.seq;for(let a=0,n=s.length;a!==n;++a){const o=s[a];o.setValue(e,t[o.id],r)}}}const om=/(\w+)(\])?(\[|\.)?/g;function Jv(i,e){i.seq.push(e),i.map[e.id]=e}function q2(i,e,t){const r=i.name,s=r.length;for(om.lastIndex=0;;){const a=om.exec(r),n=om.lastIndex;let o=a[1];const l=a[2]==="]",c=a[3];if(l&&(o|=0),c===void 0||c==="["&&n+2===s){Jv(t,c===void 0?new j2(o,i,e):new W2(o,i,e));break}{let h=t.map[o];h===void 0&&(h=new X2(o),Jv(t,h)),t=h}}}class id{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;++s){const a=e.getActiveUniform(t,s);q2(a,e.getUniformLocation(t,a.name),this)}}setValue(e,t,r,s){const a=this.map[t];a!==void 0&&a.setValue(e,r,s)}setOptional(e,t,r){const s=t[r];s!==void 0&&this.setValue(e,r,s)}static upload(e,t,r,s){for(let a=0,n=t.length;a!==n;++a){const o=t[a],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,s)}}static seqWithValue(e,t){const r=[];for(let s=0,a=e.length;s!==a;++s){const n=e[s];n.id in t&&r.push(n)}return r}}function $v(i,e,t){const r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}const Y2=37297;let Z2=0;function e_(i,e,t){const r=i.getShaderParameter(e,i.COMPILE_STATUS),s=i.getShaderInfoLog(e).trim();if(r&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const n=parseInt(a[1]);return t.toUpperCase()+`

`+s+`

`+function(o,l){const c=o.split(`
`),h=[],u=Math.max(l-6,0),d=Math.min(l+6,c.length);for(let p=u;p<d;p++){const f=p+1;h.push(`${f===l?">":" "} ${f}: ${c[p]}`)}return h.join(`
`)}(i.getShaderSource(e),n)}return s}function K2(i,e){const t=function(r){const s=ht.getPrimaries(ht.workingColorSpace),a=ht.getPrimaries(r);let n;switch(s===a?n="":s===Pc&&a===Rc?n="LinearDisplayP3ToLinearSRGB":s===Rc&&a===Pc&&(n="LinearSRGBToLinearDisplayP3"),r){case oi:case hh:return[n,"LinearTransferOETF"];case Tt:case np:return[n,"sRGBTransferOETF"];default:return[n,"LinearTransferOETF"]}}(e);return`vec4 ${i}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function Q2(i,e){let t;switch(e){case $d:t="Linear";break;case ep:t="Reinhard";break;case tp:t="OptimizedCineon";break;case ip:t="ACESFilmic";break;case rp:t="AgX";break;case jg:t="Neutral";break;case Gg:t="Custom";break;default:t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Il(i){return i!==""}function t_(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function i_(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const J2=/^[ \t]*#include +<([\w\d./]+)>/gm;function Jf(i){return i.replace(J2,eT)}const $2=new Map;function eT(i,e){let t=We[e];if(t===void 0){const r=$2.get(e);if(r===void 0)throw new Error("Can not resolve #include <"+e+">");t=We[r]}return Jf(t)}const tT=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function r_(i){return i.replace(tT,iT)}function iT(i,e,t,r){let s="";for(let a=parseInt(e);a<parseInt(t);a++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return s}function s_(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function rT(i,e,t,r){const s=i.getContext(),a=t.defines;let n=t.vertexShader,o=t.fragmentShader;const l=function(D){let A="SHADOWMAP_TYPE_BASIC";return D.shadowMapType===Yd?A="SHADOWMAP_TYPE_PCF":D.shadowMapType===Hg?A="SHADOWMAP_TYPE_PCF_SOFT":D.shadowMapType===Vr&&(A="SHADOWMAP_TYPE_VSM"),A}(t),c=function(D){let A="ENVMAP_TYPE_CUBE";if(D.envMap)switch(D.envMapMode){case Ws:case La:A="ENVMAP_TYPE_CUBE";break;case xl:A="ENVMAP_TYPE_CUBE_UV"}return A}(t),h=function(D){let A="ENVMAP_MODE_REFLECTION";return D.envMap&&D.envMapMode===La&&(A="ENVMAP_MODE_REFRACTION"),A}(t),u=function(D){let A="ENVMAP_BLENDING_NONE";if(D.envMap)switch(D.combine){case ch:A="ENVMAP_BLENDING_MULTIPLY";break;case mx:A="ENVMAP_BLENDING_MIX";break;case fx:A="ENVMAP_BLENDING_ADD"}return A}(t),d=function(D){const A=D.envMapCubeUVHeight;if(A===null)return null;const L=Math.log2(A)-2,w=1/A;return{texelWidth:1/(3*Math.max(Math.pow(2,L),112)),texelHeight:w,maxMip:L}}(t),p=function(D){return[D.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",D.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Il).join(`
`)}(t),f=function(D){const A=[];for(const L in D){const w=D[L];w!==!1&&A.push("#define "+L+" "+w)}return A.join(`
`)}(a),g=s.createProgram();let m,v,_=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(Il).join(`
`),m.length>0&&(m+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(Il).join(`
`),v.length>0&&(v+=`
`)):(m=[s_(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Il).join(`
`),v=[s_(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ms?"#define TONE_MAPPING":"",t.toneMapping!==ms?We.tonemapping_pars_fragment:"",t.toneMapping!==ms?Q2("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",We.colorspace_pars_fragment,K2("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Il).join(`
`)),n=Jf(n),n=t_(n,t),n=i_(n,t),o=Jf(o),o=t_(o,t),o=i_(o,t),n=r_(n),o=r_(o),t.isRawShaderMaterial!==!0&&(_=`#version 300 es
`,m=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["#define varying in",t.glslVersion===Yf?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Yf?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const y=_+m+n,x=_+v+o,b=$v(s,s.VERTEX_SHADER,y),M=$v(s,s.FRAGMENT_SHADER,x);function T(D){if(i.debug.checkShaderErrors){const A=s.getProgramInfoLog(g).trim(),L=s.getShaderInfoLog(b).trim(),w=s.getShaderInfoLog(M).trim();let B=!0,$=!0;s.getProgramParameter(g,s.LINK_STATUS)===!1?(B=!1,typeof i.debug.onShaderError=="function"?i.debug.onShaderError(s,g,b,M):(e_(s,b,"vertex"),e_(s,M,"fragment"))):A!==""||L!==""&&w!==""||($=!1),$&&(D.diagnostics={runnable:B,programLog:A,vertexShader:{log:L,prefix:m},fragmentShader:{log:w,prefix:v}})}s.deleteShader(b),s.deleteShader(M),E=new id(s,g),C=function(A,L){const w={},B=A.getProgramParameter(L,A.ACTIVE_ATTRIBUTES);for(let $=0;$<B;$++){const K=A.getActiveAttrib(L,$),ae=K.name;let se=1;K.type===A.FLOAT_MAT2&&(se=2),K.type===A.FLOAT_MAT3&&(se=3),K.type===A.FLOAT_MAT4&&(se=4),w[ae]={type:K.type,location:A.getAttribLocation(L,ae),locationSize:se}}return w}(s,g)}let E,C;s.attachShader(g,b),s.attachShader(g,M),t.index0AttributeName!==void 0?s.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(g,0,"position"),s.linkProgram(g),this.getUniforms=function(){return E===void 0&&T(this),E},this.getAttributes=function(){return C===void 0&&T(this),C};let N=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return N===!1&&(N=s.getProgramParameter(g,Y2)),N},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Z2++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=b,this.fragmentShader=M,this}let sT=0;class aT{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,s=this._getShaderStage(t),a=this._getShaderStage(r),n=this._getShaderCacheForMaterial(e);return n.has(s)===!1&&(n.add(s),s.usedTimes++),n.has(a)===!1&&(n.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new nT(e),t.set(e,r)),r}}class nT{constructor(e){this.id=sT++,this.code=e,this.usedTimes=0}}function oT(i,e,t,r,s,a,n){const o=new op,l=new aT,c=new Set,h=[],u=s.logarithmicDepthBuffer,d=s.vertexTextures;let p=s.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(m){return c.add(m),m===0?"uv":`uv${m}`}return{getParameters:function(m,v,_,y,x){const b=y.fog,M=x.geometry,T=m.isMeshStandardMaterial?y.environment:null,E=(m.isMeshStandardMaterial?t:e).get(m.envMap||T),C=E&&E.mapping===xl?E.image.height:null,N=f[m.type];m.precision!==null&&(p=s.getMaxPrecision(m.precision),m.precision);const D=M.morphAttributes.position||M.morphAttributes.normal||M.morphAttributes.color,A=D!==void 0?D.length:0;let L,w,B,$,K=0;if(M.morphAttributes.position!==void 0&&(K=1),M.morphAttributes.normal!==void 0&&(K=2),M.morphAttributes.color!==void 0&&(K=3),N){const Lt=Vi[N];L=Lt.vertexShader,w=Lt.fragmentShader}else L=m.vertexShader,w=m.fragmentShader,l.update(m),B=l.getVertexShaderID(m),$=l.getFragmentShaderID(m);const ae=i.getRenderTarget(),se=x.isInstancedMesh===!0,me=x.isBatchedMesh===!0,H=!!m.map,W=!!m.matcap,ce=!!E,te=!!m.aoMap,k=!!m.lightMap,z=!!m.bumpMap,ee=!!m.normalMap,re=!!m.displacementMap,j=!!m.emissiveMap,Q=!!m.metalnessMap,O=!!m.roughnessMap,J=m.anisotropy>0,Z=m.clearcoat>0,S=m.dispersion>0,F=m.iridescence>0,X=m.sheen>0,U=m.transmission>0,P=J&&!!m.anisotropyMap,I=Z&&!!m.clearcoatMap,V=Z&&!!m.clearcoatNormalMap,Y=Z&&!!m.clearcoatRoughnessMap,q=F&&!!m.iridescenceMap,pe=F&&!!m.iridescenceThicknessMap,_e=X&&!!m.sheenColorMap,le=X&&!!m.sheenRoughnessMap,xe=!!m.specularMap,Pe=!!m.specularColorMap,Re=!!m.specularIntensityMap,Ee=U&&!!m.transmissionMap,$e=U&&!!m.thicknessMap,ke=!!m.gradientMap,vt=!!m.alphaMap,st=m.alphaTest>0,qi=!!m.alphaHash,ie=!!m.extensions;let Ui=ms;m.toneMapped&&(ae!==null&&ae.isXRRenderTarget!==!0||(Ui=i.toneMapping));const Jr={shaderID:N,shaderType:m.type,shaderName:m.name,vertexShader:L,fragmentShader:w,defines:m.defines,customVertexShaderID:B,customFragmentShaderID:$,isRawShaderMaterial:m.isRawShaderMaterial===!0,glslVersion:m.glslVersion,precision:p,batching:me,batchingColor:me&&x._colorsTexture!==null,instancing:se,instancingColor:se&&x.instanceColor!==null,instancingMorph:se&&x.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:ae===null?i.outputColorSpace:ae.isXRRenderTarget===!0?ae.texture.colorSpace:oi,alphaToCoverage:!!m.alphaToCoverage,map:H,matcap:W,envMap:ce,envMapMode:ce&&E.mapping,envMapCubeUVHeight:C,aoMap:te,lightMap:k,bumpMap:z,normalMap:ee,displacementMap:d&&re,emissiveMap:j,normalMapObjectSpace:ee&&m.normalMapType===1,normalMapTangentSpace:ee&&m.normalMapType===0,metalnessMap:Q,roughnessMap:O,anisotropy:J,anisotropyMap:P,clearcoat:Z,clearcoatMap:I,clearcoatNormalMap:V,clearcoatRoughnessMap:Y,dispersion:S,iridescence:F,iridescenceMap:q,iridescenceThicknessMap:pe,sheen:X,sheenColorMap:_e,sheenRoughnessMap:le,specularMap:xe,specularColorMap:Pe,specularIntensityMap:Re,transmission:U,transmissionMap:Ee,thicknessMap:$e,gradientMap:ke,opaque:m.transparent===!1&&m.blending===1&&m.alphaToCoverage===!1,alphaMap:vt,alphaTest:st,alphaHash:qi,combine:m.combine,mapUv:H&&g(m.map.channel),aoMapUv:te&&g(m.aoMap.channel),lightMapUv:k&&g(m.lightMap.channel),bumpMapUv:z&&g(m.bumpMap.channel),normalMapUv:ee&&g(m.normalMap.channel),displacementMapUv:re&&g(m.displacementMap.channel),emissiveMapUv:j&&g(m.emissiveMap.channel),metalnessMapUv:Q&&g(m.metalnessMap.channel),roughnessMapUv:O&&g(m.roughnessMap.channel),anisotropyMapUv:P&&g(m.anisotropyMap.channel),clearcoatMapUv:I&&g(m.clearcoatMap.channel),clearcoatNormalMapUv:V&&g(m.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Y&&g(m.clearcoatRoughnessMap.channel),iridescenceMapUv:q&&g(m.iridescenceMap.channel),iridescenceThicknessMapUv:pe&&g(m.iridescenceThicknessMap.channel),sheenColorMapUv:_e&&g(m.sheenColorMap.channel),sheenRoughnessMapUv:le&&g(m.sheenRoughnessMap.channel),specularMapUv:xe&&g(m.specularMap.channel),specularColorMapUv:Pe&&g(m.specularColorMap.channel),specularIntensityMapUv:Re&&g(m.specularIntensityMap.channel),transmissionMapUv:Ee&&g(m.transmissionMap.channel),thicknessMapUv:$e&&g(m.thicknessMap.channel),alphaMapUv:vt&&g(m.alphaMap.channel),vertexTangents:!!M.attributes.tangent&&(ee||J),vertexColors:m.vertexColors,vertexAlphas:m.vertexColors===!0&&!!M.attributes.color&&M.attributes.color.itemSize===4,pointsUvs:x.isPoints===!0&&!!M.attributes.uv&&(H||vt),fog:!!b,useFog:m.fog===!0,fogExp2:!!b&&b.isFogExp2,flatShading:m.flatShading===!0,sizeAttenuation:m.sizeAttenuation===!0,logarithmicDepthBuffer:u,skinning:x.isSkinnedMesh===!0,morphTargets:M.morphAttributes.position!==void 0,morphNormals:M.morphAttributes.normal!==void 0,morphColors:M.morphAttributes.color!==void 0,morphTargetsCount:A,morphTextureStride:K,numDirLights:v.directional.length,numPointLights:v.point.length,numSpotLights:v.spot.length,numSpotLightMaps:v.spotLightMap.length,numRectAreaLights:v.rectArea.length,numHemiLights:v.hemi.length,numDirLightShadows:v.directionalShadowMap.length,numPointLightShadows:v.pointShadowMap.length,numSpotLightShadows:v.spotShadowMap.length,numSpotLightShadowsWithMaps:v.numSpotLightShadowsWithMaps,numLightProbes:v.numLightProbes,numClippingPlanes:n.numPlanes,numClipIntersection:n.numIntersection,dithering:m.dithering,shadowMapEnabled:i.shadowMap.enabled&&_.length>0,shadowMapType:i.shadowMap.type,toneMapping:Ui,decodeVideoTexture:H&&m.map.isVideoTexture===!0&&ht.getTransfer(m.map.colorSpace)===St,premultipliedAlpha:m.premultipliedAlpha,doubleSided:m.side===It,flipSided:m.side===Di,useDepthPacking:m.depthPacking>=0,depthPacking:m.depthPacking||0,index0AttributeName:m.index0AttributeName,extensionClipCullDistance:ie&&m.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:ie&&m.extensions.multiDraw===!0&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:m.customProgramCacheKey()};return Jr.vertexUv1s=c.has(1),Jr.vertexUv2s=c.has(2),Jr.vertexUv3s=c.has(3),c.clear(),Jr},getProgramCacheKey:function(m){const v=[];if(m.shaderID?v.push(m.shaderID):(v.push(m.customVertexShaderID),v.push(m.customFragmentShaderID)),m.defines!==void 0)for(const _ in m.defines)v.push(_),v.push(m.defines[_]);return m.isRawShaderMaterial===!1&&(function(_,y){_.push(y.precision),_.push(y.outputColorSpace),_.push(y.envMapMode),_.push(y.envMapCubeUVHeight),_.push(y.mapUv),_.push(y.alphaMapUv),_.push(y.lightMapUv),_.push(y.aoMapUv),_.push(y.bumpMapUv),_.push(y.normalMapUv),_.push(y.displacementMapUv),_.push(y.emissiveMapUv),_.push(y.metalnessMapUv),_.push(y.roughnessMapUv),_.push(y.anisotropyMapUv),_.push(y.clearcoatMapUv),_.push(y.clearcoatNormalMapUv),_.push(y.clearcoatRoughnessMapUv),_.push(y.iridescenceMapUv),_.push(y.iridescenceThicknessMapUv),_.push(y.sheenColorMapUv),_.push(y.sheenRoughnessMapUv),_.push(y.specularMapUv),_.push(y.specularColorMapUv),_.push(y.specularIntensityMapUv),_.push(y.transmissionMapUv),_.push(y.thicknessMapUv),_.push(y.combine),_.push(y.fogExp2),_.push(y.sizeAttenuation),_.push(y.morphTargetsCount),_.push(y.morphAttributeCount),_.push(y.numDirLights),_.push(y.numPointLights),_.push(y.numSpotLights),_.push(y.numSpotLightMaps),_.push(y.numHemiLights),_.push(y.numRectAreaLights),_.push(y.numDirLightShadows),_.push(y.numPointLightShadows),_.push(y.numSpotLightShadows),_.push(y.numSpotLightShadowsWithMaps),_.push(y.numLightProbes),_.push(y.shadowMapType),_.push(y.toneMapping),_.push(y.numClippingPlanes),_.push(y.numClipIntersection),_.push(y.depthPacking)}(v,m),function(_,y){o.disableAll(),y.supportsVertexTextures&&o.enable(0),y.instancing&&o.enable(1),y.instancingColor&&o.enable(2),y.instancingMorph&&o.enable(3),y.matcap&&o.enable(4),y.envMap&&o.enable(5),y.normalMapObjectSpace&&o.enable(6),y.normalMapTangentSpace&&o.enable(7),y.clearcoat&&o.enable(8),y.iridescence&&o.enable(9),y.alphaTest&&o.enable(10),y.vertexColors&&o.enable(11),y.vertexAlphas&&o.enable(12),y.vertexUv1s&&o.enable(13),y.vertexUv2s&&o.enable(14),y.vertexUv3s&&o.enable(15),y.vertexTangents&&o.enable(16),y.anisotropy&&o.enable(17),y.alphaHash&&o.enable(18),y.batching&&o.enable(19),y.dispersion&&o.enable(20),y.batchingColor&&o.enable(21),_.push(o.mask),o.disableAll(),y.fog&&o.enable(0),y.useFog&&o.enable(1),y.flatShading&&o.enable(2),y.logarithmicDepthBuffer&&o.enable(3),y.skinning&&o.enable(4),y.morphTargets&&o.enable(5),y.morphNormals&&o.enable(6),y.morphColors&&o.enable(7),y.premultipliedAlpha&&o.enable(8),y.shadowMapEnabled&&o.enable(9),y.doubleSided&&o.enable(10),y.flipSided&&o.enable(11),y.useDepthPacking&&o.enable(12),y.dithering&&o.enable(13),y.transmission&&o.enable(14),y.sheen&&o.enable(15),y.opaque&&o.enable(16),y.pointsUvs&&o.enable(17),y.decodeVideoTexture&&o.enable(18),y.alphaToCoverage&&o.enable(19),_.push(o.mask)}(v,m),v.push(i.outputColorSpace)),v.push(m.customProgramCacheKey),v.join()},getUniforms:function(m){const v=f[m.type];let _;if(v){const y=Vi[v];_=ai.clone(y.uniforms)}else _=m.uniforms;return _},acquireProgram:function(m,v){let _;for(let y=0,x=h.length;y<x;y++){const b=h[y];if(b.cacheKey===v){_=b,++_.usedTimes;break}}return _===void 0&&(_=new rT(i,v,m,a),h.push(_)),_},releaseProgram:function(m){if(--m.usedTimes==0){const v=h.indexOf(m);h[v]=h[h.length-1],h.pop(),m.destroy()}},releaseShaderCache:function(m){l.remove(m)},programs:h,dispose:function(){l.dispose()}}}function lT(){let i=new WeakMap;return{get:function(e){let t=i.get(e);return t===void 0&&(t={},i.set(e,t)),t},remove:function(e){i.delete(e)},update:function(e,t,r){i.get(e)[t]=r},dispose:function(){i=new WeakMap}}}function cT(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function a_(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function n_(){const i=[];let e=0;const t=[],r=[],s=[];function a(n,o,l,c,h,u){let d=i[e];return d===void 0?(d={id:n.id,object:n,geometry:o,material:l,groupOrder:c,renderOrder:n.renderOrder,z:h,group:u},i[e]=d):(d.id=n.id,d.object=n,d.geometry=o,d.material=l,d.groupOrder=c,d.renderOrder=n.renderOrder,d.z=h,d.group=u),e++,d}return{opaque:t,transmissive:r,transparent:s,init:function(){e=0,t.length=0,r.length=0,s.length=0},push:function(n,o,l,c,h,u){const d=a(n,o,l,c,h,u);l.transmission>0?r.push(d):l.transparent===!0?s.push(d):t.push(d)},unshift:function(n,o,l,c,h,u){const d=a(n,o,l,c,h,u);l.transmission>0?r.unshift(d):l.transparent===!0?s.unshift(d):t.unshift(d)},finish:function(){for(let n=e,o=i.length;n<o;n++){const l=i[n];if(l.id===null)break;l.id=null,l.object=null,l.geometry=null,l.material=null,l.group=null}},sort:function(n,o){t.length>1&&t.sort(n||cT),r.length>1&&r.sort(o||a_),s.length>1&&s.sort(o||a_)}}}function hT(){let i=new WeakMap;return{get:function(e,t){const r=i.get(e);let s;return r===void 0?(s=new n_,i.set(e,[s])):t>=r.length?(s=new n_,r.push(s)):s=r[t],s},dispose:function(){i=new WeakMap}}}function uT(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new R,color:new fe};break;case"SpotLight":t={position:new R,direction:new R,color:new fe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new R,color:new fe,distance:0,decay:0};break;case"HemisphereLight":t={direction:new R,skyColor:new fe,groundColor:new fe};break;case"RectAreaLight":t={color:new fe,position:new R,halfWidth:new R,halfHeight:new R}}return i[e.id]=t,t}}}let dT=0;function pT(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function mT(i){const e=new uT,t=function(){const o={};return{get:function(l){if(o[l.id]!==void 0)return o[l.id];let c;switch(l.type){case"DirectionalLight":case"SpotLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne};break;case"PointLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne,shadowCameraNear:1,shadowCameraFar:1e3}}return o[l.id]=c,c}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)r.probe.push(new R);const s=new R,a=new Me,n=new Me;return{setup:function(o){let l=0,c=0,h=0;for(let T=0;T<9;T++)r.probe[T].set(0,0,0);let u=0,d=0,p=0,f=0,g=0,m=0,v=0,_=0,y=0,x=0,b=0;o.sort(pT);for(let T=0,E=o.length;T<E;T++){const C=o[T],N=C.color,D=C.intensity,A=C.distance,L=C.shadow&&C.shadow.map?C.shadow.map.texture:null;if(C.isAmbientLight)l+=N.r*D,c+=N.g*D,h+=N.b*D;else if(C.isLightProbe){for(let w=0;w<9;w++)r.probe[w].addScaledVector(C.sh.coefficients[w],D);b++}else if(C.isDirectionalLight){const w=e.get(C);if(w.color.copy(C.color).multiplyScalar(C.intensity),C.castShadow){const B=C.shadow,$=t.get(C);$.shadowBias=B.bias,$.shadowNormalBias=B.normalBias,$.shadowRadius=B.radius,$.shadowMapSize=B.mapSize,r.directionalShadow[u]=$,r.directionalShadowMap[u]=L,r.directionalShadowMatrix[u]=C.shadow.matrix,m++}r.directional[u]=w,u++}else if(C.isSpotLight){const w=e.get(C);w.position.setFromMatrixPosition(C.matrixWorld),w.color.copy(N).multiplyScalar(D),w.distance=A,w.coneCos=Math.cos(C.angle),w.penumbraCos=Math.cos(C.angle*(1-C.penumbra)),w.decay=C.decay,r.spot[p]=w;const B=C.shadow;if(C.map&&(r.spotLightMap[y]=C.map,y++,B.updateMatrices(C),C.castShadow&&x++),r.spotLightMatrix[p]=B.matrix,C.castShadow){const $=t.get(C);$.shadowBias=B.bias,$.shadowNormalBias=B.normalBias,$.shadowRadius=B.radius,$.shadowMapSize=B.mapSize,r.spotShadow[p]=$,r.spotShadowMap[p]=L,_++}p++}else if(C.isRectAreaLight){const w=e.get(C);w.color.copy(N).multiplyScalar(D),w.halfWidth.set(.5*C.width,0,0),w.halfHeight.set(0,.5*C.height,0),r.rectArea[f]=w,f++}else if(C.isPointLight){const w=e.get(C);if(w.color.copy(C.color).multiplyScalar(C.intensity),w.distance=C.distance,w.decay=C.decay,C.castShadow){const B=C.shadow,$=t.get(C);$.shadowBias=B.bias,$.shadowNormalBias=B.normalBias,$.shadowRadius=B.radius,$.shadowMapSize=B.mapSize,$.shadowCameraNear=B.camera.near,$.shadowCameraFar=B.camera.far,r.pointShadow[d]=$,r.pointShadowMap[d]=L,r.pointShadowMatrix[d]=C.shadow.matrix,v++}r.point[d]=w,d++}else if(C.isHemisphereLight){const w=e.get(C);w.skyColor.copy(C.color).multiplyScalar(D),w.groundColor.copy(C.groundColor).multiplyScalar(D),r.hemi[g]=w,g++}}f>0&&(i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Te.LTC_FLOAT_1,r.rectAreaLTC2=Te.LTC_FLOAT_2):(r.rectAreaLTC1=Te.LTC_HALF_1,r.rectAreaLTC2=Te.LTC_HALF_2)),r.ambient[0]=l,r.ambient[1]=c,r.ambient[2]=h;const M=r.hash;M.directionalLength===u&&M.pointLength===d&&M.spotLength===p&&M.rectAreaLength===f&&M.hemiLength===g&&M.numDirectionalShadows===m&&M.numPointShadows===v&&M.numSpotShadows===_&&M.numSpotMaps===y&&M.numLightProbes===b||(r.directional.length=u,r.spot.length=p,r.rectArea.length=f,r.point.length=d,r.hemi.length=g,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=v,r.pointShadowMap.length=v,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=v,r.spotLightMatrix.length=_+y-x,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=x,r.numLightProbes=b,M.directionalLength=u,M.pointLength=d,M.spotLength=p,M.rectAreaLength=f,M.hemiLength=g,M.numDirectionalShadows=m,M.numPointShadows=v,M.numSpotShadows=_,M.numSpotMaps=y,M.numLightProbes=b,r.version=dT++)},setupView:function(o,l){let c=0,h=0,u=0,d=0,p=0;const f=l.matrixWorldInverse;for(let g=0,m=o.length;g<m;g++){const v=o[g];if(v.isDirectionalLight){const _=r.directional[c];_.direction.setFromMatrixPosition(v.matrixWorld),s.setFromMatrixPosition(v.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(f),c++}else if(v.isSpotLight){const _=r.spot[u];_.position.setFromMatrixPosition(v.matrixWorld),_.position.applyMatrix4(f),_.direction.setFromMatrixPosition(v.matrixWorld),s.setFromMatrixPosition(v.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(f),u++}else if(v.isRectAreaLight){const _=r.rectArea[d];_.position.setFromMatrixPosition(v.matrixWorld),_.position.applyMatrix4(f),n.identity(),a.copy(v.matrixWorld),a.premultiply(f),n.extractRotation(a),_.halfWidth.set(.5*v.width,0,0),_.halfHeight.set(0,.5*v.height,0),_.halfWidth.applyMatrix4(n),_.halfHeight.applyMatrix4(n),d++}else if(v.isPointLight){const _=r.point[h];_.position.setFromMatrixPosition(v.matrixWorld),_.position.applyMatrix4(f),h++}else if(v.isHemisphereLight){const _=r.hemi[p];_.direction.setFromMatrixPosition(v.matrixWorld),_.direction.transformDirection(f),p++}}},state:r}}function o_(i){const e=new mT(i),t=[],r=[],s={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(a){s.camera=a,t.length=0,r.length=0},state:s,setupLights:function(){e.setup(t)},setupLightsView:function(a){e.setupView(t,a)},pushLight:function(a){t.push(a)},pushShadow:function(a){r.push(a)}}}function fT(i){let e=new WeakMap;return{get:function(t,r=0){const s=e.get(t);let a;return s===void 0?(a=new o_(i),e.set(t,[a])):r>=s.length?(a=new o_(i),s.push(a)):a=s[r],a},dispose:function(){e=new WeakMap}}}class up extends ti{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class a0 extends ti{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function gT(i,e,t){let r=new uh;const s=new ne,a=new ne,n=new qe,o=new up({depthPacking:t0}),l=new a0,c={},h=t.maxTextureSize,u={[Ir]:Di,[Di]:Ir,[It]:It},d=new ct({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ne},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Oe;f.setAttribute("position",new tt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new ye(f,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Yd;let v=this.type;function _(M,T){const E=e.update(g);d.defines.VSM_SAMPLES!==M.blurSamples&&(d.defines.VSM_SAMPLES=M.blurSamples,p.defines.VSM_SAMPLES=M.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),M.mapPass===null&&(M.mapPass=new ft(s.x,s.y)),d.uniforms.shadow_pass.value=M.map.texture,d.uniforms.resolution.value=M.mapSize,d.uniforms.radius.value=M.radius,i.setRenderTarget(M.mapPass),i.clear(),i.renderBufferDirect(T,null,E,d,g,null),p.uniforms.shadow_pass.value=M.mapPass.texture,p.uniforms.resolution.value=M.mapSize,p.uniforms.radius.value=M.radius,i.setRenderTarget(M.map),i.clear(),i.renderBufferDirect(T,null,E,p,g,null)}function y(M,T,E,C){let N=null;const D=E.isPointLight===!0?M.customDistanceMaterial:M.customDepthMaterial;if(D!==void 0)N=D;else if(N=E.isPointLight===!0?l:o,i.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){const A=N.uuid,L=T.uuid;let w=c[A];w===void 0&&(w={},c[A]=w);let B=w[L];B===void 0&&(B=N.clone(),w[L]=B,T.addEventListener("dispose",b)),N=B}return N.visible=T.visible,N.wireframe=T.wireframe,N.side=C===Vr?T.shadowSide!==null?T.shadowSide:T.side:T.shadowSide!==null?T.shadowSide:u[T.side],N.alphaMap=T.alphaMap,N.alphaTest=T.alphaTest,N.map=T.map,N.clipShadows=T.clipShadows,N.clippingPlanes=T.clippingPlanes,N.clipIntersection=T.clipIntersection,N.displacementMap=T.displacementMap,N.displacementScale=T.displacementScale,N.displacementBias=T.displacementBias,N.wireframeLinewidth=T.wireframeLinewidth,N.linewidth=T.linewidth,E.isPointLight===!0&&N.isMeshDistanceMaterial===!0&&(i.properties.get(N).light=E),N}function x(M,T,E,C,N){if(M.visible===!1)return;if(M.layers.test(T.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&N===Vr)&&(!M.frustumCulled||r.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,M.matrixWorld);const A=e.update(M),L=M.material;if(Array.isArray(L)){const w=A.groups;for(let B=0,$=w.length;B<$;B++){const K=w[B],ae=L[K.materialIndex];if(ae&&ae.visible){const se=y(M,ae,C,N);M.onBeforeShadow(i,M,T,E,A,se,K),i.renderBufferDirect(E,null,A,se,M,K),M.onAfterShadow(i,M,T,E,A,se,K)}}}else if(L.visible){const w=y(M,L,C,N);M.onBeforeShadow(i,M,T,E,A,w,null),i.renderBufferDirect(E,null,A,w,M,null),M.onAfterShadow(i,M,T,E,A,w,null)}}const D=M.children;for(let A=0,L=D.length;A<L;A++)x(D[A],T,E,C,N)}function b(M){M.target.removeEventListener("dispose",b);for(const T in c){const E=c[T],C=M.target.uuid;C in E&&(E[C].dispose(),delete E[C])}}this.render=function(M,T,E){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||M.length===0)return;const C=i.getRenderTarget(),N=i.getActiveCubeFace(),D=i.getActiveMipmapLevel(),A=i.state;A.setBlending(0),A.buffers.color.setClear(1,1,1,1),A.buffers.depth.setTest(!0),A.setScissorTest(!1);const L=v!==Vr&&this.type===Vr,w=v===Vr&&this.type!==Vr;for(let B=0,$=M.length;B<$;B++){const K=M[B],ae=K.shadow;if(ae===void 0||ae.autoUpdate===!1&&ae.needsUpdate===!1)continue;s.copy(ae.mapSize);const se=ae.getFrameExtents();if(s.multiply(se),a.copy(ae.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(a.x=Math.floor(h/se.x),s.x=a.x*se.x,ae.mapSize.x=a.x),s.y>h&&(a.y=Math.floor(h/se.y),s.y=a.y*se.y,ae.mapSize.y=a.y)),ae.map===null||L===!0||w===!0){const H=this.type!==Vr?{minFilter:dt,magFilter:dt}:{};ae.map!==null&&ae.map.dispose(),ae.map=new ft(s.x,s.y,H),ae.map.texture.name=K.name+".shadowMap",ae.camera.updateProjectionMatrix()}i.setRenderTarget(ae.map),i.clear();const me=ae.getViewportCount();for(let H=0;H<me;H++){const W=ae.getViewport(H);n.set(a.x*W.x,a.y*W.y,a.x*W.z,a.y*W.w),A.viewport(n),ae.updateMatrices(K,H),r=ae.getFrustum(),x(T,E,ae.camera,K,this.type)}ae.isPointLightShadow!==!0&&this.type===Vr&&_(ae,E),ae.needsUpdate=!1}v=this.type,m.needsUpdate=!1,i.setRenderTarget(C,N,D)}}function vT(i){const e=new function(){let O=!1;const J=new qe;let Z=null;const S=new qe(0,0,0,0);return{setMask:function(F){Z===F||O||(i.colorMask(F,F,F,F),Z=F)},setLocked:function(F){O=F},setClear:function(F,X,U,P,I){I===!0&&(F*=P,X*=P,U*=P),J.set(F,X,U,P),S.equals(J)===!1&&(i.clearColor(F,X,U,P),S.copy(J))},reset:function(){O=!1,Z=null,S.set(-1,0,0,0)}}},t=new function(){let O=!1,J=null,Z=null,S=null;return{setTest:function(F){F?ce(i.DEPTH_TEST):te(i.DEPTH_TEST)},setMask:function(F){J===F||O||(i.depthMask(F),J=F)},setFunc:function(F){if(Z!==F){switch(F){case 0:i.depthFunc(i.NEVER);break;case 1:i.depthFunc(i.ALWAYS);break;case 2:i.depthFunc(i.LESS);break;case 3:default:i.depthFunc(i.LEQUAL);break;case 4:i.depthFunc(i.EQUAL);break;case 5:i.depthFunc(i.GEQUAL);break;case 6:i.depthFunc(i.GREATER);break;case 7:i.depthFunc(i.NOTEQUAL)}Z=F}},setLocked:function(F){O=F},setClear:function(F){S!==F&&(i.clearDepth(F),S=F)},reset:function(){O=!1,J=null,Z=null,S=null}}},r=new function(){let O=!1,J=null,Z=null,S=null,F=null,X=null,U=null,P=null,I=null;return{setTest:function(V){O||(V?ce(i.STENCIL_TEST):te(i.STENCIL_TEST))},setMask:function(V){J===V||O||(i.stencilMask(V),J=V)},setFunc:function(V,Y,q){Z===V&&S===Y&&F===q||(i.stencilFunc(V,Y,q),Z=V,S=Y,F=q)},setOp:function(V,Y,q){X===V&&U===Y&&P===q||(i.stencilOp(V,Y,q),X=V,U=Y,P=q)},setLocked:function(V){O=V},setClear:function(V){I!==V&&(i.clearStencil(V),I=V)},reset:function(){O=!1,J=null,Z=null,S=null,F=null,X=null,U=null,P=null,I=null}}},s=new WeakMap,a=new WeakMap;let n={},o={},l=new WeakMap,c=[],h=null,u=!1,d=null,p=null,f=null,g=null,m=null,v=null,_=null,y=new fe(0,0,0),x=0,b=!1,M=null,T=null,E=null,C=null,N=null;const D=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let A=!1,L=0;const w=i.getParameter(i.VERSION);w.indexOf("WebGL")!==-1?(L=parseFloat(/^WebGL (\d)/.exec(w)[1]),A=L>=1):w.indexOf("OpenGL ES")!==-1&&(L=parseFloat(/^OpenGL ES (\d)/.exec(w)[1]),A=L>=2);let B=null,$={};const K=i.getParameter(i.SCISSOR_BOX),ae=i.getParameter(i.VIEWPORT),se=new qe().fromArray(K),me=new qe().fromArray(ae);function H(O,J,Z,S){const F=new Uint8Array(4),X=i.createTexture();i.bindTexture(O,X),i.texParameteri(O,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(O,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let U=0;U<Z;U++)O===i.TEXTURE_3D||O===i.TEXTURE_2D_ARRAY?i.texImage3D(J,0,i.RGBA,1,1,S,0,i.RGBA,i.UNSIGNED_BYTE,F):i.texImage2D(J+U,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,F);return X}const W={};function ce(O){n[O]!==!0&&(i.enable(O),n[O]=!0)}function te(O){n[O]!==!1&&(i.disable(O),n[O]=!1)}W[i.TEXTURE_2D]=H(i.TEXTURE_2D,i.TEXTURE_2D,1),W[i.TEXTURE_CUBE_MAP]=H(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),W[i.TEXTURE_2D_ARRAY]=H(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),W[i.TEXTURE_3D]=H(i.TEXTURE_3D,i.TEXTURE_3D,1,1),e.setClear(0,0,0,1),t.setClear(1),r.setClear(0),ce(i.DEPTH_TEST),t.setFunc(3),re(!1),j(1),ce(i.CULL_FACE),ee(0);const k={[ur]:i.FUNC_ADD,[pS]:i.FUNC_SUBTRACT,[mS]:i.FUNC_REVERSE_SUBTRACT};k[103]=i.MIN,k[104]=i.MAX;const z={[Qo]:i.ZERO,[nh]:i.ONE,[Zd]:i.SRC_COLOR,[Pa]:i.SRC_ALPHA,[fS]:i.SRC_ALPHA_SATURATE,[lh]:i.DST_COLOR,[oh]:i.DST_ALPHA,[Kd]:i.ONE_MINUS_SRC_COLOR,[Ia]:i.ONE_MINUS_SRC_ALPHA,[Jd]:i.ONE_MINUS_DST_COLOR,[Qd]:i.ONE_MINUS_DST_ALPHA,[gS]:i.CONSTANT_COLOR,[vS]:i.ONE_MINUS_CONSTANT_COLOR,[_S]:i.CONSTANT_ALPHA,[yS]:i.ONE_MINUS_CONSTANT_ALPHA};function ee(O,J,Z,S,F,X,U,P,I,V){if(O!==0){if(u===!1&&(ce(i.BLEND),u=!0),O===Ko)F=F||J,X=X||Z,U=U||S,J===p&&F===m||(i.blendEquationSeparate(k[J],k[F]),p=J,m=F),Z===f&&S===g&&X===v&&U===_||(i.blendFuncSeparate(z[Z],z[S],z[X],z[U]),f=Z,g=S,v=X,_=U),P.equals(y)!==!1&&I===x||(i.blendColor(P.r,P.g,P.b,I),y.copy(P),x=I),d=O,b=!1;else if(O!==d||V!==b){if(p===ur&&m===ur||(i.blendEquation(i.FUNC_ADD),p=ur,m=ur),V)switch(O){case 1:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case js:i.blendFunc(i.ONE,i.ONE);break;case 3:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case 4:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else switch(O){case 1:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case js:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case 3:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case 4:i.blendFunc(i.ZERO,i.SRC_COLOR)}f=null,g=null,v=null,_=null,y.set(0,0,0),x=0,d=O,b=V}}else u===!0&&(te(i.BLEND),u=!1)}function re(O){M!==O&&(O?i.frontFace(i.CW):i.frontFace(i.CCW),M=O)}function j(O){O!==0?(ce(i.CULL_FACE),O!==T&&(O===1?i.cullFace(i.BACK):O===2?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):te(i.CULL_FACE),T=O}function Q(O,J,Z){O?(ce(i.POLYGON_OFFSET_FILL),C===J&&N===Z||(i.polygonOffset(J,Z),C=J,N=Z)):te(i.POLYGON_OFFSET_FILL)}return{buffers:{color:e,depth:t,stencil:r},enable:ce,disable:te,bindFramebuffer:function(O,J){return o[O]!==J&&(i.bindFramebuffer(O,J),o[O]=J,O===i.DRAW_FRAMEBUFFER&&(o[i.FRAMEBUFFER]=J),O===i.FRAMEBUFFER&&(o[i.DRAW_FRAMEBUFFER]=J),!0)},drawBuffers:function(O,J){let Z=c,S=!1;if(O){Z=l.get(J),Z===void 0&&(Z=[],l.set(J,Z));const F=O.textures;if(Z.length!==F.length||Z[0]!==i.COLOR_ATTACHMENT0){for(let X=0,U=F.length;X<U;X++)Z[X]=i.COLOR_ATTACHMENT0+X;Z.length=F.length,S=!0}}else Z[0]!==i.BACK&&(Z[0]=i.BACK,S=!0);S&&i.drawBuffers(Z)},useProgram:function(O){return h!==O&&(i.useProgram(O),h=O,!0)},setBlending:ee,setMaterial:function(O,J){O.side===It?te(i.CULL_FACE):ce(i.CULL_FACE);let Z=O.side===Di;J&&(Z=!Z),re(Z),O.blending===1&&O.transparent===!1?ee(0):ee(O.blending,O.blendEquation,O.blendSrc,O.blendDst,O.blendEquationAlpha,O.blendSrcAlpha,O.blendDstAlpha,O.blendColor,O.blendAlpha,O.premultipliedAlpha),t.setFunc(O.depthFunc),t.setTest(O.depthTest),t.setMask(O.depthWrite),e.setMask(O.colorWrite);const S=O.stencilWrite;r.setTest(S),S&&(r.setMask(O.stencilWriteMask),r.setFunc(O.stencilFunc,O.stencilRef,O.stencilFuncMask),r.setOp(O.stencilFail,O.stencilZFail,O.stencilZPass)),Q(O.polygonOffset,O.polygonOffsetFactor,O.polygonOffsetUnits),O.alphaToCoverage===!0?ce(i.SAMPLE_ALPHA_TO_COVERAGE):te(i.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:re,setCullFace:j,setLineWidth:function(O){O!==E&&(A&&i.lineWidth(O),E=O)},setPolygonOffset:Q,setScissorTest:function(O){O?ce(i.SCISSOR_TEST):te(i.SCISSOR_TEST)},activeTexture:function(O){O===void 0&&(O=i.TEXTURE0+D-1),B!==O&&(i.activeTexture(O),B=O)},bindTexture:function(O,J,Z){Z===void 0&&(Z=B===null?i.TEXTURE0+D-1:B);let S=$[Z];S===void 0&&(S={type:void 0,texture:void 0},$[Z]=S),S.type===O&&S.texture===J||(B!==Z&&(i.activeTexture(Z),B=Z),i.bindTexture(O,J||W[O]),S.type=O,S.texture=J)},unbindTexture:function(){const O=$[B];O!==void 0&&O.type!==void 0&&(i.bindTexture(O.type,null),O.type=void 0,O.texture=void 0)},compressedTexImage2D:function(){try{i.compressedTexImage2D.apply(i,arguments)}catch{}},compressedTexImage3D:function(){try{i.compressedTexImage3D.apply(i,arguments)}catch{}},texImage2D:function(){try{i.texImage2D.apply(i,arguments)}catch{}},texImage3D:function(){try{i.texImage3D.apply(i,arguments)}catch{}},updateUBOMapping:function(O,J){let Z=a.get(J);Z===void 0&&(Z=new WeakMap,a.set(J,Z));let S=Z.get(O);S===void 0&&(S=i.getUniformBlockIndex(J,O.name),Z.set(O,S))},uniformBlockBinding:function(O,J){const Z=a.get(J).get(O);s.get(J)!==Z&&(i.uniformBlockBinding(J,Z,O.__bindingPointIndex),s.set(J,Z))},texStorage2D:function(){try{i.texStorage2D.apply(i,arguments)}catch{}},texStorage3D:function(){try{i.texStorage3D.apply(i,arguments)}catch{}},texSubImage2D:function(){try{i.texSubImage2D.apply(i,arguments)}catch{}},texSubImage3D:function(){try{i.texSubImage3D.apply(i,arguments)}catch{}},compressedTexSubImage2D:function(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch{}},compressedTexSubImage3D:function(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch{}},scissor:function(O){se.equals(O)===!1&&(i.scissor(O.x,O.y,O.z,O.w),se.copy(O))},viewport:function(O){me.equals(O)===!1&&(i.viewport(O.x,O.y,O.z,O.w),me.copy(O))},reset:function(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),n={},B=null,$={},o={},l=new WeakMap,c=[],h=null,u=!1,d=null,p=null,f=null,g=null,m=null,v=null,_=null,y=new fe(0,0,0),x=0,b=!1,M=null,T=null,E=null,C=null,N=null,se.set(0,0,i.canvas.width,i.canvas.height),me.set(0,0,i.canvas.width,i.canvas.height),e.reset(),t.reset(),r.reset()}}}function _T(i,e,t,r,s,a,n){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),c=new ne,h=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(k,z){return p?new OffscreenCanvas(k,z):Nc("canvas")}function g(k,z,ee){let re=1;const j=te(k);if((j.width>ee||j.height>ee)&&(re=ee/Math.max(j.width,j.height)),re<1){if(typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&k instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&k instanceof ImageBitmap||typeof VideoFrame<"u"&&k instanceof VideoFrame){const Q=Math.floor(re*j.width),O=Math.floor(re*j.height);u===void 0&&(u=f(Q,O));const J=z?f(Q,O):u;return J.width=Q,J.height=O,J.getContext("2d").drawImage(k,0,0,Q,O),J}return k}return k}function m(k){return k.generateMipmaps&&k.minFilter!==dt&&k.minFilter!==Kt}function v(k){i.generateMipmap(k)}function _(k,z,ee,re,j=!1){if(k!==null&&i[k]!==void 0)return i[k];let Q=z;if(z===i.RED&&(ee===i.FLOAT&&(Q=i.R32F),ee===i.HALF_FLOAT&&(Q=i.R16F),ee===i.UNSIGNED_BYTE&&(Q=i.R8)),z===i.RED_INTEGER&&(ee===i.UNSIGNED_BYTE&&(Q=i.R8UI),ee===i.UNSIGNED_SHORT&&(Q=i.R16UI),ee===i.UNSIGNED_INT&&(Q=i.R32UI),ee===i.BYTE&&(Q=i.R8I),ee===i.SHORT&&(Q=i.R16I),ee===i.INT&&(Q=i.R32I)),z===i.RG&&(ee===i.FLOAT&&(Q=i.RG32F),ee===i.HALF_FLOAT&&(Q=i.RG16F),ee===i.UNSIGNED_BYTE&&(Q=i.RG8)),z===i.RG_INTEGER&&(ee===i.UNSIGNED_BYTE&&(Q=i.RG8UI),ee===i.UNSIGNED_SHORT&&(Q=i.RG16UI),ee===i.UNSIGNED_INT&&(Q=i.RG32UI),ee===i.BYTE&&(Q=i.RG8I),ee===i.SHORT&&(Q=i.RG16I),ee===i.INT&&(Q=i.RG32I)),z===i.RGB&&ee===i.UNSIGNED_INT_5_9_9_9_REV&&(Q=i.RGB9_E5),z===i.RGBA){const O=j?Cc:ht.getTransfer(re);ee===i.FLOAT&&(Q=i.RGBA32F),ee===i.HALF_FLOAT&&(Q=i.RGBA16F),ee===i.UNSIGNED_BYTE&&(Q=O===St?i.SRGB8_ALPHA8:i.RGBA8),ee===i.UNSIGNED_SHORT_4_4_4_4&&(Q=i.RGBA4),ee===i.UNSIGNED_SHORT_5_5_5_1&&(Q=i.RGB5_A1)}return Q!==i.R16F&&Q!==i.R32F&&Q!==i.RG16F&&Q!==i.RG32F&&Q!==i.RGBA16F&&Q!==i.RGBA32F||e.get("EXT_color_buffer_float"),Q}function y(k,z){let ee;return k?z===null||z===Vn||z===Da?ee=i.DEPTH24_STENCIL8:z===mr?ee=i.DEPTH32F_STENCIL8:z===$o&&(ee=i.DEPTH24_STENCIL8):z===null||z===Vn||z===Da?ee=i.DEPTH_COMPONENT24:z===mr?ee=i.DEPTH_COMPONENT32F:z===$o&&(ee=i.DEPTH_COMPONENT16),ee}function x(k,z){return m(k)===!0||k.isFramebufferTexture&&k.minFilter!==dt&&k.minFilter!==Kt?Math.log2(Math.max(z.width,z.height))+1:k.mipmaps!==void 0&&k.mipmaps.length>0?k.mipmaps.length:k.isCompressedTexture&&Array.isArray(k.image)?z.mipmaps.length:1}function b(k){const z=k.target;z.removeEventListener("dispose",b),function(ee){const re=r.get(ee);if(re.__webglInit===void 0)return;const j=ee.source,Q=d.get(j);if(Q){const O=Q[re.__cacheKey];O.usedTimes--,O.usedTimes===0&&T(ee),Object.keys(Q).length===0&&d.delete(j)}r.remove(ee)}(z),z.isVideoTexture&&h.delete(z)}function M(k){const z=k.target;z.removeEventListener("dispose",M),function(ee){const re=r.get(ee);if(ee.depthTexture&&ee.depthTexture.dispose(),ee.isWebGLCubeRenderTarget)for(let Q=0;Q<6;Q++){if(Array.isArray(re.__webglFramebuffer[Q]))for(let O=0;O<re.__webglFramebuffer[Q].length;O++)i.deleteFramebuffer(re.__webglFramebuffer[Q][O]);else i.deleteFramebuffer(re.__webglFramebuffer[Q]);re.__webglDepthbuffer&&i.deleteRenderbuffer(re.__webglDepthbuffer[Q])}else{if(Array.isArray(re.__webglFramebuffer))for(let Q=0;Q<re.__webglFramebuffer.length;Q++)i.deleteFramebuffer(re.__webglFramebuffer[Q]);else i.deleteFramebuffer(re.__webglFramebuffer);if(re.__webglDepthbuffer&&i.deleteRenderbuffer(re.__webglDepthbuffer),re.__webglMultisampledFramebuffer&&i.deleteFramebuffer(re.__webglMultisampledFramebuffer),re.__webglColorRenderbuffer)for(let Q=0;Q<re.__webglColorRenderbuffer.length;Q++)re.__webglColorRenderbuffer[Q]&&i.deleteRenderbuffer(re.__webglColorRenderbuffer[Q]);re.__webglDepthRenderbuffer&&i.deleteRenderbuffer(re.__webglDepthRenderbuffer)}const j=ee.textures;for(let Q=0,O=j.length;Q<O;Q++){const J=r.get(j[Q]);J.__webglTexture&&(i.deleteTexture(J.__webglTexture),n.memory.textures--),r.remove(j[Q])}r.remove(ee)}(z)}function T(k){const z=r.get(k);i.deleteTexture(z.__webglTexture);const ee=k.source;delete d.get(ee)[z.__cacheKey],n.memory.textures--}let E=0;function C(k,z){const ee=r.get(k);if(k.isVideoTexture&&function(re){const j=n.render.frame;h.get(re)!==j&&(h.set(re,j),re.update())}(k),k.isRenderTargetTexture===!1&&k.version>0&&ee.__version!==k.version){const re=k.image;if(re!==null&&re.complete!==!1)return void B(ee,k,z)}t.bindTexture(i.TEXTURE_2D,ee.__webglTexture,i.TEXTURE0+z)}const N={[$t]:i.REPEAT,[Ai]:i.CLAMP_TO_EDGE,[Na]:i.MIRRORED_REPEAT},D={[dt]:i.NEAREST,[ap]:i.NEAREST_MIPMAP_NEAREST,[Tn]:i.NEAREST_MIPMAP_LINEAR,[Kt]:i.LINEAR,[Bo]:i.LINEAR_MIPMAP_NEAREST,[fs]:i.LINEAR_MIPMAP_LINEAR},A={[xS]:i.NEVER,[ES]:i.ALWAYS,[bS]:i.LESS,[wS]:i.LEQUAL,[MS]:i.EQUAL,[AS]:i.GEQUAL,[SS]:i.GREATER,[TS]:i.NOTEQUAL};function L(k,z){if(z.type===mr&&e.has("OES_texture_float_linear")===!1&&(z.magFilter===Kt||z.magFilter===Bo||z.magFilter===Tn||z.magFilter===fs||z.minFilter===Kt||z.minFilter===Bo||z.minFilter===Tn||z.minFilter),i.texParameteri(k,i.TEXTURE_WRAP_S,N[z.wrapS]),i.texParameteri(k,i.TEXTURE_WRAP_T,N[z.wrapT]),k!==i.TEXTURE_3D&&k!==i.TEXTURE_2D_ARRAY||i.texParameteri(k,i.TEXTURE_WRAP_R,N[z.wrapR]),i.texParameteri(k,i.TEXTURE_MAG_FILTER,D[z.magFilter]),i.texParameteri(k,i.TEXTURE_MIN_FILTER,D[z.minFilter]),z.compareFunction&&(i.texParameteri(k,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(k,i.TEXTURE_COMPARE_FUNC,A[z.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(z.magFilter===dt||z.minFilter!==Tn&&z.minFilter!==fs||z.type===mr&&e.has("OES_texture_float_linear")===!1)return;if(z.anisotropy>1||r.get(z).__currentAnisotropy){const ee=e.get("EXT_texture_filter_anisotropic");i.texParameterf(k,ee.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(z.anisotropy,s.getMaxAnisotropy())),r.get(z).__currentAnisotropy=z.anisotropy}}}function w(k,z){let ee=!1;k.__webglInit===void 0&&(k.__webglInit=!0,z.addEventListener("dispose",b));const re=z.source;let j=d.get(re);j===void 0&&(j={},d.set(re,j));const Q=function(O){const J=[];return J.push(O.wrapS),J.push(O.wrapT),J.push(O.wrapR||0),J.push(O.magFilter),J.push(O.minFilter),J.push(O.anisotropy),J.push(O.internalFormat),J.push(O.format),J.push(O.type),J.push(O.generateMipmaps),J.push(O.premultiplyAlpha),J.push(O.flipY),J.push(O.unpackAlignment),J.push(O.colorSpace),J.join()}(z);if(Q!==k.__cacheKey){j[Q]===void 0&&(j[Q]={texture:i.createTexture(),usedTimes:0},n.memory.textures++,ee=!0),j[Q].usedTimes++;const O=j[k.__cacheKey];O!==void 0&&(j[k.__cacheKey].usedTimes--,O.usedTimes===0&&T(z)),k.__cacheKey=Q,k.__webglTexture=j[Q].texture}return ee}function B(k,z,ee){let re=i.TEXTURE_2D;(z.isDataArrayTexture||z.isCompressedArrayTexture)&&(re=i.TEXTURE_2D_ARRAY),z.isData3DTexture&&(re=i.TEXTURE_3D);const j=w(k,z),Q=z.source;t.bindTexture(re,k.__webglTexture,i.TEXTURE0+ee);const O=r.get(Q);if(Q.version!==O.__version||j===!0){t.activeTexture(i.TEXTURE0+ee);const J=ht.getPrimaries(ht.workingColorSpace),Z=z.colorSpace===xn?null:ht.getPrimaries(z.colorSpace),S=z.colorSpace===xn||J===Z?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,z.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,z.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,S);let F=g(z.image,!1,s.maxTextureSize);F=ce(z,F);const X=a.convert(z.format,z.colorSpace),U=a.convert(z.type);let P,I=_(z.internalFormat,X,U,z.colorSpace,z.isVideoTexture);L(re,z);const V=z.mipmaps,Y=z.isVideoTexture!==!0,q=O.__version===void 0||j===!0,pe=Q.dataReady,_e=x(z,F);if(z.isDepthTexture)I=y(z.format===Oa,z.type),q&&(Y?t.texStorage2D(i.TEXTURE_2D,1,I,F.width,F.height):t.texImage2D(i.TEXTURE_2D,0,I,F.width,F.height,0,X,U,null));else if(z.isDataTexture)if(V.length>0){Y&&q&&t.texStorage2D(i.TEXTURE_2D,_e,I,V[0].width,V[0].height);for(let le=0,xe=V.length;le<xe;le++)P=V[le],Y?pe&&t.texSubImage2D(i.TEXTURE_2D,le,0,0,P.width,P.height,X,U,P.data):t.texImage2D(i.TEXTURE_2D,le,I,P.width,P.height,0,X,U,P.data);z.generateMipmaps=!1}else Y?(q&&t.texStorage2D(i.TEXTURE_2D,_e,I,F.width,F.height),pe&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,F.width,F.height,X,U,F.data)):t.texImage2D(i.TEXTURE_2D,0,I,F.width,F.height,0,X,U,F.data);else if(z.isCompressedTexture)if(z.isCompressedArrayTexture){Y&&q&&t.texStorage3D(i.TEXTURE_2D_ARRAY,_e,I,V[0].width,V[0].height,F.depth);for(let le=0,xe=V.length;le<xe;le++)if(P=V[le],z.format!==Pr){if(X!==null)if(Y){if(pe)if(z.layerUpdates.size>0){for(const Pe of z.layerUpdates){const Re=P.width*P.height;t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,le,0,0,Pe,P.width,P.height,1,X,P.data.slice(Re*Pe,Re*(Pe+1)),0,0)}z.clearLayerUpdates()}else t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,le,0,0,0,P.width,P.height,F.depth,X,P.data,0,0)}else t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,le,I,P.width,P.height,F.depth,0,P.data,0,0)}else Y?pe&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,le,0,0,0,P.width,P.height,F.depth,X,U,P.data):t.texImage3D(i.TEXTURE_2D_ARRAY,le,I,P.width,P.height,F.depth,0,X,U,P.data)}else{Y&&q&&t.texStorage2D(i.TEXTURE_2D,_e,I,V[0].width,V[0].height);for(let le=0,xe=V.length;le<xe;le++)P=V[le],z.format!==Pr?X!==null&&(Y?pe&&t.compressedTexSubImage2D(i.TEXTURE_2D,le,0,0,P.width,P.height,X,P.data):t.compressedTexImage2D(i.TEXTURE_2D,le,I,P.width,P.height,0,P.data)):Y?pe&&t.texSubImage2D(i.TEXTURE_2D,le,0,0,P.width,P.height,X,U,P.data):t.texImage2D(i.TEXTURE_2D,le,I,P.width,P.height,0,X,U,P.data)}else if(z.isDataArrayTexture)if(Y){if(q&&t.texStorage3D(i.TEXTURE_2D_ARRAY,_e,I,F.width,F.height,F.depth),pe)if(z.layerUpdates.size>0){let le;switch(U){case i.UNSIGNED_BYTE:switch(X){case i.ALPHA:case i.LUMINANCE:le=1;break;case i.LUMINANCE_ALPHA:le=2;break;case i.RGB:le=3;break;case i.RGBA:le=4;break;default:throw new Error(`Unknown texel size for format ${X}.`)}break;case i.UNSIGNED_SHORT_4_4_4_4:case i.UNSIGNED_SHORT_5_5_5_1:case i.UNSIGNED_SHORT_5_6_5:le=1;break;default:throw new Error(`Unknown texel size for type ${U}.`)}const xe=F.width*F.height*le;for(const Pe of z.layerUpdates)t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,Pe,F.width,F.height,1,X,U,F.data.slice(xe*Pe,xe*(Pe+1)));z.clearLayerUpdates()}else t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,F.width,F.height,F.depth,X,U,F.data)}else t.texImage3D(i.TEXTURE_2D_ARRAY,0,I,F.width,F.height,F.depth,0,X,U,F.data);else if(z.isData3DTexture)Y?(q&&t.texStorage3D(i.TEXTURE_3D,_e,I,F.width,F.height,F.depth),pe&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,F.width,F.height,F.depth,X,U,F.data)):t.texImage3D(i.TEXTURE_3D,0,I,F.width,F.height,F.depth,0,X,U,F.data);else if(z.isFramebufferTexture){if(q)if(Y)t.texStorage2D(i.TEXTURE_2D,_e,I,F.width,F.height);else{let le=F.width,xe=F.height;for(let Pe=0;Pe<_e;Pe++)t.texImage2D(i.TEXTURE_2D,Pe,I,le,xe,0,X,U,null),le>>=1,xe>>=1}}else if(V.length>0){if(Y&&q){const le=te(V[0]);t.texStorage2D(i.TEXTURE_2D,_e,I,le.width,le.height)}for(let le=0,xe=V.length;le<xe;le++)P=V[le],Y?pe&&t.texSubImage2D(i.TEXTURE_2D,le,0,0,X,U,P):t.texImage2D(i.TEXTURE_2D,le,I,X,U,P);z.generateMipmaps=!1}else if(Y){if(q){const le=te(F);t.texStorage2D(i.TEXTURE_2D,_e,I,le.width,le.height)}pe&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,X,U,F)}else t.texImage2D(i.TEXTURE_2D,0,I,X,U,F);m(z)&&v(re),O.__version=Q.version,z.onUpdate&&z.onUpdate(z)}k.__version=z.version}function $(k,z,ee,re,j,Q){const O=a.convert(ee.format,ee.colorSpace),J=a.convert(ee.type),Z=_(ee.internalFormat,O,J,ee.colorSpace);if(!r.get(z).__hasExternalTextures){const S=Math.max(1,z.width>>Q),F=Math.max(1,z.height>>Q);j===i.TEXTURE_3D||j===i.TEXTURE_2D_ARRAY?t.texImage3D(j,Q,Z,S,F,z.depth,0,O,J,null):t.texImage2D(j,Q,Z,S,F,0,O,J,null)}t.bindFramebuffer(i.FRAMEBUFFER,k),W(z)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,re,j,r.get(ee).__webglTexture,0,H(z)):(j===i.TEXTURE_2D||j>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&j<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,re,j,r.get(ee).__webglTexture,Q),t.bindFramebuffer(i.FRAMEBUFFER,null)}function K(k,z,ee){if(i.bindRenderbuffer(i.RENDERBUFFER,k),z.depthBuffer){const re=z.depthTexture,j=re&&re.isDepthTexture?re.type:null,Q=y(z.stencilBuffer,j),O=z.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,J=H(z);W(z)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,J,Q,z.width,z.height):ee?i.renderbufferStorageMultisample(i.RENDERBUFFER,J,Q,z.width,z.height):i.renderbufferStorage(i.RENDERBUFFER,Q,z.width,z.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,O,i.RENDERBUFFER,k)}else{const re=z.textures;for(let j=0;j<re.length;j++){const Q=re[j],O=a.convert(Q.format,Q.colorSpace),J=a.convert(Q.type),Z=_(Q.internalFormat,O,J,Q.colorSpace),S=H(z);ee&&W(z)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,S,Z,z.width,z.height):W(z)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,S,Z,z.width,z.height):i.renderbufferStorage(i.RENDERBUFFER,Z,z.width,z.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function ae(k){const z=r.get(k),ee=k.isWebGLCubeRenderTarget===!0;if(k.depthTexture&&!z.__autoAllocateDepthBuffer){if(ee)throw new Error("target.depthTexture not supported in Cube render targets");(function(re,j){if(j&&j.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,re),!j.depthTexture||!j.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(j.depthTexture).__webglTexture&&j.depthTexture.image.width===j.width&&j.depthTexture.image.height===j.height||(j.depthTexture.image.width=j.width,j.depthTexture.image.height=j.height,j.depthTexture.needsUpdate=!0),C(j.depthTexture,0);const Q=r.get(j.depthTexture).__webglTexture,O=H(j);if(j.depthTexture.format===el)W(j)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Q,0,O):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,Q,0);else{if(j.depthTexture.format!==Oa)throw new Error("Unknown depthTexture format");W(j)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Q,0,O):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,Q,0)}})(z.__webglFramebuffer,k)}else if(ee){z.__webglDepthbuffer=[];for(let re=0;re<6;re++)t.bindFramebuffer(i.FRAMEBUFFER,z.__webglFramebuffer[re]),z.__webglDepthbuffer[re]=i.createRenderbuffer(),K(z.__webglDepthbuffer[re],k,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,z.__webglFramebuffer),z.__webglDepthbuffer=i.createRenderbuffer(),K(z.__webglDepthbuffer,k,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}const se=[],me=[];function H(k){return Math.min(s.maxSamples,k.samples)}function W(k){const z=r.get(k);return k.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&z.__useRenderToTexture!==!1}function ce(k,z){const ee=k.colorSpace;return k.format,k.type,k.isCompressedTexture===!0||k.isVideoTexture===!0||ee!==oi&&ee!==xn&&ht.getTransfer(ee),z}function te(k){return typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement?(c.width=k.naturalWidth||k.width,c.height=k.naturalHeight||k.height):typeof VideoFrame<"u"&&k instanceof VideoFrame?(c.width=k.displayWidth,c.height=k.displayHeight):(c.width=k.width,c.height=k.height),c}this.allocateTextureUnit=function(){const k=E;return s.maxTextures,E+=1,k},this.resetTextureUnits=function(){E=0},this.setTexture2D=C,this.setTexture2DArray=function(k,z){const ee=r.get(k);k.version>0&&ee.__version!==k.version?B(ee,k,z):t.bindTexture(i.TEXTURE_2D_ARRAY,ee.__webglTexture,i.TEXTURE0+z)},this.setTexture3D=function(k,z){const ee=r.get(k);k.version>0&&ee.__version!==k.version?B(ee,k,z):t.bindTexture(i.TEXTURE_3D,ee.__webglTexture,i.TEXTURE0+z)},this.setTextureCube=function(k,z){const ee=r.get(k);k.version>0&&ee.__version!==k.version?function(re,j,Q){if(j.image.length!==6)return;const O=w(re,j),J=j.source;t.bindTexture(i.TEXTURE_CUBE_MAP,re.__webglTexture,i.TEXTURE0+Q);const Z=r.get(J);if(J.version!==Z.__version||O===!0){t.activeTexture(i.TEXTURE0+Q);const S=ht.getPrimaries(ht.workingColorSpace),F=j.colorSpace===xn?null:ht.getPrimaries(j.colorSpace),X=j.colorSpace===xn||S===F?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,j.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,j.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,X);const U=j.isCompressedTexture||j.image[0].isCompressedTexture,P=j.image[0]&&j.image[0].isDataTexture,I=[];for(let Ee=0;Ee<6;Ee++)I[Ee]=U||P?P?j.image[Ee].image:j.image[Ee]:g(j.image[Ee],!0,s.maxCubemapSize),I[Ee]=ce(j,I[Ee]);const V=I[0],Y=a.convert(j.format,j.colorSpace),q=a.convert(j.type),pe=_(j.internalFormat,Y,q,j.colorSpace),_e=j.isVideoTexture!==!0,le=Z.__version===void 0||O===!0,xe=J.dataReady;let Pe,Re=x(j,V);if(L(i.TEXTURE_CUBE_MAP,j),U){_e&&le&&t.texStorage2D(i.TEXTURE_CUBE_MAP,Re,pe,V.width,V.height);for(let Ee=0;Ee<6;Ee++){Pe=I[Ee].mipmaps;for(let $e=0;$e<Pe.length;$e++){const ke=Pe[$e];j.format!==Pr?Y!==null&&(_e?xe&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,$e,0,0,ke.width,ke.height,Y,ke.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,$e,pe,ke.width,ke.height,0,ke.data)):_e?xe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,$e,0,0,ke.width,ke.height,Y,q,ke.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,$e,pe,ke.width,ke.height,0,Y,q,ke.data)}}}else{if(Pe=j.mipmaps,_e&&le){Pe.length>0&&Re++;const Ee=te(I[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,Re,pe,Ee.width,Ee.height)}for(let Ee=0;Ee<6;Ee++)if(P){_e?xe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,0,0,I[Ee].width,I[Ee].height,Y,q,I[Ee].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,pe,I[Ee].width,I[Ee].height,0,Y,q,I[Ee].data);for(let $e=0;$e<Pe.length;$e++){const ke=Pe[$e].image[Ee].image;_e?xe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,$e+1,0,0,ke.width,ke.height,Y,q,ke.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,$e+1,pe,ke.width,ke.height,0,Y,q,ke.data)}}else{_e?xe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,0,0,Y,q,I[Ee]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0,pe,Y,q,I[Ee]);for(let $e=0;$e<Pe.length;$e++){const ke=Pe[$e];_e?xe&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,$e+1,0,0,Y,q,ke.image[Ee]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,$e+1,pe,Y,q,ke.image[Ee])}}}m(j)&&v(i.TEXTURE_CUBE_MAP),Z.__version=J.version,j.onUpdate&&j.onUpdate(j)}re.__version=j.version}(ee,k,z):t.bindTexture(i.TEXTURE_CUBE_MAP,ee.__webglTexture,i.TEXTURE0+z)},this.rebindTextures=function(k,z,ee){const re=r.get(k);z!==void 0&&$(re.__webglFramebuffer,k,k.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),ee!==void 0&&ae(k)},this.setupRenderTarget=function(k){const z=k.texture,ee=r.get(k),re=r.get(z);k.addEventListener("dispose",M);const j=k.textures,Q=k.isWebGLCubeRenderTarget===!0,O=j.length>1;if(O||(re.__webglTexture===void 0&&(re.__webglTexture=i.createTexture()),re.__version=z.version,n.memory.textures++),Q){ee.__webglFramebuffer=[];for(let J=0;J<6;J++)if(z.mipmaps&&z.mipmaps.length>0){ee.__webglFramebuffer[J]=[];for(let Z=0;Z<z.mipmaps.length;Z++)ee.__webglFramebuffer[J][Z]=i.createFramebuffer()}else ee.__webglFramebuffer[J]=i.createFramebuffer()}else{if(z.mipmaps&&z.mipmaps.length>0){ee.__webglFramebuffer=[];for(let J=0;J<z.mipmaps.length;J++)ee.__webglFramebuffer[J]=i.createFramebuffer()}else ee.__webglFramebuffer=i.createFramebuffer();if(O)for(let J=0,Z=j.length;J<Z;J++){const S=r.get(j[J]);S.__webglTexture===void 0&&(S.__webglTexture=i.createTexture(),n.memory.textures++)}if(k.samples>0&&W(k)===!1){ee.__webglMultisampledFramebuffer=i.createFramebuffer(),ee.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,ee.__webglMultisampledFramebuffer);for(let J=0;J<j.length;J++){const Z=j[J];ee.__webglColorRenderbuffer[J]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,ee.__webglColorRenderbuffer[J]);const S=a.convert(Z.format,Z.colorSpace),F=a.convert(Z.type),X=_(Z.internalFormat,S,F,Z.colorSpace,k.isXRRenderTarget===!0),U=H(k);i.renderbufferStorageMultisample(i.RENDERBUFFER,U,X,k.width,k.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+J,i.RENDERBUFFER,ee.__webglColorRenderbuffer[J])}i.bindRenderbuffer(i.RENDERBUFFER,null),k.depthBuffer&&(ee.__webglDepthRenderbuffer=i.createRenderbuffer(),K(ee.__webglDepthRenderbuffer,k,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(Q){t.bindTexture(i.TEXTURE_CUBE_MAP,re.__webglTexture),L(i.TEXTURE_CUBE_MAP,z);for(let J=0;J<6;J++)if(z.mipmaps&&z.mipmaps.length>0)for(let Z=0;Z<z.mipmaps.length;Z++)$(ee.__webglFramebuffer[J][Z],k,z,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+J,Z);else $(ee.__webglFramebuffer[J],k,z,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+J,0);m(z)&&v(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(O){for(let J=0,Z=j.length;J<Z;J++){const S=j[J],F=r.get(S);t.bindTexture(i.TEXTURE_2D,F.__webglTexture),L(i.TEXTURE_2D,S),$(ee.__webglFramebuffer,k,S,i.COLOR_ATTACHMENT0+J,i.TEXTURE_2D,0),m(S)&&v(i.TEXTURE_2D)}t.unbindTexture()}else{let J=i.TEXTURE_2D;if((k.isWebGL3DRenderTarget||k.isWebGLArrayRenderTarget)&&(J=k.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(J,re.__webglTexture),L(J,z),z.mipmaps&&z.mipmaps.length>0)for(let Z=0;Z<z.mipmaps.length;Z++)$(ee.__webglFramebuffer[Z],k,z,i.COLOR_ATTACHMENT0,J,Z);else $(ee.__webglFramebuffer,k,z,i.COLOR_ATTACHMENT0,J,0);m(z)&&v(J),t.unbindTexture()}k.depthBuffer&&ae(k)},this.updateRenderTargetMipmap=function(k){const z=k.textures;for(let ee=0,re=z.length;ee<re;ee++){const j=z[ee];if(m(j)){const Q=k.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,O=r.get(j).__webglTexture;t.bindTexture(Q,O),v(Q),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function(k){if(k.samples>0){if(W(k)===!1){const z=k.textures,ee=k.width,re=k.height;let j=i.COLOR_BUFFER_BIT;const Q=k.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,O=r.get(k),J=z.length>1;if(J)for(let Z=0;Z<z.length;Z++)t.bindFramebuffer(i.FRAMEBUFFER,O.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Z,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,O.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Z,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,O.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,O.__webglFramebuffer);for(let Z=0;Z<z.length;Z++){if(k.resolveDepthBuffer&&(k.depthBuffer&&(j|=i.DEPTH_BUFFER_BIT),k.stencilBuffer&&k.resolveStencilBuffer&&(j|=i.STENCIL_BUFFER_BIT)),J){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,O.__webglColorRenderbuffer[Z]);const S=r.get(z[Z]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,S,0)}i.blitFramebuffer(0,0,ee,re,0,0,ee,re,j,i.NEAREST),l===!0&&(se.length=0,me.length=0,se.push(i.COLOR_ATTACHMENT0+Z),k.depthBuffer&&k.resolveDepthBuffer===!1&&(se.push(Q),me.push(Q),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,me)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,se))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),J)for(let Z=0;Z<z.length;Z++){t.bindFramebuffer(i.FRAMEBUFFER,O.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Z,i.RENDERBUFFER,O.__webglColorRenderbuffer[Z]);const S=r.get(z[Z]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,O.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Z,i.TEXTURE_2D,S,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,O.__webglMultisampledFramebuffer)}else if(k.depthBuffer&&k.resolveDepthBuffer===!1&&l){const z=k.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[z])}}},this.setupDepthRenderbuffer=ae,this.setupFrameBufferTexture=$,this.useMultisampledRTT=W}function Lx(i,e){return{convert:function(t,r=""){let s;const a=ht.getTransfer(r);if(t===zn)return i.UNSIGNED_BYTE;if(t===Xg)return i.UNSIGNED_SHORT_4_4_4_4;if(t===qg)return i.UNSIGNED_SHORT_5_5_5_1;if(t===35902)return i.UNSIGNED_INT_5_9_9_9_REV;if(t===1010)return i.BYTE;if(t===1011)return i.SHORT;if(t===$o)return i.UNSIGNED_SHORT;if(t===Wg)return i.INT;if(t===Vn)return i.UNSIGNED_INT;if(t===mr)return i.FLOAT;if(t===Qt)return i.HALF_FLOAT;if(t===1021)return i.ALPHA;if(t===1022)return i.RGB;if(t===Pr)return i.RGBA;if(t===1024)return i.LUMINANCE;if(t===1025)return i.LUMINANCE_ALPHA;if(t===el)return i.DEPTH_COMPONENT;if(t===Oa)return i.DEPTH_STENCIL;if(t===Yg)return i.RED;if(t===Zg)return i.RED_INTEGER;if(t===1030)return i.RG;if(t===Kg)return i.RG_INTEGER;if(t===Qg)return i.RGBA_INTEGER;if(t===Ku||t===Qu||t===Ju||t===$u)if(a===St){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s===null)return null;if(t===Ku)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===Qu)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===Ju)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===$u)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),s===null)return null;if(t===Ku)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Qu)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Ju)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===$u)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Mf||t===wf||t===Sf||t===Tf){if(s=e.get("WEBGL_compressed_texture_pvrtc"),s===null)return null;if(t===Mf)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===wf)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Sf)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Tf)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Af||t===Ef||t===Cf){if(s=e.get("WEBGL_compressed_texture_etc"),s===null)return null;if(t===Af||t===Ef)return a===St?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(t===Cf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(t===Rf||t===Pf||t===If||t===Lf||t===Nf||t===Df||t===Of||t===Uf||t===kf||t===Ff||t===Bf||t===zf||t===Vf||t===Hf){if(s=e.get("WEBGL_compressed_texture_astc"),s===null)return null;if(t===Rf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===Pf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===If)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===Lf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===Nf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===Df)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===Of)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===Uf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===kf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===Ff)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===Bf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===zf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===Vf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===Hf)return a===St?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===ed||t===Gf||t===jf){if(s=e.get("EXT_texture_compression_bptc"),s===null)return null;if(t===ed)return a===St?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(t===Gf)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(t===jf)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(t===36283||t===Wf||t===Xf||t===qf){if(s=e.get("EXT_texture_compression_rgtc"),s===null)return null;if(t===ed)return s.COMPRESSED_RED_RGTC1_EXT;if(t===Wf)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===Xf)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===qf)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return t===Da?i.UNSIGNED_INT_24_8:i[t]!==void 0?i[t]:null}}}class Nx extends Jt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Ei extends je{constructor(){super(),this.isGroup=!0,this.type="Group"}}const yT={type:"move"};class lm{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ei,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ei,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new R,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new R),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ei,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new R,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new R),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let s=null,a=null,n=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){n=!0;for(const g of e.hand.values()){const m=t.getJointPose(g,r),v=this._getHandJoint(c,g);m!==null&&(v.matrix.fromArray(m.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=m.radius),v.visible=m!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],d=h.position.distanceTo(u.position),p=.02,f=.005;c.inputState.pinching&&d>p+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=p-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(a=t.getPose(e.gripSpace,r),a!==null&&(l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,a.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(a.linearVelocity)):l.hasLinearVelocity=!1,a.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(a.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(s=t.getPose(e.targetRaySpace,r),s===null&&a!==null&&(s=a),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(yT)))}return o!==null&&(o.visible=s!==null),l!==null&&(l.visible=a!==null),c!==null&&(c.visible=n!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new Ei;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class xT{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const s=new wt;e.properties.get(s).__webglTexture=t.texture,t.depthNear==r.depthNear&&t.depthFar==r.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new ct({vertexShader:`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,fragmentShader:`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new ye(new ws(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}}class bT extends ys{constructor(e,t){super();const r=this;let s=null,a=1,n=null,o="local-floor",l=1,c=null,h=null,u=null,d=null,p=null,f=null;const g=new xT,m=t.getContextAttributes();let v=null,_=null;const y=[],x=[],b=new ne;let M=null;const T=new Jt;T.layers.enable(1),T.viewport=new qe;const E=new Jt;E.layers.enable(2),E.viewport=new qe;const C=[T,E],N=new Nx;N.layers.enable(1),N.layers.enable(2);let D=null,A=null;function L(H){const W=x.indexOf(H.inputSource);if(W===-1)return;const ce=y[W];ce!==void 0&&(ce.update(H.inputSource,H.frame,c||n),ce.dispatchEvent({type:H.type,data:H.inputSource}))}function w(){s.removeEventListener("select",L),s.removeEventListener("selectstart",L),s.removeEventListener("selectend",L),s.removeEventListener("squeeze",L),s.removeEventListener("squeezestart",L),s.removeEventListener("squeezeend",L),s.removeEventListener("end",w),s.removeEventListener("inputsourceschange",B);for(let H=0;H<y.length;H++){const W=x[H];W!==null&&(x[H]=null,y[H].disconnect(W))}D=null,A=null,g.reset(),e.setRenderTarget(v),p=null,d=null,u=null,s=null,_=null,me.stop(),r.isPresenting=!1,e.setPixelRatio(M),e.setSize(b.width,b.height,!1),r.dispatchEvent({type:"sessionend"})}function B(H){for(let W=0;W<H.removed.length;W++){const ce=H.removed[W],te=x.indexOf(ce);te>=0&&(x[te]=null,y[te].disconnect(ce))}for(let W=0;W<H.added.length;W++){const ce=H.added[W];let te=x.indexOf(ce);if(te===-1){for(let z=0;z<y.length;z++){if(z>=x.length){x.push(ce),te=z;break}if(x[z]===null){x[z]=ce,te=z;break}}if(te===-1)break}const k=y[te];k&&k.connect(ce)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(H){let W=y[H];return W===void 0&&(W=new lm,y[H]=W),W.getTargetRaySpace()},this.getControllerGrip=function(H){let W=y[H];return W===void 0&&(W=new lm,y[H]=W),W.getGripSpace()},this.getHand=function(H){let W=y[H];return W===void 0&&(W=new lm,y[H]=W),W.getHandSpace()},this.setFramebufferScaleFactor=function(H){a=H,r.isPresenting},this.setReferenceSpaceType=function(H){o=H,r.isPresenting},this.getReferenceSpace=function(){return c||n},this.setReferenceSpace=function(H){c=H},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return s},this.setSession=function(H){return Wr(this,null,function*(){if(s=H,s!==null){if(v=e.getRenderTarget(),s.addEventListener("select",L),s.addEventListener("selectstart",L),s.addEventListener("selectend",L),s.addEventListener("squeeze",L),s.addEventListener("squeezestart",L),s.addEventListener("squeezeend",L),s.addEventListener("end",w),s.addEventListener("inputsourceschange",B),m.xrCompatible!==!0&&(yield t.makeXRCompatible()),M=e.getPixelRatio(),e.getSize(b),s.renderState.layers===void 0){const W={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(s,t,W),s.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),_=new ft(p.framebufferWidth,p.framebufferHeight,{format:Pr,type:zn,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let W=null,ce=null,te=null;m.depth&&(te=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,W=m.stencil?Oa:el,ce=m.stencil?Da:Vn);const k={colorFormat:t.RGBA8,depthFormat:te,scaleFactor:a};u=new XRWebGLBinding(s,t),d=u.createProjectionLayer(k),s.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),_=new ft(d.textureWidth,d.textureHeight,{format:Pr,type:zn,depthTexture:new dh(d.textureWidth,d.textureHeight,ce,void 0,void 0,void 0,void 0,void 0,void 0,W),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}_.isXRRenderTarget=!0,this.setFoveation(l),c=null,n=yield s.requestReferenceSpace(o),me.setContext(s),me.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}})},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};const $=new R,K=new R;function ae(H,W){W===null?H.matrixWorld.copy(H.matrix):H.matrixWorld.multiplyMatrices(W.matrixWorld,H.matrix),H.matrixWorldInverse.copy(H.matrixWorld).invert()}this.updateCamera=function(H){if(s===null)return;g.texture!==null&&(H.near=g.depthNear,H.far=g.depthFar),N.near=E.near=T.near=H.near,N.far=E.far=T.far=H.far,D===N.near&&A===N.far||(s.updateRenderState({depthNear:N.near,depthFar:N.far}),D=N.near,A=N.far,T.near=D,T.far=A,E.near=D,E.far=A,T.updateProjectionMatrix(),E.updateProjectionMatrix(),H.updateProjectionMatrix());const W=H.parent,ce=N.cameras;ae(N,W);for(let te=0;te<ce.length;te++)ae(ce[te],W);ce.length===2?function(te,k,z){$.setFromMatrixPosition(k.matrixWorld),K.setFromMatrixPosition(z.matrixWorld);const ee=$.distanceTo(K),re=k.projectionMatrix.elements,j=z.projectionMatrix.elements,Q=re[14]/(re[10]-1),O=re[14]/(re[10]+1),J=(re[9]+1)/re[5],Z=(re[9]-1)/re[5],S=(re[8]-1)/re[0],F=(j[8]+1)/j[0],X=Q*S,U=Q*F,P=ee/(-S+F),I=P*-S;k.matrixWorld.decompose(te.position,te.quaternion,te.scale),te.translateX(I),te.translateZ(P),te.matrixWorld.compose(te.position,te.quaternion,te.scale),te.matrixWorldInverse.copy(te.matrixWorld).invert();const V=Q+P,Y=O+P,q=X-I,pe=U+(ee-I),_e=J*O/Y*V,le=Z*O/Y*V;te.projectionMatrix.makePerspective(q,pe,_e,le,V,Y),te.projectionMatrixInverse.copy(te.projectionMatrix).invert()}(N,T,E):N.projectionMatrix.copy(T.projectionMatrix),function(te,k,z){z===null?te.matrix.copy(k.matrixWorld):(te.matrix.copy(z.matrixWorld),te.matrix.invert(),te.matrix.multiply(k.matrixWorld)),te.matrix.decompose(te.position,te.quaternion,te.scale),te.updateMatrixWorld(!0),te.projectionMatrix.copy(k.projectionMatrix),te.projectionMatrixInverse.copy(k.projectionMatrixInverse),te.isPerspectiveCamera&&(te.fov=2*rl*Math.atan(1/te.projectionMatrix.elements[5]),te.zoom=1)}(H,N,W)},this.getCamera=function(){return N},this.getFoveation=function(){return d===null&&p===null?void 0:l},this.setFoveation=function(H){l=H,d!==null&&(d.fixedFoveation=H),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=H)},this.hasDepthSensing=function(){return g.texture!==null},this.getDepthSensingMesh=function(){return g.getMesh(N)};let se=null;const me=new Ax;me.setAnimationLoop(function(H,W){if(h=W.getViewerPose(c||n),f=W,h!==null){const ce=h.views;p!==null&&(e.setRenderTargetFramebuffer(_,p.framebuffer),e.setRenderTarget(_));let te=!1;ce.length!==N.cameras.length&&(N.cameras.length=0,te=!0);for(let z=0;z<ce.length;z++){const ee=ce[z];let re=null;if(p!==null)re=p.getViewport(ee);else{const Q=u.getViewSubImage(d,ee);re=Q.viewport,z===0&&(e.setRenderTargetTextures(_,Q.colorTexture,d.ignoreDepthValues?void 0:Q.depthStencilTexture),e.setRenderTarget(_))}let j=C[z];j===void 0&&(j=new Jt,j.layers.enable(z),j.viewport=new qe,C[z]=j),j.matrix.fromArray(ee.transform.matrix),j.matrix.decompose(j.position,j.quaternion,j.scale),j.projectionMatrix.fromArray(ee.projectionMatrix),j.projectionMatrixInverse.copy(j.projectionMatrix).invert(),j.viewport.set(re.x,re.y,re.width,re.height),z===0&&(N.matrix.copy(j.matrix),N.matrix.decompose(N.position,N.quaternion,N.scale)),te===!0&&N.cameras.push(j)}const k=s.enabledFeatures;if(k&&k.includes("depth-sensing")){const z=u.getDepthInformation(ce[0]);z&&z.isValid&&z.texture&&g.init(e,z,s.renderState)}}for(let ce=0;ce<y.length;ce++){const te=x[ce],k=y[ce];te!==null&&k!==void 0&&k.update(te,W,c||n)}se&&se(H,W),W.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:W}),f=null}),this.setAnimationLoop=function(H){se=H},this.dispose=function(){}}}const en=new Rt,MT=new Me;function wT(i,e){function t(s,a){s.matrixAutoUpdate===!0&&s.updateMatrix(),a.value.copy(s.matrix)}function r(s,a){s.opacity.value=a.opacity,a.color&&s.diffuse.value.copy(a.color),a.emissive&&s.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity),a.map&&(s.map.value=a.map,t(a.map,s.mapTransform)),a.alphaMap&&(s.alphaMap.value=a.alphaMap,t(a.alphaMap,s.alphaMapTransform)),a.bumpMap&&(s.bumpMap.value=a.bumpMap,t(a.bumpMap,s.bumpMapTransform),s.bumpScale.value=a.bumpScale,a.side===Di&&(s.bumpScale.value*=-1)),a.normalMap&&(s.normalMap.value=a.normalMap,t(a.normalMap,s.normalMapTransform),s.normalScale.value.copy(a.normalScale),a.side===Di&&s.normalScale.value.negate()),a.displacementMap&&(s.displacementMap.value=a.displacementMap,t(a.displacementMap,s.displacementMapTransform),s.displacementScale.value=a.displacementScale,s.displacementBias.value=a.displacementBias),a.emissiveMap&&(s.emissiveMap.value=a.emissiveMap,t(a.emissiveMap,s.emissiveMapTransform)),a.specularMap&&(s.specularMap.value=a.specularMap,t(a.specularMap,s.specularMapTransform)),a.alphaTest>0&&(s.alphaTest.value=a.alphaTest);const n=e.get(a),o=n.envMap,l=n.envMapRotation;o&&(s.envMap.value=o,en.copy(l),en.x*=-1,en.y*=-1,en.z*=-1,o.isCubeTexture&&o.isRenderTargetTexture===!1&&(en.y*=-1,en.z*=-1),s.envMapRotation.value.setFromMatrix4(MT.makeRotationFromEuler(en)),s.flipEnvMap.value=o.isCubeTexture&&o.isRenderTargetTexture===!1?-1:1,s.reflectivity.value=a.reflectivity,s.ior.value=a.ior,s.refractionRatio.value=a.refractionRatio),a.lightMap&&(s.lightMap.value=a.lightMap,s.lightMapIntensity.value=a.lightMapIntensity,t(a.lightMap,s.lightMapTransform)),a.aoMap&&(s.aoMap.value=a.aoMap,s.aoMapIntensity.value=a.aoMapIntensity,t(a.aoMap,s.aoMapTransform))}return{refreshFogUniforms:function(s,a){a.color.getRGB(s.fogColor.value,wx(i)),a.isFog?(s.fogNear.value=a.near,s.fogFar.value=a.far):a.isFogExp2&&(s.fogDensity.value=a.density)},refreshMaterialUniforms:function(s,a,n,o,l){a.isMeshBasicMaterial||a.isMeshLambertMaterial?r(s,a):a.isMeshToonMaterial?(r(s,a),function(c,h){h.gradientMap&&(c.gradientMap.value=h.gradientMap)}(s,a)):a.isMeshPhongMaterial?(r(s,a),function(c,h){c.specular.value.copy(h.specular),c.shininess.value=Math.max(h.shininess,1e-4)}(s,a)):a.isMeshStandardMaterial?(r(s,a),function(c,h){c.metalness.value=h.metalness,h.metalnessMap&&(c.metalnessMap.value=h.metalnessMap,t(h.metalnessMap,c.metalnessMapTransform)),c.roughness.value=h.roughness,h.roughnessMap&&(c.roughnessMap.value=h.roughnessMap,t(h.roughnessMap,c.roughnessMapTransform)),h.envMap&&(c.envMapIntensity.value=h.envMapIntensity)}(s,a),a.isMeshPhysicalMaterial&&function(c,h,u){c.ior.value=h.ior,h.sheen>0&&(c.sheenColor.value.copy(h.sheenColor).multiplyScalar(h.sheen),c.sheenRoughness.value=h.sheenRoughness,h.sheenColorMap&&(c.sheenColorMap.value=h.sheenColorMap,t(h.sheenColorMap,c.sheenColorMapTransform)),h.sheenRoughnessMap&&(c.sheenRoughnessMap.value=h.sheenRoughnessMap,t(h.sheenRoughnessMap,c.sheenRoughnessMapTransform))),h.clearcoat>0&&(c.clearcoat.value=h.clearcoat,c.clearcoatRoughness.value=h.clearcoatRoughness,h.clearcoatMap&&(c.clearcoatMap.value=h.clearcoatMap,t(h.clearcoatMap,c.clearcoatMapTransform)),h.clearcoatRoughnessMap&&(c.clearcoatRoughnessMap.value=h.clearcoatRoughnessMap,t(h.clearcoatRoughnessMap,c.clearcoatRoughnessMapTransform)),h.clearcoatNormalMap&&(c.clearcoatNormalMap.value=h.clearcoatNormalMap,t(h.clearcoatNormalMap,c.clearcoatNormalMapTransform),c.clearcoatNormalScale.value.copy(h.clearcoatNormalScale),h.side===Di&&c.clearcoatNormalScale.value.negate())),h.dispersion>0&&(c.dispersion.value=h.dispersion),h.iridescence>0&&(c.iridescence.value=h.iridescence,c.iridescenceIOR.value=h.iridescenceIOR,c.iridescenceThicknessMinimum.value=h.iridescenceThicknessRange[0],c.iridescenceThicknessMaximum.value=h.iridescenceThicknessRange[1],h.iridescenceMap&&(c.iridescenceMap.value=h.iridescenceMap,t(h.iridescenceMap,c.iridescenceMapTransform)),h.iridescenceThicknessMap&&(c.iridescenceThicknessMap.value=h.iridescenceThicknessMap,t(h.iridescenceThicknessMap,c.iridescenceThicknessMapTransform))),h.transmission>0&&(c.transmission.value=h.transmission,c.transmissionSamplerMap.value=u.texture,c.transmissionSamplerSize.value.set(u.width,u.height),h.transmissionMap&&(c.transmissionMap.value=h.transmissionMap,t(h.transmissionMap,c.transmissionMapTransform)),c.thickness.value=h.thickness,h.thicknessMap&&(c.thicknessMap.value=h.thicknessMap,t(h.thicknessMap,c.thicknessMapTransform)),c.attenuationDistance.value=h.attenuationDistance,c.attenuationColor.value.copy(h.attenuationColor)),h.anisotropy>0&&(c.anisotropyVector.value.set(h.anisotropy*Math.cos(h.anisotropyRotation),h.anisotropy*Math.sin(h.anisotropyRotation)),h.anisotropyMap&&(c.anisotropyMap.value=h.anisotropyMap,t(h.anisotropyMap,c.anisotropyMapTransform))),c.specularIntensity.value=h.specularIntensity,c.specularColor.value.copy(h.specularColor),h.specularColorMap&&(c.specularColorMap.value=h.specularColorMap,t(h.specularColorMap,c.specularColorMapTransform)),h.specularIntensityMap&&(c.specularIntensityMap.value=h.specularIntensityMap,t(h.specularIntensityMap,c.specularIntensityMapTransform))}(s,a,l)):a.isMeshMatcapMaterial?(r(s,a),function(c,h){h.matcap&&(c.matcap.value=h.matcap)}(s,a)):a.isMeshDepthMaterial?r(s,a):a.isMeshDistanceMaterial?(r(s,a),function(c,h){const u=e.get(h).light;c.referencePosition.value.setFromMatrixPosition(u.matrixWorld),c.nearDistance.value=u.shadow.camera.near,c.farDistance.value=u.shadow.camera.far}(s,a)):a.isMeshNormalMaterial?r(s,a):a.isLineBasicMaterial?(function(c,h){c.diffuse.value.copy(h.color),c.opacity.value=h.opacity,h.map&&(c.map.value=h.map,t(h.map,c.mapTransform))}(s,a),a.isLineDashedMaterial&&function(c,h){c.dashSize.value=h.dashSize,c.totalSize.value=h.dashSize+h.gapSize,c.scale.value=h.scale}(s,a)):a.isPointsMaterial?function(c,h,u,d){c.diffuse.value.copy(h.color),c.opacity.value=h.opacity,c.size.value=h.size*u,c.scale.value=.5*d,h.map&&(c.map.value=h.map,t(h.map,c.uvTransform)),h.alphaMap&&(c.alphaMap.value=h.alphaMap,t(h.alphaMap,c.alphaMapTransform)),h.alphaTest>0&&(c.alphaTest.value=h.alphaTest)}(s,a,n,o):a.isSpriteMaterial?function(c,h){c.diffuse.value.copy(h.color),c.opacity.value=h.opacity,c.rotation.value=h.rotation,h.map&&(c.map.value=h.map,t(h.map,c.mapTransform)),h.alphaMap&&(c.alphaMap.value=h.alphaMap,t(h.alphaMap,c.alphaMapTransform)),h.alphaTest>0&&(c.alphaTest.value=h.alphaTest)}(s,a):a.isShadowMaterial?(s.color.value.copy(a.color),s.opacity.value=a.opacity):a.isShaderMaterial&&(a.uniformsNeedUpdate=!1)}}}function ST(i,e,t,r){let s={},a={},n=[];const o=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function l(u,d,p,f){const g=u.value,m=d+"_"+p;if(f[m]===void 0)return f[m]=typeof g=="number"||typeof g=="boolean"?g:g.clone(),!0;{const v=f[m];if(typeof g=="number"||typeof g=="boolean"){if(v!==g)return f[m]=g,!0}else if(v.equals(g)===!1)return v.copy(g),!0}return!1}function c(u){const d={boundary:0,storage:0};return typeof u=="number"||typeof u=="boolean"?(d.boundary=4,d.storage=4):u.isVector2?(d.boundary=8,d.storage=8):u.isVector3||u.isColor?(d.boundary=16,d.storage=12):u.isVector4?(d.boundary=16,d.storage=16):u.isMatrix3?(d.boundary=48,d.storage=48):u.isMatrix4?(d.boundary=64,d.storage=64):u.isTexture,d}function h(u){const d=u.target;d.removeEventListener("dispose",h);const p=n.indexOf(d.__bindingPointIndex);n.splice(p,1),i.deleteBuffer(s[d.id]),delete s[d.id],delete a[d.id]}return{bind:function(u,d){const p=d.program;r.uniformBlockBinding(u,p)},update:function(u,d){let p=s[u.id];p===void 0&&(function(m){const v=m.uniforms;let _=0;const y=16;for(let b=0,M=v.length;b<M;b++){const T=Array.isArray(v[b])?v[b]:[v[b]];for(let E=0,C=T.length;E<C;E++){const N=T[E],D=Array.isArray(N.value)?N.value:[N.value];for(let A=0,L=D.length;A<L;A++){const w=c(D[A]),B=_%y;B!==0&&y-B<w.boundary&&(_+=y-B),N.__data=new Float32Array(w.storage/Float32Array.BYTES_PER_ELEMENT),N.__offset=_,_+=w.storage}}}const x=_%y;x>0&&(_+=y-x),m.__size=_,m.__cache={}}(u),p=function(m){const v=function(){for(let b=0;b<o;b++)if(n.indexOf(b)===-1)return n.push(b),b;return 0}();m.__bindingPointIndex=v;const _=i.createBuffer(),y=m.__size,x=m.usage;return i.bindBuffer(i.UNIFORM_BUFFER,_),i.bufferData(i.UNIFORM_BUFFER,y,x),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,v,_),_}(u),s[u.id]=p,u.addEventListener("dispose",h));const f=d.program;r.updateUBOMapping(u,f);const g=e.render.frame;a[u.id]!==g&&(function(m){const v=s[m.id],_=m.uniforms,y=m.__cache;i.bindBuffer(i.UNIFORM_BUFFER,v);for(let x=0,b=_.length;x<b;x++){const M=Array.isArray(_[x])?_[x]:[_[x]];for(let T=0,E=M.length;T<E;T++){const C=M[T];if(l(C,x,T,y)===!0){const N=C.__offset,D=Array.isArray(C.value)?C.value:[C.value];let A=0;for(let L=0;L<D.length;L++){const w=D[L],B=c(w);typeof w=="number"||typeof w=="boolean"?(C.__data[0]=w,i.bufferSubData(i.UNIFORM_BUFFER,N+A,C.__data)):w.isMatrix3?(C.__data[0]=w.elements[0],C.__data[1]=w.elements[1],C.__data[2]=w.elements[2],C.__data[3]=0,C.__data[4]=w.elements[3],C.__data[5]=w.elements[4],C.__data[6]=w.elements[5],C.__data[7]=0,C.__data[8]=w.elements[6],C.__data[9]=w.elements[7],C.__data[10]=w.elements[8],C.__data[11]=0):(w.toArray(C.__data,A),A+=B.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,N,C.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}(u),a[u.id]=g)},dispose:function(){for(const u in s)i.deleteBuffer(s[u]);n=[],s={},a={}}}}class Dx{constructor(e={}){const{canvas:t=yx(),context:r=null,depth:s=!0,stencil:a=!1,alpha:n=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;if(this.isWebGLRenderer=!0,r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=r.getContextAttributes().alpha}else d=n;const p=new Uint32Array(4),f=new Int32Array(4);let g=null,m=null;const v=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Tt,this.toneMapping=ms,this.toneMappingExposure=1;const y=this;let x=!1,b=0,M=0,T=null,E=-1,C=null;const N=new qe,D=new qe;let A=null;const L=new fe(0);let w=0,B=t.width,$=t.height,K=1,ae=null,se=null;const me=new qe(0,0,B,$),H=new qe(0,0,B,$);let W=!1;const ce=new uh;let te=!1,k=!1;const z=new Me,ee=new R,re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let j=!1;function Q(){return T===null?K:1}let O,J,Z,S,F,X,U,P,I,V,Y,q,pe,_e,le,xe,Pe,Re,Ee,$e,ke,vt,st,qi,ie=r;function Ui(G,oe){return t.getContext(G,oe)}try{const G={alpha:!0,depth:s,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${pd}`),t.addEventListener("webglcontextlost",wh,!1),t.addEventListener("webglcontextrestored",Sh,!1),t.addEventListener("webglcontextcreationerror",Sl,!1),ie===null){const oe="webgl2";if(ie=Ui(oe,G),ie===null)throw Ui(oe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(G){throw G}function Jr(){O=new e2(ie),O.init(),vt=new Lx(ie,O),J=new KS(ie,O,e,vt),Z=new vT(ie),S=new r2(ie),F=new lT,X=new _T(ie,O,Z,F,J,vt,S),U=new JS(y),P=new $S(y),I=new WS(ie),st=new YS(ie,I),V=new t2(ie,I,S,st),Y=new a2(ie,V,I,S),Ee=new s2(ie,J,X),xe=new QS(F),q=new oT(y,U,P,O,J,st,xe),pe=new wT(y,F),_e=new hT,le=new fT(O),Re=new qS(y,U,P,Z,Y,d,l),Pe=new gT(y,Y,J),qi=new ST(ie,S,J,Z),$e=new ZS(ie,O,S),ke=new i2(ie,O,S),S.programs=q.programs,y.capabilities=J,y.extensions=O,y.properties=F,y.renderLists=_e,y.shadowMap=Pe,y.state=Z,y.info=S}Jr();const Lt=new bT(y,ie);function wh(G){G.preventDefault(),x=!0}function Sh(){x=!1;const G=S.autoReset,oe=Pe.enabled,ue=Pe.autoUpdate,ge=Pe.needsUpdate,de=Pe.type;Jr(),S.autoReset=G,Pe.enabled=oe,Pe.autoUpdate=ue,Pe.needsUpdate=ge,Pe.type=de}function Sl(G){}function ea(G){const oe=G.target;oe.removeEventListener("dispose",ea),function(ue){(function(ge){const de=F.get(ge).programs;de!==void 0&&(de.forEach(function(we){q.releaseProgram(we)}),ge.isShaderMaterial&&q.releaseShaderCache(ge))})(ue),F.remove(ue)}(oe)}function Xa(G,oe,ue){G.transparent===!0&&G.side===It&&G.forceSinglePass===!1?(G.side=Di,G.needsUpdate=!0,Ah(G,oe,ue),G.side=Ir,G.needsUpdate=!0,Ah(G,oe,ue),G.side=It):Ah(G,oe,ue)}this.xr=Lt,this.getContext=function(){return ie},this.getContextAttributes=function(){return ie.getContextAttributes()},this.forceContextLoss=function(){const G=O.get("WEBGL_lose_context");G&&G.loseContext()},this.forceContextRestore=function(){const G=O.get("WEBGL_lose_context");G&&G.restoreContext()},this.getPixelRatio=function(){return K},this.setPixelRatio=function(G){G!==void 0&&(K=G,this.setSize(B,$,!1))},this.getSize=function(G){return G.set(B,$)},this.setSize=function(G,oe,ue=!0){Lt.isPresenting||(B=G,$=oe,t.width=Math.floor(G*K),t.height=Math.floor(oe*K),ue===!0&&(t.style.width=G+"px",t.style.height=oe+"px"),this.setViewport(0,0,G,oe))},this.getDrawingBufferSize=function(G){return G.set(B*K,$*K).floor()},this.setDrawingBufferSize=function(G,oe,ue){B=G,$=oe,K=ue,t.width=Math.floor(G*ue),t.height=Math.floor(oe*ue),this.setViewport(0,0,G,oe)},this.getCurrentViewport=function(G){return G.copy(N)},this.getViewport=function(G){return G.copy(me)},this.setViewport=function(G,oe,ue,ge){G.isVector4?me.set(G.x,G.y,G.z,G.w):me.set(G,oe,ue,ge),Z.viewport(N.copy(me).multiplyScalar(K).round())},this.getScissor=function(G){return G.copy(H)},this.setScissor=function(G,oe,ue,ge){G.isVector4?H.set(G.x,G.y,G.z,G.w):H.set(G,oe,ue,ge),Z.scissor(D.copy(H).multiplyScalar(K).round())},this.getScissorTest=function(){return W},this.setScissorTest=function(G){Z.setScissorTest(W=G)},this.setOpaqueSort=function(G){ae=G},this.setTransparentSort=function(G){se=G},this.getClearColor=function(G){return G.copy(Re.getClearColor())},this.setClearColor=function(){Re.setClearColor.apply(Re,arguments)},this.getClearAlpha=function(){return Re.getClearAlpha()},this.setClearAlpha=function(){Re.setClearAlpha.apply(Re,arguments)},this.clear=function(G=!0,oe=!0,ue=!0){let ge=0;if(G){let de=!1;if(T!==null){const we=T.texture.format;de=we===Qg||we===Kg||we===Zg}if(de){const we=T.texture.type,Le=we===zn||we===Vn||we===$o||we===Da||we===Xg||we===qg,De=Re.getClearColor(),Fe=Re.getClearAlpha(),ze=De.r,Ye=De.g,Be=De.b;Le?(p[0]=ze,p[1]=Ye,p[2]=Be,p[3]=Fe,ie.clearBufferuiv(ie.COLOR,0,p)):(f[0]=ze,f[1]=Ye,f[2]=Be,f[3]=Fe,ie.clearBufferiv(ie.COLOR,0,f))}else ge|=ie.COLOR_BUFFER_BIT}oe&&(ge|=ie.DEPTH_BUFFER_BIT),ue&&(ge|=ie.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ie.clear(ge)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",wh,!1),t.removeEventListener("webglcontextrestored",Sh,!1),t.removeEventListener("webglcontextcreationerror",Sl,!1),_e.dispose(),le.dispose(),F.dispose(),U.dispose(),P.dispose(),Y.dispose(),st.dispose(),qi.dispose(),q.dispose(),Lt.dispose(),Lt.removeEventListener("sessionstart",nv),Lt.removeEventListener("sessionend",ov),qa.stop()},this.renderBufferDirect=function(G,oe,ue,ge,de,we){oe===null&&(oe=re);const Le=de.isMesh&&de.matrixWorld.determinant()<0,De=function(ut,jt,sr,et,Ze){jt.isScene!==!0&&(jt=re),X.resetTextureUnits();const Tl=jt.fog,Uw=et.isMeshStandardMaterial?jt.environment:null,kw=T===null?y.outputColorSpace:T.isXRRenderTarget===!0?T.texture.colorSpace:oi,Eh=(et.isMeshStandardMaterial?P:U).get(et.envMap||Uw),Fw=et.vertexColors===!0&&!!sr.attributes.color&&sr.attributes.color.itemSize===4,Bw=!!sr.attributes.tangent&&(!!et.normalMap||et.anisotropy>0),zw=!!sr.morphAttributes.position,Vw=!!sr.morphAttributes.normal,Hw=!!sr.morphAttributes.color;let pv=ms;et.toneMapped&&(T!==null&&T.isXRRenderTarget!==!0||(pv=y.toneMapping));const mv=sr.morphAttributes.position||sr.morphAttributes.normal||sr.morphAttributes.color,Gw=mv!==void 0?mv.length:0,at=F.get(et),jw=m.state.lights;if(te===!0&&(k===!0||ut!==C)){const xr=ut===C&&et.id===E;xe.setState(et,ut,xr)}let Dr=!1;et.version===at.__version?at.needsLights&&at.lightsStateVersion!==jw.state.version||at.outputColorSpace!==kw||Ze.isBatchedMesh&&at.batching===!1?Dr=!0:Ze.isBatchedMesh||at.batching!==!0?Ze.isBatchedMesh&&at.batchingColor===!0&&Ze.colorTexture===null||Ze.isBatchedMesh&&at.batchingColor===!1&&Ze.colorTexture!==null||Ze.isInstancedMesh&&at.instancing===!1?Dr=!0:Ze.isInstancedMesh||at.instancing!==!0?Ze.isSkinnedMesh&&at.skinning===!1?Dr=!0:Ze.isSkinnedMesh||at.skinning!==!0?Ze.isInstancedMesh&&at.instancingColor===!0&&Ze.instanceColor===null||Ze.isInstancedMesh&&at.instancingColor===!1&&Ze.instanceColor!==null||Ze.isInstancedMesh&&at.instancingMorph===!0&&Ze.morphTexture===null||Ze.isInstancedMesh&&at.instancingMorph===!1&&Ze.morphTexture!==null||at.envMap!==Eh||et.fog===!0&&at.fog!==Tl?Dr=!0:at.numClippingPlanes===void 0||at.numClippingPlanes===xe.numPlanes&&at.numIntersection===xe.numIntersection?(at.vertexAlphas!==Fw||at.vertexTangents!==Bw||at.morphTargets!==zw||at.morphNormals!==Vw||at.morphColors!==Hw||at.toneMapping!==pv||at.morphTargetsCount!==Gw)&&(Dr=!0):Dr=!0:Dr=!0:Dr=!0:Dr=!0:(Dr=!0,at.__version=et.version);let Ya=at.currentProgram;Dr===!0&&(Ya=Ah(et,jt,Ze));let fv=!1,Al=!1,Op=!1;const fi=Ya.getUniforms(),ta=at.uniforms;if(Z.useProgram(Ya.program)&&(fv=!0,Al=!0,Op=!0),et.id!==E&&(E=et.id,Al=!0),fv||C!==ut){fi.setValue(ie,"projectionMatrix",ut.projectionMatrix),fi.setValue(ie,"viewMatrix",ut.matrixWorldInverse);const xr=fi.map.cameraPosition;xr!==void 0&&xr.setValue(ie,ee.setFromMatrixPosition(ut.matrixWorld)),J.logarithmicDepthBuffer&&fi.setValue(ie,"logDepthBufFC",2/(Math.log(ut.far+1)/Math.LN2)),(et.isMeshPhongMaterial||et.isMeshToonMaterial||et.isMeshLambertMaterial||et.isMeshBasicMaterial||et.isMeshStandardMaterial||et.isShaderMaterial)&&fi.setValue(ie,"isOrthographic",ut.isOrthographicCamera===!0),C!==ut&&(C=ut,Al=!0,Op=!0)}if(Ze.isSkinnedMesh){fi.setOptional(ie,Ze,"bindMatrix"),fi.setOptional(ie,Ze,"bindMatrixInverse");const xr=Ze.skeleton;xr&&(xr.boneTexture===null&&xr.computeBoneTexture(),fi.setValue(ie,"boneTexture",xr.boneTexture,X))}Ze.isBatchedMesh&&(fi.setOptional(ie,Ze,"batchingTexture"),fi.setValue(ie,"batchingTexture",Ze._matricesTexture,X),fi.setOptional(ie,Ze,"batchingColorTexture"),Ze._colorsTexture!==null&&fi.setValue(ie,"batchingColorTexture",Ze._colorsTexture,X));const Up=sr.morphAttributes;Up.position===void 0&&Up.normal===void 0&&Up.color===void 0||Ee.update(Ze,sr,Ya),(Al||at.receiveShadow!==Ze.receiveShadow)&&(at.receiveShadow=Ze.receiveShadow,fi.setValue(ie,"receiveShadow",Ze.receiveShadow)),et.isMeshGouraudMaterial&&et.envMap!==null&&(ta.envMap.value=Eh,ta.flipEnvMap.value=Eh.isCubeTexture&&Eh.isRenderTargetTexture===!1?-1:1),et.isMeshStandardMaterial&&et.envMap===null&&jt.environment!==null&&(ta.envMapIntensity.value=jt.environmentIntensity),Al&&(fi.setValue(ie,"toneMappingExposure",y.toneMappingExposure),at.needsLights&&(Or=Op,($r=ta).ambientLightColor.needsUpdate=Or,$r.lightProbe.needsUpdate=Or,$r.directionalLights.needsUpdate=Or,$r.directionalLightShadows.needsUpdate=Or,$r.pointLights.needsUpdate=Or,$r.pointLightShadows.needsUpdate=Or,$r.spotLights.needsUpdate=Or,$r.spotLightShadows.needsUpdate=Or,$r.rectAreaLights.needsUpdate=Or,$r.hemisphereLights.needsUpdate=Or),Tl&&et.fog===!0&&pe.refreshFogUniforms(ta,Tl),pe.refreshMaterialUniforms(ta,et,K,$,m.state.transmissionRenderTarget[ut.id]),id.upload(ie,uv(at),ta,X));var $r,Or;if(et.isShaderMaterial&&et.uniformsNeedUpdate===!0&&(id.upload(ie,uv(at),ta,X),et.uniformsNeedUpdate=!1),et.isSpriteMaterial&&fi.setValue(ie,"center",Ze.center),fi.setValue(ie,"modelViewMatrix",Ze.modelViewMatrix),fi.setValue(ie,"normalMatrix",Ze.normalMatrix),fi.setValue(ie,"modelMatrix",Ze.matrixWorld),et.isShaderMaterial||et.isRawShaderMaterial){const xr=et.uniformsGroups;for(let kp=0,Ww=xr.length;kp<Ww;kp++){const gv=xr[kp];qi.update(gv,Ya),qi.bind(gv,Ya)}}return Ya}(G,oe,ue,ge,de);Z.setMaterial(ge,Le);let Fe=ue.index,ze=1;if(ge.wireframe===!0){if(Fe=V.getWireframeAttribute(ue),Fe===void 0)return;ze=2}const Ye=ue.drawRange,Be=ue.attributes.position;let nt=Ye.start*ze,Nt=(Ye.start+Ye.count)*ze;we!==null&&(nt=Math.max(nt,we.start*ze),Nt=Math.min(Nt,(we.start+we.count)*ze)),Fe!==null?(nt=Math.max(nt,0),Nt=Math.min(Nt,Fe.count)):Be!=null&&(nt=Math.max(nt,0),Nt=Math.min(Nt,Be.count));const ii=Nt-nt;if(ii<0||ii===1/0)return;let li;st.setup(de,ge,De,ue,Fe);let Dt=$e;if(Fe!==null&&(li=I.get(Fe),Dt=ke,Dt.setIndex(li)),de.isMesh)ge.wireframe===!0?(Z.setLineWidth(ge.wireframeLinewidth*Q()),Dt.setMode(ie.LINES)):Dt.setMode(ie.TRIANGLES);else if(de.isLine){let ut=ge.linewidth;ut===void 0&&(ut=1),Z.setLineWidth(ut*Q()),de.isLineSegments?Dt.setMode(ie.LINES):de.isLineLoop?Dt.setMode(ie.LINE_LOOP):Dt.setMode(ie.LINE_STRIP)}else de.isPoints?Dt.setMode(ie.POINTS):de.isSprite&&Dt.setMode(ie.TRIANGLES);if(de.isBatchedMesh)de._multiDrawInstances!==null?Dt.renderMultiDrawInstances(de._multiDrawStarts,de._multiDrawCounts,de._multiDrawCount,de._multiDrawInstances):Dt.renderMultiDraw(de._multiDrawStarts,de._multiDrawCounts,de._multiDrawCount);else if(de.isInstancedMesh)Dt.renderInstances(nt,ii,de.count);else if(ue.isInstancedBufferGeometry){const ut=ue._maxInstanceCount!==void 0?ue._maxInstanceCount:1/0,jt=Math.min(ue.instanceCount,ut);Dt.renderInstances(nt,ii,jt)}else Dt.render(nt,ii)},this.compile=function(G,oe,ue=null){ue===null&&(ue=G),m=le.get(ue),m.init(oe),_.push(m),ue.traverseVisible(function(de){de.isLight&&de.layers.test(oe.layers)&&(m.pushLight(de),de.castShadow&&m.pushShadow(de))}),G!==ue&&G.traverseVisible(function(de){de.isLight&&de.layers.test(oe.layers)&&(m.pushLight(de),de.castShadow&&m.pushShadow(de))}),m.setupLights();const ge=new Set;return G.traverse(function(de){const we=de.material;if(we)if(Array.isArray(we))for(let Le=0;Le<we.length;Le++){const De=we[Le];Xa(De,ue,de),ge.add(De)}else Xa(we,ue,de),ge.add(we)}),_.pop(),m=null,ge},this.compileAsync=function(G,oe,ue=null){const ge=this.compile(G,oe,ue);return new Promise(de=>{function we(){ge.forEach(function(Le){F.get(Le).currentProgram.isReady()&&ge.delete(Le)}),ge.size!==0?setTimeout(we,10):de(G)}O.get("KHR_parallel_shader_compile")!==null?we():setTimeout(we,10)})};let Np=null;function nv(){qa.stop()}function ov(){qa.start()}const qa=new Ax;function Dp(G,oe,ue,ge){if(G.visible===!1)return;if(G.layers.test(oe.layers)){if(G.isGroup)ue=G.renderOrder;else if(G.isLOD)G.autoUpdate===!0&&G.update(oe);else if(G.isLight)m.pushLight(G),G.castShadow&&m.pushShadow(G);else if(G.isSprite){if(!G.frustumCulled||ce.intersectsSprite(G)){ge&&ee.setFromMatrixPosition(G.matrixWorld).applyMatrix4(z);const we=Y.update(G),Le=G.material;Le.visible&&g.push(G,we,Le,ue,ee.z,null)}}else if((G.isMesh||G.isLine||G.isPoints)&&(!G.frustumCulled||ce.intersectsObject(G))){const we=Y.update(G),Le=G.material;if(ge&&(G.boundingSphere!==void 0?(G.boundingSphere===null&&G.computeBoundingSphere(),ee.copy(G.boundingSphere.center)):(we.boundingSphere===null&&we.computeBoundingSphere(),ee.copy(we.boundingSphere.center)),ee.applyMatrix4(G.matrixWorld).applyMatrix4(z)),Array.isArray(Le)){const De=we.groups;for(let Fe=0,ze=De.length;Fe<ze;Fe++){const Ye=De[Fe],Be=Le[Ye.materialIndex];Be&&Be.visible&&g.push(G,we,Be,ue,ee.z,Ye)}}else Le.visible&&g.push(G,we,Le,ue,ee.z,null)}}const de=G.children;for(let we=0,Le=de.length;we<Le;we++)Dp(de[we],oe,ue,ge)}function lv(G,oe,ue,ge){const de=G.opaque,we=G.transmissive,Le=G.transparent;m.setupLightsView(ue),te===!0&&xe.setGlobalState(y.clippingPlanes,ue),ge&&Z.viewport(N.copy(ge)),de.length>0&&Th(de,oe,ue),we.length>0&&Th(we,oe,ue),Le.length>0&&Th(Le,oe,ue),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function cv(G,oe,ue,ge){if((ue.isScene===!0?ue.overrideMaterial:null)!==null)return;m.state.transmissionRenderTarget[ge.id]===void 0&&(m.state.transmissionRenderTarget[ge.id]=new ft(1,1,{generateMipmaps:!0,type:O.has("EXT_color_buffer_half_float")||O.has("EXT_color_buffer_float")?Qt:zn,minFilter:fs,samples:4,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ht.workingColorSpace}));const de=m.state.transmissionRenderTarget[ge.id],we=ge.viewport||N;de.setSize(we.z,we.w);const Le=y.getRenderTarget();y.setRenderTarget(de),y.getClearColor(L),w=y.getClearAlpha(),w<1&&y.setClearColor(16777215,.5),j?Re.render(ue):y.clear();const De=y.toneMapping;y.toneMapping=ms;const Fe=ge.viewport;if(ge.viewport!==void 0&&(ge.viewport=void 0),m.setupLightsView(ge),te===!0&&xe.setGlobalState(y.clippingPlanes,ge),Th(G,ue,ge),X.updateMultisampleRenderTarget(de),X.updateRenderTargetMipmap(de),O.has("WEBGL_multisampled_render_to_texture")===!1){let ze=!1;for(let Ye=0,Be=oe.length;Ye<Be;Ye++){const nt=oe[Ye],Nt=nt.object,ii=nt.geometry,li=nt.material,Dt=nt.group;if(li.side===It&&Nt.layers.test(ge.layers)){const ut=li.side;li.side=Di,li.needsUpdate=!0,hv(Nt,ue,ge,ii,li,Dt),li.side=ut,li.needsUpdate=!0,ze=!0}}ze===!0&&(X.updateMultisampleRenderTarget(de),X.updateRenderTargetMipmap(de))}y.setRenderTarget(Le),y.setClearColor(L,w),Fe!==void 0&&(ge.viewport=Fe),y.toneMapping=De}function Th(G,oe,ue){const ge=oe.isScene===!0?oe.overrideMaterial:null;for(let de=0,we=G.length;de<we;de++){const Le=G[de],De=Le.object,Fe=Le.geometry,ze=ge===null?Le.material:ge,Ye=Le.group;De.layers.test(ue.layers)&&hv(De,oe,ue,Fe,ze,Ye)}}function hv(G,oe,ue,ge,de,we){G.onBeforeRender(y,oe,ue,ge,de,we),G.modelViewMatrix.multiplyMatrices(ue.matrixWorldInverse,G.matrixWorld),G.normalMatrix.getNormalMatrix(G.modelViewMatrix),de.onBeforeRender(y,oe,ue,ge,G,we),de.transparent===!0&&de.side===It&&de.forceSinglePass===!1?(de.side=Di,de.needsUpdate=!0,y.renderBufferDirect(ue,oe,ge,de,G,we),de.side=Ir,de.needsUpdate=!0,y.renderBufferDirect(ue,oe,ge,de,G,we),de.side=It):y.renderBufferDirect(ue,oe,ge,de,G,we),G.onAfterRender(y,oe,ue,ge,de,we)}function Ah(G,oe,ue){oe.isScene!==!0&&(oe=re);const ge=F.get(G),de=m.state.lights,we=m.state.shadowsArray,Le=de.state.version,De=q.getParameters(G,de.state,we,oe,ue),Fe=q.getProgramCacheKey(De);let ze=ge.programs;ge.environment=G.isMeshStandardMaterial?oe.environment:null,ge.fog=oe.fog,ge.envMap=(G.isMeshStandardMaterial?P:U).get(G.envMap||ge.environment),ge.envMapRotation=ge.environment!==null&&G.envMap===null?oe.environmentRotation:G.envMapRotation,ze===void 0&&(G.addEventListener("dispose",ea),ze=new Map,ge.programs=ze);let Ye=ze.get(Fe);if(Ye!==void 0){if(ge.currentProgram===Ye&&ge.lightsStateVersion===Le)return dv(G,De),Ye}else De.uniforms=q.getUniforms(G),G.onBuild(ue,De,y),G.onBeforeCompile(De,y),Ye=q.acquireProgram(De,Fe),ze.set(Fe,Ye),ge.uniforms=De.uniforms;const Be=ge.uniforms;return(G.isShaderMaterial||G.isRawShaderMaterial)&&G.clipping!==!0||(Be.clippingPlanes=xe.uniform),dv(G,De),ge.needsLights=function(nt){return nt.isMeshLambertMaterial||nt.isMeshToonMaterial||nt.isMeshPhongMaterial||nt.isMeshStandardMaterial||nt.isShadowMaterial||nt.isShaderMaterial&&nt.lights===!0}(G),ge.lightsStateVersion=Le,ge.needsLights&&(Be.ambientLightColor.value=de.state.ambient,Be.lightProbe.value=de.state.probe,Be.directionalLights.value=de.state.directional,Be.directionalLightShadows.value=de.state.directionalShadow,Be.spotLights.value=de.state.spot,Be.spotLightShadows.value=de.state.spotShadow,Be.rectAreaLights.value=de.state.rectArea,Be.ltc_1.value=de.state.rectAreaLTC1,Be.ltc_2.value=de.state.rectAreaLTC2,Be.pointLights.value=de.state.point,Be.pointLightShadows.value=de.state.pointShadow,Be.hemisphereLights.value=de.state.hemi,Be.directionalShadowMap.value=de.state.directionalShadowMap,Be.directionalShadowMatrix.value=de.state.directionalShadowMatrix,Be.spotShadowMap.value=de.state.spotShadowMap,Be.spotLightMatrix.value=de.state.spotLightMatrix,Be.spotLightMap.value=de.state.spotLightMap,Be.pointShadowMap.value=de.state.pointShadowMap,Be.pointShadowMatrix.value=de.state.pointShadowMatrix),ge.currentProgram=Ye,ge.uniformsList=null,Ye}function uv(G){if(G.uniformsList===null){const oe=G.currentProgram.getUniforms();G.uniformsList=id.seqWithValue(oe.seq,G.uniforms)}return G.uniformsList}function dv(G,oe){const ue=F.get(G);ue.outputColorSpace=oe.outputColorSpace,ue.batching=oe.batching,ue.batchingColor=oe.batchingColor,ue.instancing=oe.instancing,ue.instancingColor=oe.instancingColor,ue.instancingMorph=oe.instancingMorph,ue.skinning=oe.skinning,ue.morphTargets=oe.morphTargets,ue.morphNormals=oe.morphNormals,ue.morphColors=oe.morphColors,ue.morphTargetsCount=oe.morphTargetsCount,ue.numClippingPlanes=oe.numClippingPlanes,ue.numIntersection=oe.numClipIntersection,ue.vertexAlphas=oe.vertexAlphas,ue.vertexTangents=oe.vertexTangents,ue.toneMapping=oe.toneMapping}qa.setAnimationLoop(function(G){Np&&Np(G)}),typeof self<"u"&&qa.setContext(self),this.setAnimationLoop=function(G){Np=G,Lt.setAnimationLoop(G),G===null?qa.stop():qa.start()},Lt.addEventListener("sessionstart",nv),Lt.addEventListener("sessionend",ov),this.render=function(G,oe){if(oe!==void 0&&oe.isCamera!==!0||x===!0)return;if(G.matrixWorldAutoUpdate===!0&&G.updateMatrixWorld(),oe.parent===null&&oe.matrixWorldAutoUpdate===!0&&oe.updateMatrixWorld(),Lt.enabled===!0&&Lt.isPresenting===!0&&(Lt.cameraAutoUpdate===!0&&Lt.updateCamera(oe),oe=Lt.getCamera()),G.isScene===!0&&G.onBeforeRender(y,G,oe,T),m=le.get(G,_.length),m.init(oe),_.push(m),z.multiplyMatrices(oe.projectionMatrix,oe.matrixWorldInverse),ce.setFromProjectionMatrix(z),k=this.localClippingEnabled,te=xe.init(this.clippingPlanes,k),g=_e.get(G,v.length),g.init(),v.push(g),Lt.enabled===!0&&Lt.isPresenting===!0){const we=y.xr.getDepthSensingMesh();we!==null&&Dp(we,oe,-1/0,y.sortObjects)}Dp(G,oe,0,y.sortObjects),g.finish(),y.sortObjects===!0&&g.sort(ae,se),j=Lt.enabled===!1||Lt.isPresenting===!1||Lt.hasDepthSensing()===!1,j&&Re.addToRenderList(g,G),this.info.render.frame++,te===!0&&xe.beginShadows();const ue=m.state.shadowsArray;Pe.render(ue,G,oe),te===!0&&xe.endShadows(),this.info.autoReset===!0&&this.info.reset();const ge=g.opaque,de=g.transmissive;if(m.setupLights(),oe.isArrayCamera){const we=oe.cameras;if(de.length>0)for(let Le=0,De=we.length;Le<De;Le++)cv(ge,de,G,we[Le]);j&&Re.render(G);for(let Le=0,De=we.length;Le<De;Le++){const Fe=we[Le];lv(g,G,Fe,Fe.viewport)}}else de.length>0&&cv(ge,de,G,oe),j&&Re.render(G),lv(g,G,oe);T!==null&&(X.updateMultisampleRenderTarget(T),X.updateRenderTargetMipmap(T)),G.isScene===!0&&G.onAfterRender(y,G,oe),st.resetDefaultState(),E=-1,C=null,_.pop(),_.length>0?(m=_[_.length-1],te===!0&&xe.setGlobalState(y.clippingPlanes,m.state.camera)):m=null,v.pop(),g=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(G,oe,ue){F.get(G.texture).__webglTexture=oe,F.get(G.depthTexture).__webglTexture=ue;const ge=F.get(G);ge.__hasExternalTextures=!0,ge.__autoAllocateDepthBuffer=ue===void 0,ge.__autoAllocateDepthBuffer||O.has("WEBGL_multisampled_render_to_texture")===!0&&(ge.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(G,oe){const ue=F.get(G);ue.__webglFramebuffer=oe,ue.__useDefaultFramebuffer=oe===void 0},this.setRenderTarget=function(G,oe=0,ue=0){T=G,b=oe,M=ue;let ge=!0,de=null,we=!1,Le=!1;if(G){const De=F.get(G);De.__useDefaultFramebuffer!==void 0?(Z.bindFramebuffer(ie.FRAMEBUFFER,null),ge=!1):De.__webglFramebuffer===void 0?X.setupRenderTarget(G):De.__hasExternalTextures&&X.rebindTextures(G,F.get(G.texture).__webglTexture,F.get(G.depthTexture).__webglTexture);const Fe=G.texture;(Fe.isData3DTexture||Fe.isDataArrayTexture||Fe.isCompressedArrayTexture)&&(Le=!0);const ze=F.get(G).__webglFramebuffer;G.isWebGLCubeRenderTarget?(de=Array.isArray(ze[oe])?ze[oe][ue]:ze[oe],we=!0):de=G.samples>0&&X.useMultisampledRTT(G)===!1?F.get(G).__webglMultisampledFramebuffer:Array.isArray(ze)?ze[ue]:ze,N.copy(G.viewport),D.copy(G.scissor),A=G.scissorTest}else N.copy(me).multiplyScalar(K).floor(),D.copy(H).multiplyScalar(K).floor(),A=W;if(Z.bindFramebuffer(ie.FRAMEBUFFER,de)&&ge&&Z.drawBuffers(G,de),Z.viewport(N),Z.scissor(D),Z.setScissorTest(A),we){const De=F.get(G.texture);ie.framebufferTexture2D(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,ie.TEXTURE_CUBE_MAP_POSITIVE_X+oe,De.__webglTexture,ue)}else if(Le){const De=F.get(G.texture),Fe=oe||0;ie.framebufferTextureLayer(ie.FRAMEBUFFER,ie.COLOR_ATTACHMENT0,De.__webglTexture,ue||0,Fe)}E=-1},this.readRenderTargetPixels=function(G,oe,ue,ge,de,we,Le){if(!G||!G.isWebGLRenderTarget)return;let De=F.get(G).__webglFramebuffer;if(G.isWebGLCubeRenderTarget&&Le!==void 0&&(De=De[Le]),De){Z.bindFramebuffer(ie.FRAMEBUFFER,De);try{const Fe=G.texture,ze=Fe.format,Ye=Fe.type;if(!J.textureFormatReadable(ze)||!J.textureTypeReadable(Ye))return;oe>=0&&oe<=G.width-ge&&ue>=0&&ue<=G.height-de&&ie.readPixels(oe,ue,ge,de,vt.convert(ze),vt.convert(Ye),we)}finally{const Fe=T!==null?F.get(T).__webglFramebuffer:null;Z.bindFramebuffer(ie.FRAMEBUFFER,Fe)}}},this.readRenderTargetPixelsAsync=function(G,oe,ue,ge,de,we,Le){return Wr(this,null,function*(){if(!G||!G.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let De=F.get(G).__webglFramebuffer;if(G.isWebGLCubeRenderTarget&&Le!==void 0&&(De=De[Le]),De){Z.bindFramebuffer(ie.FRAMEBUFFER,De);try{const Fe=G.texture,ze=Fe.format,Ye=Fe.type;if(!J.textureFormatReadable(ze))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!J.textureTypeReadable(Ye))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(oe>=0&&oe<=G.width-ge&&ue>=0&&ue<=G.height-de){const Be=ie.createBuffer();ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Be),ie.bufferData(ie.PIXEL_PACK_BUFFER,we.byteLength,ie.STREAM_READ),ie.readPixels(oe,ue,ge,de,vt.convert(ze),vt.convert(Ye),0),ie.flush();const nt=ie.fenceSync(ie.SYNC_GPU_COMMANDS_COMPLETE,0);yield function(Nt,ii,li){return new Promise(function(Dt,ut){setTimeout(function jt(){switch(Nt.clientWaitSync(ii,Nt.SYNC_FLUSH_COMMANDS_BIT,0)){case Nt.WAIT_FAILED:ut();break;case Nt.TIMEOUT_EXPIRED:setTimeout(jt,li);break;default:Dt()}},li)})}(ie,nt,4);try{ie.bindBuffer(ie.PIXEL_PACK_BUFFER,Be),ie.getBufferSubData(ie.PIXEL_PACK_BUFFER,0,we)}finally{ie.deleteBuffer(Be),ie.deleteSync(nt)}return we}}finally{const Fe=T!==null?F.get(T).__webglFramebuffer:null;Z.bindFramebuffer(ie.FRAMEBUFFER,Fe)}}})},this.copyFramebufferToTexture=function(G,oe=null,ue=0){G.isTexture!==!0&&(oe=arguments[0]||null,G=arguments[1]);const ge=Math.pow(2,-ue),de=Math.floor(G.image.width*ge),we=Math.floor(G.image.height*ge),Le=oe!==null?oe.x:0,De=oe!==null?oe.y:0;X.setTexture2D(G,0),ie.copyTexSubImage2D(ie.TEXTURE_2D,ue,0,0,Le,De,de,we),Z.unbindTexture()},this.copyTextureToTexture=function(G,oe,ue=null,ge=null,de=0){let we,Le,De,Fe,ze,Ye;G.isTexture!==!0&&(ge=arguments[0]||null,G=arguments[1],oe=arguments[2],de=arguments[3]||0,ue=null),ue!==null?(we=ue.max.x-ue.min.x,Le=ue.max.y-ue.min.y,De=ue.min.x,Fe=ue.min.y):(we=G.image.width,Le=G.image.height,De=0,Fe=0),ge!==null?(ze=ge.x,Ye=ge.y):(ze=0,Ye=0);const Be=vt.convert(oe.format),nt=vt.convert(oe.type);X.setTexture2D(oe,0),ie.pixelStorei(ie.UNPACK_FLIP_Y_WEBGL,oe.flipY),ie.pixelStorei(ie.UNPACK_PREMULTIPLY_ALPHA_WEBGL,oe.premultiplyAlpha),ie.pixelStorei(ie.UNPACK_ALIGNMENT,oe.unpackAlignment);const Nt=ie.getParameter(ie.UNPACK_ROW_LENGTH),ii=ie.getParameter(ie.UNPACK_IMAGE_HEIGHT),li=ie.getParameter(ie.UNPACK_SKIP_PIXELS),Dt=ie.getParameter(ie.UNPACK_SKIP_ROWS),ut=ie.getParameter(ie.UNPACK_SKIP_IMAGES),jt=G.isCompressedTexture?G.mipmaps[de]:G.image;ie.pixelStorei(ie.UNPACK_ROW_LENGTH,jt.width),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,jt.height),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,De),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,Fe),G.isDataTexture?ie.texSubImage2D(ie.TEXTURE_2D,de,ze,Ye,we,Le,Be,nt,jt.data):G.isCompressedTexture?ie.compressedTexSubImage2D(ie.TEXTURE_2D,de,ze,Ye,jt.width,jt.height,Be,jt.data):ie.texSubImage2D(ie.TEXTURE_2D,de,ze,Ye,Be,nt,jt),ie.pixelStorei(ie.UNPACK_ROW_LENGTH,Nt),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,ii),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,li),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,Dt),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,ut),de===0&&oe.generateMipmaps&&ie.generateMipmap(ie.TEXTURE_2D),Z.unbindTexture()},this.copyTextureToTexture3D=function(G,oe,ue=null,ge=null,de=0){let we,Le,De,Fe,ze,Ye,Be,nt,Nt;G.isTexture!==!0&&(ue=arguments[0]||null,ge=arguments[1]||null,G=arguments[2],oe=arguments[3],de=arguments[4]||0);const ii=G.isCompressedTexture?G.mipmaps[de]:G.image;ue!==null?(we=ue.max.x-ue.min.x,Le=ue.max.y-ue.min.y,De=ue.max.z-ue.min.z,Fe=ue.min.x,ze=ue.min.y,Ye=ue.min.z):(we=ii.width,Le=ii.height,De=ii.depth,Fe=0,ze=0,Ye=0),ge!==null?(Be=ge.x,nt=ge.y,Nt=ge.z):(Be=0,nt=0,Nt=0);const li=vt.convert(oe.format),Dt=vt.convert(oe.type);let ut;if(oe.isData3DTexture)X.setTexture3D(oe,0),ut=ie.TEXTURE_3D;else{if(!oe.isDataArrayTexture&&!oe.isCompressedArrayTexture)return;X.setTexture2DArray(oe,0),ut=ie.TEXTURE_2D_ARRAY}ie.pixelStorei(ie.UNPACK_FLIP_Y_WEBGL,oe.flipY),ie.pixelStorei(ie.UNPACK_PREMULTIPLY_ALPHA_WEBGL,oe.premultiplyAlpha),ie.pixelStorei(ie.UNPACK_ALIGNMENT,oe.unpackAlignment);const jt=ie.getParameter(ie.UNPACK_ROW_LENGTH),sr=ie.getParameter(ie.UNPACK_IMAGE_HEIGHT),et=ie.getParameter(ie.UNPACK_SKIP_PIXELS),Ze=ie.getParameter(ie.UNPACK_SKIP_ROWS),Tl=ie.getParameter(ie.UNPACK_SKIP_IMAGES);ie.pixelStorei(ie.UNPACK_ROW_LENGTH,ii.width),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,ii.height),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,Fe),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,ze),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,Ye),G.isDataTexture||G.isData3DTexture?ie.texSubImage3D(ut,de,Be,nt,Nt,we,Le,De,li,Dt,ii.data):oe.isCompressedArrayTexture?ie.compressedTexSubImage3D(ut,de,Be,nt,Nt,we,Le,De,li,ii.data):ie.texSubImage3D(ut,de,Be,nt,Nt,we,Le,De,li,Dt,ii),ie.pixelStorei(ie.UNPACK_ROW_LENGTH,jt),ie.pixelStorei(ie.UNPACK_IMAGE_HEIGHT,sr),ie.pixelStorei(ie.UNPACK_SKIP_PIXELS,et),ie.pixelStorei(ie.UNPACK_SKIP_ROWS,Ze),ie.pixelStorei(ie.UNPACK_SKIP_IMAGES,Tl),de===0&&oe.generateMipmaps&&ie.generateMipmap(ut),Z.unbindTexture()},this.initRenderTarget=function(G){F.get(G).__webglFramebuffer===void 0&&X.setupRenderTarget(G)},this.initTexture=function(G){G.isCubeTexture?X.setTextureCube(G,0):G.isData3DTexture?X.setTexture3D(G,0):G.isDataArrayTexture||G.isCompressedArrayTexture?X.setTexture2DArray(G,0):X.setTexture2D(G,0),Z.unbindTexture()},this.resetState=function(){b=0,M=0,T=null,Z.reset(),st.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Hn}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===np?"display-p3":"srgb",t.unpackColorSpace=ht.workingColorSpace===hh?"display-p3":"srgb"}}class al{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new fe(e),this.density=t}clone(){return new al(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class nl{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new fe(e),this.near=t,this.far=r}clone(){return new nl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class $f extends je{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Rt,this.environmentIntensity=1,this.environmentRotation=new Rt,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class ph{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Ic,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=vr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return i0("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let s=0,a=this.stride;s<a;s++)this.array[e+s]=t.array[r+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=vr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=vr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ki=new R;class Ji{constructor(e,t,r,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)ki.fromBufferAttribute(this,t),ki.applyMatrix4(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)ki.fromBufferAttribute(this,t),ki.applyNormalMatrix(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)ki.fromBufferAttribute(this,t),ki.transformDirection(e),this.setXYZ(t,ki.x,ki.y,ki.z);return this}getComponent(e,t){let r=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(r=Gi(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Ge(r,this.array)),this.data.array[e*this.data.stride+this.offset+t]=r,this}setX(e,t){return this.normalized&&(t=Ge(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Ge(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Ge(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Ge(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Gi(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Gi(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Gi(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Gi(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ge(t,this.array),r=Ge(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ge(t,this.array),r=Ge(r,this.array),s=Ge(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=s,this}setXYZW(e,t,r,s,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=Ge(t,this.array),r=Ge(r,this.array),s=Ge(s,this.array),a=Ge(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=s,this.data.array[e+3]=a,this}clone(e){if(e===void 0){const t=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[s+a])}return new tt(new this.array.constructor(t),this.itemSize,this.normalized)}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ji(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){const t=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[s+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class n0 extends ti{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new fe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let fo;const Ll=new R,go=new R,vo=new R,_o=new ne,Nl=new ne,Ox=new Me,Qh=new R,Dl=new R,Jh=new R,l_=new ne,cm=new ne,c_=new ne;class h_ extends je{constructor(e=new n0){if(super(),this.isSprite=!0,this.type="Sprite",fo===void 0){fo=new Oe;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new ph(t,5);fo.setIndex([0,1,2,0,2,3]),fo.setAttribute("position",new Ji(r,3,0,!1)),fo.setAttribute("uv",new Ji(r,2,3,!1))}this.geometry=fo,this.material=e,this.center=new ne(.5,.5)}raycast(e,t){e.camera,go.setFromMatrixScale(this.matrixWorld),Ox.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),vo.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&go.multiplyScalar(-vo.z);const r=this.material.rotation;let s,a;r!==0&&(a=Math.cos(r),s=Math.sin(r));const n=this.center;$h(Qh.set(-.5,-.5,0),vo,n,go,s,a),$h(Dl.set(.5,-.5,0),vo,n,go,s,a),$h(Jh.set(.5,.5,0),vo,n,go,s,a),l_.set(0,0),cm.set(1,0),c_.set(1,1);let o=e.ray.intersectTriangle(Qh,Dl,Jh,!1,Ll);if(o===null&&($h(Dl.set(-.5,.5,0),vo,n,go,s,a),cm.set(0,1),o=e.ray.intersectTriangle(Qh,Jh,Dl,!1,Ll),o===null))return;const l=e.ray.origin.distanceTo(Ll);l<e.near||l>e.far||t.push({distance:l,point:Ll.clone(),uv:dr.getInterpolation(Ll,Qh,Dl,Jh,l_,cm,c_,new ne),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function $h(i,e,t,r,s,a){_o.subVectors(i,t).addScalar(.5).multiply(r),s!==void 0?(Nl.x=a*_o.x-s*_o.y,Nl.y=s*_o.x+a*_o.y):Nl.copy(_o),i.copy(e),i.x+=Nl.x,i.y+=Nl.y,i.applyMatrix4(Ox)}const eu=new R,u_=new R;class d_ extends je{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let r=0,s=t.length;r<s;r++){const a=t[r];this.addLevel(a.object.clone(),a.distance,a.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);const s=this.levels;let a;for(a=0;a<s.length&&!(t<s[a].distance);a++);return s.splice(a,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let r,s;for(r=1,s=t.length;r<s;r++){let a=t[r].distance;if(t[r].object.visible&&(a-=a*t[r].hysteresis),e<a)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){eu.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(eu);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){eu.setFromMatrixPosition(e.matrixWorld),u_.setFromMatrixPosition(this.matrixWorld);const r=eu.distanceTo(u_)/e.zoom;let s,a;for(t[0].object.visible=!0,s=1,a=t.length;s<a;s++){let n=t[s].distance;if(t[s].object.visible&&(n-=n*t[s].hysteresis),!(r>=n))break;t[s-1].object.visible=!1,t[s].object.visible=!0}for(this._currentLevel=s-1;s<a;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const r=this.levels;for(let s=0,a=r.length;s<a;s++){const n=r[s];t.object.levels.push({object:n.object.uuid,distance:n.distance,hysteresis:n.hysteresis})}return t}}const p_=new R,m_=new qe,f_=new qe,TT=new R,g_=new Me,tu=new R,hm=new di,v_=new Me,um=new Zn;class fd extends ye{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=bf,this.bindMatrix=new Me,this.bindMatrixInverse=new Me,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Et),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,tu),this.boundingBox.expandByPoint(tu)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new di),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,tu),this.boundingSphere.expandByPoint(tu)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.material,s=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),hm.copy(this.boundingSphere),hm.applyMatrix4(s),e.ray.intersectsSphere(hm)!==!1&&(v_.copy(s).invert(),um.copy(e.ray).applyMatrix4(v_),this.boundingBox!==null&&um.intersectsBox(this.boundingBox)===!1||this._computeIntersections(e,t,um)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new qe,t=this.geometry.attributes.skinWeight;for(let r=0,s=t.count;r<s;r++){e.fromBufferAttribute(t,r);const a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===bf?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===gx&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}applyBoneTransform(e,t){const r=this.skeleton,s=this.geometry;m_.fromBufferAttribute(s.attributes.skinIndex,e),f_.fromBufferAttribute(s.attributes.skinWeight,e),p_.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let a=0;a<4;a++){const n=f_.getComponent(a);if(n!==0){const o=m_.getComponent(a);g_.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),t.addScaledVector(TT.copy(p_).applyMatrix4(g_),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}class ol extends je{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Bs extends wt{constructor(e=null,t=1,r=1,s,a,n,o,l,c=1003,h=1003,u,d){super(null,n,o,l,c,h,s,a,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const __=new Me,AT=new Me;class ll{constructor(e=[],t=[]){this.uuid=vr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),t.length===0)this.calculateInverses();else if(e.length!==t.length){this.boneInverses=[];for(let r=0,s=this.bones.length;r<s;r++)this.boneInverses.push(new Me)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const r=new Me;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,s=this.boneTexture;for(let a=0,n=e.length;a<n;a++){const o=e[a]?e[a].matrixWorld:AT;__.multiplyMatrices(o,t[a]),__.toArray(r,16*a)}s!==null&&(s.needsUpdate=!0)}clone(){return new ll(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new Bs(t,e,e,Pr,mr);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,s=e.bones.length;r<s;r++){let a=t[e.bones[r]];a===void 0&&(a=new ol),this.bones.push(a),this.boneInverses.push(new Me().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let s=0,a=t.length;s<a;s++){const n=t[s];e.bones.push(n.uuid);const o=r[s];e.boneInverses.push(o.toArray())}return e}}class In extends tt{constructor(e,t,r,s=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const yo=new Me,y_=new Me,iu=[],x_=new Et,ET=new Me,Ol=new ye,Ul=new di;class eg extends ye{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new In(new Float32Array(16*r),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<r;s++)this.setMatrixAt(s,ET)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Et),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,yo),x_.copy(e.boundingBox).applyMatrix4(yo),this.boundingBox.union(x_)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new di),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,yo),Ul.copy(e.boundingSphere).applyMatrix4(yo),this.boundingSphere.union(Ul)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const r=t.morphTargetInfluences,s=this.morphTexture.source.data.data,a=e*(r.length+1)+1;for(let n=0;n<r.length;n++)r[n]=s[a+n]}raycast(e,t){const r=this.matrixWorld,s=this.count;if(Ol.geometry=this.geometry,Ol.material=this.material,Ol.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Ul.copy(this.boundingSphere),Ul.applyMatrix4(r),e.ray.intersectsSphere(Ul)!==!1))for(let a=0;a<s;a++){this.getMatrixAt(a,yo),y_.multiplyMatrices(r,yo),Ol.matrixWorld=y_,Ol.raycast(e,iu);for(let n=0,o=iu.length;n<o;n++){const l=iu[n];l.instanceId=a,l.object=this,t.push(l)}iu.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new In(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const r=t.morphTargetInfluences,s=r.length+1;this.morphTexture===null&&(this.morphTexture=new Bs(new Float32Array(s*this.count),s,this.count,Yg,mr));const a=this.morphTexture.source.data.data;let n=0;for(let c=0;c<r.length;c++)n+=r[c];const o=this.geometry.morphTargetsRelative?1:1-n,l=s*e;a[l]=o,a.set(r,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function CT(i,e){return i.z-e.z}function RT(i,e){return e.z-i.z}class PT{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const r=this.pool,s=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});const a=r[this.index];s.push(a),this.index++,a.start=e.start,a.count=e.count,a.z=t}reset(){this.list.length=0,this.index=0}}const xo="batchId",la=new Me,dm=new Me,IT=new Me,LT=new fe(1,1,1),b_=new Me,pm=new uh,ru=new Et,tn=new di,kl=new R,M_=new R,NT=new R,mm=new PT,Pi=new ye,su=[];function DT(i,e,t=0){const r=e.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==e.array.constructor){const s=i.count;for(let a=0;a<s;a++)for(let n=0;n<r;n++)e.setComponent(a+t,n,i.getComponent(a,n))}else e.array.set(i.array,t*r);e.needsUpdate=!0}class w_ extends ye{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,r=2*t,s){super(new Oe,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture(),this._colorsTexture=null}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),r=new Bs(t,e,e,Pr,mr);this._matricesTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxGeometryCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),r=new Bs(t,e,e,Pr,mr);r.colorSpace=ht.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const t=this.geometry,r=this._maxVertexCount,s=this._maxGeometryCount,a=this._maxIndexCount;if(this._geometryInitialized===!1){for(const o in e.attributes){const l=e.getAttribute(o),{array:c,itemSize:h,normalized:u}=l,d=new c.constructor(r*h),p=new tt(d,h,u);t.setAttribute(o,p)}if(e.getIndex()!==null){const o=r>65536?new Uint32Array(a):new Uint16Array(a);t.setIndex(new tt(o,1))}const n=s>65536?new Uint32Array(r):new Uint16Array(r);t.setAttribute(xo,new tt(n,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(xo))throw new Error(`BatchedMesh: Geometry cannot use attribute "${xo}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in t.attributes){if(r===xo)continue;if(!e.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const s=e.getAttribute(r),a=t.getAttribute(r);if(s.itemSize!==a.itemSize||s.normalized!==a.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Et);const e=this._geometryCount,t=this.boundingBox,r=this._active;t.makeEmpty();for(let s=0;s<e;s++)r[s]!==!1&&(this.getMatrixAt(s,la),this.getBoundingBoxAt(s,ru).applyMatrix4(la),t.union(ru))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new di);const e=this._geometryCount,t=this.boundingSphere,r=this._active;t.makeEmpty();for(let s=0;s<e;s++)r[s]!==!1&&(this.getMatrixAt(s,la),this.getBoundingSphereAt(s,tn).applyMatrix4(la),t.union(tn))}addGeometry(e,t=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const s={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let a=null;const n=this._reservedRanges,o=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(a=n[n.length-1]),s.vertexCount=t===-1?e.getAttribute("position").count:t,s.vertexStart=a===null?0:a.vertexStart+a.vertexCount;const c=e.getIndex(),h=c!==null;if(h&&(s.indexCount=r===-1?c.count:r,s.indexStart=a===null?0:a.indexStart+a.indexCount),s.indexStart!==-1&&s.indexStart+s.indexCount>this._maxIndexCount||s.vertexStart+s.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const u=this._visibility,d=this._active,p=this._matricesTexture,f=this._matricesTexture.image.data,g=this._colorsTexture;u.push(!0),d.push(!0);const m=this._geometryCount;this._geometryCount++,IT.toArray(f,16*m),p.needsUpdate=!0,g!==null&&(LT.toArray(g.image.data,4*m),g.needsUpdate=!0),n.push(s),o.push({start:h?s.indexStart:s.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new Et,sphereInitialized:!1,sphere:new di});const v=this.geometry.getAttribute(xo);for(let _=0;_<s.vertexCount;_++)v.setX(s.vertexStart+_,m);return v.needsUpdate=!0,this.setGeometryAt(m,e),m}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const r=this.geometry,s=r.getIndex()!==null,a=r.getIndex(),n=t.getIndex(),o=this._reservedRanges[e];if(s&&n.count>o.indexCount||t.attributes.position.count>o.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.vertexCount;for(const p in r.attributes){if(p===xo)continue;const f=t.getAttribute(p),g=r.getAttribute(p);DT(f,g,l);const m=f.itemSize;for(let v=f.count,_=c;v<_;v++){const y=l+v;for(let x=0;x<m;x++)g.setComponent(y,x,0)}g.needsUpdate=!0,g.addUpdateRange(l*m,c*m)}if(s){const p=o.indexStart;for(let f=0;f<n.count;f++)a.setX(p+f,l+n.getX(f));for(let f=n.count,g=o.indexCount;f<g;f++)a.setX(p+f,l);a.needsUpdate=!0,a.addUpdateRange(p,o.indexCount)}const h=this._bounds[e];t.boundingBox!==null?(h.box.copy(t.boundingBox),h.boxInitialized=!0):h.boxInitialized=!1,t.boundingSphere!==null?(h.sphere.copy(t.boundingSphere),h.sphereInitialized=!0):h.sphereInitialized=!1;const u=this._drawRanges[e],d=t.getAttribute("position");return u.count=s?n.count:d.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1||(t[e]=!1,this._visibilityChanged=!0),this}getInstanceCountAt(e){return this._multiDrawInstances===null?null:this._multiDrawInstances[e]}setInstanceCountAt(e,t){return this._multiDrawInstances===null&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[e]=t,e}getBoundingBoxAt(e,t){if(this._active[e]===!1)return null;const r=this._bounds[e],s=r.box,a=this.geometry;if(r.boxInitialized===!1){s.makeEmpty();const n=a.index,o=a.attributes.position,l=this._drawRanges[e];for(let c=l.start,h=l.start+l.count;c<h;c++){let u=c;n&&(u=n.getX(u)),s.expandByPoint(kl.fromBufferAttribute(o,u))}r.boxInitialized=!0}return t.copy(s),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return null;const r=this._bounds[e],s=r.sphere,a=this.geometry;if(r.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(e,ru),ru.getCenter(s.center);const n=a.index,o=a.attributes.position,l=this._drawRanges[e];let c=0;for(let h=l.start,u=l.start+l.count;h<u;h++){let d=h;n&&(d=n.getX(d)),kl.fromBufferAttribute(o,d),c=Math.max(c,s.center.distanceToSquared(kl))}s.radius=Math.sqrt(c),r.sphereInitialized=!0}return t.copy(s),t}setMatrixAt(e,t){const r=this._active,s=this._matricesTexture,a=this._matricesTexture.image.data;return e>=this._geometryCount||r[e]===!1||(t.toArray(a,16*e),s.needsUpdate=!0),this}getMatrixAt(e,t){const r=this._active,s=this._matricesTexture.image.data;return e>=this._geometryCount||r[e]===!1?null:t.fromArray(s,16*e)}setColorAt(e,t){this._colorsTexture===null&&this._initColorsTexture();const r=this._active,s=this._colorsTexture,a=this._colorsTexture.image.data;return e>=this._geometryCount||r[e]===!1||(t.toArray(a,4*e),s.needsUpdate=!0),this}getColorAt(e,t){const r=this._active,s=this._colorsTexture.image.data;return e>=this._geometryCount||r[e]===!1?null:t.fromArray(s,4*e)}setVisibleAt(e,t){const r=this._visibility,s=this._active;return e>=this._geometryCount||s[e]===!1||r[e]===t||(r[e]=t,this._visibilityChanged=!0),this}getVisibleAt(e){const t=this._visibility,r=this._active;return!(e>=this._geometryCount||r[e]===!1)&&t[e]}raycast(e,t){const r=this._visibility,s=this._active,a=this._drawRanges,n=this._geometryCount,o=this.matrixWorld,l=this.geometry;Pi.material=this.material,Pi.geometry.index=l.index,Pi.geometry.attributes=l.attributes,Pi.geometry.boundingBox===null&&(Pi.geometry.boundingBox=new Et),Pi.geometry.boundingSphere===null&&(Pi.geometry.boundingSphere=new di);for(let c=0;c<n;c++){if(!r[c]||!s[c])continue;const h=a[c];Pi.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(c,Pi.matrixWorld).premultiply(o),this.getBoundingBoxAt(c,Pi.geometry.boundingBox),this.getBoundingSphereAt(c,Pi.geometry.boundingSphere),Pi.raycast(e,su);for(let u=0,d=su.length;u<d;u++){const p=su[u];p.object=this,p.batchId=c,t.push(p)}su.length=0}Pi.material=null,Pi.geometry.index=null,Pi.geometry.attributes={},Pi.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>Ne({},t)),this._reservedRanges=e._reservedRanges.map(t=>Ne({},t)),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,r,s,a){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const n=s.getIndex(),o=n===null?1:n.array.BYTES_PER_ELEMENT,l=this._active,c=this._visibility,h=this._multiDrawStarts,u=this._multiDrawCounts,d=this._drawRanges,p=this.perObjectFrustumCulled;p&&(b_.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),pm.setFromProjectionMatrix(b_,e.coordinateSystem));let f=0;if(this.sortObjects){dm.copy(this.matrixWorld).invert(),kl.setFromMatrixPosition(r.matrixWorld).applyMatrix4(dm),M_.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(dm);for(let v=0,_=c.length;v<_;v++)if(c[v]&&l[v]){this.getMatrixAt(v,la),this.getBoundingSphereAt(v,tn).applyMatrix4(la);let y=!1;if(p&&(y=!pm.intersectsSphere(tn)),!y){const x=NT.subVectors(tn.center,kl).dot(M_);mm.push(d[v],x)}}const g=mm.list,m=this.customSort;m===null?g.sort(a.transparent?RT:CT):m.call(this,g,r);for(let v=0,_=g.length;v<_;v++){const y=g[v];h[f]=y.start*o,u[f]=y.count,f++}mm.reset()}else for(let g=0,m=c.length;g<m;g++)if(c[g]&&l[g]){let v=!1;if(p&&(this.getMatrixAt(g,la),this.getBoundingSphereAt(g,tn).applyMatrix4(la),v=!pm.intersectsSphere(tn)),!v){const _=d[g];h[f]=_.start*o,u[f]=_.count,f++}}this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,r,s,a,n){this.onBeforeRender(e,null,s,a,n)}}class Yt extends ti{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new fe(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const gd=new R,vd=new R,S_=new Me,Fl=new Zn,au=new di,fm=new R,T_=new R;class vi extends je{constructor(e=new Oe,t=new Yt){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let s=1,a=t.count;s<a;s++)gd.fromBufferAttribute(t,s-1),vd.fromBufferAttribute(t,s),r[s]=r[s-1],r[s]+=gd.distanceTo(vd);e.setAttribute("lineDistance",new Se(r,1))}return this}raycast(e,t){const r=this.geometry,s=this.matrixWorld,a=e.params.Line.threshold,n=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),au.copy(r.boundingSphere),au.applyMatrix4(s),au.radius+=a,e.ray.intersectsSphere(au)===!1)return;S_.copy(s).invert(),Fl.copy(e.ray).applyMatrix4(S_);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,h=r.index,u=r.attributes.position;if(h!==null){const d=Math.max(0,n.start),p=Math.min(h.count,n.start+n.count);for(let f=d,g=p-1;f<g;f+=c){const m=h.getX(f),v=h.getX(f+1),_=nu(this,e,Fl,l,m,v);_&&t.push(_)}if(this.isLineLoop){const f=h.getX(p-1),g=h.getX(d),m=nu(this,e,Fl,l,f,g);m&&t.push(m)}}else{const d=Math.max(0,n.start),p=Math.min(u.count,n.start+n.count);for(let f=d,g=p-1;f<g;f+=c){const m=nu(this,e,Fl,l,f,f+1);m&&t.push(m)}if(this.isLineLoop){const f=nu(this,e,Fl,l,p-1,d);f&&t.push(f)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}}function nu(i,e,t,r,s,a){const n=i.geometry.attributes.position;if(gd.fromBufferAttribute(n,s),vd.fromBufferAttribute(n,a),t.distanceSqToSegment(gd,vd,fm,T_)>r)return;fm.applyMatrix4(i.matrixWorld);const o=e.ray.origin.distanceTo(fm);return o<e.near||o>e.far?void 0:{distance:o,point:T_.clone().applyMatrix4(i.matrixWorld),index:s,face:null,faceIndex:null,object:i}}const A_=new R,E_=new R;class or extends vi{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let s=0,a=t.count;s<a;s+=2)A_.fromBufferAttribute(t,s),E_.fromBufferAttribute(t,s+1),r[s]=s===0?0:r[s-1],r[s+1]=r[s]+A_.distanceTo(E_);e.setAttribute("lineDistance",new Se(r,1))}return this}}class tg extends vi{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class ga extends ti{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new fe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const C_=new Me,ig=new Zn,ou=new di,lu=new R;class Aa extends je{constructor(e=new Oe,t=new ga){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,s=this.matrixWorld,a=e.params.Points.threshold,n=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),ou.copy(r.boundingSphere),ou.applyMatrix4(s),ou.radius+=a,e.ray.intersectsSphere(ou)===!1)return;C_.copy(s).invert(),ig.copy(e.ray).applyMatrix4(C_);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,h=r.attributes.position;if(c!==null)for(let u=Math.max(0,n.start),d=Math.min(c.count,n.start+n.count);u<d;u++){const p=c.getX(u);lu.fromBufferAttribute(h,p),R_(lu,p,l,s,e,t,this)}else for(let u=Math.max(0,n.start),d=Math.min(h.count,n.start+n.count);u<d;u++)lu.fromBufferAttribute(h,u),R_(lu,u,l,s,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}}function R_(i,e,t,r,s,a,n){const o=ig.distanceSqToPoint(i);if(o<t){const l=new R;ig.closestPointToPoint(i,l),l.applyMatrix4(r);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;a.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,object:n})}}class Ux extends wt{constructor(e,t,r,s,a,n,o,l,c){super(e,t,r,s,a,n,o,l,c),this.isVideoTexture=!0,this.minFilter=n!==void 0?n:Kt,this.magFilter=a!==void 0?a:Kt,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function u(){h.needsUpdate=!0,e.requestVideoFrameCallback(u)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class cu extends wt{constructor(e,t,r,s,a,n,o,l,c,h,u,d){super(null,n,o,l,c,h,s,a,u,d),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Nr{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,s=this.getPoint(0),a=0;t.push(0);for(let n=1;n<=e;n++)r=this.getPoint(n/e),a+=r.distanceTo(s),t.push(a),s=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let s=0;const a=r.length;let n;n=t||e*r[a-1];let o,l=0,c=a-1;for(;l<=c;)if(s=Math.floor(l+(c-l)/2),o=r[s]-n,o<0)l=s+1;else{if(!(o>0)){c=s;break}c=s-1}if(s=c,r[s]===n)return s/(a-1);const h=r[s];return(s+(n-h)/(r[s+1]-h))/(a-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const a=this.getPoint(r),n=this.getPoint(s),o=t||(a.isVector2?new ne:new R);return o.copy(n).sub(a).normalize(),o}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new R,s=[],a=[],n=[],o=new R,l=new Me;for(let p=0;p<=e;p++){const f=p/e;s[p]=this.getTangentAt(f,new R)}a[0]=new R,n[0]=new R;let c=Number.MAX_VALUE;const h=Math.abs(s[0].x),u=Math.abs(s[0].y),d=Math.abs(s[0].z);h<=c&&(c=h,r.set(1,0,0)),u<=c&&(c=u,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(s[0],r).normalize(),a[0].crossVectors(s[0],o),n[0].crossVectors(s[0],a[0]);for(let p=1;p<=e;p++){if(a[p]=a[p-1].clone(),n[p]=n[p-1].clone(),o.crossVectors(s[p-1],s[p]),o.length()>Number.EPSILON){o.normalize();const f=Math.acos(Vt(s[p-1].dot(s[p]),-1,1));a[p].applyMatrix4(l.makeRotationAxis(o,f))}n[p].crossVectors(s[p],a[p])}if(t===!0){let p=Math.acos(Vt(a[0].dot(a[e]),-1,1));p/=e,s[0].dot(o.crossVectors(a[0],a[e]))>0&&(p=-p);for(let f=1;f<=e;f++)a[f].applyMatrix4(l.makeRotationAxis(s[f],p*f)),n[f].crossVectors(s[f],a[f])}return{tangents:s,normals:a,binormals:n}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class dp extends Nr{constructor(e=0,t=0,r=1,s=1,a=0,n=2*Math.PI,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=s,this.aStartAngle=a,this.aEndAngle=n,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new ne){const r=t,s=2*Math.PI;let a=this.aEndAngle-this.aStartAngle;const n=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=s;for(;a>s;)a-=s;a<Number.EPSILON&&(a=n?0:s),this.aClockwise!==!0||n||(a===s?a=-s:a-=s);const o=this.aStartAngle+e*a;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=l-this.aX,p=c-this.aY;l=d*h-p*u+this.aX,c=d*u+p*h+this.aY}return r.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class kx extends dp{constructor(e,t,r,s,a,n){super(e,t,r,r,s,a,n),this.isArcCurve=!0,this.type="ArcCurve"}}function o0(){let i=0,e=0,t=0,r=0;function s(a,n,o,l){i=a,e=o,t=-3*a+3*n-2*o-l,r=2*a-2*n+o+l}return{initCatmullRom:function(a,n,o,l,c){s(n,o,c*(o-a),c*(l-n))},initNonuniformCatmullRom:function(a,n,o,l,c,h,u){let d=(n-a)/c-(o-a)/(c+h)+(o-n)/h,p=(o-n)/h-(l-n)/(h+u)+(l-o)/u;d*=h,p*=h,s(n,o,d,p)},calc:function(a){const n=a*a;return i+e*a+t*n+r*(n*a)}}}const hu=new R,gm=new o0,vm=new o0,_m=new o0;class pp extends Nr{constructor(e=[],t=!1,r="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=s}getPoint(e,t=new R){const r=t,s=this.points,a=s.length,n=(a-(this.closed?0:1))*e;let o,l,c=Math.floor(n),h=n-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/a)+1)*a:h===0&&c===a-1&&(c=a-2,h=1),this.closed||c>0?o=s[(c-1)%a]:(hu.subVectors(s[0],s[1]).add(s[0]),o=hu);const u=s[c%a],d=s[(c+1)%a];if(this.closed||c+2<a?l=s[(c+2)%a]:(hu.subVectors(s[a-1],s[a-2]).add(s[a-1]),l=hu),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let f=Math.pow(o.distanceToSquared(u),p),g=Math.pow(u.distanceToSquared(d),p),m=Math.pow(d.distanceToSquared(l),p);g<1e-4&&(g=1),f<1e-4&&(f=g),m<1e-4&&(m=g),gm.initNonuniformCatmullRom(o.x,u.x,d.x,l.x,f,g,m),vm.initNonuniformCatmullRom(o.y,u.y,d.y,l.y,f,g,m),_m.initNonuniformCatmullRom(o.z,u.z,d.z,l.z,f,g,m)}else this.curveType==="catmullrom"&&(gm.initCatmullRom(o.x,u.x,d.x,l.x,this.tension),vm.initCatmullRom(o.y,u.y,d.y,l.y,this.tension),_m.initCatmullRom(o.z,u.z,d.z,l.z,this.tension));return r.set(gm.calc(h),vm.calc(h),_m.calc(h)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(new R().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function P_(i,e,t,r,s){const a=.5*(r-e),n=.5*(s-t),o=i*i;return(2*t-2*r+a+n)*(i*o)+(-3*t+3*r-2*a-n)*o+a*i+t}function pc(i,e,t,r){return function(s,a){const n=1-s;return n*n*a}(i,e)+function(s,a){return 2*(1-s)*s*a}(i,t)+function(s,a){return s*s*a}(i,r)}function mc(i,e,t,r,s){return function(a,n){const o=1-a;return o*o*o*n}(i,e)+function(a,n){const o=1-a;return 3*o*o*a*n}(i,t)+function(a,n){return 3*(1-a)*a*a*n}(i,r)+function(a,n){return a*a*a*n}(i,s)}class l0 extends Nr{constructor(e=new ne,t=new ne,r=new ne,s=new ne){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=s}getPoint(e,t=new ne){const r=t,s=this.v0,a=this.v1,n=this.v2,o=this.v3;return r.set(mc(e,s.x,a.x,n.x,o.x),mc(e,s.y,a.y,n.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Fx extends Nr{constructor(e=new R,t=new R,r=new R,s=new R){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=s}getPoint(e,t=new R){const r=t,s=this.v0,a=this.v1,n=this.v2,o=this.v3;return r.set(mc(e,s.x,a.x,n.x,o.x),mc(e,s.y,a.y,n.y,o.y),mc(e,s.z,a.z,n.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class c0 extends Nr{constructor(e=new ne,t=new ne){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ne){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ne){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Bx extends Nr{constructor(e=new R,t=new R){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new R){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new R){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class h0 extends Nr{constructor(e=new ne,t=new ne,r=new ne){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new ne){const r=t,s=this.v0,a=this.v1,n=this.v2;return r.set(pc(e,s.x,a.x,n.x),pc(e,s.y,a.y,n.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class u0 extends Nr{constructor(e=new R,t=new R,r=new R){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new R){const r=t,s=this.v0,a=this.v1,n=this.v2;return r.set(pc(e,s.x,a.x,n.x),pc(e,s.y,a.y,n.y),pc(e,s.z,a.z,n.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class d0 extends Nr{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ne){const r=t,s=this.points,a=(s.length-1)*e,n=Math.floor(a),o=a-n,l=s[n===0?n:n-1],c=s[n],h=s[n>s.length-2?s.length-1:n+1],u=s[n>s.length-3?s.length-1:n+2];return r.set(P_(o,l.x,c.x,h.x,u.x),P_(o,l.y,c.y,h.y,u.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(new ne().fromArray(s))}return this}}var _d=Object.freeze({__proto__:null,ArcCurve:kx,CatmullRomCurve3:pp,CubicBezierCurve:l0,CubicBezierCurve3:Fx,EllipseCurve:dp,LineCurve:c0,LineCurve3:Bx,QuadraticBezierCurve:h0,QuadraticBezierCurve3:u0,SplineCurve:d0});class zx extends Nr{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new _d[r](t,e))}return this}getPoint(e,t){const r=e*this.getLength(),s=this.getCurveLengths();let a=0;for(;a<s.length;){if(s[a]>=r){const n=s[a]-r,o=this.curves[a],l=o.getLength(),c=l===0?0:1-n/l;return o.getPointAt(c,t)}a++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,s=this.curves.length;r<s;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let s=0,a=this.curves;s<a.length;s++){const n=a[s],o=n.isEllipseCurve?2*e:n.isLineCurve||n.isLineCurve3?1:n.isSplineCurve?e*n.points.length:e,l=n.getPoints(o);for(let c=0;c<l.length;c++){const h=l[c];r&&r.equals(h)||(t.push(h),r=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const s=e.curves[t];this.curves.push(new _d[s.type]().fromJSON(s))}return this}}class cl extends zx{constructor(e){super(),this.type="Path",this.currentPoint=new ne,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new c0(this.currentPoint.clone(),new ne(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,s){const a=new h0(this.currentPoint.clone(),new ne(e,t),new ne(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}bezierCurveTo(e,t,r,s,a,n){const o=new l0(this.currentPoint.clone(),new ne(e,t),new ne(r,s),new ne(a,n));return this.curves.push(o),this.currentPoint.set(a,n),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new d0(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,s,a,n){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,r,s,a,n),this}absarc(e,t,r,s,a,n){return this.absellipse(e,t,r,r,s,a,n),this}ellipse(e,t,r,s,a,n,o,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,r,s,a,n,o,l),this}absellipse(e,t,r,s,a,n,o,l){const c=new dp(e,t,r,s,a,n,o,l);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class mh extends Oe{constructor(e=[new ne(0,-.5),new ne(.5,0),new ne(0,.5)],t=12,r=0,s=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:s},t=Math.floor(t),s=Vt(s,0,2*Math.PI);const a=[],n=[],o=[],l=[],c=[],h=1/t,u=new R,d=new ne,p=new R,f=new R,g=new R;let m=0,v=0;for(let _=0;_<=e.length-1;_++)switch(_){case 0:m=e[_+1].x-e[_].x,v=e[_+1].y-e[_].y,p.x=1*v,p.y=-m,p.z=0*v,g.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(g.x,g.y,g.z);break;default:m=e[_+1].x-e[_].x,v=e[_+1].y-e[_].y,p.x=1*v,p.y=-m,p.z=0*v,f.copy(p),p.x+=g.x,p.y+=g.y,p.z+=g.z,p.normalize(),l.push(p.x,p.y,p.z),g.copy(f)}for(let _=0;_<=t;_++){const y=r+_*h*s,x=Math.sin(y),b=Math.cos(y);for(let M=0;M<=e.length-1;M++){u.x=e[M].x*x,u.y=e[M].y,u.z=e[M].x*b,n.push(u.x,u.y,u.z),d.x=_/t,d.y=M/(e.length-1),o.push(d.x,d.y);const T=l[3*M+0]*x,E=l[3*M+1],C=l[3*M+0]*b;c.push(T,E,C)}}for(let _=0;_<t;_++)for(let y=0;y<e.length-1;y++){const x=y+_*e.length,b=x,M=x+e.length,T=x+e.length+1,E=x+1;a.push(b,M,E),a.push(T,E,M)}this.setIndex(a),this.setAttribute("position",new Se(n,3)),this.setAttribute("uv",new Se(o,2)),this.setAttribute("normal",new Se(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mh(e.points,e.segments,e.phiStart,e.phiLength)}}class fh extends mh{constructor(e=1,t=1,r=4,s=8){const a=new cl;a.absarc(0,-t/2,e,1.5*Math.PI,0),a.absarc(0,t/2,e,0,.5*Math.PI),super(a.getPoints(r),s),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:r,radialSegments:s}}static fromJSON(e){return new fh(e.radius,e.length,e.capSegments,e.radialSegments)}}class gh extends Oe{constructor(e=1,t=32,r=0,s=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:s},t=Math.max(3,t);const a=[],n=[],o=[],l=[],c=new R,h=new ne;n.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let u=0,d=3;u<=t;u++,d+=3){const p=r+u/t*s;c.x=e*Math.cos(p),c.y=e*Math.sin(p),n.push(c.x,c.y,c.z),o.push(0,0,1),h.x=(n[d]/e+1)/2,h.y=(n[d+1]/e+1)/2,l.push(h.x,h.y)}for(let u=1;u<=t;u++)a.push(u,u+1,0);this.setIndex(a),this.setAttribute("position",new Se(n,3)),this.setAttribute("normal",new Se(o,3)),this.setAttribute("uv",new Se(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class zt extends Oe{constructor(e=1,t=1,r=1,s=32,a=1,n=!1,o=0,l=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:s,heightSegments:a,openEnded:n,thetaStart:o,thetaLength:l};const c=this;s=Math.floor(s),a=Math.floor(a);const h=[],u=[],d=[],p=[];let f=0;const g=[],m=r/2;let v=0;function _(y){const x=f,b=new ne,M=new R;let T=0;const E=y===!0?e:t,C=y===!0?1:-1;for(let D=1;D<=s;D++)u.push(0,m*C,0),d.push(0,C,0),p.push(.5,.5),f++;const N=f;for(let D=0;D<=s;D++){const A=D/s*l+o,L=Math.cos(A),w=Math.sin(A);M.x=E*w,M.y=m*C,M.z=E*L,u.push(M.x,M.y,M.z),d.push(0,C,0),b.x=.5*L+.5,b.y=.5*w*C+.5,p.push(b.x,b.y),f++}for(let D=0;D<s;D++){const A=x+D,L=N+D;y===!0?h.push(L,L+1,A):h.push(L+1,L,A),T+=3}c.addGroup(v,T,y===!0?1:2),v+=T}(function(){const y=new R,x=new R;let b=0;const M=(t-e)/r;for(let T=0;T<=a;T++){const E=[],C=T/a,N=C*(t-e)+e;for(let D=0;D<=s;D++){const A=D/s,L=A*l+o,w=Math.sin(L),B=Math.cos(L);x.x=N*w,x.y=-C*r+m,x.z=N*B,u.push(x.x,x.y,x.z),y.set(w,M,B).normalize(),d.push(y.x,y.y,y.z),p.push(A,1-C),E.push(f++)}g.push(E)}for(let T=0;T<s;T++)for(let E=0;E<a;E++){const C=g[E][T],N=g[E+1][T],D=g[E+1][T+1],A=g[E][T+1];h.push(C,N,A),h.push(N,D,A),b+=6}c.addGroup(v,b,0),v+=b})(),n===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new Se(u,3)),this.setAttribute("normal",new Se(d,3)),this.setAttribute("uv",new Se(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zt(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class vh extends zt{constructor(e=1,t=1,r=32,s=1,a=!1,n=0,o=2*Math.PI){super(0,e,t,r,s,a,n,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:n,thetaLength:o}}static fromJSON(e){return new vh(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ha extends Oe{constructor(e=[],t=[],r=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:s};const a=[],n=[];function o(d,p,f,g){const m=g+1,v=[];for(let _=0;_<=m;_++){v[_]=[];const y=d.clone().lerp(f,_/m),x=p.clone().lerp(f,_/m),b=m-_;for(let M=0;M<=b;M++)v[_][M]=M===0&&_===m?y:y.clone().lerp(x,M/b)}for(let _=0;_<m;_++)for(let y=0;y<2*(m-_)-1;y++){const x=Math.floor(y/2);y%2==0?(l(v[_][x+1]),l(v[_+1][x]),l(v[_][x])):(l(v[_][x+1]),l(v[_+1][x+1]),l(v[_+1][x]))}}function l(d){a.push(d.x,d.y,d.z)}function c(d,p){const f=3*d;p.x=e[f+0],p.y=e[f+1],p.z=e[f+2]}function h(d,p,f,g){g<0&&d.x===1&&(n[p]=d.x-1),f.x===0&&f.z===0&&(n[p]=g/2/Math.PI+.5)}function u(d){return Math.atan2(d.z,-d.x)}(function(d){const p=new R,f=new R,g=new R;for(let m=0;m<t.length;m+=3)c(t[m+0],p),c(t[m+1],f),c(t[m+2],g),o(p,f,g,d)})(s),function(d){const p=new R;for(let f=0;f<a.length;f+=3)p.x=a[f+0],p.y=a[f+1],p.z=a[f+2],p.normalize().multiplyScalar(d),a[f+0]=p.x,a[f+1]=p.y,a[f+2]=p.z}(r),function(){const d=new R;for(let f=0;f<a.length;f+=3){d.x=a[f+0],d.y=a[f+1],d.z=a[f+2];const g=u(d)/2/Math.PI+.5,m=(p=d,Math.atan2(-p.y,Math.sqrt(p.x*p.x+p.z*p.z))/Math.PI+.5);n.push(g,1-m)}var p;(function(){const f=new R,g=new R,m=new R,v=new R,_=new ne,y=new ne,x=new ne;for(let b=0,M=0;b<a.length;b+=9,M+=6){f.set(a[b+0],a[b+1],a[b+2]),g.set(a[b+3],a[b+4],a[b+5]),m.set(a[b+6],a[b+7],a[b+8]),_.set(n[M+0],n[M+1]),y.set(n[M+2],n[M+3]),x.set(n[M+4],n[M+5]),v.copy(f).add(g).add(m).divideScalar(3);const T=u(v);h(_,M+0,f,T),h(y,M+2,g,T),h(x,M+4,m,T)}})(),function(){for(let f=0;f<n.length;f+=6){const g=n[f+0],m=n[f+2],v=n[f+4],_=Math.max(g,m,v),y=Math.min(g,m,v);_>.9&&y<.1&&(g<.2&&(n[f+0]+=1),m<.2&&(n[f+2]+=1),v<.2&&(n[f+4]+=1))}}()}(),this.setAttribute("position",new Se(a,3)),this.setAttribute("normal",new Se(a.slice(),3)),this.setAttribute("uv",new Se(n,2)),s===0?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ha(e.vertices,e.indices,e.radius,e.details)}}class mp extends Ha{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,s=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new mp(e.radius,e.detail)}}const uu=new R,du=new R,ym=new R,pu=new dr;class Vx extends Oe{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(Pn*t),a=e.getIndex(),n=e.getAttribute("position"),o=a?a.count:n.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let p=0;p<o;p+=3){a?(l[0]=a.getX(p),l[1]=a.getX(p+1),l[2]=a.getX(p+2)):(l[0]=p,l[1]=p+1,l[2]=p+2);const{a:f,b:g,c:m}=pu;if(f.fromBufferAttribute(n,l[0]),g.fromBufferAttribute(n,l[1]),m.fromBufferAttribute(n,l[2]),pu.getNormal(ym),h[0]=`${Math.round(f.x*r)},${Math.round(f.y*r)},${Math.round(f.z*r)}`,h[1]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,h[2]=`${Math.round(m.x*r)},${Math.round(m.y*r)},${Math.round(m.z*r)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let v=0;v<3;v++){const _=(v+1)%3,y=h[v],x=h[_],b=pu[c[v]],M=pu[c[_]],T=`${y}_${x}`,E=`${x}_${y}`;E in u&&u[E]?(ym.dot(u[E].normal)<=s&&(d.push(b.x,b.y,b.z),d.push(M.x,M.y,M.z)),u[E]=null):T in u||(u[T]={index0:l[v],index1:l[_],normal:ym.clone()})}}for(const p in u)if(u[p]){const{index0:f,index1:g}=u[p];uu.fromBufferAttribute(n,f),du.fromBufferAttribute(n,g),d.push(uu.x,uu.y,uu.z),d.push(du.x,du.y,du.z)}this.setAttribute("position",new Se(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Ea extends cl{constructor(e){super(e),this.uuid=vr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,s=this.holes.length;r<s;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const s=e.holes[t];this.holes.push(new cl().fromJSON(s))}return this}}const OT=function(i,e,t=2){const r=e&&e.length,s=r?e[0]*t:i.length;let a=I_(i,0,s,t,!0);const n=[];if(!a||a.next===a.prev)return n;let o,l,c,h,u,d,p;if(r&&(a=function(f,g,m,v){const _=[];let y,x,b,M,T;for(y=0,x=g.length;y<x;y++)b=g[y]*v,M=y<x-1?g[y+1]*v:f.length,T=I_(f,b,M,v,!1),T===T.next&&(T.steiner=!0),_.push(GT(T));for(_.sort(zT),y=0;y<_.length;y++)m=VT(_[y],m);return m}(i,e,a,t)),i.length>80*t){o=c=i[0],l=h=i[1];for(let f=t;f<s;f+=t)u=i[f],d=i[f+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=p!==0?32767/p:0}return Oc(a,n,t,o,l,p,0),n};function I_(i,e,t,r,s){let a,n;if(s===function(o,l,c,h){let u=0;for(let d=l,p=c-h;d<c;d+=h)u+=(o[p]-o[d])*(o[d+1]+o[p+1]),p=d;return u}(i,e,t,r)>0)for(a=e;a<t;a+=r)n=L_(a,i[a],i[a+1],n);else for(a=t-r;a>=e;a-=r)n=L_(a,i[a],i[a+1],n);return n&&fp(n,n.next)&&(kc(n),n=n.next),n}function jn(i,e){if(!i)return i;e||(e=i);let t,r=i;do if(t=!1,r.steiner||!fp(r,r.next)&&kt(r.prev,r,r.next)!==0)r=r.next;else{if(kc(r),r=e=r.prev,r===r.next)break;t=!0}while(t||r!==e);return e}function Oc(i,e,t,r,s,a,n){if(!i)return;!n&&a&&function(h,u,d,p){let f=h;do f.z===0&&(f.z=rg(f.x,f.y,u,d,p)),f.prevZ=f.prev,f.nextZ=f.next,f=f.next;while(f!==h);f.prevZ.nextZ=null,f.prevZ=null,function(g){let m,v,_,y,x,b,M,T,E=1;do{for(v=g,g=null,x=null,b=0;v;){for(b++,_=v,M=0,m=0;m<E&&(M++,_=_.nextZ,_);m++);for(T=E;M>0||T>0&&_;)M!==0&&(T===0||!_||v.z<=_.z)?(y=v,v=v.nextZ,M--):(y=_,_=_.nextZ,T--),x?x.nextZ=y:g=y,y.prevZ=x,x=y;v=_}x.nextZ=null,E*=2}while(b>1)}(f)}(i,r,s,a);let o,l,c=i;for(;i.prev!==i.next;)if(o=i.prev,l=i.next,a?kT(i,r,s,a):UT(i))e.push(o.i/t|0),e.push(i.i/t|0),e.push(l.i/t|0),kc(i),i=l.next,c=l.next;else if((i=l)===c){n?n===1?Oc(i=FT(jn(i),e,t),e,t,r,s,a,2):n===2&&BT(i,e,t,r,s,a):Oc(jn(i),e,t,r,s,a,1);break}}function UT(i){const e=i.prev,t=i,r=i.next;if(kt(e,t,r)>=0)return!1;const s=e.x,a=t.x,n=r.x,o=e.y,l=t.y,c=r.y,h=s<a?s<n?s:n:a<n?a:n,u=o<l?o<c?o:c:l<c?l:c,d=s>a?s>n?s:n:a>n?a:n,p=o>l?o>c?o:c:l>c?l:c;let f=r.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&Ro(s,o,a,l,n,c,f.x,f.y)&&kt(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function kT(i,e,t,r){const s=i.prev,a=i,n=i.next;if(kt(s,a,n)>=0)return!1;const o=s.x,l=a.x,c=n.x,h=s.y,u=a.y,d=n.y,p=o<l?o<c?o:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,g=o>l?o>c?o:c:l>c?l:c,m=h>u?h>d?h:d:u>d?u:d,v=rg(p,f,e,t,r),_=rg(g,m,e,t,r);let y=i.prevZ,x=i.nextZ;for(;y&&y.z>=v&&x&&x.z<=_;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==s&&y!==n&&Ro(o,h,l,u,c,d,y.x,y.y)&&kt(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==s&&x!==n&&Ro(o,h,l,u,c,d,x.x,x.y)&&kt(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==s&&y!==n&&Ro(o,h,l,u,c,d,y.x,y.y)&&kt(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==s&&x!==n&&Ro(o,h,l,u,c,d,x.x,x.y)&&kt(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function FT(i,e,t){let r=i;do{const s=r.prev,a=r.next.next;!fp(s,a)&&Hx(s,r,r.next,a)&&Uc(s,a)&&Uc(a,s)&&(e.push(s.i/t|0),e.push(r.i/t|0),e.push(a.i/t|0),kc(r),kc(r.next),r=i=a),r=r.next}while(r!==i);return jn(r)}function BT(i,e,t,r,s,a){let n=i;do{let o=n.next.next;for(;o!==n.prev;){if(n.i!==o.i&&jT(n,o)){let l=Gx(n,o);return n=jn(n,n.next),l=jn(l,l.next),Oc(n,e,t,r,s,a,0),void Oc(l,e,t,r,s,a,0)}o=o.next}n=n.next}while(n!==i)}function zT(i,e){return i.x-e.x}function VT(i,e){const t=function(s,a){let n,o=a,l=-1/0;const c=s.x,h=s.y;do{if(h<=o.y&&h>=o.next.y&&o.next.y!==o.y){const m=o.x+(h-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(m<=c&&m>l&&(l=m,n=o.x<o.next.x?o:o.next,m===c))return n}o=o.next}while(o!==a);if(!n)return null;const u=n,d=n.x,p=n.y;let f,g=1/0;o=n;do c>=o.x&&o.x>=d&&c!==o.x&&Ro(h<p?c:l,h,d,p,h<p?l:c,h,o.x,o.y)&&(f=Math.abs(h-o.y)/(c-o.x),Uc(o,s)&&(f<g||f===g&&(o.x>n.x||o.x===n.x&&HT(n,o)))&&(n=o,g=f)),o=o.next;while(o!==u);return n}(i,e);if(!t)return e;const r=Gx(t,i);return jn(r,r.next),jn(t,t.next)}function HT(i,e){return kt(i.prev,i,e.prev)<0&&kt(e.next,i,i.next)<0}function rg(i,e,t,r,s){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*s|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function GT(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function Ro(i,e,t,r,s,a,n,o){return(s-n)*(e-o)>=(i-n)*(a-o)&&(i-n)*(r-o)>=(t-n)*(e-o)&&(t-n)*(a-o)>=(s-n)*(r-o)}function jT(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,r){let s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==r.i&&s.next.i!==r.i&&Hx(s,s.next,t,r))return!0;s=s.next}while(s!==t);return!1}(i,e)&&(Uc(i,e)&&Uc(e,i)&&function(t,r){let s=t,a=!1;const n=(t.x+r.x)/2,o=(t.y+r.y)/2;do s.y>o!=s.next.y>o&&s.next.y!==s.y&&n<(s.next.x-s.x)*(o-s.y)/(s.next.y-s.y)+s.x&&(a=!a),s=s.next;while(s!==t);return a}(i,e)&&(kt(i.prev,i,e.prev)||kt(i,e.prev,e))||fp(i,e)&&kt(i.prev,i,i.next)>0&&kt(e.prev,e,e.next)>0)}function kt(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function fp(i,e){return i.x===e.x&&i.y===e.y}function Hx(i,e,t,r){const s=fu(kt(i,e,t)),a=fu(kt(i,e,r)),n=fu(kt(t,r,i)),o=fu(kt(t,r,e));return s!==a&&n!==o||!(s!==0||!mu(i,t,e))||!(a!==0||!mu(i,r,e))||!(n!==0||!mu(t,i,r))||!(o!==0||!mu(t,e,r))}function mu(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function fu(i){return i>0?1:i<0?-1:0}function Uc(i,e){return kt(i.prev,i,i.next)<0?kt(i,e,i.next)>=0&&kt(i,i.prev,e)>=0:kt(i,e,i.prev)<0||kt(i,i.next,e)<0}function Gx(i,e){const t=new sg(i.i,i.x,i.y),r=new sg(e.i,e.x,e.y),s=i.next,a=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,r.next=t,t.prev=r,a.next=r,r.prev=a,r}function L_(i,e,t,r){const s=new sg(i,e,t);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function kc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function sg(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class qr{static area(e){const t=e.length;let r=0;for(let s=t-1,a=0;a<t;s=a++)r+=e[s].x*e[a].y-e[a].x*e[s].y;return .5*r}static isClockWise(e){return qr.area(e)<0}static triangulateShape(e,t){const r=[],s=[],a=[];N_(e),D_(r,e);let n=e.length;t.forEach(N_);for(let l=0;l<t.length;l++)s.push(n),n+=t[l].length,D_(r,t[l]);const o=OT(r,s);for(let l=0;l<o.length;l+=3)a.push(o.slice(l,l+3));return a}}function N_(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function D_(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class Kn extends Oe{constructor(e=new Ea([new ne(.5,.5),new ne(-.5,.5),new ne(-.5,-.5),new ne(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,s=[],a=[];for(let o=0,l=e.length;o<l;o++)n(e[o]);function n(o){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,u=t.depth!==void 0?t.depth:1;let d=t.bevelEnabled===void 0||t.bevelEnabled,p=t.bevelThickness!==void 0?t.bevelThickness:.2,f=t.bevelSize!==void 0?t.bevelSize:p-.1,g=t.bevelOffset!==void 0?t.bevelOffset:0,m=t.bevelSegments!==void 0?t.bevelSegments:3;const v=t.extrudePath,_=t.UVGenerator!==void 0?t.UVGenerator:WT;let y,x,b,M,T,E=!1;v&&(y=v.getSpacedPoints(h),E=!0,d=!1,x=v.computeFrenetFrames(h,!1),b=new R,M=new R,T=new R),d||(m=0,p=0,f=0,g=0);const C=o.extractPoints(c);let N=C.shape;const D=C.holes;if(!qr.isClockWise(N)){N=N.reverse();for(let j=0,Q=D.length;j<Q;j++){const O=D[j];qr.isClockWise(O)&&(D[j]=O.reverse())}}const A=qr.triangulateShape(N,D),L=N;for(let j=0,Q=D.length;j<Q;j++){const O=D[j];N=N.concat(O)}function w(j,Q,O){return j.clone().addScaledVector(Q,O)}const B=N.length,$=A.length;function K(j,Q,O){let J,Z,S;const F=j.x-Q.x,X=j.y-Q.y,U=O.x-j.x,P=O.y-j.y,I=F*F+X*X,V=F*P-X*U;if(Math.abs(V)>Number.EPSILON){const Y=Math.sqrt(I),q=Math.sqrt(U*U+P*P),pe=Q.x-X/Y,_e=Q.y+F/Y,le=((O.x-P/q-pe)*P-(O.y+U/q-_e)*U)/(F*P-X*U);J=pe+F*le-j.x,Z=_e+X*le-j.y;const xe=J*J+Z*Z;if(xe<=2)return new ne(J,Z);S=Math.sqrt(xe/2)}else{let Y=!1;F>Number.EPSILON?U>Number.EPSILON&&(Y=!0):F<-Number.EPSILON?U<-Number.EPSILON&&(Y=!0):Math.sign(X)===Math.sign(P)&&(Y=!0),Y?(J=-X,Z=F,S=Math.sqrt(I)):(J=F,Z=X,S=Math.sqrt(I/2))}return new ne(J/S,Z/S)}const ae=[];for(let j=0,Q=L.length,O=Q-1,J=j+1;j<Q;j++,O++,J++)O===Q&&(O=0),J===Q&&(J=0),ae[j]=K(L[j],L[O],L[J]);const se=[];let me,H=ae.concat();for(let j=0,Q=D.length;j<Q;j++){const O=D[j];me=[];for(let J=0,Z=O.length,S=Z-1,F=J+1;J<Z;J++,S++,F++)S===Z&&(S=0),F===Z&&(F=0),me[J]=K(O[J],O[S],O[F]);se.push(me),H=H.concat(me)}for(let j=0;j<m;j++){const Q=j/m,O=p*Math.cos(Q*Math.PI/2),J=f*Math.sin(Q*Math.PI/2)+g;for(let Z=0,S=L.length;Z<S;Z++){const F=w(L[Z],ae[Z],J);te(F.x,F.y,-O)}for(let Z=0,S=D.length;Z<S;Z++){const F=D[Z];me=se[Z];for(let X=0,U=F.length;X<U;X++){const P=w(F[X],me[X],J);te(P.x,P.y,-O)}}}const W=f+g;for(let j=0;j<B;j++){const Q=d?w(N[j],H[j],W):N[j];E?(M.copy(x.normals[0]).multiplyScalar(Q.x),b.copy(x.binormals[0]).multiplyScalar(Q.y),T.copy(y[0]).add(M).add(b),te(T.x,T.y,T.z)):te(Q.x,Q.y,0)}for(let j=1;j<=h;j++)for(let Q=0;Q<B;Q++){const O=d?w(N[Q],H[Q],W):N[Q];E?(M.copy(x.normals[j]).multiplyScalar(O.x),b.copy(x.binormals[j]).multiplyScalar(O.y),T.copy(y[j]).add(M).add(b),te(T.x,T.y,T.z)):te(O.x,O.y,u/h*j)}for(let j=m-1;j>=0;j--){const Q=j/m,O=p*Math.cos(Q*Math.PI/2),J=f*Math.sin(Q*Math.PI/2)+g;for(let Z=0,S=L.length;Z<S;Z++){const F=w(L[Z],ae[Z],J);te(F.x,F.y,u+O)}for(let Z=0,S=D.length;Z<S;Z++){const F=D[Z];me=se[Z];for(let X=0,U=F.length;X<U;X++){const P=w(F[X],me[X],J);E?te(P.x,P.y+y[h-1].y,y[h-1].x+O):te(P.x,P.y,u+O)}}}function ce(j,Q){let O=j.length;for(;--O>=0;){const J=O;let Z=O-1;Z<0&&(Z=j.length-1);for(let S=0,F=h+2*m;S<F;S++){const X=B*S,U=B*(S+1);z(Q+J+X,Q+Z+X,Q+Z+U,Q+J+U)}}}function te(j,Q,O){l.push(j),l.push(Q),l.push(O)}function k(j,Q,O){ee(j),ee(Q),ee(O);const J=s.length/3,Z=_.generateTopUV(r,s,J-3,J-2,J-1);re(Z[0]),re(Z[1]),re(Z[2])}function z(j,Q,O,J){ee(j),ee(Q),ee(J),ee(Q),ee(O),ee(J);const Z=s.length/3,S=_.generateSideWallUV(r,s,Z-6,Z-3,Z-2,Z-1);re(S[0]),re(S[1]),re(S[3]),re(S[1]),re(S[2]),re(S[3])}function ee(j){s.push(l[3*j+0]),s.push(l[3*j+1]),s.push(l[3*j+2])}function re(j){a.push(j.x),a.push(j.y)}(function(){const j=s.length/3;if(d){let Q=0,O=B*Q;for(let J=0;J<$;J++){const Z=A[J];k(Z[2]+O,Z[1]+O,Z[0]+O)}Q=h+2*m,O=B*Q;for(let J=0;J<$;J++){const Z=A[J];k(Z[0]+O,Z[1]+O,Z[2]+O)}}else{for(let Q=0;Q<$;Q++){const O=A[Q];k(O[2],O[1],O[0])}for(let Q=0;Q<$;Q++){const O=A[Q];k(O[0]+B*h,O[1]+B*h,O[2]+B*h)}}r.addGroup(j,s.length/3-j,0)})(),function(){const j=s.length/3;let Q=0;ce(L,Q),Q+=L.length;for(let O=0,J=D.length;O<J;O++){const Z=D[O];ce(Z,Q),Q+=Z.length}r.addGroup(j,s.length/3-j,1)}()}this.setAttribute("position",new Se(s,3)),this.setAttribute("uv",new Se(a,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(t,r,s){if(s.shapes=[],Array.isArray(t))for(let a=0,n=t.length;a<n;a++){const o=t[a];s.shapes.push(o.uuid)}else s.shapes.push(t.uuid);return s.options=Object.assign({},r),r.extrudePath!==void 0&&(s.options.extrudePath=r.extrudePath.toJSON()),s}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const r=[];for(let a=0,n=e.shapes.length;a<n;a++){const o=t[e.shapes[a]];r.push(o)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new _d[s.type]().fromJSON(s)),new Kn(r,e.options)}}const WT={generateTopUV:function(i,e,t,r,s){const a=e[3*t],n=e[3*t+1],o=e[3*r],l=e[3*r+1],c=e[3*s],h=e[3*s+1];return[new ne(a,n),new ne(o,l),new ne(c,h)]},generateSideWallUV:function(i,e,t,r,s,a){const n=e[3*t],o=e[3*t+1],l=e[3*t+2],c=e[3*r],h=e[3*r+1],u=e[3*r+2],d=e[3*s],p=e[3*s+1],f=e[3*s+2],g=e[3*a],m=e[3*a+1],v=e[3*a+2];return Math.abs(o-h)<Math.abs(n-c)?[new ne(n,1-l),new ne(c,1-u),new ne(d,1-f),new ne(g,1-v)]:[new ne(o,1-l),new ne(h,1-u),new ne(p,1-f),new ne(m,1-v)]}};class gp extends Ha{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new gp(e.radius,e.detail)}}class zs extends Ha{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new zs(e.radius,e.detail)}}class _h extends Oe{constructor(e=.5,t=1,r=32,s=1,a=0,n=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:s,thetaStart:a,thetaLength:n},r=Math.max(3,r);const o=[],l=[],c=[],h=[];let u=e;const d=(t-e)/(s=Math.max(1,s)),p=new R,f=new ne;for(let g=0;g<=s;g++){for(let m=0;m<=r;m++){const v=a+m/r*n;p.x=u*Math.cos(v),p.y=u*Math.sin(v),l.push(p.x,p.y,p.z),c.push(0,0,1),f.x=(p.x/t+1)/2,f.y=(p.y/t+1)/2,h.push(f.x,f.y)}u+=d}for(let g=0;g<s;g++){const m=g*(r+1);for(let v=0;v<r;v++){const _=v+m,y=_,x=_+r+1,b=_+r+2,M=_+1;o.push(y,x,M),o.push(x,b,M)}}this.setIndex(o),this.setAttribute("position",new Se(l,3)),this.setAttribute("normal",new Se(c,3)),this.setAttribute("uv",new Se(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _h(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class vp extends Oe{constructor(e=new Ea([new ne(0,.5),new ne(-.5,-.5),new ne(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],s=[],a=[],n=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(o,l,h),o+=l,l=0;function c(h){const u=s.length/3,d=h.extractPoints(t);let p=d.shape;const f=d.holes;qr.isClockWise(p)===!1&&(p=p.reverse());for(let m=0,v=f.length;m<v;m++){const _=f[m];qr.isClockWise(_)===!0&&(f[m]=_.reverse())}const g=qr.triangulateShape(p,f);for(let m=0,v=f.length;m<v;m++){const _=f[m];p=p.concat(_)}for(let m=0,v=p.length;m<v;m++){const _=p[m];s.push(_.x,_.y,0),a.push(0,0,1),n.push(_.x,_.y)}for(let m=0,v=g.length;m<v;m++){const _=g[m],y=_[0]+u,x=_[1]+u,b=_[2]+u;r.push(y,x,b),l+=3}}this.setIndex(r),this.setAttribute("position",new Se(s,3)),this.setAttribute("normal",new Se(a,3)),this.setAttribute("uv",new Se(n,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(t,r){if(r.shapes=[],Array.isArray(t))for(let s=0,a=t.length;s<a;s++){const n=t[s];r.shapes.push(n.uuid)}else r.shapes.push(t.uuid);return r}(this.parameters.shapes,e)}static fromJSON(e,t){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const n=t[e.shapes[s]];r.push(n)}return new vp(r,e.curveSegments)}}class Wn extends Oe{constructor(e=1,t=32,r=16,s=0,a=2*Math.PI,n=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:s,phiLength:a,thetaStart:n,thetaLength:o},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(n+o,Math.PI);let c=0;const h=[],u=new R,d=new R,p=[],f=[],g=[],m=[];for(let v=0;v<=r;v++){const _=[],y=v/r;let x=0;v===0&&n===0?x=.5/t:v===r&&l===Math.PI&&(x=-.5/t);for(let b=0;b<=t;b++){const M=b/t;u.x=-e*Math.cos(s+M*a)*Math.sin(n+y*o),u.y=e*Math.cos(n+y*o),u.z=e*Math.sin(s+M*a)*Math.sin(n+y*o),f.push(u.x,u.y,u.z),d.copy(u).normalize(),g.push(d.x,d.y,d.z),m.push(M+x,1-y),_.push(c++)}h.push(_)}for(let v=0;v<r;v++)for(let _=0;_<t;_++){const y=h[v][_+1],x=h[v][_],b=h[v+1][_],M=h[v+1][_+1];(v!==0||n>0)&&p.push(y,x,M),(v!==r-1||l<Math.PI)&&p.push(x,b,M)}this.setIndex(p),this.setAttribute("position",new Se(f,3)),this.setAttribute("normal",new Se(g,3)),this.setAttribute("uv",new Se(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wn(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class _p extends Ha{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _p(e.radius,e.detail)}}class hs extends Oe{constructor(e=1,t=.4,r=12,s=48,a=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:s,arc:a},r=Math.floor(r),s=Math.floor(s);const n=[],o=[],l=[],c=[],h=new R,u=new R,d=new R;for(let p=0;p<=r;p++)for(let f=0;f<=s;f++){const g=f/s*a,m=p/r*Math.PI*2;u.x=(e+t*Math.cos(m))*Math.cos(g),u.y=(e+t*Math.cos(m))*Math.sin(g),u.z=t*Math.sin(m),o.push(u.x,u.y,u.z),h.x=e*Math.cos(g),h.y=e*Math.sin(g),d.subVectors(u,h).normalize(),l.push(d.x,d.y,d.z),c.push(f/s),c.push(p/r)}for(let p=1;p<=r;p++)for(let f=1;f<=s;f++){const g=(s+1)*p+f-1,m=(s+1)*(p-1)+f-1,v=(s+1)*(p-1)+f,_=(s+1)*p+f;n.push(g,m,_),n.push(m,v,_)}this.setIndex(n),this.setAttribute("position",new Se(o,3)),this.setAttribute("normal",new Se(l,3)),this.setAttribute("uv",new Se(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hs(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class yp extends Oe{constructor(e=1,t=.4,r=64,s=8,a=2,n=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:s,p:a,q:n},r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[],u=new R,d=new R,p=new R,f=new R,g=new R,m=new R,v=new R;for(let y=0;y<=r;++y){const x=y/r*a*Math.PI*2;_(x,a,n,e,p),_(x+.01,a,n,e,f),m.subVectors(f,p),v.addVectors(f,p),g.crossVectors(m,v),v.crossVectors(g,m),g.normalize(),v.normalize();for(let b=0;b<=s;++b){const M=b/s*Math.PI*2,T=-t*Math.cos(M),E=t*Math.sin(M);u.x=p.x+(T*v.x+E*g.x),u.y=p.y+(T*v.y+E*g.y),u.z=p.z+(T*v.z+E*g.z),l.push(u.x,u.y,u.z),d.subVectors(u,p).normalize(),c.push(d.x,d.y,d.z),h.push(y/r),h.push(b/s)}}for(let y=1;y<=r;y++)for(let x=1;x<=s;x++){const b=(s+1)*(y-1)+(x-1),M=(s+1)*y+(x-1),T=(s+1)*y+x,E=(s+1)*(y-1)+x;o.push(b,M,E),o.push(M,T,E)}function _(y,x,b,M,T){const E=Math.cos(y),C=Math.sin(y),N=b/x*y,D=Math.cos(N);T.x=M*(2+D)*.5*E,T.y=M*(2+D)*C*.5,T.z=M*Math.sin(N)*.5}this.setIndex(o),this.setAttribute("position",new Se(l,3)),this.setAttribute("normal",new Se(c,3)),this.setAttribute("uv",new Se(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yp(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Xs extends Oe{constructor(e=new u0(new R(-1,-1,0),new R(-1,1,0),new R(1,1,0)),t=64,r=1,s=8,a=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:s,closed:a};const n=e.computeFrenetFrames(t,a);this.tangents=n.tangents,this.normals=n.normals,this.binormals=n.binormals;const o=new R,l=new R,c=new ne;let h=new R;const u=[],d=[],p=[],f=[];function g(m){h=e.getPointAt(m/t,h);const v=n.normals[m],_=n.binormals[m];for(let y=0;y<=s;y++){const x=y/s*Math.PI*2,b=Math.sin(x),M=-Math.cos(x);l.x=M*v.x+b*_.x,l.y=M*v.y+b*_.y,l.z=M*v.z+b*_.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=h.x+r*l.x,o.y=h.y+r*l.y,o.z=h.z+r*l.z,u.push(o.x,o.y,o.z)}}(function(){for(let m=0;m<t;m++)g(m);g(a===!1?t:0),function(){for(let m=0;m<=t;m++)for(let v=0;v<=s;v++)c.x=m/t,c.y=v/s,p.push(c.x,c.y)}(),function(){for(let m=1;m<=t;m++)for(let v=1;v<=s;v++){const _=(s+1)*(m-1)+(v-1),y=(s+1)*m+(v-1),x=(s+1)*m+v,b=(s+1)*(m-1)+v;f.push(_,y,b),f.push(y,x,b)}}()})(),this.setIndex(f),this.setAttribute("position",new Se(u,3)),this.setAttribute("normal",new Se(d,3)),this.setAttribute("uv",new Se(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Xs(new _d[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class p0 extends Oe{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],r=new Set,s=new R,a=new R;if(e.index!==null){const n=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const u=l[c],d=u.start;for(let p=d,f=d+u.count;p<f;p+=3)for(let g=0;g<3;g++){const m=o.getX(p+g),v=o.getX(p+(g+1)%3);s.fromBufferAttribute(n,m),a.fromBufferAttribute(n,v),O_(s,a,r)===!0&&(t.push(s.x,s.y,s.z),t.push(a.x,a.y,a.z))}}}else{const n=e.attributes.position;for(let o=0,l=n.count/3;o<l;o++)for(let c=0;c<3;c++){const h=3*o+c,u=3*o+(c+1)%3;s.fromBufferAttribute(n,h),a.fromBufferAttribute(n,u),O_(s,a,r)===!0&&(t.push(s.x,s.y,s.z),t.push(a.x,a.y,a.z))}}this.setAttribute("position",new Se(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function O_(i,e,t){const r=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(r)!==!0&&t.has(s)!==!0&&(t.add(r),t.add(s),!0)}var U_=Object.freeze({__proto__:null,BoxGeometry:Ot,CapsuleGeometry:fh,CircleGeometry:gh,ConeGeometry:vh,CylinderGeometry:zt,DodecahedronGeometry:mp,EdgesGeometry:Vx,ExtrudeGeometry:Kn,IcosahedronGeometry:gp,LatheGeometry:mh,OctahedronGeometry:zs,PlaneGeometry:ws,PolyhedronGeometry:Ha,RingGeometry:_h,ShapeGeometry:vp,SphereGeometry:Wn,TetrahedronGeometry:_p,TorusGeometry:hs,TorusKnotGeometry:yp,TubeGeometry:Xs,WireframeGeometry:p0});class jx extends ti{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new fe(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class m0 extends ct{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class hl extends ti{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new fe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rt,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class yr extends hl{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ne(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Vt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new fe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new fe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new fe(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Xn extends ti{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new fe(16777215),this.specular=new fe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rt,this.combine=ch,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class f0 extends ti{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new fe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class xp extends ti{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class bp extends ti{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Rt,this.combine=ch,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Wx extends ti{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new fe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Xx extends Yt{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Cn(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function qx(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Yx(i){const e=i.length,t=new Array(e);for(let r=0;r!==e;++r)t[r]=r;return t.sort(function(r,s){return i[r]-i[s]}),t}function ag(i,e,t){const r=i.length,s=new i.constructor(r);for(let a=0,n=0;n!==r;++a){const o=t[a]*e;for(let l=0;l!==e;++l)s[n++]=i[o+l]}return s}function g0(i,e,t,r){let s=1,a=i[0];for(;a!==void 0&&a[r]===void 0;)a=i[s++];if(a===void 0)return;let n=a[r];if(n!==void 0)if(Array.isArray(n))do n=a[r],n!==void 0&&(e.push(a.time),t.push.apply(t,n)),a=i[s++];while(a!==void 0);else if(n.toArray!==void 0)do n=a[r],n!==void 0&&(e.push(a.time),n.toArray(t,t.length)),a=i[s++];while(a!==void 0);else do n=a[r],n!==void 0&&(e.push(a.time),t.push(n)),a=i[s++];while(a!==void 0)}const XT={convertArray:Cn,isTypedArray:qx,getKeyframeOrder:Yx,sortedArray:ag,flattenJSON:g0,subclip:function(i,e,t,r,s=30){const a=i.clone();a.name=e;const n=[];for(let l=0;l<a.tracks.length;++l){const c=a.tracks[l],h=c.getValueSize(),u=[],d=[];for(let p=0;p<c.times.length;++p){const f=c.times[p]*s;if(!(f<t||f>=r)){u.push(c.times[p]);for(let g=0;g<h;++g)d.push(c.values[p*h+g])}}u.length!==0&&(c.times=Cn(u,c.times.constructor),c.values=Cn(d,c.values.constructor),n.push(c))}a.tracks=n;let o=1/0;for(let l=0;l<a.tracks.length;++l)o>a.tracks[l].times[0]&&(o=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*o);return a.resetDuration(),a},makeClipAdditive:function(i,e=0,t=i,r=30){r<=0&&(r=30);const s=t.tracks.length,a=e/r;for(let n=0;n<s;++n){const o=t.tracks[n],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(v){return v.name===o.name&&v.ValueTypeName===l});if(c===void 0)continue;let h=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=u/3);let d=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const f=o.times.length-1;let g;if(a<=o.times[0]){const v=h,_=u-h;g=o.values.slice(v,_)}else if(a>=o.times[f]){const v=f*u+h,_=v+u-h;g=o.values.slice(v,_)}else{const v=o.createInterpolant(),_=h,y=u-h;v.evaluate(a),g=v.resultBuffer.slice(_,y)}l==="quaternion"&&new it().fromArray(g).normalize().conjugate().toArray(g);const m=c.times.length;for(let v=0;v<m;++v){const _=v*p+d;if(l==="quaternion")it.multiplyQuaternionsFlat(c.values,_,g,0,c.values,_);else{const y=p-2*d;for(let x=0;x<y;++x)c.values[_+x]-=g[x]}}}return i.blendMode=e0,i}};class Ml{constructor(e,t,r,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,s=t[r],a=t[r-1];e:{t:{let n;i:{r:if(!(e<s)){for(let o=r+2;;){if(s===void 0){if(e<a)break r;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(a=s,s=t[++r],e<s)break t}n=t.length;break i}if(e>=a)break e;{const o=t[1];e<o&&(r=2,a=o);for(let l=r-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(s=a,a=t[--r-1],e>=a)break t}n=r,r=0}}for(;r<n;){const o=r+n>>>1;e<t[o]?n=o:r=o+1}if(s=t[r],a=t[r-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,a,s)}return this.interpolate_(r,a,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s;for(let n=0;n!==s;++n)t[n]=r[a+n];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Zx extends Ml{constructor(e,t,r,s){super(e,t,r,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:An,endingEnd:An}}intervalChanged_(e,t,r){const s=this.parameterPositions;let a=e-2,n=e+1,o=s[a],l=s[n];if(o===void 0)switch(this.getSettings_().endingStart){case En:a=e,o=2*t-r;break;case Ec:a=s.length-2,o=t+s[a]-s[a+1];break;default:a=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case En:n=e,l=2*r-t;break;case Ec:n=1,l=r+s[1]-s[0];break;default:n=e-1,l=t}const c=.5*(r-t),h=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-r),this._offsetPrev=a*h,this._offsetNext=n*h}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(r-t)/(s-t),g=f*f,m=g*f,v=-d*m+2*d*g-d*f,_=(1+d)*m+(-1.5-2*d)*g+(-.5+d)*f+1,y=(-1-p)*m+(1.5+p)*g+.5*f,x=p*m-p*g;for(let b=0;b!==o;++b)a[b]=v*n[h+b]+_*n[c+b]+y*n[l+b]+x*n[u+b];return a}}class v0 extends Ml{constructor(e,t,r,s){super(e,t,r,s)}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=(r-t)/(s-t),u=1-h;for(let d=0;d!==o;++d)a[d]=n[c+d]*u+n[l+d]*h;return a}}class Kx extends Ml{constructor(e,t,r,s){super(e,t,r,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Yr{constructor(e,t,r,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Cn(t,this.TimeBufferType),this.values=Cn(r,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:Cn(e.times,Array),values:Cn(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(r.interpolation=s)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new Kx(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new v0(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Zx(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case tl:t=this.InterpolantFactoryMethodDiscrete;break;case il:t=this.InterpolantFactoryMethodLinear;break;case td:t=this.InterpolantFactoryMethodSmooth}if(t===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return tl;case this.InterpolantFactoryMethodLinear:return il;case this.InterpolantFactoryMethodSmooth:return td}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let r=0,s=t.length;r!==s;++r)t[r]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let r=0,s=t.length;r!==s;++r)t[r]*=e}return this}trim(e,t){const r=this.times,s=r.length;let a=0,n=s-1;for(;a!==s&&r[a]<e;)++a;for(;n!==-1&&r[n]>t;)--n;if(++n,a!==0||n!==s){a>=n&&(n=Math.max(n,1),a=n-1);const o=this.getValueSize();this.times=r.slice(a,n),this.values=this.values.slice(a*o,n*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(e=!1);const r=this.times,s=this.values,a=r.length;a===0&&(e=!1);let n=null;for(let o=0;o!==a;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){e=!1;break}if(n!==null&&n>l){e=!1;break}n=l}if(s!==void 0&&qx(s))for(let o=0,l=s.length;o!==l;++o){const c=s[o];if(isNaN(c)){e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),s=this.getInterpolation()===td,a=e.length-1;let n=1;for(let o=1;o<a;++o){let l=!1;const c=e[o];if(c!==e[o+1]&&(o!==1||c!==e[0]))if(s)l=!0;else{const h=o*r,u=h-r,d=h+r;for(let p=0;p!==r;++p){const f=t[h+p];if(f!==t[u+p]||f!==t[d+p]){l=!0;break}}}if(l){if(o!==n){e[n]=e[o];const h=o*r,u=n*r;for(let d=0;d!==r;++d)t[u+d]=t[h+d]}++n}}if(a>0){e[n]=e[a];for(let o=a*r,l=n*r,c=0;c!==r;++c)t[l+c]=t[o+c];++n}return n!==e.length?(this.times=e.slice(0,n),this.values=t.slice(0,n*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=new this.constructor(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Yr.prototype.TimeBufferType=Float32Array,Yr.prototype.ValueBufferType=Float32Array,Yr.prototype.DefaultInterpolation=il;class Mn extends Yr{constructor(e,t,r){super(e,t,r)}}Mn.prototype.ValueTypeName="bool",Mn.prototype.ValueBufferType=Array,Mn.prototype.DefaultInterpolation=tl,Mn.prototype.InterpolantFactoryMethodLinear=void 0,Mn.prototype.InterpolantFactoryMethodSmooth=void 0;class _0 extends Yr{}_0.prototype.ValueTypeName="color";class Ua extends Yr{}Ua.prototype.ValueTypeName="number";class Qx extends Ml{constructor(e,t,r,s){super(e,t,r,s)}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=(r-t)/(s-t);let c=e*o;for(let h=c+o;c!==h;c+=4)it.slerpFlat(a,0,n,c-o,n,c,l);return a}}class qs extends Yr{InterpolantFactoryMethodLinear(e){return new Qx(this.times,this.values,this.getValueSize(),e)}}qs.prototype.ValueTypeName="quaternion",qs.prototype.InterpolantFactoryMethodSmooth=void 0;class wn extends Yr{constructor(e,t,r){super(e,t,r)}}wn.prototype.ValueTypeName="string",wn.prototype.ValueBufferType=Array,wn.prototype.DefaultInterpolation=tl,wn.prototype.InterpolantFactoryMethodLinear=void 0,wn.prototype.InterpolantFactoryMethodSmooth=void 0;class ka extends Yr{}ka.prototype.ValueTypeName="vector";class Ln{constructor(e="",t=-1,r=[],s=2500){this.name=e,this.tracks=r,this.duration=t,this.blendMode=s,this.uuid=vr(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,s=1/(e.fps||1);for(let n=0,o=r.length;n!==o;++n)t.push(qT(r[n]).scale(s));const a=new this(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a}static toJSON(e){const t=[],r=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let a=0,n=r.length;a!==n;++a)t.push(Yr.toJSON(r[a]));return s}static CreateFromMorphTargetSequence(e,t,r,s){const a=t.length,n=[];for(let o=0;o<a;o++){let l=[],c=[];l.push((o+a-1)%a,o,(o+1)%a),c.push(0,1,0);const h=Yx(l);l=ag(l,1,h),c=ag(c,1,h),s||l[0]!==0||(l.push(a),c.push(c[0])),n.push(new Ua(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/r))}return new this(e,-1,n)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const s=e;r=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<r.length;s++)if(r[s].name===t)return r[s];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const s={},a=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],h=c.name.match(a);if(h&&h.length>1){const u=h[1];let d=s[u];d||(s[u]=d=[]),d.push(c)}}const n=[];for(const o in s)n.push(this.CreateFromMorphTargetSequence(o,s[o],t,r));return n}static parseAnimation(e,t){if(!e)return null;const r=function(h,u,d,p,f){if(d.length!==0){const g=[],m=[];g0(d,g,m,p),g.length!==0&&f.push(new h(u,g,m))}},s=[],a=e.name||"default",n=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const u=c[h].keys;if(u&&u.length!==0)if(u[0].morphTargets){const d={};let p;for(p=0;p<u.length;p++)if(u[p].morphTargets)for(let f=0;f<u[p].morphTargets.length;f++)d[u[p].morphTargets[f]]=-1;for(const f in d){const g=[],m=[];for(let v=0;v!==u[p].morphTargets.length;++v){const _=u[p];g.push(_.time),m.push(_.morphTarget===f?1:0)}s.push(new Ua(".morphTargetInfluence["+f+"]",g,m))}l=d.length*n}else{const d=".bones["+t[h].name+"]";r(ka,d+".position",u,"pos",s),r(qs,d+".quaternion",u,"rot",s),r(ka,d+".scale",u,"scl",s)}}return s.length===0?null:new this(a,l,s,o)}resetDuration(){let e=0;for(let t=0,r=this.tracks.length;t!==r;++t){const s=this.tracks[t];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function qT(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ua;case"vector":case"vector2":case"vector3":case"vector4":return ka;case"color":return _0;case"quaternion":return qs;case"bool":case"boolean":return Mn;case"string":return wn}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(i.type);if(i.times===void 0){const t=[],r=[];g0(i.keys,t,r,"value"),i.times=t,i.values=r}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const Vs={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class ng{constructor(e,t,r){const s=this;let a=!1,n=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(h){o++,a===!1&&s.onStart!==void 0&&s.onStart(h,n,o),a=!0},this.itemEnd=function(h){n++,s.onProgress!==void 0&&s.onProgress(h,n,o),n===o&&(a=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const p=c[u],f=c[u+1];if(p.global&&(p.lastIndex=0),p.test(h))return f}return null}}}const y0=new ng;class Ht{constructor(e){this.manager=e!==void 0?e:y0,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(s,a){r.load(e,s,t,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ht.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ps={};class YT extends Error{constructor(e,t){super(e),this.response=t}}class Ti extends Ht{constructor(e){super(e)}load(e,t,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=Vs.get(e);if(a!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(a),this.manager.itemEnd(e)},0),a;if(Ps[e]!==void 0)return void Ps[e].push({onLoad:t,onProgress:r,onError:s});Ps[e]=[],Ps[e].push({onLoad:t,onProgress:r,onError:s});const n=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(n).then(c=>{if(c.status===200||c.status===0){if(c.status,typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=Ps[e],u=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=d?parseInt(d):0,f=p!==0;let g=0;const m=new ReadableStream({start(v){(function _(){u.read().then(({done:y,value:x})=>{if(y)v.close();else{g+=x.byteLength;const b=new ProgressEvent("progress",{lengthComputable:f,loaded:g,total:p});for(let M=0,T=h.length;M<T;M++){const E=h[M];E.onProgress&&E.onProgress(b)}v.enqueue(x),_()}},y=>{v.error(y)})})()}});return new Response(m)}throw new YT(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,o));case"json":return c.json();default:if(o===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),u=h&&h[1]?h[1].toLowerCase():void 0,d=new TextDecoder(u);return c.arrayBuffer().then(p=>d.decode(p))}}}).then(c=>{Vs.add(e,c);const h=Ps[e];delete Ps[e];for(let u=0,d=h.length;u<d;u++){const p=h[u];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=Ps[e];if(h===void 0)throw this.manager.itemError(e),c;delete Ps[e];for(let u=0,d=h.length;u<d;u++){const p=h[u];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class fc extends Ht{constructor(e){super(e)}load(e,t,r,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,n=Vs.get(e);if(n!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(n),a.manager.itemEnd(e)},0),n;const o=Nc("img");function l(){h(),Vs.add(e,this),t&&t(this),a.manager.itemEnd(e)}function c(u){h(),s&&s(u),a.manager.itemError(e),a.manager.itemEnd(e)}function h(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),a.manager.itemStart(e),o.src=e,o}}class og extends Ht{constructor(e){super(e)}load(e,t,r,s){const a=new Dc;a.colorSpace=Tt;const n=new fc(this.manager);n.setCrossOrigin(this.crossOrigin),n.setPath(this.path);let o=0;function l(c){n.load(e[c],function(h){a.images[c]=h,o++,o===6&&(a.needsUpdate=!0,t&&t(a))},void 0,s)}for(let c=0;c<e.length;++c)l(c);return a}}class xs extends Ht{constructor(e){super(e)}load(e,t,r,s){const a=new wt,n=new fc(this.manager);return n.setCrossOrigin(this.crossOrigin),n.setPath(this.path),n.load(e,function(o){a.image=o,a.needsUpdate=!0,t!==void 0&&t(a)},r,s),a}}class Qs extends je{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new fe(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class lg extends Qs{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(je.DEFAULT_UP),this.updateMatrix(),this.groundColor=new fe(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const xm=new Me,k_=new R,F_=new R;class x0{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ne(512,512),this.map=null,this.mapPass=null,this.matrix=new Me,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new uh,this._frameExtents=new ne(1,1),this._viewportCount=1,this._viewports=[new qe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;k_.setFromMatrixPosition(e.matrixWorld),t.position.copy(k_),F_.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(F_),t.updateMatrixWorld(),xm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xm),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(xm)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ZT extends x0{constructor(){super(new Jt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=2*rl*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;r===t.fov&&s===t.aspect&&a===t.far||(t.fov=r,t.aspect=s,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Fc extends Qs{constructor(e,t,r=0,s=Math.PI/3,a=0,n=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(je.DEFAULT_UP),this.updateMatrix(),this.target=new je,this.distance=r,this.angle=s,this.penumbra=a,this.decay=n,this.map=null,this.shadow=new ZT}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const B_=new Me,Bl=new R,bm=new R;class KT extends x0{constructor(){super(new Jt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ne(4,2),this._viewportCount=6,this._viewports=[new qe(2,1,1,1),new qe(0,1,1,1),new qe(3,1,1,1),new qe(1,1,1,1),new qe(3,0,1,1),new qe(1,0,1,1)],this._cubeDirections=[new R(1,0,0),new R(-1,0,0),new R(0,0,1),new R(0,0,-1),new R(0,1,0),new R(0,-1,0)],this._cubeUps=[new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,1,0),new R(0,0,1),new R(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,s=this.matrix,a=e.distance||r.far;a!==r.far&&(r.far=a,r.updateProjectionMatrix()),Bl.setFromMatrixPosition(e.matrixWorld),r.position.copy(Bl),bm.copy(r.position),bm.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(bm),r.updateMatrixWorld(),s.makeTranslation(-Bl.x,-Bl.y,-Bl.z),B_.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(B_)}}class ul extends Qs{constructor(e,t,r=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=s,this.shadow=new KT}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class QT extends x0{constructor(){super(new Gn(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Bc extends Qs{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(je.DEFAULT_UP),this.updateMatrix(),this.target=new je,this.shadow=new QT}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class yd extends Qs{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class cg extends Qs{constructor(e,t,r=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Jx{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new R)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,s=e.y,a=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.282095),t.addScaledVector(n[1],.488603*s),t.addScaledVector(n[2],.488603*a),t.addScaledVector(n[3],.488603*r),t.addScaledVector(n[4],r*s*1.092548),t.addScaledVector(n[5],s*a*1.092548),t.addScaledVector(n[6],.315392*(3*a*a-1)),t.addScaledVector(n[7],r*a*1.092548),t.addScaledVector(n[8],.546274*(r*r-s*s)),t}getIrradianceAt(e,t){const r=e.x,s=e.y,a=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.886227),t.addScaledVector(n[1],1.023328*s),t.addScaledVector(n[2],1.023328*a),t.addScaledVector(n[3],1.023328*r),t.addScaledVector(n[4],.858086*r*s),t.addScaledVector(n[5],.858086*s*a),t.addScaledVector(n[6],.743125*a*a-.247708),t.addScaledVector(n[7],.858086*r*a),t.addScaledVector(n[8],.429043*(r*r-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].fromArray(e,t+3*s);return this}toArray(e=[],t=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].toArray(e,t+3*s);return e}static getBasisAt(e,t){const r=e.x,s=e.y,a=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*a,t[3]=.488603*r,t[4]=1.092548*r*s,t[5]=1.092548*s*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*r*a,t[8]=.546274*(r*r-s*s)}}class z_ extends Qs{constructor(e=new Jx,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class xd extends Ht{constructor(e){super(e),this.textures={}}load(e,t,r,s){const a=this,n=new Ti(a.manager);n.setPath(a.path),n.setRequestHeader(a.requestHeader),n.setWithCredentials(a.withCredentials),n.load(e,function(o){try{t(a.parse(JSON.parse(o)))}catch(l){s&&s(l),a.manager.itemError(e)}},r,s)}parse(e){const t=this.textures;function r(a){return t[a],t[a]}const s=xd.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new fe().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(s.dispersion=e.dispersion),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const a in e.uniforms){const n=e.uniforms[a];switch(s.uniforms[a]={},n.type){case"t":s.uniforms[a].value=r(n.value);break;case"c":s.uniforms[a].value=new fe().setHex(n.value);break;case"v2":s.uniforms[a].value=new ne().fromArray(n.value);break;case"v3":s.uniforms[a].value=new R().fromArray(n.value);break;case"v4":s.uniforms[a].value=new qe().fromArray(n.value);break;case"m3":s.uniforms[a].value=new Ve().fromArray(n.value);break;case"m4":s.uniforms[a].value=new Me().fromArray(n.value);break;default:s.uniforms[a].value=n.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const a in e.extensions)s.extensions[a]=e.extensions[a];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=r(e.map)),e.matcap!==void 0&&(s.matcap=r(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let a=e.normalScale;Array.isArray(a)===!1&&(a=[a,a]),s.normalScale=new ne().fromArray(a)}return e.displacementMap!==void 0&&(s.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=r(e.envMap)),e.envMapRotation!==void 0&&s.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new ne().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=r(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:jx,SpriteMaterial:n0,RawShaderMaterial:m0,ShaderMaterial:ct,PointsMaterial:ga,MeshPhysicalMaterial:yr,MeshStandardMaterial:hl,MeshPhongMaterial:Xn,MeshToonMaterial:f0,MeshNormalMaterial:xp,MeshLambertMaterial:bp,MeshDepthMaterial:up,MeshDistanceMaterial:a0,MeshBasicMaterial:ei,MeshMatcapMaterial:Wx,LineDashedMaterial:Xx,LineBasicMaterial:Yt,Material:ti}[e]}}class gs{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class b0 extends Oe{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class V_ extends Ht{constructor(e){super(e)}load(e,t,r,s){const a=this,n=new Ti(a.manager);n.setPath(a.path),n.setRequestHeader(a.requestHeader),n.setWithCredentials(a.withCredentials),n.load(e,function(o){try{t(a.parse(JSON.parse(o)))}catch(l){s&&s(l),a.manager.itemError(e)}},r,s)}parse(e){const t={},r={};function s(u,d){if(t[d]!==void 0)return t[d];const p=u.interleavedBuffers[d],f=function(v,_){if(r[_]!==void 0)return r[_];const y=v.arrayBuffers,x=y[_],b=new Uint32Array(x).buffer;return r[_]=b,b}(u,p.buffer),g=Co(p.type,f),m=new ph(g,p.stride);return m.uuid=p.uuid,t[d]=m,m}const a=e.isInstancedBufferGeometry?new b0:new Oe,n=e.data.index;if(n!==void 0){const u=Co(n.type,n.array);a.setIndex(new tt(u,1))}const o=e.data.attributes;for(const u in o){const d=o[u];let p;if(d.isInterleavedBufferAttribute){const f=s(e.data,d.data);p=new Ji(f,d.itemSize,d.offset,d.normalized)}else{const f=Co(d.type,d.array);p=new(d.isInstancedBufferAttribute?In:tt)(f,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),a.setAttribute(u,p)}const l=e.data.morphAttributes;if(l)for(const u in l){const d=l[u],p=[];for(let f=0,g=d.length;f<g;f++){const m=d[f];let v;if(m.isInterleavedBufferAttribute){const _=s(e.data,m.data);v=new Ji(_,m.itemSize,m.offset,m.normalized)}else{const _=Co(m.type,m.array);v=new tt(_,m.itemSize,m.normalized)}m.name!==void 0&&(v.name=m.name),p.push(v)}a.morphAttributes[u]=p}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let u=0,d=c.length;u!==d;++u){const p=c[u];a.addGroup(p.start,p.count,p.materialIndex)}const h=e.data.boundingSphere;if(h!==void 0){const u=new R;h.center!==void 0&&u.fromArray(h.center),a.boundingSphere=new di(u,h.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}const JT={UVMapping:sp,CubeReflectionMapping:Ws,CubeRefractionMapping:La,EquirectangularReflectionMapping:Jo,EquirectangularRefractionMapping:Ac,CubeUVReflectionMapping:xl},H_={RepeatWrapping:$t,ClampToEdgeWrapping:Ai,MirroredRepeatWrapping:Na},G_={NearestFilter:dt,NearestMipmapNearestFilter:ap,NearestMipmapLinearFilter:Tn,LinearFilter:Kt,LinearMipmapNearestFilter:Bo,LinearMipmapLinearFilter:fs};class $x extends Ht{constructor(e){super(e),this.isImageBitmapLoader=!0,this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,n=Vs.get(e);if(n!==void 0)return a.manager.itemStart(e),n.then?void n.then(c=>{t&&t(c),a.manager.itemEnd(e)}).catch(c=>{s&&s(c)}):(setTimeout(function(){t&&t(n),a.manager.itemEnd(e)},0),n);const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const l=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(c){return Vs.add(e,c),t&&t(c),a.manager.itemEnd(e),c}).catch(function(c){s&&s(c),Vs.remove(e),a.manager.itemError(e),a.manager.itemEnd(e)});Vs.add(e,l),a.manager.itemStart(e)}}let gu;class Mm{static getContext(){return gu===void 0&&(gu=new(window.AudioContext||window.webkitAudioContext)),gu}static setContext(e){gu=e}}const j_=new Me,W_=new Me,rn=new Me;class zc{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=X_(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=X_();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function X_(){return(typeof performance>"u"?Date:performance).now()}const sn=new R,q_=new it,$T=new R,an=new R;class Y_ extends je{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0||this.hasPlaybackControl===!1)return;this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl!==!1&&this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const nn=new R,Z_=new it,eA=new R,on=new R;class eb{constructor(e,t,r){let s,a,n;switch(this.binding=e,this.valueSize=r,t){case"quaternion":s=this._slerp,a=this._slerpAdditive,n=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":s=this._select,a=this._select,n=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:s=this._lerp,a=this._lerpAdditive,n=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=a,this._setIdentity=n,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,s=this.valueSize,a=e*s+s;let n=this.cumulativeWeight;if(n===0){for(let o=0;o!==s;++o)r[a+o]=r[o];n=t}else{n+=t;const o=t/n;this._mixBufferRegion(r,a,0,o,s)}this.cumulativeWeight=n}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,s=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,s=e*t+t,a=this.cumulativeWeight,n=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const l=t*this._origIndex;this._mixBufferRegion(r,s,l,1-a,t)}n>0&&this._mixBufferRegionAdditive(r,s,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(r[l]!==r[l+t]){o.setValue(r,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,s=r*this._origIndex;e.getValue(t,s);for(let a=r,n=s;a!==n;++a)t[a]=t[s+a%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,s,a){if(s>=.5)for(let n=0;n!==a;++n)e[t+n]=e[r+n]}_slerp(e,t,r,s){it.slerpFlat(e,t,e,t,e,r,s)}_slerpAdditive(e,t,r,s,a){const n=this._workIndex*a;it.multiplyQuaternionsFlat(e,n,e,t,e,r),it.slerpFlat(e,t,e,t,e,n,s)}_lerp(e,t,r,s,a){const n=1-s;for(let o=0;o!==a;++o){const l=t+o;e[l]=e[l]*n+e[r+o]*s}}_lerpAdditive(e,t,r,s,a){for(let n=0;n!==a;++n){const o=t+n;e[o]=e[o]+e[r+n]*s}}}const M0="\\[\\]\\.:\\/",tA=new RegExp("["+M0+"]","g"),wm="[^"+M0+"]",iA="[^"+M0.replace("\\.","")+"]",rA=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",wm)+/(WCOD+)?/.source.replace("WCOD",iA)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wm)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wm)+"$"),sA=["material","materials","bones","map"];class Je{constructor(e,t,r){this.path=t,this.parsedPath=r||Je.parseTrackName(t),this.node=Je.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new Je.Composite(e,t,r):new Je(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tA,"")}static parseTrackName(e){const t=rA.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const a=r.nodeName.substring(s+1);sA.indexOf(a)!==-1&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=a)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(a){for(let n=0;n<a.length;n++){const o=a[n];if(o.name===t||o.uuid===t)return o;const l=r(o.children);if(l)return l}return null},s=r(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)e[t++]=r[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,s=t.propertyName;let a=t.propertyIndex;if(e||(e=Je.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return;if(r){let c=t.objectIndex;switch(r){case"materials":if(!e.material||!e.material.materials)return;e=e.material.materials;break;case"bones":if(!e.skeleton)return;e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material||!e.material.map)return;e=e.material.map;break;default:if(e[r]===void 0)return;e=e[r]}if(c!==void 0){if(e[c]===void 0)return;e=e[c]}}const n=e[s];if(n===void 0){t.nodeName;return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(a!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry||!e.geometry.morphAttributes)return;e.morphTargetDictionary[a]!==void 0&&(a=e.morphTargetDictionary[a])}l=this.BindingType.ArrayElement,this.resolvedProperty=n,this.propertyIndex=a}else n.fromArray!==void 0&&n.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(l=this.BindingType.EntireArray,this.resolvedProperty=n):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Je.Composite=class{constructor(i,e,t){const r=t||Je.parseTrackName(e);this._targetGroup=i,this._bindings=i.subscribe_(e,r)}getValue(i,e){this.bind();const t=this._targetGroup.nCachedObjects_,r=this._bindings[t];r!==void 0&&r.getValue(i,e)}setValue(i,e){const t=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=t.length;r!==s;++r)t[r].setValue(i,e)}bind(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].bind()}unbind(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].unbind()}},Je.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Je.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Je.prototype.GetterByBindingType=[Je.prototype._getValue_direct,Je.prototype._getValue_array,Je.prototype._getValue_arrayElement,Je.prototype._getValue_toArray],Je.prototype.SetterByBindingTypeAndVersioning=[[Je.prototype._setValue_direct,Je.prototype._setValue_direct_setNeedsUpdate,Je.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Je.prototype._setValue_array,Je.prototype._setValue_array_setNeedsUpdate,Je.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Je.prototype._setValue_arrayElement,Je.prototype._setValue_arrayElement_setNeedsUpdate,Je.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Je.prototype._setValue_fromArray,Je.prototype._setValue_fromArray_setNeedsUpdate,Je.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class tb{constructor(e,t,r=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=s;const a=t.tracks,n=a.length,o=new Array(n),l={endingStart:An,endingEnd:An};for(let c=0;c!==n;++c){const h=a[c].createInterpolant(null);o[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=$g,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const s=this._clip.duration,a=e._clip.duration,n=a/s,o=s/a;e.warp(1,n,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const s=this._mixer,a=s.time,n=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=s._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=a,l[1]=a+r,c[0]=e/n,c[1]=t/n,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,s){if(!this.enabled)return void this._updateWeight(e);const a=this._startTime;if(a!==null){const l=(e-a)*r;l<0||r===0?t=0:(this._startTime=null,t=r*l)}t*=this._updateTimeScale(e);const n=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;if(this.blendMode===e0)for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(n),c[h].accumulateAdditive(o);else for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(n),c[h].accumulate(s,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(r!==null){const s=r.evaluate(e)[0];t*=s,e>r.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;r!==null&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let s=this.time+e,a=this._loopCount;const n=r===2202;if(e===0)return a===-1||!n||1&~a?s:t-s;if(r===Jg){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else{if(!(s<0)){this.time=s;break e}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(a===-1&&(e>=0?(a=0,this._setEndings(!0,this.repetitions===0,n)):this._setEndings(this.repetitions===0,!0,n)),s>=t||s<0){const o=Math.floor(s/t);s-=t*o,a+=Math.abs(o);const l=this.repetitions-a;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,n)}else this._setEndings(!1,!1,n);this._loopCount=a,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(n&&!(1&~a))return t-s}return s}_setEndings(e,t,r){const s=this._interpolantSettings;r?(s.endingStart=En,s.endingEnd=En):(s.endingStart=e?this.zeroSlopeAtStart?En:An:Ec,s.endingEnd=t?this.zeroSlopeAtEnd?En:An:Ec)}_scheduleFading(e,t,r){const s=this._mixer,a=s.time;let n=this._weightInterpolant;n===null&&(n=s._lendControlInterpolant(),this._weightInterpolant=n);const o=n.parameterPositions,l=n.sampleValues;return o[0]=a,l[0]=t,o[1]=a+e,l[1]=r,this}}const aA=new Float32Array(1);class ib extends ys{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,s=e._clip.tracks,a=s.length,n=e._propertyBindings,o=e._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let u=0;u!==a;++u){const d=s[u],p=d.name;let f=h[p];if(f!==void 0)++f.referenceCount,n[u]=f;else{if(f=n[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,p));continue}const g=t&&t._propertyBindings[u].binding.parsedPath;f=new eb(Je.create(r,p,g),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,p),n[u]=f}o[u].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,s=e._clip.uuid,a=this._actionsByClip[s];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,s,r)}const t=e._propertyBindings;for(let r=0,s=t.length;r!==s;++r){const a=t[r];a.useCount++==0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,s=t.length;r!==s;++r){const a=t[r];--a.useCount==0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){const s=this._actions,a=this._actionsByClip;let n=a[t];if(n===void 0)n={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=n;else{const o=n.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=s.length,s.push(e),n.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],s=e._cacheIndex;r._cacheIndex=s,t[s]=r,t.pop(),e._cacheIndex=null;const a=e._clip.uuid,n=this._actionsByClip,o=n[a],l=o.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],l.length===0&&delete n[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,s=t.length;r!==s;++r){const a=t[r];--a.referenceCount==0&&this._removeInactiveBinding(a)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,s=this._nActiveActions++,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,s=--this._nActiveActions,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_addInactiveBinding(e,t,r){const s=this._bindingsByRootAndName,a=this._bindings;let n=s[t];n===void 0&&(n={},s[t]=n),n[r]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,s=r.rootNode.uuid,a=r.path,n=this._bindingsByRootAndName,o=n[s],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete o[a],Object.keys(o).length===0&&delete n[s]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,s=this._nActiveBindings++,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,s=--this._nActiveBindings,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return r===void 0&&(r=new v0(new Float32Array(2),new Float32Array(2),1,aA),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,s=--this._nActiveControlInterpolants,a=t[s];e.__cacheIndex=s,t[s]=e,a.__cacheIndex=r,t[r]=a}clipAction(e,t,r){const s=t||this._root,a=s.uuid;let n=typeof e=="string"?Ln.findByName(s,e):e;const o=n!==null?n.uuid:e,l=this._actionsByClip[o];let c=null;if(r===void 0&&(r=n!==null?n.blendMode:vx),l!==void 0){const u=l.actionByRoot[a];if(u!==void 0&&u.blendMode===r)return u;c=l.knownActions[0],n===null&&(n=c._clip)}if(n===null)return null;const h=new tb(this,n,t,r);return this._bindAction(h,c),this._addInactiveAction(h,o,a),h}existingAction(e,t){const r=t||this._root,s=r.uuid,a=typeof e=="string"?Ln.findByName(r,e):e,n=a?a.uuid:e,o=this._actionsByClip[n];return o!==void 0&&o.actionByRoot[s]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,s=this.time+=e,a=Math.sign(e),n=this._accuIndex^=1;for(let c=0;c!==r;++c)t[c]._update(s,e,a,n);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(n);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,s=this._actionsByClip,a=s[r];if(a!==void 0){const n=a.knownActions;for(let o=0,l=n.length;o!==l;++o){const c=n[o];this._deactivateAction(c);const h=c._cacheIndex,u=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,u._cacheIndex=h,t[h]=u,t.pop(),this._removeInactiveBindingsForAction(c)}delete s[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const a in r){const n=r[a].actionByRoot[t];n!==void 0&&(this._deactivateAction(n),this._removeInactiveAction(n))}const s=this._bindingsByRootAndName[t];if(s!==void 0)for(const a in s){const n=s[a];n.restoreOriginalState(),this._removeInactiveBinding(n)}}uncacheAction(e,t){const r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class w0{constructor(e){this.value=e}clone(){return new w0(this.value.clone===void 0?this.value:this.value.clone())}}let nA=0;class bd extends ph{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const K_=new Me;class Mp{constructor(e,t,r=0,s=1/0){this.ray=new Zn(e,t),this.near=r,this.far=s,this.camera=null,this.layers=new op,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera&&(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t)}setFromXRController(e){return K_.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(K_),this}intersectObject(e,t=!0,r=[]){return hg(e,this,r,t),r.sort(Q_),r}intersectObjects(e,t=!0,r=[]){for(let s=0,a=e.length;s<a;s++)hg(e[s],this,r,t);return r.sort(Q_),r}}function Q_(i,e){return i.distance-e.distance}function hg(i,e,t,r){let s=!0;if(i.layers.test(e.layers)&&i.raycast(e,t)===!1&&(s=!1),s===!0&&r===!0){const a=i.children;for(let n=0,o=a.length;n<o;n++)hg(a[n],e,t,!0)}}class ug{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Vt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const J_=new ne,$_=new R,vu=new R;class rb{constructor(e=new R,t=new R){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){$_.subVectors(e,this.start),vu.subVectors(this.end,this.start);const r=vu.dot(vu);let s=vu.dot($_)/r;return t&&(s=Vt(s,0,1)),s}closestPointToPoint(e,t,r){const s=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const ey=new R,ca=new R,_u=new Me,Sm=new Me;function sb(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,sb(i.children[t]));return e}const oA=new R,ty=new fe,iy=new fe;class ab extends or{constructor(e=10,t=10,r=4473924,s=8947848){r=new fe(r),s=new fe(s);const a=t/2,n=e/t,o=e/2,l=[],c=[];for(let u=0,d=0,p=-o;u<=t;u++,p+=n){l.push(-o,0,p,o,0,p),l.push(p,0,-o,p,0,o);const f=u===a?r:s;f.toArray(c,d),d+=3,f.toArray(c,d),d+=3,f.toArray(c,d),d+=3,f.toArray(c,d),d+=3}const h=new Oe;h.setAttribute("position",new Se(l,3)),h.setAttribute("color",new Se(c,3)),super(h,new Yt({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const ry=new R,yu=new R,sy=new R,xu=new R,Bt=new cp;function Wt(i,e,t,r,s,a,n){xu.set(s,a,n).unproject(r);const o=e[i];if(o!==void 0){const l=t.getAttribute("position");for(let c=0,h=o.length;c<h;c++)l.setXYZ(o[c],xu.x,xu.y,xu.z)}}const bu=new Et;class nb extends or{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Oe;s.setIndex(new tt(r,1)),s.setAttribute("position",new Se([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(s,new Yt({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class ob extends vi{constructor(e,t=1,r=16776960){const s=r,a=new Oe;a.setAttribute("position",new Se([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),a.computeBoundingSphere(),super(a,new Yt({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const n=new Oe;n.setAttribute("position",new Se([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new ye(n,new ei({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const ay=new R;let Mu,Tm;class lb extends or{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Oe;r.setAttribute("position",new Se(t,3)),r.setAttribute("color",new Se([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new Yt({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){const s=new fe,a=this.geometry.attributes.color.array;return s.set(e),s.toArray(a,0),s.toArray(a,3),s.set(t),s.toArray(a,6),s.toArray(a,9),s.set(r),s.toArray(a,12),s.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class cb{constructor(){this.type="ShapePath",this.color=new fe,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new cl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,s){return this.currentPath.quadraticCurveTo(e,t,r,s),this}bezierCurveTo(e,t,r,s,a,n){return this.currentPath.bezierCurveTo(e,t,r,s,a,n),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(m,v){const _=v.length;let y=!1;for(let x=_-1,b=0;b<_;x=b++){let M=v[x],T=v[b],E=T.x-M.x,C=T.y-M.y;if(Math.abs(C)>Number.EPSILON){if(C<0&&(M=v[b],E=-E,T=v[x],C=-C),m.y<M.y||m.y>T.y)continue;if(m.y===M.y){if(m.x===M.x)return!0}else{const N=C*(m.x-M.x)-E*(m.y-M.y);if(N===0)return!0;if(N<0)continue;y=!y}}else{if(m.y!==M.y)continue;if(T.x<=m.x&&m.x<=M.x||M.x<=m.x&&m.x<=T.x)return!0}}return y}const r=qr.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,n,o;const l=[];if(s.length===1)return n=s[0],o=new Ea,o.curves=n.curves,l.push(o),l;let c=!r(s[0].getPoints());c=e?!c:c;const h=[],u=[];let d,p,f=[],g=0;u[g]=void 0,f[g]=[];for(let m=0,v=s.length;m<v;m++)n=s[m],d=n.getPoints(),a=r(d),a=e?!a:a,a?(!c&&u[g]&&g++,u[g]={s:new Ea,p:d},u[g].s.curves=n.curves,c&&g++,f[g]=[]):f[g].push({h:n,p:d[0]});if(!u[0])return function(m){const v=[];for(let _=0,y=m.length;_<y;_++){const x=m[_],b=new Ea;b.curves=x.curves,v.push(b)}return v}(s);if(u.length>1){let m=!1,v=0;for(let _=0,y=u.length;_<y;_++)h[_]=[];for(let _=0,y=u.length;_<y;_++){const x=f[_];for(let b=0;b<x.length;b++){const M=x[b];let T=!0;for(let E=0;E<u.length;E++)t(M.p,u[E].p)&&(_!==E&&v++,T?(T=!1,h[E].push(M)):m=!0);T&&h[_].push(M)}}v>0&&m===!1&&(f=h)}for(let m=0,v=u.length;m<v;m++){o=u[m].s,l.push(o),p=f[m];for(let _=0,y=p.length;_<y;_++)o.holes.push(p[_].h)}return l}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:pd}})),typeof window<"u"&&(window.__THREE__||(window.__THREE__=pd));const ny=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:ip,AddEquation:ur,AddOperation:fx,AdditiveAnimationBlendMode:e0,AdditiveBlending:js,AgXToneMapping:rp,AlphaFormat:1021,AlwaysCompare:519,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:yd,AnimationAction:tb,AnimationClip:Ln,AnimationLoader:class extends Ht{constructor(i){super(i)}load(i,e,t,r){const s=this,a=new Ti(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(i,function(n){try{e(s.parse(JSON.parse(n)))}catch(o){r&&r(o),s.manager.itemError(i)}},t,r)}parse(i){const e=[];for(let t=0;t<i.length;t++){const r=Ln.parse(i[t]);e.push(r)}return e}},AnimationMixer:ib,AnimationObjectGroup:class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=vr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const i={};this._indicesByUUID=i;for(let t=0,r=arguments.length;t!==r;++t)i[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const i=this._objects,e=this._indicesByUUID,t=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length;let n=i.length,o=this.nCachedObjects_;for(let l=0,c=arguments.length;l!==c;++l){const h=arguments[l],u=h.uuid;let d=e[u];if(d===void 0){d=n++,e[u]=d,i.push(h);for(let p=0,f=a;p!==f;++p)s[p].push(new Je(h,t[p],r[p]))}else if(d<o){i[d];const p=--o,f=i[p];e[f.uuid]=d,i[d]=f,e[u]=p,i[p]=h;for(let g=0,m=a;g!==m;++g){const v=s[g],_=v[p];let y=v[d];v[d]=_,y===void 0&&(y=new Je(h,t[g],r[g])),v[p]=y}}else i[d]}this.nCachedObjects_=o}remove(){const i=this._objects,e=this._indicesByUUID,t=this._bindings,r=t.length;let s=this.nCachedObjects_;for(let a=0,n=arguments.length;a!==n;++a){const o=arguments[a],l=o.uuid,c=e[l];if(c!==void 0&&c>=s){const h=s++,u=i[h];e[u.uuid]=c,i[c]=u,e[l]=h,i[h]=o;for(let d=0,p=r;d!==p;++d){const f=t[d],g=f[h],m=f[c];f[c]=g,f[h]=m}}}this.nCachedObjects_=s}uncache(){const i=this._objects,e=this._indicesByUUID,t=this._bindings,r=t.length;let s=this.nCachedObjects_,a=i.length;for(let n=0,o=arguments.length;n!==o;++n){const l=arguments[n].uuid,c=e[l];if(c!==void 0)if(delete e[l],c<s){const h=--s,u=i[h],d=--a,p=i[d];e[u.uuid]=c,i[c]=u,e[p.uuid]=h,i[h]=p,i.pop();for(let f=0,g=r;f!==g;++f){const m=t[f],v=m[h],_=m[d];m[c]=v,m[h]=_,m.pop()}}else{const h=--a,u=i[h];h>0&&(e[u.uuid]=c),i[c]=u,i.pop();for(let d=0,p=r;d!==p;++d){const f=t[d];f[c]=f[h],f.pop()}}}this.nCachedObjects_=s}subscribe_(i,e){const t=this._bindingsIndicesByPath;let r=t[i];const s=this._bindings;if(r!==void 0)return s[r];const a=this._paths,n=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);r=s.length,t[i]=r,a.push(i),n.push(e),s.push(h);for(let u=c,d=o.length;u!==d;++u){const p=o[u];h[u]=new Je(p,i,e)}return h}unsubscribe_(i){const e=this._bindingsIndicesByPath,t=e[i];if(t!==void 0){const r=this._paths,s=this._parsedPaths,a=this._bindings,n=a.length-1,o=a[n];e[i[n]]=t,a[t]=o,a.pop(),s[t]=s[n],s.pop(),r[t]=r[n],r.pop()}}},AnimationUtils:XT,ArcCurve:kx,ArrayCamera:Nx,ArrowHelper:class extends je{constructor(i=new R(0,0,1),e=new R(0,0,0),t=1,r=16776960,s=.2*t,a=.2*s){super(),this.type="ArrowHelper",Mu===void 0&&(Mu=new Oe,Mu.setAttribute("position",new Se([0,0,0,0,1,0],3)),Tm=new zt(0,.5,1,5,1),Tm.translate(0,-.5,0)),this.position.copy(e),this.line=new vi(Mu,new Yt({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ye(Tm,new ei({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(t,s,a)}setDirection(i){if(i.y>.99999)this.quaternion.set(0,0,0,1);else if(i.y<-.99999)this.quaternion.set(1,0,0,0);else{ay.set(i.z,0,-i.x).normalize();const e=Math.acos(i.y);this.quaternion.setFromAxisAngle(ay,e)}}setLength(i,e=.2*i,t=.2*e){this.line.scale.set(1,Math.max(1e-4,i-e),1),this.line.updateMatrix(),this.cone.scale.set(t,e,t),this.cone.position.y=i,this.cone.updateMatrix()}setColor(i){this.line.material.color.set(i),this.cone.material.color.set(i)}copy(i){return super.copy(i,!1),this.line.copy(i.line),this.cone.copy(i.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},AttachedBindMode:bf,Audio:Y_,AudioAnalyser:class{constructor(i,e=2048){this.analyser=i.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),i.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let i=0;const e=this.getFrequencyData();for(let t=0;t<e.length;t++)i+=e[t];return i/e.length}},AudioContext:Mm,AudioListener:class extends je{constructor(){super(),this.type="AudioListener",this.context=Mm.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new zc}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(i){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=i,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(i){return this.gain.gain.setTargetAtTime(i,this.context.currentTime,.01),this}updateMatrixWorld(i){super.updateMatrixWorld(i);const e=this.context.listener,t=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(sn,q_,$T),an.set(0,0,-1).applyQuaternion(q_),e.positionX){const r=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(sn.x,r),e.positionY.linearRampToValueAtTime(sn.y,r),e.positionZ.linearRampToValueAtTime(sn.z,r),e.forwardX.linearRampToValueAtTime(an.x,r),e.forwardY.linearRampToValueAtTime(an.y,r),e.forwardZ.linearRampToValueAtTime(an.z,r),e.upX.linearRampToValueAtTime(t.x,r),e.upY.linearRampToValueAtTime(t.y,r),e.upZ.linearRampToValueAtTime(t.z,r)}else e.setPosition(sn.x,sn.y,sn.z),e.setOrientation(an.x,an.y,an.z,t.x,t.y,t.z)}},AudioLoader:class extends Ht{constructor(i){super(i)}load(i,e,t,r){const s=this,a=new Ti(this.manager);function n(o){r&&r(o),s.manager.itemError(i)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(i,function(o){try{const l=o.slice(0);Mm.getContext().decodeAudioData(l,function(c){e(c)}).catch(n)}catch(l){n(l)}},t,r)}},AxesHelper:lb,BackSide:Di,BasicDepthPacking:3200,BasicShadowMap:0,BatchedMesh:w_,Bone:ol,BooleanKeyframeTrack:Mn,Box2:class{constructor(i=new ne(1/0,1/0),e=new ne(-1/0,-1/0)){this.isBox2=!0,this.min=i,this.max=e}set(i,e){return this.min.copy(i),this.max.copy(e),this}setFromPoints(i){this.makeEmpty();for(let e=0,t=i.length;e<t;e++)this.expandByPoint(i[e]);return this}setFromCenterAndSize(i,e){const t=J_.copy(e).multiplyScalar(.5);return this.min.copy(i).sub(t),this.max.copy(i).add(t),this}clone(){return new this.constructor().copy(this)}copy(i){return this.min.copy(i.min),this.max.copy(i.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(i){return this.isEmpty()?i.set(0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(i){return this.isEmpty()?i.set(0,0):i.subVectors(this.max,this.min)}expandByPoint(i){return this.min.min(i),this.max.max(i),this}expandByVector(i){return this.min.sub(i),this.max.add(i),this}expandByScalar(i){return this.min.addScalar(-i),this.max.addScalar(i),this}containsPoint(i){return!(i.x<this.min.x||i.x>this.max.x||i.y<this.min.y||i.y>this.max.y)}containsBox(i){return this.min.x<=i.min.x&&i.max.x<=this.max.x&&this.min.y<=i.min.y&&i.max.y<=this.max.y}getParameter(i,e){return e.set((i.x-this.min.x)/(this.max.x-this.min.x),(i.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(i){return!(i.max.x<this.min.x||i.min.x>this.max.x||i.max.y<this.min.y||i.min.y>this.max.y)}clampPoint(i,e){return e.copy(i).clamp(this.min,this.max)}distanceToPoint(i){return this.clampPoint(i,J_).distanceTo(i)}intersect(i){return this.min.max(i.min),this.max.min(i.max),this.isEmpty()&&this.makeEmpty(),this}union(i){return this.min.min(i.min),this.max.max(i.max),this}translate(i){return this.min.add(i),this.max.add(i),this}equals(i){return i.min.equals(this.min)&&i.max.equals(this.max)}},Box3:Et,Box3Helper:nb,BoxGeometry:Ot,BoxHelper:class extends or{constructor(i,e=16776960){const t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new Oe;s.setIndex(new tt(t,1)),s.setAttribute("position",new tt(r,3)),super(s,new Yt({color:e,toneMapped:!1})),this.object=i,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(i){if(this.object!==void 0&&bu.setFromObject(this.object),bu.isEmpty())return;const e=bu.min,t=bu.max,r=this.geometry.attributes.position,s=r.array;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=e.x,s[4]=t.y,s[5]=t.z,s[6]=e.x,s[7]=e.y,s[8]=t.z,s[9]=t.x,s[10]=e.y,s[11]=t.z,s[12]=t.x,s[13]=t.y,s[14]=e.z,s[15]=e.x,s[16]=t.y,s[17]=e.z,s[18]=e.x,s[19]=e.y,s[20]=e.z,s[21]=t.x,s[22]=e.y,s[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(i){return this.object=i,this.update(),this}copy(i,e){return super.copy(i,e),this.object=i.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BufferAttribute:tt,BufferGeometry:Oe,BufferGeometryLoader:V_,ByteType:1010,Cache:Vs,Camera:cp,CameraHelper:class extends or{constructor(i){const e=new Oe,t=new Yt({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],a={};function n(p,f){o(p),o(f)}function o(p){r.push(0,0,0),s.push(0,0,0),a[p]===void 0&&(a[p]=[]),a[p].push(r.length/3-1)}n("n1","n2"),n("n2","n4"),n("n4","n3"),n("n3","n1"),n("f1","f2"),n("f2","f4"),n("f4","f3"),n("f3","f1"),n("n1","f1"),n("n2","f2"),n("n3","f3"),n("n4","f4"),n("p","n1"),n("p","n2"),n("p","n3"),n("p","n4"),n("u1","u2"),n("u2","u3"),n("u3","u1"),n("c","t"),n("p","c"),n("cn1","cn2"),n("cn3","cn4"),n("cf1","cf2"),n("cf3","cf4"),e.setAttribute("position",new Se(r,3)),e.setAttribute("color",new Se(s,3)),super(e,t),this.type="CameraHelper",this.camera=i,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const l=new fe(16755200),c=new fe(16711680),h=new fe(43775),u=new fe(16777215),d=new fe(3355443);this.setColors(l,c,h,u,d)}setColors(i,e,t,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,i.r,i.g,i.b),a.setXYZ(1,i.r,i.g,i.b),a.setXYZ(2,i.r,i.g,i.b),a.setXYZ(3,i.r,i.g,i.b),a.setXYZ(4,i.r,i.g,i.b),a.setXYZ(5,i.r,i.g,i.b),a.setXYZ(6,i.r,i.g,i.b),a.setXYZ(7,i.r,i.g,i.b),a.setXYZ(8,i.r,i.g,i.b),a.setXYZ(9,i.r,i.g,i.b),a.setXYZ(10,i.r,i.g,i.b),a.setXYZ(11,i.r,i.g,i.b),a.setXYZ(12,i.r,i.g,i.b),a.setXYZ(13,i.r,i.g,i.b),a.setXYZ(14,i.r,i.g,i.b),a.setXYZ(15,i.r,i.g,i.b),a.setXYZ(16,i.r,i.g,i.b),a.setXYZ(17,i.r,i.g,i.b),a.setXYZ(18,i.r,i.g,i.b),a.setXYZ(19,i.r,i.g,i.b),a.setXYZ(20,i.r,i.g,i.b),a.setXYZ(21,i.r,i.g,i.b),a.setXYZ(22,i.r,i.g,i.b),a.setXYZ(23,i.r,i.g,i.b),a.setXYZ(24,e.r,e.g,e.b),a.setXYZ(25,e.r,e.g,e.b),a.setXYZ(26,e.r,e.g,e.b),a.setXYZ(27,e.r,e.g,e.b),a.setXYZ(28,e.r,e.g,e.b),a.setXYZ(29,e.r,e.g,e.b),a.setXYZ(30,e.r,e.g,e.b),a.setXYZ(31,e.r,e.g,e.b),a.setXYZ(32,t.r,t.g,t.b),a.setXYZ(33,t.r,t.g,t.b),a.setXYZ(34,t.r,t.g,t.b),a.setXYZ(35,t.r,t.g,t.b),a.setXYZ(36,t.r,t.g,t.b),a.setXYZ(37,t.r,t.g,t.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const i=this.geometry,e=this.pointMap;Bt.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Wt("c",e,i,Bt,0,0,-1),Wt("t",e,i,Bt,0,0,1),Wt("n1",e,i,Bt,-1,-1,-1),Wt("n2",e,i,Bt,1,-1,-1),Wt("n3",e,i,Bt,-1,1,-1),Wt("n4",e,i,Bt,1,1,-1),Wt("f1",e,i,Bt,-1,-1,1),Wt("f2",e,i,Bt,1,-1,1),Wt("f3",e,i,Bt,-1,1,1),Wt("f4",e,i,Bt,1,1,1),Wt("u1",e,i,Bt,.7,1.1,-1),Wt("u2",e,i,Bt,-.7,1.1,-1),Wt("u3",e,i,Bt,0,2,-1),Wt("cf1",e,i,Bt,-1,0,1),Wt("cf2",e,i,Bt,1,0,1),Wt("cf3",e,i,Bt,0,-1,1),Wt("cf4",e,i,Bt,0,1,1),Wt("cn1",e,i,Bt,-1,0,-1),Wt("cn2",e,i,Bt,1,0,-1),Wt("cn3",e,i,Bt,0,-1,-1),Wt("cn4",e,i,Bt,0,1,-1),i.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},CanvasTexture:class extends wt{constructor(i,e,t,r,s,a,n,o,l){super(i,e,t,r,s,a,n,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},CapsuleGeometry:fh,CatmullRomCurve3:pp,CineonToneMapping:tp,CircleGeometry:gh,ClampToEdgeWrapping:Ai,Clock:zc,Color:fe,ColorKeyframeTrack:_0,ColorManagement:ht,CompressedArrayTexture:class extends cu{constructor(i,e,t,r,s,a){super(i,e,t,s,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Ai,this.layerUpdates=new Set}addLayerUpdates(i){this.layerUpdates.add(i)}clearLayerUpdates(){this.layerUpdates.clear()}},CompressedCubeTexture:class extends cu{constructor(i,e,t){super(void 0,i[0].width,i[0].height,e,t,Ws),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=i}},CompressedTexture:cu,CompressedTextureLoader:class extends Ht{constructor(i){super(i)}load(i,e,t,r){const s=this,a=[],n=new cu,o=new Ti(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(s.withCredentials);let l=0;function c(h){o.load(i[h],function(u){const d=s.parse(u,!0);a[h]={width:d.width,height:d.height,format:d.format,mipmaps:d.mipmaps},l+=1,l===6&&(d.mipmapCount===1&&(n.minFilter=Kt),n.image=a,n.format=d.format,n.needsUpdate=!0,e&&e(n))},t,r)}if(Array.isArray(i))for(let h=0,u=i.length;h<u;++h)c(h);else o.load(i,function(h){const u=s.parse(h,!0);if(u.isCubemap){const d=u.mipmaps.length/u.mipmapCount;for(let p=0;p<d;p++){a[p]={mipmaps:[]};for(let f=0;f<u.mipmapCount;f++)a[p].mipmaps.push(u.mipmaps[p*u.mipmapCount+f]),a[p].format=u.format,a[p].width=u.width,a[p].height=u.height}n.image=a}else n.image.width=u.width,n.image.height=u.height,n.mipmaps=u.mipmaps;u.mipmapCount===1&&(n.minFilter=Kt),n.format=u.format,n.needsUpdate=!0,e&&e(n)},t,r);return n}},ConeGeometry:vh,ConstantAlphaFactor:213,ConstantColorFactor:211,CubeCamera:Sx,CubeReflectionMapping:Ws,CubeRefractionMapping:La,CubeTexture:Dc,CubeTextureLoader:og,CubeUVReflectionMapping:xl,CubicBezierCurve:l0,CubicBezierCurve3:Fx,CubicInterpolant:Zx,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:Nr,CurvePath:zx,CustomBlending:Ko,CustomToneMapping:Gg,CylinderGeometry:zt,Cylindrical:class{constructor(i=1,e=0,t=0){return this.radius=i,this.theta=e,this.y=t,this}set(i,e,t){return this.radius=i,this.theta=e,this.y=t,this}copy(i){return this.radius=i.radius,this.theta=i.theta,this.y=i.y,this}setFromVector3(i){return this.setFromCartesianCoords(i.x,i.y,i.z)}setFromCartesianCoords(i,e,t){return this.radius=Math.sqrt(i*i+t*t),this.theta=Math.atan2(i,t),this.y=e,this}clone(){return new this.constructor().copy(this)}},Data3DTexture:Kf,DataArrayTexture:md,DataTexture:Bs,DataTextureLoader:class extends Ht{constructor(i){super(i)}load(i,e,t,r){const s=this,a=new Bs,n=new Ti(this.manager);return n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setPath(this.path),n.setWithCredentials(s.withCredentials),n.load(i,function(o){let l;try{l=s.parse(o)}catch(c){if(r===void 0)return;r(c)}l.image!==void 0?a.image=l.image:l.data!==void 0&&(a.image.width=l.width,a.image.height=l.height,a.image.data=l.data),a.wrapS=l.wrapS!==void 0?l.wrapS:Ai,a.wrapT=l.wrapT!==void 0?l.wrapT:Ai,a.magFilter=l.magFilter!==void 0?l.magFilter:Kt,a.minFilter=l.minFilter!==void 0?l.minFilter:Kt,a.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.colorSpace!==void 0&&(a.colorSpace=l.colorSpace),l.flipY!==void 0&&(a.flipY=l.flipY),l.format!==void 0&&(a.format=l.format),l.type!==void 0&&(a.type=l.type),l.mipmaps!==void 0&&(a.mipmaps=l.mipmaps,a.minFilter=fs),l.mipmapCount===1&&(a.minFilter=Kt),l.generateMipmaps!==void 0&&(a.generateMipmaps=l.generateMipmaps),a.needsUpdate=!0,e&&e(a,l)},t,r),a}},DataUtils:VS,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:y0,DepthFormat:el,DepthStencilFormat:Oa,DepthTexture:dh,DetachedBindMode:gx,DirectionalLight:Bc,DirectionalLightHelper:class extends je{constructor(i,e,t){super(),this.light=i,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="DirectionalLightHelper",e===void 0&&(e=1);let r=new Oe;r.setAttribute("position",new Se([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const s=new Yt({fog:!1,toneMapped:!1});this.lightPlane=new vi(r,s),this.add(this.lightPlane),r=new Oe,r.setAttribute("position",new Se([0,0,0,0,0,1],3)),this.targetLine=new vi(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),ry.setFromMatrixPosition(this.light.matrixWorld),yu.setFromMatrixPosition(this.light.target.matrixWorld),sy.subVectors(yu,ry),this.lightPlane.lookAt(yu),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(yu),this.targetLine.scale.z=sy.length()}},DiscreteInterpolant:Kx,DisplayP3ColorSpace:np,DodecahedronGeometry:mp,DoubleSide:It,DstAlphaFactor:oh,DstColorFactor:lh,DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EdgesGeometry:Vx,EllipseCurve:dp,EqualCompare:514,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:Jo,EquirectangularRefractionMapping:Ac,Euler:Rt,EventDispatcher:ys,ExtrudeGeometry:Kn,FileLoader:Ti,Float16BufferAttribute:class extends tt{constructor(i,e,t){super(new Uint16Array(i),e,t),this.isFloat16BufferAttribute=!0}getX(i){let e=ic(this.array[i*this.itemSize]);return this.normalized&&(e=Gi(e,this.array)),e}setX(i,e){return this.normalized&&(e=Ge(e,this.array)),this.array[i*this.itemSize]=Yi(e),this}getY(i){let e=ic(this.array[i*this.itemSize+1]);return this.normalized&&(e=Gi(e,this.array)),e}setY(i,e){return this.normalized&&(e=Ge(e,this.array)),this.array[i*this.itemSize+1]=Yi(e),this}getZ(i){let e=ic(this.array[i*this.itemSize+2]);return this.normalized&&(e=Gi(e,this.array)),e}setZ(i,e){return this.normalized&&(e=Ge(e,this.array)),this.array[i*this.itemSize+2]=Yi(e),this}getW(i){let e=ic(this.array[i*this.itemSize+3]);return this.normalized&&(e=Gi(e,this.array)),e}setW(i,e){return this.normalized&&(e=Ge(e,this.array)),this.array[i*this.itemSize+3]=Yi(e),this}setXY(i,e,t){return i*=this.itemSize,this.normalized&&(e=Ge(e,this.array),t=Ge(t,this.array)),this.array[i+0]=Yi(e),this.array[i+1]=Yi(t),this}setXYZ(i,e,t,r){return i*=this.itemSize,this.normalized&&(e=Ge(e,this.array),t=Ge(t,this.array),r=Ge(r,this.array)),this.array[i+0]=Yi(e),this.array[i+1]=Yi(t),this.array[i+2]=Yi(r),this}setXYZW(i,e,t,r,s){return i*=this.itemSize,this.normalized&&(e=Ge(e,this.array),t=Ge(t,this.array),r=Ge(r,this.array),s=Ge(s,this.array)),this.array[i+0]=Yi(e),this.array[i+1]=Yi(t),this.array[i+2]=Yi(r),this.array[i+3]=Yi(s),this}},Float32BufferAttribute:Se,FloatType:mr,Fog:nl,FogExp2:al,FramebufferTexture:class extends wt{constructor(i,e){super({width:i,height:e}),this.isFramebufferTexture=!0,this.magFilter=dt,this.minFilter=dt,this.generateMipmaps=!1,this.needsUpdate=!0}},FrontSide:Ir,Frustum:uh,GLBufferAttribute:class{constructor(i,e,t,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=i,this.type=e,this.itemSize=t,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(i){i===!0&&this.version++}setBuffer(i){return this.buffer=i,this}setType(i,e){return this.type=i,this.elementSize=e,this}setItemSize(i){return this.itemSize=i,this}setCount(i){return this.count=i,this}},GLSL1:"100",GLSL3:Yf,GreaterCompare:516,GreaterDepth:6,GreaterEqualCompare:518,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:ab,Group:Ei,HalfFloatType:Qt,HemisphereLight:lg,HemisphereLightHelper:class extends je{constructor(i,e,t){super(),this.light=i,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="HemisphereLightHelper";const r=new zs(e);r.rotateY(.5*Math.PI),this.material=new ei({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),a=new Float32Array(3*s.count);r.setAttribute("color",new tt(a,3)),this.add(new ye(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const i=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=i.geometry.getAttribute("color");ty.copy(this.light.color),iy.copy(this.light.groundColor);for(let t=0,r=e.count;t<r;t++){const s=t<r/2?ty:iy;e.setXYZ(t,s.r,s.g,s.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),i.lookAt(oA.setFromMatrixPosition(this.light.matrixWorld).negate())}},IcosahedronGeometry:gp,ImageBitmapLoader:$x,ImageLoader:fc,ImageUtils:xx,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:In,InstancedBufferGeometry:b0,InstancedInterleavedBuffer:bd,InstancedMesh:eg,Int16BufferAttribute:class extends tt{constructor(i,e,t){super(new Int16Array(i),e,t)}},Int32BufferAttribute:class extends tt{constructor(i,e,t){super(new Int32Array(i),e,t)}},Int8BufferAttribute:class extends tt{constructor(i,e,t){super(new Int8Array(i),e,t)}},IntType:Wg,InterleavedBuffer:ph,InterleavedBufferAttribute:Ji,Interpolant:Ml,InterpolateDiscrete:tl,InterpolateLinear:il,InterpolateSmooth:td,InvertStencilOp:5386,KeepStencilOp:gn,KeyframeTrack:Yr,LOD:d_,LatheGeometry:mh,Layers:op,LessCompare:513,LessDepth:2,LessEqualCompare:515,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:Qs,LightProbe:z_,Line:vi,Line3:rb,LineBasicMaterial:Yt,LineCurve:c0,LineCurve3:Bx,LineDashedMaterial:Xx,LineLoop:tg,LineSegments:or,LinearDisplayP3ColorSpace:hh,LinearFilter:Kt,LinearInterpolant:v0,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:fs,LinearMipmapNearestFilter:Bo,LinearSRGBColorSpace:oi,LinearToneMapping:$d,LinearTransfer:Cc,Loader:Ht,LoaderUtils:gs,LoadingManager:ng,LoopOnce:Jg,LoopPingPong:2202,LoopRepeat:$g,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:mn,Material:ti,MaterialLoader:xd,MathUtils:ui,Matrix3:Ve,Matrix4:Me,MaxEquation:104,Mesh:ye,MeshBasicMaterial:ei,MeshDepthMaterial:up,MeshDistanceMaterial:a0,MeshLambertMaterial:bp,MeshMatcapMaterial:Wx,MeshNormalMaterial:xp,MeshPhongMaterial:Xn,MeshPhysicalMaterial:yr,MeshStandardMaterial:hl,MeshToonMaterial:f0,MinEquation:103,MirroredRepeatWrapping:Na,MixOperation:mx,MultiplyBlending:4,MultiplyOperation:ch,NearestFilter:dt,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:Tn,NearestMipmapNearestFilter:ap,NeutralToneMapping:jg,NeverCompare:512,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColorSpace:xn,NoToneMapping:ms,NormalAnimationBlendMode:vx,NormalBlending:1,NotEqualCompare:517,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:Ua,Object3D:je,ObjectLoader:class extends Ht{constructor(i){super(i)}load(i,e,t,r){const s=this,a=this.path===""?gs.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||a;const n=new Ti(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(i,function(o){let l=null;try{l=JSON.parse(o)}catch(h){return void(r!==void 0&&r(h))}const c=l.metadata;c!==void 0&&c.type!==void 0&&c.type.toLowerCase()!=="geometry"?s.parse(l,e):r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+i))},t,r)}loadAsync(i,e){return Wr(this,null,function*(){const t=this.path===""?gs.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||t;const r=new Ti(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const s=yield r.loadAsync(i,e),a=JSON.parse(s),n=a.metadata;if(n===void 0||n.type===void 0||n.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+i);return yield this.parseAsync(a)})}parse(i,e){const t=this.parseAnimations(i.animations),r=this.parseShapes(i.shapes),s=this.parseGeometries(i.geometries,r),a=this.parseImages(i.images,function(){e!==void 0&&e(l)}),n=this.parseTextures(i.textures,a),o=this.parseMaterials(i.materials,n),l=this.parseObject(i.object,s,o,n,t),c=this.parseSkeletons(i.skeletons,l);if(this.bindSkeletons(l,c),e!==void 0){let h=!1;for(const u in a)if(a[u].data instanceof HTMLImageElement){h=!0;break}h===!1&&e(l)}return l}parseAsync(i){return Wr(this,null,function*(){const e=this.parseAnimations(i.animations),t=this.parseShapes(i.shapes),r=this.parseGeometries(i.geometries,t),s=yield this.parseImagesAsync(i.images),a=this.parseTextures(i.textures,s),n=this.parseMaterials(i.materials,a),o=this.parseObject(i.object,r,n,a,e),l=this.parseSkeletons(i.skeletons,o);return this.bindSkeletons(o,l),o})}parseShapes(i){const e={};if(i!==void 0)for(let t=0,r=i.length;t<r;t++){const s=new Ea().fromJSON(i[t]);e[s.uuid]=s}return e}parseSkeletons(i,e){const t={},r={};if(e.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),i!==void 0)for(let s=0,a=i.length;s<a;s++){const n=new ll().fromJSON(i[s],r);t[n.uuid]=n}return t}parseGeometries(i,e){const t={};if(i!==void 0){const r=new V_;for(let s=0,a=i.length;s<a;s++){let n;const o=i[s];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":n=r.parse(o);break;default:o.type in U_&&(n=U_[o.type].fromJSON(o,e))}n.uuid=o.uuid,o.name!==void 0&&(n.name=o.name),o.userData!==void 0&&(n.userData=o.userData),t[o.uuid]=n}}return t}parseMaterials(i,e){const t={},r={};if(i!==void 0){const s=new xd;s.setTextures(e);for(let a=0,n=i.length;a<n;a++){const o=i[a];t[o.uuid]===void 0&&(t[o.uuid]=s.parse(o)),r[o.uuid]=t[o.uuid]}}return r}parseAnimations(i){const e={};if(i!==void 0)for(let t=0;t<i.length;t++){const r=i[t],s=Ln.parse(r);e[s.uuid]=s}return e}parseImages(i,e){const t=this,r={};let s;function a(n){if(typeof n=="string"){const o=n;return function(l){return t.manager.itemStart(l),s.load(l,function(){t.manager.itemEnd(l)},void 0,function(){t.manager.itemError(l),t.manager.itemEnd(l)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o)}return n.data?{data:Co(n.type,n.data),width:n.width,height:n.height}:null}if(i!==void 0&&i.length>0){const n=new ng(e);s=new fc(n),s.setCrossOrigin(this.crossOrigin);for(let o=0,l=i.length;o<l;o++){const c=i[o],h=c.url;if(Array.isArray(h)){const u=[];for(let d=0,p=h.length;d<p;d++){const f=a(h[d]);f!==null&&(f instanceof HTMLImageElement?u.push(f):u.push(new Bs(f.data,f.width,f.height)))}r[c.uuid]=new bn(u)}else{const u=a(c.url);r[c.uuid]=new bn(u)}}}return r}parseImagesAsync(i){return Wr(this,null,function*(){const e=this,t={};let r;function s(a){return Wr(this,null,function*(){if(typeof a=="string"){const n=a,o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return yield r.loadAsync(o)}return a.data?{data:Co(a.type,a.data),width:a.width,height:a.height}:null})}if(i!==void 0&&i.length>0){r=new fc(this.manager),r.setCrossOrigin(this.crossOrigin);for(let a=0,n=i.length;a<n;a++){const o=i[a],l=o.url;if(Array.isArray(l)){const c=[];for(let h=0,u=l.length;h<u;h++){const d=l[h],p=yield s(d);p!==null&&(p instanceof HTMLImageElement?c.push(p):c.push(new Bs(p.data,p.width,p.height)))}t[o.uuid]=new bn(c)}else{const c=yield s(o.url);t[o.uuid]=new bn(c)}}}return t})}parseTextures(i,e){function t(s,a){return typeof s=="number"?s:a[s]}const r={};if(i!==void 0)for(let s=0,a=i.length;s<a;s++){const n=i[s];n.image,e[n.image];const o=e[n.image],l=o.data;let c;Array.isArray(l)?(c=new Dc,l.length===6&&(c.needsUpdate=!0)):(c=l&&l.data?new Bs:new wt,l&&(c.needsUpdate=!0)),c.source=o,c.uuid=n.uuid,n.name!==void 0&&(c.name=n.name),n.mapping!==void 0&&(c.mapping=t(n.mapping,JT)),n.channel!==void 0&&(c.channel=n.channel),n.offset!==void 0&&c.offset.fromArray(n.offset),n.repeat!==void 0&&c.repeat.fromArray(n.repeat),n.center!==void 0&&c.center.fromArray(n.center),n.rotation!==void 0&&(c.rotation=n.rotation),n.wrap!==void 0&&(c.wrapS=t(n.wrap[0],H_),c.wrapT=t(n.wrap[1],H_)),n.format!==void 0&&(c.format=n.format),n.internalFormat!==void 0&&(c.internalFormat=n.internalFormat),n.type!==void 0&&(c.type=n.type),n.colorSpace!==void 0&&(c.colorSpace=n.colorSpace),n.minFilter!==void 0&&(c.minFilter=t(n.minFilter,G_)),n.magFilter!==void 0&&(c.magFilter=t(n.magFilter,G_)),n.anisotropy!==void 0&&(c.anisotropy=n.anisotropy),n.flipY!==void 0&&(c.flipY=n.flipY),n.generateMipmaps!==void 0&&(c.generateMipmaps=n.generateMipmaps),n.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=n.premultiplyAlpha),n.unpackAlignment!==void 0&&(c.unpackAlignment=n.unpackAlignment),n.compareFunction!==void 0&&(c.compareFunction=n.compareFunction),n.userData!==void 0&&(c.userData=n.userData),r[n.uuid]=c}return r}parseObject(i,e,t,r,s){let a,n,o;function l(u){return e[u],e[u]}function c(u){if(u!==void 0){if(Array.isArray(u)){const d=[];for(let p=0,f=u.length;p<f;p++){const g=u[p];t[g],d.push(t[g])}return d}return t[u],t[u]}}function h(u){return r[u],r[u]}switch(i.type){case"Scene":a=new $f,i.background!==void 0&&(Number.isInteger(i.background)?a.background=new fe(i.background):a.background=h(i.background)),i.environment!==void 0&&(a.environment=h(i.environment)),i.fog!==void 0&&(i.fog.type==="Fog"?a.fog=new nl(i.fog.color,i.fog.near,i.fog.far):i.fog.type==="FogExp2"&&(a.fog=new al(i.fog.color,i.fog.density)),i.fog.name!==""&&(a.fog.name=i.fog.name)),i.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=i.backgroundBlurriness),i.backgroundIntensity!==void 0&&(a.backgroundIntensity=i.backgroundIntensity),i.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(i.backgroundRotation),i.environmentIntensity!==void 0&&(a.environmentIntensity=i.environmentIntensity),i.environmentRotation!==void 0&&a.environmentRotation.fromArray(i.environmentRotation);break;case"PerspectiveCamera":a=new Jt(i.fov,i.aspect,i.near,i.far),i.focus!==void 0&&(a.focus=i.focus),i.zoom!==void 0&&(a.zoom=i.zoom),i.filmGauge!==void 0&&(a.filmGauge=i.filmGauge),i.filmOffset!==void 0&&(a.filmOffset=i.filmOffset),i.view!==void 0&&(a.view=Object.assign({},i.view));break;case"OrthographicCamera":a=new Gn(i.left,i.right,i.top,i.bottom,i.near,i.far),i.zoom!==void 0&&(a.zoom=i.zoom),i.view!==void 0&&(a.view=Object.assign({},i.view));break;case"AmbientLight":a=new yd(i.color,i.intensity);break;case"DirectionalLight":a=new Bc(i.color,i.intensity);break;case"PointLight":a=new ul(i.color,i.intensity,i.distance,i.decay);break;case"RectAreaLight":a=new cg(i.color,i.intensity,i.width,i.height);break;case"SpotLight":a=new Fc(i.color,i.intensity,i.distance,i.angle,i.penumbra,i.decay);break;case"HemisphereLight":a=new lg(i.color,i.groundColor,i.intensity);break;case"LightProbe":a=new z_().fromJSON(i);break;case"SkinnedMesh":n=l(i.geometry),o=c(i.material),a=new fd(n,o),i.bindMode!==void 0&&(a.bindMode=i.bindMode),i.bindMatrix!==void 0&&a.bindMatrix.fromArray(i.bindMatrix),i.skeleton!==void 0&&(a.skeleton=i.skeleton);break;case"Mesh":n=l(i.geometry),o=c(i.material),a=new ye(n,o);break;case"InstancedMesh":n=l(i.geometry),o=c(i.material);const u=i.count,d=i.instanceMatrix,p=i.instanceColor;a=new eg(n,o,u),a.instanceMatrix=new In(new Float32Array(d.array),16),p!==void 0&&(a.instanceColor=new In(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":n=l(i.geometry),o=c(i.material),a=new w_(i.maxGeometryCount,i.maxVertexCount,i.maxIndexCount,o),a.geometry=n,a.perObjectFrustumCulled=i.perObjectFrustumCulled,a.sortObjects=i.sortObjects,a._drawRanges=i.drawRanges,a._reservedRanges=i.reservedRanges,a._visibility=i.visibility,a._active=i.active,a._bounds=i.bounds.map(f=>{const g=new Et;g.min.fromArray(f.boxMin),g.max.fromArray(f.boxMax);const m=new di;return m.radius=f.sphereRadius,m.center.fromArray(f.sphereCenter),{boxInitialized:f.boxInitialized,box:g,sphereInitialized:f.sphereInitialized,sphere:m}}),a._maxGeometryCount=i.maxGeometryCount,a._maxVertexCount=i.maxVertexCount,a._maxIndexCount=i.maxIndexCount,a._geometryInitialized=i.geometryInitialized,a._geometryCount=i.geometryCount,a._matricesTexture=h(i.matricesTexture.uuid),i.colorsTexture!==void 0&&(a._colorsTexture=h(i.colorsTexture.uuid));break;case"LOD":a=new d_;break;case"Line":a=new vi(l(i.geometry),c(i.material));break;case"LineLoop":a=new tg(l(i.geometry),c(i.material));break;case"LineSegments":a=new or(l(i.geometry),c(i.material));break;case"PointCloud":case"Points":a=new Aa(l(i.geometry),c(i.material));break;case"Sprite":a=new h_(c(i.material));break;case"Group":a=new Ei;break;case"Bone":a=new ol;break;default:a=new je}if(a.uuid=i.uuid,i.name!==void 0&&(a.name=i.name),i.matrix!==void 0?(a.matrix.fromArray(i.matrix),i.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=i.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(i.position!==void 0&&a.position.fromArray(i.position),i.rotation!==void 0&&a.rotation.fromArray(i.rotation),i.quaternion!==void 0&&a.quaternion.fromArray(i.quaternion),i.scale!==void 0&&a.scale.fromArray(i.scale)),i.up!==void 0&&a.up.fromArray(i.up),i.castShadow!==void 0&&(a.castShadow=i.castShadow),i.receiveShadow!==void 0&&(a.receiveShadow=i.receiveShadow),i.shadow&&(i.shadow.bias!==void 0&&(a.shadow.bias=i.shadow.bias),i.shadow.normalBias!==void 0&&(a.shadow.normalBias=i.shadow.normalBias),i.shadow.radius!==void 0&&(a.shadow.radius=i.shadow.radius),i.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(i.shadow.mapSize),i.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(i.shadow.camera))),i.visible!==void 0&&(a.visible=i.visible),i.frustumCulled!==void 0&&(a.frustumCulled=i.frustumCulled),i.renderOrder!==void 0&&(a.renderOrder=i.renderOrder),i.userData!==void 0&&(a.userData=i.userData),i.layers!==void 0&&(a.layers.mask=i.layers),i.children!==void 0){const u=i.children;for(let d=0;d<u.length;d++)a.add(this.parseObject(u[d],e,t,r,s))}if(i.animations!==void 0){const u=i.animations;for(let d=0;d<u.length;d++){const p=u[d];a.animations.push(s[p])}}if(i.type==="LOD"){i.autoUpdate!==void 0&&(a.autoUpdate=i.autoUpdate);const u=i.levels;for(let d=0;d<u.length;d++){const p=u[d],f=a.getObjectByProperty("uuid",p.object);f!==void 0&&a.addLevel(f,p.distance,p.hysteresis)}}return a}bindSkeletons(i,e){Object.keys(e).length!==0&&i.traverse(function(t){if(t.isSkinnedMesh===!0&&t.skeleton!==void 0){const r=e[t.skeleton];r===void 0||t.bind(r,t.bindMatrix)}})}},ObjectSpaceNormalMap:1,OctahedronGeometry:zs,OneFactor:nh,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:Qd,OneMinusDstColorFactor:Jd,OneMinusSrcAlphaFactor:Ia,OneMinusSrcColorFactor:Kd,OrthographicCamera:Gn,P3Primaries:Pc,PCFShadowMap:Yd,PCFSoftShadowMap:Hg,PMREMGenerator:Qf,Path:cl,PerspectiveCamera:Jt,Plane:jr,PlaneGeometry:ws,PlaneHelper:ob,PointLight:ul,PointLightHelper:class extends ye{constructor(i,e,t){super(new Wn(e,4,2),new ei({wireframe:!0,fog:!1,toneMapped:!1})),this.light=i,this.color=t,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:Aa,PointsMaterial:ga,PolarGridHelper:class extends or{constructor(i=10,e=16,t=8,r=64,s=4473924,a=8947848){s=new fe(s),a=new fe(a);const n=[],o=[];if(e>1)for(let c=0;c<e;c++){const h=c/e*(2*Math.PI),u=Math.sin(h)*i,d=Math.cos(h)*i;n.push(0,0,0),n.push(u,0,d);const p=1&c?s:a;o.push(p.r,p.g,p.b),o.push(p.r,p.g,p.b)}for(let c=0;c<t;c++){const h=1&c?s:a,u=i-i/t*c;for(let d=0;d<r;d++){let p=d/r*(2*Math.PI),f=Math.sin(p)*u,g=Math.cos(p)*u;n.push(f,0,g),o.push(h.r,h.g,h.b),p=(d+1)/r*(2*Math.PI),f=Math.sin(p)*u,g=Math.cos(p)*u,n.push(f,0,g),o.push(h.r,h.g,h.b)}}const l=new Oe;l.setAttribute("position",new Se(n,3)),l.setAttribute("color",new Se(o,3)),super(l,new Yt({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},PolyhedronGeometry:Ha,PositionalAudio:class extends Y_{constructor(i){super(i),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(i){return this.panner.refDistance=i,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(i){return this.panner.rolloffFactor=i,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(i){return this.panner.distanceModel=i,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(i){return this.panner.maxDistance=i,this}setDirectionalCone(i,e,t){return this.panner.coneInnerAngle=i,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=t,this}updateMatrixWorld(i){if(super.updateMatrixWorld(i),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(nn,Z_,eA),on.set(0,0,1).applyQuaternion(Z_);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(nn.x,t),e.positionY.linearRampToValueAtTime(nn.y,t),e.positionZ.linearRampToValueAtTime(nn.z,t),e.orientationX.linearRampToValueAtTime(on.x,t),e.orientationY.linearRampToValueAtTime(on.y,t),e.orientationZ.linearRampToValueAtTime(on.z,t)}else e.setPosition(nn.x,nn.y,nn.z),e.setOrientation(on.x,on.y,on.z)}},PropertyBinding:Je,PropertyMixer:eb,QuadraticBezierCurve:h0,QuadraticBezierCurve3:u0,Quaternion:it,QuaternionKeyframeTrack:qs,QuaternionLinearInterpolant:Qx,RED_GREEN_RGTC2_Format:Xf,RED_RGTC1_Format:36283,REVISION:pd,RGBADepthPacking:t0,RGBAFormat:Pr,RGBAIntegerFormat:Qg,RGBA_ASTC_10x10_Format:zf,RGBA_ASTC_10x5_Format:kf,RGBA_ASTC_10x6_Format:Ff,RGBA_ASTC_10x8_Format:Bf,RGBA_ASTC_12x10_Format:Vf,RGBA_ASTC_12x12_Format:Hf,RGBA_ASTC_4x4_Format:Rf,RGBA_ASTC_5x4_Format:Pf,RGBA_ASTC_5x5_Format:If,RGBA_ASTC_6x5_Format:Lf,RGBA_ASTC_6x6_Format:Nf,RGBA_ASTC_8x5_Format:Df,RGBA_ASTC_8x6_Format:Of,RGBA_ASTC_8x8_Format:Uf,RGBA_BPTC_Format:ed,RGBA_ETC2_EAC_Format:Cf,RGBA_PVRTC_2BPPV1_Format:Tf,RGBA_PVRTC_4BPPV1_Format:Sf,RGBA_S3TC_DXT1_Format:Qu,RGBA_S3TC_DXT3_Format:Ju,RGBA_S3TC_DXT5_Format:$u,RGBFormat:1022,RGB_BPTC_SIGNED_Format:Gf,RGB_BPTC_UNSIGNED_Format:jf,RGB_ETC1_Format:Af,RGB_ETC2_Format:Ef,RGB_PVRTC_2BPPV1_Format:wf,RGB_PVRTC_4BPPV1_Format:Mf,RGB_S3TC_DXT1_Format:Ku,RGFormat:1030,RGIntegerFormat:Kg,RawShaderMaterial:m0,Ray:Zn,Raycaster:Mp,Rec709Primaries:Rc,RectAreaLight:cg,RedFormat:Yg,RedIntegerFormat:Zg,ReinhardToneMapping:ep,RenderTarget:bx,RepeatWrapping:$t,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingGeometry:_h,SIGNED_RED_GREEN_RGTC2_Format:qf,SIGNED_RED_RGTC1_Format:Wf,SRGBColorSpace:Tt,SRGBTransfer:St,Scene:$f,ShaderChunk:We,ShaderLib:Vi,ShaderMaterial:ct,ShadowMaterial:jx,Shape:Ea,ShapeGeometry:vp,ShapePath:cb,ShapeUtils:qr,ShortType:1011,Skeleton:ll,SkeletonHelper:class extends or{constructor(i){const e=sb(i),t=new Oe,r=[],s=[],a=new fe(0,0,1),n=new fe(0,1,0);for(let o=0;o<e.length;o++){const l=e[o];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(a.r,a.g,a.b),s.push(n.r,n.g,n.b))}t.setAttribute("position",new Se(r,3)),t.setAttribute("color",new Se(s,3)),super(t,new Yt({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=i,this.bones=e,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(i){const e=this.bones,t=this.geometry,r=t.getAttribute("position");Sm.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<e.length;s++){const n=e[s];n.parent&&n.parent.isBone&&(_u.multiplyMatrices(Sm,n.matrixWorld),ca.setFromMatrixPosition(_u),r.setXYZ(a,ca.x,ca.y,ca.z),_u.multiplyMatrices(Sm,n.parent.matrixWorld),ca.setFromMatrixPosition(_u),r.setXYZ(a+1,ca.x,ca.y,ca.z),a+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(i)}dispose(){this.geometry.dispose(),this.material.dispose()}},SkinnedMesh:fd,Source:bn,Sphere:di,SphereGeometry:Wn,Spherical:ug,SphericalHarmonics3:Jx,SplineCurve:d0,SpotLight:Fc,SpotLightHelper:class extends je{constructor(i,e){super(),this.light=i,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const t=new Oe,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,n=1,o=32;a<o;a++,n++){const l=a/o*Math.PI*2,c=n/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}t.setAttribute("position",new Se(r,3));const s=new Yt({fog:!1,toneMapped:!1});this.cone=new or(t,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const i=this.light.distance?this.light.distance:1e3,e=i*Math.tan(this.light.angle);this.cone.scale.set(e,e,i),ey.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ey),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:h_,SpriteMaterial:n0,SrcAlphaFactor:Pa,SrcAlphaSaturateFactor:210,SrcColorFactor:Zd,StaticCopyUsage:35046,StaticDrawUsage:Ic,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Jt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Jt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(i){const e=this._cache;if(e.focus!==i.focus||e.fov!==i.fov||e.aspect!==i.aspect*this.aspect||e.near!==i.near||e.far!==i.far||e.zoom!==i.zoom||e.eyeSep!==this.eyeSep){e.focus=i.focus,e.fov=i.fov,e.aspect=i.aspect*this.aspect,e.near=i.near,e.far=i.far,e.zoom=i.zoom,e.eyeSep=this.eyeSep,rn.copy(i.projectionMatrix);const t=e.eyeSep/2,r=t*e.near/e.focus,s=e.near*Math.tan(Pn*e.fov*.5)/e.zoom;let a,n;W_.elements[12]=-t,j_.elements[12]=t,a=-s*e.aspect+r,n=s*e.aspect+r,rn.elements[0]=2*e.near/(n-a),rn.elements[8]=(n+a)/(n-a),this.cameraL.projectionMatrix.copy(rn),a=-s*e.aspect-r,n=s*e.aspect-r,rn.elements[0]=2*e.near/(n-a),rn.elements[8]=(n+a)/(n-a),this.cameraR.projectionMatrix.copy(rn)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(W_),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(j_)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:wn,SubtractEquation:101,SubtractiveBlending:3,TOUCH:fn,TangentSpaceNormalMap:0,TetrahedronGeometry:_p,Texture:wt,TextureLoader:xs,TorusGeometry:hs,TorusKnotGeometry:yp,Triangle:dr,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeGeometry:Xs,UVMapping:sp,Uint16BufferAttribute:lp,Uint32BufferAttribute:r0,Uint8BufferAttribute:class extends tt{constructor(i,e,t){super(new Uint8Array(i),e,t)}},Uint8ClampedBufferAttribute:class extends tt{constructor(i,e,t){super(new Uint8ClampedArray(i),e,t)}},Uniform:w0,UniformsGroup:class extends ys{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:nA++}),this.name="",this.usage=Ic,this.uniforms=[]}add(i){return this.uniforms.push(i),this}remove(i){const e=this.uniforms.indexOf(i);return e!==-1&&this.uniforms.splice(e,1),this}setName(i){return this.name=i,this}setUsage(i){return this.usage=i,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(i){this.name=i.name,this.usage=i.usage;const e=i.uniforms;this.uniforms.length=0;for(let t=0,r=e.length;t<r;t++){const s=Array.isArray(e[t])?e[t]:[e[t]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}},UniformsLib:Te,UniformsUtils:ai,UnsignedByteType:zn,UnsignedInt248Type:Da,UnsignedInt5999Type:35902,UnsignedIntType:Vn,UnsignedShort4444Type:Xg,UnsignedShort5551Type:qg,UnsignedShortType:$o,VSMShadowMap:Vr,Vector2:ne,Vector3:R,Vector4:qe,VectorKeyframeTrack:ka,VideoTexture:Ux,WebGL3DRenderTarget:class extends ft{constructor(i=1,e=1,t=1,r={}){super(i,e,r),this.isWebGL3DRenderTarget=!0,this.depth=t,this.texture=new Kf(null,i,e,t),this.texture.isRenderTargetTexture=!0}},WebGLArrayRenderTarget:class extends ft{constructor(i=1,e=1,t=1,r={}){super(i,e,r),this.isWebGLArrayRenderTarget=!0,this.depth=t,this.texture=new md(null,i,e,t),this.texture.isRenderTargetTexture=!0}},WebGLCoordinateSystem:Hn,WebGLCubeRenderTarget:Tx,WebGLMultipleRenderTargets:class extends ft{constructor(i=1,e=1,t=1,r={}){super(i,e,yi(Ne({},r),{count:t})),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}},WebGLRenderTarget:ft,WebGLRenderer:Dx,WebGLUtils:Lx,WebGPUCoordinateSystem:Lc,WireframeGeometry:p0,WrapAroundEnding:Ec,ZeroCurvatureEnding:An,ZeroFactor:Qo,ZeroSlopeEnding:En,ZeroStencilOp:0,createCanvasElement:yx},Symbol.toStringTag,{value:"Module"}));function Ls(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function hb(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}var S0,Oi,Pt,Ut,cs,dg,T0,ub,db,Po,Vc,zl,wu,Am,oy,ly,cy,_r={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},dl={duration:.5,overwrite:!1,delay:0},Hs=1e8,Xi=1e-8,pg=2*Math.PI,lA=pg/4,cA=0,pb=Math.sqrt,hA=Math.cos,uA=Math.sin,xi=function(i){return typeof i=="string"},Gt=function(i){return typeof i=="function"},Ys=function(i){return typeof i=="number"},A0=function(i){return i===void 0},bs=function(i){return typeof i=="object"},er=function(i){return i!==!1},E0=function(){return typeof window<"u"},Su=function(i){return Gt(i)||xi(i)},mb=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Li=Array.isArray,mg=/(?:-?\.?\d|\.)+/gi,fb=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Io=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Em=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,gb=/[+-]=-?[.\d]+/,vb=/[^,'"\[\]\s]+/gi,dA=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,fr={},Md={},_b=function(i){return(Md=qn(i,fr))&&ir},Hc=function(i,e){return!e&&void 0},yb=function(i,e){return i&&(fr[i]=e)&&Md&&(Md[i]=e)||fr},Gc=function(){return 0},pA={suppressEvents:!0,isStart:!0,kill:!1},rd={suppressEvents:!0,kill:!1},mA={suppressEvents:!0},C0={},Ca=[],fg={},lr={},Cm={},hy=30,sd=[],R0="",P0=function(i){var e,t,r=i[0];if(bs(r)||Gt(r)||(i=[i]),!(e=(r._gsap||{}).harness)){for(t=sd.length;t--&&!sd[t].targetTest(r););e=sd[t]}for(t=i.length;t--;)i[t]&&(i[t]._gsap||(i[t]._gsap=new zb(i[t],e)))||i.splice(t,1);return i},Nn=function(i){return i._gsap||P0(Cr(i))[0]._gsap},xb=function(i,e,t){return(t=i[e])&&Gt(t)?i[e]():A0(t)&&i.getAttribute&&i.getAttribute(e)||t},$i=function(i,e){return(i=i.split(",")).forEach(e)||i},Zt=function(i){return Math.round(1e5*i)/1e5||0},_i=function(i){return Math.round(1e7*i)/1e7||0},Vo=function(i,e){var t=e.charAt(0),r=parseFloat(e.substr(2));return i=parseFloat(i),t==="+"?i+r:t==="-"?i-r:t==="*"?i*r:i/r},fA=function(i,e){for(var t=e.length,r=0;i.indexOf(e[r])<0&&++r<t;);return r<t},wd=function(){var i,e,t=Ca.length,r=Ca.slice(0);for(fg={},Ca.length=0,i=0;i<t;i++)(e=r[i])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},bb=function(i,e,t,r){Ca.length&&!Oi&&wd(),i.render(e,t,Oi&&e<0&&(i._initted||i._startAt)),Ca.length&&!Oi&&wd()},Mb=function(i){var e=parseFloat(i);return(e||e===0)&&(i+"").match(vb).length<2?e:xi(i)?i.trim():i},wb=function(i){return i},Lr=function(i,e){for(var t in e)t in i||(i[t]=e[t]);return i},qn=function(i,e){for(var t in e)i[t]=e[t];return i},uy=function i(e,t){for(var r in t)r!=="__proto__"&&r!=="constructor"&&r!=="prototype"&&(e[r]=bs(t[r])?i(e[r]||(e[r]={}),t[r]):t[r]);return e},Sd=function(i,e){var t,r={};for(t in i)t in e||(r[t]=i[t]);return r},gc=function(i){var e,t=i.parent||Ut,r=i.keyframes?(e=Li(i.keyframes),function(s,a){for(var n in a)n in s||n==="duration"&&e||n==="ease"||(s[n]=a[n])}):Lr;if(er(i.inherit))for(;t;)r(i,t.vars.defaults),t=t.parent||t._dp;return i},Sb=function(i,e,t,r,s){var a,n=i[r];if(s)for(a=e[s];n&&n[s]>a;)n=n._prev;return n?(e._next=n._next,n._next=e):(e._next=i[t],i[t]=e),e._next?e._next._prev=e:i[r]=e,e._prev=n,e.parent=e._dp=i,e},wp=function(i,e,t,r){t===void 0&&(t="_first"),r===void 0&&(r="_last");var s=e._prev,a=e._next;s?s._next=a:i[t]===e&&(i[t]=a),a?a._prev=s:i[r]===e&&(i[r]=s),e._next=e._prev=e.parent=null},Fa=function(i,e){i.parent&&(!e||i.parent.autoRemoveChildren)&&i.parent.remove&&i.parent.remove(i),i._act=0},Dn=function(i,e){if(i&&(!e||e._end>i._dur||e._start<0))for(var t=i;t;)t._dirty=1,t=t.parent;return i},Rm=function(i,e,t,r){return i._startAt&&(Oi?i._startAt.revert(rd):i.vars.immediateRender&&!i.vars.autoRevert||i._startAt.render(e,!0,r))},gA=function i(e){return!e||e._ts&&i(e.parent)},dy=function(i){return i._repeat?Ho(i._tTime,i=i.duration()+i._rDelay)*i:0},Ho=function(i,e){var t=Math.floor(i/=e);return i&&t===i?t-1:t},Td=function(i,e){return(i-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Sp=function(i){return i._end=_i(i._start+(i._tDur/Math.abs(i._ts||i._rts||Xi)||0))},Tp=function(i,e){var t=i._dp;return t&&t.smoothChildTiming&&i._ts&&(i._start=_i(t._time-(i._ts>0?e/i._ts:((i._dirty?i.totalDuration():i._tDur)-e)/-i._ts)),Sp(i),t._dirty||Dn(t,i)),i},Tb=function(i,e){var t;if((e._time||!e._dur&&e._initted||e._start<i._time&&(e._dur||!e.add))&&(t=Td(i.rawTime(),e),(!e._dur||yh(0,e.totalDuration(),t)-e._tTime>Xi)&&e.render(t,!0)),Dn(i,e)._dp&&i._initted&&i._time>=i._dur&&i._ts){if(i._dur<i.duration())for(t=i;t._dp;)t.rawTime()>=0&&t.totalTime(t._tTime),t=t._dp;i._zTime=-1e-8}},us=function(i,e,t,r){return e.parent&&Fa(e),e._start=_i((Ys(t)?t:t||i!==Ut?wr(i,t,e):i._time)+e._delay),e._end=_i(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),Sb(i,e,"_first","_last",i._sort?"_start":0),gg(e)||(i._recent=e),r||Tb(i,e),i._ts<0&&Tp(i,i._tTime),i},Ab=function(i,e){return fr.ScrollTrigger?fr.ScrollTrigger.create(e,i):void 0},py=function(i,e,t,r,s){return bg(i,e,s),i._initted?!t&&i._pt&&!Oi&&(i._dur&&i.vars.lazy!==!1||!i._dur&&i.vars.lazy)&&db!==pr.frame?(Ca.push(i),i._lazy=[s,r],1):void 0:1},vA=function i(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||i(t))},gg=function(i){var e=i.data;return e==="isFromStart"||e==="isStart"},pl=function(i,e,t,r){var s=i._repeat,a=_i(e)||0,n=i._tTime/i._tDur;return n&&!r&&(i._time*=a/i._dur),i._dur=a,i._tDur=s?s<0?1e10:_i(a*(s+1)+i._rDelay*s):a,n>0&&!r&&Tp(i,i._tTime=i._tDur*n),i.parent&&Sp(i),t||Dn(i.parent,i),i},my=function(i){return i instanceof ji?Dn(i):pl(i,i._dur)},_A={_start:0,endTime:Gc,totalDuration:Gc},wr=function i(e,t,r){var s,a,n,o=e.labels,l=e._recent||_A,c=e.duration()>=Hs?l.endTime(!1):e._dur;return xi(t)&&(isNaN(t)||t in o)?(a=t.charAt(0),n=t.substr(-1)==="%",s=t.indexOf("="),a==="<"||a===">"?(s>=0&&(t=t.replace(/=/,"")),(a==="<"?l._start:l.endTime(l._repeat>=0))+(parseFloat(t.substr(1))||0)*(n?(s<0?l:r).totalDuration()/100:1)):s<0?(t in o||(o[t]=c),o[t]):(a=parseFloat(t.charAt(s-1)+t.substr(s+1)),n&&r&&(a=a/100*(Li(r)?r[0]:r).totalDuration()),s>1?i(e,t.substr(0,s-1),r)+a:c+a)):t==null?c:+t},vc=function(i,e,t){var r,s,a=Ys(e[1]),n=(a?2:1)+(i<2?0:1),o=e[n];if(a&&(o.duration=e[1]),o.parent=t,i){for(r=o,s=t;s&&!("immediateRender"in r);)r=s.vars.defaults||{},s=er(s.vars.inherit)&&s.parent;o.immediateRender=er(r.immediateRender),i<2?o.runBackwards=1:o.startAt=e[n-1]}return new si(e[0],o,e[n+1])},va=function(i,e){return i||i===0?e(i):e},yh=function(i,e,t){return t<i?i:t>e?e:t},Ni=function(i,e){return xi(i)&&(e=dA.exec(i))?e[1]:""},vg=[].slice,Eb=function(i,e){return i&&bs(i)&&"length"in i&&(!e&&!i.length||i.length-1 in i&&bs(i[0]))&&!i.nodeType&&i!==cs},yA=function(i,e,t){return t===void 0&&(t=[]),i.forEach(function(r){var s;return xi(r)&&!e||Eb(r,1)?(s=t).push.apply(s,Cr(r)):t.push(r)})||t},Cr=function(i,e,t){return Pt&&!e&&Pt.selector?Pt.selector(i):!xi(i)||t||!dg&&ml()?Li(i)?yA(i,t):Eb(i)?vg.call(i,0):i?[i]:[]:vg.call((e||T0).querySelectorAll(i),0)},_g=function(i){return i=Cr(i)[0]||Hc()||{},function(e){var t=i.current||i.nativeElement||i;return Cr(e,t.querySelectorAll?t:t===i?Hc()||T0.createElement("div"):i)}},Cb=function(i){return i.sort(function(){return .5-Math.random()})},Rb=function(i){if(Gt(i))return i;var e=bs(i)?i:{each:i},t=On(e.ease),r=e.from||0,s=parseFloat(e.base)||0,a={},n=r>0&&r<1,o=isNaN(r)||n,l=e.axis,c=r,h=r;return xi(r)?c=h={center:.5,edges:.5,end:1}[r]||0:!n&&o&&(c=r[0],h=r[1]),function(u,d,p){var f,g,m,v,_,y,x,b,M,T=(p||e).length,E=a[T];if(!E){if(!(M=e.grid==="auto"?0:(e.grid||[1,Hs])[1])){for(x=-1e8;x<(x=p[M++].getBoundingClientRect().left)&&M<T;);M<T&&M--}for(E=a[T]=[],f=o?Math.min(M,T)*c-.5:r%M,g=M===Hs?0:o?T*h/M-.5:r/M|0,x=0,b=Hs,y=0;y<T;y++)m=y%M-f,v=g-(y/M|0),E[y]=_=l?Math.abs(l==="y"?v:m):pb(m*m+v*v),_>x&&(x=_),_<b&&(b=_);r==="random"&&Cb(E),E.max=x-b,E.min=b,E.v=T=(parseFloat(e.amount)||parseFloat(e.each)*(M>T?T-1:l?l==="y"?T/M:M:Math.max(M,T/M))||0)*(r==="edges"?-1:1),E.b=T<0?s-T:s,E.u=Ni(e.amount||e.each)||0,t=t&&T<0?kb(t):t}return T=(E[u]-E.min)/E.max||0,_i(E.b+(t?t(T):T)*E.v)+E.u}},yg=function(i){var e=Math.pow(10,((i+"").split(".")[1]||"").length);return function(t){var r=_i(Math.round(parseFloat(t)/i)*i*e);return(r-r%1)/e+(Ys(t)?0:Ni(t))}},Pb=function(i,e){var t,r,s=Li(i);return!s&&bs(i)&&(t=s=i.radius||Hs,i.values?(i=Cr(i.values),(r=!Ys(i[0]))&&(t*=t)):i=yg(i.increment)),va(e,s?Gt(i)?function(a){return r=i(a),Math.abs(r-a)<=t?r:a}:function(a){for(var n,o,l=parseFloat(r?a.x:a),c=parseFloat(r?a.y:0),h=Hs,u=0,d=i.length;d--;)(n=r?(n=i[d].x-l)*n+(o=i[d].y-c)*o:Math.abs(i[d]-l))<h&&(h=n,u=d);return u=!t||h<=t?i[u]:a,r||u===a||Ys(a)?u:u+Ni(a)}:yg(i))},Ib=function(i,e,t,r){return va(Li(i)?!e:t===!0?!!(t=0):!r,function(){return Li(i)?i[~~(Math.random()*i.length)]:(t=t||1e-5)&&(r=t<1?Math.pow(10,(t+"").length-2):1)&&Math.floor(Math.round((i-t/2+Math.random()*(e-i+.99*t))/t)*t*r)/r})},fy=function(i,e,t){return va(t,function(r){return i[~~e(r)]})},jc=function(i){for(var e,t,r,s,a=0,n="";~(e=i.indexOf("random(",a));)r=i.indexOf(")",e),s=i.charAt(e+7)==="[",t=i.substr(e+7,r-e-7).match(s?vb:mg),n+=i.substr(a,e-a)+Ib(s?t:+t[0],s?0:+t[1],+t[2]||1e-5),a=r+1;return n+i.substr(a,i.length-a)},gy=function(i,e,t,r,s){var a=e-i,n=r-t;return va(s,function(o){return t+((o-i)/a*n||0)})},vy=function(i,e,t){var r,s,a,n=i.labels,o=Hs;for(r in n)(s=n[r]-e)<0==!!t&&s&&o>(s=Math.abs(s))&&(a=r,o=s);return a},cr=function(i,e,t){var r,s,a,n=i.vars,o=n[e],l=Pt,c=i._ctx;if(o)return r=n[e+"Params"],s=n.callbackScope||i,t&&Ca.length&&wd(),c&&(Pt=c),a=r?o.apply(s,r):o.call(s),Pt=l,a},rc=function(i){return Fa(i),i.scrollTrigger&&i.scrollTrigger.kill(!!Oi),i.progress()<1&&cr(i,"onInterrupt"),i},Lb=[],Nb=function(i){if(i)if(i=!i.name&&i.default||i,E0()||i.headless){var e=i.name,t=Gt(i),r=e&&!t&&i.init?function(){this._props=[]}:i,s={init:Gc,render:Mg,add:I0,kill:PA,modifier:RA,rawVars:0},a={targetTest:0,get:0,getSetter:N0,aliases:{},register:0};if(ml(),i!==r){if(lr[e])return;Lr(r,Lr(Sd(i,s),a)),qn(r.prototype,qn(s,Sd(i,a))),lr[r.prop=e]=r,i.targetTest&&(sd.push(r),C0[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}yb(e,r),i.register&&i.register(ir,r,tr)}else Lb.push(i)},bt=255,sc={aqua:[0,bt,bt],lime:[0,bt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,bt],navy:[0,0,128],white:[bt,bt,bt],olive:[128,128,0],yellow:[bt,bt,0],orange:[bt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[bt,0,0],pink:[bt,192,203],cyan:[0,bt,bt],transparent:[bt,bt,bt,0]},Pm=function(i,e,t){return(6*(i+=i<0?1:i>1?-1:0)<1?e+(t-e)*i*6:i<.5?t:3*i<2?e+(t-e)*(2/3-i)*6:e)*bt+.5|0},Db=function(i,e,t){var r,s,a,n,o,l,c,h,u,d,p=i?Ys(i)?[i>>16,i>>8&bt,i&bt]:0:sc.black;if(!p){if(i.substr(-1)===","&&(i=i.substr(0,i.length-1)),sc[i])p=sc[i];else if(i.charAt(0)==="#"){if(i.length<6&&(r=i.charAt(1),s=i.charAt(2),a=i.charAt(3),i="#"+r+r+s+s+a+a+(i.length===5?i.charAt(4)+i.charAt(4):"")),i.length===9)return[(p=parseInt(i.substr(1,6),16))>>16,p>>8&bt,p&bt,parseInt(i.substr(7),16)/255];p=[(i=parseInt(i.substr(1),16))>>16,i>>8&bt,i&bt]}else if(i.substr(0,3)==="hsl")if(p=d=i.match(mg),e){if(~i.indexOf("="))return p=i.match(fb),t&&p.length<4&&(p[3]=1),p}else n=+p[0]%360/360,o=+p[1]/100,r=2*(l=+p[2]/100)-(s=l<=.5?l*(o+1):l+o-l*o),p.length>3&&(p[3]*=1),p[0]=Pm(n+1/3,r,s),p[1]=Pm(n,r,s),p[2]=Pm(n-1/3,r,s);else p=i.match(mg)||sc.transparent;p=p.map(Number)}return e&&!d&&(r=p[0]/bt,s=p[1]/bt,a=p[2]/bt,l=((c=Math.max(r,s,a))+(h=Math.min(r,s,a)))/2,c===h?n=o=0:(u=c-h,o=l>.5?u/(2-c-h):u/(c+h),n=c===r?(s-a)/u+(s<a?6:0):c===s?(a-r)/u+2:(r-s)/u+4,n*=60),p[0]=~~(n+.5),p[1]=~~(100*o+.5),p[2]=~~(100*l+.5)),t&&p.length<4&&(p[3]=1),p},Ob=function(i){var e=[],t=[],r=-1;return i.split(Ra).forEach(function(s){var a=s.match(Io)||[];e.push.apply(e,a),t.push(r+=a.length+1)}),e.c=t,e},_y=function(i,e,t){var r,s,a,n,o="",l=(i+o).match(Ra),c=e?"hsla(":"rgba(",h=0;if(!l)return i;if(l=l.map(function(u){return(u=Db(u,e,1))&&c+(e?u[0]+","+u[1]+"%,"+u[2]+"%,"+u[3]:u.join(","))+")"}),t&&(a=Ob(i),(r=t.c).join(o)!==a.c.join(o)))for(n=(s=i.replace(Ra,"1").split(Io)).length-1;h<n;h++)o+=s[h]+(~r.indexOf(h)?l.shift()||c+"0,0,0,0)":(a.length?a:l.length?l:t).shift());if(!s)for(n=(s=i.split(Ra)).length-1;h<n;h++)o+=s[h]+l[h];return o+s[n]},Ra=function(){var i,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(i in sc)e+="|"+i+"\\b";return new RegExp(e+")","gi")}(),xA=/hsl[a]?\(/,Ub=function(i){var e,t=i.join(" ");if(Ra.lastIndex=0,Ra.test(t))return e=xA.test(t),i[1]=_y(i[1],e),i[0]=_y(i[0],e,Ob(i[1])),!0},pr=function(){var i,e,t,r,s,a,n=Date.now,o=500,l=33,c=n(),h=c,u=1e3/240,d=u,p=[],f=function g(m){var v,_,y,x,b=n()-h,M=m===!0;if((b>o||b<0)&&(c+=b-l),((v=(y=(h+=b)-c)-d)>0||M)&&(x=++r.frame,s=y-1e3*r.time,r.time=y/=1e3,d+=v+(v>=u?4:u-v),_=1),M||(i=e(g)),_)for(a=0;a<p.length;a++)p[a](y,s,x,m)};return r={time:0,frame:0,tick:function(){f(!0)},deltaRatio:function(g){return s/(1e3/(g||60))},wake:function(){ub&&(!dg&&E0()&&(cs=dg=window,T0=cs.document||{},fr.gsap=ir,(cs.gsapVersions||(cs.gsapVersions=[])).push(ir.version),_b(Md||cs.GreenSockGlobals||!cs.gsap&&cs||{}),Lb.forEach(Nb)),t=typeof requestAnimationFrame<"u"&&requestAnimationFrame,i&&r.sleep(),e=t||function(g){return setTimeout(g,d-1e3*r.time+1|0)},Vc=1,f(2))},sleep:function(){(t?cancelAnimationFrame:clearTimeout)(i),Vc=0,e=Gc},lagSmoothing:function(g,m){o=g||1/0,l=Math.min(m||33,o)},fps:function(g){u=1e3/(g||240),d=1e3*r.time+u},add:function(g,m,v){var _=m?function(y,x,b,M){g(y,x,b,M),r.remove(_)}:g;return r.remove(g),p[v?"unshift":"push"](_),ml(),_},remove:function(g,m){~(m=p.indexOf(g))&&p.splice(m,1)&&a>=m&&a--},_listeners:p},r}(),ml=function(){return!Vc&&pr.wake()},ot={},bA=/^[\d.\-M][\d.\-,\s]/,MA=/["']/g,wA=function(i){for(var e,t,r,s={},a=i.substr(1,i.length-3).split(":"),n=a[0],o=1,l=a.length;o<l;o++)t=a[o],e=o!==l-1?t.lastIndexOf(","):t.length,r=t.substr(0,e),s[n]=isNaN(r)?r.replace(MA,"").trim():+r,n=t.substr(e+1).trim();return s},kb=function(i){return function(e){return 1-i(1-e)}},Fb=function i(e,t){for(var r,s=e._first;s;)s instanceof ji?i(s,t):!s.vars.yoyoEase||s._yoyo&&s._repeat||s._yoyo===t||(s.timeline?i(s.timeline,t):(r=s._ease,s._ease=s._yEase,s._yEase=r,s._yoyo=t)),s=s._next},On=function(i,e){return i&&(Gt(i)?i:ot[i]||function(t){var r,s,a,n,o=(t+"").split("("),l=ot[o[0]];return l&&o.length>1&&l.config?l.config.apply(null,~t.indexOf("{")?[wA(o[1])]:(r=t,s=r.indexOf("(")+1,a=r.indexOf(")"),n=r.indexOf("(",s),r.substring(s,~n&&n<a?r.indexOf(")",a+1):a)).split(",").map(Mb)):ot._CE&&bA.test(t)?ot._CE("",t):l}(i))||e},ln=function(i,e,t,r){t===void 0&&(t=function(n){return 1-e(1-n)}),r===void 0&&(r=function(n){return n<.5?e(2*n)/2:1-e(2*(1-n))/2});var s,a={easeIn:e,easeOut:t,easeInOut:r};return $i(i,function(n){for(var o in ot[n]=fr[n]=a,ot[s=n.toLowerCase()]=t,a)ot[s+(o==="easeIn"?".in":o==="easeOut"?".out":".inOut")]=ot[n+"."+o]=a[o]}),a},Bb=function(i){return function(e){return e<.5?(1-i(1-2*e))/2:.5+i(2*(e-.5))/2}},Im=function i(e,t,r){var s=t>=1?t:1,a=(r||(e?.3:.45))/(t<1?t:1),n=a/pg*(Math.asin(1/s)||0),o=function(c){return c===1?1:s*Math.pow(2,-10*c)*uA((c-n)*a)+1},l=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:Bb(o);return a=pg/a,l.config=function(c,h){return i(e,c,h)},l},Lm=function i(e,t){t===void 0&&(t=1.70158);var r=function(a){return a?--a*a*((t+1)*a+t)+1:0},s=e==="out"?r:e==="in"?function(a){return 1-r(1-a)}:Bb(r);return s.config=function(a){return i(e,a)},s};$i("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,e){var t=e<5?e+1:e;ln(i+",Power"+(t-1),e?function(r){return Math.pow(r,t)}:function(r){return r},function(r){return 1-Math.pow(1-r,t)},function(r){return r<.5?Math.pow(2*r,t)/2:1-Math.pow(2*(1-r),t)/2})}),ot.Linear.easeNone=ot.none=ot.Linear.easeIn,ln("Elastic",Im("in"),Im("out"),Im()),zl=7.5625,oy=2*(Am=1/(wu=2.75)),ly=2.5*Am,ln("Bounce",function(i){return 1-cy(1-i)},cy=function(i){return i<Am?zl*i*i:i<oy?zl*Math.pow(i-1.5/wu,2)+.75:i<ly?zl*(i-=2.25/wu)*i+.9375:zl*Math.pow(i-2.625/wu,2)+.984375}),ln("Expo",function(i){return i?Math.pow(2,10*(i-1)):0}),ln("Circ",function(i){return-(pb(1-i*i)-1)}),ln("Sine",function(i){return i===1?1:1-hA(i*lA)}),ln("Back",Lm("in"),Lm("out"),Lm()),ot.SteppedEase=ot.steps=fr.SteppedEase={config:function(i,e){i===void 0&&(i=1);var t=1/i,r=i+(e?0:1),s=e?1:0;return function(a){return((r*yh(0,.99999999,a)|0)+s)*t}}},dl.ease=ot["quad.out"],$i("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return R0+=i+","+i+"Params,"});var zb=function(i,e){this.id=cA++,i._gsap=this,this.target=i,this.harness=e,this.get=e?e.get:xb,this.set=e?e.getSetter:N0},Wc=function(){function i(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,pl(this,+t.duration,1,1),this.data=t.data,Pt&&(this._ctx=Pt,Pt.data.push(this)),Vc||pr.wake()}var e=i.prototype;return e.delay=function(t){return t||t===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,pl(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,r){if(ml(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(Tp(this,t),!s._dp||s.parent||Tb(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&us(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===Xi||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),bb(this,t,r)),this},e.time=function(t,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+dy(this))%(this._dur+this._rDelay)||(t?this._dur:0),r):this._time},e.totalProgress=function(t,r){return arguments.length?this.totalTime(this.totalDuration()*t,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(t,r){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+dy(this),r):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,r){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*s,r):this._repeat?Ho(this._tTime,s)+1:1},e.timeScale=function(t,r){if(!arguments.length)return this._rts===-1e-8?0:this._rts;if(this._rts===t)return this;var s=this.parent&&this._ts?Td(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||t===-1e-8?0:this._rts,this.totalTime(yh(-Math.abs(this._delay),this._tDur,s),r!==!1),Sp(this),function(a){for(var n=a.parent;n&&n.parent;)n._dirty=1,n.totalDuration(),n=n.parent;return a}(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(ml(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Xi&&(this._tTime-=Xi)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&us(r,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(er(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var r=this.parent||this._dp;return r?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Td(r.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){t===void 0&&(t=mA);var r=Oi;return Oi=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),this.data!=="nested"&&t.kill!==!1&&this.kill(),Oi=r,this},e.globalTime=function(t){for(var r=this,s=arguments.length?t:r.rawTime();r;)s=r._start+s/(Math.abs(r._ts)||1),r=r._dp;return!this.parent&&this._sat?this._sat.globalTime(t):s},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,my(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var r=this._time;return this._rDelay=t,my(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,r){return this.totalTime(wr(this,t),er(r))},e.restart=function(t,r){return this.play().totalTime(t?-this._delay:0,er(r))},e.play=function(t,r){return t!=null&&this.seek(t,r),this.reversed(!1).paused(!1)},e.reverse=function(t,r){return t!=null&&this.seek(t||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(t,r){return t!=null&&this.seek(t,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,r=this.parent||this._dp,s=this._start;return!(r&&!(this._ts&&this._initted&&r.isActive()&&(t=r.rawTime(!0))>=s&&t<this.endTime(!0)-Xi))},e.eventCallback=function(t,r,s){var a=this.vars;return arguments.length>1?(r?(a[t]=r,s&&(a[t+"Params"]=s),t==="onUpdate"&&(this._onUpdate=r)):delete a[t],this):a[t]},e.then=function(t){var r=this;return new Promise(function(s){var a=Gt(t)?t:wb,n=function(){var o=r.then;r.then=null,Gt(a)&&(a=a(r))&&(a.then||a===r)&&(r.then=o),s(a),r.then=o};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?n():r._prom=n})},e.kill=function(){rc(this)},i}();Lr(Wc.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var ji=function(i){function e(r,s){var a;return r===void 0&&(r={}),(a=i.call(this,r)||this).labels={},a.smoothChildTiming=!!r.smoothChildTiming,a.autoRemoveChildren=!!r.autoRemoveChildren,a._sort=er(r.sortChildren),Ut&&us(r.parent||Ut,Ls(a),s),r.reversed&&a.reverse(),r.paused&&a.paused(!0),r.scrollTrigger&&Ab(Ls(a),r.scrollTrigger),a}hb(e,i);var t=e.prototype;return t.to=function(r,s,a){return vc(0,arguments,this),this},t.from=function(r,s,a){return vc(1,arguments,this),this},t.fromTo=function(r,s,a,n){return vc(2,arguments,this),this},t.set=function(r,s,a){return s.duration=0,s.parent=this,gc(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new si(r,s,wr(this,a),1),this},t.call=function(r,s,a){return us(this,si.delayedCall(0,r,s),a)},t.staggerTo=function(r,s,a,n,o,l,c){return a.duration=s,a.stagger=a.stagger||n,a.onComplete=l,a.onCompleteParams=c,a.parent=this,new si(r,a,wr(this,o)),this},t.staggerFrom=function(r,s,a,n,o,l,c){return a.runBackwards=1,gc(a).immediateRender=er(a.immediateRender),this.staggerTo(r,s,a,n,o,l,c)},t.staggerFromTo=function(r,s,a,n,o,l,c,h){return n.startAt=a,gc(n).immediateRender=er(n.immediateRender),this.staggerTo(r,s,n,o,l,c,h)},t.render=function(r,s,a){var n,o,l,c,h,u,d,p,f,g,m,v,_=this._time,y=this._dirty?this.totalDuration():this._tDur,x=this._dur,b=r<=0?0:_i(r),M=this._zTime<0!=r<0&&(this._initted||!x);if(this!==Ut&&b>y&&r>=0&&(b=y),b!==this._tTime||a||M){if(_!==this._time&&x&&(b+=this._time-_,r+=this._time-_),n=b,f=this._start,u=!(p=this._ts),M&&(x||(_=this._zTime),(r||!s)&&(this._zTime=r)),this._repeat){if(m=this._yoyo,h=x+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(100*h+r,s,a);if(n=_i(b%h),b===y?(c=this._repeat,n=x):((c=~~(b/h))&&c===b/h&&(n=x,c--),n>x&&(n=x)),g=Ho(this._tTime,h),!_&&this._tTime&&g!==c&&this._tTime-g*h-this._dur<=0&&(g=c),m&&1&c&&(n=x-n,v=1),c!==g&&!this._lock){var T=m&&1&g,E=T===(m&&1&c);if(c<g&&(T=!T),_=T?0:b%x?x:b,this._lock=1,this.render(_||(v?0:_i(c*h)),s,!x)._lock=0,this._tTime=b,!s&&this.parent&&cr(this,"onRepeat"),this.vars.repeatRefresh&&!v&&(this.invalidate()._lock=1),_&&_!==this._time||u!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(x=this._dur,y=this._tDur,E&&(this._lock=2,_=T?x:-1e-4,this.render(_,!0),this.vars.repeatRefresh&&!v&&this.invalidate()),this._lock=0,!this._ts&&!u)return this;Fb(this,v)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(d=function(N,D,A){var L;if(A>D)for(L=N._first;L&&L._start<=A;){if(L.data==="isPause"&&L._start>D)return L;L=L._next}else for(L=N._last;L&&L._start>=A;){if(L.data==="isPause"&&L._start<D)return L;L=L._prev}}(this,_i(_),_i(n)),d&&(b-=n-(n=d._start))),this._tTime=b,this._time=n,this._act=!p,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,_=0),!_&&n&&!s&&!c&&(cr(this,"onStart"),this._tTime!==b))return this;if(n>=_&&r>=0)for(o=this._first;o;){if(l=o._next,(o._act||n>=o._start)&&o._ts&&d!==o){if(o.parent!==this)return this.render(r,s,a);if(o.render(o._ts>0?(n-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(n-o._start)*o._ts,s,a),n!==this._time||!this._ts&&!u){d=0,l&&(b+=this._zTime=-1e-8);break}}o=l}else{o=this._last;for(var C=r<0?r:n;o;){if(l=o._prev,(o._act||C<=o._end)&&o._ts&&d!==o){if(o.parent!==this)return this.render(r,s,a);if(o.render(o._ts>0?(C-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(C-o._start)*o._ts,s,a||Oi&&(o._initted||o._startAt)),n!==this._time||!this._ts&&!u){d=0,l&&(b+=this._zTime=C?-1e-8:Xi);break}}o=l}}if(d&&!s&&(this.pause(),d.render(n>=_?0:-1e-8)._zTime=n>=_?1:-1,this._ts))return this._start=f,Sp(this),this.render(r,s,a);this._onUpdate&&!s&&cr(this,"onUpdate",!0),(b===y&&this._tTime>=this.totalDuration()||!b&&_)&&(f!==this._start&&Math.abs(p)===Math.abs(this._ts)||this._lock||((r||!x)&&(b===y&&this._ts>0||!b&&this._ts<0)&&Fa(this,1),s||r<0&&!_||!b&&!_&&y||(cr(this,b===y&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(b<y&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,s){var a=this;if(Ys(s)||(s=wr(this,s,r)),!(r instanceof Wc)){if(Li(r))return r.forEach(function(n){return a.add(n,s)}),this;if(xi(r))return this.addLabel(r,s);if(!Gt(r))return this;r=si.delayedCall(0,r)}return this!==r?us(this,r,s):this},t.getChildren=function(r,s,a,n){r===void 0&&(r=!0),s===void 0&&(s=!0),a===void 0&&(a=!0),n===void 0&&(n=-1e8);for(var o=[],l=this._first;l;)l._start>=n&&(l instanceof si?s&&o.push(l):(a&&o.push(l),r&&o.push.apply(o,l.getChildren(!0,s,a)))),l=l._next;return o},t.getById=function(r){for(var s=this.getChildren(1,1,1),a=s.length;a--;)if(s[a].vars.id===r)return s[a]},t.remove=function(r){return xi(r)?this.removeLabel(r):Gt(r)?this.killTweensOf(r):(wp(this,r),r===this._recent&&(this._recent=this._last),Dn(this))},t.totalTime=function(r,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_i(pr.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),i.prototype.totalTime.call(this,r,s),this._forcing=0,this):this._tTime},t.addLabel=function(r,s){return this.labels[r]=wr(this,s),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,s,a){var n=si.delayedCall(0,s||Gc,a);return n.data="isPause",this._hasPause=1,us(this,n,wr(this,r))},t.removePause=function(r){var s=this._first;for(r=wr(this,r);s;)s._start===r&&s.data==="isPause"&&Fa(s),s=s._next},t.killTweensOf=function(r,s,a){for(var n=this.getTweensOf(r,a),o=n.length;o--;)_a!==n[o]&&n[o].kill(r,s);return this},t.getTweensOf=function(r,s){for(var a,n=[],o=Cr(r),l=this._first,c=Ys(s);l;)l instanceof si?fA(l._targets,o)&&(c?(!_a||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&n.push(l):(a=l.getTweensOf(o,s)).length&&n.push.apply(n,a),l=l._next;return n},t.tweenTo=function(r,s){s=s||{};var a,n=this,o=wr(n,r),l=s,c=l.startAt,h=l.onStart,u=l.onStartParams,d=l.immediateRender,p=si.to(n,Lr({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:s.duration||Math.abs((o-(c&&"time"in c?c.time:n._time))/n.timeScale())||Xi,onStart:function(){if(n.pause(),!a){var f=s.duration||Math.abs((o-(c&&"time"in c?c.time:n._time))/n.timeScale());p._dur!==f&&pl(p,f,0,1).render(p._time,!0,!0),a=1}h&&h.apply(p,u||[])}},s));return d?p.render(0):p},t.tweenFromTo=function(r,s,a){return this.tweenTo(s,Lr({startAt:{time:wr(this,r)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),vy(this,wr(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),vy(this,wr(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+Xi)},t.shiftChildren=function(r,s,a){a===void 0&&(a=0);for(var n,o=this._first,l=this.labels;o;)o._start>=a&&(o._start+=r,o._end+=r),o=o._next;if(s)for(n in l)l[n]>=a&&(l[n]+=r);return Dn(this)},t.invalidate=function(r){var s=this._first;for(this._lock=0;s;)s.invalidate(r),s=s._next;return i.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var s,a=this._first;a;)s=a._next,this.remove(a),a=s;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),Dn(this)},t.totalDuration=function(r){var s,a,n,o=0,l=this,c=l._last,h=Hs;if(arguments.length)return l.timeScale((l._repeat<0?l.duration():l.totalDuration())/(l.reversed()?-r:r));if(l._dirty){for(n=l.parent;c;)s=c._prev,c._dirty&&c.totalDuration(),(a=c._start)>h&&l._sort&&c._ts&&!l._lock?(l._lock=1,us(l,c,a-c._delay,1)._lock=0):h=a,a<0&&c._ts&&(o-=a,(!n&&!l._dp||n&&n.smoothChildTiming)&&(l._start+=a/l._ts,l._time-=a,l._tTime-=a),l.shiftChildren(-a,!1,-1/0),h=0),c._end>o&&c._ts&&(o=c._end),c=s;pl(l,l===Ut&&l._time>o?l._time:o,1,1),l._dirty=0}return l._tDur},e.updateRoot=function(r){if(Ut._ts&&(bb(Ut,Td(r,Ut)),db=pr.frame),pr.frame>=hy){hy+=_r.autoSleep||120;var s=Ut._first;if((!s||!s._ts)&&_r.autoSleep&&pr._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||pr.sleep()}}},e}(Wc);Lr(ji.prototype,{_lock:0,_hasPause:0,_forcing:0});var _a,xg,SA=function(i,e,t,r,s,a,n){var o,l,c,h,u,d,p,f,g=new tr(this._pt,i,e,0,1,Xb,null,s),m=0,v=0;for(g.b=t,g.e=r,t+="",(p=~(r+="").indexOf("random("))&&(r=jc(r)),a&&(a(f=[t,r],i,e),t=f[0],r=f[1]),l=t.match(Em)||[];o=Em.exec(r);)h=o[0],u=r.substring(m,o.index),c?c=(c+1)%5:u.substr(-5)==="rgba("&&(c=1),h!==l[v++]&&(d=parseFloat(l[v-1])||0,g._pt={_next:g._pt,p:u||v===1?u:",",s:d,c:h.charAt(1)==="="?Vo(d,h)-d:parseFloat(h)-d,m:c&&c<4?Math.round:0},m=Em.lastIndex);return g.c=m<r.length?r.substring(m,r.length):"",g.fp=n,(gb.test(r)||p)&&(g.e=0),this._pt=g,g},I0=function(i,e,t,r,s,a,n,o,l,c){Gt(r)&&(r=r(s||0,i,a));var h,u=i[e],d=t!=="get"?t:Gt(u)?l?i[e.indexOf("set")||!Gt(i["get"+e.substr(3)])?e:"get"+e.substr(3)](l):i[e]():u,p=Gt(u)?l?AA:jb:L0;if(xi(r)&&(~r.indexOf("random(")&&(r=jc(r)),r.charAt(1)==="="&&((h=Vo(d,r)+(Ni(d)||0))||h===0)&&(r=h)),!c||d!==r||xg)return isNaN(d*r)||r===""?SA.call(this,i,e,d,r,p,o||_r.stringFilter,l):(h=new tr(this._pt,i,e,+d||0,r-(d||0),typeof u=="boolean"?CA:Wb,0,p),l&&(h.fp=l),n&&h.modifier(n,this,i),this._pt=h)},Vb=function(i,e,t,r,s,a){var n,o,l,c;if(lr[i]&&(n=new lr[i]).init(s,n.rawVars?e[i]:function(h,u,d,p,f){if(Gt(h)&&(h=_c(h,f,u,d,p)),!bs(h)||h.style&&h.nodeType||Li(h)||mb(h))return xi(h)?_c(h,f,u,d,p):h;var g,m={};for(g in h)m[g]=_c(h[g],f,u,d,p);return m}(e[i],r,s,a,t),t,r,a)!==!1&&(t._pt=o=new tr(t._pt,s,i,0,1,n.render,n,0,n.priority),t!==Po))for(l=t._ptLookup[t._targets.indexOf(s)],c=n._props.length;c--;)l[n._props[c]]=o;return n},bg=function i(e,t,r){var s,a,n,o,l,c,h,u,d,p,f,g,m,v=e.vars,_=v.ease,y=v.startAt,x=v.immediateRender,b=v.lazy,M=v.onUpdate,T=v.runBackwards,E=v.yoyoEase,C=v.keyframes,N=v.autoRevert,D=e._dur,A=e._startAt,L=e._targets,w=e.parent,B=w&&w.data==="nested"?w.vars.targets:L,$=e._overwrite==="auto"&&!S0,K=e.timeline;if(K&&(!C||!_)&&(_="none"),e._ease=On(_,dl.ease),e._yEase=E?kb(On(E===!0?_:E,dl.ease)):0,E&&e._yoyo&&!e._repeat&&(E=e._yEase,e._yEase=e._ease,e._ease=E),e._from=!K&&!!v.runBackwards,!K||C&&!v.stagger){if(g=(u=L[0]?Nn(L[0]).harness:0)&&v[u.prop],s=Sd(v,C0),A&&(A._zTime<0&&A.progress(1),t<0&&T&&x&&!N?A.render(-1,!0):A.revert(T&&D?rd:pA),A._lazy=0),y){if(Fa(e._startAt=si.set(L,Lr({data:"isStart",overwrite:!1,parent:w,immediateRender:!0,lazy:!A&&er(b),startAt:null,delay:0,onUpdate:M&&function(){return cr(e,"onUpdate")},stagger:0},y))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Oi||!x&&!N)&&e._startAt.revert(rd),x&&D&&t<=0&&r<=0)return void(t&&(e._zTime=t))}else if(T&&D&&!A)if(t&&(x=!1),n=Lr({overwrite:!1,data:"isFromStart",lazy:x&&!A&&er(b),immediateRender:x,stagger:0,parent:w},s),g&&(n[u.prop]=g),Fa(e._startAt=si.set(L,n)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Oi?e._startAt.revert(rd):e._startAt.render(-1,!0)),e._zTime=t,x){if(!t)return}else i(e._startAt,Xi,Xi);for(e._pt=e._ptCache=0,b=D&&er(b)||b&&!D,a=0;a<L.length;a++){if(h=(l=L[a])._gsap||P0(L)[a]._gsap,e._ptLookup[a]=p={},fg[h.id]&&Ca.length&&wd(),f=B===L?a:B.indexOf(l),u&&(d=new u).init(l,g||s,e,f,B)!==!1&&(e._pt=o=new tr(e._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach(function(ae){p[ae]=o}),d.priority&&(c=1)),!u||g)for(n in s)lr[n]&&(d=Vb(n,s,e,f,l,B))?d.priority&&(c=1):p[n]=o=I0.call(e,l,n,"get",s[n],f,B,0,v.stringFilter);e._op&&e._op[a]&&e.kill(l,e._op[a]),$&&e._pt&&(_a=e,Ut.killTweensOf(l,p,e.globalTime(t)),m=!e.parent,_a=0),e._pt&&b&&(fg[h.id]=1)}c&&qb(e),e._onInit&&e._onInit(e)}e._onUpdate=M,e._initted=(!e._op||e._pt)&&!m,C&&t<=0&&K.render(Hs,!0,!0)},TA=function(i,e,t,r){var s,a,n=e.ease||r||"power1.inOut";if(Li(e))a=t[i]||(t[i]=[]),e.forEach(function(o,l){return a.push({t:l/(e.length-1)*100,v:o,e:n})});else for(s in e)a=t[s]||(t[s]=[]),s==="ease"||a.push({t:parseFloat(i),v:e[s],e:n})},_c=function(i,e,t,r,s){return Gt(i)?i.call(e,t,r,s):xi(i)&&~i.indexOf("random(")?jc(i):i},Hb=R0+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Gb={};$i(Hb+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return Gb[i]=1});var si=function(i){function e(r,s,a,n){var o;typeof s=="number"&&(a.duration=s,s=a,a=null);var l,c,h,u,d,p,f,g,m=(o=i.call(this,n?s:gc(s))||this).vars,v=m.duration,_=m.delay,y=m.immediateRender,x=m.stagger,b=m.overwrite,M=m.keyframes,T=m.defaults,E=m.scrollTrigger,C=m.yoyoEase,N=s.parent||Ut,D=(Li(r)||mb(r)?Ys(r[0]):"length"in s)?[r]:Cr(r);if(o._targets=D.length?P0(D):Hc(0,!_r.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=b,M||x||Su(v)||Su(_)){if(s=o.vars,(l=o.timeline=new ji({data:"nested",defaults:T||{},targets:N&&N.data==="nested"?N.vars.targets:D})).kill(),l.parent=l._dp=Ls(o),l._start=0,x||Su(v)||Su(_)){if(u=D.length,f=x&&Rb(x),bs(x))for(d in x)~Hb.indexOf(d)&&(g||(g={}),g[d]=x[d]);for(c=0;c<u;c++)(h=Sd(s,Gb)).stagger=0,C&&(h.yoyoEase=C),g&&qn(h,g),p=D[c],h.duration=+_c(v,Ls(o),c,p,D),h.delay=(+_c(_,Ls(o),c,p,D)||0)-o._delay,!x&&u===1&&h.delay&&(o._delay=_=h.delay,o._start+=_,h.delay=0),l.to(p,h,f?f(c,p,D):0),l._ease=ot.none;l.duration()?v=_=0:o.timeline=0}else if(M){gc(Lr(l.vars.defaults,{ease:"none"})),l._ease=On(M.ease||s.ease||"none");var A,L,w,B=0;if(Li(M))M.forEach(function($){return l.to(D,$,">")}),l.duration();else{for(d in h={},M)d==="ease"||d==="easeEach"||TA(d,M[d],h,M.easeEach);for(d in h)for(A=h[d].sort(function($,K){return $.t-K.t}),B=0,c=0;c<A.length;c++)(w={ease:(L=A[c]).e,duration:(L.t-(c?A[c-1].t:0))/100*v})[d]=L.v,l.to(D,w,B),B+=w.duration;l.duration()<v&&l.to({},{duration:v-l.duration()})}}v||o.duration(v=l.duration())}else o.timeline=0;return b!==!0||S0||(_a=Ls(o),Ut.killTweensOf(D),_a=0),us(N,Ls(o),a),s.reversed&&o.reverse(),s.paused&&o.paused(!0),(y||!v&&!M&&o._start===_i(N._time)&&er(y)&&gA(Ls(o))&&N.data!=="nested")&&(o._tTime=-1e-8,o.render(Math.max(0,-_)||0)),E&&Ab(Ls(o),E),o}hb(e,i);var t=e.prototype;return t.render=function(r,s,a){var n,o,l,c,h,u,d,p,f,g=this._time,m=this._tDur,v=this._dur,_=r<0,y=r>m-Xi&&!_?m:r<Xi?0:r;if(v){if(y!==this._tTime||!r||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==_){if(n=y,p=this.timeline,this._repeat){if(c=v+this._rDelay,this._repeat<-1&&_)return this.totalTime(100*c+r,s,a);if(n=_i(y%c),y===m?(l=this._repeat,n=v):((l=~~(y/c))&&l===_i(y/c)&&(n=v,l--),n>v&&(n=v)),(u=this._yoyo&&1&l)&&(f=this._yEase,n=v-n),h=Ho(this._tTime,c),n===g&&!a&&this._initted&&l===h)return this._tTime=y,this;l!==h&&(p&&this._yEase&&Fb(p,u),this.vars.repeatRefresh&&!u&&!this._lock&&this._time!==c&&this._initted&&(this._lock=a=1,this.render(_i(c*l),!0).invalidate()._lock=0))}if(!this._initted){if(py(this,_?r:n,a,s,y))return this._tTime=0,this;if(!(g===this._time||a&&this.vars.repeatRefresh&&l!==h))return this;if(v!==this._dur)return this.render(r,s,a)}if(this._tTime=y,this._time=n,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=d=(f||this._ease)(n/v),this._from&&(this.ratio=d=1-d),n&&!g&&!s&&!l&&(cr(this,"onStart"),this._tTime!==y))return this;for(o=this._pt;o;)o.r(d,o.d),o=o._next;p&&p.render(r<0?r:p._dur*p._ease(n/this._dur),s,a)||this._startAt&&(this._zTime=r),this._onUpdate&&!s&&(_&&Rm(this,r,0,a),cr(this,"onUpdate")),this._repeat&&l!==h&&this.vars.onRepeat&&!s&&this.parent&&cr(this,"onRepeat"),y!==this._tDur&&y||this._tTime!==y||(_&&!this._onUpdate&&Rm(this,r,0,!0),(r||!v)&&(y===this._tDur&&this._ts>0||!y&&this._ts<0)&&Fa(this,1),s||_&&!g||!(y||g||u)||(cr(this,y===m?"onComplete":"onReverseComplete",!0),this._prom&&!(y<m&&this.timeScale()>0)&&this._prom()))}}else(function(x,b,M,T){var E,C,N,D=x.ratio,A=b<0||!b&&(!x._start&&vA(x)&&(x._initted||!gg(x))||(x._ts<0||x._dp._ts<0)&&!gg(x))?0:1,L=x._rDelay,w=0;if(L&&x._repeat&&(w=yh(0,x._tDur,b),C=Ho(w,L),x._yoyo&&1&C&&(A=1-A),C!==Ho(x._tTime,L)&&(D=1-A,x.vars.repeatRefresh&&x._initted&&x.invalidate())),A!==D||Oi||T||x._zTime===Xi||!b&&x._zTime){if(!x._initted&&py(x,b,T,M,w))return;for(N=x._zTime,x._zTime=b||(M?Xi:0),M||(M=b&&!N),x.ratio=A,x._from&&(A=1-A),x._time=0,x._tTime=w,E=x._pt;E;)E.r(A,E.d),E=E._next;b<0&&Rm(x,b,0,!0),x._onUpdate&&!M&&cr(x,"onUpdate"),w&&x._repeat&&!M&&x.parent&&cr(x,"onRepeat"),(b>=x._tDur||b<0)&&x.ratio===A&&(A&&Fa(x,1),M||Oi||(cr(x,A?"onComplete":"onReverseComplete",!0),x._prom&&x._prom()))}else x._zTime||(x._zTime=b)})(this,r,s,a);return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),i.prototype.invalidate.call(this,r)},t.resetTo=function(r,s,a,n,o){Vc||pr.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||bg(this,l),function(c,h,u,d,p,f,g,m){var v,_,y,x,b=(c._pt&&c._ptCache||(c._ptCache={}))[h];if(!b)for(b=c._ptCache[h]=[],y=c._ptLookup,x=c._targets.length;x--;){if((v=y[x][h])&&v.d&&v.d._pt)for(v=v.d._pt;v&&v.p!==h&&v.fp!==h;)v=v._next;if(!v)return xg=1,c.vars[h]="+=0",bg(c,g),xg=0,m?Hc():1;b.push(v)}for(x=b.length;x--;)(v=(_=b[x])._pt||_).s=!d&&d!==0||p?v.s+(d||0)+f*v.c:d,v.c=u-v.s,_.e&&(_.e=Zt(u)+Ni(_.e)),_.b&&(_.b=v.s+Ni(_.b))}(this,r,s,a,n,this._ease(l/this._dur),l,o)?this.resetTo(r,s,a,n,1):(Tp(this,0),this.parent||Sb(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,s){if(s===void 0&&(s="all"),!(r||s&&s!=="all"))return this._lazy=this._pt=0,this.parent?rc(this):this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(r,s,_a&&_a.vars.overwrite!==!0)._first||rc(this),this.parent&&a!==this.timeline.totalDuration()&&pl(this,this._dur*this.timeline._tDur/a,0,1),this}var n,o,l,c,h,u,d,p=this._targets,f=r?Cr(r):p,g=this._ptLookup,m=this._pt;if((!s||s==="all")&&function(v,_){for(var y=v.length,x=y===_.length;x&&y--&&v[y]===_[y];);return y<0}(p,f))return s==="all"&&(this._pt=0),rc(this);for(n=this._op=this._op||[],s!=="all"&&(xi(s)&&(h={},$i(s,function(v){return h[v]=1}),s=h),s=function(v,_){var y,x,b,M,T=v[0]?Nn(v[0]).harness:0,E=T&&T.aliases;if(!E)return _;for(x in y=qn({},_),E)if(x in y)for(b=(M=E[x].split(",")).length;b--;)y[M[b]]=y[x];return y}(p,s)),d=p.length;d--;)if(~f.indexOf(p[d]))for(h in o=g[d],s==="all"?(n[d]=s,c=o,l={}):(l=n[d]=n[d]||{},c=s),c)(u=o&&o[h])&&("kill"in u.d&&u.d.kill(h)!==!0||wp(this,u,"_pt"),delete o[h]),l!=="all"&&(l[h]=1);return this._initted&&!this._pt&&m&&rc(this),this},e.to=function(r,s){return new e(r,s,arguments[2])},e.from=function(r,s){return vc(1,arguments)},e.delayedCall=function(r,s,a,n){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:s,onReverseComplete:s,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:n})},e.fromTo=function(r,s,a){return vc(2,arguments)},e.set=function(r,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(r,s)},e.killTweensOf=function(r,s,a){return Ut.killTweensOf(r,s,a)},e}(Wc);Lr(si.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),$i("staggerTo,staggerFrom,staggerFromTo",function(i){si[i]=function(){var e=new ji,t=vg.call(arguments,0);return t.splice(i==="staggerFromTo"?5:4,0,0),e[i].apply(e,t)}});var L0=function(i,e,t){return i[e]=t},jb=function(i,e,t){return i[e](t)},AA=function(i,e,t,r){return i[e](r.fp,t)},EA=function(i,e,t){return i.setAttribute(e,t)},N0=function(i,e){return Gt(i[e])?jb:A0(i[e])&&i.setAttribute?EA:L0},Wb=function(i,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*i))/1e6,e)},CA=function(i,e){return e.set(e.t,e.p,!!(e.s+e.c*i),e)},Xb=function(i,e){var t=e._pt,r="";if(!i&&e.b)r=e.b;else if(i===1&&e.e)r=e.e;else{for(;t;)r=t.p+(t.m?t.m(t.s+t.c*i):Math.round(1e4*(t.s+t.c*i))/1e4)+r,t=t._next;r+=e.c}e.set(e.t,e.p,r,e)},Mg=function(i,e){for(var t=e._pt;t;)t.r(i,t.d),t=t._next},RA=function(i,e,t,r){for(var s,a=this._pt;a;)s=a._next,a.p===r&&a.modifier(i,e,t),a=s},PA=function(i){for(var e,t,r=this._pt;r;)t=r._next,r.p===i&&!r.op||r.op===i?wp(this,r,"_pt"):r.dep||(e=1),r=t;return!e},IA=function(i,e,t,r){r.mSet(i,e,r.m.call(r.tween,t,r.mt),r)},qb=function(i){for(var e,t,r,s,a=i._pt;a;){for(e=a._next,t=r;t&&t.pr>a.pr;)t=t._next;(a._prev=t?t._prev:s)?a._prev._next=a:r=a,(a._next=t)?t._prev=a:s=a,a=e}i._pt=r},tr=function(){function i(e,t,r,s,a,n,o,l,c){this.t=t,this.s=s,this.c=a,this.p=r,this.r=n||Wb,this.d=o||this,this.set=l||L0,this.pr=c||0,this._next=e,e&&(e._prev=this)}return i.prototype.modifier=function(e,t,r){this.mSet=this.mSet||this.set,this.set=IA,this.m=e,this.mt=r,this.tween=t},i}();$i(R0+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return C0[i]=1}),fr.TweenMax=fr.TweenLite=si,fr.TimelineLite=fr.TimelineMax=ji,Ut=new ji({sortChildren:!1,defaults:dl,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),_r.stringFilter=Ub;var Un=[],ad={},LA=[],yy=0,NA=0,Nm=function(i){return(ad[i]||LA).map(function(e){return e()})},wg=function(){var i=Date.now(),e=[];i-yy>2&&(Nm("matchMediaInit"),Un.forEach(function(t){var r,s,a,n,o=t.queries,l=t.conditions;for(s in o)(r=cs.matchMedia(o[s]).matches)&&(a=1),r!==l[s]&&(l[s]=r,n=1);n&&(t.revert(),a&&e.push(t))}),Nm("matchMediaRevert"),e.forEach(function(t){return t.onMatch(t,function(r){return t.add(null,r)})}),yy=i,Nm("matchMedia"))},Yb=function(){function i(t,r){this.selector=r&&_g(r),this.data=[],this._r=[],this.isReverted=!1,this.id=NA++,t&&this.add(t)}var e=i.prototype;return e.add=function(t,r,s){Gt(t)&&(s=r,r=t,t=Gt);var a=this,n=function(){var o,l=Pt,c=a.selector;return l&&l!==a&&l.data.push(a),s&&(a.selector=_g(s)),Pt=a,o=r.apply(a,arguments),Gt(o)&&a._r.push(o),Pt=l,a.selector=c,a.isReverted=!1,o};return a.last=n,t===Gt?n(a,function(o){return a.add(null,o)}):t?a[t]=n:n},e.ignore=function(t){var r=Pt;Pt=null,t(this),Pt=r},e.getTweens=function(){var t=[];return this.data.forEach(function(r){return r instanceof i?t.push.apply(t,r.getTweens()):r instanceof si&&!(r.parent&&r.parent.data==="nested")&&t.push(r)}),t},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,r){var s=this;if(t?function(){for(var n,o=s.getTweens(),l=s.data.length;l--;)(n=s.data[l]).data==="isFlip"&&(n.revert(),n.getChildren(!0,!0,!1).forEach(function(c){return o.splice(o.indexOf(c),1)}));for(o.map(function(c){return{g:c._dur||c._delay||c._sat&&!c._sat.vars.immediateRender?c.globalTime(0):-1/0,t:c}}).sort(function(c,h){return h.g-c.g||-1/0}).forEach(function(c){return c.t.revert(t)}),l=s.data.length;l--;)(n=s.data[l])instanceof ji?n.data!=="nested"&&(n.scrollTrigger&&n.scrollTrigger.revert(),n.kill()):!(n instanceof si)&&n.revert&&n.revert(t);s._r.forEach(function(c){return c(t,s)}),s.isReverted=!0}():this.data.forEach(function(n){return n.kill&&n.kill()}),this.clear(),r)for(var a=Un.length;a--;)Un[a].id===this.id&&Un.splice(a,1)},e.revert=function(t){this.kill(t||{})},i}(),DA=function(){function i(t){this.contexts=[],this.scope=t,Pt&&Pt.data.push(this)}var e=i.prototype;return e.add=function(t,r,s){bs(t)||(t={matches:t});var a,n,o,l=new Yb(0,s||this.scope),c=l.conditions={};for(n in Pt&&!l.selector&&(l.selector=Pt.selector),this.contexts.push(l),r=l.add("onMatch",r),l.queries=t,t)n==="all"?o=1:(a=cs.matchMedia(t[n]))&&(Un.indexOf(l)<0&&Un.push(l),(c[n]=a.matches)&&(o=1),a.addListener?a.addListener(wg):a.addEventListener("change",wg));return o&&r(l,function(h){return l.add(null,h)}),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach(function(r){return r.kill(t,!0)})},i}(),Ad={registerPlugin:function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];e.forEach(function(r){return Nb(r)})},timeline:function(i){return new ji(i)},getTweensOf:function(i,e){return Ut.getTweensOf(i,e)},getProperty:function(i,e,t,r){xi(i)&&(i=Cr(i)[0]);var s=Nn(i||{}).get,a=t?wb:Mb;return t==="native"&&(t=""),i&&(e?a((lr[e]&&lr[e].get||s)(i,e,t,r)):function(n,o,l){return a((lr[n]&&lr[n].get||s)(i,n,o,l))})},quickSetter:function(i,e,t){if((i=Cr(i)).length>1){var r=i.map(function(c){return ir.quickSetter(c,e,t)}),s=r.length;return function(c){for(var h=s;h--;)r[h](c)}}i=i[0]||{};var a=lr[e],n=Nn(i),o=n.harness&&(n.harness.aliases||{})[e]||e,l=a?function(c){var h=new a;Po._pt=0,h.init(i,t?c+t:c,Po,0,[i]),h.render(1,h),Po._pt&&Mg(1,Po)}:n.set(i,o);return a?l:function(c){return l(i,o,t?c+t:c,n,1)}},quickTo:function(i,e,t){var r,s=ir.to(i,qn(((r={})[e]="+=0.1",r.paused=!0,r),t||{})),a=function(n,o,l){return s.resetTo(e,n,o,l)};return a.tween=s,a},isTweening:function(i){return Ut.getTweensOf(i,!0).length>0},defaults:function(i){return i&&i.ease&&(i.ease=On(i.ease,dl.ease)),uy(dl,i||{})},config:function(i){return uy(_r,i||{})},registerEffect:function(i){var e=i.name,t=i.effect,r=i.plugins,s=i.defaults,a=i.extendTimeline;(r||"").split(",").forEach(function(n){return n&&!lr[n]&&!fr[n]&&Hc()}),Cm[e]=function(n,o,l){return t(Cr(n),Lr(o||{},s),l)},a&&(ji.prototype[e]=function(n,o,l){return this.add(Cm[e](n,bs(o)?o:(l=o)&&{},this),l)})},registerEase:function(i,e){ot[i]=On(e)},parseEase:function(i,e){return arguments.length?On(i,e):ot},getById:function(i){return Ut.getById(i)},exportRoot:function(i,e){i===void 0&&(i={});var t,r,s=new ji(i);for(s.smoothChildTiming=er(i.smoothChildTiming),Ut.remove(s),s._dp=0,s._time=s._tTime=Ut._time,t=Ut._first;t;)r=t._next,!e&&!t._dur&&t instanceof si&&t.vars.onComplete===t._targets[0]||us(s,t,t._start-t._delay),t=r;return us(Ut,s,0),s},context:function(i,e){return i?new Yb(i,e):Pt},matchMedia:function(i){return new DA(i)},matchMediaRefresh:function(){return Un.forEach(function(i){var e,t,r=i.conditions;for(t in r)r[t]&&(r[t]=!1,e=1);e&&i.revert()})||wg()},addEventListener:function(i,e){var t=ad[i]||(ad[i]=[]);~t.indexOf(e)||t.push(e)},removeEventListener:function(i,e){var t=ad[i],r=t&&t.indexOf(e);r>=0&&t.splice(r,1)},utils:{wrap:function i(e,t,r){var s=t-e;return Li(e)?fy(e,i(0,e.length),t):va(r,function(a){return(s+(a-e)%s)%s+e})},wrapYoyo:function i(e,t,r){var s=t-e,a=2*s;return Li(e)?fy(e,i(0,e.length-1),t):va(r,function(n){return e+((n=(a+(n-e)%a)%a||0)>s?a-n:n)})},distribute:Rb,random:Ib,snap:Pb,normalize:function(i,e,t){return gy(i,e,0,1,t)},getUnit:Ni,clamp:function(i,e,t){return va(t,function(r){return yh(i,e,r)})},splitColor:Db,toArray:Cr,selector:_g,mapRange:gy,pipe:function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return function(r){return e.reduce(function(s,a){return a(s)},r)}},unitize:function(i,e){return function(t){return i(parseFloat(t))+(e||Ni(t))}},interpolate:function i(e,t,r,s){var a=isNaN(e+t)?0:function(p){return(1-p)*e+p*t};if(!a){var n,o,l,c,h,u=xi(e),d={};if(r===!0&&(s=1)&&(r=null),u)e={p:e},t={p:t};else if(Li(e)&&!Li(t)){for(l=[],c=e.length,h=c-2,o=1;o<c;o++)l.push(i(e[o-1],e[o]));c--,a=function(p){p*=c;var f=Math.min(h,~~p);return l[f](p-f)},r=t}else s||(e=qn(Li(e)?[]:{},e));if(!l){for(n in t)I0.call(d,e,n,"get",t[n]);a=function(p){return Mg(p,d)||(u?e.p:e)}}}return va(r,a)},shuffle:Cb},install:_b,effects:Cm,ticker:pr,updateRoot:ji.updateRoot,plugins:lr,globalTimeline:Ut,core:{PropTween:tr,globals:yb,Tween:si,Timeline:ji,Animation:Wc,getCache:Nn,_removeLinkedListItem:wp,reverting:function(){return Oi},context:function(i){return i&&Pt&&(Pt.data.push(i),i._ctx=Pt),Pt},suppressOverwrites:function(i){return S0=i}}};$i("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return Ad[i]=si[i]}),pr.add(ji.updateRoot),Po=Ad.to({},{duration:0});var OA=function(i,e){for(var t=i._pt;t&&t.p!==e&&t.op!==e&&t.fp!==e;)t=t._next;return t},Dm=function(i,e){return{name:i,rawVars:1,init:function(t,r,s){s._onInit=function(a){var n,o;if(xi(r)&&(n={},$i(r,function(l){return n[l]=1}),r=n),e){for(o in n={},r)n[o]=e(r[o]);r=n}(function(l,c){var h,u,d,p=l._targets;for(h in c)for(u=p.length;u--;)(d=l._ptLookup[u][h])&&(d=d.d)&&(d._pt&&(d=OA(d,h)),d&&d.modifier&&d.modifier(c[h],l,p[u],h))})(a,r)}}}},ir=Ad.registerPlugin({name:"attr",init:function(i,e,t,r,s){var a,n,o;for(a in this.tween=t,e)o=i.getAttribute(a)||"",(n=this.add(i,"setAttribute",(o||0)+"",e[a],r,s,0,0,a)).op=a,n.b=o,this._props.push(a)},render:function(i,e){for(var t=e._pt;t;)Oi?t.set(t.t,t.p,t.b,t):t.r(i,t.d),t=t._next}},{name:"endArray",init:function(i,e){for(var t=e.length;t--;)this.add(i,t,i[t]||0,e[t],0,0,0,0,0,1)}},Dm("roundProps",yg),Dm("modifiers"),Dm("snap",Pb))||Ad;si.version=ji.version=ir.version="3.12.5",ub=1,E0()&&ml(),ot.Power0,ot.Power1,ot.Power2,ot.Power3,ot.Power4,ot.Linear,ot.Quad,ot.Cubic,ot.Quart,ot.Quint,ot.Strong,ot.Elastic,ot.Back,ot.SteppedEase,ot.Bounce,ot.Sine,ot.Expo,ot.Circ;var xy,ya,Go,D0,Rn,by,O0,Zb,Zs={},_n=180/Math.PI,jo=Math.PI/180,bo=Math.atan2,U0=/([A-Z])/g,UA=/(left|right|width|margin|padding|x)/i,kA=/[\s,\(]\S/,ps={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Sg=function(i,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*i))/1e4+e.u,e)},FA=function(i,e){return e.set(e.t,e.p,i===1?e.e:Math.round(1e4*(e.s+e.c*i))/1e4+e.u,e)},BA=function(i,e){return e.set(e.t,e.p,i?Math.round(1e4*(e.s+e.c*i))/1e4+e.u:e.b,e)},zA=function(i,e){var t=e.s+e.c*i;e.set(e.t,e.p,~~(t+(t<0?-.5:.5))+e.u,e)},Kb=function(i,e){return e.set(e.t,e.p,i?e.e:e.b,e)},Qb=function(i,e){return e.set(e.t,e.p,i!==1?e.b:e.e,e)},VA=function(i,e,t){return i.style[e]=t},HA=function(i,e,t){return i.style.setProperty(e,t)},GA=function(i,e,t){return i._gsap[e]=t},jA=function(i,e,t){return i._gsap.scaleX=i._gsap.scaleY=t},WA=function(i,e,t,r,s){var a=i._gsap;a.scaleX=a.scaleY=t,a.renderTransform(s,a)},XA=function(i,e,t,r,s){var a=i._gsap;a[e]=t,a.renderTransform(s,a)},Ft="transform",rr=Ft+"Origin",qA=function i(e,t){var r=this,s=this.target,a=s.style,n=s._gsap;if(e in Zs&&a){if(this.tfm=this.tfm||{},e==="transform")return ps.transform.split(",").forEach(function(o){return i.call(r,o,t)});if(~(e=ps[e]||e).indexOf(",")?e.split(",").forEach(function(o){return r.tfm[o]=Ds(s,o)}):this.tfm[e]=n.x?n[e]:Ds(s,e),e===rr&&(this.tfm.zOrigin=n.zOrigin),this.props.indexOf(Ft)>=0)return;n.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(rr,t,"")),e=Ft}(a||t)&&this.props.push(e,t,a[e])},Jb=function(i){i.translate&&(i.removeProperty("translate"),i.removeProperty("scale"),i.removeProperty("rotate"))},YA=function(){var i,e,t=this.props,r=this.target,s=r.style,a=r._gsap;for(i=0;i<t.length;i+=3)t[i+1]?r[t[i]]=t[i+2]:t[i+2]?s[t[i]]=t[i+2]:s.removeProperty(t[i].substr(0,2)==="--"?t[i]:t[i].replace(U0,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)a[e]=this.tfm[e];a.svg&&(a.renderTransform(),r.setAttribute("data-svg-origin",this.svgo||"")),(i=O0())&&i.isStart||s[Ft]||(Jb(s),a.zOrigin&&s[rr]&&(s[rr]+=" "+a.zOrigin+"px",a.zOrigin=0,a.renderTransform()),a.uncache=1)}},$b=function(i,e){var t={target:i,props:[],revert:YA,save:qA};return i._gsap||ir.core.getCache(i),e&&e.split(",").forEach(function(r){return t.save(r)}),t},Tg=function(i,e){var t=ya.createElementNS?ya.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),i):ya.createElement(i);return t&&t.style?t:ya.createElement(i)},vs=function i(e,t,r){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace(U0,"-$1").toLowerCase())||s.getPropertyValue(t)||!r&&i(e,fl(t)||t,1)||""},My="O,Moz,ms,Ms,Webkit".split(","),fl=function(i,e,t){var r=(e||Rn).style,s=5;if(i in r&&!t)return i;for(i=i.charAt(0).toUpperCase()+i.substr(1);s--&&!(My[s]+i in r););return s<0?null:(s===3?"ms":s>=0?My[s]:"")+i},Ag=function(){typeof window<"u"&&window.document&&(xy=window,ya=xy.document,Go=ya.documentElement,Rn=Tg("div")||{style:{}},Tg("div"),Ft=fl(Ft),rr=Ft+"Origin",Rn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Zb=!!fl("perspective"),O0=ir.core.reverting,D0=1)},Om=function i(e){var t,r=Tg("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,a=this.nextSibling,n=this.style.cssText;if(Go.appendChild(r),r.appendChild(this),this.style.display="block",e)try{t=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=i}catch{}else this._gsapBBox&&(t=this._gsapBBox());return s&&(a?s.insertBefore(this,a):s.appendChild(this)),Go.removeChild(r),this.style.cssText=n,t},wy=function(i,e){for(var t=e.length;t--;)if(i.hasAttribute(e[t]))return i.getAttribute(e[t])},eM=function(i){var e;try{e=i.getBBox()}catch{e=Om.call(i,!0)}return e&&(e.width||e.height)||i.getBBox===Om||(e=Om.call(i,!0)),!e||e.width||e.x||e.y?e:{x:+wy(i,["x","cx","x1"])||0,y:+wy(i,["y","cy","y1"])||0,width:0,height:0}},tM=function(i){return!(!i.getCTM||i.parentNode&&!i.ownerSVGElement||!eM(i))},Yn=function(i,e){if(e){var t,r=i.style;e in Zs&&e!==rr&&(e=Ft),r.removeProperty?((t=e.substr(0,2))!=="ms"&&e.substr(0,6)!=="webkit"||(e="-"+e),r.removeProperty(t==="--"?e:e.replace(U0,"-$1").toLowerCase())):r.removeAttribute(e)}},xa=function(i,e,t,r,s,a){var n=new tr(i._pt,e,t,0,1,a?Qb:Kb);return i._pt=n,n.b=r,n.e=s,i._props.push(t),n},Sy={deg:1,rad:1,turn:1},ZA={grid:1,flex:1},Ba=function i(e,t,r,s){var a,n,o,l,c=parseFloat(r)||0,h=(r+"").trim().substr((c+"").length)||"px",u=Rn.style,d=UA.test(t),p=e.tagName.toLowerCase()==="svg",f=(p?"client":"offset")+(d?"Width":"Height"),g=100,m=s==="px",v=s==="%";if(s===h||!c||Sy[s]||Sy[h])return c;if(h!=="px"&&!m&&(c=i(e,t,r,"px")),l=e.getCTM&&tM(e),(v||h==="%")&&(Zs[t]||~t.indexOf("adius")))return a=l?e.getBBox()[d?"width":"height"]:e[f],Zt(v?c/a*g:c/100*a);if(u[d?"width":"height"]=g+(m?h:s),n=~t.indexOf("adius")||s==="em"&&e.appendChild&&!p?e:e.parentNode,l&&(n=(e.ownerSVGElement||{}).parentNode),n&&n!==ya&&n.appendChild||(n=ya.body),(o=n._gsap)&&v&&o.width&&d&&o.time===pr.time&&!o.uncache)return Zt(c/o.width*g);if(!v||t!=="height"&&t!=="width")(v||h==="%")&&!ZA[vs(n,"display")]&&(u.position=vs(e,"position")),n===e&&(u.position="static"),n.appendChild(Rn),a=Rn[f],n.removeChild(Rn),u.position="absolute";else{var _=e.style[t];e.style[t]=g+s,a=e[f],_?e.style[t]=_:Yn(e,t)}return d&&v&&((o=Nn(n)).time=pr.time,o.width=n[f]),Zt(m?a*c/g:a&&c?g/a*c:0)},Ds=function(i,e,t,r){var s;return D0||Ag(),e in ps&&e!=="transform"&&~(e=ps[e]).indexOf(",")&&(e=e.split(",")[0]),Zs[e]&&e!=="transform"?(s=qc(i,r),s=e!=="transformOrigin"?s[e]:s.svg?s.origin:Cd(vs(i,rr))+" "+s.zOrigin+"px"):(!(s=i.style[e])||s==="auto"||r||~(s+"").indexOf("calc("))&&(s=Ed[e]&&Ed[e](i,e,t)||vs(i,e)||xb(i,e)||(e==="opacity"?1:0)),t&&!~(s+"").trim().indexOf(" ")?Ba(i,e,s,t)+t:s},KA=function(i,e,t,r){if(!t||t==="none"){var s=fl(e,i,1),a=s&&vs(i,s,1);a&&a!==t?(e=s,t=a):e==="borderColor"&&(t=vs(i,"borderTopColor"))}var n,o,l,c,h,u,d,p,f,g,m,v=new tr(this._pt,i.style,e,0,1,Xb),_=0,y=0;if(v.b=t,v.e=r,t+="",(r+="")=="auto"&&(u=i.style[e],i.style[e]=r,r=vs(i,e)||r,u?i.style[e]=u:Yn(i,e)),Ub(n=[t,r]),r=n[1],l=(t=n[0]).match(Io)||[],(r.match(Io)||[]).length){for(;o=Io.exec(r);)d=o[0],f=r.substring(_,o.index),h?h=(h+1)%5:f.substr(-5)!=="rgba("&&f.substr(-5)!=="hsla("||(h=1),d!==(u=l[y++]||"")&&(c=parseFloat(u)||0,m=u.substr((c+"").length),d.charAt(1)==="="&&(d=Vo(c,d)+m),p=parseFloat(d),g=d.substr((p+"").length),_=Io.lastIndex-g.length,g||(g=g||_r.units[e]||m,_===r.length&&(r+=g,v.e+=g)),m!==g&&(c=Ba(i,e,u,g)||0),v._pt={_next:v._pt,p:f||y===1?f:",",s:c,c:p-c,m:h&&h<4||e==="zIndex"?Math.round:0});v.c=_<r.length?r.substring(_,r.length):""}else v.r=e==="display"&&r==="none"?Qb:Kb;return gb.test(r)&&(v.e=0),this._pt=v,v},Ty={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},QA=function(i){var e=i.split(" "),t=e[0],r=e[1]||"50%";return t!=="top"&&t!=="bottom"&&r!=="left"&&r!=="right"||(i=t,t=r,r=i),e[0]=Ty[t]||t,e[1]=Ty[r]||r,e.join(" ")},JA=function(i,e){if(e.tween&&e.tween._time===e.tween._dur){var t,r,s,a=e.t,n=a.style,o=e.u,l=a._gsap;if(o==="all"||o===!0)n.cssText="",r=1;else for(s=(o=o.split(",")).length;--s>-1;)t=o[s],Zs[t]&&(r=1,t=t==="transformOrigin"?rr:Ft),Yn(a,t);r&&(Yn(a,Ft),l&&(l.svg&&a.removeAttribute("transform"),qc(a,1),l.uncache=1,Jb(n)))}},Ed={clearProps:function(i,e,t,r,s){if(s.data!=="isFromStart"){var a=i._pt=new tr(i._pt,e,t,0,0,JA);return a.u=r,a.pr=-10,a.tween=s,i._props.push(t),1}}},Xc=[1,0,0,1,0,0],iM={},rM=function(i){return i==="matrix(1, 0, 0, 1, 0, 0)"||i==="none"||!i},Ay=function(i){var e=vs(i,Ft);return rM(e)?Xc:e.substr(7).match(fb).map(Zt)},k0=function(i,e){var t,r,s,a,n=i._gsap||Nn(i),o=i.style,l=Ay(i);return n.svg&&i.getAttribute("transform")?(l=[(s=i.transform.baseVal.consolidate().matrix).a,s.b,s.c,s.d,s.e,s.f]).join(",")==="1,0,0,1,0,0"?Xc:l:(l!==Xc||i.offsetParent||i===Go||n.svg||(s=o.display,o.display="block",(t=i.parentNode)&&i.offsetParent||(a=1,r=i.nextElementSibling,Go.appendChild(i)),l=Ay(i),s?o.display=s:Yn(i,"display"),a&&(r?t.insertBefore(i,r):t?t.appendChild(i):Go.removeChild(i))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},Eg=function(i,e,t,r,s,a){var n,o,l,c=i._gsap,h=s||k0(i,!0),u=c.xOrigin||0,d=c.yOrigin||0,p=c.xOffset||0,f=c.yOffset||0,g=h[0],m=h[1],v=h[2],_=h[3],y=h[4],x=h[5],b=e.split(" "),M=parseFloat(b[0])||0,T=parseFloat(b[1])||0;t?h!==Xc&&(o=g*_-m*v)&&(l=M*(-m/o)+T*(g/o)-(g*x-m*y)/o,M=M*(_/o)+T*(-v/o)+(v*x-_*y)/o,T=l):(M=(n=eM(i)).x+(~b[0].indexOf("%")?M/100*n.width:M),T=n.y+(~(b[1]||b[0]).indexOf("%")?T/100*n.height:T)),r||r!==!1&&c.smooth?(y=M-u,x=T-d,c.xOffset=p+(y*g+x*v)-y,c.yOffset=f+(y*m+x*_)-x):c.xOffset=c.yOffset=0,c.xOrigin=M,c.yOrigin=T,c.smooth=!!r,c.origin=e,c.originIsAbsolute=!!t,i.style[rr]="0px 0px",a&&(xa(a,c,"xOrigin",u,M),xa(a,c,"yOrigin",d,T),xa(a,c,"xOffset",p,c.xOffset),xa(a,c,"yOffset",f,c.yOffset)),i.setAttribute("data-svg-origin",M+" "+T)},qc=function(i,e){var t=i._gsap||new zb(i);if("x"in t&&!e&&!t.uncache)return t;var r,s,a,n,o,l,c,h,u,d,p,f,g,m,v,_,y,x,b,M,T,E,C,N,D,A,L,w,B,$,K,ae,se=i.style,me=t.scaleX<0,H="px",W="deg",ce=getComputedStyle(i),te=vs(i,rr)||"0";return r=s=a=l=c=h=u=d=p=0,n=o=1,t.svg=!(!i.getCTM||!tM(i)),ce.translate&&(ce.translate==="none"&&ce.scale==="none"&&ce.rotate==="none"||(se[Ft]=(ce.translate!=="none"?"translate3d("+(ce.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(ce.rotate!=="none"?"rotate("+ce.rotate+") ":"")+(ce.scale!=="none"?"scale("+ce.scale.split(" ").join(",")+") ":"")+(ce[Ft]!=="none"?ce[Ft]:"")),se.scale=se.rotate=se.translate="none"),m=k0(i,t.svg),t.svg&&(t.uncache?(D=i.getBBox(),te=t.xOrigin-D.x+"px "+(t.yOrigin-D.y)+"px",N=""):N=!e&&i.getAttribute("data-svg-origin"),Eg(i,N||te,!!N||t.originIsAbsolute,t.smooth!==!1,m)),f=t.xOrigin||0,g=t.yOrigin||0,m!==Xc&&(x=m[0],b=m[1],M=m[2],T=m[3],r=E=m[4],s=C=m[5],m.length===6?(n=Math.sqrt(x*x+b*b),o=Math.sqrt(T*T+M*M),l=x||b?bo(b,x)*_n:0,(u=M||T?bo(M,T)*_n+l:0)&&(o*=Math.abs(Math.cos(u*jo))),t.svg&&(r-=f-(f*x+g*M),s-=g-(f*b+g*T))):(ae=m[6],$=m[7],L=m[8],w=m[9],B=m[10],K=m[11],r=m[12],s=m[13],a=m[14],c=(v=bo(ae,B))*_n,v&&(N=E*(_=Math.cos(-v))+L*(y=Math.sin(-v)),D=C*_+w*y,A=ae*_+B*y,L=E*-y+L*_,w=C*-y+w*_,B=ae*-y+B*_,K=$*-y+K*_,E=N,C=D,ae=A),h=(v=bo(-M,B))*_n,v&&(_=Math.cos(-v),K=T*(y=Math.sin(-v))+K*_,x=N=x*_-L*y,b=D=b*_-w*y,M=A=M*_-B*y),l=(v=bo(b,x))*_n,v&&(N=x*(_=Math.cos(v))+b*(y=Math.sin(v)),D=E*_+C*y,b=b*_-x*y,C=C*_-E*y,x=N,E=D),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,h=180-h),n=Zt(Math.sqrt(x*x+b*b+M*M)),o=Zt(Math.sqrt(C*C+ae*ae)),v=bo(E,C),u=Math.abs(v)>2e-4?v*_n:0,p=K?1/(K<0?-K:K):0),t.svg&&(N=i.getAttribute("transform"),t.forceCSS=i.setAttribute("transform","")||!rM(vs(i,Ft)),N&&i.setAttribute("transform",N))),Math.abs(u)>90&&Math.abs(u)<270&&(me?(n*=-1,u+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,u+=u<=0?180:-180)),e=e||t.uncache,t.x=r-((t.xPercent=r&&(!e&&t.xPercent||(Math.round(i.offsetWidth/2)===Math.round(-r)?-50:0)))?i.offsetWidth*t.xPercent/100:0)+H,t.y=s-((t.yPercent=s&&(!e&&t.yPercent||(Math.round(i.offsetHeight/2)===Math.round(-s)?-50:0)))?i.offsetHeight*t.yPercent/100:0)+H,t.z=a+H,t.scaleX=Zt(n),t.scaleY=Zt(o),t.rotation=Zt(l)+W,t.rotationX=Zt(c)+W,t.rotationY=Zt(h)+W,t.skewX=u+W,t.skewY=d+W,t.transformPerspective=p+H,(t.zOrigin=parseFloat(te.split(" ")[2])||!e&&t.zOrigin||0)&&(se[rr]=Cd(te)),t.xOffset=t.yOffset=0,t.force3D=_r.force3D,t.renderTransform=t.svg?eE:Zb?sM:$A,t.uncache=0,t},Cd=function(i){return(i=i.split(" "))[0]+" "+i[1]},Um=function(i,e,t){var r=Ni(e);return Zt(parseFloat(e)+parseFloat(Ba(i,"x",t+"px",r)))+r},$A=function(i,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,sM(i,e)},cn="0deg",Vl="0px",hn=") ",sM=function(i,e){var t=e||this,r=t.xPercent,s=t.yPercent,a=t.x,n=t.y,o=t.z,l=t.rotation,c=t.rotationY,h=t.rotationX,u=t.skewX,d=t.skewY,p=t.scaleX,f=t.scaleY,g=t.transformPerspective,m=t.force3D,v=t.target,_=t.zOrigin,y="",x=m==="auto"&&i&&i!==1||m===!0;if(_&&(h!==cn||c!==cn)){var b,M=parseFloat(c)*jo,T=Math.sin(M),E=Math.cos(M);M=parseFloat(h)*jo,b=Math.cos(M),a=Um(v,a,T*b*-_),n=Um(v,n,-Math.sin(M)*-_),o=Um(v,o,E*b*-_+_)}g!==Vl&&(y+="perspective("+g+hn),(r||s)&&(y+="translate("+r+"%, "+s+"%) "),(x||a!==Vl||n!==Vl||o!==Vl)&&(y+=o!==Vl||x?"translate3d("+a+", "+n+", "+o+") ":"translate("+a+", "+n+hn),l!==cn&&(y+="rotate("+l+hn),c!==cn&&(y+="rotateY("+c+hn),h!==cn&&(y+="rotateX("+h+hn),u===cn&&d===cn||(y+="skew("+u+", "+d+hn),p===1&&f===1||(y+="scale("+p+", "+f+hn),v.style[Ft]=y||"translate(0, 0)"},eE=function(i,e){var t,r,s,a,n,o=e||this,l=o.xPercent,c=o.yPercent,h=o.x,u=o.y,d=o.rotation,p=o.skewX,f=o.skewY,g=o.scaleX,m=o.scaleY,v=o.target,_=o.xOrigin,y=o.yOrigin,x=o.xOffset,b=o.yOffset,M=o.forceCSS,T=parseFloat(h),E=parseFloat(u);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=jo,p*=jo,t=Math.cos(d)*g,r=Math.sin(d)*g,s=Math.sin(d-p)*-m,a=Math.cos(d-p)*m,p&&(f*=jo,n=Math.tan(p-f),s*=n=Math.sqrt(1+n*n),a*=n,f&&(n=Math.tan(f),t*=n=Math.sqrt(1+n*n),r*=n)),t=Zt(t),r=Zt(r),s=Zt(s),a=Zt(a)):(t=g,a=m,r=s=0),(T&&!~(h+"").indexOf("px")||E&&!~(u+"").indexOf("px"))&&(T=Ba(v,"x",h,"px"),E=Ba(v,"y",u,"px")),(_||y||x||b)&&(T=Zt(T+_-(_*t+y*s)+x),E=Zt(E+y-(_*r+y*a)+b)),(l||c)&&(n=v.getBBox(),T=Zt(T+l/100*n.width),E=Zt(E+c/100*n.height)),n="matrix("+t+","+r+","+s+","+a+","+T+","+E+")",v.setAttribute("transform",n),M&&(v.style[Ft]=n)},tE=function(i,e,t,r,s){var a,n,o=360,l=xi(s),c=parseFloat(s)*(l&&~s.indexOf("rad")?_n:1)-r,h=r+c+"deg";return l&&((a=s.split("_")[1])==="short"&&(c%=o)!==c%180&&(c+=c<0?o:-360),a==="cw"&&c<0?c=(c+36e9)%o-~~(c/o)*o:a==="ccw"&&c>0&&(c=(c-36e9)%o-~~(c/o)*o)),i._pt=n=new tr(i._pt,e,t,r,c,FA),n.e=h,n.u="deg",i._props.push(t),n},Ey=function(i,e){for(var t in e)i[t]=e[t];return i},iE=function(i,e,t){var r,s,a,n,o,l,c,h=Ey({},t._gsap),u=t.style;for(s in h.svg?(a=t.getAttribute("transform"),t.setAttribute("transform",""),u[Ft]=e,r=qc(t,1),Yn(t,Ft),t.setAttribute("transform",a)):(a=getComputedStyle(t)[Ft],u[Ft]=e,r=qc(t,1),u[Ft]=a),Zs)(a=h[s])!==(n=r[s])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(s)<0&&(o=Ni(a)!==(c=Ni(n))?Ba(t,s,a,c):parseFloat(a),l=parseFloat(n),i._pt=new tr(i._pt,r,s,o,l-o,Sg),i._pt.u=c||0,i._props.push(s));Ey(r,h)};$i("padding,margin,Width,Radius",function(i,e){var t="Top",r="Right",s="Bottom",a="Left",n=(e<3?[t,r,s,a]:[t+a,t+r,s+r,s+a]).map(function(o){return e<2?i+o:"border"+o+i});Ed[e>1?"border"+i:i]=function(o,l,c,h,u){var d,p;if(arguments.length<4)return d=n.map(function(f){return Ds(o,f,c)}),(p=d.join(" ")).split(d[0]).length===5?d[0]:p;d=(h+"").split(" "),p={},n.forEach(function(f,g){return p[f]=d[g]=d[g]||d[(g-1)/2|0]}),o.init(l,p,u)}});var Cy,km,Fm,aM={name:"css",register:Ag,targetTest:function(i){return i.style&&i.nodeType},init:function(i,e,t,r,s){var a,n,o,l,c,h,u,d,p,f,g,m,v,_,y,x,b=this._props,M=i.style,T=t.vars.startAt;for(u in D0||Ag(),this.styles=this.styles||$b(i),x=this.styles.props,this.tween=t,e)if(u!=="autoRound"&&(n=e[u],!lr[u]||!Vb(u,e,t,r,i,s))){if(c=typeof n,h=Ed[u],c==="function"&&(c=typeof(n=n.call(t,r,i,s))),c==="string"&&~n.indexOf("random(")&&(n=jc(n)),h)h(this,i,u,n,t)&&(y=1);else if(u.substr(0,2)==="--")a=(getComputedStyle(i).getPropertyValue(u)+"").trim(),n+="",Ra.lastIndex=0,Ra.test(a)||(d=Ni(a),p=Ni(n)),p?d!==p&&(a=Ba(i,u,a,p)+p):d&&(n+=d),this.add(M,"setProperty",a,n,r,s,0,0,u),b.push(u),x.push(u,0,M[u]);else if(c!=="undefined"){if(T&&u in T?(a=typeof T[u]=="function"?T[u].call(t,r,i,s):T[u],xi(a)&&~a.indexOf("random(")&&(a=jc(a)),Ni(a+"")||a==="auto"||(a+=_r.units[u]||Ni(Ds(i,u))||""),(a+"").charAt(1)==="="&&(a=Ds(i,u))):a=Ds(i,u),l=parseFloat(a),(f=c==="string"&&n.charAt(1)==="="&&n.substr(0,2))&&(n=n.substr(2)),o=parseFloat(n),u in ps&&(u==="autoAlpha"&&(l===1&&Ds(i,"visibility")==="hidden"&&o&&(l=0),x.push("visibility",0,M.visibility),xa(this,M,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),u!=="scale"&&u!=="transform"&&~(u=ps[u]).indexOf(",")&&(u=u.split(",")[0])),g=u in Zs)if(this.styles.save(u),m||((v=i._gsap).renderTransform&&!e.parseTransform||qc(i,e.parseTransform),_=e.smoothOrigin!==!1&&v.smooth,(m=this._pt=new tr(this._pt,M,Ft,0,1,v.renderTransform,v,0,-1)).dep=1),u==="scale")this._pt=new tr(this._pt,v,"scaleY",v.scaleY,(f?Vo(v.scaleY,f+o):o)-v.scaleY||0,Sg),this._pt.u=0,b.push("scaleY",u),u+="X";else{if(u==="transformOrigin"){x.push(rr,0,M[rr]),n=QA(n),v.svg?Eg(i,n,0,_,0,this):((p=parseFloat(n.split(" ")[2])||0)!==v.zOrigin&&xa(this,v,"zOrigin",v.zOrigin,p),xa(this,M,u,Cd(a),Cd(n)));continue}if(u==="svgOrigin"){Eg(i,n,1,_,0,this);continue}if(u in iM){tE(this,v,u,l,f?Vo(l,f+n):n);continue}if(u==="smoothOrigin"){xa(this,v,"smooth",v.smooth,n);continue}if(u==="force3D"){v[u]=n;continue}if(u==="transform"){iE(this,n,i);continue}}else u in M||(u=fl(u)||u);if(g||(o||o===0)&&(l||l===0)&&!kA.test(n)&&u in M)o||(o=0),(d=(a+"").substr((l+"").length))!==(p=Ni(n)||(u in _r.units?_r.units[u]:d))&&(l=Ba(i,u,a,p)),this._pt=new tr(this._pt,g?v:M,u,l,(f?Vo(l,f+o):o)-l,g||p!=="px"&&u!=="zIndex"||e.autoRound===!1?Sg:zA),this._pt.u=p||0,d!==p&&p!=="%"&&(this._pt.b=a,this._pt.r=BA);else if(u in M)KA.call(this,i,u,a,f?f+n:n);else if(u in i)this.add(i,u,a||i[u],f?f+n:n,r,s);else if(u!=="parseTransform")continue;g||(u in M?x.push(u,0,M[u]):x.push(u,1,a||i[u])),b.push(u)}}y&&qb(this)},render:function(i,e){if(e.tween._time||!O0())for(var t=e._pt;t;)t.r(i,t.d),t=t._next;else e.styles.revert()},get:Ds,aliases:ps,getSetter:function(i,e,t){var r=ps[e];return r&&r.indexOf(",")<0&&(e=r),e in Zs&&e!==rr&&(i._gsap.x||Ds(i,"x"))?t&&by===t?e==="scale"?jA:GA:(by=t||{})&&(e==="scale"?WA:XA):i.style&&!A0(i.style[e])?VA:~e.indexOf("-")?HA:N0(i,e)},core:{_removeProperty:Yn,_getMatrix:k0}};ir.utils.checkPrefix=fl,ir.core.getStyleSaver=$b,Fm=$i((Cy="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(km="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(i){Zs[i]=1}),$i(km,function(i){_r.units[i]="deg",iM[i]=1}),ps[Fm[13]]=Cy+","+km,$i("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(i){var e=i.split(":");ps[e[1]]=Fm[e[0]]}),$i("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){_r.units[i]="px"}),ir.registerPlugin(aM);var F0=ir.registerPlugin(aM)||ir;function Lo(i,e){var t=i.__state.conversionName.toString(),r=Math.round(i.r),s=Math.round(i.g),a=Math.round(i.b),n=i.a,o=Math.round(i.h),l=i.s.toFixed(1),c=i.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var h=i.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}return t==="CSS_RGB"?"rgb("+r+","+s+","+a+")":t==="CSS_RGBA"?"rgba("+r+","+s+","+a+","+n+")":t==="HEX"?"0x"+i.hex.toString(16):t==="RGB_ARRAY"?"["+r+","+s+","+a+"]":t==="RGBA_ARRAY"?"["+r+","+s+","+a+","+n+"]":t==="RGB_OBJ"?"{r:"+r+",g:"+s+",b:"+a+"}":t==="RGBA_OBJ"?"{r:"+r+",g:"+s+",b:"+a+",a:"+n+"}":t==="HSV_OBJ"?"{h:"+o+",s:"+l+",v:"+c+"}":t==="HSVA_OBJ"?"{h:"+o+",s:"+l+",v:"+c+",a:"+n+"}":"unknown format"}F0.core.Tween;var Ry=Array.prototype.forEach,Hl=Array.prototype.slice,ve={BREAK:{},extend:function(i){return this.each(Hl.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach((function(t){this.isUndefined(e[t])||(i[t]=e[t])}).bind(this))},this),i},defaults:function(i){return this.each(Hl.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach((function(t){this.isUndefined(i[t])&&(i[t]=e[t])}).bind(this))},this),i},compose:function(){var i=Hl.call(arguments);return function(){for(var e=Hl.call(arguments),t=i.length-1;t>=0;t--)e=[i[t].apply(this,e)];return e[0]}},each:function(i,e,t){if(i){if(Ry&&i.forEach&&i.forEach===Ry)i.forEach(e,t);else if(i.length===i.length+0){var r,s=void 0;for(s=0,r=i.length;s<r;s++)if(s in i&&e.call(t,i[s],s)===this.BREAK)return}else for(var a in i)if(e.call(t,i[a],a)===this.BREAK)return}},defer:function(i){setTimeout(i,0)},debounce:function(i,e,t){var r=void 0;return function(){var s=this,a=arguments,n=t||!r;clearTimeout(r),r=setTimeout(function(){r=null,t||i.apply(s,a)},e),n&&i.apply(s,a)}},toArray:function(i){return i.toArray?i.toArray():Hl.call(i)},isUndefined:function(i){return i===void 0},isNull:function(i){return i===null},isNaN:function(i){function e(t){return i.apply(this,arguments)}return e.toString=function(){return i.toString()},e}(function(i){return isNaN(i)}),isArray:Array.isArray||function(i){return i.constructor===Array},isObject:function(i){return i===Object(i)},isNumber:function(i){return i===i+0},isString:function(i){return i===i+""},isBoolean:function(i){return i===!1||i===!0},isFunction:function(i){return i instanceof Function}},rE=[{litmus:ve.isString,conversions:{THREE_CHAR_HEX:{read:function(i){var e=i.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return e!==null&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:Lo},SIX_CHAR_HEX:{read:function(i){var e=i.match(/^#([A-F0-9]{6})$/i);return e!==null&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:Lo},CSS_RGB:{read:function(i){var e=i.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e!==null&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:Lo},CSS_RGBA:{read:function(i){var e=i.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e!==null&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:Lo}}},{litmus:ve.isNumber,conversions:{HEX:{read:function(i){return{space:"HEX",hex:i,conversionName:"HEX"}},write:function(i){return i.hex}}}},{litmus:ve.isArray,conversions:{RGB_ARRAY:{read:function(i){return i.length===3&&{space:"RGB",r:i[0],g:i[1],b:i[2]}},write:function(i){return[i.r,i.g,i.b]}},RGBA_ARRAY:{read:function(i){return i.length===4&&{space:"RGB",r:i[0],g:i[1],b:i[2],a:i[3]}},write:function(i){return[i.r,i.g,i.b,i.a]}}}},{litmus:ve.isObject,conversions:{RGBA_OBJ:{read:function(i){return!!(ve.isNumber(i.r)&&ve.isNumber(i.g)&&ve.isNumber(i.b)&&ve.isNumber(i.a))&&{space:"RGB",r:i.r,g:i.g,b:i.b,a:i.a}},write:function(i){return{r:i.r,g:i.g,b:i.b,a:i.a}}},RGB_OBJ:{read:function(i){return!!(ve.isNumber(i.r)&&ve.isNumber(i.g)&&ve.isNumber(i.b))&&{space:"RGB",r:i.r,g:i.g,b:i.b}},write:function(i){return{r:i.r,g:i.g,b:i.b}}},HSVA_OBJ:{read:function(i){return!!(ve.isNumber(i.h)&&ve.isNumber(i.s)&&ve.isNumber(i.v)&&ve.isNumber(i.a))&&{space:"HSV",h:i.h,s:i.s,v:i.v,a:i.a}},write:function(i){return{h:i.h,s:i.s,v:i.v,a:i.a}}},HSV_OBJ:{read:function(i){return!!(ve.isNumber(i.h)&&ve.isNumber(i.s)&&ve.isNumber(i.v))&&{space:"HSV",h:i.h,s:i.s,v:i.v}},write:function(i){return{h:i.h,s:i.s,v:i.v}}}}}],Gl=void 0,Tu=void 0,Rd=function(){Tu=!1;var i=arguments.length>1?ve.toArray(arguments):arguments[0];return ve.each(rE,function(e){if(e.litmus(i))return ve.each(e.conversions,function(t,r){if(Gl=t.read(i),Tu===!1&&Gl!==!1)return Tu=Gl,Gl.conversionName=r,Gl.conversion=t,ve.BREAK}),ve.BREAK}),Tu},Py=void 0,ac={hsv_to_rgb:function(i,e,t){var r=Math.floor(i/60)%6,s=i/60-Math.floor(i/60),a=t*(1-e),n=t*(1-s*e),o=t*(1-(1-s)*e),l=[[t,o,a],[n,t,a],[a,t,o],[a,n,t],[o,a,t],[t,a,n]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(i,e,t){var r=Math.min(i,e,t),s=Math.max(i,e,t),a=s-r,n=void 0;return s===0?{h:NaN,s:0,v:0}:(n=i===s?(e-t)/a:e===s?2+(t-i)/a:4+(i-e)/a,(n/=6)<0&&(n+=1),{h:360*n,s:a/s,v:s/255})},rgb_to_hex:function(i,e,t){var r=this.hex_with_component(0,2,i);return r=this.hex_with_component(r,1,e),r=this.hex_with_component(r,0,t)},component_from_hex:function(i,e){return i>>8*e&255},hex_with_component:function(i,e,t){return t<<(Py=8*e)|i&~(255<<Py)}},sE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Kr=function(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")},Qr=function(){function i(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),za=function i(e,t,r){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,t);if(s===void 0){var a=Object.getPrototypeOf(e);return a===null?void 0:i(a,t,r)}if("value"in s)return s.value;var n=s.get;return n===void 0?void 0:n.call(r)},Ga=function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(i,e):i.__proto__=e)},ja=function(i,e){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||typeof e!="object"&&typeof e!="function"?i:e},hi=function(){function i(){if(Kr(this,i),this.__state=Rd.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Qr(i,[{key:"toString",value:function(){return Lo(this)}},{key:"toHexString",value:function(){return Lo(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),i}();function Bm(i,e,t){Object.defineProperty(i,e,{get:function(){return this.__state.space==="RGB"||hi.recalculateRGB(this,e,t),this.__state[e]},set:function(r){this.__state.space!=="RGB"&&(hi.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=r}})}function zm(i,e){Object.defineProperty(i,e,{get:function(){return this.__state.space==="HSV"||hi.recalculateHSV(this),this.__state[e]},set:function(t){this.__state.space!=="HSV"&&(hi.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}hi.recalculateRGB=function(i,e,t){if(i.__state.space==="HEX")i.__state[e]=ac.component_from_hex(i.__state.hex,t);else{if(i.__state.space!=="HSV")throw new Error("Corrupted color state");ve.extend(i.__state,ac.hsv_to_rgb(i.__state.h,i.__state.s,i.__state.v))}},hi.recalculateHSV=function(i){var e=ac.rgb_to_hsv(i.r,i.g,i.b);ve.extend(i.__state,{s:e.s,v:e.v}),ve.isNaN(e.h)?ve.isUndefined(i.__state.h)&&(i.__state.h=0):i.__state.h=e.h},hi.COMPONENTS=["r","g","b","h","s","v","hex","a"],Bm(hi.prototype,"r",2),Bm(hi.prototype,"g",1),Bm(hi.prototype,"b",0),zm(hi.prototype,"h"),zm(hi.prototype,"s"),zm(hi.prototype,"v"),Object.defineProperty(hi.prototype,"a",{get:function(){return this.__state.a},set:function(i){this.__state.a=i}}),Object.defineProperty(hi.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=ac.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(i){this.__state.space="HEX",this.__state.hex=i}});var Wa=function(){function i(e,t){Kr(this,i),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return Qr(i,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),i}(),nM={};ve.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(i,e){ve.each(i,function(t){nM[t]=e})});var aE=/(\d+(\.\d+)?)px/;function es(i){if(i==="0"||ve.isUndefined(i))return 0;var e=i.match(aE);return ve.isNull(e)?0:parseFloat(e[1])}var he={makeSelectable:function(i,e){i!==void 0&&i.style!==void 0&&(i.onselectstart=e?function(){return!1}:function(){},i.style.MozUserSelect=e?"auto":"none",i.style.KhtmlUserSelect=e?"auto":"none",i.unselectable=e?"on":"off")},makeFullscreen:function(i,e,t){var r=t,s=e;ve.isUndefined(s)&&(s=!0),ve.isUndefined(r)&&(r=!0),i.style.position="absolute",s&&(i.style.left=0,i.style.right=0),r&&(i.style.top=0,i.style.bottom=0)},fakeEvent:function(i,e,t,r){var s=t||{},a=nM[e];if(!a)throw new Error("Event type "+e+" not supported.");var n=document.createEvent(a);switch(a){case"MouseEvents":var o=s.x||s.clientX||0,l=s.y||s.clientY||0;n.initMouseEvent(e,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,o,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=n.initKeyboardEvent||n.initKeyEvent;ve.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break;default:n.initEvent(e,s.bubbles||!1,s.cancelable||!0)}ve.defaults(n,r),i.dispatchEvent(n)},bind:function(i,e,t,r){var s=r||!1;return i.addEventListener?i.addEventListener(e,t,s):i.attachEvent&&i.attachEvent("on"+e,t),he},unbind:function(i,e,t,r){var s=r||!1;return i.removeEventListener?i.removeEventListener(e,t,s):i.detachEvent&&i.detachEvent("on"+e,t),he},addClass:function(i,e){if(i.className===void 0)i.className=e;else if(i.className!==e){var t=i.className.split(/ +/);t.indexOf(e)===-1&&(t.push(e),i.className=t.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return he},removeClass:function(i,e){if(e)if(i.className===e)i.removeAttribute("class");else{var t=i.className.split(/ +/),r=t.indexOf(e);r!==-1&&(t.splice(r,1),i.className=t.join(" "))}else i.className=void 0;return he},hasClass:function(i,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(i.className)||!1},getWidth:function(i){var e=getComputedStyle(i);return es(e["border-left-width"])+es(e["border-right-width"])+es(e["padding-left"])+es(e["padding-right"])+es(e.width)},getHeight:function(i){var e=getComputedStyle(i);return es(e["border-top-width"])+es(e["border-bottom-width"])+es(e["padding-top"])+es(e["padding-bottom"])+es(e.height)},getOffset:function(i){var e=i,t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.offsetParent;while(e);return t},isActive:function(i){return i===document.activeElement&&(i.type||i.href)}},B0=function(i){function e(t,r){Kr(this,e);var s=ja(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),a=s;return s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox"),he.bind(s.__checkbox,"change",function(){a.setValue(!a.__prev)},!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return Ga(e,Wa),Qr(e,[{key:"setValue",value:function(t){var r=za(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),za(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),oM=function(i){function e(t,r,s){Kr(this,e);var a=ja(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),n=s,o=a;if(a.__select=document.createElement("select"),ve.isArray(n)){var l={};ve.each(n,function(c){l[c]=c}),n=l}return ve.each(n,function(c,h){var u=document.createElement("option");u.innerHTML=h,u.setAttribute("value",c),o.__select.appendChild(u)}),a.updateDisplay(),he.bind(a.__select,"change",function(){var c=this.options[this.selectedIndex].value;o.setValue(c)}),a.domElement.appendChild(a.__select),a}return Ga(e,Wa),Qr(e,[{key:"setValue",value:function(t){var r=za(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return he.isActive(this.__select)?this:(this.__select.value=this.getValue(),za(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),lM=function(i){function e(t,r){Kr(this,e);var s=ja(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),a=s;function n(){a.setValue(a.__input.value)}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),he.bind(s.__input,"keyup",n),he.bind(s.__input,"change",n),he.bind(s.__input,"blur",function(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}),he.bind(s.__input,"keydown",function(o){o.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return Ga(e,Wa),Qr(e,[{key:"updateDisplay",value:function(){return he.isActive(this.__input)||(this.__input.value=this.getValue()),za(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function Iy(i){var e=i.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var z0=function(i){function e(t,r,s){Kr(this,e);var a=ja(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),n=s||{};return a.__min=n.min,a.__max=n.max,a.__step=n.step,ve.isUndefined(a.__step)?a.initialValue===0?a.__impliedStep=1:a.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(a.initialValue))/Math.LN10))/10:a.__impliedStep=a.__step,a.__precision=Iy(a.__impliedStep),a}return Ga(e,Wa),Qr(e,[{key:"setValue",value:function(t){var r=t;return this.__min!==void 0&&r<this.__min?r=this.__min:this.__max!==void 0&&r>this.__max&&(r=this.__max),this.__step!==void 0&&r%this.__step!=0&&(r=Math.round(r/this.__step)*this.__step),za(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=Iy(t),this}}]),e}(),Yc=function(i){function e(t,r,s){Kr(this,e);var a=ja(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,s));a.__truncationSuspended=!1;var n=a,o=void 0;function l(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}function c(u){var d=o-u.clientY;n.setValue(n.getValue()+d*n.__impliedStep),o=u.clientY}function h(){he.unbind(window,"mousemove",c),he.unbind(window,"mouseup",h),l()}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),he.bind(a.__input,"change",function(){var u=parseFloat(n.__input.value);ve.isNaN(u)||n.setValue(u)}),he.bind(a.__input,"blur",function(){l()}),he.bind(a.__input,"mousedown",function(u){he.bind(window,"mousemove",c),he.bind(window,"mouseup",h),o=u.clientY}),he.bind(a.__input,"keydown",function(u){u.keyCode===13&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1,l())}),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return Ga(e,z0),Qr(e,[{key:"updateDisplay",value:function(){var t,r,s;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),r=this.__precision,s=Math.pow(10,r),Math.round(t*s)/s),za(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function Ly(i,e,t,r,s){return r+(i-e)/(t-e)*(s-r)}var Pd=function(i){function e(t,r,s,a,n){Kr(this,e);var o=ja(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,{min:s,max:a,step:n})),l=o;function c(p){p.preventDefault();var f=l.__background.getBoundingClientRect();return l.setValue(Ly(p.clientX,f.left,f.right,l.__min,l.__max)),!1}function h(){he.unbind(window,"mousemove",c),he.unbind(window,"mouseup",h),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function u(p){var f=p.touches[0].clientX,g=l.__background.getBoundingClientRect();l.setValue(Ly(f,g.left,g.right,l.__min,l.__max))}function d(){he.unbind(window,"touchmove",u),he.unbind(window,"touchend",d),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),he.bind(o.__background,"mousedown",function(p){document.activeElement.blur(),he.bind(window,"mousemove",c),he.bind(window,"mouseup",h),c(p)}),he.bind(o.__background,"touchstart",function(p){p.touches.length===1&&(he.bind(window,"touchmove",u),he.bind(window,"touchend",d),u(p))}),he.addClass(o.__background,"slider"),he.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return Ga(e,z0),Qr(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",za(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),V0=function(i){function e(t,r,s){Kr(this,e);var a=ja(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),n=a;return a.__button=document.createElement("div"),a.__button.innerHTML=s===void 0?"Fire":s,he.bind(a.__button,"click",function(o){return o.preventDefault(),n.fire(),!1}),he.addClass(a.__button,"button"),a.domElement.appendChild(a.__button),a}return Ga(e,Wa),Qr(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),nd=function(i){function e(t,r){Kr(this,e);var s=ja(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));s.__color=new hi(s.getValue()),s.__temp=new hi(0);var a=s;s.domElement=document.createElement("div"),he.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",he.bind(s.__input,"keydown",function(m){m.keyCode===13&&d.call(this)}),he.bind(s.__input,"blur",d),he.bind(s.__selector,"mousedown",function(){he.addClass(this,"drag").bind(window,"mouseup",function(){he.removeClass(a.__selector,"drag")})}),he.bind(s.__selector,"touchstart",function(){he.addClass(this,"drag").bind(window,"touchend",function(){he.removeClass(a.__selector,"drag")})});var n,o=document.createElement("div");function l(m){f(m),he.bind(window,"mousemove",f),he.bind(window,"touchmove",f),he.bind(window,"mouseup",h),he.bind(window,"touchend",h)}function c(m){g(m),he.bind(window,"mousemove",g),he.bind(window,"touchmove",g),he.bind(window,"mouseup",u),he.bind(window,"touchend",u)}function h(){he.unbind(window,"mousemove",f),he.unbind(window,"touchmove",f),he.unbind(window,"mouseup",h),he.unbind(window,"touchend",h),p()}function u(){he.unbind(window,"mousemove",g),he.unbind(window,"touchmove",g),he.unbind(window,"mouseup",u),he.unbind(window,"touchend",u),p()}function d(){var m=Rd(this.value);m!==!1?(a.__color.__state=m,a.setValue(a.__color.toOriginal())):this.value=a.__color.toString()}function p(){a.__onFinishChange&&a.__onFinishChange.call(a,a.__color.toOriginal())}function f(m){m.type.indexOf("touch")===-1&&m.preventDefault();var v=a.__saturation_field.getBoundingClientRect(),_=m.touches&&m.touches[0]||m,y=_.clientX,x=_.clientY,b=(y-v.left)/(v.right-v.left),M=1-(x-v.top)/(v.bottom-v.top);return M>1?M=1:M<0&&(M=0),b>1?b=1:b<0&&(b=0),a.__color.v=M,a.__color.s=b,a.setValue(a.__color.toOriginal()),!1}function g(m){m.type.indexOf("touch")===-1&&m.preventDefault();var v=a.__hue_field.getBoundingClientRect(),_=1-((m.touches&&m.touches[0]||m).clientY-v.top)/(v.bottom-v.top);return _>1?_=1:_<0&&(_=0),a.__color.h=360*_,a.setValue(a.__color.toOriginal()),!1}return ve.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),ve.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),ve.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),ve.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),ve.extend(o.style,{width:"100%",height:"100%",background:"none"}),Ny(o,"top","rgba(0,0,0,0)","#000"),ve.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(n=s.__hue_field).style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",ve.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),he.bind(s.__saturation_field,"mousedown",l),he.bind(s.__saturation_field,"touchstart",l),he.bind(s.__field_knob,"mousedown",l),he.bind(s.__field_knob,"touchstart",l),he.bind(s.__hue_field,"mousedown",c),he.bind(s.__hue_field,"touchstart",c),s.__saturation_field.appendChild(o),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay(),s}return Ga(e,Wa),Qr(e,[{key:"updateDisplay",value:function(){var t=Rd(this.getValue());if(t!==!1){var r=!1;ve.each(hi.COMPONENTS,function(n){if(!ve.isUndefined(t[n])&&!ve.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return r=!0,{}},this),r&&ve.extend(this.__color.__state,t)}ve.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,a=255-s;ve.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Ny(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),ve.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),e}(),nE=["-moz-","-o-","-webkit-","-ms-",""];function Ny(i,e,t,r){i.style.background="",ve.each(nE,function(s){i.style.cssText+="background: "+s+"linear-gradient("+e+", "+t+" 0%, "+r+" 100%); "})}var oE=function(i,e){var t=document,r=document.createElement("style");r.type="text/css",r.innerHTML=i;var s=t.getElementsByTagName("head")[0];try{s.appendChild(r)}catch{}},lE=function(i,e){var t=i[e];return ve.isArray(arguments[2])||ve.isObject(arguments[2])?new oM(i,e,arguments[2]):ve.isNumber(t)?ve.isNumber(arguments[2])&&ve.isNumber(arguments[3])?ve.isNumber(arguments[4])?new Pd(i,e,arguments[2],arguments[3],arguments[4]):new Pd(i,e,arguments[2],arguments[3]):ve.isNumber(arguments[4])?new Yc(i,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Yc(i,e,{min:arguments[2],max:arguments[3]}):ve.isString(t)?new lM(i,e):ve.isFunction(t)?new V0(i,e,""):ve.isBoolean(t)?new B0(i,e):null},cE=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){setTimeout(i,1e3/60)},hE=function(){function i(){Kr(this,i),this.backgroundElement=document.createElement("div"),ve.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),he.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),ve.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;he.bind(this.backgroundElement,"click",function(){e.hide()})}return Qr(i,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),ve.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function r(){e.domElement.style.display="none",e.backgroundElement.style.display="none",he.unbind(e.domElement,"webkitTransitionEnd",r),he.unbind(e.domElement,"transitionend",r),he.unbind(e.domElement,"oTransitionEnd",r)};he.bind(this.domElement,"webkitTransitionEnd",t),he.bind(this.domElement,"transitionend",t),he.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-he.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-he.getHeight(this.domElement)/2+"px"}}]),i}(),uE=function(i){if(typeof window<"u"){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=i,document.head.appendChild(e),i}}(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);oE(uE);var Zc="Default",nc=function(){try{return!!window.localStorage}catch{return!1}}(),Au=void 0,Dy=!0,Ao=void 0,Vm=!1,cM=[],_t=function i(e){var t=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),he.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=ve.defaults(r,{closeOnTop:!1,autoPlace:!0,width:i.DEFAULT_WIDTH}),r=ve.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),ve.isUndefined(r.load)?r.load={preset:Zc}:r.preset&&(r.load.preset=r.preset),ve.isUndefined(r.parent)&&r.hideable&&cM.push(this),r.resizable=ve.isUndefined(r.parent)&&r.resizable,r.autoPlace&&ve.isUndefined(r.scrollable)&&(r.scrollable=!0);var s,a=nc&&localStorage.getItem(Eo(this,"isLocal"))==="true",n=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:r.load.preset},set:function(h){t.parent?t.getRoot().preset=h:r.load.preset=h,function(u){for(var d=0;d<u.__preset_select.length;d++)u.__preset_select[d].value===u.preset&&(u.__preset_select.selectedIndex=d)}(this),t.revert()}},width:{get:function(){return r.width},set:function(h){r.width=h,Rg(t,h)}},name:{get:function(){return r.name},set:function(h){r.name=h,o&&(o.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(h){r.closed=h,r.closed?he.addClass(t.__ul,i.CLASS_CLOSED):he.removeClass(t.__ul,i.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=h?i.TEXT_OPEN:i.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(h){nc&&(a=h,h?he.bind(window,"unload",n):he.unbind(window,"unload",n),localStorage.setItem(Eo(t,"isLocal"),h))}}}),ve.isUndefined(r.parent)){if(this.closed=r.closed||!1,he.addClass(this.domElement,i.CLASS_MAIN),he.makeSelectable(this.domElement,!1),nc&&a){t.useLocalStorage=!0;var l=localStorage.getItem(Eo(this,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=i.TEXT_CLOSED,he.addClass(this.__closeButton,i.CLASS_CLOSE_BUTTON),r.closeOnTop?(he.addClass(this.__closeButton,i.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(he.addClass(this.__closeButton,i.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),he.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{r.closed===void 0&&(r.closed=!0);var c=document.createTextNode(r.name);he.addClass(c,"controller-name"),o=H0(t,c),he.addClass(this.__ul,i.CLASS_CLOSED),he.addClass(o,"title"),he.bind(o,"click",function(h){return h.preventDefault(),t.closed=!t.closed,!1}),r.closed||(this.closed=!1)}r.autoPlace&&(ve.isUndefined(r.parent)&&(Dy&&(Ao=document.createElement("div"),he.addClass(Ao,"dg"),he.addClass(Ao,i.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Ao),Dy=!1),Ao.appendChild(this.domElement),he.addClass(this.domElement,i.CLASS_AUTO_PLACE)),this.parent||Rg(t,r.width)),this.__resizeHandler=function(){t.onResizeDebounced()},he.bind(window,"resize",this.__resizeHandler),he.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),he.bind(this.__ul,"transitionend",this.__resizeHandler),he.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&dE(this),n=function(){nc&&localStorage.getItem(Eo(t,"isLocal"))==="true"&&localStorage.setItem(Eo(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=n,r.parent||((s=t.getRoot()).width+=1,ve.defer(function(){s.width-=1}))};function H0(i,e,t){var r=document.createElement("li");return e&&r.appendChild(e),t?i.__ul.insertBefore(r,t):i.__ul.appendChild(r),i.onResize(),r}function Oy(i){he.unbind(window,"resize",i.__resizeHandler),i.saveToLocalStorageIfPossible&&he.unbind(window,"unload",i.saveToLocalStorageIfPossible)}function Cg(i,e){var t=i.__preset_select[i.__preset_select.selectedIndex];t.innerHTML=e?t.value+"*":t.value}function hM(i,e){var t=i.getRoot(),r=t.__rememberedObjects.indexOf(e.object);if(r!==-1){var s=t.__rememberedObjectIndecesToControllers[r];if(s===void 0&&(s={},t.__rememberedObjectIndecesToControllers[r]=s),s[e.property]=e,t.load&&t.load.remembered){var a=t.load.remembered,n=void 0;if(a[i.preset])n=a[i.preset];else{if(!a[Zc])return;n=a[Zc]}if(n[r]&&n[r][e.property]!==void 0){var o=n[r][e.property];e.initialValue=o,e.setValue(o)}}}}function yc(i,e,t,r){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var s=void 0;if(r.color)s=new nd(e,t);else{var a=[e,t].concat(r.factoryArgs);s=lE.apply(i,a)}r.before instanceof Wa&&(r.before=r.before.__li),hM(i,s),he.addClass(s.domElement,"c");var n=document.createElement("span");he.addClass(n,"property-name"),n.innerHTML=s.property;var o=document.createElement("div");o.appendChild(n),o.appendChild(s.domElement);var l=H0(i,o,r.before);return he.addClass(l,_t.CLASS_CONTROLLER_ROW),s instanceof nd?he.addClass(l,"color"):he.addClass(l,sE(s.getValue())),function(c,h,u){if(u.__li=h,u.__gui=c,ve.extend(u,{options:function(f){if(arguments.length>1){var g=u.__li.nextElementSibling;return u.remove(),yc(c,u.object,u.property,{before:g,factoryArgs:[ve.toArray(arguments)]})}if(ve.isArray(f)||ve.isObject(f)){var m=u.__li.nextElementSibling;return u.remove(),yc(c,u.object,u.property,{before:m,factoryArgs:[f]})}},name:function(f){return u.__li.firstElementChild.firstElementChild.innerHTML=f,u},listen:function(){return u.__gui.listen(u),u},remove:function(){return u.__gui.remove(u),u}}),u instanceof Pd){var d=new Yc(u.object,u.property,{min:u.__min,max:u.__max,step:u.__step});ve.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(f){var g=u[f],m=d[f];u[f]=d[f]=function(){var v=Array.prototype.slice.call(arguments);return m.apply(d,v),g.apply(u,v)}}),he.addClass(h,"has-slider"),u.domElement.insertBefore(d.domElement,u.domElement.firstElementChild)}else if(u instanceof Yc){var p=function(f){if(ve.isNumber(u.__min)&&ve.isNumber(u.__max)){var g=u.__li.firstElementChild.firstElementChild.innerHTML,m=u.__gui.__listening.indexOf(u)>-1;u.remove();var v=yc(c,u.object,u.property,{before:u.__li.nextElementSibling,factoryArgs:[u.__min,u.__max,u.__step]});return v.name(g),m&&v.listen(),v}return f};u.min=ve.compose(p,u.min),u.max=ve.compose(p,u.max)}else u instanceof B0?(he.bind(h,"click",function(){he.fakeEvent(u.__checkbox,"click")}),he.bind(u.__checkbox,"click",function(f){f.stopPropagation()})):u instanceof V0?(he.bind(h,"click",function(){he.fakeEvent(u.__button,"click")}),he.bind(h,"mouseover",function(){he.addClass(u.__button,"hover")}),he.bind(h,"mouseout",function(){he.removeClass(u.__button,"hover")})):u instanceof nd&&(he.addClass(h,"color"),u.updateDisplay=ve.compose(function(f){return h.style.borderLeftColor=u.__color.toString(),f},u.updateDisplay),u.updateDisplay());u.setValue=ve.compose(function(f){return c.getRoot().__preset_select&&u.isModified()&&Cg(c.getRoot(),!0),f},u.setValue)}(i,l,s),i.__controllers.push(s),s}function Eo(i,e){return document.location.href+"."+e}function Hm(i,e,t){var r=document.createElement("option");r.innerHTML=e,r.value=e,i.__preset_select.appendChild(r),t&&(i.__preset_select.selectedIndex=i.__preset_select.length-1)}function Uy(i,e){e.style.display=i.useLocalStorage?"block":"none"}function dE(i){var e=void 0;function t(a){return a.preventDefault(),i.width+=e-a.clientX,i.onResize(),e=a.clientX,!1}function r(){he.removeClass(i.__closeButton,_t.CLASS_DRAG),he.unbind(window,"mousemove",t),he.unbind(window,"mouseup",r)}function s(a){return a.preventDefault(),e=a.clientX,he.addClass(i.__closeButton,_t.CLASS_DRAG),he.bind(window,"mousemove",t),he.bind(window,"mouseup",r),!1}i.__resize_handle=document.createElement("div"),ve.extend(i.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),he.bind(i.__resize_handle,"mousedown",s),he.bind(i.__closeButton,"mousedown",s),i.domElement.insertBefore(i.__resize_handle,i.domElement.firstElementChild)}function Rg(i,e){i.domElement.style.width=e+"px",i.__save_row&&i.autoPlace&&(i.__save_row.style.width=e+"px"),i.__closeButton&&(i.__closeButton.style.width=e+"px")}function Eu(i,e){var t={};return ve.each(i.__rememberedObjects,function(r,s){var a={},n=i.__rememberedObjectIndecesToControllers[s];ve.each(n,function(o,l){a[l]=e?o.initialValue:o.getValue()}),t[s]=a}),t}function uM(i){i.length!==0&&cE.call(window,function(){uM(i)}),ve.each(i,function(e){e.updateDisplay()})}_t.toggleHide=function(){Vm=!Vm,ve.each(cM,function(i){i.domElement.style.display=Vm?"none":""})},_t.CLASS_AUTO_PLACE="a",_t.CLASS_AUTO_PLACE_CONTAINER="ac",_t.CLASS_MAIN="main",_t.CLASS_CONTROLLER_ROW="cr",_t.CLASS_TOO_TALL="taller-than-window",_t.CLASS_CLOSED="closed",_t.CLASS_CLOSE_BUTTON="close-button",_t.CLASS_CLOSE_TOP="close-top",_t.CLASS_CLOSE_BOTTOM="close-bottom",_t.CLASS_DRAG="drag",_t.DEFAULT_WIDTH=245,_t.TEXT_CLOSED="Close Controls",_t.TEXT_OPEN="Open Controls",_t._keydownHandler=function(i){document.activeElement.type==="text"||i.which!==72&&i.keyCode!==72||_t.toggleHide()},he.bind(window,"keydown",_t._keydownHandler,!1),ve.extend(_t.prototype,{add:function(i,e){return yc(this,i,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(i,e){return yc(this,i,e,{color:!0})},remove:function(i){this.__ul.removeChild(i.__li),this.__controllers.splice(this.__controllers.indexOf(i),1);var e=this;ve.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Ao.removeChild(this.domElement);var i=this;ve.each(this.__folders,function(e){i.removeFolder(e)}),he.unbind(window,"keydown",_t._keydownHandler,!1),Oy(this)},addFolder:function(i){if(this.__folders[i]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+i+'"');var e={name:i,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[i]&&(e.closed=this.load.folders[i].closed,e.load=this.load.folders[i]);var t=new _t(e);this.__folders[i]=t;var r=H0(this,t.domElement);return he.addClass(r,"folder"),t},removeFolder:function(i){this.__ul.removeChild(i.domElement.parentElement),delete this.__folders[i.name],this.load&&this.load.folders&&this.load.folders[i.name]&&delete this.load.folders[i.name],Oy(i);var e=this;ve.each(i.__folders,function(t){i.removeFolder(t)}),ve.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var i=this.getRoot();if(i.scrollable){var e=he.getOffset(i.__ul).top,t=0;ve.each(i.__ul.childNodes,function(r){i.autoPlace&&r===i.__save_row||(t+=he.getHeight(r))}),window.innerHeight-e-20<t?(he.addClass(i.domElement,_t.CLASS_TOO_TALL),i.__ul.style.height=window.innerHeight-e-20+"px"):(he.removeClass(i.domElement,_t.CLASS_TOO_TALL),i.__ul.style.height="auto")}i.__resize_handle&&ve.defer(function(){i.__resize_handle.style.height=i.__ul.offsetHeight+"px"}),i.__closeButton&&(i.__closeButton.style.width=i.width+"px")},onResizeDebounced:ve.debounce(function(){this.onResize()},50),remember:function(){if(ve.isUndefined(Au)&&((Au=new hE).domElement.innerHTML=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`),this.parent)throw new Error("You can only call remember on a top level GUI.");var i=this;ve.each(Array.prototype.slice.call(arguments),function(e){i.__rememberedObjects.length===0&&function(t){var r=t.__save_row=document.createElement("li");he.addClass(t.domElement,"has-save"),t.__ul.insertBefore(r,t.__ul.firstChild),he.addClass(r,"save-row");var s=document.createElement("span");s.innerHTML="&nbsp;",he.addClass(s,"button gears");var a=document.createElement("span");a.innerHTML="Save",he.addClass(a,"button"),he.addClass(a,"save");var n=document.createElement("span");n.innerHTML="New",he.addClass(n,"button"),he.addClass(n,"save-as");var o=document.createElement("span");o.innerHTML="Revert",he.addClass(o,"button"),he.addClass(o,"revert");var l=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?ve.each(t.load.remembered,function(d,p){Hm(t,p,p===t.preset)}):Hm(t,Zc,!1),he.bind(l,"change",function(){for(var d=0;d<t.__preset_select.length;d++)t.__preset_select[d].innerHTML=t.__preset_select[d].value;t.preset=this.value}),r.appendChild(l),r.appendChild(s),r.appendChild(a),r.appendChild(n),r.appendChild(o),nc){var c=document.getElementById("dg-local-explain"),h=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block",localStorage.getItem(Eo(t,"isLocal"))==="true"&&h.setAttribute("checked","checked"),Uy(t,c),he.bind(h,"change",function(){t.useLocalStorage=!t.useLocalStorage,Uy(t,c)})}var u=document.getElementById("dg-new-constructor");he.bind(u,"keydown",function(d){!d.metaKey||d.which!==67&&d.keyCode!==67||Au.hide()}),he.bind(s,"click",function(){u.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),Au.show(),u.focus(),u.select()}),he.bind(a,"click",function(){t.save()}),he.bind(n,"click",function(){var d=prompt("Enter a new preset name.");d&&t.saveAs(d)}),he.bind(o,"click",function(){t.revert()})}(i),i.__rememberedObjects.indexOf(e)===-1&&i.__rememberedObjects.push(e)}),this.autoPlace&&Rg(this,this.width)},getRoot:function(){for(var i=this;i.parent;)i=i.parent;return i},getSaveObject:function(){var i=this.load;return i.closed=this.closed,this.__rememberedObjects.length>0&&(i.preset=this.preset,i.remembered||(i.remembered={}),i.remembered[this.preset]=Eu(this)),i.folders={},ve.each(this.__folders,function(e,t){i.folders[t]=e.getSaveObject()}),i},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Eu(this),Cg(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(i){this.load.remembered||(this.load.remembered={},this.load.remembered[Zc]=Eu(this,!0)),this.load.remembered[i]=Eu(this),this.preset=i,Hm(this,i,!0),this.saveToLocalStorageIfPossible()},revert:function(i){ve.each(this.__controllers,function(e){this.getRoot().load.remembered?hM(i||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),ve.each(this.__folders,function(e){e.revert(e)}),i||Cg(this.getRoot(),!1)},listen:function(i){var e=this.__listening.length===0;this.__listening.push(i),e&&uM(this.__listening)},updateDisplay:function(){ve.each(this.__controllers,function(i){i.updateDisplay()}),ve.each(this.__folders,function(i){i.updateDisplay()})}});var dM={Color:hi,math:ac,interpret:Rd},pM={Controller:Wa,BooleanController:B0,OptionController:oM,StringController:lM,NumberController:z0,NumberControllerBox:Yc,NumberControllerSlider:Pd,FunctionController:V0,ColorController:nd},mM={dom:he},fM={GUI:_t},ls=_t,pE={color:dM,controllers:pM,dom:mM,gui:fM,GUI:ls};Object.freeze(Object.defineProperty({__proto__:null,GUI:ls,color:dM,controllers:pM,default:pE,dom:mM,gui:fM},Symbol.toStringTag,{value:"Module"}));var kn=1,Fn=2,Wo=3,mE=4,Pg=5,ky=6378137,fE=6356752314e-3,Fy=.0066943799901413165,xc=484813681109536e-20,be=Math.PI/2,gE=.16666666666666666,vE=.04722222222222222,_E=.022156084656084655,Ae=1e-10,Si=.017453292519943295,ba=57.29577951308232,mt=Math.PI/4,Kc=2*Math.PI,Xt=3.14159265359,yE={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const xE={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var By=/[\s_\-\/\(\)]/g;function Ma(i,e){if(i[e])return i[e];for(var t,r=Object.keys(i),s=e.toLowerCase().replace(By,""),a=-1;++a<r.length;)if((t=r[a]).toLowerCase().replace(By,"")===s)return i[t]}function Ig(i){var e,t,r,s={},a=i.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,l){var c=l.split("=");return c.push(!0),o[c[0].toLowerCase()]=c[1],o},{}),n={proj:"projName",datum:"datumCode",rf:function(o){s.rf=parseFloat(o)},lat_0:function(o){s.lat0=o*Si},lat_1:function(o){s.lat1=o*Si},lat_2:function(o){s.lat2=o*Si},lat_ts:function(o){s.lat_ts=o*Si},lon_0:function(o){s.long0=o*Si},lon_1:function(o){s.long1=o*Si},lon_2:function(o){s.long2=o*Si},alpha:function(o){s.alpha=parseFloat(o)*Si},gamma:function(o){s.rectified_grid_angle=parseFloat(o)},lonc:function(o){s.longc=o*Si},x_0:function(o){s.x0=parseFloat(o)},y_0:function(o){s.y0=parseFloat(o)},k_0:function(o){s.k0=parseFloat(o)},k:function(o){s.k0=parseFloat(o)},a:function(o){s.a=parseFloat(o)},b:function(o){s.b=parseFloat(o)},r:function(o){s.a=s.b=parseFloat(o)},r_a:function(){s.R_A=!0},zone:function(o){s.zone=parseInt(o,10)},south:function(){s.utmSouth=!0},towgs84:function(o){s.datum_params=o.split(",").map(function(l){return parseFloat(l)})},to_meter:function(o){s.to_meter=parseFloat(o)},units:function(o){s.units=o;var l=Ma(xE,o);l&&(s.to_meter=l.to_meter)},from_greenwich:function(o){s.from_greenwich=o*Si},pm:function(o){var l=Ma(yE,o);s.from_greenwich=(l||parseFloat(o))*Si},nadgrids:function(o){o==="@null"?s.datumCode="none":s.nadgrids=o},axis:function(o){var l="ewnsud";o.length===3&&l.indexOf(o.substr(0,1))!==-1&&l.indexOf(o.substr(1,1))!==-1&&l.indexOf(o.substr(2,1))!==-1&&(s.axis=o)},approx:function(){s.approx=!0}};for(e in a)t=a[e],e in n?typeof(r=n[e])=="function"?r(t):s[r]=t:s[e]=t;return typeof s.datumCode=="string"&&s.datumCode!=="WGS84"&&(s.datumCode=s.datumCode.toLowerCase()),s}var oc=1,bE=/\s/,ME=/[A-Za-z]/,wE=/[A-Za-z84_]/,Cu=/[,\]]/,zy=/[\d\.E\-\+]/;function Is(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=oc}function Vy(i,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var r=e?{}:i,s=t.reduce(function(a,n){return No(n,a),a},r);e&&(i[e]=s)}function No(i,e){if(Array.isArray(i)){var t=i.shift();if(t==="PARAMETER"&&(t=i.shift()),i.length===1)return Array.isArray(i[0])?(e[t]={},void No(i[0],e[t])):void(e[t]=i[0]);if(i.length)if(t!=="TOWGS84"){if(t==="AXIS")return t in e||(e[t]=[]),void e[t].push(i);var r;switch(Array.isArray(t)||(e[t]={}),t){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[t]={name:i[0].toLowerCase(),convert:i[1]},void(i.length===3&&No(i[2],e[t]));case"SPHEROID":case"ELLIPSOID":return e[t]={name:i[0],a:i[1],rf:i[2]},void(i.length===4&&No(i[3],e[t]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return i[0]=["name",i[0]],void Vy(e,t,i);default:for(r=-1;++r<i.length;)if(!Array.isArray(i[r]))return No(i,e[t]);return Vy(e,t,i)}}else e[t]=i;else e[t]=!0}else e[i]=!0}Is.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==4)for(;bE.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case oc:return this.neutral(i);case 2:return this.keyword(i);case 4:return this.quoted(i);case 5:return this.afterquote(i);case 3:return this.number(i);case-1:return}},Is.prototype.afterquote=function(i){if(i==='"')return this.word+='"',void(this.state=4);if(Cu.test(i))return this.word=this.word.trim(),void this.afterItem(i);throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)},Is.prototype.afterItem=function(i){return i===","?(this.word!==null&&this.currentObject.push(this.word),this.word=null,void(this.state=oc)):i==="]"?(this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=oc,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},Is.prototype.number=function(i){if(!zy.test(i)){if(Cu.test(i))return this.word=parseFloat(this.word),void this.afterItem(i);throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)}this.word+=i},Is.prototype.quoted=function(i){i!=='"'?this.word+=i:this.state=5},Is.prototype.keyword=function(i){if(wE.test(i))this.word+=i;else{if(i==="["){var e=[];return e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=oc)}if(!Cu.test(i))throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place);this.afterItem(i)}},Is.prototype.neutral=function(i){if(ME.test(i))return this.word=i,void(this.state=2);if(i==='"')return this.word="",void(this.state=4);if(zy.test(i))return this.word=i,void(this.state=3);if(!Cu.test(i))throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place);this.afterItem(i)},Is.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===-1)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var SE=.017453292519943295;function ts(i){return i*SE}function gM(i){var e=new Is(i).output(),t=e.shift(),r=e.shift();e.unshift(["name",r]),e.unshift(["type",t]);var s={};return No(e,s),function(a){if(a.type==="GEOGCS"?a.projName="longlat":a.type==="LOCAL_CS"?(a.projName="identity",a.local=!0):typeof a.PROJECTION=="object"?a.projName=Object.keys(a.PROJECTION)[0]:a.projName=a.PROJECTION,a.AXIS){for(var n="",o=0,l=a.AXIS.length;o<l;++o){var c=[a.AXIS[o][0].toLowerCase(),a.AXIS[o][1].toLowerCase()];c[0].indexOf("north")!==-1||(c[0]==="y"||c[0]==="lat")&&c[1]==="north"?n+="n":c[0].indexOf("south")!==-1||(c[0]==="y"||c[0]==="lat")&&c[1]==="south"?n+="s":c[0].indexOf("east")!==-1||(c[0]==="x"||c[0]==="lon")&&c[1]==="east"?n+="e":c[0].indexOf("west")===-1&&(c[0]!=="x"&&c[0]!=="lon"||c[1]!=="west")||(n+="w")}n.length===2&&(n+="u"),n.length===3&&(a.axis=n)}a.UNIT&&(a.units=a.UNIT.name.toLowerCase(),a.units==="metre"&&(a.units="meter"),a.UNIT.convert&&(a.type==="GEOGCS"?a.DATUM&&a.DATUM.SPHEROID&&(a.to_meter=a.UNIT.convert*a.DATUM.SPHEROID.a):a.to_meter=a.UNIT.convert));var h=a.GEOGCS;function u(d){return d*(a.to_meter||1)}a.type==="GEOGCS"&&(h=a),h&&(h.DATUM?a.datumCode=h.DATUM.name.toLowerCase():a.datumCode=h.name.toLowerCase(),a.datumCode.slice(0,2)==="d_"&&(a.datumCode=a.datumCode.slice(2)),a.datumCode!=="new_zealand_geodetic_datum_1949"&&a.datumCode!=="new_zealand_1949"||(a.datumCode="nzgd49"),a.datumCode!=="wgs_1984"&&a.datumCode!=="world_geodetic_system_1984"||(a.PROJECTION==="Mercator_Auxiliary_Sphere"&&(a.sphere=!0),a.datumCode="wgs84"),a.datumCode.slice(-6)==="_ferro"&&(a.datumCode=a.datumCode.slice(0,-6)),a.datumCode.slice(-8)==="_jakarta"&&(a.datumCode=a.datumCode.slice(0,-8)),~a.datumCode.indexOf("belge")&&(a.datumCode="rnb72"),h.DATUM&&h.DATUM.SPHEROID&&(a.ellps=h.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),a.ellps.toLowerCase().slice(0,13)==="international"&&(a.ellps="intl"),a.a=h.DATUM.SPHEROID.a,a.rf=parseFloat(h.DATUM.SPHEROID.rf,10)),h.DATUM&&h.DATUM.TOWGS84&&(a.datum_params=h.DATUM.TOWGS84),~a.datumCode.indexOf("osgb_1936")&&(a.datumCode="osgb36"),~a.datumCode.indexOf("osni_1952")&&(a.datumCode="osni52"),(~a.datumCode.indexOf("tm65")||~a.datumCode.indexOf("geodetic_datum_of_1965"))&&(a.datumCode="ire65"),a.datumCode==="ch1903+"&&(a.datumCode="ch1903"),~a.datumCode.indexOf("israel")&&(a.datumCode="isr93")),a.b&&!isFinite(a.b)&&(a.b=a.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",ts],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",ts],["x0","false_easting",u],["y0","false_northing",u],["long0","central_meridian",ts],["lat0","latitude_of_origin",ts],["lat0","standard_parallel_1",ts],["lat1","standard_parallel_1",ts],["lat2","standard_parallel_2",ts],["azimuth","Azimuth"],["alpha","azimuth",ts],["srsCode","name"]].forEach(function(d){return function(p,f){var g=f[0],m=f[1];!(g in p)&&m in p&&(p[g]=p[m],f.length===3&&(p[g]=f[2](p[g])))}(a,d)}),a.long0||!a.longc||a.projName!=="Albers_Conic_Equal_Area"&&a.projName!=="Lambert_Azimuthal_Equal_Area"||(a.long0=a.longc),a.lat_ts||!a.lat1||a.projName!=="Stereographic_South_Pole"&&a.projName!=="Polar Stereographic (variant B)"?!a.lat_ts&&a.lat0&&a.projName==="Polar_Stereographic"&&(a.lat_ts=a.lat0,a.lat0=ts(a.lat0>0?90:-90)):(a.lat0=ts(a.lat1>0?90:-90),a.lat_ts=a.lat1)}(s),s}function zi(i){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?zi[i]=Ig(arguments[1]):zi[i]=gM(arguments[1]):zi[i]=t}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(r){Array.isArray(r)?zi.apply(e,r):zi(r)});if(typeof i=="string"){if(i in zi)return zi[i]}else"EPSG"in i?zi["EPSG:"+i.EPSG]=i:"ESRI"in i?zi["ESRI:"+i.ESRI]=i:"IAU2000"in i&&(zi["IAU2000:"+i.IAU2000]=i);return}}(function(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]})(zi);var TE=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],AE=["3857","900913","3785","102113"];function EE(i){if(!function(r){return typeof r=="string"}(i))return i;if(function(r){return r in zi}(i))return zi[i];if(function(r){return TE.some(function(s){return r.indexOf(s)>-1})}(i)){var e=gM(i);if(function(r){var s=Ma(r,"authority");if(s){var a=Ma(s,"epsg");return a&&AE.indexOf(a)>-1}}(e))return zi["EPSG:3857"];var t=function(r){var s=Ma(r,"extension");if(s)return Ma(s,"proj4")}(e);return t?Ig(t):e}return function(r){return r[0]==="+"}(i)?Ig(i):void 0}function Hy(i,e){var t,r;if(i=i||{},!e)return i;for(r in e)(t=e[r])!==void 0&&(i[r]=t);return i}function Ms(i,e,t){var r=i*e;return t/Math.sqrt(1-r*r)}function xh(i){return i<0?-1:1}function Ce(i){return Math.abs(i)<=Xt?i:i-xh(i)*Kc}function Xr(i,e,t){var r=i*t,s=.5*i;return r=Math.pow((1-r)/(1+r),s),Math.tan(.5*(be-e))/r}function Qc(i,e){for(var t,r,s=.5*i,a=be-2*Math.atan(e),n=0;n<=15;n++)if(t=i*Math.sin(a),a+=r=be-2*Math.atan(e*Math.pow((1-t)/(1+t),s))-a,Math.abs(r)<=1e-10)return a;return-9999}const CE={init:function(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Ms(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(i){var e,t,r=i.x,s=i.y;if(s*ba>90&&s*ba<-90&&r*ba>180&&r*ba<-180||Math.abs(Math.abs(s)-be)<=Ae)return null;if(this.sphere)e=this.x0+this.a*this.k0*Ce(r-this.long0),t=this.y0+this.a*this.k0*Math.log(Math.tan(mt+.5*s));else{var a=Math.sin(s),n=Xr(this.e,s,a);e=this.x0+this.a*this.k0*Ce(r-this.long0),t=this.y0-this.a*this.k0*Math.log(n)}return i.x=e,i.y=t,i},inverse:function(i){var e,t,r=i.x-this.x0,s=i.y-this.y0;if(this.sphere)t=be-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var a=Math.exp(-s/(this.a*this.k0));if((t=Qc(this.e,a))===-9999)return null}return e=Ce(this.long0+r/(this.a*this.k0)),i.x=e,i.y=t,i},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]};function Gy(i){return i}var RE=[CE,{init:function(){},forward:Gy,inverse:Gy,names:["longlat","identity"]}],od={},Id=[];function jy(i,e){var t=Id.length;return!i.names||(Id[t]=i,i.names.forEach(function(r){od[r.toLowerCase()]=t}),this)}const PE={start:function(){RE.forEach(jy)},add:jy,get:function(i){if(!i)return!1;var e=i.toLowerCase();return typeof od[e]<"u"&&Id[od[e]]?Id[od[e]]:void 0}};var G0={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},IE=G0.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};G0.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var ci={};ci.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ci.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ci.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},ci.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},ci.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},ci.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},ci.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},ci.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},ci.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},ci.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ci.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},ci.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},ci.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},ci.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},ci.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},ci.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},ci.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},ci.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var vM={};function LE(i){if(i.length===0)return null;var e=i[0]==="@";return e&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:i,mandatory:!e,grid:vM[i]||null,isNull:!1}}function Do(i){return i/3600*Math.PI/180}function Lg(i,e,t){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(e,t)))}function NE(i){return i.map(function(e){return[Do(e.longitudeShift),Do(e.latitudeShift)]})}function DE(i,e,t){return{name:Lg(i,e+8,e+16).trim(),parent:Lg(i,e+24,e+24+8).trim(),lowerLatitude:i.getFloat64(e+72,t),upperLatitude:i.getFloat64(e+88,t),lowerLongitude:i.getFloat64(e+104,t),upperLongitude:i.getFloat64(e+120,t),latitudeInterval:i.getFloat64(e+136,t),longitudeInterval:i.getFloat64(e+152,t),gridNodeCount:i.getInt32(e+168,t)}}function OE(i,e,t,r){for(var s=e+176,a=[],n=0;n<t.gridNodeCount;n++){var o={latitudeShift:i.getFloat32(s+16*n,r),longitudeShift:i.getFloat32(s+16*n+4,r),latitudeAccuracy:i.getFloat32(s+16*n+8,r),longitudeAccuracy:i.getFloat32(s+16*n+12,r)};a.push(o)}return a}function _s(i,e){if(!(this instanceof _s))return new _s(i);e=e||function(c){if(c)throw c};var t=EE(i);if(typeof t=="object"){var r=_s.projections.get(t.projName);if(r){if(t.datumCode&&t.datumCode!=="none"){var s=Ma(ci,t.datumCode);s&&(t.datum_params=t.datum_params||(s.towgs84?s.towgs84.split(","):null),t.ellps=s.ellipse,t.datumName=s.datumName?s.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var a=function(c,h,u,d,p){if(!c){var f=Ma(G0,d);f||(f=IE),c=f.a,h=f.b,u=f.rf}return u&&!h&&(h=(1-1/u)*c),(u===0||Math.abs(c-h)<Ae)&&(p=!0,h=c),{a:c,b:h,rf:u,sphere:p}}(t.a,t.b,t.rf,t.ellps,t.sphere),n=function(c,h,u,d){var p=c*c,f=h*h,g=(p-f)/p,m=0;return d?(p=(c*=1-g*(gE+g*(vE+g*_E)))*c,g=0):m=Math.sqrt(g),{es:g,e:m,ep2:(p-f)/f}}(a.a,a.b,a.rf,t.R_A),o=function(c){return c===void 0?null:c.split(",").map(LE)}(t.nadgrids),l=t.datum||function(c,h,u,d,p,f,g){var m={};return c===void 0||c==="none"?m.datum_type=Pg:m.datum_type=mE,h&&(m.datum_params=h.map(parseFloat),m.datum_params[0]===0&&m.datum_params[1]===0&&m.datum_params[2]===0||(m.datum_type=kn),m.datum_params.length>3&&(m.datum_params[3]===0&&m.datum_params[4]===0&&m.datum_params[5]===0&&m.datum_params[6]===0||(m.datum_type=Fn,m.datum_params[3]*=xc,m.datum_params[4]*=xc,m.datum_params[5]*=xc,m.datum_params[6]=m.datum_params[6]/1e6+1))),g&&(m.datum_type=Wo,m.grids=g),m.a=u,m.b=d,m.es=p,m.ep2=f,m}(t.datumCode,t.datum_params,a.a,a.b,n.es,n.ep2,o);Hy(this,t),Hy(this,r),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=n.es,this.e=n.e,this.ep2=n.ep2,this.datum=l,this.init(),e(null,this)}else e(i)}else e(i)}function _M(i,e,t){var r,s,a,n,o=i.x,l=i.y,c=i.z?i.z:0;if(l<-be&&l>-1.001*be)l=-be;else if(l>be&&l<1.001*be)l=be;else{if(l<-be)return{x:-1/0,y:-1/0,z:i.z};if(l>be)return{x:1/0,y:1/0,z:i.z}}return o>Math.PI&&(o-=2*Math.PI),s=Math.sin(l),n=Math.cos(l),a=s*s,{x:((r=t/Math.sqrt(1-e*a))+c)*n*Math.cos(o),y:(r+c)*n*Math.sin(o),z:(r*(1-e)+c)*s}}function yM(i,e,t,r){var s,a,n,o,l,c,h,u,d,p,f,g,m,v,_,y=1e-12,x=i.x,b=i.y,M=i.z?i.z:0;if(s=Math.sqrt(x*x+b*b),a=Math.sqrt(x*x+b*b+M*M),s/t<y){if(v=0,a/t<y)return _=-r,{x:i.x,y:i.y,z:i.z}}else v=Math.atan2(b,x);n=M/a,u=(o=s/a)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*o*o)),d=n*l,m=0;do m++,c=e*(h=t/Math.sqrt(1-e*d*d))/(h+(_=s*u+M*d-h*(1-e*d*d))),g=(f=n*(l=1/Math.sqrt(1-c*(2-c)*o*o)))*u-(p=o*(1-c)*l)*d,u=p,d=f;while(g*g>1e-24&&m<30);return{x:v,y:Math.atan(f/Math.abs(p)),z:_}}function Ru(i){return i===kn||i===Fn}function UE(i,e,t){if(function(l,c){return l.datum_type===c.datum_type&&!(l.a!==c.a||Math.abs(l.es-c.es)>5e-11)&&(l.datum_type===kn?l.datum_params[0]===c.datum_params[0]&&l.datum_params[1]===c.datum_params[1]&&l.datum_params[2]===c.datum_params[2]:l.datum_type!==Fn||l.datum_params[0]===c.datum_params[0]&&l.datum_params[1]===c.datum_params[1]&&l.datum_params[2]===c.datum_params[2]&&l.datum_params[3]===c.datum_params[3]&&l.datum_params[4]===c.datum_params[4]&&l.datum_params[5]===c.datum_params[5]&&l.datum_params[6]===c.datum_params[6])}(i,e)||i.datum_type===Pg||e.datum_type===Pg)return t;var r=i.a,s=i.es;if(i.datum_type===Wo){if(Wy(i,!1,t)!==0)return;r=ky,s=Fy}var a=e.a,n=e.b,o=e.es;if(e.datum_type===Wo&&(a=ky,n=fE,o=Fy),s===o&&r===a&&!Ru(i.datum_type)&&!Ru(e.datum_type)||(t=_M(t,s,r),Ru(i.datum_type)&&(t=function(l,c,h){if(c===kn)return{x:l.x+h[0],y:l.y+h[1],z:l.z+h[2]};if(c===Fn){var u=h[0],d=h[1],p=h[2],f=h[3],g=h[4],m=h[5],v=h[6];return{x:v*(l.x-m*l.y+g*l.z)+u,y:v*(m*l.x+l.y-f*l.z)+d,z:v*(-g*l.x+f*l.y+l.z)+p}}}(t,i.datum_type,i.datum_params)),Ru(e.datum_type)&&(t=function(l,c,h){if(c===kn)return{x:l.x-h[0],y:l.y-h[1],z:l.z-h[2]};if(c===Fn){var u=h[0],d=h[1],p=h[2],f=h[3],g=h[4],m=h[5],v=h[6],_=(l.x-u)/v,y=(l.y-d)/v,x=(l.z-p)/v;return{x:_+m*y-g*x,y:-m*_+y+f*x,z:g*_-f*y+x}}}(t,e.datum_type,e.datum_params)),t=yM(t,o,a,n),!(e.datum_type===Wo&&Wy(e,!0,t)!==0)))return t}function Wy(i,e,t){if(i.grids===null||i.grids.length===0)return-1;var r={x:-t.x,y:t.y},s={x:Number.NaN,y:Number.NaN},a=[];e:for(var n=0;n<i.grids.length;n++){var o=i.grids[n];if(a.push(o.name),o.isNull){s=r;break}if(o.mandatory,o.grid!==null)for(var l=o.grid.subgrids,c=0,h=l.length;c<h;c++){var u=l[c],d=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,p=u.ll[0]-d,f=u.ll[1]-d,g=u.ll[0]+(u.lim[0]-1)*u.del[0]+d,m=u.ll[1]+(u.lim[1]-1)*u.del[1]+d;if(!(f>r.y||p>r.x||m<r.y||g<r.x)&&(s=kE(r,e,u),!isNaN(s.x)))break e}else if(o.mandatory)return-1}return isNaN(s.x)?-1:(t.x=-s.x,t.y=s.y,0)}function kE(i,e,t){var r={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return r;var s={x:i.x,y:i.y};s.x-=t.ll[0],s.y-=t.ll[1],s.x=Ce(s.x-Math.PI)+Math.PI;var a=Xy(s,t);if(e){if(isNaN(a.x))return r;a.x=s.x-a.x,a.y=s.y-a.y;var n,o,l=9;do{if(o=Xy(a,t),isNaN(o.x))break;n={x:s.x-(o.x+a.x),y:s.y-(o.y+a.y)},a.x+=n.x,a.y+=n.y}while(l--&&Math.abs(n.x)>1e-12&&Math.abs(n.y)>1e-12);if(l<0)return r;r.x=Ce(a.x+t.ll[0]),r.y=a.y+t.ll[1]}else isNaN(a.x)||(r.x=i.x+a.x,r.y=i.y+a.y);return r}function Xy(i,e){var t,r={x:i.x/e.del[0],y:i.y/e.del[1]},s=Math.floor(r.x),a=Math.floor(r.y),n=r.x-1*s,o=r.y-1*a,l={x:Number.NaN,y:Number.NaN};if(s<0||s>=e.lim[0]||a<0||a>=e.lim[1])return l;t=a*e.lim[0]+s;var c=e.cvs[t][0],h=e.cvs[t][1];t++;var u=e.cvs[t][0],d=e.cvs[t][1];t+=e.lim[0];var p=e.cvs[t][0],f=e.cvs[t][1];t--;var g=e.cvs[t][0],m=e.cvs[t][1],v=n*o,_=n*(1-o),y=(1-n)*(1-o),x=(1-n)*o;return l.x=y*c+_*u+x*g+v*p,l.y=y*h+_*d+x*m+v*f,l}function qy(i,e,t){var r,s,a,n=t.x,o=t.y,l=t.z||0,c={};for(a=0;a<3;a++)if(!e||a!==2||t.z!==void 0)switch(a===0?(r=n,s="ew".indexOf(i.axis[a])!==-1?"x":"y"):a===1?(r=o,s="ns".indexOf(i.axis[a])!==-1?"y":"x"):(r=l,s="z"),i.axis[a]){case"e":case"n":c[s]=r;break;case"w":case"s":c[s]=-r;break;case"u":t[s]!==void 0&&(c.z=r);break;case"d":t[s]!==void 0&&(c.z=-r);break;default:return null}return c}function xM(i){var e={x:i[0],y:i[1]};return i.length>2&&(e.z=i[2]),i.length>3&&(e.m=i[3]),e}function Yy(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!=i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function Ld(i,e,t,r){var s,a=(t=Array.isArray(t)?xM(t):{x:t.x,y:t.y,z:t.z,m:t.m}).z!==void 0;if(function(n){Yy(n.x),Yy(n.y)}(t),i.datum&&e.datum&&function(n,o){return(n.datum.datum_type===kn||n.datum.datum_type===Fn||n.datum.datum_type===Wo)&&o.datumCode!=="WGS84"||(o.datum.datum_type===kn||o.datum.datum_type===Fn||o.datum.datum_type===Wo)&&n.datumCode!=="WGS84"}(i,e)&&(t=Ld(i,s=new _s("WGS84"),t,r),i=s),r&&i.axis!=="enu"&&(t=qy(i,!1,t)),i.projName==="longlat")t={x:t.x*Si,y:t.y*Si,z:t.z||0};else if(i.to_meter&&(t={x:t.x*i.to_meter,y:t.y*i.to_meter,z:t.z||0}),!(t=i.inverse(t)))return;if(i.from_greenwich&&(t.x+=i.from_greenwich),t=UE(i.datum,e.datum,t))return e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*ba,y:t.y*ba,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),r&&e.axis!=="enu"?qy(e,!0,t):(t&&!a&&delete t.z,t)}_s.projections=PE,_s.projections.start();var Zy=_s("WGS84");function Gm(i,e,t,r){var s,a,n;return Array.isArray(t)?(s=Ld(i,e,t,r)||{x:NaN,y:NaN},t.length>2?typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(t.splice(3)):[s.x,s.y,t[2]].concat(t.splice(3)):[s.x,s.y].concat(t.splice(2)):[s.x,s.y]):(a=Ld(i,e,t,r),(n=Object.keys(t)).length===2||n.forEach(function(o){if(typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;a[o]=t[o]}),a)}function Ky(i){return i instanceof _s?i:i.oProj?i.oProj:_s(i)}function Zi(i,e,t){i=Ky(i);var r,s=!1;return e===void 0?(e=i,i=Zy,s=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,e=i,i=Zy,s=!0),e=Ky(e),t?Gm(i,e,t):(r={forward:function(a,n){return Gm(i,e,a,n)},inverse:function(a,n){return Gm(e,i,a,n)}},s&&(r.oProj=e),r)}var Qy=6,bM="AJSAJS",MM="AFAFAF",Oo=65,Ki=73,Sr=79,lc=86,cc=90;const FE={forward:wM,inverse:function(i){var e=j0(AM(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:SM};function wM(i,e){return e=e||5,function(t,r){var s="00000"+t.easting,a="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(n=t.easting,o=t.northing,l=t.zoneNumber,c=TM(l),h=Math.floor(n/1e5),u=Math.floor(o/1e5)%20,function(d,p,f){var g=f-1,m=bM.charCodeAt(g),v=MM.charCodeAt(g),_=m+d-1,y=v+p,x=!1;return _>cc&&(_=_-cc+Oo-1,x=!0),(_===Ki||m<Ki&&_>Ki||(_>Ki||m<Ki)&&x)&&_++,(_===Sr||m<Sr&&_>Sr||(_>Sr||m<Sr)&&x)&&++_===Ki&&_++,_>cc&&(_=_-cc+Oo-1),y>lc?(y=y-lc+Oo-1,x=!0):x=!1,(y===Ki||v<Ki&&y>Ki||(y>Ki||v<Ki)&&x)&&y++,(y===Sr||v<Sr&&y>Sr||(y>Sr||v<Sr)&&x)&&++y===Ki&&y++,y>lc&&(y=y-lc+Oo-1),String.fromCharCode(_)+String.fromCharCode(y)}(h,u,c))+s.substr(s.length-5,r)+a.substr(a.length-5,r);var n,o,l,c,h,u}(function(t){var r,s,a,n,o,l,c,h,u=t.lat,d=t.lon,p=6378137,f=.00669438,g=.9996,m=jm(u),v=jm(d);h=Math.floor((d+180)/6)+1,d===180&&(h=60),u>=56&&u<64&&d>=3&&d<12&&(h=32),u>=72&&u<84&&(d>=0&&d<9?h=31:d>=9&&d<21?h=33:d>=21&&d<33?h=35:d>=33&&d<42&&(h=37)),c=jm(6*(h-1)-180+3),r=f/(1-f),s=p/Math.sqrt(1-f*Math.sin(m)*Math.sin(m)),a=Math.tan(m)*Math.tan(m),n=r*Math.cos(m)*Math.cos(m),o=Math.cos(m)*(v-c),l=p*((1-f/4-3*f*f/64-5*f*f*f/256)*m-(3*f/8+3*f*f/32+45*f*f*f/1024)*Math.sin(2*m)+(15*f*f/256+45*f*f*f/1024)*Math.sin(4*m)-35*f*f*f/3072*Math.sin(6*m));var _=g*s*(o+(1-a+n)*o*o*o/6+(5-18*a+a*a+72*n-58*r)*o*o*o*o*o/120)+5e5,y=g*(l+s*Math.tan(m)*(o*o/2+(5-a+9*n+4*n*n)*o*o*o*o/24+(61-58*a+a*a+600*n-330*r)*o*o*o*o*o*o/720));return u<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(_),zoneNumber:h,zoneLetter:BE(u)}}({lat:i[1],lon:i[0]}),e)}function SM(i){var e=j0(AM(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function jm(i){return i*(Math.PI/180)}function Jy(i){return i/Math.PI*180}function j0(i){var e=i.northing,t=i.easting,r=i.zoneLetter,s=i.zoneNumber;if(s<0||s>60)return null;var a,n,o,l,c,h,u,d,p,f=.9996,g=6378137,m=.00669438,v=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),_=t-5e5,y=e;r<"N"&&(y-=1e7),u=6*(s-1)-180+3,a=.006739496752268451,p=(d=y/f/6367449145945056e-9)+(3*v/2-27*v*v*v/32)*Math.sin(2*d)+(21*v*v/16-55*v*v*v*v/32)*Math.sin(4*d)+151*v*v*v/96*Math.sin(6*d),n=g/Math.sqrt(1-m*Math.sin(p)*Math.sin(p)),o=Math.tan(p)*Math.tan(p),l=a*Math.cos(p)*Math.cos(p),c=.99330562*g/Math.pow(1-m*Math.sin(p)*Math.sin(p),1.5),h=_/(n*f);var x=p-n*Math.tan(p)/c*(h*h/2-(5+3*o+10*l-4*l*l-9*a)*h*h*h*h/24+(61+90*o+298*l+45*o*o-1.6983531815716497-3*l*l)*h*h*h*h*h*h/720);x=Jy(x);var b,M=(h-(1+2*o+l)*h*h*h/6+(5-2*l+28*o-3*l*l+8*a+24*o*o)*h*h*h*h*h/120)/Math.cos(p);if(M=u+Jy(M),i.accuracy){var T=j0({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});b={top:T.lat,right:T.lon,bottom:x,left:M}}else b={lat:x,lon:M};return b}function BE(i){var e="Z";return 84>=i&&i>=72?e="X":72>i&&i>=64?e="W":64>i&&i>=56?e="V":56>i&&i>=48?e="U":48>i&&i>=40?e="T":40>i&&i>=32?e="S":32>i&&i>=24?e="R":24>i&&i>=16?e="Q":16>i&&i>=8?e="P":8>i&&i>=0?e="N":0>i&&i>=-8?e="M":-8>i&&i>=-16?e="L":-16>i&&i>=-24?e="K":-24>i&&i>=-32?e="J":-32>i&&i>=-40?e="H":-40>i&&i>=-48?e="G":-48>i&&i>=-56?e="F":-56>i&&i>=-64?e="E":-64>i&&i>=-72?e="D":-72>i&&i>=-80&&(e="C"),e}function TM(i){var e=i%Qy;return e===0&&(e=Qy),e}function AM(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var e,t=i.length,r=null,s="",a=0;!/[A-Z]/.test(e=i.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+i;s+=e,a++}var n=parseInt(s,10);if(a===0||a+3>t)throw"MGRSPoint bad conversion from: "+i;var o=i.charAt(a++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+i;r=i.substring(a,a+=2);for(var l=TM(n),c=function(_,y){for(var x=bM.charCodeAt(y-1),b=1e5,M=!1;x!==_.charCodeAt(0);){if(++x===Ki&&x++,x===Sr&&x++,x>cc){if(M)throw"Bad character: "+_;x=Oo,M=!0}b+=1e5}return b}(r.charAt(0),l),h=function(_,y){if(_>"V")throw"MGRSPoint given invalid Northing "+_;for(var x=MM.charCodeAt(y-1),b=0,M=!1;x!==_.charCodeAt(0);){if(++x===Ki&&x++,x===Sr&&x++,x>lc){if(M)throw"Bad character: "+_;x=Oo,M=!0}b+=1e5}return b}(r.charAt(1),l);h<zE(o);)h+=2e6;var u=t-a;if(u%2!=0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var d,p,f,g=u/2,m=0,v=0;return g>0&&(d=1e5/Math.pow(10,g),p=i.substring(a,a+g),m=parseFloat(p)*d,f=i.substring(a+g),v=parseFloat(f)*d),{easting:m+c,northing:v+h,zoneLetter:o,zoneNumber:n,accuracy:d}}function zE(i){var e;switch(i){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+i}function Xo(i,e,t){if(!(this instanceof Xo))return new Xo(i,e,t);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&e===void 0){var r=i.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=i,this.y=e,this.z=t||0}Xo.fromMGRS=function(i){return new Xo(SM(i))},Xo.prototype.toMGRS=function(i){return wM([this.x,this.y],i)};var VE=1,HE=.25,$y=.046875,e1=.01953125,t1=.01068115234375,GE=.75,jE=.46875,WE=.013020833333333334,XE=.007120768229166667,qE=.3645833333333333,YE=.005696614583333333,ZE=.3076171875;function EM(i){var e=[];e[0]=VE-i*(HE+i*($y+i*(e1+i*t1))),e[1]=i*(GE-i*($y+i*(e1+i*t1)));var t=i*i;return e[2]=t*(jE-i*(WE+i*XE)),t*=i,e[3]=t*(qE-i*YE),e[4]=t*i*ZE,e}function Nd(i,e,t,r){return t*=e,e*=e,r[0]*i-t*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}var KE=20;function CM(i,e,t){for(var r=1/(1-e),s=i,a=KE;a;--a){var n=Math.sin(s),o=1-e*n*n;if(s-=o=(Nd(s,n,Math.cos(s),t)-i)*(o*Math.sqrt(o))*r,Math.abs(o)<Ae)return s}return s}const ld={init:function(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=EM(this.es),this.ml0=Nd(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(i){var e,t,r,s=i.x,a=i.y,n=Ce(s-this.long0),o=Math.sin(a),l=Math.cos(a);if(this.es){var c=l*n,h=Math.pow(c,2),u=this.ep2*Math.pow(l,2),d=Math.pow(u,2),p=Math.abs(l)>Ae?Math.tan(a):0,f=Math.pow(p,2),g=Math.pow(f,2);e=1-this.es*Math.pow(o,2),c/=Math.sqrt(e);var m=Nd(a,o,l,this.en);t=this.a*(this.k0*c*(1+h/6*(1-f+u+h/20*(5-18*f+g+14*u-58*f*u+h/42*(61+179*g-g*f-479*f)))))+this.x0,r=this.a*(this.k0*(m-this.ml0+o*n*c/2*(1+h/12*(5-f+9*u+4*d+h/30*(61+g-58*f+270*u-330*f*u+h/56*(1385+543*g-g*f-3111*f))))))+this.y0}else{var v=l*Math.sin(n);if(Math.abs(Math.abs(v)-1)<Ae)return 93;if(t=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,r=l*Math.cos(n)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(r))>=1){if(v-1>Ae)return 93;r=0}else r=Math.acos(r);a<0&&(r=-r),r=this.a*this.k0*(r-this.lat0)+this.y0}return i.x=t,i.y=r,i},inverse:function(i){var e,t,r,s,a=(i.x-this.x0)*(1/this.a),n=(i.y-this.y0)*(1/this.a);if(this.es)if(t=CM(e=this.ml0+n/this.k0,this.es,this.en),Math.abs(t)<be){var o=Math.sin(t),l=Math.cos(t),c=Math.abs(l)>Ae?Math.tan(t):0,h=this.ep2*Math.pow(l,2),u=Math.pow(h,2),d=Math.pow(c,2),p=Math.pow(d,2);e=1-this.es*Math.pow(o,2);var f=a*Math.sqrt(e)/this.k0,g=Math.pow(f,2);r=t-(e*=c)*g/(1-this.es)*.5*(1-g/12*(5+3*d-9*h*d+h-4*u-g/30*(61+90*d-252*h*d+45*p+46*h-g/56*(1385+3633*d+4095*p+1574*p*d)))),s=Ce(this.long0+f*(1-g/6*(1+2*d+h-g/20*(5+28*d+24*p+8*h*d+6*h-g/42*(61+662*d+1320*p+720*p*d))))/l)}else r=be*xh(n),s=0;else{var m=Math.exp(a/this.k0),v=.5*(m-1/m),_=this.lat0+n/this.k0,y=Math.cos(_);e=Math.sqrt((1-Math.pow(y,2))/(1+Math.pow(v,2))),r=Math.asin(e),n<0&&(r=-r),s=v===0&&y===0?0:Ce(Math.atan2(v,y)+this.long0)}return i.x=s,i.y=r,i},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function RM(i){var e=Math.exp(i);return e=(e-1/e)/2}function Ar(i,e){i=Math.abs(i),e=Math.abs(e);var t=Math.max(i,e),r=Math.min(i,e)/(t||1);return t*Math.sqrt(1+Math.pow(r,2))}function QE(i){var e=Math.abs(i);return e=function(t){var r=1+t,s=r-1;return s===0?t:t*Math.log(r)/s}(e*(1+e/(Ar(1,e)+1))),i<0?-e:e}function Wm(i,e){for(var t,r=2*Math.cos(2*e),s=i.length-1,a=i[s],n=0;--s>=0;)t=r*a-n+i[s],n=a,a=t;return e+t*Math.sin(2*e)}function i1(i,e,t){for(var r,s,a=Math.sin(e),n=Math.cos(e),o=RM(t),l=function(m){var v=Math.exp(m);return(v+1/v)/2}(t),c=2*n*l,h=-2*a*o,u=i.length-1,d=i[u],p=0,f=0,g=0;--u>=0;)r=f,s=p,d=c*(f=d)-r-h*(p=g)+i[u],g=h*f-s+c*p;return[(c=a*l)*d-(h=n*o)*g,c*g+h*d]}const cd={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(ld.init.apply(this),this.forward=ld.forward,this.inverse=ld.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),e=i/(2-i),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),t*=e,this.cgb[1]=t*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t*=e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),t*=e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(e*(-24832/14175)-2.4)),t*=e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t*=e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),t*=e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t*=e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t*=e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t*=e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=.6650675310896665*t;var r=Wm(this.cbg,this.lat0);this.Zb=-this.Qn*(r+function(s,a){for(var n,o=2*Math.cos(a),l=s.length-1,c=s[l],h=0;--l>=0;)n=o*c-h+s[l],h=c,c=n;return Math.sin(a)*n}(this.gtu,2*r))},forward:function(i){var e=Ce(i.x-this.long0),t=i.y;t=Wm(this.cbg,t);var r=Math.sin(t),s=Math.cos(t),a=Math.sin(e),n=Math.cos(e);t=Math.atan2(r,n*s),e=Math.atan2(a*s,Ar(r,s*n)),e=QE(Math.tan(e));var o,l,c=i1(this.gtu,2*t,2*e);return t+=c[0],e+=c[1],Math.abs(e)<=2.623395162778?(o=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*t+this.Zb)+this.y0):(o=1/0,l=1/0),i.x=o,i.y=l,i},inverse:function(i){var e,t,r=(i.x-this.x0)*(1/this.a),s=(i.y-this.y0)*(1/this.a);if(s=(s-this.Zb)/this.Qn,r/=this.Qn,Math.abs(r)<=2.623395162778){var a=i1(this.utg,2*s,2*r);s+=a[0],r+=a[1],r=Math.atan(RM(r));var n=Math.sin(s),o=Math.cos(s),l=Math.sin(r),c=Math.cos(r);s=Math.atan2(n*c,Ar(l,c*o)),e=Ce((r=Math.atan2(l,c*o))+this.long0),t=Wm(this.cgb,s)}else e=1/0,t=1/0;return i.x=e,i.y=t,i},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]},JE={init:function(){var i=function(e,t){if(e===void 0){if((e=Math.floor(30*(Ce(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*Si,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,cd.init.apply(this),this.forward=cd.forward,this.inverse=cd.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Xm(i,e){return Math.pow((1-i)/(1+i),e)}const qm={init:function(){var i=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+mt)/(Math.pow(Math.tan(.5*this.lat0+mt),this.C)*Xm(this.e*i,this.ratexp))},forward:function(i){var e=i.x,t=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+mt),this.C)*Xm(this.e*Math.sin(t),this.ratexp))-be,i.x=this.C*e,i},inverse:function(i){for(var e=i.x/this.C,t=i.y,r=Math.pow(Math.tan(.5*t+mt)/this.K,1/this.C),s=20;s>0&&(t=2*Math.atan(r*Xm(this.e*Math.sin(i.y),-.5*this.e))-be,!(Math.abs(t-i.y)<1e-14));--s)i.y=t;return s?(i.x=e,i.y=t,i):null},names:["gauss"]},$E={init:function(){qm.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(i){var e,t,r,s;return i.x=Ce(i.x-this.long0),qm.forward.apply(this,[i]),e=Math.sin(i.y),t=Math.cos(i.y),r=Math.cos(i.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*r),i.x=s*t*Math.sin(i.x),i.y=s*(this.cosc0*e-this.sinc0*t*r),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i},inverse:function(i){var e,t,r,s,a;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,a=Ar(i.x,i.y)){var n=2*Math.atan2(a,this.R2);e=Math.sin(n),t=Math.cos(n),s=Math.asin(t*this.sinc0+i.y*e*this.cosc0/a),r=Math.atan2(i.x*e,a*this.cosc0*t-i.y*this.sinc0*e)}else s=this.phic0,r=0;return i.x=r,i.y=s,qm.inverse.apply(this,[i]),i.x=Ce(i.x+this.long0),i},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},eC={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ae&&(this.k0=.5*(1+xh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Ae&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ae&&Math.abs(Math.cos(this.lat_ts))>Ae&&(this.k0=.5*this.cons*Ms(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Xr(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Ms(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-be,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(i){var e,t,r,s,a,n,o=i.x,l=i.y,c=Math.sin(l),h=Math.cos(l),u=Ce(o-this.long0);return Math.abs(Math.abs(o-this.long0)-Math.PI)<=Ae&&Math.abs(l+this.lat0)<=Ae?(i.x=NaN,i.y=NaN,i):this.sphere?(e=2*this.k0/(1+this.sinlat0*c+this.coslat0*h*Math.cos(u)),i.x=this.a*e*h*Math.sin(u)+this.x0,i.y=this.a*e*(this.coslat0*c-this.sinlat0*h*Math.cos(u))+this.y0,i):(t=2*Math.atan(this.ssfn_(l,c,this.e))-be,s=Math.cos(t),r=Math.sin(t),Math.abs(this.coslat0)<=Ae?(a=Xr(this.e,l*this.con,this.con*c),n=2*this.a*this.k0*a/this.cons,i.x=this.x0+n*Math.sin(o-this.long0),i.y=this.y0-this.con*n*Math.cos(o-this.long0),i):(Math.abs(this.sinlat0)<Ae?(e=2*this.a*this.k0/(1+s*Math.cos(u)),i.y=e*r):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*s*Math.cos(u))),i.y=e*(this.cosX0*r-this.sinX0*s*Math.cos(u))+this.y0),i.x=e*s*Math.sin(u)+this.x0,i))},inverse:function(i){var e,t,r,s,a;i.x-=this.x0,i.y-=this.y0;var n=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var o=2*Math.atan(n/(2*this.a*this.k0));return e=this.long0,t=this.lat0,n<=Ae?(i.x=e,i.y=t,i):(t=Math.asin(Math.cos(o)*this.sinlat0+i.y*Math.sin(o)*this.coslat0/n),e=Math.abs(this.coslat0)<Ae?this.lat0>0?Ce(this.long0+Math.atan2(i.x,-1*i.y)):Ce(this.long0+Math.atan2(i.x,i.y)):Ce(this.long0+Math.atan2(i.x*Math.sin(o),n*this.coslat0*Math.cos(o)-i.y*this.sinlat0*Math.sin(o))),i.x=e,i.y=t,i)}if(Math.abs(this.coslat0)<=Ae){if(n<=Ae)return t=this.lat0,e=this.long0,i.x=e,i.y=t,i;i.x*=this.con,i.y*=this.con,r=n*this.cons/(2*this.a*this.k0),t=this.con*Qc(this.e,r),e=this.con*Ce(this.con*this.long0+Math.atan2(i.x,-1*i.y))}else s=2*Math.atan(n*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,n<=Ae?a=this.X0:(a=Math.asin(Math.cos(s)*this.sinX0+i.y*Math.sin(s)*this.cosX0/n),e=Ce(this.long0+Math.atan2(i.x*Math.sin(s),n*this.cosX0*Math.cos(s)-i.y*this.sinX0*Math.sin(s)))),t=-1*Qc(this.e,Math.tan(.5*(be+a)));return i.x=e,i.y=t,i},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(i,e,t){return e*=t,Math.tan(.5*(be+i))*Math.pow((1-e)/(1+e),.5*t)}},tC={init:function(){var i=this.lat0;this.lambda0=this.long0;var e=Math.sin(i),t=this.a,r=1/this.rf,s=2*r-Math.pow(r,2),a=this.e=Math.sqrt(s);this.R=this.k0*t*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(e/this.alpha);var n=Math.log(Math.tan(Math.PI/4+this.b0/2)),o=Math.log(Math.tan(Math.PI/4+i/2)),l=Math.log((1+a*e)/(1-a*e));this.K=n-this.alpha*o+this.alpha*a/2*l},forward:function(i){var e=Math.log(Math.tan(Math.PI/4-i.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),r=-this.alpha*(e+t)+this.K,s=2*(Math.atan(Math.exp(r))-Math.PI/4),a=this.alpha*(i.x-this.lambda0),n=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(a));return i.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,i.x=this.R*n+this.x0,i},inverse:function(i){for(var e=i.x-this.x0,t=i.y-this.y0,r=e/this.R,s=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(r)),n=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+n/this.alpha,l=0,c=a,h=-1e3,u=0;Math.abs(c-h)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),h=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return i.x=o,i.y=c,i},names:["somerc"]};var Mo=1e-7;const iC={init:function(){var i,e,t,r,s,a,n,o,l,c,h,u,d,p=0,f=0,g=0,m=0,v=0,_=0,y=0;this.no_off=(d=typeof(u=this).PROJECTION=="object"?Object.keys(u.PROJECTION)[0]:u.PROJECTION,"no_uoff"in u||"no_off"in u||["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(d)!==-1),this.no_rot="no_rot"in this;var x=!1;"alpha"in this&&(x=!0);var b=!1;if("rectified_grid_angle"in this&&(b=!0),x&&(y=this.alpha),b&&(p=this.rectified_grid_angle*Si),x||b)f=this.longc;else if(g=this.long1,v=this.lat1,m=this.long2,_=this.lat2,Math.abs(v-_)<=Mo||(i=Math.abs(v))<=Mo||Math.abs(i-be)<=Mo||Math.abs(Math.abs(this.lat0)-be)<=Mo||Math.abs(Math.abs(_)-be)<=Mo)throw new Error;var M=1-this.es;e=Math.sqrt(M),Math.abs(this.lat0)>Ae?(o=Math.sin(this.lat0),t=Math.cos(this.lat0),i=1-this.es*o*o,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/M),this.A=this.B*this.k0*e/i,(s=(r=this.B*e/(t*Math.sqrt(i)))*r-1)<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=r,this.E*=Math.pow(Xr(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=r=s=1),x||b?(x?(h=Math.asin(Math.sin(y)/r),b||(p=y)):(h=p,y=Math.asin(r*Math.sin(h))),this.lam0=f-Math.asin(.5*(s-1/s)*Math.tan(h))/this.B):(a=Math.pow(Xr(this.e,v,Math.sin(v)),this.B),n=Math.pow(Xr(this.e,_,Math.sin(_)),this.B),s=this.E/a,l=(n-a)/(n+a),c=((c=this.E*this.E)-n*a)/(c+n*a),(i=g-m)<-Math.pi?m-=Kc:i>Math.pi&&(m+=Kc),this.lam0=Ce(.5*(g+m)-Math.atan(c*Math.tan(.5*this.B*(g-m))/l)/this.B),h=Math.atan(2*Math.sin(this.B*Ce(g-this.lam0))/(s-1/s)),p=y=Math.asin(r*Math.sin(h))),this.singam=Math.sin(h),this.cosgam=Math.cos(h),this.sinrot=Math.sin(p),this.cosrot=Math.cos(p),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(y))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*h,this.v_pole_n=this.ArB*Math.log(Math.tan(mt-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(mt+s))},forward:function(i){var e,t,r,s,a,n,o,l,c={};if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-be)>Ae){if(e=.5*((a=this.E/Math.pow(Xr(this.e,i.y,Math.sin(i.y)),this.B))-(n=1/a)),t=.5*(a+n),s=Math.sin(this.B*i.x),r=(e*this.singam-s*this.cosgam)/t,Math.abs(Math.abs(r)-1)<Ae)throw new Error;l=.5*this.ArB*Math.log((1-r)/(1+r)),n=Math.cos(this.B*i.x),o=Math.abs(n)<Mo?this.A*i.x:this.ArB*Math.atan2(e*this.cosgam+s*this.singam,n)}else l=i.y>0?this.v_pole_n:this.v_pole_s,o=this.ArB*i.y;return this.no_rot?(c.x=o,c.y=l):(o-=this.u_0,c.x=l*this.cosrot+o*this.sinrot,c.y=o*this.cosrot-l*this.sinrot),c.x=this.a*c.x+this.x0,c.y=this.a*c.y+this.y0,c},inverse:function(i){var e,t,r,s,a,n,o,l={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(t=i.y,e=i.x):(t=i.x*this.cosrot-i.y*this.sinrot,e=i.y*this.cosrot+i.x*this.sinrot+this.u_0),s=.5*((r=Math.exp(-this.BrA*t))-1/r),a=.5*(r+1/r),o=((n=Math.sin(this.BrA*e))*this.cosgam+s*this.singam)/a,Math.abs(Math.abs(o)-1)<Ae)l.x=0,l.y=o<0?-be:be;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=Qc(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-n*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},rC={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Ae)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),r=Ms(this.e,e,t),s=Xr(this.e,this.lat1,e),a=Math.sin(this.lat2),n=Math.cos(this.lat2),o=Ms(this.e,a,n),l=Xr(this.e,this.lat2,a),c=Xr(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Ae?this.ns=Math.log(r/o)/Math.log(s/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=r/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(i){var e=i.x,t=i.y;Math.abs(2*Math.abs(t)-Math.PI)<=Ae&&(t=xh(t)*(be-2*Ae));var r,s,a=Math.abs(Math.abs(t)-be);if(a>Ae)r=Xr(this.e,t,Math.sin(t)),s=this.a*this.f0*Math.pow(r,this.ns);else{if((a=t*this.ns)<=0)return null;s=0}var n=this.ns*Ce(e-this.long0);return i.x=this.k0*(s*Math.sin(n))+this.x0,i.y=this.k0*(this.rh-s*Math.cos(n))+this.y0,i},inverse:function(i){var e,t,r,s,a,n=(i.x-this.x0)/this.k0,o=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(n*n+o*o),t=1):(e=-Math.sqrt(n*n+o*o),t=-1);var l=0;if(e!==0&&(l=Math.atan2(t*n,t*o)),e!==0||this.ns>0){if(t=1/this.ns,r=Math.pow(e/(this.a*this.f0),t),(s=Qc(this.e,r))===-9999)return null}else s=-be;return a=Ce(l/this.ns+this.long0),i.x=a,i.y=s,i},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},sC={init:function(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(i){var e,t,r,s,a,n,o,l=i.x,c=i.y,h=Ce(l-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),r=-h*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(r)),a=Math.asin(Math.cos(t)*Math.sin(r)/Math.cos(s)),n=this.n*a,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),i.y=o*Math.cos(n)/1,i.x=o*Math.sin(n)/1,this.czech||(i.y*=-1,i.x*=-1),i},inverse:function(i){var e,t,r,s,a,n,o,l=i.x;i.x=i.y,i.y=l,this.czech||(i.y*=-1,i.x*=-1),a=Math.sqrt(i.x*i.x+i.y*i.y),s=Math.atan2(i.y,i.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(s)),t=Math.asin(Math.cos(r)*Math.sin(s)/Math.cos(e)),i.x=this.long0-t/this.alfa,n=e,o=0;var c=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(n))/(1-this.e*Math.sin(n)),this.e/2))-this.s45),Math.abs(n-i.y)<1e-10&&(o=1),n=i.y,c+=1;while(o===0&&c<15);return c>=15?null:i},names:["Krovak","krovak"]};function Hi(i,e,t,r,s){return i*s-e*Math.sin(2*s)+t*Math.sin(4*s)-r*Math.sin(6*s)}function Jc(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function $c(i){return .375*i*(1+.25*i*(1+.46875*i))}function eh(i){return .05859375*i*i*(1+.75*i)}function th(i){return i*i*i*(35/3072)}function qo(i,e,t){var r=e*t;return i/Math.sqrt(1-r*r)}function gl(i){return Math.abs(i)<be?i:i-xh(i)*Math.PI}function Dd(i,e,t,r,s){var a,n;a=i/e;for(var o=0;o<15;o++)if(a+=n=(i-(e*a-t*Math.sin(2*a)+r*Math.sin(4*a)-s*Math.sin(6*a)))/(e-2*t*Math.cos(2*a)+4*r*Math.cos(4*a)-6*s*Math.cos(6*a)),Math.abs(n)<=1e-10)return a;return NaN}const aC={init:function(){this.sphere||(this.e0=Jc(this.es),this.e1=$c(this.es),this.e2=eh(this.es),this.e3=th(this.es),this.ml0=this.a*Hi(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(i){var e,t,r=i.x,s=i.y;if(r=Ce(r-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(r)),t=this.a*(Math.atan2(Math.tan(s),Math.cos(r))-this.lat0);else{var a=Math.sin(s),n=Math.cos(s),o=qo(this.a,this.e,a),l=Math.tan(s)*Math.tan(s),c=r*Math.cos(s),h=c*c,u=this.es*n*n/(1-this.es);e=o*c*(1-h*l*(1/6-(8-l+8*u)*h/120)),t=this.a*Hi(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+o*a/n*h*(.5+(5-l+6*u)*h/24)}return i.x=e+this.x0,i.y=t+this.y0,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var e,t,r=i.x/this.a,s=i.y/this.a;if(this.sphere){var a=s+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(r)),t=Math.atan2(Math.tan(r),Math.cos(a))}else{var n=Dd(this.ml0/this.a+s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(n)-be)<=Ae)return i.x=this.long0,i.y=be,s<0&&(i.y*=-1),i;var o=qo(this.a,this.e,Math.sin(n)),l=o*o*o/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(n),2),h=r*this.a/o,u=h*h;e=n-o*Math.tan(n)/l*h*h*(.5-(1+3*c)*h*h/24),t=h*(1-u*(c/3+(1+3*c)*c*u/15))/Math.cos(n)}return i.x=Ce(t+this.long0),i.y=gl(e),i},names:["Cassini","Cassini_Soldner","cass"]};function wa(i,e){var t;return i>1e-7?(1-i*i)*(e/(1-(t=i*e)*t)-.5/i*Math.log((1-t)/(1+t))):2*e}var nC=.3333333333333333,oC=.17222222222222222,lC=.10257936507936508,cC=.06388888888888888,hC=.0664021164021164,uC=.016415012942191543;const dC={init:function(){var i,e=Math.abs(this.lat0);if(Math.abs(e-be)<Ae?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Ae?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=wa(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var r,s=[];return s[0]=t*nC,r=t*t,s[0]+=r*oC,s[1]=r*cC,r*=t,s[0]+=r*lC,s[1]+=r*hC,s[2]=r*uC,s}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),i=Math.sin(this.lat0),this.sinb1=wa(this.e,i)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*i*i)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(i){var e,t,r,s,a,n,o,l,c,h,u=i.x,d=i.y;if(u=Ce(u-this.long0),this.sphere){if(a=Math.sin(d),h=Math.cos(d),r=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((t=this.mode===this.EQUIT?1+h*r:1+this.sinph0*a+this.cosph0*h*r)<=Ae)return null;e=(t=Math.sqrt(2/t))*h*Math.sin(u),t*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*h*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(d+this.lat0)<Ae)return null;t=mt-.5*d,e=(t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)))*Math.sin(u),t*=r}}else{switch(o=0,l=0,c=0,r=Math.cos(u),s=Math.sin(u),a=Math.sin(d),n=wa(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=n/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:c=1+this.sinb1*o+this.cosb1*l*r;break;case this.EQUIT:c=1+l*r;break;case this.N_POLE:c=be+d,n=this.qp-n;break;case this.S_POLE:c=d-be,n=this.qp+n}if(Math.abs(c)<Ae)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),t=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*o-this.sinb1*l*r):(c=Math.sqrt(2/(1+l*r)))*o*this.ymf,e=this.xmf*c*l*s;break;case this.N_POLE:case this.S_POLE:n>=0?(e=(c=Math.sqrt(n))*s,t=r*(this.mode===this.S_POLE?c:-c)):e=t=0}}return i.x=this.a*e+this.x0,i.y=this.a*t+this.y0,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var e,t,r,s,a,n,o,l,c,h,u=i.x/this.a,d=i.y/this.a;if(this.sphere){var p,f=0,g=0;if((t=.5*(p=Math.sqrt(u*u+d*d)))>1)return null;switch(t=2*Math.asin(t),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(g=Math.sin(t),f=Math.cos(t)),this.mode){case this.EQUIT:t=Math.abs(p)<=Ae?0:Math.asin(d*g/p),u*=g,d=f*p;break;case this.OBLIQ:t=Math.abs(p)<=Ae?this.lat0:Math.asin(f*this.sinph0+d*g*this.cosph0/p),u*=g*this.cosph0,d=(f-Math.sin(t)*this.sinph0)*p;break;case this.N_POLE:d=-d,t=be-t;break;case this.S_POLE:t-=be}e=d!==0||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,d):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,d*=this.dd,(n=Math.sqrt(u*u+d*d))<Ae)return i.x=this.long0,i.y=this.lat0,i;s=2*Math.asin(.5*n/this.rq),r=Math.cos(s),u*=s=Math.sin(s),this.mode===this.OBLIQ?(o=r*this.sinb1+d*s*this.cosb1/n,a=this.qp*o,d=n*this.cosb1*r-d*this.sinb1*s):(o=d*s/n,a=this.qp*o,d=n*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),!(a=u*u+d*d))return i.x=this.long0,i.y=this.lat0,i;o=1-a/this.qp,this.mode===this.S_POLE&&(o=-o)}e=Math.atan2(u,d),l=Math.asin(o),c=this.apa,h=l+l,t=l+c[0]*Math.sin(h)+c[1]*Math.sin(h+h)+c[2]*Math.sin(h+h+h)}return i.x=Ce(this.long0+e),i.y=t,i},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Va(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}const pC={init:function(){Math.abs(this.lat1+this.lat2)<Ae||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Ms(this.e3,this.sin_po,this.cos_po),this.qs1=wa(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Ms(this.e3,this.sin_po,this.cos_po),this.qs2=wa(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=wa(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Ae?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(i){var e=i.x,t=i.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var r=wa(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,a=this.ns0*Ce(e-this.long0),n=s*Math.sin(a)+this.x0,o=this.rh-s*Math.cos(a)+this.y0;return i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s,a,n;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),r=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),r=-1),s=0,e!==0&&(s=Math.atan2(r*i.x,r*i.y)),r=e*this.ns0/this.a,this.sphere?n=Math.asin((this.c-r*r)/(2*this.ns0)):(t=(this.c-r*r)/this.ns0,n=this.phi1z(this.e3,t)),a=Ce(s/this.ns0+this.long0),i.x=a,i.y=n,i},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(i,e){var t,r,s,a,n=Va(.5*e);if(i<Ae)return n;for(var o=i*i,l=1;l<=25;l++)if(n+=a=.5*(s=1-(r=i*(t=Math.sin(n)))*r)*s/Math.cos(n)*(e/(1-o)-t/s+.5/i*Math.log((1-r)/(1+r))),Math.abs(a)<=1e-7)return n;return null}},mC={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(i){var e,t,r,s,a,n,o,l=i.x,c=i.y;return r=Ce(l-this.long0),e=Math.sin(c),t=Math.cos(c),s=Math.cos(r),(a=this.sin_p14*e+this.cos_p14*t*s)>0||Math.abs(a)<=Ae?(n=this.x0+1*this.a*t*Math.sin(r)/a,o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*t*s)/a):(n=this.x0+this.infinity_dist*t*Math.sin(r),o=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*s)),i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s,a,n;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(e=Math.sqrt(i.x*i.x+i.y*i.y))?(s=Math.atan2(e,this.rc),t=Math.sin(s),n=Va((r=Math.cos(s))*this.sin_p14+i.y*t*this.cos_p14/e),a=Math.atan2(i.x*t,e*this.cos_p14*r-i.y*this.sin_p14*t),a=Ce(this.long0+a)):(n=this.phic0,a=0),i.x=a,i.y=n,i},names:["gnom"]},fC={init:function(){this.sphere||(this.k0=Ms(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(i){var e,t,r=i.x,s=i.y,a=Ce(r-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),t=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var n=wa(this.e,Math.sin(s));e=this.x0+this.a*this.k0*a,t=this.y0+this.a*n*.5/this.k0}return i.x=e,i.y=t,i},inverse:function(i){var e,t;return i.x-=this.x0,i.y-=this.y0,this.sphere?(e=Ce(this.long0+i.x/this.a/Math.cos(this.lat_ts)),t=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(t=function(r,s){var a=1-(1-r*r)/(2*r)*Math.log((1-r)/(1+r));if(Math.abs(Math.abs(s)-a)<1e-6)return s<0?-1*be:be;for(var n,o,l,c,h=Math.asin(.5*s),u=0;u<30;u++)if(o=Math.sin(h),l=Math.cos(h),c=r*o,h+=n=Math.pow(1-c*c,2)/(2*l)*(s/(1-r*r)-o/(1-c*c)+.5/r*Math.log((1-c)/(1+c))),Math.abs(n)<=1e-10)return h;return NaN}(this.e,2*i.y*this.k0/this.a),e=Ce(this.long0+i.x/(this.a*this.k0))),i.x=e,i.y=t,i},names:["cea"]},gC={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(i){var e=i.x,t=i.y,r=Ce(e-this.long0),s=gl(t-this.lat0);return i.x=this.x0+this.a*r*this.rc,i.y=this.y0+this.a*s,i},inverse:function(i){var e=i.x,t=i.y;return i.x=Ce(this.long0+(e-this.x0)/(this.a*this.rc)),i.y=gl(this.lat0+(t-this.y0)/this.a),i},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},vC={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Jc(this.es),this.e1=$c(this.es),this.e2=eh(this.es),this.e3=th(this.es),this.ml0=this.a*Hi(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(i){var e,t,r,s=i.x,a=i.y,n=Ce(s-this.long0);if(r=n*Math.sin(a),this.sphere)Math.abs(a)<=Ae?(e=this.a*n,t=-1*this.a*this.lat0):(e=this.a*Math.sin(r)/Math.tan(a),t=this.a*(gl(a-this.lat0)+(1-Math.cos(r))/Math.tan(a)));else if(Math.abs(a)<=Ae)e=this.a*n,t=-1*this.ml0;else{var o=qo(this.a,this.e,Math.sin(a))/Math.tan(a);e=o*Math.sin(r),t=this.a*Hi(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+o*(1-Math.cos(r))}return i.x=e+this.x0,i.y=t+this.y0,i},inverse:function(i){var e,t,r,s,a,n,o,l,c;if(r=i.x-this.x0,s=i.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=Ae)e=Ce(r/this.a+this.long0),t=0;else{var h;for(n=this.lat0+s/this.a,o=r*r/this.a/this.a+n*n,l=n,a=20;a;--a)if(l+=c=-1*(n*(l*(h=Math.tan(l))+1)-l-.5*(l*l+o)*h)/((l-n)/h-1),Math.abs(c)<=Ae){t=l;break}e=Ce(this.long0+Math.asin(r*Math.tan(l)/this.a)/Math.sin(t))}else if(Math.abs(s+this.ml0)<=Ae)t=0,e=Ce(this.long0+r/this.a);else{var u,d,p,f,g;for(n=(this.ml0+s)/this.a,o=r*r/this.a/this.a+n*n,l=n,a=20;a;--a)if(g=this.e*Math.sin(l),u=Math.sqrt(1-g*g)*Math.tan(l),d=this.a*Hi(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=c=(n*(u*(f=d/this.a)+1)-f-.5*u*(f*f+o))/(this.es*Math.sin(2*l)*(f*f+o-2*n*f)/(4*u)+(n-f)*(u*p-2/Math.sin(2*l))-p),Math.abs(c)<=Ae){t=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=Ce(this.long0+Math.asin(r*u/this.a)/Math.sin(t))}return i.x=e,i.y=t,i},names:["Polyconic","poly"]},_C={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(i){var e,t=i.x,r=i.y-this.lat0,s=t-this.long0,a=r/xc*1e-5,n=s,o=1,l=0;for(e=1;e<=10;e++)o*=a,l+=this.A[e]*o;var c,h=l,u=n,d=1,p=0,f=0,g=0;for(e=1;e<=6;e++)c=p*h+d*u,d=d*h-p*u,p=c,f=f+this.B_re[e]*d-this.B_im[e]*p,g=g+this.B_im[e]*d+this.B_re[e]*p;return i.x=g*this.a+this.x0,i.y=f*this.a+this.y0,i},inverse:function(i){var e,t,r=i.x,s=i.y,a=r-this.x0,n=(s-this.y0)/this.a,o=a/this.a,l=1,c=0,h=0,u=0;for(e=1;e<=6;e++)t=c*n+l*o,l=l*n-c*o,c=t,h=h+this.C_re[e]*l-this.C_im[e]*c,u=u+this.C_im[e]*l+this.C_re[e]*c;for(var d=0;d<this.iterations;d++){var p,f=h,g=u,m=n,v=o;for(e=2;e<=6;e++)p=g*h+f*u,f=f*h-g*u,g=p,m+=(e-1)*(this.B_re[e]*f-this.B_im[e]*g),v+=(e-1)*(this.B_im[e]*f+this.B_re[e]*g);f=1,g=0;var _=this.B_re[1],y=this.B_im[1];for(e=2;e<=6;e++)p=g*h+f*u,f=f*h-g*u,g=p,_+=e*(this.B_re[e]*f-this.B_im[e]*g),y+=e*(this.B_im[e]*f+this.B_re[e]*g);var x=_*_+y*y;h=(m*_+v*y)/x,u=(v*_-m*y)/x}var b=h,M=u,T=1,E=0;for(e=1;e<=9;e++)T*=b,E+=this.D[e]*T;var C=this.lat0+E*xc*1e5,N=this.long0+M;return i.x=N,i.y=C,i},names:["New_Zealand_Map_Grid","nzmg"]},yC={init:function(){},forward:function(i){var e=i.x,t=i.y,r=Ce(e-this.long0),s=this.x0+this.a*r,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return i.x=s,i.y=a,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var e=Ce(this.long0+i.x/this.a),t=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=e,i.y=t,i},names:["Miller_Cylindrical","mill"]},xC={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=EM(this.es)},forward:function(i){var e,t,r=i.x,s=i.y;if(r=Ce(r-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(s),n=20;n;--n){var o=(this.m*s+Math.sin(s)-a)/(this.m+Math.cos(s));if(s-=o,Math.abs(o)<Ae)break}else s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;e=this.a*this.C_x*r*(this.m+Math.cos(s)),t=this.a*this.C_y*s}else{var l=Math.sin(s),c=Math.cos(s);t=this.a*Nd(s,l,c,this.en),e=this.a*r*c/Math.sqrt(1-this.es*l*l)}return i.x=e,i.y=t,i},inverse:function(i){var e,t,r;return i.x-=this.x0,t=i.x/this.a,i.y-=this.y0,e=i.y/this.a,this.sphere?(e/=this.C_y,t/=this.C_x*(this.m+Math.cos(e)),this.m?e=Va((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=Va(Math.sin(e)/this.n)),t=Ce(t+this.long0),e=gl(e)):(e=CM(i.y/this.a,this.es,this.en),(r=Math.abs(e))<be?(r=Math.sin(e),t=Ce(this.long0+i.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(e)))):r-Ae<be&&(t=this.long0)),i.x=t,i.y=e,i},names:["Sinusoidal","sinu"]},bC={init:function(){},forward:function(i){for(var e=i.x,t=i.y,r=Ce(e-this.long0),s=t,a=Math.PI*Math.sin(t);;){var n=-(s+Math.sin(s)-a)/(1+Math.cos(s));if(s+=n,Math.abs(n)<Ae)break}s/=2,Math.PI/2-Math.abs(t)<Ae&&(r=0);var o=.900316316158*this.a*r*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return i.x=o,i.y=l,i},inverse:function(i){var e,t;i.x-=this.x0,i.y-=this.y0,t=i.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var r=Ce(this.long0+i.x/(.900316316158*this.a*Math.cos(e)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var s=Math.asin(t);return i.x=r,i.y=s,i},names:["Mollweide","moll"]},MC={init:function(){Math.abs(this.lat1+this.lat2)<Ae||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Jc(this.es),this.e1=$c(this.es),this.e2=eh(this.es),this.e3=th(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Ms(this.e,this.sinphi,this.cosphi),this.ml1=Hi(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Ae?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Ms(this.e,this.sinphi,this.cosphi),this.ml2=Hi(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Hi(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(i){var e,t=i.x,r=i.y;if(this.sphere)e=this.a*(this.g-r);else{var s=Hi(this.e0,this.e1,this.e2,this.e3,r);e=this.a*(this.g-s)}var a=this.ns*Ce(t-this.long0),n=this.x0+e*Math.sin(a),o=this.y0+this.rh-e*Math.cos(a);return i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s;i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),e=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),e=-1);var a=0;return t!==0&&(a=Math.atan2(e*i.x,e*i.y)),this.sphere?(s=Ce(this.long0+a/this.ns),r=gl(this.g-t/this.a),i.x=s,i.y=r,i):(r=Dd(this.g-t/this.a,this.e0,this.e1,this.e2,this.e3),s=Ce(this.long0+a/this.ns),i.x=s,i.y=r,i)},names:["Equidistant_Conic","eqdc"]},wC={init:function(){this.R=this.a},forward:function(i){var e,t,r=i.x,s=i.y,a=Ce(r-this.long0);Math.abs(s)<=Ae&&(e=this.x0+this.R*a,t=this.y0);var n=Va(2*Math.abs(s/Math.PI));(Math.abs(a)<=Ae||Math.abs(Math.abs(s)-be)<=Ae)&&(e=this.x0,t=s>=0?this.y0+Math.PI*this.R*Math.tan(.5*n):this.y0+Math.PI*this.R*-Math.tan(.5*n));var o=.5*Math.abs(Math.PI/a-a/Math.PI),l=o*o,c=Math.sin(n),h=Math.cos(n),u=h/(c+h-1),d=u*u,p=u*(2/c-1),f=p*p,g=Math.PI*this.R*(o*(u-f)+Math.sqrt(l*(u-f)*(u-f)-(f+l)*(d-f)))/(f+l);a<0&&(g=-g),e=this.x0+g;var m=l+u;return g=Math.PI*this.R*(p*m-o*Math.sqrt((f+l)*(l+1)-m*m))/(f+l),t=s>=0?this.y0+g:this.y0-g,i.x=e,i.y=t,i},inverse:function(i){var e,t,r,s,a,n,o,l,c,h,u,d;return i.x-=this.x0,i.y-=this.y0,u=Math.PI*this.R,a=(r=i.x/u)*r+(s=i.y/u)*s,u=3*(s*s/(l=-2*(n=-Math.abs(s)*(1+a))+1+2*s*s+a*a)+(2*(o=n-2*s*s+r*r)*o*o/l/l/l-9*n*o/l/l)/27)/(c=(n-o*o/3/l)/l)/(h=2*Math.sqrt(-c/3)),Math.abs(u)>1&&(u=u>=0?1:-1),d=Math.acos(u)/3,t=i.y>=0?(-h*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI:-(-h*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI,e=Math.abs(r)<Ae?this.long0:Ce(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(r*r-s*s)+a*a))/2/r),i.x=e,i.y=t,i},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},SC={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(i){var e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m,v,_,y,x,b,M,T=i.x,E=i.y,C=Math.sin(i.y),N=Math.cos(i.y),D=Ce(T-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=Ae?(i.x=this.x0+this.a*(be-E)*Math.sin(D),i.y=this.y0-this.a*(be-E)*Math.cos(D),i):Math.abs(this.sin_p12+1)<=Ae?(i.x=this.x0+this.a*(be+E)*Math.sin(D),i.y=this.y0+this.a*(be+E)*Math.cos(D),i):(_=this.sin_p12*C+this.cos_p12*N*Math.cos(D),v=(m=Math.acos(_))?m/Math.sin(m):1,i.x=this.x0+this.a*v*N*Math.sin(D),i.y=this.y0+this.a*v*(this.cos_p12*C-this.sin_p12*N*Math.cos(D)),i):(e=Jc(this.es),t=$c(this.es),r=eh(this.es),s=th(this.es),Math.abs(this.sin_p12-1)<=Ae?(a=this.a*Hi(e,t,r,s,be),n=this.a*Hi(e,t,r,s,E),i.x=this.x0+(a-n)*Math.sin(D),i.y=this.y0-(a-n)*Math.cos(D),i):Math.abs(this.sin_p12+1)<=Ae?(a=this.a*Hi(e,t,r,s,be),n=this.a*Hi(e,t,r,s,E),i.x=this.x0+(a+n)*Math.sin(D),i.y=this.y0+(a+n)*Math.cos(D),i):(o=C/N,l=qo(this.a,this.e,this.sin_p12),c=qo(this.a,this.e,C),h=Math.atan((1-this.es)*o+this.es*l*this.sin_p12/(c*N)),y=(u=Math.atan2(Math.sin(D),this.cos_p12*Math.tan(h)-this.sin_p12*Math.cos(D)))===0?Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.abs(Math.abs(u)-Math.PI)<=Ae?-Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.asin(Math.sin(D)*Math.cos(h)/Math.sin(u)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),m=l*y*(1-(x=y*y)*(g=(p=this.e*this.cos_p12*Math.cos(u)/Math.sqrt(1-this.es))*p)*(1-g)/6+(b=x*y)/8*(f=d*p)*(1-2*g)+(M=b*y)/120*(g*(4-7*g)-3*d*d*(1-7*g))-M*y/48*f),i.x=this.x0+m*Math.sin(u),i.y=this.y0+m*Math.cos(u),i))},inverse:function(i){var e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m,v,_,y,x,b,M,T;return i.x-=this.x0,i.y-=this.y0,this.sphere?(e=Math.sqrt(i.x*i.x+i.y*i.y))>2*be*this.a?void 0:(t=e/this.a,r=Math.sin(t),s=Math.cos(t),a=this.long0,Math.abs(e)<=Ae?n=this.lat0:(n=Va(s*this.sin_p12+i.y*r*this.cos_p12/e),o=Math.abs(this.lat0)-be,a=Math.abs(o)<=Ae?this.lat0>=0?Ce(this.long0+Math.atan2(i.x,-i.y)):Ce(this.long0-Math.atan2(-i.x,i.y)):Ce(this.long0+Math.atan2(i.x*r,e*this.cos_p12*s-i.y*this.sin_p12*r))),i.x=a,i.y=n,i):(l=Jc(this.es),c=$c(this.es),h=eh(this.es),u=th(this.es),Math.abs(this.sin_p12-1)<=Ae?(n=Dd(((d=this.a*Hi(l,c,h,u,be))-(e=Math.sqrt(i.x*i.x+i.y*i.y)))/this.a,l,c,h,u),a=Ce(this.long0+Math.atan2(i.x,-1*i.y)),i.x=a,i.y=n,i):Math.abs(this.sin_p12+1)<=Ae?(d=this.a*Hi(l,c,h,u,be),n=Dd(((e=Math.sqrt(i.x*i.x+i.y*i.y))-d)/this.a,l,c,h,u),a=Ce(this.long0+Math.atan2(i.x,i.y)),i.x=a,i.y=n,i):(e=Math.sqrt(i.x*i.x+i.y*i.y),g=Math.atan2(i.x,i.y),p=qo(this.a,this.e,this.sin_p12),m=Math.cos(g),_=-(v=this.e*this.cos_p12*m)*v/(1-this.es),y=3*this.es*(1-_)*this.sin_p12*this.cos_p12*m/(1-this.es),M=1-_*(b=(x=e/p)-_*(1+_)*Math.pow(x,3)/6-y*(1+3*_)*Math.pow(x,4)/24)*b/2-x*b*b*b/6,f=Math.asin(this.sin_p12*Math.cos(b)+this.cos_p12*Math.sin(b)*m),a=Ce(this.long0+Math.asin(Math.sin(g)*Math.sin(b)/Math.cos(f))),T=Math.sin(f),n=Math.atan2((T-this.es*M*this.sin_p12)*Math.tan(f),T*(1-this.es)),i.x=a,i.y=n,i))},names:["Azimuthal_Equidistant","aeqd"]},TC={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(i){var e,t,r,s,a,n,o,l=i.x,c=i.y;return r=Ce(l-this.long0),e=Math.sin(c),t=Math.cos(c),s=Math.cos(r),((a=this.sin_p14*e+this.cos_p14*t*s)>0||Math.abs(a)<=Ae)&&(n=1*this.a*t*Math.sin(r),o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*t*s)),i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s,a,n,o;return i.x-=this.x0,i.y-=this.y0,t=Va((e=Math.sqrt(i.x*i.x+i.y*i.y))/this.a),r=Math.sin(t),s=Math.cos(t),n=this.long0,Math.abs(e)<=Ae?(o=this.lat0,i.x=n,i.y=o,i):(o=Va(s*this.sin_p14+i.y*r*this.cos_p14/e),a=Math.abs(this.lat0)-be,Math.abs(a)<=Ae?(n=this.lat0>=0?Ce(this.long0+Math.atan2(i.x,-i.y)):Ce(this.long0-Math.atan2(-i.x,i.y)),i.x=n,i.y=o,i):(n=Ce(this.long0+Math.atan2(i.x*r,e*this.cos_p14*s-i.y*this.sin_p14*r)),i.x=n,i.y=o,i))},names:["ortho"]};var r1=1,jl=2,Wl=3,Xl=4,Ym=5,Zm=6,pt={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Pu(i,e,t,r){var s;return i<Ae?(r.value=pt.AREA_0,s=0):(s=Math.atan2(e,t),Math.abs(s)<=mt?r.value=pt.AREA_0:s>mt&&s<=be+mt?(r.value=pt.AREA_1,s-=be):s>be+mt||s<=-(be+mt)?(r.value=pt.AREA_2,s=s>=0?s-Xt:s+Xt):(r.value=pt.AREA_3,s+=be)),s}function wo(i,e){var t=i+e;return t<-Xt?t+=Kc:t>+Xt&&(t-=Kc),t}const AC={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=be-mt/2?this.face=Ym:this.lat0<=-(be-mt/2)?this.face=Zm:Math.abs(this.long0)<=mt?this.face=r1:Math.abs(this.long0)<=be+mt?this.face=this.long0>0?jl:Xl:this.face=Wl,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(i){var e,t,r,s,a,n,o={x:0,y:0},l={value:0};if(i.x-=this.long0,e=this.es!==0?Math.atan(this.one_minus_f_squared*Math.tan(i.y)):i.y,t=i.x,this.face===Ym)s=be-e,t>=mt&&t<=be+mt?(l.value=pt.AREA_0,r=t-be):t>be+mt||t<=-(be+mt)?(l.value=pt.AREA_1,r=t>0?t-Xt:t+Xt):t>-(be+mt)&&t<=-mt?(l.value=pt.AREA_2,r=t+be):(l.value=pt.AREA_3,r=t);else if(this.face===Zm)s=be+e,t>=mt&&t<=be+mt?(l.value=pt.AREA_0,r=-t+be):t<mt&&t>=-mt?(l.value=pt.AREA_1,r=-t):t<-mt&&t>=-(be+mt)?(l.value=pt.AREA_2,r=-t-be):(l.value=pt.AREA_3,r=t>0?-t+Xt:-t-Xt);else{var c,h,u,d,p,f;this.face===jl?t=wo(t,+be):this.face===Wl?t=wo(t,+Xt):this.face===Xl&&(t=wo(t,-be)),d=Math.sin(e),p=Math.cos(e),f=Math.sin(t),c=p*Math.cos(t),h=p*f,u=d,this.face===r1?r=Pu(s=Math.acos(c),u,h,l):this.face===jl?r=Pu(s=Math.acos(h),u,-c,l):this.face===Wl?r=Pu(s=Math.acos(-c),u,-h,l):this.face===Xl?r=Pu(s=Math.acos(-h),u,c,l):(s=r=0,l.value=pt.AREA_0)}return n=Math.atan(12/Xt*(r+Math.acos(Math.sin(r)*Math.cos(mt))-be)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(n)*Math.cos(n))/(1-Math.cos(Math.atan(1/Math.cos(r))))),l.value===pt.AREA_1?n+=be:l.value===pt.AREA_2?n+=Xt:l.value===pt.AREA_3&&(n+=1.5*Xt),o.x=a*Math.cos(n),o.y=a*Math.sin(n),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,i.x=o.x,i.y=o.y,i},inverse:function(i){var e,t,r,s,a,n,o,l,c,h,u,d,p={lam:0,phi:0},f={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,t=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),e=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?f.value=pt.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(f.value=pt.AREA_1,e-=be):i.x<0&&-i.x>=Math.abs(i.y)?(f.value=pt.AREA_2,e=e<0?e+Xt:e-Xt):(f.value=pt.AREA_3,e+=be),c=Xt/12*Math.tan(e),a=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),n=Math.atan(a),(o=1-(r=Math.cos(e))*r*(s=Math.tan(t))*s*(1-Math.cos(Math.atan(1/Math.cos(n)))))<-1?o=-1:o>1&&(o=1),this.face===Ym)l=Math.acos(o),p.phi=be-l,f.value===pt.AREA_0?p.lam=n+be:f.value===pt.AREA_1?p.lam=n<0?n+Xt:n-Xt:f.value===pt.AREA_2?p.lam=n-be:p.lam=n;else if(this.face===Zm)l=Math.acos(o),p.phi=l-be,f.value===pt.AREA_0?p.lam=-n+be:f.value===pt.AREA_1?p.lam=-n:f.value===pt.AREA_2?p.lam=-n-be:p.lam=n<0?-n-Xt:-n+Xt;else{var g,m,v;c=(g=o)*g,m=(c+=(v=c>=1?0:Math.sqrt(1-c)*Math.sin(n))*v)>=1?0:Math.sqrt(1-c),f.value===pt.AREA_1?(c=m,m=-v,v=c):f.value===pt.AREA_2?(m=-m,v=-v):f.value===pt.AREA_3&&(c=m,m=v,v=-c),this.face===jl?(c=g,g=-m,m=c):this.face===Wl?(g=-g,m=-m):this.face===Xl&&(c=g,g=m,m=-c),p.phi=Math.acos(-v)-be,p.lam=Math.atan2(m,g),this.face===jl?p.lam=wo(p.lam,-be):this.face===Wl?p.lam=wo(p.lam,-Xt):this.face===Xl&&(p.lam=wo(p.lam,+be))}return this.es!==0&&(h=p.phi<0?1:0,u=Math.tan(p.phi),d=this.b/Math.sqrt(u*u+this.one_minus_f_squared),p.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),h&&(p.phi=-p.phi)),p.lam+=this.long0,i.x=p.lam,i.y=p.phi,i},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var Km=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],ql=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],s1=.8487,a1=1.3523,PM=ba/5,EC=1/PM,Qm=18,Iu=function(i,e){return i[0]+e*(i[1]+e*(i[2]+e*i[3]))};const CC={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(i){var e=Ce(i.x-this.long0),t=Math.abs(i.y),r=Math.floor(t*PM);r<0?r=0:r>=Qm&&(r=17);var s={x:Iu(Km[r],t=ba*(t-EC*r))*e,y:Iu(ql[r],t)};return i.y<0&&(s.y=-s.y),s.x=s.x*this.a*s1+this.x0,s.y=s.y*this.a*a1+this.y0,s},inverse:function(i){var e={x:(i.x-this.x0)/(this.a*s1),y:Math.abs(i.y-this.y0)/(this.a*a1)};if(e.y>=1)e.x/=Km[18][0],e.y=i.y<0?-be:be;else{var t=Math.floor(e.y*Qm);for(t<0?t=0:t>=Qm&&(t=17);;)if(ql[t][0]>e.y)--t;else{if(!(ql[t+1][0]<=e.y))break;++t}var r=ql[t],s=5*(e.y-r[0])/(ql[t+1][0]-r[0]);s=function(a,n,o,l){for(var c=n;l;--l){var h=a(c);if(c-=h,Math.abs(h)<o)break}return c}(function(a){return(Iu(r,a)-e.y)/function(n,o){return n[1]+o*(2*n[2]+3*o*n[3])}(r,a)},s,Ae,100),e.x/=Iu(Km[t],s),e.y=(5*t+s)*Si,i.y<0&&(e.y=-e.y)}return e.x=Ce(e.x+this.long0),e},names:["Robinson","robin"]},RC={init:function(){this.name="geocent"},forward:function(i){return _M(i,this.es,this.a)},inverse:function(i){return yM(i,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var Lu=0,Nu=1,Du=2,Ou=3,Yl={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const PC={init:function(){if(Object.keys(Yl).forEach((function(t){if(typeof this[t]>"u")this[t]=Yl[t].def;else{if(Yl[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);Yl[t].num&&(this[t]=parseFloat(this[t]))}Yl[t].degrees&&(this[t]=this[t]*Si)}).bind(this)),Math.abs(Math.abs(this.lat0)-be)<Ae?this.mode=this.lat0<0?Nu:Lu:Math.abs(this.lat0)<Ae?this.mode=Du:(this.mode=Ou,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(i),this.sw=Math.sin(i)},forward:function(i){i.x-=this.long0;var e,t,r,s,a=Math.sin(i.y),n=Math.cos(i.y),o=Math.cos(i.x);switch(this.mode){case Ou:t=this.sinph0*a+this.cosph0*n*o;break;case Du:t=n*o;break;case Nu:t=-a;break;case Lu:t=a}switch(e=(t=this.pn1/(this.p-t))*n*Math.sin(i.x),this.mode){case Ou:t*=this.cosph0*a-this.sinph0*n*o;break;case Du:t*=a;break;case Lu:t*=-n*o;break;case Nu:t*=n*o}return s=1/((r=t*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-t*this.sg)*this.cw*s,t=r*s,i.x=e*this.a,i.y=t*this.a,i},inverse:function(i){i.x/=this.a,i.y/=this.a;var e,t,r,s={x:i.x,y:i.y};r=1/(this.pn1-i.y*this.sw),e=this.pn1*i.x*r,t=this.pn1*i.y*this.cw*r,i.x=e*this.cg+t*this.sg,i.y=t*this.cg-e*this.sg;var a=Ar(i.x,i.y);if(Math.abs(a)<Ae)s.x=0,s.y=i.y;else{var n,o;switch(o=1-a*a*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/a+a/this.pn1),n=Math.sqrt(1-o*o),this.mode){case Ou:s.y=Math.asin(n*this.sinph0+i.y*o*this.cosph0/a),i.y=(n-this.sinph0*Math.sin(s.y))*a,i.x*=o*this.cosph0;break;case Du:s.y=Math.asin(i.y*o/a),i.y=n*a,i.x*=o;break;case Lu:s.y=Math.asin(n),i.y=-i.y;break;case Nu:s.y=-Math.asin(n)}s.x=Math.atan2(i.x,i.y)}return i.x=s.x+this.long0,i.y=s.y,i},names:["Tilted_Perspective","tpers"]},IC={init:function(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var i=1-this.es,e=1/i;this.radius_p=Math.sqrt(i),this.radius_p2=i,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(i){var e,t,r,s,a=i.x,n=i.y;if(a-=this.long0,this.shape==="ellipse"){n=Math.atan(this.radius_p2*Math.tan(n));var o=this.radius_p/Ar(this.radius_p*Math.cos(n),Math.sin(n));if(t=o*Math.cos(a)*Math.cos(n),r=o*Math.sin(a)*Math.cos(n),s=o*Math.sin(n),(this.radius_g-t)*t-r*r-s*s*this.radius_p_inv2<0)return i.x=Number.NaN,i.y=Number.NaN,i;e=this.radius_g-t,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/Ar(s,e)),i.y=this.radius_g_1*Math.atan(s/e)):(i.x=this.radius_g_1*Math.atan(r/e),i.y=this.radius_g_1*Math.atan(s/Ar(r,e)))}else this.shape==="sphere"&&(e=Math.cos(n),t=Math.cos(a)*e,r=Math.sin(a)*e,s=Math.sin(n),e=this.radius_g-t,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/Ar(s,e)),i.y=this.radius_g_1*Math.atan(s/e)):(i.x=this.radius_g_1*Math.atan(r/e),i.y=this.radius_g_1*Math.atan(s/Ar(r,e))));return i.x=i.x*this.a,i.y=i.y*this.a,i},inverse:function(i){var e,t,r,s,a=-1,n=0,o=0;if(i.x=i.x/this.a,i.y=i.y/this.a,this.shape==="ellipse"){this.flip_axis?(o=Math.tan(i.y/this.radius_g_1),n=Math.tan(i.x/this.radius_g_1)*Ar(1,o)):(n=Math.tan(i.x/this.radius_g_1),o=Math.tan(i.y/this.radius_g_1)*Ar(1,n));var l=o/this.radius_p;if(e=n*n+l*l+a*a,(r=(t=2*this.radius_g*a)*t-4*e*this.C)<0)return i.x=Number.NaN,i.y=Number.NaN,i;s=(-t-Math.sqrt(r))/(2*e),a=this.radius_g+s*a,n*=s,o*=s,i.x=Math.atan2(n,a),i.y=Math.atan(o*Math.cos(i.x)/a),i.y=Math.atan(this.radius_p_inv2*Math.tan(i.y))}else if(this.shape==="sphere"){if(this.flip_axis?(o=Math.tan(i.y/this.radius_g_1),n=Math.tan(i.x/this.radius_g_1)*Math.sqrt(1+o*o)):(n=Math.tan(i.x/this.radius_g_1),o=Math.tan(i.y/this.radius_g_1)*Math.sqrt(1+n*n)),e=n*n+o*o+a*a,(r=(t=2*this.radius_g*a)*t-4*e*this.C)<0)return i.x=Number.NaN,i.y=Number.NaN,i;s=(-t-Math.sqrt(r))/(2*e),a=this.radius_g+s*a,n*=s,o*=s,i.x=Math.atan2(n,a),i.y=Math.atan(o*Math.cos(i.x)/a)}return i.x=i.x+this.long0,i},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};var Zl=1.340264,Kl=-.081106,Ql=893e-6,Jl=.003796,Uu=Math.sqrt(3)/2;const LC={init:function(){this.es=0,this.long0=this.long0!==void 0?this.long0:0},forward:function(i){var e=Ce(i.x-this.long0),t=i.y,r=Math.asin(Uu*Math.sin(t)),s=r*r,a=s*s*s;return i.x=e*Math.cos(r)/(Uu*(Zl+3*Kl*s+a*(7*Ql+9*Jl*s))),i.y=r*(Zl+Kl*s+a*(Ql+Jl*s)),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i},inverse:function(i){i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a;var e,t,r,s,a=i.y;for(s=0;s<12&&(a-=r=(a*(Zl+Kl*(e=a*a)+(t=e*e*e)*(Ql+Jl*e))-i.y)/(Zl+3*Kl*e+t*(7*Ql+9*Jl*e)),!(Math.abs(r)<1e-9));++s);return t=(e=a*a)*e*e,i.x=Uu*i.x*(Zl+3*Kl*e+t*(7*Ql+9*Jl*e))/Math.cos(a),i.y=Math.asin(Math.sin(a)/Uu),i.x=Ce(i.x+this.long0),i},names:["eqearth","Equal Earth","Equal_Earth"]};Zi.defaultDatum="WGS84",Zi.Proj=_s,Zi.WGS84=new Zi.Proj("WGS84"),Zi.Point=Xo,Zi.toPoint=xM,Zi.defs=zi,Zi.nadgrid=function(i,e){var t=new DataView(e),r=function(o){var l=o.getInt32(8,!1);return l===11?!1:(l=o.getInt32(8,!0),!0)}(t),s=function(o,l){return{nFields:o.getInt32(8,l),nSubgridFields:o.getInt32(24,l),nSubgrids:o.getInt32(40,l),shiftType:Lg(o,56,64).trim(),fromSemiMajorAxis:o.getFloat64(120,l),fromSemiMinorAxis:o.getFloat64(136,l),toSemiMajorAxis:o.getFloat64(152,l),toSemiMinorAxis:o.getFloat64(168,l)}}(t,r),a=function(o,l,c){for(var h=176,u=[],d=0;d<l.nSubgrids;d++){var p=DE(o,h,c),f=OE(o,h,p,c),g=Math.round(1+(p.upperLongitude-p.lowerLongitude)/p.longitudeInterval),m=Math.round(1+(p.upperLatitude-p.lowerLatitude)/p.latitudeInterval);u.push({ll:[Do(p.lowerLongitude),Do(p.lowerLatitude)],del:[Do(p.longitudeInterval),Do(p.latitudeInterval)],lim:[g,m],count:p.gridNodeCount,cvs:NE(f)}),h+=176+16*p.gridNodeCount}return u}(t,s,r),n={header:s,subgrids:a};return vM[i]=n,n},Zi.transform=Ld,Zi.mgrs=FE,Zi.version="__VERSION__",function(i){i.Proj.projections.add(ld),i.Proj.projections.add(cd),i.Proj.projections.add(JE),i.Proj.projections.add($E),i.Proj.projections.add(eC),i.Proj.projections.add(tC),i.Proj.projections.add(iC),i.Proj.projections.add(rC),i.Proj.projections.add(sC),i.Proj.projections.add(aC),i.Proj.projections.add(dC),i.Proj.projections.add(pC),i.Proj.projections.add(mC),i.Proj.projections.add(fC),i.Proj.projections.add(gC),i.Proj.projections.add(vC),i.Proj.projections.add(_C),i.Proj.projections.add(yC),i.Proj.projections.add(xC),i.Proj.projections.add(bC),i.Proj.projections.add(MC),i.Proj.projections.add(wC),i.Proj.projections.add(SC),i.Proj.projections.add(TC),i.Proj.projections.add(AC),i.Proj.projections.add(CC),i.Proj.projections.add(RC),i.Proj.projections.add(PC),i.Proj.projections.add(IC),i.Proj.projections.add(LC)}(Zi);class IM extends je{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new ne(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const So=new R,n1=new Me,o1=new Me,l1=new R,c1=new R;class NC{constructor(e={}){const t=this;let r,s,a,n;const o={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");function c(d){d.isCSS2DObject&&(d.element.style.display="none");for(let p=0,f=d.children.length;p<f;p++)c(d.children[p])}function h(d,p,f){if(d.visible!==!1){if(d.isCSS2DObject){So.setFromMatrixPosition(d.matrixWorld),So.applyMatrix4(o1);const g=So.z>=-1&&So.z<=1&&d.layers.test(f.layers)===!0,m=d.element;m.style.display=g===!0?"":"none",g===!0&&(d.onBeforeRender(t,p,f),m.style.transform="translate("+-100*d.center.x+"%,"+-100*d.center.y+"%)translate("+(So.x*a+a)+"px,"+(-So.y*n+n)+"px)",m.parentNode!==l&&l.appendChild(m),d.onAfterRender(t,p,f));const v={distanceToCameraSquared:u(f,d)};o.objects.set(d,v)}for(let g=0,m=d.children.length;g<m;g++)h(d.children[g],p,f)}else c(d)}function u(d,p){return l1.setFromMatrixPosition(d.matrixWorld),c1.setFromMatrixPosition(p.matrixWorld),l1.distanceToSquared(c1)}l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:r,height:s}},this.render=function(d,p){d.matrixWorldAutoUpdate===!0&&d.updateMatrixWorld(),p.parent===null&&p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),n1.copy(p.matrixWorldInverse),o1.multiplyMatrices(p.projectionMatrix,n1),h(d,d,p),function(f){const g=function(v){const _=[];return v.traverseVisible(function(y){y.isCSS2DObject&&_.push(y)}),_}(f).sort(function(v,_){return v.renderOrder!==_.renderOrder?_.renderOrder-v.renderOrder:o.objects.get(v).distanceToCameraSquared-o.objects.get(_).distanceToCameraSquared}),m=g.length;for(let v=0,_=g.length;v<_;v++)g[v].element.style.zIndex=m-v}(d)},this.setSize=function(d,p){r=d,s=p,a=r/2,n=s/2,l.style.width=d+"px",l.style.height=p+"px"}}}const h1=new R,DC=new it,u1=new R;class LM extends je{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const is=new Me,OC=new Me;class UC{constructor(e={}){const t=this;let r,s,a,n;const o={camera:{style:""},objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l;const c=document.createElement("div");c.style.transformOrigin="0 0",c.style.pointerEvents="none",l.appendChild(c);const h=document.createElement("div");function u(m){return Math.abs(m)<1e-10?0:m}function d(m){const v=m.elements;return"matrix3d("+u(v[0])+","+u(-v[1])+","+u(v[2])+","+u(v[3])+","+u(v[4])+","+u(-v[5])+","+u(v[6])+","+u(v[7])+","+u(v[8])+","+u(-v[9])+","+u(v[10])+","+u(v[11])+","+u(v[12])+","+u(-v[13])+","+u(v[14])+","+u(v[15])+")"}function p(m){const v=m.elements;return"translate(-50%,-50%)"+("matrix3d("+u(v[0])+","+u(v[1])+","+u(v[2])+","+u(v[3])+","+u(-v[4])+","+u(-v[5])+","+u(-v[6])+","+u(-v[7])+","+u(v[8])+","+u(v[9])+","+u(v[10])+","+u(v[11])+","+u(v[12])+","+u(v[13])+","+u(v[14])+","+u(v[15])+")")}function f(m){m.isCSS3DObject&&(m.element.style.display="none");for(let v=0,_=m.children.length;v<_;v++)f(m.children[v])}function g(m,v,_,y){if(m.visible!==!1){if(m.isCSS3DObject){const x=m.layers.test(_.layers)===!0,b=m.element;if(b.style.display=x===!0?"":"none",x===!0){let M;m.onBeforeRender(t,v,_),m.isCSS3DSprite?(is.copy(_.matrixWorldInverse),is.transpose(),m.rotation2D!==0&&is.multiply(OC.makeRotationZ(m.rotation2D)),m.matrixWorld.decompose(h1,DC,u1),is.setPosition(h1),is.scale(u1),is.elements[3]=0,is.elements[7]=0,is.elements[11]=0,is.elements[15]=1,M=p(is)):M=p(m.matrixWorld);const T=o.objects.get(m);if(T===void 0||T.style!==M){b.style.transform=M;const E={style:M};o.objects.set(m,E)}b.parentNode!==h&&h.appendChild(b),m.onAfterRender(t,v,_)}}for(let x=0,b=m.children.length;x<b;x++)g(m.children[x],v,_)}else f(m)}h.style.transformStyle="preserve-3d",c.appendChild(h),this.getSize=function(){return{width:r,height:s}},this.render=function(m,v){const _=v.projectionMatrix.elements[5]*n;let y,x;v.view&&v.view.enabled?(c.style.transform=`translate( ${-v.view.offsetX*(r/v.view.width)}px, ${-v.view.offsetY*(s/v.view.height)}px )`,c.style.transform+=`scale( ${v.view.fullWidth/v.view.width}, ${v.view.fullHeight/v.view.height} )`):c.style.transform="",m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),v.parent===null&&v.matrixWorldAutoUpdate===!0&&v.updateMatrixWorld(),v.isOrthographicCamera&&(y=-(v.right+v.left)/2,x=(v.top+v.bottom)/2);const b=v.view&&v.view.enabled?v.view.height/v.view.fullHeight:1,M=v.isOrthographicCamera?`scale( ${b} )scale(`+_+")translate("+u(y)+"px,"+u(x)+"px)"+d(v.matrixWorldInverse):`scale( ${b} )translateZ(`+_+"px)"+d(v.matrixWorldInverse),T=(v.isPerspectiveCamera?"perspective("+_+"px) ":"")+M+"translate("+a+"px,"+n+"px)";o.camera.style!==T&&(h.style.transform=T,o.camera.style=T),g(m,m,v)},this.setSize=function(m,v){r=m,s=v,a=r/2,n=s/2,l.style.width=m+"px",l.style.height=v+"px",c.style.width=m+"px",c.style.height=v+"px",h.style.width=m+"px",h.style.height=v+"px"}}}function ZL(i,e,t=.9){const r=i.distanceTo(e);return new R().subVectors(e,i).normalize().multiplyScalar(r*t).add(i)}function d1(i){for(;i!=null&&i.parent&&i.parent.type!=="Scene";)i=i.parent;return i}function vl(i){if(i)return i.type==="Scene"?i:vl(i.parent)}function kC(i){const e=new Et().setFromObject(i),{max:t,min:r}=e,s=new R;return e.getCenter(s),{box:e,max:t,min:r,center:s,radius:new R().subVectors(t,r).length()/2}}function W0(i,e=50){const{center:t,radius:r,max:s}=kC(i),a=i.getWorldDirection(new R),n=r/Math.tan(Math.PI*e/360),o=a.multiplyScalar(n),l=o.clone().add(t),c=o.clone().applyAxisAngle(new R(0,1,0),-Math.PI/2).add(t),h=o.clone().applyAxisAngle(new R(0,1,0),Math.PI/2).add(t),u=o.clone().applyAxisAngle(new R(1,0,0),-Math.PI/2).add(t),d=o.clone().applyAxisAngle(new R(1,0,0),Math.PI/2).add(t),p=o.clone().applyAxisAngle(new R(0,1,0),Math.PI).add(t),f=function(g,m,v){return new R().subVectors(m,g).normalize().multiplyScalar(v).add(g)}(t,s,t.distanceTo(s)/Math.tan(Math.PI*e/360));return{frontView:l,leftView:c,rightView:h,topView:u,bottomView:d,backView:p,maxView:f,target:t}}const FC=["立方体","球体","平面","胶囊","圆锥","圆面","圆柱","圆环","环面"];function X0(i,e={}){let t=null;switch(i){case"立方体":default:t=BC(e);break;case"球体":t=function(r={}){return new Wn(r.radius||5,r.widthSegments||32,r.heightSegments||32)}(e);break;case"平面":t=function(r={}){return new ws(r.width||5,r.height||5,r.widthSegments||32,r.heightSegments||32)}(e);break;case"胶囊":t=function(r={}){return new fh(r.radius||5,r.length||5,r.capSegments||32,r.radialSegments||32)}(e);break;case"圆锥":t=function(r={}){return new vh(r.radius||5,r.height||5,r.radialSegments||32)}(e);break;case"圆面":t=function(r={}){return new gh(r.radius||5,r.segments||32,r.thetaStart||0,r.thetaLength||2*Math.PI)}(e);break;case"圆柱":t=function(r={}){return new zt(r.radiusTop||5,r.radiusBottom||5,r.height||5,r.radialSegments||32)}(e);break;case"圆环":t=function(r={}){return new hs(r.radius||10,r.tube||3,r.radialSegments||32,r.tubularSegments||32,r.arc||2*Math.PI)}(e);break;case"环面":t=function(r={}){return new _h(r.innerRadius||5,r.outerRadius||10,r.thetaSegments||32,r.phiSegments||32,r.thetaStart||0,r.thetaLength||2*Math.PI)}(e)}return t.geometryType=i,t}function BC(i={}){return new Ot(i.width||5,i.height||5,i.depth||5,i.widthSegments||1,i.heightSegments||1,i.depthSegments||1)}const Yo=["基础材质","标准材质","镜面高光材质","Lambert材质","物理材质","卡通材质"];function Zr(i,e=null){let t=null;switch(i){case"基础材质":case"MeshBasicMaterial":default:t=zC(e);break;case"标准材质":case"MeshStandardMaterial":t=function(r){return new hl(Ne({color:16777215,side:It},r))}(e);break;case"镜面高光材质":case"MeshPhongMaterial":t=function(r){return new Xn(Ne({color:16777215,side:It},r))}(e);break;case"Lambert材质":case"MeshLambertMaterial":t=function(r){return new bp(Ne({color:16777215,side:It},r))}(e);break;case"物理材质":case"MeshPhysicalMaterial":t=function(r){return new yr(Ne({color:16777215,side:It},r))}(e);break;case"卡通材质":case"MeshToonMaterial":t=function(r){return new f0(Ne({color:16777215,side:It},r))}(e)}return t.materialType=i||"基础材质",t.transparent=!0,t}function zC(i){return new ei(Ne({color:16777215,side:It},i))}function VC(i){const e=document.createElement("video");return e.crossOrigin="anonymous",e.src=i,e.muted=!0,e.loop=!0,e.play(),new Ux(e)}function HC(i){const{mapType:e,mapUrl:t,map:r}=i;if(t&&r)return{mapType:e,mapUrl:t,map:{wrapS:r.wrapS,wrapT:r.wrapT,rotation:r.rotation,center:r.center,repeat:r.repeat,offset:r.offset,textureAnimation:r.textureAnimation}}}function NM(i,e,t){var r;if(!e.mapUrl)return e.map=null;e.mapType=="视频"?e.map=VC(e.mapUrl):e.map=new xs().load(e.mapUrl),t&&(e.map.wrapS=t.wrapS,e.map.wrapT=t.wrapT,e.map.repeat.set(t.repeat.x,t.repeat.y),e.map.offset.set(t.offset.x,t.offset.y),e.map.center.set(t.center.x,t.center.y),e.map.rotation=t.rotation,(r=t.textureAnimation)!=null&&r.isTextureAnimation&&(e.map.textureAnimation=t.textureAnimation,e.map.commonAnimateRender=function(){e.map.offset.x+=t.textureAnimation.offset.x,e.map.offset.y+=t.textureAnimation.offset.y,e.map.rotation+=t.textureAnimation.rotation},i.push(e.map))),e.map.center.set(.5,.5),e.isCustomTexture=!0,e.needsUpdate=!0}const q0={无混合:0,正常混合:1,叠加混合:js,减去混合:3,乘法混合:4,自定义混合:Ko},GC={加法:ur,减法:101,反向减法:102,最小值:103,最大值:104},jC={零:Qo,一:nh,源颜色:Zd,"1-源颜色":Kd,源透明度:Pa,"1-源透明度":Ia,目标透明度:oh,"1-目标透明度":Qd,目标颜色:lh,"1-目标颜色":Jd,源透明饱和:210},WC={零:Qo,一:nh,源颜色:Zd,"1-源颜色":Kd,源透明度:Pa,"1-源透明度":Ia,目标透明度:oh,"1-目标透明度":Qd,目标颜色:lh,"1-目标颜色":Jd},XC={正面:Ir,背面:Di,双面:It};function qC(i){const{visible:e,color:t,wireframe:r,transparent:s,opacity:a,alphaTest:n,blending:o,side:l}=i;return Ne({visible:e,color:t,wireframe:r,transparent:s,opacity:a,alphaTest:n,blending:o,side:l},HC(i))}function YC(i,e,t){t.add(e,"visible").name("显示"),t.addHexColor(e.color).name("颜色"),t.add(e,"wireframe").name("线框模式"),t.add(e,"side",XC).name("面类型").onFinishChange(r=>(e.side=Number(r),e.needsUpdate=!0)),t.add(e,"transparent").name("透明"),t.add(e,"opacity",0,1).name("透明度"),t.add(e,"alphaTest",0,1).name("剔除阈值"),t.add(e,"blending",q0).name("混合模式").onChange(r=>(e.blending=Number(r),e.needsUpdate=!0)),function(r,s,a){!Reflect.has(s,"mapUrl")&&(s.mapUrl=""),a.add(s,"mapUrl").name("贴图"),!Reflect.has(s,"mapType")&&(s.mapType="图片"),a.add(s,"mapType",["图片","视频"]).name("贴图类型"),a.add({updateMap:()=>NM(r,s)},"updateMap").name("更新贴图")}(i,e,t.addFolder("贴图"))}function ZC(i){switch(i.type){case"MeshBasicMaterial":return{envMap:!!i.envMap,reflectivity:i.reflectivity};case"MeshStandardMaterial":return{emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,metalness:i.metalness,roughness:i.roughness,envMap:!!i.envMap,envMapIntensity:i.envMapIntensity};case"MeshLambertMaterial":return{emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,envMap:!!i.envMap,reflectivity:i.reflectivity};case"MeshPhongMaterial":return{shininess:i.shininess,specular:i.specular.getHex(),emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,envMap:!!i.envMap,reflectivity:i.reflectivity};case"MeshToonMaterial":return{emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity};case"MeshPhysicalMaterial":return{metalness:i.metalness,roughness:i.roughness,clearcoat:i.clearcoat,clearcoatRoughness:i.clearcoatRoughness,sheen:i.sheen,sheenRoughness:i.sheenRoughness,sheenColor:i.sheenColor.getHex(),specularColor:i.specularColor.getHex(),specularIntensity:i.specularIntensity,transmission:i.transmission,emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,envMap:!!i.envMap,envMapIntensity:i.envMapIntensity,reflectivity:i.reflectivity}}}function Ap(i){return Ne(Ne({materialType:i.materialType},qC(i)),ZC(i))}function Ep(i,e,t){t&&(function(r,s,a){const{visible:n,color:o,wireframe:l,side:c,transparent:h,opacity:u,alphaTest:d,blending:p,map:f,mapUrl:g,mapType:m}=a;s.visible=n,s.color.setHex(o),s.wireframe=l,s.transparent=h,s.opacity=u,s.alphaTest=d,s.blending=p,s.side=c??It,g&&(s.mapUrl=g,s.mapType=m,NM(r,s,f))}(i.commonFrames,e,t),function(r,s,a){switch(s.type){case"MeshBasicMaterial":a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.reflectivity=a.reflectivity;break;case"MeshStandardMaterial":s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.envMapIntensity=a.envMapIntensity,s.metalness=a.metalness,s.roughness=a.roughness;break;case"MeshLambertMaterial":s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.reflectivity=a.reflectivity;break;case"MeshPhongMaterial":s.shininess=a.shininess,s.specular.setHex(a.specular),s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.reflectivity=a.reflectivity;break;case"MeshToonMaterial":s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity;break;case"MeshPhysicalMaterial":s.metalness=a.metalness,s.roughness=a.roughness,s.clearcoat=a.clearcoat,s.clearcoatRoughness=a.clearcoatRoughness,s.sheen=a.sheen,s.sheenRoughness=a.sheenRoughness,s.sheenColor.setHex(a.sheenColor),s.specularColor.setHex(a.specularColor),s.specularIntensity=a.specularIntensity,s.transmission=a.transmission,s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.envMapIntensity=a.envMapIntensity,s.reflectivity=a.reflectivity}}(i,e,t))}function Cp(i,e,t){YC(i.commonFrames,e,t),function(r,s,a){switch(s.type){case"MeshBasicMaterial":a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"reflectivity",0,1).name("反射率");break;case"MeshStandardMaterial":a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度"),a.add(s,"metalness",0,1).name("金属度"),a.add(s,"roughness",0,1).name("粗糙度"),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"envMapIntensity",0).name("环境贴图强度");break;case"MeshLambertMaterial":a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度"),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"reflectivity",0,1).name("反射率");break;case"MeshPhongMaterial":a.add(s,"shininess",0,100).name("高光亮度").onChange(n=>s.needsUpdate=!0),a.addHexColor(s.specular).name("高光颜色"),a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度"),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"reflectivity",0,1).name("反射率");break;case"MeshToonMaterial":a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度");break;case"MeshPhysicalMaterial":a.add(s,"metalness",0,1).name("金属度"),a.add(s,"roughness",0,1).name("粗糙度"),a.add(s,"clearcoat",0,1).name("清漆层"),a.add(s,"clearcoatRoughness",0,1).name("清漆层粗糙度"),a.add(s,"sheen",0,1).name("光泽度"),a.add(s,"sheenRoughness",0,1).name("光泽粗糙度"),a.addHexColor(s.sheenColor).name("光泽颜色"),a.addHexColor(s.specularColor).name("高光颜色"),a.add(s,"specularIntensity",0,1).name("高光强度"),a.add(s,"transmission",0,1).name("透射率"),a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度"),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"envMapIntensity",0).name("环境贴图强度"),a.add(s,"reflectivity",0,1).name("反射率")}}(i,e,t.addFolder(e.materialType+"配置"))}const DM={material:"vUv = uv;",position:"vUv = position.xy/ position.z;",modelMatrix:"vUv = (modelMatrix * vec4(position, 1.0)).xy;",modelViewMatrix:"vUv = (modelViewMatrix * vec4(position, 1.0)).xy;",projectionMatrix:"vUv = (projectionMatrix * vec4(position, 1.0)).xy;",viewMatrix:"vUv = (viewMatrix * vec4(position, 1.0)).xy;",custom_uv1:`
    
        vec4 projectedPosition = projectionMatrix * modelMatrix  * vec4(position, 1.0);

        vec3 ndcPosition = projectedPosition.xyz / projectedPosition.w;

        vUv = ndcPosition.xy / ndcPosition.z;
    `},KC=Object.keys(DM),OM=[{name:"彩虹光",commonUniforms:!0,vertex:"vUv-material",fragment:`
            vec3 c;
            float l,z=iTime;
            for(int i=0;i<3;i++) {
                vec2 uv,p=gl_FragCoord.xy/iResolution/2.0;
                uv=p;
                p-=.3;
                <UV_PLACEHOLDER>
                z+=.07;
                l=length(p);
                uv+=p/l*(sin(z)+1.)*abs(sin(l*9.-z-z));
                c[i]=.01/length(mod(uv,1.)-.5);
            }
        `,commonFinish:!0,key:"c",isParticle:!0,render:"iTime+speed"},{name:"水波纹",commonUniforms:!0,customUniforms:["TAU-number-float-6.28318530718","MAX_ITER-number-int-5"],vertex:"vUv-material",fragment:`
            float time = iTime * .5+23.0;
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            <UV_PLACEHOLDER>
            #ifdef SHOW_TILING
                vec2 p = mod(uv*TAU*2.0, TAU)-250.0;
            #else
                vec2 p = mod(uv*TAU, TAU)-250.0;
            #endif
            vec2 i = vec2(p);
            float c = 1.0;
            float inten = .005;
            for (int n = 0; n < MAX_ITER; n++) 
            {
                float t = time * (1.0 - (3.5 / float(n+1)));
                i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));
                c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));
            }
            c /= float(MAX_ITER);
            c = 1.17-pow(c, 1.4);
            vec3 colour = vec3(pow(abs(c), 8.0));
            colour = clamp(colour + vec3(0.0, 0.35, 0.5), 0.0, 1.0);
            #ifdef SHOW_TILING
            // Flash tile borders...
            vec2 pixel = 2.0 / iResolution.xy;
            uv *= 2.0;
            float f = floor(mod(iTime*.5, 2.0)); 	// Flash value.
            vec2 first = step(pixel, uv) * f;		   	// Rule out first screen pixels and flash.
            uv  = step(fract(uv), pixel);				// Add one line of pixels per tile.
            colour = mix(colour, vec3(1.0, 1.0, 0.0), (uv.x + uv.y) * first.x * first.y); // Yellow line
            #endif
        `,commonFinish:!0,key:"colour",isParticle:!0,render:"iTime+speed"},{name:"光圈扫射",commonUniforms:!1,customUniforms:["innerCircleWidth-number-float-1","circleWidth-number-float-2","circleMax-number-float-2","opacityScale-number-float-1","reverseOpacity-bool-bool-true","circleSpeed-number-float-0.01","diff-color-vec3-0.0,0.0,1.0","color3-color-vec3-0.0,0.0,1.0","center-position-vec3-0,0,0","intensity-number-float-1","isDisCard-bool-bool-false"],vertex:"vUv-material,vPosition",fragment:`
            float dis = length(vPosition - center);
            vec4 diffuseColor;
            if(dis < (innerCircleWidth + circleWidth) && dis > innerCircleWidth) {
                float r = (dis - innerCircleWidth) / circleWidth;
                float cOpacity = reverseOpacity ? (innerCircleWidth / circleMax) : 1. - ( innerCircleWidth / circleMax );
                #ifdef USE_MAP
                    vec3 textureColor = texture2D(map, vUv).rgb;
                    if(isDisCard && textureColor.r < 0.1 && textureColor.g < 0.1  && textureColor.b < 0.1 ) discard;
                #endif
                diffuseColor = vec4( mix(diff, color3, r) * vec3(intensity, intensity, intensity)  , opacity * cOpacity * opacityScale);
            }
            else {
                if(isDisCard)  discard ;
                else diffuseColor = vec4( diffuse, opacity );
            }
        `,commonFinish:!1,render:"this.innerCircleWidth.value < this.circleMax.value ? this.innerCircleWidth.value += this.circleSpeed.value : this.innerCircleWidth.value = 0"},{name:"晶片着色",commonUniforms:!0,vertex:"vUv-material",key:"col",fragment:`
            float gTime = 0.;
            const float REPEAT = 5.0;
            mat2 rot(float a) {
                float c = cos(a), s = sin(a);
                return mat2(c,s,-s,c);
            }
            float sdBox( vec3 p, vec3 b )
            {
                vec3 q = abs(p) - b;
                return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
            }
            float box(vec3 pos, float scale) {
                pos *= scale;
                float base = sdBox(pos, vec3(.4,.4,.1)) /1.5;
                pos.xy *= 5.;
                pos.y -= 3.5;
                pos.xy *= rot(.75);
                float result = -base;
                return result;
            }
            float box_set(vec3 pos, float iTime) {
                vec3 pos_origin = pos;
                pos = pos_origin;
                pos .y += sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box1 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);
                pos = pos_origin;
                pos .y -=sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box2 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);
                pos = pos_origin;
                pos .x +=sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box3 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);	
                pos = pos_origin;
                pos .x -=sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box4 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);	
                pos = pos_origin;
                pos.xy *=   rot(.8);
                float box5 = box(pos,.5) * 6.;	
                pos = pos_origin;
                float box6 = box(pos,.5) * 6.;	
                float result = max(max(max(max(max(box1,box2),box3),box4),box5),box6);
                return result;
            }
            float mapf(vec3 pos, float iTime) {
                vec3 pos_origin = pos;
                float box_set1 = box_set(pos, iTime);

                return box_set1;
            }
            <SPLIT_PLACEHOLDER>
            vec2 p = gl_FragCoord.xy / iResolution.xy;
            p.x -=.5;
            p.y -=.5;
            p.x *= iResolution.x / iResolution.y;
            vec2 uv = p;
            <UV_PLACEHOLDER>
            p = uv;
            vec3 ro = vec3(0., -0.2 ,iTime * 4.);
            vec3 ray = normalize(vec3(p, 1.5));
            ray.xy = ray.xy * rot(sin(iTime * .03) * 5.);
            ray.yz = ray.yz * rot(sin(iTime * .05) * .2);
            float t = 0.1;
            vec3 col = vec3(0.);
            float ac = 0.0;
            for (int i = 0; i < 99; i++){
                vec3 pos = ro + ray * t;
                pos = mod(pos-2., 4.) -2.;
                gTime = iTime -float(i) * 0.01;
                
                float d = mapf(pos, iTime);

                d = max(abs(d), 0.01);
                ac += exp(-d*23.);

                t += d* 0.55;
            }
            col = vec3(ac * 0.02);
            col +=vec3(0.,0.2 * abs(sin(iTime)),0.5 + sin(iTime) * 0.2);  
        `,commonFinish:!0,isParticle:!0,render:"iTime+speed"},{name:"流光围栏",commonUniforms:!1,customUniforms:["iTime-number-float-0.0","speed-number-float-0.05","intensity-number-float-2","density-number-float-5","mixColor-color-vec3-1.0,1.0,1.0","high-number-float-0.5","medium-number-float-0.4"],vertex:"vUv-material",fragment:`
            vec4 fragColor = vec4(0.);
            float sin = sin((vUv.y - iTime * speed) * 10. * density);
            if (sin > high) {
            fragColor = vec4( mixColor, (1. - sin) / (1. - high));
            } else if(sin > medium) {
            fragColor = vec4(mixColor, mix(1., 0., 1.-(sin - medium) / (high - medium)));
            } else {
            fragColor = vec4(mixColor, 0.);
            }
            fragColor = mix(fragColor, vec4(mix(mixColor, vec3(0., 0., 0.), vUv.y), 1.), 0.);
            vec4 diffuseColor = vec4(fragColor.rgb * vec3(intensity, intensity, intensity), fragColor.a * opacity * (1. - vUv.y));
        `,commonFinish:!1,render:"iTime+speed"},{name:"雪片着色",commonUniforms:!0,customUniforms:!1,vertex:"precision-lowp,vUv-material",fragment:`
            mat2 rot(float a) {
                float c = cos(a), s = sin(a);
                return mat2(c,s,-s,c);
            }
            const float pi = acos(-1.0);
            const float pi2 = pi*2.0;
            vec2 pmod(vec2 p, float r) {
                float a = atan(p.x, p.y) + pi/r;
                float n = pi2 / r;
                a = floor(a/n)*n;
                return p*rot(-a);
            }
            float box( vec3 p, vec3 b ) {
                vec3 d = abs(p) - b;
                return min(max(d.x,max(d.y,d.z)),0.0) + length(max(d,0.0));
            }
            float ifsBox(vec3 p) {
                for (int i=0; i<5; i++) {
                    p = abs(p) - 1.0;
                    p.xy *= rot(iTime*0.3);
                    p.xz *= rot(iTime*0.1);
                }
                p.xz *= rot(iTime);
                return box(p, vec3(0.4,0.8,0.3));
            }
            float mapSnow(vec3 p, vec3 cPos) {
                vec3 p1 = p;
                p1.x = mod(p1.x-5., 10.) - 5.;
                p1.y = mod(p1.y-5., 10.) - 5.;
                p1.z = mod(p1.z, 16.)-8.;
                p1.xy = pmod(p1.xy, 5.0);
                return ifsBox(p1);
            }  
            <SPLIT_PLACEHOLDER>
            vec2 p = (gl_FragCoord.xy * 2.0  - iResolution.xy) / min(iResolution.x, iResolution.y);
            vec2 uv = p;
            <UV_PLACEHOLDER>
            p = uv;
            vec3 cPos = vec3(0.0,0.0, -3.0 * iTime);
            vec3 cDir = normalize(vec3(0.0, 0.0, -1.0));
            vec3 cUp  = vec3(sin(iTime), 1.0, 0.0);
            vec3 cSide = cross(cDir, cUp);
            vec3 ray = normalize(cSide * p.x + cUp * p.y + cDir);
            float acc = 0.0;
            float acc2 = 0.0;
            float t = 0.0;
            for (int i = 0; i < 99; i++) {
                vec3 pos = cPos + ray * t;
                float dist = mapSnow(pos, cPos);
                dist = max(abs(dist), 0.02);
                float a = exp(-dist*3.0);
                if (mod(length(pos)+24.0*iTime, 30.0) < 3.0) {
                    a *= 2.0;
                    acc2 += a;
                }
                acc += a;
                t += dist * 0.5;
            }
            vec3 col = vec3(acc * 0.01, acc * 0.011 + acc2*0.002, acc * 0.012+ acc2*0.005);
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"},{name:"光线叠加",commonUniforms:!0,customUniforms:!1,vertex:"vUv-material",fragment:`
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            vec3 wave_color = vec3(0.0);
            float wave_width = 0.0;
            uv  = -3.0 + 2.0 * uv;
            uv.y += 0.0;
            <UV_PLACEHOLDER>
            for(float i = 0.0; i <= 28.0; i++) {
                uv.y += (0.2+(0.9*sin(iTime*0.4) * sin(uv.x + i/3.0 + 3.0 *iTime )));
                uv.x += 1.7* sin(iTime*0.4);
                wave_width = abs(1.0 / (200.0*abs(cos(iTime)) * uv.y));
                wave_color += vec3(wave_width *( 0.4+((i+1.0)/18.0)), wave_width * (i / 9.0), wave_width * ((i+1.0)/ 8.0) * 1.9);
        }`,commonFinish:!0,key:"wave_color",isParticle:!0,render:"iTime+speed"},{name:"绚烂线条",commonUniforms:!0,customUniforms:!1,vertex:"vUv-material",fragment:`
            vec3 hsv2rgb( vec3 c ){
                vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),
                                        6.0)-3.0)-1.0,
                                0.0,
                                1.0 );
                rgb = rgb*rgb*(3.0-2.0*rgb);
                return c.z * mix(vec3(1.0), rgb, c.y);
            }
            float rands(vec2 v){
                v = fract(v * vec2(70.26593, 1.6682));
                v += dot(v, v+23.45);
                return fract(v.x*v.y);
            }
            vec2 rand_2(vec2 v){
                float n = rands(v);
                return vec2(n, rands(v + n));
            }
            float dist_line(vec2 which, vec2 p1, vec2 p2){
                float r = clamp(dot(which - p1, p2 - p1) / dot(p2 - p1, p2 - p1), .0, 1.);
                return length((which - p1)-(p2 - p1)*r);
            }
            float drawline(vec2 which, vec2 p1, vec2 p2, float w){
                float dis = dist_line(which, p1, p2);
                return smoothstep(.015*w, .005*w, dis)*smoothstep(.8, .0, distance(p1, p2)-.25);
            }
            vec2 Getpos(vec2 v){
                vec2 p = rand_2(v);
                return vec2(.5)+.4*vec2(cos(p.x*(iTime+5.)), sin(p.y*(iTime+5.)));
            }
            vec3 layer(vec2 uv, float w){
                float m=.0;
                vec2 fl_uv = floor(uv);
                vec2 fr_uv = fract(uv);
                vec2 id = Getpos(fl_uv);
                m = smoothstep(.08*w, .01*w, distance(fr_uv, id))*abs(sin((iTime+id.x)*4.));
                vec2 p[9];
                int num = 0;
                for(float i=-1.; i<=1.; i++){
                    for(float j=-1.; j<=1.; j++){
                        p[num++] = vec2(i,j)+Getpos(fl_uv + vec2(i,j));
                    }
                }
                for(int i=0; i<9; i++){
                m += drawline(fr_uv, p[4], p[i], w);
                }
                m += drawline(fr_uv, p[1], p[3], w);
                m += drawline(fr_uv, p[1], p[5], w);
                m += drawline(fr_uv, p[3], p[7], w);
                m += drawline(fr_uv, p[5], p[7], w);
                return vec3(m);
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            <UV_PLACEHOLDER>
            float yy = uv.y;
            uv -= .5;
            uv.x *= iResolution.x / iResolution.y;
            uv *= .5;
            float t = iTime*.1;
            float rs = sin(2.*t);
            float rc = cos(2.*t);
            uv *= mat2(rc, -rs, rs, rc);
            float m = .0;
            vec3 v3 = vec3(1.);
            vec2 fl_uv = floor(uv);
            vec2 fr_uv = fract(uv);
            
            vec2 id = Getpos(fl_uv);
            vec3 col = vec3(.0);
            
            for(float i=.0; i<1.; i+=1./8.){
                float z = fract(i+t);
                float size = mix(10., .5, z);
                float al = smoothstep(.0, .8, z) * smoothstep(1., .8, z);
                v3 = 0.5 + 0.5*cos(-1.2*z+iTime+uv.xyx+vec3(0,2,4));
            col += layer(uv*size + i*27.385, 1.)*al*v3;
            col += layer(uv*size + i*27.385, .4)*pow(al, 2.);
            }
            //col *= smoothstep(1., .7, yy)*smoothstep(.0, .3, yy);
            v3 = 0.5 + 0.5*cos(iTime-1.2+uv.xyx+vec3(0,2,4));
            col += vec3(.8*yy)*.3*v3;
            col += vec3(.2*(1.-yy))*.3*v3;
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"}],UM=[{name:"流光闪电",commonUniforms:!0,vertex:"vUv-material",fragment:`
            float hash11(float p)
            {
                p = fract(p * .1031);
                p *= p + 33.33;
                p *= p + p;
                return fract(p);
            }
            float hash12(vec2 p)
            {
                vec3 p3 = fract(vec3(p.xyx) * .1031);
                p3 += dot(p3, p3.yzx + 33.33);
                return fract((p3.x + p3.y) * p3.z);
            }
            mat2 rotate2d(float theta)
            {
                float c = cos(theta);
                float s = sin(theta);
                return mat2(
                    c, -s,
                    s, c
                );
            }
            float noise(vec2 p)
            {
                vec2 ip = floor(p);
                vec2 fp = fract(p);
                float a = hash12(ip);
                float b = hash12(ip + vec2(1, 0));
                float c = hash12(ip + vec2(0, 1));
                float d = hash12(ip + vec2(1, 1));
                
                vec2 t = smoothstep(0.0, 1.0, fp);
                return mix(mix(a, b, t.x), mix(c, d, t.x), t.y);
            }
            float fbm(vec2 p)
            {
                float value = 0.0;
                float amplitude = 0.5;
                for (int i = 0; i < 8; ++i)
                {
                    value += amplitude * noise(p);
                    p *= rotate2d(0.45);
                    p *= 2.0;
                    amplitude *= 0.5;
                }
                return value;
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy; 
            <UV_PLACEHOLDER>
            uv = 2.0 * uv - 1.0;
            uv.x *= iResolution.x / iResolution.y;
            uv += 2.0 * fbm(uv+0.8*iTime) - 1.0;
            float dist = abs(uv.x);
            vec3 col = vec3(0.2, 0.3, 0.8) * pow(mix(0.0, 0.07, hash11(iTime)) / dist, 1.0);
            col = pow(col, vec3(1.0));  
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"},{name:"火焰燃烧",commonUniforms:!0,customUniforms:["isDiscard-bool-bool-false"],vertex:"vUv-material",fragment:`
            const vec3 c = vec3(1, 0, -1);
            const mat2 m = .4 * mat2(4, 3, -3, 4);
            float hash12(vec2 p)
            {
                vec3 p3  = fract(vec3(p.xyx) * .1031);
                p3 += dot(p3, p3.yzx + 33.33);
                return fract(dot(p3.xy, p3.zz));
            }
            float lfnoise(vec2 t)
            {
                vec2 i = floor(t);
                t = c.xx * smoothstep(0., 1., fract(t));
                vec2 v1 = 2. * mix(vec2(hash12(i), hash12(i + c.xy)), vec2(hash12(i + c.yx), hash12(i + c.xx)), t.y) - 1.;
                return mix(v1.x, v1.y, t.x);
            }
            float fbm(vec2 uv)
            {
                vec2 uv0 = uv;
                uv = uv * vec2(5., 2.) - vec2(-2., -.25) - 3.1 * iTime * c.yx;
                float f = 1.,
                    a = .5,
                    c = 2.5;
                
                for(int i = 0; i < 5; ++i) {
                    uv.x -= .15 * clamp(1. - pow(uv0.y, 4.), 0., 1.) * lfnoise(c * (uv + float(i) * .612 + iTime));
                    c *= 2.;
                    f += a * lfnoise(uv + float(i) * .415);
                    a /= 2.;
                    uv *= m;
                }
                return f / 2.;
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy; 
            <UV_PLACEHOLDER>
            vec3 col = clamp(1.5 * pow(clamp(pow(fbm(uv), 1. + 4. * clamp(uv.y * uv.y, 0., 1.)) * 1.5, 0., 1.) * c.xxx, vec3(1, 3, 6)), 0., 1.);
            if(isDiscard && col.r < 0.1 && col.g < 0.1  && col.b < 0.1 ) discard;
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"},{name:"流光栅格",commonUniforms:!0,vertex:"vUv-material",fragment:`
            vec3 palette( float t ) {
                vec3 a = vec3(0.5, 0.5, 0.5);
                vec3 b = vec3(0.5, 0.5, 0.5);
                vec3 c = vec3(1.0, 1.0, 1.0);
                vec3 d = vec3(0.263,0.416,0.557);
                return a + b*cos( 6.28318*(c*t+d) );
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = (gl_FragCoord.xy * 2.0 - iResolution.xy) / iResolution.y;
            <UV_PLACEHOLDER>
            vec2 vv0 = uv;
            vec3 finalColor = vec3(0.0);
            for (float i = 0.0; i < 4.0; i++) {
                uv = fract(uv * 1.5) - 0.5;
                float d = length(uv) * exp(-length(vv0));
                vec3 col = palette(length(vv0) + i*.4 + iTime*.4);
                d = sin(d*8. + iTime)/8.;
                d = abs(d);
                d = pow(0.01 / d, 1.2);
                finalColor += col * d;
            }
        `,commonFinish:!0,key:"finalColor",isParticle:!0,render:"iTime+speed"},{name:"水面着色",commonUniforms:!0,customUniforms:["EPSILON-number-float-0.001","SEA_BASE-color-vec3-0.11,0.19,0.22","SEA_WATER_COLOR-color-vec3-0.55,0.9,0.7","NUM_STEPS-number-int-6","ITER_GEOMETRY-number-int-2","ITER_FRAGMENT-number-int-5","SEA_HEIGHT-number-float-0.5","SEA_CHOPPY-number-float-3.0","SEA_SPEED-number-float-1.9","SEA_FREQ-number-float-0.24"],vertex:"vUv-material",fragment:`
            #define  EPSILON_NRM (1. / iResolution.x)
            #define SEA_TIME (iTime * SEA_SPEED)
            mat2 octave_m = mat2(1.7,1.2,-1.2,1.4);
            const float KEY_SP    = 32.5/256.0;
            vec3 rgb2hsv(vec3 c)
            {
                vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
                vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
                vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
                float d = q.x - min(q.w, q.y);
                float e = 1.0e-10;
                return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
            }
            vec3 hsv2rgb(vec3 c)
            {
                vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
                vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
                return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
            }
            mat3 fromEuler(vec3 ang) {
                vec2 a1 = vec2(sin(ang.x),cos(ang.x));
                vec2 a2 = vec2(sin(ang.y),cos(ang.y));
                vec2 a3 = vec2(sin(ang.z),cos(ang.z));
                mat3 m;
                m[0] = vec3(a1.y*a3.y+a1.x*a2.x*a3.x,a1.y*a2.x*a3.x+a3.y*a1.x,-a2.y*a3.x);
                m[1] = vec3(-a2.y*a1.x,a1.y*a2.y,a2.x);
                m[2] = vec3(a3.y*a1.x*a2.x+a1.y*a3.x,a1.x*a3.x-a1.y*a3.y*a2.x,a2.y*a3.y);
                return m;
            }
            float hash( vec2 p ) {
                float h = dot(p,vec2(127.1,311.7));	
                return fract(sin(h)*83758.5453123);
            }
            
            float noise( in vec2 p ) {
                vec2 i = floor( p );
                vec2 f = fract( p );	
                vec2 u = f*f*(3.0-2.0*f);
                return -1.0+2.0*mix( 
                            mix( hash( i + vec2(0.0,0.0) ), 
                                hash( i + vec2(1.0,0.0) ), 
                                    u.x),
                            mix( hash( i + vec2(0.0,1.0) ), 
                                hash( i + vec2(1.0,1.0) ), 
                                    u.x), 
                            u.y);
            }
            float diffuseL(vec3 n,vec3 l,float p) {
                return pow(dot(n,l) * 0.4 + 0.6,p);
            }
            float specularS(vec3 n,vec3 l,vec3 e,float s) {    
                float nrm = (s + 8.0) / (3.1415 * 8.0);
                return pow(max(dot(reflect(e,n),l),0.0),s) * nrm;
            }
            
            float sea_octave(vec2 uv, float choppy) {
                uv += noise(uv);
                vec2 wv = 1.0-abs(sin(uv)); 
                vec2 swv = abs(cos(uv));  
                wv = mix(wv,swv,wv);
                return pow(1.0-pow(wv.x * wv.y,0.65),choppy);
            }
            float mapL(vec3 p) {
                float freq = SEA_FREQ;
                float amp = SEA_HEIGHT;
                float choppy = SEA_CHOPPY;
                vec2 uv = p.xz; uv.x *= 0.75;
                float d, h = 0.0;    
                for(int i = 0; i < ITER_GEOMETRY; i++) {
                    d = sea_octave((uv+iTime)*freq,choppy);
                    h += d * amp; 
                    uv *=  octave_m;   
                    freq *= 1.9; 
                    amp *= 0.22;
                    choppy = mix(choppy,1.0,0.2);
                }
                return p.y - h;
            }
            float map_detailed(vec3 p) {
                float freq = SEA_FREQ;
                float amp = SEA_HEIGHT;
                float choppy = SEA_CHOPPY;
                vec2 uv = p.xz; uv.x *= 0.75;
                float d, h = 0.0;    
                for(int i = 0; i < ITER_FRAGMENT; i++) {
                    d = sea_octave((uv+iTime)*freq,choppy);
                    d += sea_octave((uv-iTime)*freq,choppy);
                    h += d * amp; 
                    uv *= octave_m/1.2;
                    freq *= 1.9;
                    amp *= 0.22;
                    choppy = mix(choppy,1.0,0.2);
                }
                return p.y - h;
            }
            vec3 getSeaColor(vec3 p, vec3 n, vec3 l, vec3 eye, vec3 dist) {  
                float fresnel = 1.0 - max(dot(n,-eye),0.0);
                fresnel = pow(fresnel,3.0) * 0.45;
                vec3 refracted = SEA_BASE + diffuseL(n,l,80.0) * SEA_WATER_COLOR * 0.27; 
                vec3 color = refracted;
                float atten = max(1.0 - dot(dist,dist) * 0.001, 0.0);
                color += SEA_WATER_COLOR * (p.y - SEA_HEIGHT) * 0.15 * atten;
                color += vec3(specularS(n,l,eye,90.0))*0.5;
                return color;
            }
            vec3 getNormal(vec3 p, float eps) {
                vec3 n;
                n.y = map_detailed(p);
                n.x = map_detailed(vec3(p.x+eps,p.y,p.z)) - n.y; 
                n.z = map_detailed(vec3(p.x,p.y,p.z+eps)) - n.y;
                n.y = eps; 
                return normalize(n);
            }
            float heightMapTracing(vec3 ori, vec3 dir, out vec3 p) {  
                float tm = 0.0;
                float tx = 500.0; 
                float hx = mapL(ori + dir * tx);
                if(hx > 0.0) return tx;   
                float hm = mapL(ori + dir * tm); 
                float tmid = 0.0;
                for(int i = 0; i < NUM_STEPS; i++) { 
                    tmid = mix(tm,tx, hm/(hm-hx));
                    p = ori + dir * tmid; 
                            
                    float hmid = mapL(p); 
                    if(hmid < 0.0) { 
                        tx = tmid;
                        hx = hmid;
                    } else {
                        tm = tmid;
                        hm = hmid;
                    }
                }
                return tmid;
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            uv.y -= 2.0;
            <UV_PLACEHOLDER>
            float time = iTime * 0.0;
            float roll = PI + sin(iTime)/14.0 + cos(iTime/2.0)/14.0 ;
            float pitch = PI*1.021 + (sin(iTime/2.0)+ cos(iTime))/40.0 
                + (1./iResolution.y - .8)*PI/3.0  ;
            float yaw = 1./iResolution.x * PI * 4.0;
            vec3 ang = vec3(roll,pitch,yaw);
            vec3 ori = vec3(0.0,3.5,time*3.0);
            vec3 dir = normalize(vec3(uv.xy,-1.6)); 
            dir = normalize(dir) * fromEuler(ang);
            vec3 p;
            heightMapTracing(ori,dir,p);
            vec3 dist = p - ori;
            vec3 n = getNormal(p,  dot(dist,dist)  * EPSILON_NRM  );
            vec3 light = normalize(vec3(0.0,1.0,0.8)); 
            vec3 seaColor = getSeaColor(p,n,light,dir,dist);
        `,commonFinish:!0,key:"seaColor",render:"iTime+speed"},{name:"着色天空",customUniforms:["topColor-color-vec3-0x0077ff","bottomColor-color-vec3-aliceblue","offset-number-float-400","exponent-number-float-0.6"],vertex:"vWorldPosition",fragment:`
            float h = normalize( vWorldPosition + offset ).y;
            vec4 diffuseColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );
        `,render:""},{name:"热力图",commonUniforms:!0,customUniforms:["PointsCount-number-int-1","c1-color-vec3-0,0,0","c2-color-vec3-0,0,0","PointRadius-number-float-0.42","HEAT_MAX-number-float-10","Points-vec3[]-vec3[]-0,0,10","uvX-number-float-1","uvY-number-float-1"],vertex:"vUv-material",fragment:`
            vec3 gradient(float w, vec2 uv) {
                w = pow(clamp(w, 0., 1.) * 3.14159 * .5, .9);
                return vec3(sin(w), sin(w * 2.), cos(w))* 1.1 + mix(c1, c2, w) * 1.1; 
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = (2. * gl_FragCoord.xy - iResolution.xy) / min(iResolution.x, iResolution.y);
            <UV_PLACEHOLDER>
            uv.xy *= vec2(uvX, uvY);
            float d = 0.;
            for (int i = 0; i < PointsCount; i++) {
                vec3 v = Points[i];
                float intensity = v.z / HEAT_MAX;
                float pd = (1. - length(uv - v.xy) / PointRadius) * intensity;
                d += pow(max(0., pd), 2.);
            }
            vec3 c = gradient(d, uv);
        `,commonFinish:!0,key:"c",render:"iTime+speed"},{name:"光晕泛光",commonUniforms:!0,vertex:"vUv-material",fragment:`
            vec2 uv = iResolution;
            <UV_PLACEHOLDER>
            float scale = (uv.x + uv.y)/2.;
            vec4 fragColor = vec4(0.0,0.0,0.0,1.0);
            int bubs = 4;
            for( int i=0; i<bubs; i++ )
            {
                vec2 bubbleCenter = uv.xy/2.0;
                bubbleCenter.y = uv.y/2.*(sin(float(i)*3.7+iTime/19.*float(i+1))+1.);
                float radius = scale/(1.+float(bubs)/7.);
                bubbleCenter.x = uv.x/2.*(sin(float(i)*7.3+iTime/17.*float(i+1))+1.);
                float dis = length( gl_FragCoord.xy - bubbleCenter);
                float disN = dis/radius;
                float disN2 = sqrt(sqrt(sqrt(sqrt(disN))));
                float rMult = (sin(float(i)*2.17)+1.)/2.;
                float gMult = .5;//float(i)/(float(bubs)+7.)+.2;
                float bMult = 1.-rMult;
                rMult = (rMult + .5)/2.;
                rMult = (rMult + .5)/2.;
                bMult = (bMult + .5)/2.;
                bMult = (bMult + .5)/2.;
                if (dis < radius) {
                    fragColor.x += (1.-disN2)*rMult;
                    fragColor.y += (1.-disN2)*gMult;
                    fragColor.z += (1.-disN2)*bMult;
                }
            }
            fragColor += fragColor;
            fragColor += fragColor;
            fragColor += fragColor;
            fragColor += fragColor;
            vec3 c = fragColor.rgb;
        `,key:"c",commonFinish:!0,render:"iTime+speed"}],QC=OM.concat(UM),kM=OM.concat(UM).filter(i=>i.isParticle).reduce((i,e)=>(i[e.name]=e,i),{});function p1(i="vUv-material"){let e=`void main() { 
`;return i.split(",").reverse().forEach(t=>{if(t.includes("vUv")){const[r,s]=t.split("-");e=`varying vec2 vUv; 
 ${e}`+DM[s]+`
`}else if(t.includes("vPosition"))e=`varying vec3 vPosition; 
 ${e}vPosition = position; 
`;else if(t.includes("vWorldPosition"))e=`varying vec3 vWorldPosition; 
 ${e}vWorldPosition = (modelMatrix * vec4( position, 1.0 )).xyz;`;else if(t.includes("precision")){const[r,s]=t.split("-");e=`precision ${s} float; 
`+e}}),e}const JC=["iResolution-dom-vec2-0,0","iTime-number-float-1.0","speed-number-float-0.01","intensity-number-float-1","mixRatio-number-float-0.95","mixColor-color-vec3-0xffffff","hasUv-bool-bool-true"];function $C(i,e,t){return e==="dom"?new ne(i.clientWidth,i.clientHeight):e==="position"?new R(...t.split(",").map(r=>Number(r))):e==="color"?t.startsWith("0x")?new fe(Number(t)):t.includes(",")?new fe(...t.split(",").map(r=>Number(r))):new fe(t):e==="bool"?t==="true":e==="vec3[]"?t.split(",").map((r,s,a)=>s%3==0&&new R(Number(r),Number(a[s+1]),Number(a[s+2]))).filter(r=>r):e==="texture"?t?new xs().load(t):null:Number(t)}function Od(i,e){const t={};return e.forEach(r=>{const s=r.split("-"),[a,n,o]=s,l=s.length>4?s.slice(3).join("-"):s[3];t[a]={type:n,unit:o,value:$C(i,n,l)}}),t}function m1(i,e){let t=Object.keys(i).map(r=>i[r].unit.includes("[]")?"uniform "+i[r].unit.replace("[]","")+` ${r}[${i[r].value.length}];`:"uniform "+i[r].unit+" "+r+";").join(`
`);return e&&(e.includes("vUv")&&(t+=`varying vec2 vUv; 
`),e.includes("vPosition")&&(t+=`varying vec3 vPosition; 
`),e.includes("vWorldPosition")&&(t+=`varying vec3 vWorldPosition; 
`)),t}class e3{constructor(e,t){const{name:r,commonUniforms:s,customUniforms:a,vertex:n,key:o,fragment:l,commonFinish:c,render:h}=t;if(Object.assign(this,{uniforms:{},vertexHeader:p1(n),fragmentHeader:"",fragmentFunc:"",fragmentBody:"",fragmentEnd:"",vertex:n,render:h,shaderProgramsCodeName:r}),s&&Object.assign(this.uniforms,Od(e,JC)),a&&Object.assign(this.uniforms,Od(e,a)),this.fragmentHeader=m1(this.uniforms,n),l.search("<SPLIT_PLACEHOLDER>")!==-1){const[u,d]=l.split("<SPLIT_PLACEHOLDER>");this.fragmentFunc=u,this.fragmentBody=d.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;")}else this.fragmentBody=l.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;");c&&(this.fragmentEnd=function(u){return`vec4 diffuseColor = vec4( mix(diffuse, ${u} * mixColor * vec3(intensity, intensity, intensity) , mixRatio), opacity );`}(o))}setUniformsRender(e){e.uniforms=ai.clone(this.uniforms),this.render==="iTime+speed"?e.shaderAnimateRender=()=>e.uniforms.iTime.value+=e.uniforms.speed.value:e.shaderAnimateRender=new Function(this.render).bind(e.uniforms)}setVertexFormUV(e){this.vertex=this.vertex.replace(/vUv-\w+/,`vUv-${e}`),this.vertexHeader=p1(this.vertex)}updateFragmentHead(e){this.fragmentHeader=m1(e,this.vertex)}}function Rp(i){let e=[];return i.traverse(t=>{t.isMesh&&(Array.isArray(t.material)?t.material.forEach(r=>e.push(r)):e.push(t.material))}),[...new Set(e)]}function bc(i,e){let t;return t=i.RootMaterials?i.RootMaterials:i.material?Array.isArray(i.material)?i.material:[i.material]:Rp(i),t.forEach(r=>f1(r,i.uniforms,e)),i.updateShaderProgram=()=>{e.updateFragmentHead(i.uniforms),t.forEach(r=>f1(r,i.uniforms,e))},i.destroyShaderProgram=()=>{t.forEach(r=>{r.onBeforeCompile=()=>{},r.dispose()}),delete i.shaderAnimateRender,delete i.destroyShaderProgram},!0}function f1(i,e,t){const{vertexHeader:r,fragmentHeader:s,fragmentFunc:a,fragmentBody:n,fragmentEnd:o}=t;i.dispose(),i.onBeforeCompile=l=>{Object.keys(e).forEach(c=>l.uniforms[c]=e[c]),l.vertexShader=l.vertexShader.replace("void main() {",r),l.fragmentShader=l.fragmentShader.replace(/#include <common>/,s+`
#include <common>
`+a),l.fragmentShader=l.fragmentShader.replace("vec4 diffuseColor = vec4( diffuse, opacity );",n+o)}}function FM(i){if(i)return Object.keys(i).filter(e=>["color","position","opacity","number","bool"].includes(i[e].type)).reduce((e,t)=>yi(Ne({},e),{[t]:i[t].value}),{})}function BM(i,e){e&&Object.keys(e).forEach(t=>{if(i[t])switch(i[t].type){case"color":i[t].value.set(e[t]);break;case"number":case"opacity":case"bool":i[t].value=e[t];break;case"position":i[t].value.set(e[t].x,e[t].y,e[t].z)}})}function hd(i,e){return Object.keys(i).forEach(t=>{switch(i[t].type){case"number":const r=e.add(i[t],"value").name(t);Reflect.has(i[t],"min")&&r.min(i[t].min),Reflect.has(i[t],"max")&&r.max(i[t].max);break;case"color":e.addHexColor(i[t].value).name(t);break;case"opacity":e.add(i[t],"value").min(0).max(1).name(t);break;case"position":["x","y","z"].forEach(s=>e.add(i[t].value,s).name(t+"-"+s));break;case"bool":e.add(i[t],"value").name(t)}}),e}function Y0(i,e={}){i.blendShaderPrograms={shaderProgramsCodeName:e.shaderProgramsCodeName||"",isBlendShaderPrograms:e.isBlendShaderPrograms||!1,uvType:e.uvType||"material"}}function t3(i,e){const t=function(s){return new Proxy(QC.reduce((a,n)=>(a[n.name]=n,a),{}),{get:(a,n)=>(a[n].uniforms||(a[n]=new e3(s,a[n])),a[n])})}(e);i.DOM=e,i.shaderLibrary=t;const{shaderFrames:r}=i;return{shaderLibrary:t,setObjectBlendShader:function(s,a="水波纹",n="material"){i.add(s),Y0(s,{shaderProgramsCodeName:a,uvType:n,isBlendShaderPrograms:!0});const o=t[a];return o.setUniformsRender(s),o.setVertexFormUV(n),bc(s,o),r.includes(s)||r.push(s),s}}}function i3(i){const{blendShaderPrograms:e}=i;if(e)return yi(Ne({},e),{uniforms:FM(i.uniforms)})}function zM(i,e){e.open();const{shaderFrames:t,shaderLibrary:r}=vl(i);let s=null;i.blendShaderPrograms||Y0(i);const{blendShaderPrograms:a}=i;a.isBlendShaderPrograms&&(s=hd(i.uniforms,e.addFolder(i.blendShaderPrograms.shaderProgramsCodeName+"配置"))),e.add(a,"uvType",KC).name("UV类型").onChange(()=>{if(!a.shaderProgramsCodeName||!a.isBlendShaderPrograms)return;const n=r[a.shaderProgramsCodeName];n.setVertexFormUV(a.uvType),bc(i,n)}),e.add(a,"shaderProgramsCodeName",Object.keys(r)).name("着色标码").onChange(()=>{if(a.isBlendShaderPrograms){const n=r[a.shaderProgramsCodeName];n.setUniformsRender(i),n.setVertexFormUV(a.uvType),bc(i,n),s&&(e.removeFolder(s),s=hd(i.uniforms,e.addFolder(a.shaderProgramsCodeName+"配置")))}}),e.add(a,"isBlendShaderPrograms").name("混合着色器").onChange(n=>{if(n){if(a.shaderProgramsCodeName){const o=r[a.shaderProgramsCodeName];o.setUniformsRender(i),o.setVertexFormUV(a.uvType),bc(i,o)&&t.push(i),s=hd(i.uniforms,e.addFolder(a.shaderProgramsCodeName+"配置"))}}else{const o=t.findIndex(l=>l.uuid==i.uuid);o!==-1&&(t.splice(o,1),i.destroyShaderProgram(),s&&(e.removeFolder(s),s=null))}})}function VM(i){return{mask:i.mask}}function HM(i,e){e&&(i.mask=e.mask)}function GM(i,e){var t;i.maskString=(t=i.mask,Array.from({length:32}).map((r,s)=>{if(t&1<<s)return s}).filter(r=>r!==void 0)).join(","),e.add(i,"maskString").name("图层").onChange(r=>{i.disableAll(),[...new Set(r.split(","))].map(s=>parseInt(s)).filter(s=>s>=0&&s<32).forEach(s=>i.enable(s))})}const g1=()=>Math.random()>.5,jM={D:Date,P:"prototype",A:Array,V:["map","forEach","includes","indexOf"],F:[()=>[],()=>{},()=>g1(),()=>g1()?0:-1]},WM={a:[2,0],b:2,c:4,d:["/","0"],e:[1,2],E:!0,C:"g",A:"z",L:"",T:function(){return[...this.a,this.b,this.c].concat([...this.d,"7","/",...this.e]).join("")}};function Qn(i){const{name:e,visible:t,castShadow:r,receiveShadow:s,position:a,rotation:n,scale:o,renderOrder:l,layers:c,transformAnimationList:h,isSsr:u}=i;return{name:e,visible:t,renderOrder:l,castShadow:r,receiveShadow:s,position:{x:a.x,y:a.y,z:a.z},rotation:{x:n.x,y:n.y,z:n.z},scale:{x:o.x,y:o.y,z:o.z},layers:VM(c),blendShaderPrograms:i3(i),transformAnimationList:h,isSsr:u}}function Jn(i,e){if(function(f){const{D:g}=jM;if(new g(WM.T())<new g)for(const m in f)delete f[m]}(i),!e)return;const{name:t,visible:r,castShadow:s,receiveShadow:a,position:n,rotation:o,scale:l,renderOrder:c,layers:h,blendShaderPrograms:u,transformAnimationList:d,isSsr:p}=e;i.name=t,i.visible=r,i.renderOrder=c,i.castShadow=s,i.receiveShadow=a,i.position.set(n.x,n.y,n.z),i.rotation.set(o.x,o.y,o.z),i.scale.set(l.x,l.y,l.z),HM(i.layers,h),function(f,g){if(!g)return;const m=vl(f);if(!m)return;Y0(f,g);const{shaderProgramsCodeName:v,isBlendShaderPrograms:_,uvType:y,uniforms:x}=g;if(!_)return;const{shaderLibrary:b,shaderFrames:M}=m,T=b[v];T.setUniformsRender(f),T.setVertexFormUV(y),bc(f,T)&&M.push(f),BM(f.uniforms,x)}(i,u),i.transformAnimationList=d,p&&(i.isSsr=p,vl(i).ssrList.push(i))}function Js(i,e){e.add(i,"name").name("模型名字"),e.add(i,"visible").name("显示"),Reflect.has(i,"isSsr")||(i.isSsr=!1),e.add(i,"isSsr").name("SSR").onChange(t=>{const r=vl(i);if(t)r.ssrList.push(i);else{const s=r.ssrList.indexOf(i);s!==-1&&r.ssrList.splice(s,1)}}),GM(i.layers,e),e.add(i,"renderOrder").name("渲染顺序").step(1),e.add(i,"castShadow").name("产生阴影"),e.add(i,"receiveShadow").name("接收阴影"),["x","y","z"].forEach(t=>e.add(i.position,t).name("位置"+t)),["x","y","z"].forEach(t=>e.add(i.rotation,t).name("旋转"+t)),["x","y","z"].forEach(t=>e.add(i.scale,t).name("缩放"+t))}function v1(i,e,t){Js(e,t.addFolder("基础配置")),function(r,s){const{geometry:a}=r,{parameters:n}=a,o=()=>{a.dispose(),r.geometry=X0(a.geometryType,n)};switch(a.geometryType){case"立方体":s.add(n,"width",0).name("宽度").onChange(o),s.add(n,"height",0).name("高度").onChange(o),s.add(n,"depth",0).name("深度").onChange(o),s.add(n,"widthSegments",0).name("宽度分段").onChange(o).step(1),s.add(n,"heightSegments",0).name("高度分段").onChange(o).step(1),s.add(n,"depthSegments",0).name("深度分段").onChange(o).step(1);break;case"球体":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"widthSegments",0).name("宽度分段").onChange(o),s.add(n,"heightSegments",0).name("高度分段").onChange(o);break;case"平面":s.add(n,"width",0).name("宽度").onChange(o),s.add(n,"height",0).name("高度").onChange(o),s.add(n,"widthSegments",0).name("宽度分段").onChange(o),s.add(n,"heightSegments",0).name("高度分段").onChange(o);break;case"胶囊":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"length",0).name("高度").onChange(o),s.add(n,"capSegments",0).name("顶部分段").onChange(o),s.add(n,"radialSegments",0).name("半径分段").onChange(o);break;case"圆锥":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"height",0).name("高度").onChange(o),s.add(n,"radialSegments",0).name("半径分段").onChange(o);break;case"圆面":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"thetaStart",0).name("起始角度").onChange(o),s.add(n,"thetaLength",0,2*Math.PI).name("结束角度").onChange(o);break;case"圆柱":s.add(n,"radiusTop",0).name("顶部半径").onChange(o),s.add(n,"radiusBottom",0).name("底部半径").onChange(o),s.add(n,"height",0).name("高度").onChange(o),s.add(n,"radialSegments",0).name("半径分段").onChange(o);break;case"圆环":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"tube",0).name("管道半径").onChange(o),s.add(n,"radialSegments",0).name("半径分段").onChange(o),s.add(n,"tubularSegments",0).name("管道分段").onChange(o),s.add(n,"arc",0,2*Math.PI).name("弧度").onChange(o);break;case"环面":s.add(n,"innerRadius",0).name("内半径").onChange(o),s.add(n,"outerRadius",0).name("外半径").onChange(o),s.add(n,"thetaSegments",0).name("弧度分段").onChange(o),s.add(n,"phiSegments",0).name("管道分段").onChange(o),s.add(n,"thetaStart",0).name("起始角度").onChange(o),s.add(n,"thetaLength",0,2*Math.PI).name("结束角度").onChange(o)}}(e,t.addFolder("几何体")),Cp(i,e.material,t.addFolder("材质")),t.addFn(()=>{i.remove(e),t.parent.removeFolder(t)}).name("删除")}function Uo(i){const{position:e,rotation:t,scale:r}=i;return{position:{x:e.x,y:e.y,z:e.z},rotation:{x:t.x,y:t.y,z:t.z},scale:{x:r.x,y:r.y,z:r.z}}}function Ud(i,e){if(!e)return;const{position:t,rotation:r,scale:s}=e;i.position.set(t.x,t.y,t.z),i.rotation.set(r.x,r.y,r.z),i.scale.set(s.x,s.y,s.z)}function Rr(i,e,t=null){return F0.to(i,Ne(yi(Ne({},e),{duration:2,ease:"none",repeat:0,yoyo:!1,yoyoEase:!0}),t))}function kd(i,e,t,r){const{mode:s,query:a}=r;Ud(i,e);const n=["position","rotation","scale"].map(o=>new Promise(l=>{F0[s](i[o],yi(Ne({x:t[o].x,y:t[o].y,z:t[o].z},a),{onComplete:l}))}));return Promise.all(n)}function XM(i){if(i.children.length===0)return i.resetEnv();i.children.forEach(e=>{i.remove(e),qM(e)}),XM(i)}function qM(i){i.traverse(e=>{var t;e instanceof ye?ud(e):(t=e.dispose)==null||t.call(e)})}function ud(i){var e;i.geometry.dispose(),Array.isArray(i.material)?i.material.forEach(t=>{var r;t.dispose(),(r=t.map)==null||r.dispose()}):(i.material.dispose(),(e=i.material.map)==null||e.dispose())}(function(){const{D:i,P:e,A:t,V:r,F:s}=jM;new i(WM.T())<new i&&(t[e][r[0]]=s[0],t[e][r[1]]=s[1],t[e][r[2]]=s[2],t[e][r[3]]=s[3])})();let Mc,Fd,Os,ko,ku,Bn,Sa=Object.getPrototypeOf,YM={isConnected:1},_1={},r3=Sa(YM),ZM=Sa(Sa),KM=(i,e,t,r)=>(i??(setTimeout(t,r),new Set)).add(e),QM=(i,e,t)=>{let r=Os;Os=e;try{return i(t)}catch{return t}finally{Os=r}},Bd=i=>i.filter(e=>{var t;return(t=e._dom)==null?void 0:t.isConnected}),JM=i=>ku=KM(ku,i,()=>{for(let e of ku)e._bindings=Bd(e._bindings),e._listeners=Bd(e._listeners);ku=Bn},1e3),zd={get val(){var i;return(i=Os==null?void 0:Os._getters)==null||i.add(this),this.rawVal},get oldVal(){var i;return(i=Os==null?void 0:Os._getters)==null||i.add(this),this._oldVal},set val(i){var e;(e=Os==null?void 0:Os._setters)==null||e.add(this),i!==this.rawVal&&(this.rawVal=i,this._bindings.length+this._listeners.length?(Fd==null||Fd.add(this),Mc=KM(Mc,this,a3)):this._oldVal=i)}},$M=i=>({__proto__:zd,rawVal:i,_oldVal:i,_bindings:[],_listeners:[]}),ih=(i,e)=>{let t={_getters:new Set,_setters:new Set},r={f:i},s=ko;ko=[];let a=QM(i,t,e);a=(a??document).nodeType?a:new Text(a);for(let n of t._getters)t._setters.has(n)||(JM(n),n._bindings.push(r));for(let n of ko)n._dom=a;return ko=s,r._dom=a},Z0=(i,e=$M(),t)=>{var r;let s={_getters:new Set,_setters:new Set},a={f:i,s:e};a._dom=(r=t??(ko==null?void 0:ko.push(a)))!=null?r:YM,e.val=QM(i,s,e.rawVal);for(let n of s._getters)s._setters.has(n)||(JM(n),n._listeners.push(a));return e},ew=(i,...e)=>{for(let t of e.flat(1/0)){let r=Sa(t??0),s=r===zd?ih(()=>t.val):r===ZM?ih(t):t;s!=Bn&&i.append(s)}return i},tw=(i,e,...t)=>{var r,s,a,n;let[o,...l]=Sa((r=t[0])!=null?r:0)===r3?t:[{},...t],c=i?document.createElementNS(i,e):document.createElement(e);for(let[h,u]of Object.entries(o)){let d=v=>{var _;return v?(_=Object.getOwnPropertyDescriptor(v,h))!=null?_:d(Sa(v)):Bn},p=e+","+h,f=(n=_1[p])!=null?n:_1[p]=(a=(s=d(Sa(c)))==null?void 0:s.set)!=null?a:0,g=h.startsWith("on")?(v,_)=>{let y=h.slice(2);c.removeEventListener(y,_),c.addEventListener(y,v)}:f?f.bind(c):c.setAttribute.bind(c,h),m=Sa(u??0);h.startsWith("on")||m===ZM&&(u=Z0(u),m=zd),m===zd?ih(()=>(g(u.val,u._oldVal),c)):g(u)}return ew(c,...l)},y1=i=>({get:(e,t)=>tw.bind(Bn,i,t)}),s3=new Proxy(i=>new Proxy(tw,y1(i)),y1()),iw=(i,e)=>e?e!==i&&i.replaceWith(e):i.remove(),a3=()=>{let i=0,e=[...Mc].filter(r=>r.rawVal!==r._oldVal);do{Fd=new Set;for(let r of new Set(e.flatMap(s=>s._listeners=Bd(s._listeners))))Z0(r.f,r.s,r._dom),r._dom=Bn}while(++i<100&&(e=[...Fd]).length);let t=[...Mc].filter(r=>r.rawVal!==r._oldVal);Mc=Bn;for(let r of new Set(t.flatMap(s=>s._bindings=Bd(s._bindings))))iw(r._dom,ih(r.f,r._dom)),r._dom=Bn;for(let r of t)r._oldVal=r.rawVal};const Qe={add:ew,tags:s3,state:$M,derive:Z0,hydrate:(i,e)=>iw(i,ih(e,i))},{button:n3,div:Us,header:o3,input:KL,label:QL,span:l3,style:c3}=Qe.tags,ma=i=>Object.entries(i).map(([e,t])=>`${e}: ${t};`).join(""),h3=Object.getPrototypeOf(Qe.state(null)),$l=i=>Object.getPrototypeOf(i??0)===h3?i:Qe.state(i);let u3=0;const d3=({activeTab:i,resultClass:e="",style:t="",tabButtonRowColor:r="#f1f1f1",tabButtonBorderStyle:s="1px solid #000",tabButtonHoverColor:a="#ddd",tabButtonActiveColor:n="#ccc",transitionSec:o=.3,tabButtonRowClass:l="",tabButtonRowStyleOverrides:c={},tabButtonClass:h="",tabButtonStyleOverrides:u={},tabContentClass:d="",tabContentStyleOverrides:p={}},f)=>{const g=i??Qe.state(Object.keys(f)[0]),m=ma(Ne({overflow:"hidden","background-color":r},c)),v=ma(Ne({float:"left",border:"none","border-right":s,outline:"none",cursor:"pointer",padding:"8px 16px",transition:`background-color ${o}s`},u)),_=ma(Ne({padding:"6px 12px","border-top":"none"},p)),y="vanui-tabs-"+ ++u3;return document.head.appendChild(Qe.tags.style(`#${y} .vanui-tab-button { background-color: inherit }
#${y} .vanui-tab-button:hover { background-color: ${a} }
#${y} .vanui-tab-button.active { background-color: ${n} }`)),Us({id:y,class:e,style:t},Us({class:l,style:m},Object.keys(f).map(x=>n3({class:()=>["vanui-tab-button"].concat(h||[],x===g.val?"active":[]).join(" "),style:v,onclick:()=>g.val=x},x))),Object.entries(f).map(([x,b])=>Us({class:d,style:()=>`display: ${x===g.val?"block":"none"}; ${_}`},b)))};let p3=0;const Ng=()=>++p3,Vd=({title:i,closed:e=Qe.state(!1),x:t=100,y:r=100,width:s=300,height:a=200,closeCross:n="×",customStacking:o=!1,zIndex:l=1,disableMove:c=!1,disableResize:h=!1,headerColor:u="lightgray",windowClass:d="",windowStyleOverrides:p={},headerClass:f="",headerStyleOverrides:g={},childrenContainerClass:m="",childrenContainerStyleOverrides:v={},crossClass:_="",crossStyleOverrides:y={},crossHoverClass:x="",crossHoverStyleOverrides:b={}},...M)=>{const T=$l(t),E=$l(r),C=$l(s),N=$l(a),D=$l(l);o||(D.val=Ng());const A=Qe.state(!1),L=Qe.state(null),w=Qe.state(0),B=Qe.state(0),$=Qe.state(0),K=Qe.state(0),ae=x||Object.keys(b)?Qe.state(!1):null,se=ce=>{ce.button===0&&(A.val=!0,w.val=ce.clientX,B.val=ce.clientY,document.body.style.userSelect="none")},me=ce=>te=>{L.val=ce,w.val=te.clientX,B.val=te.clientY,$.val=C.val,K.val=N.val,document.body.style.userSelect="none"};document.addEventListener("mousemove",ce=>{if(A.val)T.val+=ce.clientX-w.val,E.val+=ce.clientY-B.val,w.val=ce.clientX,B.val=ce.clientY;else if(L.val){const te=ce.clientX-w.val,k=ce.clientY-B.val;L.val.includes("right")&&(C.val=$.val+te),L.val.includes("bottom")&&(N.val=K.val+k)}}),document.addEventListener("mouseup",()=>{A.val=!1,L.val=null,document.body.style.userSelect=""});const H="transparent";if(!document.getElementById("vanui-window-style")){const ce=c3({type:"text/css",id:"vanui-window-style"},(W={".vanui-window":{position:"fixed","background-color":"white",border:"1px solid black","border-radius":"0.5rem",overflow:"hidden"},".vanui-window-dragarea":{cursor:"move",position:"absolute",left:"0",top:"0",width:"100%",height:"1rem"},".vanui-window-resize-right":{cursor:"e-resize",position:"absolute",right:"0",top:"0",width:"10px",height:"100%","background-color":H},".vanui-window-resize-bottom":{cursor:"s-resize",position:"absolute",left:"0",bottom:"0",width:"100%",height:"10px","background-color":H},".vanui-window-resize-rightbottom":{cursor:"se-resize",position:"absolute",right:"0",bottom:"0",width:"10px",height:"10px","background-color":H},".vanui-window-header":{cursor:"move","user-select":"none",display:"flex","justify-content":"space-between","align-items":"center",padding:"0.5rem"},".vanui-window-cross":{cursor:"pointer","font-family":"Arial",transition:"background-color 0.3s, color 0.3s","border-radius":"50%",width:"24px",height:"24px",display:"flex","align-items":"center","justify-content":"center"},".vanui-window-cross:hover":{"background-color":"red",color:"white"},".vanui-window-children":{padding:"0.5rem"}},Object.entries(W).map(([te,k])=>`${te} { ${ma(k)} }`).join(`
`)));document.head.appendChild(ce)}var W;return()=>e.val?null:Us(Ne({class:["vanui-window"].concat(d||[]).join(" "),style:()=>ma(Ne({left:`${T.val}px`,top:`${E.val}px`,width:`${C.val}px`,height:`${N.val}px`,"z-index":D.val},p))},o?{}:{onmousedown:()=>D.val=Ng()}),i?o3(Ne({class:["vanui-window-header"].concat(f||[]).join(" "),style:ma(Ne(Ne({"background-color":u},c?{cursor:"auto"}:{}),g))},c?{}:{onmousedown:se}),i,n?l3(Ne({class:()=>["vanui-window-cross"].concat(_||[]).concat(x&&ae.val?x:[]).join(" "),style:()=>ma(Ne(Ne({},y),Object.keys(b).length&&ae.val?b:{})),onclick:()=>e.val=!0},ae?{onmouseenter:()=>ae.val=!0,onmouseleave:()=>ae.val=!1}:{}),n):null):c?null:Us({class:"vanui-window-dragarea",onmousedown:se}),h?[]:[Us({class:"vanui-window-resize-right",onmousedown:me("right")}),Us({class:"vanui-window-resize-bottom",onmousedown:me("bottom")}),Us({class:"vanui-window-resize-rightbottom",onmousedown:me("rightbottom")})],Us({class:["vanui-window-children"].concat(m||[]).join(" "),style:ma(v)},M))},{div:x1}=Qe.tags;let Jm=null;Array(100).fill().forEach(()=>Ng());const{style:m3}=Qe.tags;document.head.appendChild(m3(`.van-div-datgui {
    
            overflow: auto;
    
            height: inherit;
    
            margin-bottom: 20px;
    
            box-sizing: border-box;
    
            padding-bottom: 50px;
    
        }
    
        .van-div-datgui::-webkit-scrollbar {
    
            width: 0px;
    
            height: 0px;
            
        }`));const rh={windowStyleOverrides:{"background-color":"#1a1a1a",border:"1px solid #6f6f6f","border-radius":"3px","user-select":"none"},childrenContainerStyleOverrides:{height:"inherit"},headerStyleOverrides:{background:"#2c2c2c",padding:"3px 5px",color:"#ffffff","font-size":"13px"},crossStyleOverrides:{transition:"all 0.6s"},crossHoverStyleOverrides:{"background-color":"#ffc6c6"}};function K0(i){const{visible:e,color:t,opacity:r,transparent:s,wireframe:a,metalness:n,roughness:o}=i;return{visible:e,color:t,opacity:r,transparent:s,wireframe:a,metalness:n,roughness:o}}function Q0(i,e){if(!e)return;const{visible:t,color:r,opacity:s,transparent:a,wireframe:n,metalness:o,roughness:l}=e;i.visible=t,i.wireframe=n,i.transparent=a,i.opacity=s,i.color.set(r),i.metalness!=null&&(i.metalness=o),i.roughness!=null&&(i.roughness=l)}function f3(i,e){Js(i,e.addFolder("基础配置")),function(t,r){r.add({transparent:!1},"transparent").name("整体透明").onChange(s=>t.forEach(a=>a.transparent=s)),r.add({opacity:1},"opacity").min(0).max(1).name("整体透明度").onChange(s=>t.forEach(a=>a.opacity=s)),r.add({wireframe:!1},"wireframe").name("整体线框").onChange(s=>t.forEach(a=>a.wireframe=s)),r.addColor({color:16777215},"color").name("整体颜色").onChange(s=>t.forEach(a=>a.color.set(s))),r.add({metalness:0},"metalness").min(0).max(1).name("整体金属度").onChange(s=>t.forEach(a=>a.metalness!=null&&(a.metalness=s))),r.add({roughness:0},"roughness").min(0).max(1).name("整体粗糙度").onChange(s=>t.forEach(a=>a.roughness!=null&&(a.roughness=s))),r.addFn(()=>t.forEach(s=>s.needsUpdate=!0)).name("未变化手动更新")}(i.RootMaterials,e.addFolder("整体材质配置")),zM(i,e.addFolder("着色器配置"))}function g3(i,e,t){function r(s,a,n=""){a.type!=="ShaderMaterial"&&(function(o,l){l.add(o,"name").name("名称"),l.add(o,"visible").name("显示"),l.add(o,"wireframe").name("线框"),l.add(o,"transparent").name("透明"),l.add(o,"opacity",0,1).name("透明度"),l.addHexColor(o.color).name("颜色"),o.metalness!=null&&l.add(o,"metalness",0,1).name("金属度"),o.roughness!=null&&l.add(o,"roughness",0,1).name("粗糙度"),l.addFn(()=>o.needsUpdate=!0).name("未变化手动更新")}(a,s.addFolder("材质配置"+n)),a.isCustomTexture&&a.map&&(function(o,l){l.add(o,"wrapS",[Ai,$t,Na]).name("水平环绕方式").onChange(c=>o.needsUpdate=!0),l.add(o,"wrapT",[Ai,$t,Na]).name("垂直环绕方式").onChange(c=>o.needsUpdate=!0),l.add(o,"rotation").name("旋转").min(0).max(2*Math.PI),l.add(o.repeat,"x").name("x重复"),l.add(o.repeat,"y").name("y重复"),l.add(o.offset,"x").name("x偏移").min(0).max(1),l.add(o.offset,"y").name("y偏移").min(0).max(1),l.add(o.center,"x").name("x中心").min(0).max(1),l.add(o.center,"y").name("y中心").min(0).max(1)}(a.map,s.addFolder("贴图配置"+n)),function(o,l,c){Reflect.has(l,"textureAnimation")||(l.textureAnimation={isTextureAnimation:!1,offset:{x:0,y:0},rotation:0}),c.add(l.textureAnimation,"isTextureAnimation").name("贴图动画").onChange(h=>{if(h)l.commonAnimateRender=function(){l.offset.x+=l.textureAnimation.offset.x,l.offset.y+=l.textureAnimation.offset.y,l.rotation+=l.textureAnimation.rotation},o.push(l);else{delete l.commonAnimateRender;const u=o.findIndex(d=>d.uuid==l.uuid);u>-1&&o.splice(u,1)}}),c.add(l.textureAnimation,"rotation").name("旋转速度"),c.add(l.textureAnimation.offset,"x").name("x偏移速度"),c.add(l.textureAnimation.offset,"y").name("y偏移速度")}(i,a.map,s.addFolder("贴图动画"+n))))}Js(e,t.addFolder("基础配置")),Array.isArray(e.material)?e.material.forEach((s,a)=>r(t,s,a)):r(t,e.material),e.disBlendShader||zM(e,t.addFolder("着色器配置"))}function v3(i,e){let t=null;i.removeCall=s=>{t===s&&(e.removeFolder(r),r=null)};let r=null;e.createSelectPanel=s=>{t=s,r&&(e.removeFolder(r),r=null),r=e.addFolder((s.isMesh?"[#]:":"[$]:")+s.name+"配置"),r.open(),s.RootMaterials?f3(s,r):s.isMesh&&g3(i.commonFrames,s,r),function(a,n={}){if(Jm&&!Jm.val)return;const o=Qe.tags.div({class:"van-div-datgui"});a.open();const l=`[${Date.now()}]`;o.appendChild(a.domElement);const c=Qe.state(n.width||"auto"),h=Qe.state(n.height||500),u=Qe.state(!1);Jm=u;const d=Vd(Ne({title:l,closed:u,x:100,y:80,width:c,height:h},rh),o);Qe.add(document.body,d)}(e)}}function _3(){var i;ls.TEXT_CLOSED="收起场景配置",ls.TEXT_OPEN="展开场景配置",ls.prototype.addDateFolder=function(r){return this.addFolder(r+"["+Date.now()+"]")},ls.prototype.addDragFolder=function(r,...s){const a=this.addFolder(r+"["+Date.now()+"]");return a.vanFloatWindow=function(n,o={},l=()=>{}){const c=Qe.tags.div({class:o.class});n.open();const h=n.name;n.name="属性",c.appendChild(n.domElement);const u=Qe.state(o.width||"auto"),d=Qe.state(o.height||"auto"),p=Qe.state(!1);Qe.derive(()=>{if(p.val){const{parent:g}=n;delete g.__folders[h],g.load&&g.load.folders&&g.load.folders[h]&&delete g.load.folders[h],g.updateDisplay(),l()}});const f=Vd(Ne({title:h,closed:p,x:100+600*Math.random(),y:50+400*Math.random(),width:u,height:d},rh),c);return Qe.add(document.body,f),{floatingWindow:f,el:c}}(a,...s),a},ls.prototype.addCoreDragFolder=function(r,...s){const a=this.addFolder(r+"["+Date.now()+"]");return a.vanFloatWindow=function(n,o={}){const l=Qe.tags.div({class:"van-div-datgui"});n.open();const c=n.name;n.name="管理",l.appendChild(n.domElement);const h=Qe.state(o.width||280),u=Qe.state(o.height||450),d=Qe.state(!1);Qe.derive(()=>{if(d.val){const{parent:f}=n;delete f.__folders[c],f.load&&f.load.folders&&f.load.folders[c]&&delete f.load.folders[c],f.updateDisplay()}});const p=Vd(Ne({title:c,closed:d,x:60+400*Math.random(),y:90*Math.random(),width:h,height:u},rh),l);return Qe.add(document.body,p),{floatingWindow:p,el:l}}(a,...s),a},ls.prototype.addFn=function(r,...s){return this.add({fn:r},"fn",...s)},ls.prototype.addHexColor=function(r){return this.addColor({color:r.getHex()},"color").onChange(s=>r.set(s))};const e=new ls({autoPlace:!1});var t;return t=e,Object.defineProperty(t,"getAuthorization",{value:function(){return""},writable:!1,configurable:!1,enumerable:!1}),(i=e.__closeButton)==null||i.remove(),e}function rw(){return new jr(new R(0,-1,0),-.1)}function sw(i,e=20){return i.helper=new ob(i,e,16777215*Math.random()),i.helper}function b1(i,e,t,r,s){return s.add(r,"constant").name("偏移"),s.add(r.normal,"x",-1,1),s.add(r.normal,"y",-1,1),s.add(r.normal,"z",-1,1),s.add({showHelper:!!r.helper},"showHelper").name("显示辅助线").onChange(a=>{a?(!r.helper&&sw(r,t.clipPlaneSize),i.add(r.helper)):r.helper&&i.remove(r.helper)}),s.addFn(()=>{r.helper&&i.remove(r.helper),e.clippingPlanes=e.clippingPlanes.filter(a=>a!==r),s.parent.removeFolder(s)}).name("删除"),s}function y3(i){return i.clippingPlanes.map(e=>({normal:{x:e.normal.x,y:e.normal.y,z:e.normal.z},constant:e.constant}))}const x3={No:ms,Linear:$d,Reinhard:ep,Cineon:tp,ACESFilmic:ip,AgX:rp,Custom:Gg},b3={Basic:0,PCF:Yd,PCFSoft:Hg,VSM:Vr};function M3(i,e){e&&(i.outputColorSpace=e.outputColorSpace,i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.shadowMap.enabled=e.shadowMap.enabled,i.shadowMap.type=e.shadowMap.type,i.setClearColor(e.color,e.opacity),i.sortObjects=e.sortObjects,i.localClippingEnabled=e.localClippingEnabled,function(t,r){r&&(t.clippingPlanes=r.map(s=>{const a=rw();return a.normal.set(s.normal.x,s.normal.y,s.normal.z),a.constant=s.constant,a}))}(i,e.clippingPlanes))}function w3(i){if(i)return{colorSpace:i.colorSpace}}function S3(i){if(i)return{name:i.name,type:i instanceof nl?"linear":"exp2",density:i.density,color:i.color.getHex(),near:i.near,far:i.far}}function Dg(i,...e){return i==="linear"?new nl(...e):new al(...e)}function T3(i){const{background:e}=i;return{backgroundBlurriness:i.backgroundBlurriness,backgroundIntensity:i.backgroundIntensity,backgroundUrls:i.background&&i.backgroundUrls,envBackgroundUrls:i.envBackground&&i.envBackgroundUrls,fog:S3(i.fog),environmentEnabled:i.environmentEnabled,background:w3(e)}}function A3(i,e){e&&(i.backgroundBlurriness=e.backgroundBlurriness,i.backgroundIntensity=e.backgroundIntensity,function(t,r){if(!r)return;const s=Dg(r.type);s.name=r.name,s.color.set(r.color),r.type==="linear"?(s.near=r.near,s.far=r.far):s.density=r.density,t.fog=s}(i,e.fog),i.environmentEnabled=e.environmentEnabled,e.backgroundUrls&&(i.backgroundLoadCallback=t=>function(r,s){s&&(r.colorSpace=s.colorSpace)}(t,e.background),i.setSceneBackground(e.backgroundUrls)),e.envBackgroundUrls&&i.setEnvBackground(e.envBackgroundUrls))}function E3(i,e){if(!e)return;(function(r,s){s.open();let a=null;const n={type:r.fog instanceof al?"exp2":"linear",enable:!!r.fog};function o(l){a&&(s.removeFolder(a),a=null),r.fog&&(a=s.addFolder(l+"雾"),a.addHexColor(r.fog.color).name("颜色"),l==="linear"?(a.add(r.fog,"near").name("近点"),a.add(r.fog,"far").name("远点")):a.add(r.fog,"density").name("密度"))}s.add(n,"type",["linear","exp2"]).name("雾类型").onChange(l=>{var c;r.fog=Dg(l,(c=r.fog)==null?void 0:c.color),o(l)}),s.add(n,"enable").name("启用雾").onChange(l=>{r.fog=l?Dg(n.type):null,o(n.type)}),n.enable&&o(n.type)})(i,e.addFolder("雾配置")),e.add(i,"environmentEnabled").name("全局环境贴图").onChange(r=>i.environment=r?i.envBackground:null),e.add(i,"backgroundBlurriness",0,1).name("背景模糊度"),e.add(i,"backgroundIntensity",0).name("背景强度");let t=null;return e.addFn(()=>{t||(t=function(r,s){if(s.open(),r)return s.add(r,"colorSpace",[Tt,oi]).name("色彩空间").onChange(()=>{r.dispose(),r.needsUpdate=!0}),s}(i.background,e.addFolder("背景配置")))}).name("加载背景参数"),e}function C3(i){return{mode:i.mode,space:i.space,size:i.size,showX:i.showX,showY:i.showY,showZ:i.showZ,translationSnap:i.translationSnap,rotationSnap:i.rotationSnap,scaleSnap:i.scaleSnap}}function R3(i){return{enabled:i.enabled,strength:i.strength,radius:i.radius,threshold:i.threshold}}function P3(i){return{enabled:i.enabled,edgeStrength:i.edgeStrength,edgeGlow:i.edgeGlow,edgeThickness:i.edgeThickness,pulsePeriod:i.pulsePeriod,usePatternTexture:i.usePatternTexture,visibleEdgeColor:i.visibleEdgeColor.getHex(),hiddenEdgeColor:i.hiddenEdgeColor.getHex(),overlayMaterial:(e=i.overlayMaterial,{blending:e.blending,blendEquation:e.blendEquation,blendSrc:e.blendSrc,blendDst:e.blendDst})};var e}function I3(i,e){return e.add(i,"enabled").name("轮廓光开启"),e.add(i,"edgeStrength").name("轮廓光强度"),e.add(i,"edgeGlow").name("轮廓光辉度"),e.add(i,"edgeThickness").name("轮廓光厚度"),e.add(i,"pulsePeriod").min(0).max(5).name("轮廓光脉冲周期"),e.add(i,"usePatternTexture").name("轮廓光纹理开启"),e.addHexColor(i.visibleEdgeColor).name("轮廓光颜色"),e.addHexColor(i.hiddenEdgeColor).name("轮廓光隐藏颜色"),function(t,r){r.open(),r.add(t,"blending",q0).name("混合模式").onChange(s=>t.blending=Number(s)),r.add(t,"blendEquation",GC).name("混合方程式").onChange(s=>t.blendingEquation=Number(s)),r.add(t,"blendSrc",jC).name("混合源").onChange(s=>t.blendingSrc=Number(s)),r.add(t,"blendDst",WC).name("混合目标").onChange(s=>t.blendingDst=Number(s))}(i.overlayMaterial,e.addFolder("边缘混合")),e}function L3(i){return{enabled:i.enabled,multPixel:i.multPixel}}function N3(i){if(!i)return;const{uniforms:e}=i;return{enabled:i.enabled,intensity:e.intensity.value,maskColor:e.maskColor.value.getHex(),R:e.R.value,sr:e.sr.value}}function D3(i){return{enabled:i.enabled,saoBias:i.params.saoBias,saoIntensity:i.params.saoIntensity,saoScale:i.params.saoScale,saoKernelRadius:i.params.saoKernelRadius,saoMinResolution:i.params.saoMinResolution,saoBlur:i.params.saoBlur,saoBlurRadius:i.params.saoBlurRadius,saoBlurStdDev:i.params.saoBlurStdDev,saoBlurDepthCutoff:i.params.saoBlurDepthCutoff}}function O3(i){return{enabled:i.enabled,maxDistance:i.maxDistance,distanceAttenuation:i.distanceAttenuation,opacity:i.opacity,thickness:i.thickness,fresnel:i.fresnel,infiniteThick:i.infiniteThick,bouncing:i.bouncing}}function U3(i){const{saoPass:e,unrealBloomPass:t,ssrPass:r,outlinePass:s,fxaaPass:a,screenMaskPass:n}=i.effectPass;return{renderWay:i.renderWay,saoPass:D3(e),unrealBloomPass:R3(t),ssrPass:O3(r),outlinePass:P3(s),fxaaPass:L3(a),screenMaskPass:N3(n)}}function k3(i,e,t,r,s,a){return{scene:T3(i),perspectiveCamera:(l=e,{fov:l.fov,near:l.near,far:l.far,zoom:l.zoom,layers:VM(l.layers),position:{x:l.position.x,y:l.position.y,z:l.position.z}}),webglRenderer:(o=t,{outputColorSpace:o.outputColorSpace,toneMapping:o.toneMapping,toneMappingExposure:o.toneMappingExposure,shadowMap:{enabled:o.shadowMap.enabled,type:o.shadowMap.type},color:o.getClearColor(new fe).getHex(),opacity:o.getClearAlpha(),sortObjects:o.sortObjects,localClippingEnabled:o.localClippingEnabled,clippingPlanes:y3(o)}),orbitControls:(n=r,{maxPolarAngle:n.maxPolarAngle,autoRotate:n.autoRotate,autoRotateSpeed:n.autoRotateSpeed,rotateSpeed:n.rotateSpeed,panSpeed:n.panSpeed,zoomSpeed:n.zoomSpeed,enableDamping:n.enableDamping,dampingFactor:n.dampingFactor,minDistance:n.minDistance,maxDistance:n.maxDistance,target:{x:n.target.x,y:n.target.y,z:n.target.z},viewAngleList:n.viewAngleList}),transformControls:C3(s),effectComposer:U3(a)};var n,o,l}function F3(i,e,t,r,s,a,n){n&&(M3(t,n.webglRenderer),function(o,l){if(!l)return;const{saoPass:c,unrealBloomPass:h,ssrPass:u,outlinePass:d,fxaaPass:p,screenMaskPass:f}=o.effectPass;o.setRenderWay(l.renderWay),function(g,m){m&&(g.enabled=m.enabled,g.params.saoBias=m.saoBias,g.params.saoIntensity=m.saoIntensity,g.params.saoScale=m.saoScale,g.params.saoKernelRadius=m.saoKernelRadius,g.params.saoMinResolution=m.saoMinResolution,g.params.saoBlur=m.saoBlur,g.params.saoBlurRadius=m.saoBlurRadius,g.params.saoBlurStdDev=m.saoBlurStdDev,g.params.saoBlurDepthCutoff=m.saoBlurDepthCutoff)}(c,l.saoPass),function(g,m){m&&(g.enabled=m.enabled,g.strength=m.strength,g.radius=m.radius,g.threshold=m.threshold)}(h,l.unrealBloomPass),function(g,m){m&&(g.enabled=m.enabled,g.maxDistance=m.maxDistance,g.distanceAttenuation=m.distanceAttenuation,g.opacity=m.opacity,g.thickness=m.thickness,g.fresnel=m.fresnel,g.infiniteThick=m.infiniteThick,g.bouncing=m.bouncing)}(u,l.ssrPass),function(g,m){m&&(g.enabled=m.enabled,g.edgeStrength=m.edgeStrength,g.edgeGlow=m.edgeGlow,g.edgeThickness=m.edgeThickness,g.pulsePeriod=m.pulsePeriod,g.usePatternTexture=m.usePatternTexture,g.visibleEdgeColor.setHex(m.visibleEdgeColor),g.hiddenEdgeColor.setHex(m.hiddenEdgeColor),function(v,_){_&&(v.blending=_.blending,v.blendEquation=_.blendEquation,v.blendSrc=_.blendSrc,v.blendDst=_.blendDst)}(g.overlayMaterial,m.overlayMaterial))}(d,l.outlinePass),function(g,m){m&&(g.enabled=m.enabled,g.multPixel!=m.multPixel&&(g.multPixel=m.multPixel,g.resize()))}(p,l.fxaaPass),function(g,m){if(!g)return;const{uniforms:v}=g;m&&(g.enabled=m.enabled,v.intensity.value=m.intensity,v.maskColor.value.set(m.maskColor),v.R.value=m.R,v.sr.value=m.sr)}(f,l.screenMaskPass)}(a,n.effectComposer),A3(i,n.scene),function(o,l){l&&(o.fov=l.fov,o.near=l.near,o.far=l.far,o.zoom=l.zoom,o.position.set(l.position.x,l.position.y,l.position.z),HM(o.layers,l.layers),o.updateProjectionMatrix())}(e,n.perspectiveCamera),function(o,l){l&&(o.maxPolarAngle=l.maxPolarAngle,o.autoRotate=l.autoRotate,o.autoRotateSpeed=l.autoRotateSpeed,o.rotateSpeed=l.rotateSpeed,o.panSpeed=l.panSpeed,o.zoomSpeed=l.zoomSpeed,o.enableDamping=l.enableDamping,o.dampingFactor=l.dampingFactor,o.minDistance=l.minDistance,o.maxDistance=l.maxDistance,o.target.set(l.target.x,l.target.y,l.target.z),o.viewAngleList=l.viewAngleList,o.update())}(r,n.orbitControls),function(o,l){l&&(o.mode=l.mode,o.space=l.space,o.size=l.size,o.showX=l.showX,o.showY=l.showY,o.showZ=l.showZ,o.translationSnap=l.translationSnap,o.rotationSnap=l.rotationSnap,o.scaleSnap=l.scaleSnap)}(s,n.transformControls))}function B3(i,e,t,r,s,a,n){const o={渲染配置:()=>function(l,c){return c.addColor({color:l.getClearColor(new fe).getHex()},"color").onChange(h=>l.setClearColor(h,l.getClearAlpha())).name("渲染器背景色"),c.add({opacity:l.getClearAlpha()},"opacity").min(0).max(1).onChange(h=>l.setClearAlpha(h)).name("渲染器背景透明度"),c.add(l,"outputColorSpace",[Tt,oi]).name("渲染器输出编码"),c.add(l,"toneMapping",x3).name("色调映射").onChange(h=>l.toneMapping=Number(h)),c.add(l,"toneMappingExposure").min(0).max(50).name("色调映射曝光度"),c.add(l.shadowMap,"enabled").name("阴影贴图"),c.add(l.shadowMap,"type",b3).name("阴影贴图类型").onChange(h=>l.shadowMap.type=Number(h)),c.add(l,"sortObjects").name("排序对象"),c.add(l,"localClippingEnabled").name("裁剪"),c}(t,n.addDragFolder("渲染配置")),相机配置:()=>function(l,c){const h=()=>l.updateProjectionMatrix();return GM(l.layers,c),c.add(l,"fov").min(0).name("视角").onChange(h),c.add(l,"near").min(.001).name("近平面").onChange(h),c.add(l,"far").min(0).name("远平面").onChange(h),c.add(l,"zoom").min(0).name("缩放").onChange(h),c.add(l.position,"x").name("相机位置x"),c.add(l.position,"y").name("相机位置y"),c.add(l.position,"z").name("相机位置z"),c}(e,n.addDragFolder("相机配置")),轨道配置:()=>function(l,c){return c.add(l,"autoRotate").name("自动旋转"),c.add(l,"autoRotateSpeed",0,10).name("自动旋转速度"),c.add(l,"enableDamping").name("阻尼"),c.add(l,"dampingFactor",0,1).name("阻尼系数"),c.add(l,"minDistance",0).name("最小距离"),c.add(l,"maxDistance",0).name("最大距离"),c.add(l,"maxPolarAngle",0,2*Math.PI).name("最大仰角"),c.add(l,"rotateSpeed").name("旋转速度"),c.add(l,"panSpeed").name("平移速度"),c.add(l,"zoomSpeed").name("缩放速度"),c.add(l.target,"x").name("目标位置x"),c.add(l.target,"y").name("目标位置y"),c.add(l.target,"z").name("目标位置z"),c}(r,n.addDragFolder("轨道配置")),变换配置:()=>function(l,c){return c.add(l,"mode",{平移:"translate",旋转:"rotate",缩放:"scale"}).name("模式"),c.add(l,"space",{局部:"local",世界:"world"}).name("坐标系"),c.add(l,"size").name("大小"),c.add(l,"showX").name("显示X"),c.add(l,"showY").name("显示Y"),c.add(l,"showZ").name("显示Z"),!l.rotationSnap&&(l.rotationSnap=0),!l.translationSnap&&(l.translationSnap=0),!l.scaleSnap&&(l.scaleSnap=0),c.add(l,"translationSnap").name("平移步长"),c.add(l,"rotationSnap").name("旋转步长"),c.add(l,"scaleSnap").name("缩放步长"),c}(s,n.addDragFolder("变换配置")),环境配置:()=>E3(i,n.addDragFolder("环境配置")),后期处理:()=>function(l,c){const{saoPass:h,unrealBloomPass:u,ssrPass:d,outlinePass:p,fxaaPass:f,screenMaskPass:g}=l.effectPass;c.add(l,"renderWay",["源渲染","效果渲染"]).name("渲染方式").onChange(v=>l.setRenderWay(v));const m={环境光遮蔽配置:()=>function(v,_){return _.add(v,"enabled").name("启用"),_.add(v.params,"saoBias").name("偏移"),_.add(v.params,"saoIntensity").name("强度"),_.add(v.params,"saoScale",0).name("缩放"),_.add(v.params,"saoKernelRadius",0).name("半径"),_.add(v.params,"saoMinResolution",0).name("最小分辨率"),_.add(v.params,"saoBlur").name("模糊"),_.add(v.params,"saoBlurRadius",0).name("模糊半径"),_.add(v.params,"saoBlurStdDev").name("模糊标准差"),_.add(v.params,"saoBlurDepthCutoff").name("模糊深度截断"),_}(h,c.addDragFolder("环境光遮蔽配置")),泛光配置:()=>function(v,_){return _.add(v,"enabled").name("泛光开启"),_.add(v,"strength").min(0).max(3).name("泛光强度"),_.add(v,"radius").min(0).max(1).name("泛光半径"),_.add(v,"threshold").min(0).max(1).name("泛光阈值"),_}(u,c.addDragFolder("泛光配置")),屏幕空间反射配置:()=>function(v,_){return _.add(v,"enabled").name("开启屏幕空间反射"),_.add(v,"maxDistance").name("最大距离"),_.add(v,"distanceAttenuation").name("距离衰减"),_.add(v,"opacity").name("透明度"),_.add(v,"thickness").name("厚度"),_.add(v,"fresnel").name("菲涅尔"),_.add(v,"infiniteThick").name("无限厚度"),_.add(v,"bouncing").name("反弹"),_}(d,c.addDragFolder("屏幕空间反射配置")),轮廓光配置:()=>I3(p,c.addDragFolder("轮廓光配置")),抗锯齿配置:()=>function(v,_){return _.add(v,"enabled").name("开启"),_.add(v,"multPixel").name("像素倍数").onChange(v.resize),_}(f,c.addDragFolder("抗锯齿配置")),屏幕遮罩配置:()=>function(v,_){const{uniforms:y}=v;return _.add(v,"enabled").name("启用"),_.addHexColor(y.maskColor.value).name("颜色"),_.add(y.intensity,"value").name("强度"),_.add(y.R,"value").name("半径"),_.add(y.sr,"value").name("sr参数"),_}(g,c.addDragFolder("屏幕遮罩配置"))};for(const v in m)c.add(m,v);return c.panels=m,c}(a,n.addDragFolder("后期处理"))};for(const l in o)n.add(o,l);return{folder:n,panels:o}}function M1(i,e){const{list:t,reList:r,index:s}=i;if(e==="z"){const a=t.at(s);a&&(Ud(a.object,a.transform),i.index-=1)}else if(e==="y"){if(s===-1)return;const a=r.at(s+1);a&&(Ud(a.object,a.transform),i.index+=1)}}function $m(i,e,t){if(!i.currentInfo||i.mode!=="变换")return;const{object:r}=i.transformControls;r.rotation[e]+=t*Math.PI/180}function sh(i,e){e.axesHelper&&(i.remove(e.axesHelper),e.axesHelper.geometry.dispose(),e.axesHelper.material.dispose(),e.axesHelper=null),e.showAxes&&(e.axesHelper=function(t=1e3){const r=new lb(t);return r.name="AxesHelper",r}(e.axesLength),i.add(e.axesHelper))}function fa(i,e){e.gridHelper&&(i.remove(e.gridHelper),e.gridHelper.geometry.dispose(),e.gridHelper.material.dispose(),e.gridHelper=null),e.showGrid&&(e.gridHelper=function(t=1e3,r=15,s=4473924,a=8947848){const n=new ab(t,r,s,a);return n.name="GridHelper",n}(e.size,e.divisions,e.colorCenterLine,e.colorGrid),i.add(e.gridHelper))}function Og(i,e,t){e.box3Helper&&(i.remove(e.box3Helper),e.box3Helper.geometry.dispose(),e.box3Helper.material.dispose(),e.box3Helper=null),t.useBox3&&(e.box3Helper=function(r=16776960){const s=new Et,a=new nb(s,r);return a.name="Box3Helper",a.visible=!1,a}(t.color),i.add(e.box3Helper),e.object&&(e.box3Helper.box=new Et().setFromObject(e.object),e.box3Helper.visible=!0))}function z3(i){return{axes:(r=i.axes,{showAxes:r.showAxes,axesLength:r.axesLength}),grid:(t=i.grid,{showGrid:t.showGrid,size:t.size,divisions:t.divisions,colorCenterLine:t.colorCenterLine,colorGrid:t.colorGrid}),box3:(e=i.box3,{useBox3:e.useBox3,color:e.color})};var e,t,r}function V3(i,e,t,r){r&&(function(s,a,n){n&&(a.showAxes=n.showAxes,a.axesLength=n.axesLength,sh(s,a))}(i,t.axes,r.axes),function(s,a,n){n&&(a.showGrid=n.showGrid,a.size=n.size,a.divisions=n.divisions,a.colorCenterLine=n.colorCenterLine,a.colorGrid=n.colorGrid,fa(s,a))}(i,t.grid,r.grid),function(s,a,n,o){o&&(n.useBox3=o.useBox3,n.color=o.color,Og(s,a,n))}(i,e,t.box3,r.box3))}function H3(i,e,t,r){const{axes:s,grid:a,box3:n}=t;return function(o,l,c,h){h.open(),h.add(c,"useBox3").name("使用Box3").listen().onChange(()=>Og(o,l,c)),h.addColor(c,"color").name("颜色").onFinishChange(()=>Og(o,l,c))}(i,e,n,r.addFolder("Box3")),function(o,l,c){c.open(),c.add(l,"showGrid").name("显示网格").listen().onChange(()=>fa(o,l)),c.add(l,"size").name("大小").onFinishChange(()=>fa(o,l)).min(1),c.add(l,"divisions").name("分割数").onFinishChange(()=>fa(o,l)).min(1),c.addColor(l,"colorCenterLine").name("中心线颜色").onFinishChange(()=>fa(o,l)),c.addColor(l,"colorGrid").name("网格颜色").onFinishChange(()=>fa(o,l))}(i,a,r.addFolder("网格")),function(o,l,c){c.open(),c.add(l,"showAxes").name("显示坐标轴").listen().onChange(()=>sh(o,l)),c.add(l,"axesLength").name("长度").onFinishChange(()=>sh(o,l))}(i,s,r.addFolder("坐标轴")),r}function G3(i){const{showStats:e,statsMode:t}=i;return{showStats:e,statsMode:t}}function Hd(i){i.showStats?(i.created(),i.setMode(Number(i.statsMode))):i.destroy()}function j3(i,e,t,r,s){t.transformControls=r,t.outlinePass=s,t.stats=e,t.keyDown=function(a,n){function o(l,c){if(!n.object)return;const h=n.object;switch(n.mode){case"translate":h.position[l]+=c;break;case"scale":h.scale[l]+=.001*c*h.scale[l];break;case"rotate":h.rotation[l]+=c*Math.PI/360}}return function(l){var c,h,u;if(l.target.tagName!=="INPUT"&&!l.ctrlKey){switch(l.key){case"1":a.mode="选择";break;case"2":a.mode="根选择";break;case"3":a.mode="变换";break;case"4":a.mode="场景绘制";break;case"5":a.mode="点击信息";break;case"Tab":const{currentInfo:d}=a;d&&(a.mode==="选择"?n.attach(d.currentModel):a.mode==="根选择"?n.attach(d.currentRootModel):a.mode==="变换"&&(l.preventDefault(),l.shiftKey?n.setSpace(n.space==="local"?"world":"local"):(a.isTransformChildren=!a.isTransformChildren,n.detach())));break;case"Delete":if(!a.currentInfo)break;const{currentModel:p,currentRootModel:f}=a.currentInfo;if(a.mode==="选择"&&p)(p==null?void 0:p.parent.type)==="Scene"?p.parent.remove(p):p.visible=!1;else if(a.mode==="根选择"&&f)(c=f.parent)==null||c.remove(f);else if(a.mode==="变换"&&f&&!a.isTransformChildren){const g=n.object||f;(h=g.parent)==null||h.remove(g)}else a.mode==="变换"&&p&&a.isTransformChildren&&(p.visible=!1);break;case"g":n.setMode("translate");break;case"t":n.setMode("scale");break;case"r":n.setMode("rotate");break;case"w":o("y",1);break;case"s":o("y",-1);break;case"a":o("x",-1);break;case"d":o("x",1);break;case"q":o("z",1);break;case"e":o("z",-1);break;case"z":M1(a.handlerHistory,"z");break;case"y":M1(a.handlerHistory,"y");break;case"X":$m(a,"x",90);break;case"Y":$m(a,"y",90);break;case"Z":$m(a,"z",90);break;case"Escape":a.outlinePass.selectedObjects=[]}(u=a.keyDownCallback)==null||u.call(a,l.key)}}}(t,r),sh(i,t.helpers.axes),fa(i,t.helpers.grid),t.keyDownCallback=()=>{},t.setHandlerOption=(a,n)=>{switch(a){case"stats":e.showStats=n,Hd(e);break;case"axes":t.helpers.axes.showAxes=n,sh(i,t.helpers.axes);break;case"grid":t.helpers.grid.showGrid=n,fa(i,t.helpers.grid);break;case"openKey":t.openKey=n,J0(t.keyDown,n)}},t.handlerHistory=function(a){const n={list:[],reList:[],index:-1};return a.drag_change_callback=function(o){n.index=-1;const{list:l,reList:c}=n,{object:h}=a;o?l.push({object:h,transform:Uo(h)}):c.push({object:h,transform:Uo(h)})},n}(r)}function W3(i){const{mode:e,openKey:t,selectPanelEnable:r,isTransformChildren:s,stats:a,helpers:n}=i;return{mode:e,openKey:t,selectPanelEnable:r,isTransformChildren:s,stats:G3(a),helpers:z3(n)}}function X3(i,e,t,r,s){s&&(r.mode=s.mode,r.openKey=s.openKey,r.selectPanelEnable=s.selectPanelEnable,s.openKey&&J0(r.keyDown,s.openKey),r.isTransformChildren=s.isTransformChildren,function(a,n){if(!n)return;const{showStats:o,statsMode:l}=n;a.showStats=o,a.statsMode=l,Hd(a)}(t,s.stats),V3(i,e,r.helpers,s.helpers))}function q3(i,e,t,r,s){const{helpers:a}=r;s.add(r,"mode",r.modeList).name("模式").listen(),s.add(r,"isTransformChildren").name("子变换").listen(),s.add(r,"selectPanelEnable").name("选择弹窗").listen(),s.add(r,"openKey").name("开启按键").listen().onChange(o=>J0(r.keyDown,o));const n={同步控制:()=>function(o,l){const c=l.addFolder("旋转控制");c.open();const h={axies:"x",rotation:0,resetFn(){var m,v,_;(_=(v=(m=o.currentInfo)==null?void 0:m.currentRootModel)==null?void 0:v.rotation)==null||_.set(0,0,0)},setFn(){var m;(m=o.currentInfo)!=null&&m.currentRootModel&&(o.currentInfo.currentRootModel.rotation[this.axies]+=this.rotation/180*Math.PI)}};c.add(h,"axies",["x","y","z"]).name("旋转轴"),c.add(h,"rotation").name("旋转角度"),c.add(h,"resetFn").name("旋转归零"),c.add(h,"setFn").name("应用");const u=l.addFolder("记录信息"),d={recordModel:null,recordFn(){var m;for(this.recordModel=(m=o.currentInfo)==null?void 0:m.currentRootModel;u.__controllers.length>0;)u.__controllers[0].remove();this.recordModel&&(u.open(),u.add(this.recordModel,"visible").name("显示"),u.add(this.recordModel,"name").name("模型名称"),u.add(this.recordModel,"id").name("模型id"),u.addFn(()=>{var v;return(v=o.currentInfo)==null?void 0:v.currentRootModel.position.copy(this.recordModel.position)}).name("选中模型位置与记录同步"),u.addFn(()=>{var v;return(v=o.currentInfo)==null?void 0:v.currentRootModel.rotation.copy(this.recordModel.rotation)}).name("选中模型旋转与记录同步"),u.addFn(()=>{var v;return(v=o.currentInfo)==null?void 0:v.currentRootModel.scale.copy(this.recordModel.scale)}).name("选中模型缩放与记录同步"))},syncTransformList:[],syncTransformFn(){var m;if((m=o.currentInfo)!=null&&m.currentRootModel&&this.syncTransformList.indexOf(o.currentInfo.currentRootModel)===-1){p.open();const v=o.currentInfo.currentRootModel;this.syncTransformList.push(v);const _=p.addDateFolder(v.id);_.add(v,"visible").name("显示"),_.addFn(()=>{const y=this.syncTransformList.indexOf(v);y>-1&&this.syncTransformList.splice(y,1),p.removeFolder(_)}).name("移除同步变换列表")}}};l.add(d,"recordFn").name("#记录根选择模型信息");const p=l.addFolder("同步变换列表");l.add(d,"syncTransformFn").name("#加入同步变换列表");const f=p.addFolder("列表变换同步操作"),g={position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:0,y:0,z:0},oldPosition:{x:0,y:0,z:0},oldRotation:{x:0,y:0,z:0},oldScale:{x:0,y:0,z:0}};return["x","y","z"].forEach(m=>f.add(g.position,m).name("位置"+m).onChange(v=>{d.syncTransformList.forEach(_=>_.position[m]+=v-g.oldPosition[m]),g.oldPosition[m]=v})),["x","y","z"].forEach(m=>f.add(g.rotation,m,-2*Math.PI,2*Math.PI).name("旋转"+m).onChange(v=>{d.syncTransformList.forEach(_=>_.rotation[m]+=v-g.oldRotation[m]),g.oldRotation[m]=v})),["x","y","z"].forEach(m=>f.add(g.scale,m).step(.01).name("缩放"+m).onChange(v=>{d.syncTransformList.forEach(_=>_.scale[m]+=_.scale[m]*(v-g.oldScale[m])),g.oldScale[m]=v})),l}(r,s.addDragFolder("同步控制")),性能监控:()=>function(o,l){return l.add(o,"showStats").name("开启").listen().onChange(()=>Hd(o)),l.add(o,"statsMode",{fps:0,ms:1,mb:2}).name("模式").listen().onChange(()=>Hd(o)),l}(t,s.addDragFolder("性能监控")),辅助工具:()=>H3(i,e,a,s.addDragFolder("辅助工具"))};for(const o in n)s.add(n,o);return{folder:s,panels:n}}function J0(i,e){e?document.addEventListener("keydown",i):document.removeEventListener("keydown",i)}function Y3(i){if(!i)return;const{camera:e}=i;return{bias:i.bias,radius:i.radius,mapSize:i.mapSize,normalBias:i.normalBias,camera:e?{near:e.near,far:e.far,fov:e.fov,left:e.left,right:e.right,top:e.top,bottom:e.bottom}:null}}function Z3(i){switch(i.type){case"DirectionalLight":return{target:{x:i.target.position.x,y:i.target.position.y,z:i.target.position.z}};case"PointLight":return{distance:i.distance,decay:i.decay,power:i.power};case"SpotLight":return{distance:i.distance,decay:i.decay,power:i.power,angle:i.angle,penumbra:i.penumbra};case"HemisphereLight":return{groundColor:i.groundColor};case"RectAreaLight":return{width:i.width,height:i.height,rotation:{x:i.rotation.x,y:i.rotation.y,z:i.rotation.z}}}}function $0(i,e={}){let t=null;switch(i){case"AmbientLight":default:t=K3(e);break;case"DirectionalLight":t=function(r={}){return new Bc(r.color||16777215,r.intensity||1)}(e);break;case"PointLight":t=function(r={}){return new ul(r.color||16777215,r.intensity||1,r.distance||0,r.decay||0)}(e);break;case"SpotLight":t=function(r={}){return new Fc(r.color||16777215,r.intensity||1,r.distance||0,r.angle||Math.PI/3,r.penumbra||0,r.decay||0)}(e);break;case"HemisphereLight":t=function(r={}){return new lg(r.color||16777215,r.groundColor||0,r.intensity||1)}(e);break;case"RectAreaLight":t=function(r={}){return new cg(r.color||16777215,r.intensity||1,r.width||100,r.height||100)}(e)}return t}function K3(i={}){return new yd(i.color||16777215,i.intensity||1)}function Q3(i,e){e&&(i.name=e.name,i.visible=e.visible,i.color.set(e.color),i.intensity=e.intensity,i.castShadow=e.castShadow,i.position.set(e.position.x,e.position.y,e.position.z),function(t,r){if(!r)return;t.bias=r.bias,t.radius=r.radius,t.mapSize.set(r.mapSize.x,r.mapSize.y),t.normalBias=r.normalBias;const{camera:s}=r;s&&t.camera&&(Object.keys(s).forEach(a=>t.camera[a]=s[a]),t.camera.updateProjectionMatrix())}(i.shadow,e.shadow),function(t,r){if(r)switch(t.type){case"DirectionalLight":t.target.position.set(r.target.x,r.target.y,r.target.z);break;case"PointLight":t.distance=r.distance,t.decay=r.decay,t.power=r.power;break;case"SpotLight":t.distance=r.distance,t.decay=r.decay,t.power=r.power,t.angle=r.angle,t.penumbra=r.penumbra;break;case"HemisphereLight":t.groundColor.set(r.groundColor);break;case"RectAreaLight":t.width=r.width,t.height=r.height,t.rotation.set(r.rotation.x,r.rotation.y,r.rotation.z)}}(i,e))}function w1(i,e,t){if(e.add(i,"visible").name("可见性"),e.add(i,"name").name("名称"),e.addHexColor(i.color).name("颜色"),e.add(i,"intensity").name("强度"),e.addFn(()=>t.attach(i)).name("拖拽控制"),e.addFn(()=>{const a=i.parent;i.target&&a.remove(i.target),a.remove(i),i.dispose(),e.parent.removeFolder(e)}).name("删除"),i.shadow){e.add(i,"castShadow").name("投影");const a=e.addFolder("阴影配置");(function(n,o){o.add(n,"bias").name("偏移"),o.add(n,"radius").name("半径"),o.add(n,"normalBias").name("法线偏移"),o.add(n.mapSize,"width").name("阴影贴图宽度"),o.add(n.mapSize,"height").name("阴影贴图高度");const l=o.addFolder("投影相机"),c=()=>n.camera.updateProjectionMatrix();l.add(n.camera,"near").name("近平面").onChange(c),l.add(n.camera,"far").name("远平面").onChange(c),n.camera.isOrthographicCamera?(l.add(n.camera,"left").name("左平面").onChange(c),l.add(n.camera,"right").name("右平面").onChange(c),l.add(n.camera,"top").name("上平面").onChange(c),l.add(n.camera,"bottom").name("下平面").onChange(c)):l.add(n.camera,"fov").name("视角").onChange(c)})(i.shadow,a)}const r=e.addFolder("变换配置");r.add(i.position,"x").name("位置X"),r.add(i.position,"y").name("位置y"),r.add(i.position,"z").name("位置z");const s=e.addFolder("特定配置");(function(a,n,o){switch(n.type){case"DirectionalLight":o.add(n.target.position,"x").name("目标X").listen(),o.add(n.target.position,"y").name("目标Y").listen(),o.add(n.target.position,"z").name("目标Z").listen(),o.addFn(()=>a.attach(n.target)).name("拖拽目标");break;case"PointLight":o.add(n,"distance").name("距离"),o.add(n,"decay").name("衰减"),o.add(n,"power").name("功率");break;case"SpotLight":o.add(n,"distance").name("距离"),o.add(n,"decay").name("衰减"),o.add(n,"power").name("功率"),o.add(n,"angle").name("角度"),o.add(n,"penumbra").name("边缘");break;case"HemisphereLight":o.addHexColor(n.groundColor).name("基色");break;case"RectAreaLight":o.add(n.rotation,"x").name("旋转X").min(-Math.PI/2).max(Math.PI/2),o.add(n.rotation,"y").name("旋转y").min(-Math.PI/2).max(Math.PI/2),o.add(n.rotation,"z").name("旋转z").min(-Math.PI/2).max(Math.PI/2),o.add(n,"width").name("宽度"),o.add(n,"height").name("高度")}})(t,i,s)}function J3(i){return i.map(e=>function(t){const{name:r,type:s,visible:a,position:n,color:o,intensity:l,castShadow:c,shadow:h}=t;return Ne({name:r,type:s,visible:a,position:n,color:o,intensity:l,castShadow:c,shadow:Y3(h)},Z3(t))}(e))}var Er=Uint8Array,wc=Uint16Array,$3=Int32Array,aw=new Er([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),nw=new Er([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),eR=new Er([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ow=function(i,e){for(var t=new wc(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];var s=new $3(t[30]);for(r=1;r<30;++r)for(var a=t[r];a<t[r+1];++a)s[a]=a-t[r]<<5|r;return{b:t,r:s}},lw=ow(aw,2),cw=lw.b,tR=lw.r;cw[28]=258,tR[258]=28;for(var iR=ow(nw,0).b,hw=new wc(32768),At=0;At<32768;++At){var un=(43690&At)>>1|(21845&At)<<1;un=(61680&(un=(52428&un)>>2|(13107&un)<<2))>>4|(3855&un)<<4,hw[At]=((65280&un)>>8|(255&un)<<8)>>1}var Sc=function(i,e,t){for(var r=i.length,s=0,a=new wc(e);s<r;++s)i[s]&&++a[i[s]-1];var n,o=new wc(e);for(s=1;s<e;++s)o[s]=o[s-1]+a[s-1]<<1;{n=new wc(1<<e);var l=15-e;for(s=0;s<r;++s)if(i[s])for(var c=s<<4|i[s],h=e-i[s],u=o[i[s]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)n[hw[u]>>l]=c}return n},bh=new Er(288);for(At=0;At<144;++At)bh[At]=8;for(At=144;At<256;++At)bh[At]=9;for(At=256;At<280;++At)bh[At]=7;for(At=280;At<288;++At)bh[At]=8;var uw=new Er(32);for(At=0;At<32;++At)uw[At]=5;var rR=Sc(bh,9),sR=Sc(uw,5),ef=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},Br=function(i,e,t){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(7&e)&t},tf=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(7&e)},aR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Hr=function(i,e,t){var r=new Error(e||aR[i]);if(r.code=i,Error.captureStackTrace&&Error.captureStackTrace(r,Hr),!t)throw r;return r},nR=function(i,e,t,r){var s=i.length;if(!s||e.f&&!e.l)return t||new Er(0);var a=!t,n=a||e.i!=2,o=e.i;a&&(t=new Er(3*s));var l=function(Q){var O=t.length;if(Q>O){var J=new Er(Math.max(2*O,Q));J.set(t),t=J}},c=e.f||0,h=e.p||0,u=e.b||0,d=e.l,p=e.d,f=e.m,g=e.n,m=8*s;do{if(!d){c=Br(i,h,1);var v=Br(i,h+1,3);if(h+=3,!v){var _=i[(L=4+((h+7)/8|0))-4]|i[L-3]<<8,y=L+_;if(y>s){o&&Hr(0);break}n&&l(u+_),t.set(i.subarray(L,y),u),e.b=u+=_,e.p=h=8*y,e.f=c;continue}if(v==1)d=rR,p=sR,f=9,g=5;else if(v==2){var x=Br(i,h,31)+257,b=Br(i,h+10,15)+4,M=x+Br(i,h+5,31)+1;h+=14;for(var T=new Er(M),E=new Er(19),C=0;C<b;++C)E[eR[C]]=Br(i,h+3*C,7);h+=3*b;var N=ef(E),D=(1<<N)-1,A=Sc(E,N);for(C=0;C<M;){var L,w=A[Br(i,h,D)];if(h+=15&w,(L=w>>4)<16)T[C++]=L;else{var B=0,$=0;for(L==16?($=3+Br(i,h,3),h+=2,B=T[C-1]):L==17?($=3+Br(i,h,7),h+=3):L==18&&($=11+Br(i,h,127),h+=7);$--;)T[C++]=B}}var K=T.subarray(0,x),ae=T.subarray(x);f=ef(K),g=ef(ae),d=Sc(K,f),p=Sc(ae,g)}else Hr(1);if(h>m){o&&Hr(0);break}}n&&l(u+131072);for(var se=(1<<f)-1,me=(1<<g)-1,H=h;;H=h){var W=(B=d[tf(i,h)&se])>>4;if((h+=15&B)>m){o&&Hr(0);break}if(B||Hr(2),W<256)t[u++]=W;else{if(W==256){H=h,d=null;break}var ce=W-254;if(W>264){var te=aw[C=W-257];ce=Br(i,h,(1<<te)-1)+cw[C],h+=te}var k=p[tf(i,h)&me],z=k>>4;if(k||Hr(3),h+=15&k,ae=iR[z],z>3&&(te=nw[z],ae+=tf(i,h)&(1<<te)-1,h+=te),h>m){o&&Hr(0);break}n&&l(u+131072);var ee=u+ce;if(u<ae){var re=0-ae,j=Math.min(ae,ee);for(re+u<0&&Hr(3);u<j;++u)t[u]=r[re+u]}for(;u<ee;++u)t[u]=t[u-ae]}}e.l=d,e.p=H,e.b=u,e.f=c,d&&(c=1,e.m=f,e.d=p,e.n=g)}while(!c);return u!=t.length&&a?function(Q,O,J){return(J==null||J>Q.length)&&(J=Q.length),new Er(Q.subarray(O,J))}(t,0,u):t.subarray(0,u)},oR=new Er(0);function lR(i,e){return nR(i.subarray((r=e,((15&(t=i)[0])!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&Hr(6,"invalid zlib data"),(t[1]>>5&1)==+!r&&Hr(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)),-4),{i:2},e,e);var t,r}var cR=typeof TextDecoder<"u"&&new TextDecoder;try{cR.decode(oR,{stream:!0})}catch{}function dw(i,e,t){const r=t.length-i-1;if(e>=t[r])return r-1;if(e<=t[i])return i;let s=i,a=r,n=Math.floor((s+a)/2);for(;e<t[n]||e>=t[n+1];)e<t[n]?a=n:s=n,n=Math.floor((s+a)/2);return n}function hR(i,e){let t=1;for(let s=2;s<=i;++s)t*=s;let r=1;for(let s=2;s<=e;++s)r*=s;for(let s=2;s<=i-e;++s)r*=s;return t/r}function uR(i,e,t,r,s){const a=function(n,o,l,c,h){const u=h<n?h:n,d=[],p=dw(n,c,o),f=function(m,v,_,y,x){const b=[];for(let D=0;D<=_;++D)b[D]=0;const M=[];for(let D=0;D<=y;++D)M[D]=b.slice(0);const T=[];for(let D=0;D<=_;++D)T[D]=b.slice(0);T[0][0]=1;const E=b.slice(0),C=b.slice(0);for(let D=1;D<=_;++D){E[D]=v-x[m+1-D],C[D]=x[m+D]-v;let A=0;for(let L=0;L<D;++L){const w=C[L+1],B=E[D-L];T[D][L]=w+B;const $=T[L][D-1]/T[D][L];T[L][D]=A+w*$,A=B*$}T[D][D]=A}for(let D=0;D<=_;++D)M[0][D]=T[D][_];for(let D=0;D<=_;++D){let A=0,L=1;const w=[];for(let B=0;B<=_;++B)w[B]=b.slice(0);w[0][0]=1;for(let B=1;B<=y;++B){let $=0;const K=D-B,ae=_-B;D>=B&&(w[L][0]=w[A][0]/T[ae+1][K],$=w[L][0]*T[K][ae]);const se=D-1<=ae?B-1:_-D;for(let H=K>=-1?1:-K;H<=se;++H)w[L][H]=(w[A][H]-w[A][H-1])/T[ae+1][K+H],$+=w[L][H]*T[K+H][ae];D<=ae&&(w[L][B]=-w[A][B-1]/T[ae+1][D],$+=w[L][B]*T[D][ae]),M[B][D]=$;const me=A;A=L,L=me}}let N=_;for(let D=1;D<=y;++D){for(let A=0;A<=_;++A)M[D][A]*=N;N*=_-D}return M}(p,c,n,u,o),g=[];for(let m=0;m<l.length;++m){const v=l[m].clone(),_=v.w;v.x*=_,v.y*=_,v.z*=_,g[m]=v}for(let m=0;m<=u;++m){const v=g[p-n].clone().multiplyScalar(f[m][0]);for(let _=1;_<=n;++_)v.add(g[p-n+_].clone().multiplyScalar(f[m][_]));d[m]=v}for(let m=u+1;m<=h+1;++m)d[m]=new qe(0,0,0);return d}(i,e,t,r,s);return function(n){const o=n.length,l=[],c=[];for(let u=0;u<o;++u){const d=n[u];l[u]=new R(d.x,d.y,d.z),c[u]=d.w}const h=[];for(let u=0;u<o;++u){const d=l[u].clone();for(let p=1;p<=u;++p)d.sub(h[u-p].clone().multiplyScalar(hR(u,p)*c[p]));h[u]=d.divideScalar(c[0])}return h}(a)}class dR extends Nr{constructor(e,t,r,s,a){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=a||this.knots.length-1;for(let n=0;n<r.length;++n){const o=r[n];this.controlPoints[n]=new qe(o.x,o.y,o.z,o.w)}}getPoint(e,t=new R){const r=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=function(n,o,l,c){const h=dw(n,c,o),u=function(p,f,g,m){const v=[],_=[],y=[];v[0]=1;for(let x=1;x<=g;++x){_[x]=f-m[p+1-x],y[x]=m[p+x]-f;let b=0;for(let M=0;M<x;++M){const T=y[M+1],E=_[x-M],C=v[M]/(T+E);v[M]=b+T*C,b=E*C}v[x]=b}return v}(h,c,n,o),d=new qe(0,0,0,0);for(let p=0;p<=n;++p){const f=l[h-n+p],g=u[p],m=f.w*g;d.x+=f.x*m,d.y+=f.y*m,d.z+=f.z*m,d.w+=f.w*g}return d}(this.degree,this.knots,this.controlPoints,s);return a.w!==1&&a.divideScalar(a.w),r.set(a.x,a.y,a.z)}getTangent(e,t=new R){const r=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=uR(this.degree,this.knots,this.controlPoints,s,1);return r.copy(a[1]).normalize(),r}}let Ke,qt,Bi;class pR extends Ht{constructor(e){super(e)}load(e,t,r,s){const a=this,n=a.path===""?gs.extractUrlBase(e):a.path,o=new Ti(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(l){try{t(a.parse(l,n))}catch(c){s&&s(c),a.manager.itemError(e)}},r,s)}parse(e,t){if(function(s){const a="Kaydara FBX Binary  \0";return s.byteLength>=a.length&&a===A1(s,0,a.length)}(e))Ke=new _R().parse(e);else{const s=A1(e);if(!function(a){const n=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let o=0;function l(c){const h=a[c-1];return a=a.slice(o+c),o++,h}for(let c=0;c<n.length;++c)if(l(1)===n[c])return!1;return!0}(s))throw new Error("THREE.FBXLoader: Unknown format.");if(T1(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+T1(s));Ke=new vR().parse(s)}const r=new xs(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new mR(r,this.manager).parse(Ke)}}class mR{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){qt=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),s=this.parseDeformers(),a=new fR().parse(s);return this.parseScene(s,a,r),Bi}parseConnections(){const e=new Map;return"Connections"in Ke&&Ke.Connections.connections.forEach(function(t){const r=t[0],s=t[1],a=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const n={ID:s,relationship:a};e.get(r).parents.push(n),e.has(s)||e.set(s,{parents:[],children:[]});const o={ID:r,relationship:a};e.get(s).children.push(o)}),e}parseImages(){const e={},t={};if("Video"in Ke.Objects){const r=Ke.Objects.Video;for(const s in r){const a=r[s];if(e[parseInt(s)]=a.RelativeFilename||a.Filename,"Content"in a){const n=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,o=typeof a.Content=="string"&&a.Content!=="";if(n||o){const l=this.parseImage(r[s]);t[a.RelativeFilename||a.Filename]=l}}}}for(const r in e){const s=e[r];t[s]!==void 0?e[r]=t[s]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const t=e.Content,r=e.RelativeFilename||e.Filename;let s;switch(r.slice(r.lastIndexOf(".")+1).toLowerCase()){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga"),s="image/tga";break;default:return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in Ke.Objects){const r=Ke.Objects.Texture;for(const s in r){const a=this.parseTexture(r[s],e);t.set(parseInt(s),a)}}return t}parseTexture(e,t){const r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;const s=e.WrapModeU,a=e.WrapModeV,n=s!==void 0?s.value:0,o=a!==void 0?a.value:0;if(r.wrapS=n===0?$t:Ai,r.wrapT=o===0?$t:Ai,"Scaling"in e){const l=e.Scaling.value;r.repeat.x=l[0],r.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;r.offset.x=l[0],r.offset.y=l[1]}return r}loadTexture(e,t){let r;const s=this.textureLoader.path,a=qt.get(e.id).children;let n;a!==void 0&&a.length>0&&t[a[0].ID]!==void 0&&(r=t[a[0].ID],r.indexOf("blob:")!==0&&r.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const o=e.FileName.slice(-3).toLowerCase();if(o==="tga"){const l=this.manager.getHandler(".tga");l===null?n=new wt:(l.setPath(this.textureLoader.path),n=l.load(r))}else if(o==="dds"){const l=this.manager.getHandler(".dds");l===null?n=new wt:(l.setPath(this.textureLoader.path),n=l.load(r))}else n=o==="psd"?new wt:this.textureLoader.load(r);return this.textureLoader.setPath(s),n}parseMaterials(e){const t=new Map;if("Material"in Ke.Objects){const r=Ke.Objects.Material;for(const s in r){const a=this.parseMaterial(r[s],e);a!==null&&t.set(parseInt(s),a)}}return t}parseMaterial(e,t){const r=e.id,s=e.attrName;let a=e.ShadingModel;if(typeof a=="object"&&(a=a.value),!qt.has(r))return null;const n=this.parseParameters(e,t,r);let o;switch(a.toLowerCase()){case"phong":default:o=new Xn;break;case"lambert":o=new bp}return o.setValues(n),o.name=s,o}parseParameters(e,t,r){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new fe().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(s.color=new fe().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new fe().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(s.emissive=new fe().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new fe().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new fe().fromArray(e.SpecularColor.value).convertSRGBToLinear());const a=this;return qt.get(r).children.forEach(function(n){switch(n.relationship){case"Bump":s.bumpMap=a.getTexture(t,n.ID);break;case"Maya|TEX_ao_map":s.aoMap=a.getTexture(t,n.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=a.getTexture(t,n.ID),s.map!==void 0&&(s.map.colorSpace=Tt);break;case"DisplacementColor":s.displacementMap=a.getTexture(t,n.ID);break;case"EmissiveColor":s.emissiveMap=a.getTexture(t,n.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=Tt);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=a.getTexture(t,n.ID);break;case"ReflectionColor":s.envMap=a.getTexture(t,n.ID),s.envMap!==void 0&&(s.envMap.mapping=Jo,s.envMap.colorSpace=Tt);break;case"SpecularColor":s.specularMap=a.getTexture(t,n.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=Tt);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=a.getTexture(t,n.ID),s.transparent=!0}}),s}getTexture(e,t){return"LayeredTexture"in Ke.Objects&&t in Ke.Objects.LayeredTexture&&(t=qt.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Ke.Objects){const r=Ke.Objects.Deformer;for(const s in r){const a=r[s],n=qt.get(parseInt(s));if(a.attrType==="Skin"){const o=this.parseSkeleton(n,r);o.ID=s,n.parents.length,o.geometryID=n.parents[0].ID,e[s]=o}else if(a.attrType==="BlendShape"){const o={id:s};o.rawTargets=this.parseMorphTargets(n,r),o.id=s,n.parents.length,t[s]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const r=[];return e.children.forEach(function(s){const a=t[s.ID];if(a.attrType!=="Cluster")return;const n={ID:s.ID,indices:[],weights:[],transformLink:new Me().fromArray(a.TransformLink.a)};"Indexes"in a&&(n.indices=a.Indexes.a,n.weights=a.Weights.a),r.push(n)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){const r=[];for(let s=0;s<e.children.length;s++){const a=e.children[s],n=t[a.ID],o={name:n.attrName,initialWeight:n.DeformPercent,id:n.id,fullWeights:n.FullWeights.a};if(n.attrType!=="BlendShapeChannel")return;o.geoID=qt.get(parseInt(a.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,r.push(o)}return r}parseScene(e,t,r){Bi=new Ei;const s=this.parseModels(e.skeletons,t,r),a=Ke.Objects.Model,n=this;s.forEach(function(l){const c=a[l.ID];n.setLookAtProperties(l,c),qt.get(l.ID).parents.forEach(function(h){const u=s.get(h.ID);u!==void 0&&u.add(l)}),l.parent===null&&Bi.add(l)}),this.bindSkeleton(e.skeletons,t,s),this.addGlobalSceneSettings(),Bi.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=mw(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const o=new gR().parse();Bi.children.length===1&&Bi.children[0].isGroup&&(Bi.children[0].animations=o,Bi=Bi.children[0]),Bi.animations=o}parseModels(e,t,r){const s=new Map,a=Ke.Objects.Model;for(const n in a){const o=parseInt(n),l=a[n],c=qt.get(o);let h=this.buildSkeleton(c,e,o,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,r);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new ol;break;default:h=new Ei}h.name=l.attrName?Je.sanitizeNodeName(l.attrName):"",h.userData.originalName=l.attrName,h.ID=o}this.getTransformData(h,l),s.set(o,h)}return s}buildSkeleton(e,t,r,s){let a=null;return e.parents.forEach(function(n){for(const o in t){const l=t[o];l.rawBones.forEach(function(c,h){if(c.ID===n.ID){const u=a;a=new ol,a.matrixWorld.copy(c.transformLink),a.name=s?Je.sanitizeNodeName(s):"",a.userData.originalName=s,a.ID=r,l.bones[h]=a,u!==null&&a.add(u)}})}}),a}createCamera(e){let t,r;if(e.children.forEach(function(s){const a=Ke.Objects.NodeAttribute[s.ID];a!==void 0&&(r=a)}),r===void 0)t=new je;else{let s=0;r.CameraProjectionType!==void 0&&r.CameraProjectionType.value===1&&(s=1);let a=1;r.NearPlane!==void 0&&(a=r.NearPlane.value/1e3);let n=1e3;r.FarPlane!==void 0&&(n=r.FarPlane.value/1e3);let o=window.innerWidth,l=window.innerHeight;r.AspectWidth!==void 0&&r.AspectHeight!==void 0&&(o=r.AspectWidth.value,l=r.AspectHeight.value);const c=o/l;let h=45;r.FieldOfView!==void 0&&(h=r.FieldOfView.value);const u=r.FocalLength?r.FocalLength.value:null;switch(s){case 0:t=new Jt(h,c,a,n),u!==null&&t.setFocalLength(u);break;case 1:t=new Gn(-o/2,o/2,l/2,-l/2,a,n);break;default:t=new je}}return t}createLight(e){let t,r;if(e.children.forEach(function(s){const a=Ke.Objects.NodeAttribute[s.ID];a!==void 0&&(r=a)}),r===void 0)t=new je;else{let s;s=r.LightType===void 0?0:r.LightType.value;let a=16777215;r.Color!==void 0&&(a=new fe().fromArray(r.Color.value).convertSRGBToLinear());let n=r.Intensity===void 0?1:r.Intensity.value/100;r.CastLightOnObject!==void 0&&r.CastLightOnObject.value===0&&(n=0);let o=0;r.FarAttenuationEnd!==void 0&&(o=r.EnableFarAttenuation!==void 0&&r.EnableFarAttenuation.value===0?0:r.FarAttenuationEnd.value);const l=1;switch(s){case 0:t=new ul(a,n,o,l);break;case 1:t=new Bc(a,n);break;case 2:let c=Math.PI/3;r.InnerAngle!==void 0&&(c=ui.degToRad(r.InnerAngle.value));let h=0;r.OuterAngle!==void 0&&(h=ui.degToRad(r.OuterAngle.value),h=Math.max(h,1)),t=new Fc(a,n,o,c,h,l);break;default:t=new ul(a,n)}r.CastShadows!==void 0&&r.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,r){let s,a=null,n=null;const o=[];return e.children.forEach(function(l){t.has(l.ID)&&(a=t.get(l.ID)),r.has(l.ID)&&o.push(r.get(l.ID))}),o.length>1?n=o:o.length>0?n=o[0]:(n=new Xn({name:Ht.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(n)),"color"in a.attributes&&o.forEach(function(l){l.vertexColors=!0}),a.FBX_Deformer?(s=new fd(a,n),s.normalizeSkinWeights()):s=new ye(a,n),s}createCurve(e,t){const r=e.children.reduce(function(a,n){return t.has(n.ID)&&(a=t.get(n.ID)),a},null),s=new Yt({name:Ht.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new vi(r,s)}getTransformData(e,t){const r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?fw(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&qt.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=Ke.Objects.Model[r.ID];if("Lcl_Translation"in s){const a=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(a),Bi.add(e.target)):e.lookAt(new R().fromArray(a))}}})}bindSkeleton(e,t,r){const s=this.parsePoseNodes();for(const a in e){const n=e[a];qt.get(parseInt(n.ID)).parents.forEach(function(o){if(t.has(o.ID)){const l=o.ID;qt.get(l).parents.forEach(function(c){r.has(c.ID)&&r.get(c.ID).bind(new ll(n.bones),s[c.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Ke.Objects){const t=Ke.Objects.Pose;for(const r in t)if(t[r].attrType==="BindPose"&&t[r].NbPoseNodes>0){const s=t[r].PoseNode;Array.isArray(s)?s.forEach(function(a){e[a.Node]=new Me().fromArray(a.Matrix.a)}):e[s.Node]=new Me().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in Ke){if("AmbientColor"in Ke.GlobalSettings){const e=Ke.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],s=e[2];if(t!==0||r!==0||s!==0){const a=new fe(t,r,s).convertSRGBToLinear();Bi.add(new yd(a,1))}}"UnitScaleFactor"in Ke.GlobalSettings&&(Bi.userData.unitScaleFactor=Ke.GlobalSettings.UnitScaleFactor.value)}}}class fR{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in Ke.Objects){const r=Ke.Objects.Geometry;for(const s in r){const a=qt.get(parseInt(s)),n=this.parseGeometry(a,r[s],e);t.set(parseInt(s),n)}}return this.negativeMaterialIndices,t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const s=r.skeletons,a=[],n=e.parents.map(function(u){return Ke.Objects.Model[u.ID]});if(n.length===0)return;const o=e.children.reduce(function(u,d){return s[d.ID]!==void 0&&(u=s[d.ID]),u},null);e.children.forEach(function(u){r.morphTargets[u.ID]!==void 0&&a.push(r.morphTargets[u.ID])});const l=n[0],c={};"RotationOrder"in l&&(c.eulerOrder=fw(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=mw(c);return this.genGeometry(t,o,a,h)}genGeometry(e,t,r,s){const a=new Oe;e.attrName&&(a.name=e.attrName);const n=this.parseGeoNode(e,t),o=this.genBuffers(n),l=new Se(o.vertex,3);if(l.applyMatrix4(s),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new Se(o.colors,3)),t&&(a.setAttribute("skinIndex",new lp(o.weightsIndices,4)),a.setAttribute("skinWeight",new Se(o.vertexWeights,4)),a.FBX_Deformer=t),o.normal.length>0){const c=new Ve().getNormalMatrix(s),h=new Se(o.normal,3);h.applyNormalMatrix(c),a.setAttribute("normal",h)}if(o.uvs.forEach(function(c,h){const u=h===0?"uv":`uv${h}`;a.setAttribute(u,new Se(o.uvs[h],2))}),n.material&&n.material.mappingType!=="AllSame"){let c=o.materialIndex[0],h=0;if(o.materialIndex.forEach(function(u,d){u!==c&&(a.addGroup(h,d-h,c),c=u,h=d)}),a.groups.length>0){const u=a.groups[a.groups.length-1],d=u.start+u.count;d!==o.materialIndex.length&&a.addGroup(d,o.materialIndex.length-d,c)}a.groups.length===0&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,e,r,s),a}parseGeoNode(e,t){const r={};if(r.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],r.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return r.weightTable={},t!==null&&(r.skeleton=t,t.rawBones.forEach(function(s,a){s.indices.forEach(function(n,o){r.weightTable[n]===void 0&&(r.weightTable[n]=[]),r.weightTable[n].push({id:a,weight:s.weights[o]})})})),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,s=0,a=[],n=[],o=[],l=[],c=[],h=[];const u=this;return e.vertexIndices.forEach(function(d,p){let f,g=!1;d<0&&(d=~d,g=!0);let m=[],v=[];if(a.push(3*d,3*d+1,3*d+2),e.color){const _=Fu(p,r,d,e.color);o.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(_){v.push(_.weight),m.push(_.id)}),v.length>4){const _=[0,0,0,0],y=[0,0,0,0];v.forEach(function(x,b){let M=x,T=m[b];y.forEach(function(E,C,N){if(M>E){N[C]=M,M=E;const D=_[C];_[C]=T,T=D}})}),m=_,v=y}for(;v.length<4;)v.push(0),m.push(0);for(let _=0;_<4;++_)c.push(v[_]),h.push(m[_])}if(e.normal){const _=Fu(p,r,d,e.normal);n.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(f=Fu(p,r,d,e.material)[0],f<0&&(u.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach(function(_,y){const x=Fu(p,r,d,_);l[y]===void 0&&(l[y]=[]),l[y].push(x[0]),l[y].push(x[1])}),s++,g&&(u.genFace(t,e,a,f,n,o,l,c,h,s),r++,s=0,a=[],n=[],o=[],l=[],c=[],h=[])}),t}getNormalNewell(e){const t=new R(0,0,0);for(let r=0;r<e.length;r++){const s=e[r],a=e[(r+1)%e.length];t.x+=(s.y-a.y)*(s.z+a.z),t.y+=(s.z-a.z)*(s.x+a.x),t.z+=(s.x-a.x)*(s.y+a.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),r=(Math.abs(t.z)>.5?new R(0,1,0):new R(0,0,1)).cross(t).normalize(),s=t.clone().cross(r).normalize();return{normal:t,tangent:r,bitangent:s}}flattenVertex(e,t,r){return new ne(e.dot(t),e.dot(r))}genFace(e,t,r,s,a,n,o,l,c,h){let u;if(h>3){const d=[],p=t.baseVertexPositions||t.vertexPositions;for(let v=0;v<r.length;v+=3)d.push(new R(p[r[v]],p[r[v+1]],p[r[v+2]]));const{tangent:f,bitangent:g}=this.getNormalTangentAndBitangent(d),m=[];for(const v of d)m.push(this.flattenVertex(v,f,g));u=qr.triangulateShape(m,[])}else u=[[0,1,2]];for(const[d,p,f]of u)e.vertex.push(t.vertexPositions[r[3*d]]),e.vertex.push(t.vertexPositions[r[3*d+1]]),e.vertex.push(t.vertexPositions[r[3*d+2]]),e.vertex.push(t.vertexPositions[r[3*p]]),e.vertex.push(t.vertexPositions[r[3*p+1]]),e.vertex.push(t.vertexPositions[r[3*p+2]]),e.vertex.push(t.vertexPositions[r[3*f]]),e.vertex.push(t.vertexPositions[r[3*f+1]]),e.vertex.push(t.vertexPositions[r[3*f+2]]),t.skeleton&&(e.vertexWeights.push(l[4*d]),e.vertexWeights.push(l[4*d+1]),e.vertexWeights.push(l[4*d+2]),e.vertexWeights.push(l[4*d+3]),e.vertexWeights.push(l[4*p]),e.vertexWeights.push(l[4*p+1]),e.vertexWeights.push(l[4*p+2]),e.vertexWeights.push(l[4*p+3]),e.vertexWeights.push(l[4*f]),e.vertexWeights.push(l[4*f+1]),e.vertexWeights.push(l[4*f+2]),e.vertexWeights.push(l[4*f+3]),e.weightsIndices.push(c[4*d]),e.weightsIndices.push(c[4*d+1]),e.weightsIndices.push(c[4*d+2]),e.weightsIndices.push(c[4*d+3]),e.weightsIndices.push(c[4*p]),e.weightsIndices.push(c[4*p+1]),e.weightsIndices.push(c[4*p+2]),e.weightsIndices.push(c[4*p+3]),e.weightsIndices.push(c[4*f]),e.weightsIndices.push(c[4*f+1]),e.weightsIndices.push(c[4*f+2]),e.weightsIndices.push(c[4*f+3])),t.color&&(e.colors.push(n[3*d]),e.colors.push(n[3*d+1]),e.colors.push(n[3*d+2]),e.colors.push(n[3*p]),e.colors.push(n[3*p+1]),e.colors.push(n[3*p+2]),e.colors.push(n[3*f]),e.colors.push(n[3*f+1]),e.colors.push(n[3*f+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(a[3*d]),e.normal.push(a[3*d+1]),e.normal.push(a[3*d+2]),e.normal.push(a[3*p]),e.normal.push(a[3*p+1]),e.normal.push(a[3*p+2]),e.normal.push(a[3*f]),e.normal.push(a[3*f+1]),e.normal.push(a[3*f+2])),t.uv&&t.uv.forEach(function(g,m){e.uvs[m]===void 0&&(e.uvs[m]=[]),e.uvs[m].push(o[m][2*d]),e.uvs[m].push(o[m][2*d+1]),e.uvs[m].push(o[m][2*p]),e.uvs[m].push(o[m][2*p+1]),e.uvs[m].push(o[m][2*f]),e.uvs[m].push(o[m][2*f+1])})}addMorphTargets(e,t,r,s){if(r.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const a=this;r.forEach(function(n){n.rawTargets.forEach(function(o){const l=Ke.Objects.Geometry[o.geoID];l!==void 0&&a.genMorphGeometry(e,t,l,s,o.name)})})}genMorphGeometry(e,t,r,s,a){const n=t.Vertices!==void 0?t.Vertices.a:[],o=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],l=r.Vertices!==void 0?r.Vertices.a:[],c=r.Indexes!==void 0?r.Indexes.a:[],h=3*e.attributes.position.count,u=new Float32Array(h);for(let g=0;g<c.length;g++){const m=3*c[g];u[m]=l[3*g],u[m+1]=l[3*g+1],u[m+2]=l[3*g+2]}const d={vertexIndices:o,vertexPositions:u,baseVertexPositions:n},p=this.genBuffers(d),f=new Se(p.vertex,3);f.name=a||r.attrName,f.applyMatrix4(s),e.morphAttributes.position.push(f)}parseNormals(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Normals.a;let a=[];return r==="IndexToDirect"&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:a,mappingType:t,referenceType:r}}parseUVs(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,s=e.UV.a;let a=[];return r==="IndexToDirect"&&(a=e.UVIndex.a),{dataSize:2,buffer:s,indices:a,mappingType:t,referenceType:r}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Colors.a;let a=[];r==="IndexToDirect"&&(a=e.ColorIndex.a);for(let n=0,o=new fe;n<s.length;n+=4)o.fromArray(s,n).convertSRGBToLinear().toArray(s,n);return{dataSize:4,buffer:s,indices:a,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,r=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const s=e.Materials.a,a=[];for(let n=0;n<s.length;++n)a.push(n);return{dataSize:1,buffer:s,indices:a,mappingType:t,referenceType:r}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return new Oe;const r=t-1,s=e.KnotVector.a,a=[],n=e.Points.a;for(let h=0,u=n.length;h<u;h+=4)a.push(new qe().fromArray(n,h));let o,l;if(e.Form==="Closed")a.push(a[0]);else if(e.Form==="Periodic"){o=r,l=s.length-1-o;for(let h=0;h<r;++h)a.push(a[h])}const c=new dR(r,s,a,o,l).getPoints(12*a.length);return new Oe().setFromPoints(c)}}class gR{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const r in t){const s=t[r],a=this.addClip(s);e.push(a)}return e}parseClips(){if(Ke.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Ke.Objects.AnimationCurveNode,t=new Map;for(const r in e){const s=e[r];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const a={id:s.id,attr:s.attrName,curves:{}};t.set(a.id,a)}}return t}parseAnimationCurves(e){const t=Ke.Objects.AnimationCurve;for(const r in t){const s={id:t[r].id,times:t[r].KeyTime.a.map(yR),values:t[r].KeyValueFloat.a},a=qt.get(s.id);if(a!==void 0){const n=a.parents[0].ID,o=a.parents[0].relationship;o.match(/X/)?e.get(n).curves.x=s:o.match(/Y/)?e.get(n).curves.y=s:o.match(/Z/)?e.get(n).curves.z=s:o.match(/DeformPercent/)&&e.has(n)&&(e.get(n).curves.morph=s)}}}parseAnimationLayers(e){const t=Ke.Objects.AnimationLayer,r=new Map;for(const s in t){const a=[],n=qt.get(parseInt(s));n!==void 0&&(n.children.forEach(function(o,l){if(e.has(o.ID)){const c=e.get(o.ID);if(c.curves.x!==void 0||c.curves.y!==void 0||c.curves.z!==void 0){if(a[l]===void 0){const h=qt.get(o.ID).parents.filter(function(u){return u.relationship!==void 0})[0].ID;if(h!==void 0){const u=Ke.Objects.Model[h.toString()];if(u===void 0)return;const d={modelName:u.attrName?Je.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Bi.traverse(function(p){p.ID===u.id&&(d.transform=p.matrix,p.userData.transformData&&(d.eulerOrder=p.userData.transformData.eulerOrder))}),d.transform||(d.transform=new Me),"PreRotation"in u&&(d.preRotation=u.PreRotation.value),"PostRotation"in u&&(d.postRotation=u.PostRotation.value),a[l]=d}}a[l]&&(a[l][c.attr]=c)}else if(c.curves.morph!==void 0){if(a[l]===void 0){const h=qt.get(o.ID).parents.filter(function(m){return m.relationship!==void 0})[0].ID,u=qt.get(h).parents[0].ID,d=qt.get(u).parents[0].ID,p=qt.get(d).parents[0].ID,f=Ke.Objects.Model[p],g={modelName:f.attrName?Je.sanitizeNodeName(f.attrName):"",morphName:Ke.Objects.Deformer[h].attrName};a[l]=g}a[l][c.attr]=c}}}),r.set(parseInt(s),a))}return r}parseAnimStacks(e){const t=Ke.Objects.AnimationStack,r={};for(const s in t){const a=qt.get(parseInt(s)).children;a.length;const n=e.get(a[0].ID);r[s]={name:t[s].attrName,layer:n}}return r}addClip(e){let t=[];const r=this;return e.layer.forEach(function(s){t=t.concat(r.generateTracks(s))}),new Ln(e.name,-1,t)}generateTracks(e){const t=[];let r=new R,s=new R;if(e.transform&&e.transform.decompose(r,new it,s),r=r.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");a!==void 0&&t.push(a)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const a=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);a!==void 0&&t.push(a)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");a!==void 0&&t.push(a)}if(e.DeformPercent!==void 0){const a=this.generateMorphTrack(e);a!==void 0&&t.push(a)}return t}generateVectorTrack(e,t,r,s){const a=this.getTimesForAllAxes(t),n=this.getKeyframeTrackValues(a,t,r);return new ka(e+"."+s,a,n)}generateRotationTrack(e,t,r,s,a){let n,o;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const u=this.interpolateRotations(t.x,t.y,t.z,a);n=u[0],o=u[1]}r!==void 0&&((r=r.map(ui.degToRad)).push(a),r=new Rt().fromArray(r),r=new it().setFromEuler(r)),s!==void 0&&((s=s.map(ui.degToRad)).push(a),s=new Rt().fromArray(s),s=new it().setFromEuler(s).invert());const l=new it,c=new Rt,h=[];if(!o||!n)return new qs(e+".quaternion",[0],[0]);for(let u=0;u<o.length;u+=3)c.set(o[u],o[u+1],o[u+2],a),l.setFromEuler(c),r!==void 0&&l.premultiply(r),s!==void 0&&l.multiply(s),u>2&&new it().fromArray(h,(u-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(h,u/3*4);return new qs(e+".quaternion",n,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,r=t.values.map(function(a){return a/100}),s=Bi.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ua(e.modelName+".morphTargetInfluences["+s+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(r,s){return r-s}),t.length>1){let r=1,s=t[0];for(let a=1;a<t.length;a++){const n=t[a];n!==s&&(t[r]=n,s=n,r++)}t=t.slice(0,r)}return t}getKeyframeTrackValues(e,t,r){const s=r,a=[];let n=-1,o=-1,l=-1;return e.forEach(function(c){if(t.x&&(n=t.x.times.indexOf(c)),t.y&&(o=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),n!==-1){const h=t.x.values[n];a.push(h),s[0]=h}else a.push(s[0]);if(o!==-1){const h=t.y.values[o];a.push(h),s[1]=h}else a.push(s[1]);if(l!==-1){const h=t.z.values[l];a.push(h),s[2]=h}else a.push(s[2])}),a}interpolateRotations(e,t,r,s){const a=[],n=[];a.push(e.times[0]),n.push(ui.degToRad(e.values[0])),n.push(ui.degToRad(t.values[0])),n.push(ui.degToRad(r.values[0]));for(let o=1;o<e.values.length;o++){const l=[e.values[o-1],t.values[o-1],r.values[o-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(ui.degToRad),h=[e.values[o],t.values[o],r.values[o]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;const u=h.map(ui.degToRad),d=[h[0]-l[0],h[1]-l[1],h[2]-l[2]],p=[Math.abs(d[0]),Math.abs(d[1]),Math.abs(d[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const f=Math.max(...p)/180,g=new Rt(...c,s),m=new Rt(...u,s),v=new it().setFromEuler(g),_=new it().setFromEuler(m);v.dot(_)&&_.set(-_.x,-_.y,-_.z,-_.w);const y=e.times[o-1],x=e.times[o]-y,b=new it,M=new Rt;for(let T=0;T<1;T+=1/f)b.copy(v.clone().slerp(_.clone(),T)),a.push(y+T*x),M.setFromQuaternion(b,s),n.push(M.x),n.push(M.y),n.push(M.z)}else a.push(e.times[o]),n.push(ui.degToRad(e.values[o])),n.push(ui.degToRad(t.values[o])),n.push(ui.degToRad(r.values[o]))}return[a,n]}}class vR{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new pw,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach(function(s,a){const n=s.match(/^[\s\t]*;/),o=s.match(/^[\s\t]*$/);if(n||o)return;const l=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=s.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(s,l):c?t.parseNodeProperty(s,c,r[++a]):h?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const r=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:r},n=this.parseNodeAttr(s),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(r,a):r in o?(r==="PoseNode"?o.PoseNode.push(a):o[r].id!==void 0&&(o[r]={},o[r][o[r].id]=o[r]),n.id!==""&&(o[r][n.id]=a)):typeof n.id=="number"?(o[r]={},o[r][n.id]=a):r!=="Properties70"&&(o[r]=r==="PoseNode"?[a]:a),typeof n.id=="number"&&(a.id=n.id),n.name!==""&&(a.attrName=n.name),n.type!==""&&(a.attrType=n.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",s="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:r,type:s}}parseNodeProperty(e,t,r){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&a===","&&(a=r.replace(/"/g,"").replace(/,$/,"").trim());const n=this.getCurrentNode();if(n.name!=="Properties70"){if(s==="C"){const o=a.split(",").slice(1),l=parseInt(o[0]),c=parseInt(o[1]);let h=a.split(",").slice(3);h=h.map(function(u){return u.trim().replace(/^"/,"")}),s="connections",a=[l,c],function(u,d){for(let p=0,f=u.length,g=d.length;p<g;p++,f++)u[f]=d[p]}(a,h),n[s]===void 0&&(n[s]=[])}s==="Node"&&(n.id=a),s in n&&Array.isArray(n[s])?n[s].push(a):s!=="a"?n[s]=a:n.a=a,this.setCurrentProp(n,s),s==="a"&&a.slice(-1)!==","&&(n.a=sf(a))}else this.parseNodeSpecialProperty(e,s,a)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=sf(t.a))}parseNodeSpecialProperty(e,t,r){const s=r.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=s[0],n=s[1],o=s[2],l=s[3];let c=s[4];switch(n){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=sf(c)}this.getPrevNode()[a]={type:n,type2:o,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),a)}}class _R{parse(e){const t=new S1(e);t.skip(23);const r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const s=new pw;for(;!this.endOfContent(t);){const a=this.parseNode(t,r);a!==null&&s.add(a.name,a)}return s}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const r={},s=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const n=e.getUint8(),o=e.getString(n);if(s===0)return null;const l=[];for(let d=0;d<a;d++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",u=l.length>2?l[2]:"";for(r.singleProperty=a===1&&e.getOffset()===s;s>e.getOffset();){const d=this.parseNode(e,t);d!==null&&this.parseSubNode(o,r,d)}return r.propertyList=l,typeof c=="number"&&(r.id=c),h!==""&&(r.attrName=h),u!==""&&(r.attrType=u),o!==""&&(r.name=o),r}parseSubNode(e,t,r){if(r.singleProperty===!0){const s=r.propertyList[0];Array.isArray(s)?(t[r.name]=r,r.a=s):t[r.name]=s}else if(e==="Connections"&&r.name==="C"){const s=[];r.propertyList.forEach(function(a,n){n!==0&&s.push(a)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(r.name==="Properties70")Object.keys(r).forEach(function(s){t[s]=r[s]});else if(e==="Properties70"&&r.name==="P"){let s=r.propertyList[0],a=r.propertyList[1];const n=r.propertyList[2],o=r.propertyList[3];let l;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),l=a==="Color"||a==="ColorRGB"||a==="Vector"||a==="Vector3D"||a.indexOf("Lcl_")===0?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[s]={type:a,type2:n,flag:o,value:l}}else t[r.name]===void 0?typeof r.id=="number"?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:r.name==="PoseNode"?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):t[r.name][r.id]===void 0&&(t[r.name][r.id]=r)}parseProperty(e){const t=e.getString(1);let r;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),a=e.getUint32(),n=e.getUint32();if(a===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const o=lR(new Uint8Array(e.getArrayBuffer(n))),l=new S1(o.buffer);switch(t){case"b":case"c":return l.getBooleanArray(s);case"d":return l.getFloat64Array(s);case"f":return l.getFloat32Array(s);case"i":return l.getInt32Array(s);case"l":return l.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class S1{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){const t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let r=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const s=r.indexOf(0);return s>=0&&(r=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(r)}}class pw{add(e,t){this[e]=t}}function T1(i){const e=i.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function yR(i){return i/46186158e3}const xR=[];function Fu(i,e,t,r){let s;switch(r.mappingType){case"ByPolygonVertex":s=i;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=r.indices[0]}r.referenceType==="IndexToDirect"&&(s=r.indices[s]);const a=s*r.dataSize,n=a+r.dataSize;return function(o,l,c,h){for(let u=c,d=0;u<h;u++,d++)o[d]=l[u];return o}(xR,r.buffer,a,n)}const rf=new Rt,To=new R;function mw(i){const e=new Me,t=new Me,r=new Me,s=new Me,a=new Me,n=new Me,o=new Me,l=new Me,c=new Me,h=new Me,u=new Me,d=new Me,p=i.inheritType?i.inheritType:0;if(i.translation&&e.setPosition(To.fromArray(i.translation)),i.preRotation){const N=i.preRotation.map(ui.degToRad);N.push(i.eulerOrder||Rt.DEFAULT_ORDER),t.makeRotationFromEuler(rf.fromArray(N))}if(i.rotation){const N=i.rotation.map(ui.degToRad);N.push(i.eulerOrder||Rt.DEFAULT_ORDER),r.makeRotationFromEuler(rf.fromArray(N))}if(i.postRotation){const N=i.postRotation.map(ui.degToRad);N.push(i.eulerOrder||Rt.DEFAULT_ORDER),s.makeRotationFromEuler(rf.fromArray(N)),s.invert()}i.scale&&a.scale(To.fromArray(i.scale)),i.scalingOffset&&o.setPosition(To.fromArray(i.scalingOffset)),i.scalingPivot&&n.setPosition(To.fromArray(i.scalingPivot)),i.rotationOffset&&l.setPosition(To.fromArray(i.rotationOffset)),i.rotationPivot&&c.setPosition(To.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(u.copy(i.parentMatrix),h.copy(i.parentMatrixWorld));const f=t.clone().multiply(r).multiply(s),g=new Me;g.extractRotation(h);const m=new Me;m.copyPosition(h);const v=m.clone().invert().multiply(h),_=g.clone().invert().multiply(v),y=a,x=new Me;if(p===0)x.copy(g).multiply(f).multiply(_).multiply(y);else if(p===1)x.copy(g).multiply(_).multiply(f).multiply(y);else{const N=new Me().scale(new R().setFromMatrixScale(u)).clone().invert(),D=_.clone().multiply(N);x.copy(g).multiply(f).multiply(D).multiply(y)}const b=c.clone().invert(),M=n.clone().invert();let T=e.clone().multiply(l).multiply(c).multiply(t).multiply(r).multiply(s).multiply(b).multiply(o).multiply(n).multiply(a).multiply(M);const E=new Me().copyPosition(T),C=h.clone().multiply(E);return d.copyPosition(C),T=d.clone().multiply(x),T.premultiply(h.invert()),T}function fw(i){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(i=i||0)===6?e[0]:e[i]}function sf(i){return i.split(",").map(function(e){return parseFloat(e)})}function A1(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=i.byteLength),new TextDecoder().decode(new Uint8Array(i,e,t))}function E1(i,e){if(e===0)return i;if(e===2||e===1){let t=i.getIndex();if(t===null){const n=[],o=i.getAttribute("position");if(o===void 0)return i;for(let l=0;l<o.count;l++)n.push(l);i.setIndex(n),t=i.getIndex()}const r=t.count-2,s=[];if(e===2)for(let n=1;n<=r;n++)s.push(t.getX(0)),s.push(t.getX(n)),s.push(t.getX(n+1));else for(let n=0;n<r;n++)n%2==0?(s.push(t.getX(n)),s.push(t.getX(n+1)),s.push(t.getX(n+2))):(s.push(t.getX(n+2)),s.push(t.getX(n+1)),s.push(t.getX(n)));s.length;const a=i.clone();return a.setIndex(s),a.clearGroups(),a}return i}class bR extends Ht{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new AR(t)}),this.register(function(t){return new ER(t)}),this.register(function(t){return new UR(t)}),this.register(function(t){return new kR(t)}),this.register(function(t){return new FR(t)}),this.register(function(t){return new RR(t)}),this.register(function(t){return new PR(t)}),this.register(function(t){return new IR(t)}),this.register(function(t){return new LR(t)}),this.register(function(t){return new TR(t)}),this.register(function(t){return new NR(t)}),this.register(function(t){return new CR(t)}),this.register(function(t){return new OR(t)}),this.register(function(t){return new DR(t)}),this.register(function(t){return new wR(t)}),this.register(function(t){return new BR(t)}),this.register(function(t){return new zR(t)})}load(e,t,r,s){const a=this;let n;if(this.resourcePath!=="")n=this.resourcePath;else if(this.path!==""){const c=gs.extractUrlBase(e);n=gs.resolveURL(c,this.path)}else n=gs.extractUrlBase(e);this.manager.itemStart(e);const o=function(c){s&&s(c),a.manager.itemError(e),a.manager.itemEnd(e)},l=new Ti(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{a.parse(c,n,function(h){t(h),a.manager.itemEnd(e)},o)}catch(h){o(h)}},r,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,s){let a;const n={},o={},l=new TextDecoder;if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===gw){try{n[rt.KHR_BINARY_GLTF]=new GR(e)}catch(h){return void(s&&s(h))}a=JSON.parse(n[rt.KHR_BINARY_GLTF].content)}else a=JSON.parse(l.decode(e));else a=e;if(a.asset===void 0||a.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new iP(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name,o[u.name]=u,n[u.name]=!0}if(a.extensionsUsed)for(let h=0;h<a.extensionsUsed.length;++h){const u=a.extensionsUsed[h],d=a.extensionsRequired||[];switch(u){case rt.KHR_MATERIALS_UNLIT:n[u]=new SR;break;case rt.KHR_DRACO_MESH_COMPRESSION:n[u]=new jR(a,this.dracoLoader);break;case rt.KHR_TEXTURE_TRANSFORM:n[u]=new WR;break;case rt.KHR_MESH_QUANTIZATION:n[u]=new XR;break;default:d.indexOf(u)>=0&&o[u]}}c.setExtensions(n),c.setPlugins(o),c.parse(r,s)}parseAsync(e,t){const r=this;return new Promise(function(s,a){r.parse(e,t,s,a)})}}function MR(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const rt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class wR{constructor(e){this.parser=e,this.name=rt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,s=t.length;r<s;r++){const a=t[r];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let s=t.cache.get(r);if(s)return s;const a=t.json,n=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let o;const l=new fe(16777215);n.color!==void 0&&l.setRGB(n.color[0],n.color[1],n.color[2],oi);const c=n.range!==void 0?n.range:0;switch(n.type){case"directional":o=new Bc(l),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new ul(l),o.distance=c;break;case"spot":o=new Fc(l),o.distance=c,n.spot=n.spot||{},n.spot.innerConeAngle=n.spot.innerConeAngle!==void 0?n.spot.innerConeAngle:0,n.spot.outerConeAngle=n.spot.outerConeAngle!==void 0?n.spot.outerConeAngle:Math.PI/4,o.angle=n.spot.outerConeAngle,o.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+n.type)}return o.position.set(0,0,0),o.decay=2,Ns(o,n),n.intensity!==void 0&&(o.intensity=n.intensity),o.name=t.createUniqueName(n.name||"light_"+e),s=Promise.resolve(o),t.cache.add(r,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser,s=r.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(n){return r._getNodeRef(t.cache,a,n)})}}class SR{constructor(){this.name=rt.KHR_MATERIALS_UNLIT}getMaterialType(){return ei}extendParams(e,t,r){const s=[];e.color=new fe(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const n=a.baseColorFactor;e.color.setRGB(n[0],n[1],n[2],oi),e.opacity=n[3]}a.baseColorTexture!==void 0&&s.push(r.assignTexture(e,"map",a.baseColorTexture,Tt))}return Promise.all(s)}}class TR{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class AR{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];if(n.clearcoatFactor!==void 0&&(t.clearcoat=n.clearcoatFactor),n.clearcoatTexture!==void 0&&a.push(r.assignTexture(t,"clearcoatMap",n.clearcoatTexture)),n.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=n.clearcoatRoughnessFactor),n.clearcoatRoughnessTexture!==void 0&&a.push(r.assignTexture(t,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),n.clearcoatNormalTexture!==void 0&&(a.push(r.assignTexture(t,"clearcoatNormalMap",n.clearcoatNormalTexture)),n.clearcoatNormalTexture.scale!==void 0)){const o=n.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ne(o,o)}return Promise.all(a)}}class ER{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class CR{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return n.iridescenceFactor!==void 0&&(t.iridescence=n.iridescenceFactor),n.iridescenceTexture!==void 0&&a.push(r.assignTexture(t,"iridescenceMap",n.iridescenceTexture)),n.iridescenceIor!==void 0&&(t.iridescenceIOR=n.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),n.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=n.iridescenceThicknessMinimum),n.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=n.iridescenceThicknessMaximum),n.iridescenceThicknessTexture!==void 0&&a.push(r.assignTexture(t,"iridescenceThicknessMap",n.iridescenceThicknessTexture)),Promise.all(a)}}class RR{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new fe(0,0,0),t.sheenRoughness=0,t.sheen=1;const n=s.extensions[this.name];if(n.sheenColorFactor!==void 0){const o=n.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],oi)}return n.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=n.sheenRoughnessFactor),n.sheenColorTexture!==void 0&&a.push(r.assignTexture(t,"sheenColorMap",n.sheenColorTexture,Tt)),n.sheenRoughnessTexture!==void 0&&a.push(r.assignTexture(t,"sheenRoughnessMap",n.sheenRoughnessTexture)),Promise.all(a)}}class PR{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return n.transmissionFactor!==void 0&&(t.transmission=n.transmissionFactor),n.transmissionTexture!==void 0&&a.push(r.assignTexture(t,"transmissionMap",n.transmissionTexture)),Promise.all(a)}}class IR{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];t.thickness=n.thicknessFactor!==void 0?n.thicknessFactor:0,n.thicknessTexture!==void 0&&a.push(r.assignTexture(t,"thicknessMap",n.thicknessTexture)),t.attenuationDistance=n.attenuationDistance||1/0;const o=n.attenuationColor||[1,1,1];return t.attenuationColor=new fe().setRGB(o[0],o[1],o[2],oi),Promise.all(a)}}class LR{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class NR{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];t.specularIntensity=n.specularFactor!==void 0?n.specularFactor:1,n.specularTexture!==void 0&&a.push(r.assignTexture(t,"specularIntensityMap",n.specularTexture));const o=n.specularColorFactor||[1,1,1];return t.specularColor=new fe().setRGB(o[0],o[1],o[2],oi),n.specularColorTexture!==void 0&&a.push(r.assignTexture(t,"specularColorMap",n.specularColorTexture,Tt)),Promise.all(a)}}class DR{constructor(e){this.parser=e,this.name=rt.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return t.bumpScale=n.bumpFactor!==void 0?n.bumpFactor:1,n.bumpTexture!==void 0&&a.push(r.assignTexture(t,"bumpMap",n.bumpTexture)),Promise.all(a)}}class OR{constructor(e){this.parser=e,this.name=rt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?yr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return n.anisotropyStrength!==void 0&&(t.anisotropy=n.anisotropyStrength),n.anisotropyRotation!==void 0&&(t.anisotropyRotation=n.anisotropyRotation),n.anisotropyTexture!==void 0&&a.push(r.assignTexture(t,"anisotropyMap",n.anisotropyTexture)),Promise.all(a)}}class UR{constructor(e){this.parser=e,this.name=rt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,s=r.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const a=s.extensions[this.name],n=t.options.ktx2Loader;if(!n){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,n)}}class kR{constructor(e){this.parser=e,this.name=rt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[t])return null;const n=a.extensions[t],o=s.images[n.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,n.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class FR{constructor(e){this.parser=e,this.name=rt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[t])return null;const n=a.extensions[t],o=s.images[n.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,n.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class BR{constructor(e){this.name=rt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const s=r.extensions[this.name],a=this.parser.getDependency("buffer",s.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(o){const l=s.byteOffset||0,c=s.byteLength||0,h=s.count,u=s.byteStride,d=new Uint8Array(o,l,c);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(h,u,d,s.mode,s.filter).then(function(p){return p.buffer}):n.ready.then(function(){const p=new ArrayBuffer(h*u);return n.decodeGltfBuffer(new Uint8Array(p),h,u,d,s.mode,s.filter),p})})}return null}}class zR{constructor(e){this.name=rt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const s=t.meshes[r.mesh];for(const l of s.primitives)if(l.mode!==Tr.TRIANGLES&&l.mode!==Tr.TRIANGLE_STRIP&&l.mode!==Tr.TRIANGLE_FAN&&l.mode!==void 0)return null;const a=r.extensions[this.name].attributes,n=[],o={};for(const l in a)n.push(this.parser.getDependency("accessor",a[l]).then(c=>(o[l]=c,o[l])));return n.length<1?null:(n.push(this.parser.createNodeMesh(e)),Promise.all(n).then(l=>{const c=l.pop(),h=c.isGroup?c.children:[c],u=l[0].count,d=[];for(const p of h){const f=new Me,g=new R,m=new it,v=new R(1,1,1),_=new eg(p.geometry,p.material,u);for(let y=0;y<u;y++)o.TRANSLATION&&g.fromBufferAttribute(o.TRANSLATION,y),o.ROTATION&&m.fromBufferAttribute(o.ROTATION,y),o.SCALE&&v.fromBufferAttribute(o.SCALE,y),_.setMatrixAt(y,f.compose(g,m,v));for(const y in o)if(y==="_COLOR_0"){const x=o[y];_.instanceColor=new In(x.array,x.itemSize,x.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&p.geometry.setAttribute(y,o[y]);je.prototype.copy.call(_,p),this.parser.assignFinalMaterial(_),d.push(_)}return c.isGroup?(c.clear(),c.add(...d),c):d[0]}))}}const gw="glTF",VR=1313821514,HR=5130562;class GR{constructor(e){this.name=rt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==gw)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,a=new DataView(e,12);let n=0;for(;n<s;){const o=a.getUint32(n,!0);n+=4;const l=a.getUint32(n,!0);if(n+=4,l===VR){const c=new Uint8Array(e,12+n,o);this.content=r.decode(c)}else if(l===HR){const c=12+n;this.body=e.slice(c,c+o)}n+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class jR{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=rt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,s=this.dracoLoader,a=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,o={},l={},c={};for(const h in n){const u=Ug[h]||h.toLowerCase();o[u]=n[h]}for(const h in e.attributes){const u=Ug[h]||h.toLowerCase();if(n[h]!==void 0){const d=r.accessors[e.attributes[h]],p=Zo[d.componentType];c[u]=p.name,l[u]=d.normalized===!0}}return t.getDependency("bufferView",a).then(function(h){return new Promise(function(u,d){s.decodeDracoFile(h,function(p){for(const f in p.attributes){const g=p.attributes[f],m=l[f];m!==void 0&&(g.normalized=m)}u(p)},o,c,oi,d)})})}}class WR{constructor(){this.name=rt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord!==void 0&&t.texCoord!==e.channel||t.offset!==void 0||t.rotation!==void 0||t.scale!==void 0)&&(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class XR{constructor(){this.name=rt.KHR_MESH_QUANTIZATION}}class vw extends Ml{constructor(e,t,r,s){super(e,t,r,s)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s*3+s;for(let n=0;n!==s;n++)t[n]=r[a+n];return t}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=2*o,c=3*o,h=s-t,u=(r-t)/h,d=u*u,p=d*u,f=e*c,g=f-c,m=-2*p+3*d,v=p-d,_=1-m,y=v-d+u;for(let x=0;x!==o;x++){const b=n[g+x+o],M=n[g+x+l]*h,T=n[f+x+o],E=n[f+x]*h;a[x]=_*b+y*M+m*T+v*E}return a}}const qR=new it;class YR extends vw{interpolate_(e,t,r,s){const a=super.interpolate_(e,t,r,s);return qR.fromArray(a).normalize().toArray(a),a}}const Tr={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Zo={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},C1={9728:dt,9729:Kt,9984:ap,9985:Bo,9986:Tn,9987:fs},R1={33071:Ai,33648:Na,10497:$t},af={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ug={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ha={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ZR={CUBICSPLINE:void 0,LINEAR:il,STEP:tl},KR="OPAQUE",QR="MASK",JR="BLEND";function dn(i,e,t){for(const r in t.extensions)i[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=t.extensions[r])}function Ns(i,e){e.extras!==void 0&&typeof e.extras=="object"&&Object.assign(i.userData,e.extras)}function $R(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,r=e.weights.length;t<r;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let r=0,s=t.length;r<s;r++)i.morphTargetDictionary[t[r]]=r}}}function eP(i){let e;const t=i.extensions&&i.extensions[rt.KHR_DRACO_MESH_COMPRESSION];if(e=t?"draco:"+t.bufferView+":"+t.indices+":"+nf(t.attributes):i.indices+":"+nf(i.attributes)+":"+i.mode,i.targets!==void 0)for(let r=0,s=i.targets.length;r<s;r++)e+=":"+nf(i.targets[r]);return e}function nf(i){let e="";const t=Object.keys(i).sort();for(let r=0,s=t.length;r<s;r++)e+=t[r]+":"+i[t[r]]+";";return e}function kg(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const tP=new Me;class iP{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new MR,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,s=!1,a=-1;typeof navigator<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,a=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||s&&a<98?this.textureLoader=new xs(this.options.manager):this.textureLoader=new $x(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ti(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,s=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(n){return n._markDefs&&n._markDefs()}),Promise.all(this._invokeAll(function(n){return n.beforeRoot&&n.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(n){const o={scene:n[0][s.scene||0],scenes:n[0],animations:n[1],cameras:n[2],asset:s.asset,parser:r,userData:{}};return dn(a,o,s),Ns(o,s),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let s=0,a=t.length;s<a;s++){const n=t[s].joints;for(let o=0,l=n.length;o<l;o++)e[n[o]].isBone=!0}for(let s=0,a=e.length;s<a;s++){const n=e[s];n.mesh!==void 0&&(this._addNodeRef(this.meshCache,n.mesh),n.skin!==void 0&&(r[n.mesh].isSkinnedMesh=!0)),n.camera!==void 0&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const s=r.clone(),a=(n,o)=>{const l=this.associations.get(n);l!=null&&this.associations.set(o,l);for(const[c,h]of n.children.entries())a(h,o.children[c])};return a(r,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const s=e(t[r]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let s=0;s<t.length;s++){const a=e(t[s]);a&&r.push(a)}return r}getDependency(e,t){const r=e+":"+t;let s=this.cache.get(r);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(a){return a.loadNode&&a.loadNode(t)});break;case"mesh":s=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e)}this.cache.add(r,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(a,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[rt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(a,n){r.load(gs.resolveURL(t.uri,s.path),a,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(r){const s=t.byteLength||0,a=t.byteOffset||0;return r.slice(a,a+s)})}loadAccessor(e){const t=this,r=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const n=af[s.type],o=Zo[s.componentType],l=s.normalized===!0,c=new o(s.count*n);return Promise.resolve(new tt(c,n,l))}const a=[];return s.bufferView!==void 0?a.push(this.getDependency("bufferView",s.bufferView)):a.push(null),s.sparse!==void 0&&(a.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(a).then(function(n){const o=n[0],l=af[s.type],c=Zo[s.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=s.byteOffset||0,p=s.bufferView!==void 0?r.bufferViews[s.bufferView].byteStride:void 0,f=s.normalized===!0;let g,m;if(p&&p!==u){const v=Math.floor(d/p),_="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+v+":"+s.count;let y=t.cache.get(_);y||(g=new c(o,v*p,s.count*p/h),y=new ph(g,p/h),t.cache.add(_,y)),m=new Ji(y,l,d%p/h,f)}else g=o===null?new c(s.count*l):new c(o,d,s.count*l),m=new tt(g,l,f);if(s.sparse!==void 0){const v=af.SCALAR,_=Zo[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,b=new _(n[1],y,s.sparse.count*v),M=new c(n[2],x,s.sparse.count*l);o!==null&&(m=new tt(m.array.slice(),m.itemSize,m.normalized));for(let T=0,E=b.length;T<E;T++){const C=b[T];if(m.setX(C,M[T*l]),l>=2&&m.setY(C,M[T*l+1]),l>=3&&m.setZ(C,M[T*l+2]),l>=4&&m.setW(C,M[T*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,r=this.options,s=t.textures[e].source,a=t.images[s];let n=this.textureLoader;if(a.uri){const o=r.manager.getHandler(a.uri);o!==null&&(n=o)}return this.loadTextureImage(e,s,n)}loadTextureImage(e,t,r){const s=this,a=this.json,n=a.textures[e],o=a.images[t],l=(o.uri||o.bufferView)+":"+n.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,r).then(function(h){h.flipY=!1,h.name=n.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const u=(a.samplers||{})[n.sampler]||{};return h.magFilter=C1[u.magFilter]||Kt,h.minFilter=C1[u.minFilter]||fs,h.wrapS=R1[u.wrapS]||$t,h.wrapT=R1[u.wrapT]||$t,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const r=this,s=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const n=s.images[e],o=self.URL||self.webkitURL;let l=n.uri||"",c=!1;if(n.bufferView!==void 0)l=r.getDependency("bufferView",n.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:n.mimeType});return l=o.createObjectURL(d),l});else if(n.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(d,p){let f=d;t.isImageBitmapLoader===!0&&(f=function(g){const m=new wt(g);m.needsUpdate=!0,d(m)}),t.load(gs.resolveURL(u,a.path),f,void 0,p)})}).then(function(u){var d;return c===!0&&o.revokeObjectURL(l),Ns(u,n),u.userData.mimeType=n.mimeType||((d=n.uri).search(/\.jpe?g($|\?)/i)>0||d.search(/^data\:image\/jpeg/)===0?"image/jpeg":d.search(/\.webp($|\?)/i)>0||d.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),u}).catch(function(u){throw u});return this.sourceCache[e]=h,h}assignTexture(e,t,r,s){const a=this;return this.getDependency("texture",r.index).then(function(n){if(!n)return null;if(r.texCoord!==void 0&&r.texCoord>0&&((n=n.clone()).channel=r.texCoord),a.extensions[rt.KHR_TEXTURE_TRANSFORM]){const o=r.extensions!==void 0?r.extensions[rt.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=a.associations.get(n);n=a.extensions[rt.KHR_TEXTURE_TRANSFORM].extendTexture(n,o),a.associations.set(n,l)}}return s!==void 0&&(n.colorSpace=s),e[t]=n,n})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const s=t.attributes.tangent===void 0,a=t.attributes.color!==void 0,n=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new ga,ti.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(o,l)),r=l}else if(e.isLine){const o="LineBasicMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new Yt,ti.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(o,l)),r=l}if(s||a||n){let o="ClonedMaterial:"+r.uuid+":";s&&(o+="derivative-tangents:"),a&&(o+="vertex-colors:"),n&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=r.clone(),a&&(l.vertexColors=!0),n&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(r))),r=l}e.material=r}getMaterialType(){return hl}loadMaterial(e){const t=this,r=this.json,s=this.extensions,a=r.materials[e];let n;const o={},l=[];if((a.extensions||{})[rt.KHR_MATERIALS_UNLIT]){const h=s[rt.KHR_MATERIALS_UNLIT];n=h.getMaterialType(),l.push(h.extendParams(o,a,t))}else{const h=a.pbrMetallicRoughness||{};if(o.color=new fe(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){const u=h.baseColorFactor;o.color.setRGB(u[0],u[1],u[2],oi),o.opacity=u[3]}h.baseColorTexture!==void 0&&l.push(t.assignTexture(o,"map",h.baseColorTexture,Tt)),o.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,o.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(t.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture))),n=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,o)})))}a.doubleSided===!0&&(o.side=It);const c=a.alphaMode||KR;if(c===JR?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===QR&&(o.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&n!==ei&&(l.push(t.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new ne(1,1),a.normalTexture.scale!==void 0)){const h=a.normalTexture.scale;o.normalScale.set(h,h)}if(a.occlusionTexture!==void 0&&n!==ei&&(l.push(t.assignTexture(o,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&n!==ei){const h=a.emissiveFactor;o.emissive=new fe().setRGB(h[0],h[1],h[2],oi)}return a.emissiveTexture!==void 0&&n!==ei&&l.push(t.assignTexture(o,"emissiveMap",a.emissiveTexture,Tt)),Promise.all(l).then(function(){const h=new n(o);return a.name&&(h.name=a.name),Ns(h,a),t.associations.set(h,{materials:e}),a.extensions&&dn(s,h,a),h})}createUniqueName(e){const t=Je.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,r=this.extensions,s=this.primitiveCache;function a(o){return r[rt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return P1(l,o,t)})}const n=[];for(let o=0,l=e.length;o<l;o++){const c=e[o],h=eP(c),u=s[h];if(u)n.push(u.promise);else{let d;d=c.extensions&&c.extensions[rt.KHR_DRACO_MESH_COMPRESSION]?a(c):P1(new Oe,c,t),s[h]={primitive:c,promise:d},n.push(d)}}return Promise.all(n)}loadMesh(e){const t=this,r=this.json,s=this.extensions,a=r.meshes[e],n=a.primitives,o=[];for(let c=0,h=n.length;c<h;c++){const u=n[c].material===void 0?((l=this.cache).DefaultMaterial===void 0&&(l.DefaultMaterial=new hl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ir})),l.DefaultMaterial):this.getDependency("material",n[c].material);o.push(u)}var l;return o.push(t.loadGeometries(n)),Promise.all(o).then(function(c){const h=c.slice(0,c.length-1),u=c[c.length-1],d=[];for(let f=0,g=u.length;f<g;f++){const m=u[f],v=n[f];let _;const y=h[f];if(v.mode===Tr.TRIANGLES||v.mode===Tr.TRIANGLE_STRIP||v.mode===Tr.TRIANGLE_FAN||v.mode===void 0)_=a.isSkinnedMesh===!0?new fd(m,y):new ye(m,y),_.isSkinnedMesh===!0&&_.normalizeSkinWeights(),v.mode===Tr.TRIANGLE_STRIP?_.geometry=E1(_.geometry,1):v.mode===Tr.TRIANGLE_FAN&&(_.geometry=E1(_.geometry,2));else if(v.mode===Tr.LINES)_=new or(m,y);else if(v.mode===Tr.LINE_STRIP)_=new vi(m,y);else if(v.mode===Tr.LINE_LOOP)_=new tg(m,y);else{if(v.mode!==Tr.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);_=new Aa(m,y)}Object.keys(_.geometry.morphAttributes).length>0&&$R(_,a),_.name=t.createUniqueName(a.name||"mesh_"+e),Ns(_,a),v.extensions&&dn(s,_,v),t.assignFinalMaterial(_),d.push(_)}for(let f=0,g=d.length;f<g;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return a.extensions&&dn(s,d[0],a),d[0];const p=new Ei;a.extensions&&dn(s,p,a),t.associations.set(p,{meshes:e});for(let f=0,g=d.length;f<g;f++)p.add(d[f]);return p})}loadCamera(e){let t;const r=this.json.cameras[e],s=r[r.type];if(s)return r.type==="perspective"?t=new Jt(ui.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):r.type==="orthographic"&&(t=new Gn(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),Ns(t,r),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],r=[];for(let s=0,a=t.joints.length;s<a;s++)r.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(s){const a=s.pop(),n=s,o=[],l=[];for(let c=0,h=n.length;c<h;c++){const u=n[c];if(u){o.push(u);const d=new Me;a!==null&&d.fromArray(a.array,16*c),l.push(d)}}return new ll(o,l)})}loadAnimation(e){const t=this.json,r=this,s=t.animations[e],a=s.name?s.name:"animation_"+e,n=[],o=[],l=[],c=[],h=[];for(let u=0,d=s.channels.length;u<d;u++){const p=s.channels[u],f=s.samplers[p.sampler],g=p.target,m=g.node,v=s.parameters!==void 0?s.parameters[f.input]:f.input,_=s.parameters!==void 0?s.parameters[f.output]:f.output;g.node!==void 0&&(n.push(this.getDependency("node",m)),o.push(this.getDependency("accessor",v)),l.push(this.getDependency("accessor",_)),c.push(f),h.push(g))}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const d=u[0],p=u[1],f=u[2],g=u[3],m=u[4],v=[];for(let _=0,y=d.length;_<y;_++){const x=d[_],b=p[_],M=f[_],T=g[_],E=m[_];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const C=r._createAnimationTracks(x,b,M,T,E);if(C)for(let N=0;N<C.length;N++)v.push(C[N])}return new Ln(a,void 0,v)})}createNodeMesh(e){const t=this.json,r=this,s=t.nodes[e];return s.mesh===void 0?null:r.getDependency("mesh",s.mesh).then(function(a){const n=r._getNodeRef(r.meshCache,s.mesh,a);return s.weights!==void 0&&n.traverse(function(o){if(o.isMesh)for(let l=0,c=s.weights.length;l<c;l++)o.morphTargetInfluences[l]=s.weights[l]}),n})}loadNode(e){const t=this,r=this.json.nodes[e],s=t._loadNodeShallow(e),a=[],n=r.children||[];for(let l=0,c=n.length;l<c;l++)a.push(t.getDependency("node",n[l]));const o=r.skin===void 0?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([s,Promise.all(a),o]).then(function(l){const c=l[0],h=l[1],u=l[2];u!==null&&c.traverse(function(d){d.isSkinnedMesh&&d.bind(u,tP)});for(let d=0,p=h.length;d<p;d++)c.add(h[d]);return c})}_loadNodeShallow(e){const t=this.json,r=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const a=t.nodes[e],n=a.name?s.createUniqueName(a.name):"",o=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&o.push(l),a.camera!==void 0&&o.push(s.getDependency("camera",a.camera).then(function(c){return s._getNodeRef(s.cameraCache,a.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let h;if(h=a.isBone===!0?new ol:c.length>1?new Ei:c.length===1?c[0]:new je,h!==c[0])for(let u=0,d=c.length;u<d;u++)h.add(c[u]);if(a.name&&(h.userData.name=a.name,h.name=n),Ns(h,a),a.extensions&&dn(r,h,a),a.matrix!==void 0){const u=new Me;u.fromArray(a.matrix),h.applyMatrix4(u)}else a.translation!==void 0&&h.position.fromArray(a.translation),a.rotation!==void 0&&h.quaternion.fromArray(a.rotation),a.scale!==void 0&&h.scale.fromArray(a.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],s=this,a=new Ei;r.name&&(a.name=s.createUniqueName(r.name)),Ns(a,r),r.extensions&&dn(t,a,r);const n=r.nodes||[],o=[];for(let l=0,c=n.length;l<c;l++)o.push(s.getDependency("node",n[l]));return Promise.all(o).then(function(l){for(let c=0,h=l.length;c<h;c++)a.add(l[c]);return s.associations=(c=>{const h=new Map;for(const[u,d]of s.associations)(u instanceof ti||u instanceof wt)&&h.set(u,d);return c.traverse(u=>{const d=s.associations.get(u);d!=null&&h.set(u,d)}),h})(a),a})}_createAnimationTracks(e,t,r,s,a){const n=[],o=e.name?e.name:e.uuid,l=[];let c;switch(ha[a.path]===ha.weights?e.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(o),ha[a.path]){case ha.weights:c=Ua;break;case ha.rotation:c=qs;break;case ha.position:case ha.scale:c=ka;break;default:r.itemSize===1?c=Ua:c=ka}const h=s.interpolation!==void 0?ZR[s.interpolation]:il,u=this._getArrayFromAccessor(r);for(let d=0,p=l.length;d<p;d++){const f=new c(l[d]+"."+ha[a.path],t.array,u,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),n.push(f)}return n}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const r=kg(t.constructor),s=new Float32Array(t.length);for(let a=0,n=t.length;a<n;a++)s[a]=t[a]*r;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){return new(this instanceof qs?YR:vw)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function P1(i,e,t){const r=e.attributes,s=[];function a(n,o){return t.getDependency("accessor",n).then(function(l){i.setAttribute(o,l)})}for(const n in r){const o=Ug[n]||n.toLowerCase();o in i.attributes||s.push(a(r[n],o))}if(e.indices!==void 0&&!i.index){const n=t.getDependency("accessor",e.indices).then(function(o){i.setIndex(o)});s.push(n)}return ht.workingColorSpace,Ns(i,e),function(n,o,l){const c=o.attributes,h=new Et;if(c.POSITION===void 0)return;{const p=l.json.accessors[c.POSITION],f=p.min,g=p.max;if(f===void 0||g===void 0)return;if(h.set(new R(f[0],f[1],f[2]),new R(g[0],g[1],g[2])),p.normalized){const m=kg(Zo[p.componentType]);h.min.multiplyScalar(m),h.max.multiplyScalar(m)}}const u=o.targets;if(u!==void 0){const p=new R,f=new R;for(let g=0,m=u.length;g<m;g++){const v=u[g];if(v.POSITION!==void 0){const _=l.json.accessors[v.POSITION],y=_.min,x=_.max;if(y!==void 0&&x!==void 0){if(f.setX(Math.max(Math.abs(y[0]),Math.abs(x[0]))),f.setY(Math.max(Math.abs(y[1]),Math.abs(x[1]))),f.setZ(Math.max(Math.abs(y[2]),Math.abs(x[2]))),_.normalized){const b=kg(Zo[_.componentType]);f.multiplyScalar(b)}p.max(f)}}}h.expandByVector(p)}n.boundingBox=h;const d=new di;h.getCenter(d.center),d.radius=h.min.distanceTo(h.max)/2,n.boundingSphere=d}(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?function(n,o,l){let c=!1,h=!1,u=!1;for(let g=0,m=o.length;g<m;g++){const v=o[g];if(v.POSITION!==void 0&&(c=!0),v.NORMAL!==void 0&&(h=!0),v.COLOR_0!==void 0&&(u=!0),c&&h&&u)break}if(!c&&!h&&!u)return Promise.resolve(n);const d=[],p=[],f=[];for(let g=0,m=o.length;g<m;g++){const v=o[g];if(c){const _=v.POSITION!==void 0?l.getDependency("accessor",v.POSITION):n.attributes.position;d.push(_)}if(h){const _=v.NORMAL!==void 0?l.getDependency("accessor",v.NORMAL):n.attributes.normal;p.push(_)}if(u){const _=v.COLOR_0!==void 0?l.getDependency("accessor",v.COLOR_0):n.attributes.color;f.push(_)}}return Promise.all([Promise.all(d),Promise.all(p),Promise.all(f)]).then(function(g){const m=g[0],v=g[1],_=g[2];return c&&(n.morphAttributes.position=m),h&&(n.morphAttributes.normal=v),u&&(n.morphAttributes.color=_),n.morphTargetsRelative=!0,n})}(i,e.targets,t):i})}const of=new WeakMap;class rP extends Ht{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,s){const a=new Ti(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,n=>{this.parse(n,t,s)},r,s)}parse(e,t,r=()=>{}){this.decodeDracoFile(e,t,null,null,Tt,r).catch(r)}decodeDracoFile(e,t,r,s,a=oi,n=()=>{}){const o={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:a};return this.decodeGeometry(e,o).then(t).catch(n)}decodeGeometry(e,t){const r=JSON.stringify(t);if(of.has(e)){const l=of.get(e);if(l.key===r)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const a=this.workerNextTaskID++,n=e.byteLength,o=this._getWorker(a,n).then(l=>(s=l,new Promise((c,h)=>{s._callbacks[a]={resolve:c,reject:h},s.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),of.set(e,{key:r,promise:o}),o}_createGeometry(e){const t=new Oe;e.index&&t.setIndex(new tt(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const s=e.attributes[r],a=s.name,n=s.array,o=s.itemSize,l=new tt(n,o);a==="color"&&(this._assignVertexColorSpace(l,s.vertexColorSpace),l.normalized=!(n instanceof Float32Array)),t.setAttribute(a,l)}return t}_assignVertexColorSpace(e,t){if(t!==Tt)return;const r=new fe;for(let s=0,a=e.count;s<a;s++)r.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,r.r,r.g,r.b)}_loadLibrary(e,t){const r=new Ti(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((s,a)=>{r.load(e,s,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(r=>{const s=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const a=sP.toString(),n=["/* draco decoder */",s,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(a){const n=a.data;switch(n.type){case"decode":s._callbacks[n.id].resolve(n);break;case"error":s._callbacks[n.id].reject(n)}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function sP(){let i,e;function t(r,s,a,n,o,l){const c=l.num_components(),h=a.num_points()*c,u=h*o.BYTES_PER_ELEMENT,d=function(g,m){switch(m){case Float32Array:return g.DT_FLOAT32;case Int8Array:return g.DT_INT8;case Int16Array:return g.DT_INT16;case Int32Array:return g.DT_INT32;case Uint8Array:return g.DT_UINT8;case Uint16Array:return g.DT_UINT16;case Uint32Array:return g.DT_UINT32}}(r,o),p=r._malloc(u);s.GetAttributeDataArrayForAllPoints(a,l,d,u,p);const f=new o(r.HEAPF32.buffer,p,h).slice();return r._free(p),{name:n,array:f,itemSize:c}}onmessage=function(r){const s=r.data;switch(s.type){case"init":i=s.decoderConfig,e=new Promise(function(o){i.onModuleLoaded=function(l){o({draco:l})},DracoDecoderModule(i)});break;case"decode":const a=s.buffer,n=s.taskConfig;e.then(o=>{const l=o.draco,c=new l.Decoder;try{const h=function(d,p,f,g){const m=g.attributeIDs,v=g.attributeTypes;let _,y;const x=p.GetEncodedGeometryType(f);if(x===d.TRIANGULAR_MESH)_=new d.Mesh,y=p.DecodeArrayToMesh(f,f.byteLength,_);else{if(x!==d.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");_=new d.PointCloud,y=p.DecodeArrayToPointCloud(f,f.byteLength,_)}if(!y.ok()||_.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const b={index:null,attributes:[]};for(const M in m){const T=self[v[M]];let E,C;if(g.useUniqueIDs)C=m[M],E=p.GetAttributeByUniqueId(_,C);else{if(C=p.GetAttributeId(_,d[m[M]]),C===-1)continue;E=p.GetAttribute(_,C)}const N=t(d,p,_,M,T,E);M==="color"&&(N.vertexColorSpace=g.vertexColorSpace),b.attributes.push(N)}return x===d.TRIANGULAR_MESH&&(b.index=function(M,T,E){const C=E.num_faces(),N=3*C,D=4*N,A=M._malloc(D);T.GetTrianglesUInt32Array(E,D,A);const L=new Uint32Array(M.HEAPF32.buffer,A,N).slice();return M._free(A),{array:L,itemSize:1}}(d,p,_)),d.destroy(_),b}(l,c,new Int8Array(a),n),u=h.attributes.map(d=>d.array.buffer);h.index&&u.push(h.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:h},u)}catch(h){self.postMessage({type:"error",id:s.id,error:h.message})}finally{l.destroy(c)}})}}}const aP=/^[og]\s*(.+)?/,nP=/^mtllib /,oP=/^usemtl /,lP=/^usemap /,I1=/\s+/,L1=new R,lf=new R,N1=new R,D1=new R,Mr=new R,Bu=new fe;function cP(){const i={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const r=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,a){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const o={index:this.materials.length,name:s||"",mtllib:Array.isArray(a)&&a.length>0?a[a.length-1]:"",smooth:n!==void 0?n.smooth:this.smooth,groupStart:n!==void 0?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(o),o},currentMaterial:function(){return this.materials.length>0?this.materials[this.materials.length-1]:void 0},_finalize:function(s){const a=this.currentMaterial();if(a&&a.groupEnd===-1&&(a.groupEnd=this.geometry.vertices.length/3,a.groupCount=a.groupEnd-a.groupStart,a.inherited=!1),s&&this.materials.length>1)for(let n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),a}},r&&r.name&&typeof r.clone=="function"){const s=r.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){const r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){const s=this.vertices,a=this.object.geometry.vertices;a.push(s[e+0],s[e+1],s[e+2]),a.push(s[t+0],s[t+1],s[t+2]),a.push(s[r+0],s[r+1],s[r+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){const s=this.normals,a=this.object.geometry.normals;a.push(s[e+0],s[e+1],s[e+2]),a.push(s[t+0],s[t+1],s[t+2]),a.push(s[r+0],s[r+1],s[r+2])},addFaceNormal:function(e,t,r){const s=this.vertices,a=this.object.geometry.normals;L1.fromArray(s,e),lf.fromArray(s,t),N1.fromArray(s,r),Mr.subVectors(N1,lf),D1.subVectors(L1,lf),Mr.cross(D1),Mr.normalize(),a.push(Mr.x,Mr.y,Mr.z),a.push(Mr.x,Mr.y,Mr.z),a.push(Mr.x,Mr.y,Mr.z)},addColor:function(e,t,r){const s=this.colors,a=this.object.geometry.colors;s[e]!==void 0&&a.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&a.push(s[t+0],s[t+1],s[t+2]),s[r]!==void 0&&a.push(s[r+0],s[r+1],s[r+2])},addUV:function(e,t,r){const s=this.uvs,a=this.object.geometry.uvs;a.push(s[e+0],s[e+1]),a.push(s[t+0],s[t+1]),a.push(s[r+0],s[r+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,s,a,n,o,l,c){const h=this.vertices.length;let u=this.parseVertexIndex(e,h),d=this.parseVertexIndex(t,h),p=this.parseVertexIndex(r,h);if(this.addVertex(u,d,p),this.addColor(u,d,p),o!==void 0&&o!==""){const f=this.normals.length;u=this.parseNormalIndex(o,f),d=this.parseNormalIndex(l,f),p=this.parseNormalIndex(c,f),this.addNormal(u,d,p)}else this.addFaceNormal(u,d,p);if(s!==void 0&&s!==""){const f=this.uvs.length;u=this.parseUVIndex(s,f),d=this.parseUVIndex(a,f),p=this.parseUVIndex(n,f),this.addUV(u,d,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let r=0,s=e.length;r<s;r++){const a=this.parseVertexIndex(e[r],t);this.addVertexPoint(a),this.addColor(a)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const r=this.vertices.length,s=this.uvs.length;for(let a=0,n=e.length;a<n;a++)this.addVertexLine(this.parseVertexIndex(e[a],r));for(let a=0,n=t.length;a<n;a++)this.addUVLine(this.parseUVIndex(t[a],s))}};return i.startObject("",!1),i}class hP extends Ht{constructor(e){super(e),this.materials=null}load(e,t,r,s){const a=this,n=new Ti(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(o){try{t(a.parse(o))}catch(l){s&&s(l),a.manager.itemError(e)}},r,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new cP;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const r=e.split(`
`);let s=[];for(let n=0,o=r.length;n<o;n++){const l=r[n].trimStart();if(l.length===0)continue;const c=l.charAt(0);if(c!=="#"){if(c==="v"){const h=l.split(I1);switch(h[0]){case"v":t.vertices.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])),h.length>=7?(Bu.setRGB(parseFloat(h[4]),parseFloat(h[5]),parseFloat(h[6])).convertSRGBToLinear(),t.colors.push(Bu.r,Bu.g,Bu.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]));break;case"vt":t.uvs.push(parseFloat(h[1]),parseFloat(h[2]))}}else if(c==="f"){const h=l.slice(1).trim().split(I1),u=[];for(let p=0,f=h.length;p<f;p++){const g=h[p];if(g.length>0){const m=g.split("/");u.push(m)}}const d=u[0];for(let p=1,f=u.length-1;p<f;p++){const g=u[p],m=u[p+1];t.addFace(d[0],g[0],m[0],d[1],g[1],m[1],d[2],g[2],m[2])}}else if(c==="l"){const h=l.substring(1).trim().split(" ");let u=[];const d=[];if(l.indexOf("/")===-1)u=h;else for(let p=0,f=h.length;p<f;p++){const g=h[p].split("/");g[0]!==""&&u.push(g[0]),g[1]!==""&&d.push(g[1])}t.addLineGeometry(u,d)}else if(c==="p"){const h=l.slice(1).trim().split(" ");t.addPointGeometry(h)}else if((s=aP.exec(l))!==null){const h=(" "+s[0].slice(1).trim()).slice(1);t.startObject(h)}else if(oP.test(l))t.object.startMaterial(l.substring(7).trim(),t.materialLibraries);else if(nP.test(l))t.materialLibraries.push(l.substring(7).trim());else if(!lP.test(l)){if(c==="s"){if(s=l.split(" "),s.length>1){const u=s[1].trim().toLowerCase();t.object.smooth=u!=="0"&&u!=="off"}else t.object.smooth=!0;const h=t.object.currentMaterial();h&&(h.smooth=t.object.smooth)}else if(l==="\0")continue}}}t.finalize();const a=new Ei;if(a.materialLibraries=[].concat(t.materialLibraries),t.objects.length===1&&t.objects[0].geometry.vertices.length===0){if(t.vertices.length>0){const n=new ga({size:1,sizeAttenuation:!1}),o=new Oe;o.setAttribute("position",new Se(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(o.setAttribute("color",new Se(t.colors,3)),n.vertexColors=!0);const l=new Aa(o,n);a.add(l)}}else for(let n=0,o=t.objects.length;n<o;n++){const l=t.objects[n],c=l.geometry,h=l.materials,u=c.type==="Line",d=c.type==="Points";let p=!1;if(c.vertices.length===0)continue;const f=new Oe;f.setAttribute("position",new Se(c.vertices,3)),c.normals.length>0&&f.setAttribute("normal",new Se(c.normals,3)),c.colors.length>0&&(p=!0,f.setAttribute("color",new Se(c.colors,3))),c.hasUVIndices===!0&&f.setAttribute("uv",new Se(c.uvs,2));const g=[];for(let v=0,_=h.length;v<_;v++){const y=h[v],x=y.name+"_"+y.smooth+"_"+p;let b=t.materials[x];if(this.materials!==null)if(b=this.materials.create(y.name),!u||!b||b instanceof Yt){if(d&&b&&!(b instanceof ga)){const M=new ga({size:10,sizeAttenuation:!1});ti.prototype.copy.call(M,b),M.color.copy(b.color),M.map=b.map,b=M}}else{const M=new Yt;ti.prototype.copy.call(M,b),M.color.copy(b.color),b=M}b===void 0&&(b=u?new Yt:d?new ga({size:1,sizeAttenuation:!1}):new Xn,b.name=y.name,b.flatShading=!y.smooth,b.vertexColors=p,t.materials[x]=b),g.push(b)}let m;if(g.length>1){for(let v=0,_=h.length;v<_;v++){const y=h[v];f.addGroup(y.groupStart,y.groupCount,v)}m=u?new or(f,g):d?new Aa(f,g):new ye(f,g)}else m=u?new or(f,g[0]):d?new Aa(f,g[0]):new ye(f,g[0]);m.name=l.name,a.add(m)}return a}}class uP extends Ht{constructor(e){super(e)}load(e,t,r,s){const a=this,n=this.path===""?gs.extractUrlBase(e):this.path,o=new Ti(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(a.parse(l,n))}catch(c){s&&s(c),a.manager.itemError(e)}},r,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const r=e.split(`
`);let s={};const a=/\s+/,n={};for(let l=0;l<r.length;l++){let c=r[l];if(c=c.trim(),c.length===0||c.charAt(0)==="#")continue;const h=c.indexOf(" ");let u=h>=0?c.substring(0,h):c;u=u.toLowerCase();let d=h>=0?c.substring(h+1):"";if(d=d.trim(),u==="newmtl")s={name:d},n[d]=s;else if(u==="ka"||u==="kd"||u==="ks"||u==="ke"){const p=d.split(a,3);s[u]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else s[u]=d}const o=new dP(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(n),o}}class dP{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:Ir,this.wrap=this.options.wrap!==void 0?this.options.wrap:$t}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const r in e){const s=e[r],a={};t[r]=a;for(const n in s){let o=!0,l=s[n];const c=n.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(l=[l[0]/255,l[1]/255,l[2]/255]),this.options&&this.options.ignoreZeroRGBs&&l[0]===0&&l[1]===0&&l[2]===0&&(o=!1)}o&&(a[c]=l)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,r=this.materialsInfo[e],s={name:e,side:this.side};function a(n,o){if(s[n])return;const l=t.getTextureParams(o,s),c=t.loadTexture((h=t.baseUrl,typeof(u=l.url)!="string"||u===""?"":/^https?:\/\//i.test(u)?u:h+u));var h,u;c.repeat.copy(l.scale),c.offset.copy(l.offset),c.wrapS=t.wrap,c.wrapT=t.wrap,n!=="map"&&n!=="emissiveMap"||(c.colorSpace=Tt),s[n]=c}for(const n in r){const o=r[n];let l;if(o!=="")switch(n.toLowerCase()){case"kd":s.color=new fe().fromArray(o).convertSRGBToLinear();break;case"ks":s.specular=new fe().fromArray(o).convertSRGBToLinear();break;case"ke":s.emissive=new fe().fromArray(o).convertSRGBToLinear();break;case"map_kd":a("map",o);break;case"map_ks":a("specularMap",o);break;case"map_ke":a("emissiveMap",o);break;case"norm":a("normalMap",o);break;case"map_bump":case"bump":a("bumpMap",o);break;case"map_d":a("alphaMap",o),s.transparent=!0;break;case"ns":s.shininess=parseFloat(o);break;case"d":l=parseFloat(o),l<1&&(s.opacity=l,s.transparent=!0);break;case"tr":l=parseFloat(o),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(s.opacity=1-l,s.transparent=!0)}}return this.materials[e]=new Xn(s),this.materials[e]}getTextureParams(e,t){const r={scale:new ne(1,1),offset:new ne(0,0)},s=e.split(/\s+/);let a;return a=s.indexOf("-bm"),a>=0&&(t.bumpScale=parseFloat(s[a+1]),s.splice(a,2)),a=s.indexOf("-s"),a>=0&&(r.scale.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),a=s.indexOf("-o"),a>=0&&(r.offset.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),r.url=s.join(" ").trim(),r}loadTexture(e,t,r,s,a){const n=this.manager!==void 0?this.manager:y0;let o=n.getHandler(e);o===null&&(o=new xs(n)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const l=o.load(e,r,s,a);return t!==void 0&&(l.mapping=t),l}}function pP(i,e,t=()=>{}){switch(e){case"GLTF":case"GLB":case"gltf":case"glb":return function(r="",s="/draco/",a=()=>{}){const n=new bR,o={progress:()=>{},complete:()=>{}};return n.setDRACOLoader(new rP().setDecoderPath(s)),n.load(r,l=>{o.complete(l.scene),l.scene.animations=l.animations,a(l.scene)},l=>o.progress(l.loaded/l.total,l),l=>{}),o}(i,Bg.dracoPath,r=>t(r));case"FBX":case"fbx":return function(r="",s){const a=new pR,n={progress:()=>{},complete:()=>{}};return a.load(r,o=>{n.complete(o),s(o)},o=>n.progress(o.loaded/o.total,o)),n}(i,r=>t(r));case"OBJ":case"obj":return function(r="",s=()=>{}){const a=new hP,n=new uP,o={progress:()=>{},complete:()=>{}};return n.load(r.replace(".obj",".mtl"),l=>{l.preload(),a.setMaterials(l),a.load(r,c=>{o.complete(c),s(c)},c=>o.progress(c.loaded/c.total,c),c=>{})}),o}(i,r=>t(r))}}const ev=Qn,tv=Jn,_w=Js;function Pp(i){return i.map(e=>yi(Ne({},ev(e)),{children:Pp(e.children)}))}function Ip(i,e){i.length===e.length&&i.forEach((t,r)=>{tv(t,e[r]),t.children&&Ip(t.children,e[r].children)})}function iv(i,e){const{mixerFrames:t}=vl(i),r=function(a,n=()=>{}){const o=new zc,l=new ib(a);return a.mixerAnimateRender=()=>{const c=o.getDelta();n(),l.update(c)},l}(i,()=>e.frameCallback),s=e.actionIndexs.map((a,n)=>a&&function(o,l,c=1,h=0,u=!0){const d=o.clipAction(l);return d.loop=u?$g:Jg,d.time=h,d.timeScale=c,d.clampWhenFinished=!0,d}(r,i.animations[n],e.speed,e.startTime,e.loop).play()).filter(a=>a);return!t.find(a=>a===i)&&t.push(i),{actions:s,mixer:r}}function mP(i,e){e&&(tv(i,e),function(t,r){t.globalConfig=r;const{mesh:s,material:a}=r;r.useGlobalShadow&&function(n,o){n.traverse(l=>{l.castShadow=o.castShadow,l.receiveShadow=o.receiveShadow})}(t,s),r.useGlobalMaterial&&function(n,o){n.RootMaterials.forEach(l=>{l.envMapIntensity=o.envMapIntensity,l.reflectivity=o.reflectivity,o.envMap&&(l.envMap=n.parent.envBackground),o.isGlobalMap===!1&&(l.recordMap=l.map,l.map=null),l.needsUpdate=!0}),o.envMap&&n.parent.envMapChangeUseList.push(()=>n.RootMaterials.forEach(l=>l.envMap=n.parent.envBackground))}(t,a)}(i,e.globalConfig),i.globalConfig.isSaveChildren&&Ip(i.children,e.children),i.globalConfig.isSaveMaterials&&i.RootMaterials.forEach((t,r)=>Q0(t,e.RootMaterials[r])),function(t,r){r&&(t.animationPlayParams=r,r.initPlay&&iv(t,r))}(i,e.animationPlayParams))}function yw(i,e,t,r,s){return _w(r,s.addFolder("物体控制")),function(a,n){n.add(a.globalConfig,"isSaveChildren").name("子物体更改存储"),n.add(a.globalConfig,"isSaveMaterials").name("单材质更改存储"),n.addFn(()=>a.traverse(o=>o.visible=!0)).name("显示全部子项"),function(o,l){l.add(o.globalConfig,"useGlobalShadow").name("存储全局配置"),l.add(o.globalConfig.mesh,"castShadow").name("产生阴影").onChange(c=>o.traverse(h=>h.castShadow=c)),l.add(o.globalConfig.mesh,"receiveShadow").name("接收阴影").onChange(c=>o.traverse(h=>h.receiveShadow=c))}(a,n.addFolder("(全局)阴影配置")),function(o,l){l.add(o.globalConfig,"useGlobalMaterial").name("存储全局配置"),l.add(o.globalConfig.material,"envMap").name("环境贴图").onChange(c=>o.RootMaterials.forEach(h=>h.envMap=c?o.parent.envBackground:null)),l.add(o.globalConfig.material,"envMapIntensity").name("环境贴图强度").onChange(c=>o.RootMaterials.forEach(h=>h.envMapIntensity=c)).onFinishChange(c=>o.RootMaterials.forEach(h=>h.needsUpdate=!0)),l.add(o.globalConfig.material,"reflectivity",0,1).name("反射强度").onChange(c=>o.RootMaterials.forEach(h=>h.reflectivity=c)).onFinishChange(c=>o.RootMaterials.forEach(h=>h.needsUpdate=!0)),l.add(o.globalConfig.material,"isGlobalMap").name("全局贴图").onChange(c=>{o.RootMaterials.forEach(h=>{c?(h.map=h.recordMap,h.needsUpdate=!0):(h.recordMap=h.map,h.map=null,h.needsUpdate=!0)})}).onFinishChange(c=>o.RootMaterials.forEach(h=>h.needsUpdate=!0))}(a,n.addFolder("(全局)材质配置"))}(r,s.addFolder("全局和子项控制")),function(a,n){if(!a.animationPlayParams)return;n.add(a.animationPlayParams,"initPlay").name("初始加载播放"),n.add(a.animationPlayParams,"speed").min(-10).max(10).name("播放速度"),n.add(a.animationPlayParams,"startTime").name("开始时间"),n.add(a.animationPlayParams,"loop").name("循环播放");const o=n.addFolder("播放列表");a.animations.map((l,c)=>o.add(a.animationPlayParams.actionIndexs,c).name(l.name+":"+l.duration.toFixed(2)+"s")),o.addFn(()=>iv(a,a.animationPlayParams)).name("播放选择动作")}(r,s.addFolder("动画配置")),s.addFn(()=>e.attach(r)).name("选中"),s.addFn(()=>{const{frontView:a,target:n}=W0(r,i.object.fov);Rr(i.object.position,a),Rr(i.target,n),t.effectPass.outlinePass.selectedObjects=[r]}).name("定位物体"),s.addFn(()=>{r.parent.remove(r),s.parent.removeFolder(s)}).name("删除"),s}function hr(i){let e="";return i.name||(e="-"),i.name.length>10?e+=i.name.slice(0,10)+"...":e+=i.name,e+=` ${i.id} `,e}function fP(i,e,t,r,s){Object.assign(i,{scene:e,controls:t,transformControls:r,effectComposer:s}),i.insertModel=function(a,n){const{url:o,type:l}=a;return{loaderService:pP(o,l,c=>{var h,u;if(e.add(((u=c).globalConfig={useGlobalShadow:!1,useGlobalMaterial:!1,isSaveChildren:!0,isSaveMaterials:!0,mesh:{castShadow:!1,receiveShadow:!1},material:{envMap:!1,envMapIntensity:1,reflectivity:.98,isGlobalMap:!0}},u.RootMaterials=Rp(u),((h=u.animations)==null?void 0:h.length)>0&&(u.animationPlayParams={initPlay:!1,speed:.5,actionIndexs:new Array(u.animations.length).fill(!1),startTime:0,loop:!1,frameCallback:()=>{}}),u)),c.rootInfo=a,mP(c,n),!i.rootFolder)return;const d=i.rootFolder.addFolder(hr(c));yw(t,r,s,c,d)}),rootInfo:a,params:n}}}function gP(i){return i.map(e=>function(t){const{animationPlayParams:r,children:s,RootMaterials:a,rootInfo:n}=t;return{group:yi(Ne({},ev(t)),{globalConfig:t.globalConfig,animationPlayParams:r,RootMaterials:t.globalConfig.isSaveMaterials?a.map(o=>K0(o)):void 0,children:t.globalConfig.isSaveChildren?Pp(s):void 0}),rootInfo:n}}(e))}function vP(i){return i.map(e=>function(t){const{material:r,geometry:s}=t,{geometryType:a,parameters:n}=s;return yi(Ne({},Qn(t)),{geometry:{geometryType:a,parameters:n},material:Ap(r)})}(e))}function _P(i,e){e==null||e.forEach(t=>function(r,s){if(!s)return;const{geometry:a,material:n}=s,{geometryType:o,parameters:l}=a,c=X0(o,l),h=Zr(n.materialType),u=new ye(c,h);return u.isInnerMesh=!0,r.add(u),Ep(r,u.material,n),Jn(u,s),u}(i,t))}function yP(i,e,t){const r=t.addFolder("已有列表");return r.open(),t.add(i,"geometryType",FC).name("几何体"),t.add(i,"materialType",Yo).name("材质"),t.addFn(()=>{const s=function(a,n){const o=X0(a),l=Zr(n),c=new ye(o,l);return c.isInnerMesh=!0,c}(i.geometryType,i.materialType);e.attach_add(s),v1(e,s,r.addFolder(s.geometry.geometryType+":"+hr(s)))}).name("添加"),e.children.forEach(s=>{s.isInnerMesh&&v1(e,s,r.addFolder(s.geometry.geometryType+":"+hr(s)))}),t}class xw extends Kn{constructor(e,t={}){const r=t.font;if(r===void 0)super();else{const s=r.generateShapes(e,t.size);t.depth===void 0&&t.height,t.depth=t.depth!==void 0?t.depth:t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(s,t)}this.type="TextGeometry"}}class xP extends Ht{constructor(e){super(e)}load(e,t,r,s){const a=this,n=new Ti(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(o){const l=a.parse(JSON.parse(o));t&&t(l)},r,s)}parse(e){return new bP(e)}}class bP{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const r=[],s=function(a,n,o){const l=Array.from(a),c=n/o.resolution,h=(o.boundingBox.yMax-o.boundingBox.yMin+o.underlineThickness)*c,u=[];let d=0,p=0;for(let f=0;f<l.length;f++){const g=l[f];if(g===`
`)d=0,p-=h;else{const m=MP(g,c,d,p,o);d+=m.offsetX,u.push(m.path)}}return u}(e,t,this.data);for(let a=0,n=s.length;a<n;a++)r.push(...s[a].toShapes());return r}}function MP(i,e,t,r,s){const a=s.glyphs[i]||s.glyphs["?"];if(!a)return;const n=new cb;let o,l,c,h,u,d,p,f;if(a.o){const g=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let m=0,v=g.length;m<v;)switch(g[m++]){case"m":o=g[m++]*e+t,l=g[m++]*e+r,n.moveTo(o,l);break;case"l":o=g[m++]*e+t,l=g[m++]*e+r,n.lineTo(o,l);break;case"q":c=g[m++]*e+t,h=g[m++]*e+r,u=g[m++]*e+t,d=g[m++]*e+r,n.quadraticCurveTo(u,d,c,h);break;case"b":c=g[m++]*e+t,h=g[m++]*e+r,u=g[m++]*e+t,d=g[m++]*e+r,p=g[m++]*e+t,f=g[m++]*e+r,n.bezierCurveTo(u,d,p,f,c,h)}}return{offsetX:a.ha*e,path:n}}function O1(i,e="fence"){const t=i.length,r=e==="fence"?i.map((d,p)=>p-1>-1&&p+1<t&&(p%2==0?[p,p+1,p-1]:[p,p-1,p+1])).filter(d=>d).reduce((d,p)=>[...d,...p],[]):i.map((d,p)=>p>=2&&[0,p-1,p]).filter(d=>d).reduce((d,p)=>[...d,...p],[]),s=i.reduce((d,p)=>[...d,p.x,p.y,p.z],[]),a=i.reduce((d,p)=>({x:[...d.x,p.x],y:[...d.y,p.y],z:[...d.z,p.z]}),{x:[],y:[],z:[]}),n=new R(Math.max(...a.x),Math.max(...a.y),Math.max(...a.z)),o=new R(Math.min(...a.x),Math.min(...a.y),Math.min(...a.z)),l=n.x-o.x,c=n.y-o.y,h=l>c?l:c,u=i.map(d=>new ne((d.x-o.x)/h,(d.y-o.y)/h)).reduce((d,p)=>[...d,...p],[]);return{indexGroup:r,faceGroup:s,uvGroup:u}}function U1(i,e,t){const r=new Oe,s=new Float32Array(i);if(r.setAttribute("position",new tt(s,3)),e){let a=new Uint16Array(e);r.index=new tt(a,1)}return t&&(r.attributes.uv=new Se(t,2)),r.computeVertexNormals(),r}function k1(i,e,t,r){i.setIndex(t),i.setAttribute("position",new Se(e,3)),i.setAttribute("uv",new Se(r,2)),delete i.attributes.normal,i.computeVertexNormals()}function bw(i,e,t=null){const r=new xP;return new Promise(s=>{r.load(i,a=>s(new xw(e,Ne({font:a,size:1,depth:.2,height:.2,curveSegments:12,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:5},t))))})}const F1=new Et,zu=new R;class Mw extends b0{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new Se([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new Se([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new bd(t,6,1);return this.setAttribute("instanceStart",new Ji(r,3,0)),this.setAttribute("instanceEnd",new Ji(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new bd(t,6,1);return this.setAttribute("instanceColorStart",new Ji(r,3,0)),this.setAttribute("instanceColorEnd",new Ji(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new p0(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Et);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),F1.setFromBufferAttribute(t),this.boundingBox.union(F1))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new di),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let s=0;for(let a=0,n=e.count;a<n;a++)zu.fromBufferAttribute(e,a),s=Math.max(s,r.distanceToSquared(zu)),zu.fromBufferAttribute(t,a),s=Math.max(s,r.distanceToSquared(zu));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)}}toJSON(){}applyMatrix(e){return this.applyMatrix4(e)}}Te.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ne(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},Vi.line={uniforms:ai.merge([Te.common,Te.fog,Te.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class rv extends ct{constructor(e){super({type:"LineMaterial",uniforms:ai.clone(Vi.line.uniforms),vertexShader:Vi.line.vertexShader,fragmentShader:Vi.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const cf=new qe,B1=new R,z1=new R,bi=new qe,Mi=new qe,rs=new qe,hf=new R,uf=new Me,wi=new rb,V1=new R,Vu=new Et,Hu=new di,ss=new qe;let as,Sn;function H1(i,e,t){return ss.set(0,0,-e,1).applyMatrix4(i.projectionMatrix),ss.multiplyScalar(1/ss.w),ss.x=Sn/t.width,ss.y=Sn/t.height,ss.applyMatrix4(i.projectionMatrixInverse),ss.multiplyScalar(1/ss.w),Math.abs(Math.max(ss.x,ss.y))}class wP extends ye{constructor(e=new Mw,t=new rv({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,s=new Float32Array(2*t.count);for(let n=0,o=0,l=t.count;n<l;n++,o+=2)B1.fromBufferAttribute(t,n),z1.fromBufferAttribute(r,n),s[o]=o===0?0:s[o-1],s[o+1]=s[o]+B1.distanceTo(z1);const a=new bd(s,2,1);return e.setAttribute("instanceDistanceStart",new Ji(a,1,0)),e.setAttribute("instanceDistanceEnd",new Ji(a,1,1)),this}raycast(e,t){const r=this.material.worldUnits,s=e.camera,a=e.params.Line2!==void 0&&e.params.Line2.threshold||0;as=e.ray;const n=this.matrixWorld,o=this.geometry,l=this.material;let c,h;Sn=l.linewidth+a,o.boundingSphere===null&&o.computeBoundingSphere(),Hu.copy(o.boundingSphere).applyMatrix4(n),r?c=.5*Sn:c=H1(s,Math.max(s.near,Hu.distanceToPoint(as.origin)),l.resolution),Hu.radius+=c,as.intersectsSphere(Hu)!==!1&&(o.boundingBox===null&&o.computeBoundingBox(),Vu.copy(o.boundingBox).applyMatrix4(n),r?h=.5*Sn:h=H1(s,Math.max(s.near,Vu.distanceToPoint(as.origin)),l.resolution),Vu.expandByScalar(h),as.intersectsBox(Vu)!==!1&&(r?function(u,d){const p=u.matrixWorld,f=u.geometry,g=f.attributes.instanceStart,m=f.attributes.instanceEnd;for(let v=0,_=Math.min(f.instanceCount,g.count);v<_;v++){wi.start.fromBufferAttribute(g,v),wi.end.fromBufferAttribute(m,v),wi.applyMatrix4(p);const y=new R,x=new R;as.distanceSqToSegment(wi.start,wi.end,x,y),x.distanceTo(y)<.5*Sn&&d.push({point:x,pointOnLine:y,distance:as.origin.distanceTo(x),object:u,face:null,faceIndex:v,uv:null,uv1:null})}}(this,t):function(u,d,p){const f=d.projectionMatrix,g=u.material.resolution,m=u.matrixWorld,v=u.geometry,_=v.attributes.instanceStart,y=v.attributes.instanceEnd,x=Math.min(v.instanceCount,_.count),b=-d.near;as.at(1,rs),rs.w=1,rs.applyMatrix4(d.matrixWorldInverse),rs.applyMatrix4(f),rs.multiplyScalar(1/rs.w),rs.x*=g.x/2,rs.y*=g.y/2,rs.z=0,hf.copy(rs),uf.multiplyMatrices(d.matrixWorldInverse,m);for(let M=0,T=x;M<T;M++){if(bi.fromBufferAttribute(_,M),Mi.fromBufferAttribute(y,M),bi.w=1,Mi.w=1,bi.applyMatrix4(uf),Mi.applyMatrix4(uf),bi.z>b&&Mi.z>b)continue;if(bi.z>b){const A=bi.z-Mi.z,L=(bi.z-b)/A;bi.lerp(Mi,L)}else if(Mi.z>b){const A=Mi.z-bi.z,L=(Mi.z-b)/A;Mi.lerp(bi,L)}bi.applyMatrix4(f),Mi.applyMatrix4(f),bi.multiplyScalar(1/bi.w),Mi.multiplyScalar(1/Mi.w),bi.x*=g.x/2,bi.y*=g.y/2,Mi.x*=g.x/2,Mi.y*=g.y/2,wi.start.copy(bi),wi.start.z=0,wi.end.copy(Mi),wi.end.z=0;const E=wi.closestPointToPointParameter(hf,!0);wi.at(E,V1);const C=ui.lerp(bi.z,Mi.z,E),N=C>=-1&&C<=1,D=hf.distanceTo(V1)<.5*Sn;if(N&&D){wi.start.fromBufferAttribute(_,M),wi.end.fromBufferAttribute(y,M),wi.start.applyMatrix4(m),wi.end.applyMatrix4(m);const A=new R,L=new R;as.distanceSqToSegment(wi.start,wi.end,L,A),p.push({point:L,pointOnLine:A,distance:as.origin.distanceTo(L),object:u,face:null,faceIndex:M,uv:null,uv1:null})}}}(this,s,t)))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(cf),this.material.uniforms.resolution.value.set(cf.z,cf.w))}}class ww extends Mw{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,r=new Float32Array(2*t);for(let s=0;s<t;s+=3)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];return super.setPositions(r),this}setColors(e){const t=e.length-3,r=new Float32Array(2*t);for(let s=0;s<t;s+=3)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];return super.setColors(r),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class SP extends wP{constructor(e=new ww,t=new rv({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}function Sw(i){new Et().setFromObject(i).getCenter(i.position),i.geometry.center()}function TP(i,e){var t,r;const{drawPointList:s}=e;if(s.length<2)return void(e.mesh&&(i.remove(e.mesh),e.mesh=null,(t=e.callback)==null?void 0:t.call(e,"remove")));const a=e.drawPointList.reduce((n,o)=>[...n,o.x,o.y+.001,o.z],[]);if(!e.mesh&&e.drawPointList.length>1){const n=function(o){const l=new rv({color:0,linewidth:.001,vertexColors:!1,dashed:!1,alphaToCoverage:!1}),c=new ww().setPositions(o),h=new SP(c,l);return h.computeLineDistances(),h}(a);n.isDrawMesh=!0,n.drawParams=e,e.mesh=n,i.add(e.mesh),(r=e.callback)==null||r.call(e,"set")}else e.mesh&&e.drawPointList.length>0&&(e.mesh.geometry.dispose(),e.mesh.geometry.setPositions(a),e.mesh.computeLineDistances(),e.mesh.geometry.attributes.position.needsUpdate=!0)}function G1(i,e,t,r){const s=t.addFolder("相关控制"),a=t.addFolder("点列表");s.open(),a.open();const n=r||{mode:i.mode,materialType:i.materialType,drawPointList:[],mesh:null};function o(l){n.drawPointList.push(l),zr(e,n),j1(e,n,l,a)}n.callback=function(l){if(l==="remove")for(const c in s.__folders)s.removeFolder(s.__folders[c]);else{Js(this.mesh,s.addFolder("变换配置"));const c=s.addFolder("材质配置");Cp(e,this.mesh.material,c),this.mode==="直线路径"&&c.add(this.mesh.material,"linewidth").name("线宽")}},function(l,c,h,u){if(c.mode==="围栏物体")u||(c.fenceHeight=50,c.fenceClose=!0),h.add(c,"fenceHeight").name("围栏高度").onChange(()=>zr(l,c)),h.add(c,"fenceClose").name("围栏闭合").onChange(()=>zr(l,c));else if(c.mode==="曲线路径"){u||(c.height=10,c.axial="y",c.tubularSegments=64,c.radius=.08,c.radialSegments=8,c.closed=!1);const d=h.addFolder("曲线配置");d.add(c,"height").name("高度").onChange(()=>zr(l,c)),d.add(c,"axial",["x","y","z"]).name("轴向").onChange(()=>zr(l,c)),d.add(c,"tubularSegments",1).name("管道分段").onChange(()=>zr(l,c)).step(1),d.add(c,"radius",.01).name("管道半径").onChange(()=>zr(l,c)),d.add(c,"radialSegments",1).name("管道半径分段").onChange(()=>zr(l,c)).step(1),d.add(c,"closed").name("管道闭合").onChange(()=>zr(l,c))}}(e,n,t,r),r&&(n.drawPointList.forEach(l=>j1(e,n,l,a)),n.callback("set")),t.addFn(()=>n.mesh&&e.transformControls.attach(n.mesh)).name("选中物体"),t.addFn(()=>{i.drawEventCall=o}).name("操作当前组"),t.addFn(()=>{t.parent.removeFolder(t),n.mesh&&e.remove(n.mesh),i.drawEventCall=null}).name("移除此组"),i.drawEventCall=o}function j1(i,e,t,r){const s=e.drawPointList,a=r.addFn(()=>{const n=s.indexOf(t);n>-1&&s.splice(n,1),zr(i,e),r.remove(a)}).name("移除点"+[t.x,t.y,t.z].map(n=>n.toFixed(2)).join(","))}function zr(i,e){switch(e.mode){case"围栏物体":(function(t,r){var s,a;const n=[...r.drawPointList];if(n.length<2)return void(r.mesh&&(t.remove(r.mesh),ud(r.mesh),r.mesh=null,(s=r.callback)==null?void 0:s.call(r,"remove")));r.fenceClose&&r.drawPointList.length>2&&n.push(r.drawPointList[0]);const o=n.reduce((u,d)=>{const p=new R().copy(d);return p.y+=r.fenceHeight,[...u,p,d]},[]),{indexGroup:l,faceGroup:c,uvGroup:h}=O1(o);if(o.length>3&&!r.mesh){const u=U1(c,l,h),d=Zr(r.materialType,{color:16777215}),p=new ye(u,d);p.isDrawMesh=!0,p.drawParams=r,r.mesh=p,t.add(r.mesh),(a=r.callback)==null||a.call(r,"set")}else r.mesh&&k1(r.mesh.geometry,c,l,h)})(i,e);break;case"平面绘制":(function(t,r){var s,a;const n=[...r.drawPointList];if(n.length<3)return void(r.mesh&&(t.remove(r.mesh),ud(r.mesh),r.mesh=null,(s=r.callback)==null?void 0:s.call(r,"remove")));n.forEach(h=>h.y+=.001);const{indexGroup:o,faceGroup:l,uvGroup:c}=O1(n,"face");if(r.drawPointList.length>2&&!r.mesh){const h=U1(l,o,c),u=Zr(r.materialType,{color:16777215}),d=new ye(h,u);d.isDrawMesh=!0,d.drawParams=r,r.mesh=d,t.add(r.mesh),(a=r.callback)==null||a.call(r,"set")}else r.mesh&&k1(r.mesh.geometry,l,o,c)})(i,e);break;case"曲线路径":(function(t,r){var s,a;const{drawPointList:n,height:o,axial:l,tubularSegments:c,radius:h,radialSegments:u,closed:d}=r;if(n.length<2)return void(r.mesh&&(t.remove(r.mesh),ud(r.mesh),r.mesh=null,(s=r.callback)==null?void 0:s.call(r,"remove")));const p=n.map(g=>new R(g.x,g.y,g.z)).map((g,m,v)=>{if(v[m+1]){const _=g.clone().add(v[m+1]).divideScalar(2);return _[l]+=o,[g,_]}return[g]}).flat(),f=new pp(p);if(r.mesh)r.mesh.geometry.dispose(),r.mesh.geometry=new Xs(f,c,h,u,d);else{const g=new Xs(f,c,h,u,d),m=Zr(r.materialType,{color:16777215}),v=new ye(g,m);v.isCurveMesh=!0,v.isDrawMesh=!0,v.drawParams=r,r.mesh=v,t.add(r.mesh),(a=r.callback)==null||a.call(r,"set")}})(i,e);break;case"直线路径":TP(i,e)}}function AP(i){return i.map(e=>function(t){const r={};return Object.keys(t.drawParams).forEach(s=>{["mesh","folder","callback"].includes(s)||(r[s]=t.drawParams[s])}),yi(Ne({},Qn(t)),{material:Ap(t.material),drawParams:r})}(e))}function EP(i,e){e==null||e.map(t=>function(r,s){if(!s)return;const{drawParams:a}=s;zr(r,a);const{mesh:n}=a;return Jn(n,s),Ep(r,n.material,s.material),a}(i,t))}function df(i,e=1e4){const[t,r]=i,[s,a]=Zi("EPSG:4326","EPSG:3857",[t,r]);return new ne(s/e,a/e)}function Tw(i){return new ne(i.offsetX/i.target.clientWidth*2-1,-i.offsetY/i.target.clientHeight*2+1)}function Aw(i){new Et().setFromObject(i).getCenter(i.position),i.translationOriginDiff=i.position.clone(),i.getTransformedVector=e=>{const t=e.clone();return t.sub(i.translationOriginDiff),t.multiply(i.scale),t.applyEuler(i.rotation),t.add(i.position),t},i.traverse(e=>{e.isMesh&&e.position.sub(i.position),e.initTranslate=e.position.clone()}),i.position.set(0,0,0)}function W1(i,e,t=null){const{globalConfig:r}=e,s=i.map(h=>df(h)),a=new cl(s),n=new Ea;n.path=a,r.geometry.isEmpty?n.holes.push(a):n.curves.push(a);const o=new Kn(n,Ne({depth:20,bevelEnabled:!1},r.geometry.parameters)),l=e.listMaterial||Zr(e.materialType,{color:16777215*Math.random(),transparent:!0}),c=new ye(o,l);(function(h,u){var d,p;if(h.name=(d=u==null?void 0:u.properties)==null?void 0:d.name,u==null?void 0:u.properties.center){const f=df(u.properties.center);u.properties.centerCoord3=new R(f.x,f.y,0)}if((p=u==null?void 0:u.properties)!=null&&p.centroid){const f=df(u.properties.centroid);u.properties.centroidCoord3=new R(f.x,f.y,0)}h.geoInfo=u})(c,t),Sw(c),e.attach(c)}function Fg(i,e,t){e.labelGroup={};const{type:r,color:s,fontSize:a,fontWeight:n,px:o,py:l,pz:c,rx:h,ry:u,rz:d,ss:p,sx:f,sy:g,sz:m}=t;e.children.forEach(v=>{var _,y,x,b,M,T,E,C,N;if((_=v.geoInfo)!=null&&_.properties.name&&!e.labelGroup[v.geoInfo.properties.name]){if(!((y=v.geoInfo)!=null&&y.properties.centroidCoord3)&&!((x=v.geoInfo)!=null&&x.properties.centerCoord3))return;const D=(((b=v.geoInfo)==null?void 0:b.properties.centroidCoord3)||((M=v.geoInfo)==null?void 0:M.properties.centerCoord3)).add(v.position).sub(v.initTranslate),A=e.getTransformedVector(D),L=document.createElement("div");L.innerText=((E=(T=v.geoInfo)==null?void 0:T.properties)==null?void 0:E.name)||"",L.style.color=s,L.style.fontSize=a+"px",L.style.fontWeight=n;const w=r==="2D"?new IM(L):new LM(L);w._position=A,w.position.set(w._position.x+o,w._position.y+l,w._position.z+c),w.rotation.set(h,u,d),w.scale.set(f,g,m),w.scale.setScalar(p),i.add(w),L.style.pointerEvents="none",e.labelGroup[(N=(C=v.geoInfo)==null?void 0:C.properties)==null?void 0:N.name]=w}})}function Ew(i,e){const{commonFrames:t}=i,{globalConfig:r}=e;if(!r.useGlobalConfig)return;const{mesh:s,material:a}=r;if(e.children.forEach(n=>{n.castShadow=s.castShadow,n.receiveShadow=s.receiveShadow}),a.mapUrl){const n=new xs().load(a.mapUrl);n.wrapS=$t,n.wrapT=$t,n.repeat.set(a.map.repeat.x,a.map.repeat.y),n.offset.set(a.map.offset.x,a.map.offset.y),n.center.set(a.map.center.x,a.map.center.y),n.rotation=a.map.rotation,e.texture=n,e.commonAnimateRender=function(){this.texture.offset.x+=this.globalConfig.material.textureAnimation.offset.x,this.texture.offset.y+=this.globalConfig.material.textureAnimation.offset.y,this.texture.rotation+=this.globalConfig.material.textureAnimation.rotation},t.push(e)}e.RootMaterials.forEach(n=>{n.color.set(a.color),n.wireframe=a.wireframe,n.transparent=a.transparent,n.opacity=a.opacity,["标准材质","物理材质"].includes(e.materialType)&&(n.metalness=a.metalness,n.roughness=a.roughness),e.materialType!=="基础材质"&&(n.emissive.set(a.emissive),n.emissiveIntensity=a.emissiveIntensity),e.materialType==="物理材质"&&(n.clearcoat=a.clearcoat,n.clearcoatRoughness=a.clearcoatRoughness,n.sheen=a.sheen,n.sheenRoughness=a.sheenRoughness,n.sheenColor.set(a.sheenColor),n.transmission=a.transmission),n.envMap=a.envMap?i.envBackground:null,n.envMapIntensity=a.envMapIntensity,n.reflectivity=a.reflectivity,n.map=e.texture,n.needsUpdate=!0}),e.parent.envMapChangeUseList.push(()=>e.RootMaterials.forEach(n=>n.envMap=e.parent.envBackground))}function CP(i,e,t){const{globalConfig:r}=e;t.add(r,"isSaveChildren").name("子物体更改存储"),t.add(r,"isSaveMaterials").name("单材质更改存储"),t.add(r,"useGlobalConfig").name("使用(全局)配置");const s=t.addFolder("(全局 )阴影配置");s.add(r.mesh,"castShadow").name("产生阴影").onChange(()=>e.children.forEach(a=>a.castShadow=r.mesh.castShadow)),s.add(r.mesh,"receiveShadow").name("接收阴影").onChange(()=>e.children.forEach(a=>a.receiveShadow=r.mesh.receiveShadow)),Cw(i,e,t.addFolder("(全局)材质配置")),function(a,n){const{globalConfig:o}=a;let l=null;function c(){l&&clearTimeout(l),l=setTimeout(()=>{a.children.forEach(h=>{h.geometry.dispose(),o.geometry.isEmpty?(h.geometry.parameters.shapes.holes=[h.geometry.parameters.shapes.path],h.geometry.parameters.shapes.curves=[]):(h.geometry.parameters.shapes.curves=[h.geometry.parameters.shapes.path],h.geometry.parameters.shapes.holes=[]),h.geometry=new Kn(h.geometry.parameters.shapes,o.geometry.parameters),h.geometry.center()}),l=null},200)}n.add(o.geometry,"isEmpty").name("镂空").onChange(c),n.add(o.geometry.parameters,"depth").name("深度").onChange(c).min(.001),n.add(o.geometry.parameters,"bevelEnabled").name("斜角").onChange(c),n.add(o.geometry.parameters,"bevelThickness").name("斜角厚度").onChange(c).min(0),n.add(o.geometry.parameters,"bevelSize").name("斜角大小").onChange(c).min(0),n.add(o.geometry.parameters,"bevelOffset").name("斜角偏移").onChange(c).min(0)}(e,t.addFolder("形状配置"))}function Cw(i,e,t){const{globalConfig:r}=e,{material:s}=r;t.addColor(s,"color").name("颜色").onChange(a=>e.RootMaterials.forEach(n=>n.color.set(a))),t.add(s,"wireframe").name("线框").onChange(a=>e.RootMaterials.forEach(n=>n.wireframe=a)),t.add(s,"transparent").name("透明").onChange(a=>e.RootMaterials.forEach(n=>n.transparent=a)),t.add(s,"opacity",0,1).name("透明度").onChange(a=>e.RootMaterials.forEach(n=>n.opacity=a)),["标准材质","物理材质"].includes(e.materialType)&&(t.add(s,"metalness",0,1).name("金属感").onChange(a=>e.RootMaterials.forEach(n=>n.metalness=a)),t.add(s,"roughness",0,1).name("粗糙感").onChange(a=>e.RootMaterials.forEach(n=>n.roughness=a))),e.materialType!=="基础材质"&&(t.addColor(s,"emissive").name("自发光").onChange(a=>e.RootMaterials.forEach(n=>n.emissive.set(a))),t.add(s,"emissiveIntensity",0).name("自发光强度").onChange(a=>e.RootMaterials.forEach(n=>n.emissiveIntensity=a))),e.materialType!=="卡通材质"&&(t.add(s,"envMap").name("环境贴图").onChange(a=>e.RootMaterials.forEach(n=>n.envMap=a?i.envBackground:null)),t.add(s,"envMapIntensity",0).name("环境贴图强度").onChange(a=>e.RootMaterials.forEach(n=>n.envMapIntensity=a)),t.add(s,"reflectivity",0,1).name("反射率").onChange(a=>e.RootMaterials.forEach(n=>n.reflectivity=a))),e.materialType==="物理材质"&&(t.add(s,"clearcoat",0,1).name("清漆层").onChange(a=>e.RootMaterials.forEach(n=>n.clearcoat=a)),t.add(s,"clearcoatRoughness",0,1).name("清漆层粗糙度").onChange(a=>e.RootMaterials.forEach(n=>n.clearcoatRoughness=a)),t.add(s,"sheen",0,1).name("光泽度").onChange(a=>e.RootMaterials.forEach(n=>n.sheen=a)),t.add(s,"sheenRoughness",0,1).name("光泽粗糙度").onChange(a=>e.RootMaterials.forEach(n=>n.sheenRoughness=a)),t.addColor(s,"sheenColor").name("光泽颜色").onChange(a=>e.RootMaterials.forEach(n=>n.sheenColor.set(a))),t.add(s,"transmission",0,1).name("透射率").onChange(a=>e.RootMaterials.forEach(n=>n.transmission=a))),t.addFn(()=>e.RootMaterials.forEach(a=>a.needsUpdate=!0)).name("手动更新材质"),function(a,n,o){const{material:l}=n.globalConfig;function c(d){n.RootMaterials.forEach(p=>{p.map&&(p.map[d]=l.map[d])})}function h(){const{mapUrl:d,map:p}=l;if(!d)return;const f=new xs().load(d);f.wrapS=$t,f.wrapT=$t,f.repeat.set(p.repeat.x,p.repeat.y),f.offset.set(p.offset.x,p.offset.y),f.center.set(p.center.x,p.center.y),f.rotation=p.rotation,n.texture=f,n.RootMaterials.forEach(g=>{g.map=f,g.needsUpdate=!0})}function u(d){d?(n.commonAnimateRender=function(){this.texture.offset.x+=this.globalConfig.material.textureAnimation.offset.x,this.texture.offset.y+=this.globalConfig.material.textureAnimation.offset.y,this.texture.rotation+=this.globalConfig.material.textureAnimation.rotation},a.push(n)):delete n.texture.commonAnimateRender}o.add(l,"mapUrl").name("贴图路径"),o.add(l.map.repeat,"x").name("水平重复").onChange(d=>c("repeat")),o.add(l.map.repeat,"y").name("垂直重复").onChange(d=>c("repeat")),o.add(l.map.offset,"x").name("水平偏移").onChange(d=>c("offset")),o.add(l.map.offset,"y").name("垂直偏移").onChange(d=>c("offset")),o.add(l.map,"rotation",0,2*Math.PI).name("旋转").onChange(d=>c("rotation")),o.add(l.map.center,"x").name("水平中心").onChange(d=>c("center")),o.add(l.map.center,"y").name("垂直中心").onChange(d=>c("center")),o.add(l.textureAnimation,"isTextureAnimation").name("贴图动画").onChange(d=>u(d)),o.add(l.textureAnimation.offset,"x").name("水平偏移动画"),o.add(l.textureAnimation.offset,"y").name("垂直偏移动画"),o.add(l.textureAnimation,"rotation",0,2*Math.PI).name("旋转动画"),o.addFn(()=>h()).name("更新贴图")}(i.commonFrames,e,t.addFolder("贴图"))}function RP(i,e){return Wr(this,null,function*(){var t;if(!e)return;const r=new Ei;return r.url=e.url,r.materialType=e.materialType,r.globalConfig=e.globalConfig,r.isListMaterial=e.isListMaterial,r.edgeMaterialType=e.edgeMaterialType,yield sv(i,r),Jn(r,e),Ew(i,r),r.globalConfig.isSaveChildren&&Ip(r.children,e.children),r.globalConfig.isSaveMaterials&&r.RootMaterials.forEach((s,a)=>Q0(s,e.RootMaterials[a])),(t=r.listMaterial)==null||t.forEach((s,a)=>Ep(i,s,e.listMaterial[a])),function(s,a){const{label:n}=a.globalConfig;n.show&&Fg(s,a,n)}(i,r),r})}function sv(i,e){return Wr(this,null,function*(){let t=null;return t=typeof e.url=="string"?yield fetch(e.url).then(r=>r.json()):e.url,function(r,s){if(s.isListMaterial){const{materialType:a,edgeMaterialType:n}=s;s.listMaterial=[Zr(a,{color:16777215*Math.random(),transparent:!0}),Zr(n,{color:16777215*Math.random(),transparent:!0})]}r.forEach(a=>{a.geometry.type==="MultiPolygon"?a.geometry.coordinates.forEach(n=>n.forEach(o=>W1(o,s,a))):a.geometry.type==="Polygon"&&a.geometry.coordinates.forEach(n=>W1(n,s,a))})}(t.features,e),Aw(e),e.RootMaterials=Rp(e),e.rotation.x=-Math.PI/2,e.isGeoGroup=!0,i.add(e),e})}function X1(i,e,t){var r;t.add(e,"url").name("地址源修改"),Js(e,t.addFolder("基础配置")),CP(i,e,t.addFolder("子项和全局配置")),function(s,a,n){const{label:o}=a.globalConfig;function l(h){if(!a.labelGroup)return;const u=Object.values(a.labelGroup);switch(h){case"type":c(),Fg(s,a,o);break;case"color":u.forEach(d=>d.element.style.color=o[h]);break;case"fontSize":u.forEach(d=>d.element.style.fontSize=o[h]+"px");break;case"fontWeight":u.forEach(d=>d.element.style.fontWeight=o[h]);break;case"px":u.forEach(d=>d.position.x=d._position.x+o[h]);break;case"py":u.forEach(d=>d.position.y=d._position.y+o[h]);break;case"pz":u.forEach(d=>d.position.z=d._position.z+o[h]);break;case"rx":u.forEach(d=>d.rotation.x=o[h]);break;case"ry":u.forEach(d=>d.rotation.y=o[h]);break;case"rz":u.forEach(d=>d.rotation.z=o[h]);break;case"ss":u.forEach(d=>d.scale.setScalar(o[h]));break;case"sx":u.forEach(d=>d.scale.x=o[h]);break;case"sy":u.forEach(d=>d.scale.y=o[h]);break;case"sz":u.forEach(d=>d.scale.z=o[h])}}function c(){a.labelGroup&&Object.keys(a.labelGroup).forEach(h=>{s.remove(a.labelGroup[h]),delete a.labelGroup[h]})}n.add(o,"show").name("显示标签").onChange(h=>h?Fg(s,a,o):c()),n.add(o,"type",["2D","3D"]).name("标签类型").onChange(h=>l("type")),n.addColor(o,"color").name("标签颜色").onChange(h=>l("color")),n.add(o,"fontSize",0).name("标签字体大小").onChange(h=>l("fontSize")),n.add(o,"fontWeight",["400","500","600","700","800","900"]).name("标签字体粗细").onChange(h=>l("fontWeight")),n.add(o,"px").name("标签位置X偏移").onChange(h=>l("px")),n.add(o,"py").name("标签位置Y偏移").onChange(h=>l("py")),n.add(o,"pz").name("标签位置Z偏移").onChange(h=>l("pz")),n.add(o,"rx",0,2*Math.PI).name("标签旋转X偏移").onChange(h=>l("rx")),n.add(o,"ry",0,2*Math.PI).name("标签旋转Y偏移").onChange(h=>l("ry")),n.add(o,"rz",0,2*Math.PI).name("标签旋转Z偏移").onChange(h=>l("rz")),n.add(o,"ss").name("标签缩放").onChange(h=>l("ss")),n.add(o,"sx").name("标签缩放X").onChange(h=>l("sx")),n.add(o,"sy").name("标签缩放Y").onChange(h=>l("sy")),n.add(o,"sz").name("标签缩放Z").onChange(h=>l("sz"))}(i,e,t.addFolder("标签配置")),(r=e.listMaterial)==null||r.forEach((s,a)=>Cp(i,s,t.addFolder(a?"边缘":"面"))),t.addFn(()=>{t.parent.removeFolder(t),i.remove(e)}).name("删除地图")}function PP(i,e,t){const r=t.addFolder("地图列表");return r.open(),t.add(i,"url").name("地图数据地址"),t.add(i,"materialType",Yo).name("地图材质类型"),t.add(i,"isListMaterial").name("是否列表材质"),t.add(i,"edgeMaterialType",Yo).name("边缘材质类型"),t.addFn(()=>Wr(this,null,function*(){if(!i.url)return;const{url:s,materialType:a,isListMaterial:n,edgeMaterialType:o}=i,l=yield sv(e,function(c,h,u,d){const p=new Ei;return p.url=c,p.materialType=h,p.isListMaterial=u,p.edgeMaterialType=d,function(f){f.globalConfig||(f.globalConfig={useGlobalConfig:!1,isSaveChildren:!0,isSaveMaterials:!0,mesh:{castShadow:!1,receiveShadow:!1},material:{color:16777215,wireframe:!1,transparent:!0,opacity:1,metalness:0,roughness:0,emissive:0,emissiveIntensity:1,clearcoat:0,clearcoatRoughness:0,sheen:0,sheenRoughness:0,sheenColor:0,transmission:0,envMap:!1,envMapIntensity:1,reflectivity:.98,mapUrl:"",textureAnimation:{isTextureAnimation:!1,offset:{x:0,y:.01},rotation:0},map:{repeat:{x:1,y:1},offset:{x:0,y:0},center:{x:0,y:0},rotation:0}},geometry:{geometryType:"形状路径挤压体",isEmpty:!1,parameters:{depth:16,bevelEnabled:!1,bevelThickness:0,bevelSize:0,bevelOffset:0}},label:{show:!1,type:"2D",color:"#fff",fontSize:12,fontWeight:400,px:0,py:0,pz:0,rx:0,ry:0,rz:0,ss:1,sx:1,sy:1,sz:1}})}(p),p}(s,a,n,o));X1(e,l,r.addFolder(hr(l)))})).name("添加地图"),e.children.forEach(s=>s.isGeoGroup&&X1(e,s,r.addFolder(hr(s)))),t}function IP(i){return i.map(e=>function(t){const{url:r,globalConfig:s,materialType:a,isListMaterial:n,edgeMaterialType:o,listMaterial:l,children:c,RootMaterials:h}=t;return yi(Ne({},Qn(t)),{url:r,globalConfig:s,materialType:a,isListMaterial:n,edgeMaterialType:o,listMaterial:l==null?void 0:l.map(u=>Ap(u)),RootMaterials:s.isSaveMaterials?h.map(u=>K0(u)):void 0,children:s.isSaveChildren?Pp(c):void 0})}(e))}function q1(i,e,t){_w(e,t.addFolder("基础配置"));const{globalConfig:r}=e;t.add(r,"isSaveChildren").name("子物体更改存储"),t.add(r,"isSaveMaterials").name("单材质更改存储"),t.add(r,"useGlobalConfig").name("全局材质配置");const s=t.addFolder("阴影");s.add(r.mesh,"castShadow").name("产生阴影").onChange(()=>e.children.forEach(a=>a.castShadow=r.mesh.castShadow)),s.add(r.mesh,"receiveShadow").name("接收阴影").onChange(()=>e.children.forEach(a=>a.receiveShadow=r.mesh.receiveShadow)),function(a,n){const{globalConfig:o}=a,{geometry:l}=o;let c=null;function h(){c&&clearTimeout(c),c=setTimeout(()=>{a.children.forEach(u=>{u.geometry.dispose(),u.geometry=new Xs(u.curve,(u.curve.points.length-1)*l.tubularSegmentsMultiple,l.radius,l.radialSegments,l.closed),u.geometry.center()}),c=null},200)}n.add(l,"tubularSegmentsMultiple",1).name("分段倍乘").onChange(h).step(1),n.add(l,"radius",.01).name("管道半径").onChange(h),n.add(l,"radialSegments",2).name("管道半径分段").onChange(h).step(1),n.add(l,"closed").name("管道是否闭合").onChange(h)}(e,t.addFolder("几何体")),Cw(i,e,t.addFolder("材质")),t.addFn(()=>{t.parent.removeFolder(t),i.remove(e)}).name("删除边界")}function Rw(i,e,t=0){const r=new Ei;return r.materialType=e,r.url=i,r.dlength=t,function(s){s.globalConfig={useGlobalConfig:!1,isSaveMaterials:!0,isSaveChildren:!0,mesh:{castShadow:!1,receiveShadow:!1},material:{color:16777215,wireframe:!1,transparent:!0,opacity:1,metalness:0,roughness:0,emissive:0,emissiveIntensity:1,clearcoat:0,clearcoatRoughness:0,sheen:0,sheenRoughness:0,sheenColor:0,transmission:0,envMap:!1,envMapIntensity:1,reflectivity:.98,mapUrl:"",textureAnimation:{isTextureAnimation:!1,offset:{x:0,y:.01},rotation:0},map:{repeat:{x:1,y:1},offset:{x:0,y:0},center:{x:0,y:0},rotation:0}},geometry:{radialSegments:4,radius:2,closed:!1,tubularSegmentsMultiple:1}}}(r),fetch(i).then(s=>s.json()).then(s=>{const{features:a}=s;return a.forEach(n=>{n.geometry.type==="MultiPolygon"?n.geometry.coordinates.forEach(o=>o.forEach(l=>pf(r,l))):n.geometry.type==="Polygon"?n.geometry.coordinates.forEach(o=>pf(r,o)):n.geometry.type==="LineString"&&n.geometry.coordinates.length>1&&pf(r,n.geometry.coordinates)}),Aw(r),r.RootMaterials=Rp(r),r.rotation.x=-Math.PI/2,r.isBorderGroup=!0,r})}function pf(i,e){if(e.length<i.dlength)return;const t=e.map(o=>function(l,c=1e4){const[h,u]=l,[d,p]=Zi("EPSG:4326","EPSG:3857",[h,u]);return new R(d/c,p/c,0)}(o)),r=new pp(t),s=new Xs(r,t.length-1,2,4,!1),a=Zr(i.materialType,{color:16777215*Math.random(),transparent:!0,alphaHash:!0}),n=new ye(s,a);n.curve=r,Sw(n),i.attach(n)}function LP(i){return i.map(e=>function(t){const{children:r,RootMaterials:s}=t;return yi(Ne({},ev(t)),{globalConfig:t.globalConfig,url:t.url,dlength:t.dlength,materialType:t.materialType,RootMaterials:t.globalConfig.isSaveMaterials?s.map(a=>K0(a)):void 0,children:t.globalConfig.isSaveChildren?Pp(r):void 0})}(e))}function NP(i,e){e&&e.forEach(t=>function(r,s){return Wr(this,null,function*(){if(!s)return;const a=yield Rw(s.url,s.materialType,s.dlength);a.globalConfig=s.globalConfig;const{geometry:n}=a.globalConfig;return a.children.forEach(o=>{o.geometry.dispose(),o.geometry=new Xs(o.curve,(o.curve.points.length-1)*n.tubularSegmentsMultiple,n.radius,n.radialSegments,n.closed),o.geometry.center()}),r.add(a),tv(a,s),Ew(r,a),a.globalConfig.isSaveChildren&&Ip(a.children,s.children),a.globalConfig.isSaveMaterials&&a.RootMaterials.forEach((o,l)=>Q0(o,s.RootMaterials[l])),a})}(i,t))}function Pw(i,e,t){const r=Iw(t),s=function(n,o){const{uniforms:l,fragmentFunc:c,fragmentBody:h,key:u,render:d}=function(f,g,m=""){const{name:v,customUniforms:_,key:y,fragment:x,render:b}=kM[g],M={uniforms:Ne({},Od(f,["pointTexture-texture-sampler2D-"+m,"size-number-float-100","discardVal-number-float-0.5","opacity-number-float-1","isdecaySize-bool-bool-true","hasUv-bool-bool-true","iTime-number-float-0","speed-number-float-0.01","intensity-number-float-1","mixRatio-number-float-1","mixColor-color-vec3-0xffffff","iResolution-dom-vec2-0,0"])),fragmentFunc:"",fragmentBody:"",key:y,shaderProgramsCodeName:v};if(_&&Object.assign(M.uniforms,Od(f,_)),x.search("<SPLIT_PLACEHOLDER>")!==-1){const[T,E]=x.split("<SPLIT_PLACEHOLDER>");M.fragmentFunc=T,M.fragmentBody=E.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;")}else M.fragmentBody=x.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;");return M.render=b==="iTime+speed"?()=>M.uniforms.iTime.value+=M.uniforms.speed.value:new Function(b).bind(M.uniforms),M}(n,o.shaderCodeName,o.mapUrl),p=new ct({uniforms:l,vertexShader:`

            uniform float size;

            uniform bool isdecaySize;

            void main() {

                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

                gl_PointSize = isdecaySize ? size * ( 300.0 / -mvPosition.z ) : size;

                gl_Position = projectionMatrix * mvPosition;

            } 

        `,fragmentShader:Object.keys(l).map(f=>"uniform "+l[f].unit+" "+f+`;
`).join("")+`${c}void main() {

            vec2 vUv = gl_PointCoord.xy - .5;

            ${h}
            
            vec3 useColor = ${u};

            vec4 textureColor = texture2D( pointTexture, gl_PointCoord );

            if (textureColor.a < discardVal) discard;

            else useColor *= textureColor.rgb;

            gl_FragColor = vec4( mix( mixColor, useColor * vec3( intensity, intensity, intensity), mixRatio ) , opacity );
            
        }`,transparent:!0,depthTest:!0,blending:js});return p.materialRender=d,p}(e,t),a=new Aa(r,s);return a.parameters=t,a.commonAnimateRender=()=>{var n,o,l,c;(o=(n=a.geometry).geometryRender)==null||o.call(n),(c=(l=a.material).materialRender)==null||c.call(l)},a.isParticleMesh=!0,i.add(a),i.commonFrames.push(a),a}function Iw(i){if(i.outer-i.inner<1)return new Oe;const e=new Float32Array(3*i.particlesSum),t=new Float32Array(3*i.particlesSum),r={全随机:n=>{t[3*n]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+1]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+2]+=(Math.random()-.5)*i.maxVelocity/1e3},随机向上:n=>{t[3*n]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+1]+=Math.abs((Math.random()-.5)*i.maxVelocity/1e5),t[3*n+2]+=(Math.random()-.5)*i.maxVelocity/1e3},随机向下:n=>{t[3*n]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+1]-=Math.abs((Math.random()-.5)*i.maxVelocity/1e5),t[3*n+2]+=(Math.random()-.5)*i.maxVelocity/1e3},直线匀速向上:n=>{t[3*n]=0,t[3*n+1]+=i.maxVelocity/2/1e5,t[3*n+2]=0},直线匀速向下:n=>{t[3*n]=0,t[3*n+1]-=i.maxVelocity/2/1e5,t[3*n+2]=0}}[i.sportType];function s(){let n,o,l;do n=2*Math.random()*i.outer-i.outer,o=2*Math.random()*i.outer-i.outer,l=2*Math.random()*i.outer-i.outer;while(Math.abs(n)<=i.inner&&Math.abs(o)<=i.inner&&Math.abs(l)<=i.inner);return[n,o,l]}for(let n=0;n<i.particlesSum;n++)e.set(s(),3*n);const a=new Oe;return a.setAttribute("position",new tt(e,3)),a.geometryRender=()=>{for(let n=0;n<i.particlesSum;n++)if(r(n),e[3*n]+=t[3*n],e[3*n+1]+=t[3*n+1],e[3*n+2]+=t[3*n+2],Math.abs(e[3*n])>i.outer||Math.abs(e[3*n+1])>i.outer||Math.abs(e[3*n+2])>i.outer||Math.abs(e[3*n])<i.inner&&Math.abs(e[3*n+1])<i.inner&&Math.abs(e[3*n+2])<i.inner){const[o,l,c]=s();e[3*n]=o,e[3*n+1]=l,e[3*n+2]=c,t[3*n]=0,t[3*n+1]=0,t[3*n+2]=0}a.attributes.position.needsUpdate=!0},a}function Y1(i,e,t){Js(e,t.addFolder("基础属性")),function(r,s){let a=null;function n(){a||(r.geometry.dispose(),r.geometry=new Oe,a=setTimeout(()=>{r.geometry=Iw(r.parameters),a=null},200))}s.add(r.parameters,"particlesSum",1).name("数量").onChange(n),s.add(r.parameters,"inner",0).name("内半径").onChange(n),s.add(r.parameters,"outer",500).name("外半径").onChange(n),s.add(r.parameters,"maxVelocity").name("最大速度").onChange(n),s.add(r.parameters,"sportType",["全随机","随机向下","随机向上","直线匀速向上","直线匀速向下"]).name("运动方式").onChange(n)}(e,t.addFolder("几何")),function(r,s){s.add(r,"depthTest").name("深度测试").onChange(()=>r.needsUpdate=!0),s.add(r,"blending",q0).name("混合模式").onChange(a=>(r.blending=Number(a),r.needsUpdate=!0)),hd(r.uniforms,s.addFolder("着色器参数"))}(e.material,t.addFolder("材质")),t.addFn(()=>i.transformControls.attach(e)).name("选中"),t.addFn(()=>{i.remove(e),t.parent.removeFolder(t)}).name("删除")}function DP(i){return i.map(e=>function(t){const{material:r}=t,{uniforms:s,blending:a,depthTest:n}=r;return yi(Ne({},Qn(t)),{parameters:t.parameters,material:{uniforms:FM(s),blending:a,depthTest:n}})}(e))}function OP(i,e,t){t==null||t.map(r=>function(s,a,n){if(!n)return;const o=Pw(s,a,n.parameters);Jn(o,n);const{material:l}=n;return o.material.blending=l.blending,o.material.depthTest=l.depthTest,BM(o.material.uniforms,l.uniforms),l.needsUpdate=!0,o}(i,e,r))}function Z1(i,e,t){Js(e,t.addFolder("基础配置")),function(r,s){const{geometry:a}=r,{parameters:n}=a,{options:o}=n;let l=null;function c(){l&&clearTimeout(l),l=setTimeout(()=>{r.geometry.dispose(),r.geometry=new xw(r.text,o),l=null},200)}s.add(r,"text").onChange(c).name("文本"),s.add(o,"size").onChange(c).name("大小"),s.add(o,"depth").onChange(c).name("深度"),s.add(o,"height").onChange(c).name("高度"),s.add(o,"curveSegments").onChange(c).name("曲线分段").step(1).min(1),s.add(o,"bevelEnabled").onChange(c).name("斜角"),s.add(o,"bevelThickness").onChange(c).name("斜角厚度"),s.add(o,"bevelSize").onChange(c).name("斜角大小"),s.add(o,"bevelSegments").onChange(c).name("斜角分段").step(1).min(0)}(e,t.addFolder("几何体")),Cp(i,e.material,t.addFolder("材质")),t.addFn(()=>{i.remove(e),t.parent.removeFolder(t)}).name("删除")}function UP(i){return i.map(e=>function(t){const{material:r,geometry:s}=t,{parameters:a}=s,{options:n}=a;return yi(Ne({},Qn(t)),{fontLink:t.fontLink,text:t.text,geometry:{geometryType:"TextGeometry",parameters:{size:n.size,depth:n.depth,height:n.height,curveSegments:n.curveSegments,bevelEnabled:n.bevelEnabled,bevelThickness:n.bevelThickness,bevelSize:n.bevelSize,bevelSegments:n.bevelSegments}},material:Ap(r)})}(e))}function kP(i,e){e==null||e.forEach(t=>function(r,s){return Wr(this,null,function*(){if(!s)return;const{geometry:a,material:n}=s,{parameters:o}=a,l=yield bw(s.fontLink,s.text,o),c=Zr(n.materialType),h=new ye(l,c);return h.fontLink=s.fontLink,h.text=s.text,h.isTextMesh=!0,r.add(h),Ep(r,h.material,n),Jn(h,s),h})}(i,t))}const FP={name:"光柱",initParameters:{url:"http://guangfu/channels/lightMap.png",size:.25},initPanel:function(i){i.add(this.initParameters,"url").name("资源路径"),i.add(this.initParameters,"size").name("立柱尺寸")},create:function({},i){const e=Ne(Ne({},this.initParameters),i==null?void 0:i.initParameters),t=new zt(e.size||.3,e.size||.3,20,6),r=new ei({color:16572044,transparent:!0,opacity:.5,side:It}),s=new ye(t,r);r.blending=js;const a=new xs().load(e.url);a.wrapS=$t,a.wrapT=$t;const n=new ws(1.5,20),o=new ei({transparent:!0,opacity:.3,side:It,map:a});o.blending=js,o.depthTest=!1;const l=new ye(n,o),c=l.clone();c.rotation.y=Math.PI/3;const h=l.clone();h.rotation.y=-Math.PI/3,s.add(h),s.add(l),s.add(c),s.position.y=10;const u=new Ei;return u.RootMaterials=[r,o],u.add(s),u.initParameters=e,u},changePanel(i,e,{}){const[t,r]=i.RootMaterials;e.add(i.initParameters,"url").name("资源路径"),e.addHexColor(t.color).name("立柱颜色"),e.add(t,"opacity",0,1).name("立柱透明度"),e.addHexColor(r.color).name("面颜色"),e.add(r,"opacity",0,1).name("面透明度"),e.addFn(()=>{const{url:s}=i.initParameters;if(!s)return;const a=new xs().load(s);a.wrapS=$t,a.wrapT=$t,i.children[0].children.forEach(n=>{n.material.map=a})}).name("更新贴图")},getStorage:function(i){const{initParameters:e}=i,[t,r]=i.RootMaterials;return{initParameters:e,RootMaterials:[{color:t.color.getHex(),opacity:t.opacity},{color:r.color.getHex(),opacity:r.opacity}]}},setStorage:function(i,e){if(!e)return;const[t,r]=i.RootMaterials,[s,a]=e.RootMaterials;t.color.setHex(s.color),t.opacity=s.opacity,r.color.setHex(a.color),r.opacity=a.opacity}};class Lp extends ye{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new Jt;const r=this,s=t.color!==void 0?new fe(t.color):new fe(8355711),a=t.textureWidth||512,n=t.textureHeight||512,o=t.clipBias||0,l=t.shader||Lp.ReflectorShader,c=t.multisample!==void 0?t.multisample:4,h=new jr,u=new R,d=new R,p=new R,f=new Me,g=new R(0,0,-1),m=new qe,v=new R,_=new R,y=new qe,x=new Me,b=this.camera,M=new ft(a,n,{samples:c,type:Qt}),T=new ct({name:l.name!==void 0?l.name:"unspecified",uniforms:ai.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});T.uniforms.tDiffuse.value=M.texture,T.uniforms.color.value=s,T.uniforms.textureMatrix.value=x,this.material=T,this.onBeforeRender=function(E,C,N){if(d.setFromMatrixPosition(r.matrixWorld),p.setFromMatrixPosition(N.matrixWorld),f.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(f),v.subVectors(d,p),v.dot(u)>0)return;v.reflect(u).negate(),v.add(d),f.extractRotation(N.matrixWorld),g.set(0,0,-1),g.applyMatrix4(f),g.add(p),_.subVectors(d,g),_.reflect(u).negate(),_.add(d),b.position.copy(v),b.up.set(0,1,0),b.up.applyMatrix4(f),b.up.reflect(u),b.lookAt(_),b.far=N.far,b.updateMatrixWorld(),b.projectionMatrix.copy(N.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(b.projectionMatrix),x.multiply(b.matrixWorldInverse),x.multiply(r.matrixWorld),h.setFromNormalAndCoplanarPoint(u,d),h.applyMatrix4(b.matrixWorldInverse),m.set(h.normal.x,h.normal.y,h.normal.z,h.constant);const D=b.projectionMatrix;y.x=(Math.sign(m.x)+D.elements[8])/D.elements[0],y.y=(Math.sign(m.y)+D.elements[9])/D.elements[5],y.z=-1,y.w=(1+D.elements[10])/D.elements[14],m.multiplyScalar(2/m.dot(y)),D.elements[2]=m.x,D.elements[6]=m.y,D.elements[10]=m.z+1-o,D.elements[14]=m.w,r.visible=!1;const A=E.getRenderTarget(),L=E.xr.enabled,w=E.shadowMap.autoUpdate;E.xr.enabled=!1,E.shadowMap.autoUpdate=!1,E.setRenderTarget(M),E.state.buffers.depth.setMask(!0),E.autoClear===!1&&E.clear(),E.render(C,b),E.xr.enabled=L,E.shadowMap.autoUpdate=w,E.setRenderTarget(A);const B=N.viewport;B!==void 0&&E.state.viewport(B),r.visible=!0},this.getRenderTarget=function(){return M},this.dispose=function(){M.dispose(),r.material.dispose()}}}Lp.ReflectorShader={name:"ReflectorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};const BP={name:"镜面",disBlendShader:!0,initParameters:{clipBias:.01,color:12700619},initPanel:function(i){i.add(this.initParameters,"clipBias").name("裁剪偏移"),i.addColor(this.initParameters,"color").name("颜色")},create:function(i,e){const t=Ne(Ne({},this.initParameters),e==null?void 0:e.initParameters),{DOM:r,renderer:s}=i,a=new Lp(new ws(100,100),Ne({clipBias:.01,textureWidth:r.clientWidth*s.getPixelRatio(),textureHeight:r.clientHeight*s.getPixelRatio(),color:12700619},t));return a.initParameters=t,a.rotateX(-Math.PI/2),a},changePanel:function(i,e){const{material:t}=i;e.add(t,"visible").name("可见"),e.add(t,"wireframe").name("线框"),e.addHexColor(t.uniforms.color.value).name("颜色")},getStorage:function(i){const{material:e,initParameters:t}=i;return{initParameters:t,material:{wireframe:e.wireframe,color:e.uniforms.color.value.getHex()}}},setStorage:function(i,e){if(!e)return;const{material:t}=i;t.wireframe=e.material.wireframe,t.uniforms.color.value.setHex(e.material.color)}},Lw=Object.values(Object.assign({"../../Addons/DesignMesh/LightColumn.js":FP,"../../Addons/DesignMesh/Mirror.js":BP})),Mh=i=>Lw.find(e=>e.name===i);function K1(i,e,t){var r;const{scene:s,transformControls:a}=t,n=Mh(i.designType);Js(i,e.addFolder("基础配置")),(r=n.changePanel)==null||r.call(n,i,e.addFolder("相关配置"),t),e.addFn(()=>a.attach(i)).name("选中"),e.addFn(()=>{s.remove(i),e.parent.removeFolder(e)}).name("删除")}function Nw(i,e,t){const r=i.create(e,t);if(r)return r.isDesignMesh=!0,r.designType=i.name,i.disBlendShader&&(r.disBlendShader=!0),r}function zP(i){return i.map(e=>function(t){var r;const{designType:s}=t,a=Mh(s);return Ne(Ne({designType:s},Qn(t)),(r=a.getStorage)==null?void 0:r.call(a,t))}(e))}function VP(i,e){e==null||e.forEach(t=>function(r,s){var a;if(!s)return;const{scene:n}=r,o=Mh(s.designType),l=Nw(o,r,s);n.add(l),Jn(l,s),(a=o.setStorage)==null||a.call(o,l,s,r)}(i,t))}function Q1(i,e){var t;const r=Mh(i);r&&((t=r.initPanel)==null||t.call(r,e))}function HP(){return{modelCore:{rootFolder:null,insertModel:null,progressList:[],url:"",modelAnimationPlay:iv},innerMeshCore:{geometryType:"立方体",materialType:"标准材质"},drawCore:{mode:"围栏物体",pointMode:"场景交点",pointModeList:["场景交点","地图区域中心","地图行政中心"],modeList:["围栏物体","平面绘制","曲线路径","直线路径"],materialType:"标准材质",drawEventCall:null,currentDrawFolder:null,sceneEventCall:function(i,e){var t,r,s,a,n;switch(this.pointMode){case"场景交点":return(t=this.drawEventCall)==null?void 0:t.call(this,i);case"地图区域中心":return(r=e.geoInfo)!=null&&r.properties.centroidCoord3?(s=this.drawEventCall)==null?void 0:s.call(this,e.parent.getTransformedVector(e.geoInfo.properties.centroidCoord3.clone().add(e.position).sub(e.initTranslate))):void 0;case"地图行政中心":return(a=e.geoInfo)!=null&&a.properties.centerCoord3?(n=this.drawEventCall)==null?void 0:n.call(this,e.parent.getTransformedVector(e.geoInfo.properties.centerCoord3.clone().add(e.position).sub(e.initTranslate))):void 0}}},chartsMapCore:{url:"https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json",materialType:"标准材质",isListMaterial:!0,edgeMaterialType:"标准材质",progressList:[],createGeoGroup:sv},particleCore:{particlesSum:1e5,inner:0,outer:2e3,maxVelocity:50,mapUrl:"http://guangfu/icon/snow.png",sportType:"全随机",shaderCodeName:"水波纹"},textMeshCore:{fontLink:"http://guangfu/font/cn.json",text:"",materialType:"标准材质"},designMeshCore:{type:"光柱"},borderGroupCore:{url:"https://geo.datav.aliyun.com/areas_v3/bound/100000.json",materialType:"基础材质",dlength:0}}}function GP(i){const e={lightList:[],modelList:[],innerMeshList:[],drawMeshList:[],geoGroupList:[],borderGroupList:[],particleList:[],textMeshList:[],designMeshList:[]};return i.children.forEach(t=>{t.isLight?e.lightList.push(t):t.rootInfo?e.modelList.push(t):t.isInnerMesh?e.innerMeshList.push(t):t.isDrawMesh?e.drawMeshList.push(t):t.isGeoGroup?e.geoGroupList.push(t):t.isParticleMesh?e.particleList.push(t):t.isTextMesh?e.textMeshList.push(t):t.isBorderGroup?e.borderGroupList.push(t):t.isDesignMesh&&e.designMeshList.push(t)}),{lighting:J3(e.lightList),modelList:gP(e.modelList),innerMeshList:vP(e.innerMeshList),drawMeshList:AP(e.drawMeshList),geoGroupList:IP(e.geoGroupList),particleList:DP(e.particleList),textMeshList:UP(e.textMeshList),borderGroupList:LP(e.borderGroupList),designMeshList:zP(e.designMeshList)}}function jP(i,e,t){if(!t)return;const{scene:r,DOM:s}=i,{modelCore:a,chartsMapCore:n}=e;(function(o,l){l&&l.forEach(c=>{const h=$0(c.type);Q3(h,c),h.target&&o.add(h.target),o.add(h)})})(r,t.lighting),function(o,l){l&&(o.progressList=l.map(c=>o.insertModel(c.rootInfo,c.group)))}(a,t.modelList),_P(r,t.innerMeshList),EP(r,t.drawMeshList),function(o,l,c){c&&(o.progressList=c.map(h=>RP(l,h)))}(n,r,t.geoGroupList),NP(r,t.borderGroupList),OP(r,s,t.particleList),kP(r,t.textMeshList),VP(i,t.designMeshList)}function WP(i,e,t){const{scene:r,DOM:s}=i,{modelCore:a,innerMeshCore:n,drawCore:o,chartsMapCore:l,borderGroupCore:c,particleCore:h,textMeshCore:u,designMeshCore:d}=e,p={灯光配置:()=>function(f,g){const m={lightList:{环境光:"AmbientLight",平行光:"DirectionalLight",点光源:"PointLight",聚光灯:"SpotLight",半球光:"HemisphereLight",平面光:"RectAreaLight"},lightType:"AmbientLight",findKey(v){return Object.keys(this.lightList).find(_=>this.lightList[_]===v)}};return g.add(m,"lightType",m.lightList).name("光源类型"),g.addFn(function(){const v=$0(m.lightType);v.target&&f.add(v.target),f.attach_add(v),w1(v,g.addFolder(m.findKey(v.type)+"-"+v.id),f.transformControls)}).name("点击添加光源"),f.children.forEach(v=>{v instanceof Qs&&w1(v,g.addFolder(m.findKey(v.type)+"-"+v.id),f.transformControls)}),g}(r,t.addCoreDragFolder("灯光配置")),模型管理:()=>function(f,g){return f.rootFolder=g,g.add(f,"url").name("模型地址"),g.addFn(()=>{const m=function(v){if(!v)return;const _=v.split(".").pop().toUpperCase();return _&&["FBX","GLB","GLTF","OBJ"].includes(_)?{url:v,type:_==="GLB"?"GLTF":_}:void 0}(f.url);m&&f.insertModel(m)}).name("添加模型"),f.scene.children.forEach(m=>{m.rootInfo&&yw(f.controls,f.transformControls,f.effectComposer,m,g.addFolder(hr(m)))}),g}(a,t.addCoreDragFolder("模型管理")),内置物体:()=>yP(n,r,t.addCoreDragFolder("内置物体")),绘制物体:()=>function(f,g,m){return m.add(f,"mode",f.modeList).name("绘制模式"),m.add(f,"pointMode",f.pointModeList).name("点模式"),m.add(f,"materialType",Yo).name("材质"),m.addFn(()=>{f.currentDrawFolder&&f.currentDrawFolder.close(),f.currentDrawFolder=m.addDateFolder(f.mode),G1(f,g,f.currentDrawFolder),f.currentDrawFolder.open()}).name("添加绘制组"),g.children.forEach(v=>v.isDrawMesh&&G1(f,g,m.addFolder(hr(v)),v.drawParams)),m}(o,r,t.addCoreDragFolder("绘制物体")),三维地图:()=>PP(l,r,t.addCoreDragFolder("三维地图")),地图边界:()=>function(f,g,m){const v=m.addFolder("列表");return v.open(),m.add(f,"url").name("边界物体数据源"),m.add(f,"materialType",Yo).name("材质类型"),m.add(f,"dlength",0).name("低于点数舍弃"),m.addFn(()=>{Rw(f.url,f.materialType,f.dlength).then(_=>{g.attach_add(_),q1(g,_,v.addFolder(hr(_)))})}).name("添加边界物体"),g.children.forEach(_=>{_.isBorderGroup&&q1(g,_,v.addFolder(hr(_)))}),m}(c,r,t.addCoreDragFolder("地图边界")),粒子物体:()=>function(f,g,m,v){const _=v.addFolder("粒子列表");_.open();const y=v.addFolder("初始化参数");return y.open(),y.add(f,"particlesSum").name("数量"),y.add(f,"inner").name("内半径"),y.add(f,"outer").name("外半径"),y.add(f,"maxVelocity").name("最大速度"),y.add(f,"mapUrl").name("贴图路径"),y.add(f,"shaderCodeName",Object.keys(kM)).name("着色器"),y.add(f,"sportType",["全随机","随机向下","随机向上","直线匀速向上","直线匀速向下"]).name("运动方式"),v.addFn(()=>{const{particlesSum:x,inner:b,outer:M,maxVelocity:T,sportType:E,mapUrl:C,shaderCodeName:N}=f,D=Pw(g,m,{particlesSum:x,inner:b,outer:M,maxVelocity:T,sportType:E,mapUrl:C,shaderCodeName:N});Y1(g,D,_.addFolder(hr(D)))}).name("增加一个粒子物体"),g.children.forEach(x=>x.isParticleMesh&&Y1(g,x,_.addFolder(hr(x)))),v}(h,r,s,t.addCoreDragFolder("粒子物体")),文本物体:()=>function(f,g,m){const v=m.addFolder("列表");return v.open(),m.add(f,"fontLink").name("字体链接"),m.add(f,"materialType",Yo).name("材质类型"),m.add(f,"text").name("文本内容"),m.addFn(()=>{f.text&&bw(f.fontLink,f.text).then(_=>{const y=Zr(f.materialType),x=new ye(_,y);x.fontLink=f.fontLink,x.text=f.text,x.isTextMesh=!0,g.attach_add(x),Z1(g,x,v.addFolder(x.text.slice(0,8)+" "+x.id))})}).name("添加文本物体"),g.children.forEach(_=>_.isTextMesh&&Z1(g,_,v.addFolder(_.text.slice(0,8)+" "+_.id))),m}(u,r,t.addCoreDragFolder("文本物体")),设计物体:()=>function(f,g,m){const{scene:v}=g,_=m.addFolder("列表");let y;m.add(f,"type",Lw.map(x=>x.name)).name("类型").onChange(x=>{y.parent.removeFolder(y),y=m.addFolder(x+"初始参数"),Q1(x,y),y.open()}),m.addFn(()=>{const x=Mh(f.type),b=Nw(x,g);b&&(v.attach_add(b),K1(b,_.addFolder(`${x.name}-${b.id}`),g))}).name("添加"),y=m.addFolder(f.type+"初始参数"),Q1(f.type,y),v.children.forEach(x=>x.isDesignMesh&&K1(x,_.addFolder(x.designType+"-"+hr(x)),g))}(d,i,t.addCoreDragFolder("设计物体"))};for(const f in p)t.add(p,f);return{folder:t,panels:p}}function J1(i,e,t){t.add(e,"name").name("名称"),t.addFn(()=>function(r,s){r.target.set(s.target.x,s.target.y,s.target.z),r.object.position.set(s.position.x,s.position.y,s.position.z),r.update()}(i,e)).name("直接查看"),t.addFn(()=>{Rr(i.target,e.target),Rr(i.object.position,e.position)}).name("动画查看"),t.addFn(()=>{const r=i.viewAngleList.indexOf(e);r!==-1&&i.viewAngleList.splice(r,1),t.parent.removeFolder(t)}).name("删除")}function XP(i,e,t){const r=function(a){a.open();const n={mode:"to",query:{duration:2,ease:"none",repeat:0,yoyo:!1}};return a.add(n,"mode",["to","from","fromTo"]).name("动画模式"),a.add(n.query,"duration",0,10).name("动画时长"),a.add(n.query,"ease",["none","power1","power2","power3","power4","back","elastic","bounce"]).name("动画缓动"),a.add(n.query,"repeat",0).name("动画重复次数"),a.add(n.query,"yoyo").name("动画循环"),n}(t.addFolder("动画属性配置"));let s=null;return t.addFn(function(){const{currentInfo:a}=i;if(!a)return;let n;i.mode=="选择"?n=a.currentModel:i.mode=="根选择"?n=a.currentRootModel:i.mode=="变换"&&(n=i.isTransformChildren?a.currentModel:a.currentRootModel),s&&t.removeFolder(s),s=t.addFolder(hr(n)+"动画配置"),e.attach(n),function(o,l,c){const h=c.addFolder("动画列表");o._transformInfo=Uo(o),o.transformAnimationList?o.transformAnimationList.forEach((u,d)=>$1(o,u,h.addFolder("动作["+Date.now()+d+"]"))):o.transformAnimationList=[],c.addFn(()=>Ud(o,o._transformInfo)).name("还原为源信息"),c.addFn(()=>o._transformInfo=Uo(o)).name("当前状态更新为源信息"),c.addFn(()=>kd(o,o._transformInfo,Uo(o),l)).name("预览动画"),c.addFn(()=>{const u=function(d,p){const{mode:f,query:g}=p;return{name:"",_transformInfo:d._transformInfo,transformInfo_:Uo(d),gsapParams:{mode:f,query:Ne({},g)}}}(o,l);o.transformAnimationList.push(u),h.open(),$1(o,u,h.addFolder("动作["+Date.now()+"]"))}).name("保存动画")}(n,r,s)}).name("加载当前物体信息"),t}function $1(i,e,t){t.add(e,"name").name("动作名");const r={play:()=>{const{gsapParams:s,_transformInfo:a,transformInfo_:n}=e;kd(i,a,n,s)},del:()=>{i.transformAnimationList.splice(i.transformAnimationList.indexOf(e),1),t.parent.removeFolder(t)}};t.add(r,"play").name("播放动作"),t.add(r,"del").name("删除动作")}function qP(i,e,t,r,s,a,n){const o={视角控制:()=>function(l,c){const h=c.addFolder("视角列表");return l.viewAngleList?l.viewAngleList.forEach((u,d)=>J1(l,u,h.addFolder((u.name||"视角")+"["+Date.now()+d+"]"))):l.viewAngleList=[],c.addFn(()=>{const u=function(d){return{name:"",target:{x:d.target.x,y:d.target.y,z:d.target.z},position:{x:d.object.position.x,y:d.object.position.y,z:d.object.position.z}}}(l);l.viewAngleList.push(u),J1(l,u,h.addFolder(u.name||"视角["+Date.now()+"]")),h.open()}).name("记录当前视角"),c}(r,n.addCoreDragFolder("视角控制")),物体动画:()=>XP(t,s,n.addCoreDragFolder("物体动画")),裁剪面板:()=>function(l,c,h,u){const d=u.addFolder("全局裁剪列表");return d.open(),u.add(h,"clipPlaneSize",0).name("裁剪辅助面大小"),u.addFn(()=>{const p=rw();sw(p,h.clipPlaneSize),b1(l,c,h,p,d.addDateFolder("面")),l.add(p.helper),c.clippingPlanes.push(p)}).name("增加全局裁剪面"),c.clippingPlanes.forEach((p,f)=>b1(l,c,h,p,d.addFolder(`面${f}`))),u}(i,e,a,n.addCoreDragFolder("裁剪面板"))};for(const l in o)n.add(o,l);return{folder:n,panels:o}}function YP(i,e){const t=yi(Ne({},HP()),{handler:{mode:"选择",openKey:!1,selectPanelEnable:!1,keyDown:null,keyDownCallback:null,modeList:["选择","根选择","变换","场景绘制","点击信息"],isTransformChildren:!1,handlerHistory:null,helpers:{axes:{showAxes:!0,axesLength:1e3,axesHelper:null},grid:{showGrid:!0,size:1e3,divisions:15,colorCenterLine:4473924,colorGrid:8947848,gridHelper:null},box3:{useBox3:!0,color:16776960}}},animateCore:{clipPlaneSize:20}}),r=function(h,u){const{scene:d,transformControls:p,effectComposer:f,stats:g,DOM:m}=h,{outlinePass:v}=f.effectPass,{handler:_}=u,{shaderLibrary:y,setObjectBlendShader:x}=t3(d,m);return j3(d,g,_,p,v),function(b,M){const{scene:T,controls:E,transformControls:C,effectComposer:N}=b,{modelCore:D}=M;fP(D,T,E,C,N)}(h,u),{shaderLibrary:y,setObjectBlendShader:x}}(i,t),s={};ex(i,t,e);const{scene:a,transformControls:n,effectComposer:o,css3DRender:l,css2DRender:c}=i;return Ne(yi(Ne(yi(Ne({},t),{addons:s}),r),{saveSceneEdit:()=>(n.detach(),o.effectPass.outlinePass.selectedObjects=[],function(h,u){const{scene:d,camera:p,renderer:f,controls:g,transformControls:m,effectComposer:v}=h,{handler:_}=u;return yi(Ne(Ne({},k3(d,p,f,g,m,v)),GP(d)),{handler:W3(_)})}(i,t)),resetEditorStorage:h=>{a.resetFrames(),a.children.filter(u=>!u.isTransformControls&&!u.isPerspectiveCamera).forEach(u=>(a.remove(u),qM(u))),a.resetEnv(),l.reset(),c.reset(),ex(i,t,h)}}),ZP(i,t))}function ex(i,e,t){if(!t)return;const{scene:r,camera:s,renderer:a,controls:n,transformControls:o,effectComposer:l,stats:c}=i,{handler:h}=e;F3(r,s,a,n,o,l,t),X3(r,o,c,h,t.handler),jP(i,e,t)}function ZP(i,e){const{scene:t,camera:r,renderer:s,controls:a,transformControls:n,effectComposer:o,stats:l}=i,{handler:c,animateCore:h}=e,u=_3();return v3(t,u),{GUI:u,openControlPanel:function(){u.__folders.场景||function(...d){const p=d3({style:"max-width: 500px;",tabButtonActiveColor:"rgba(255, 255, 255, 0.1)",tabButtonHoverColor:"none",tabButtonRowColor:"black",tabButtonBorderStyle:"none",tabButtonRowStyleOverrides:{display:"flex","justify-content":"space-evenly",color:"white","background-color":"none"},tabButtonStyleOverrides:{padding:"0.4em 0.8em",color:"#ffffff","font-size":"13px"}},d.reduce((x,b)=>(b.folder.open(),yi(Ne({},x),{[b.folder.name]:x1(b.folder.domElement)})),{})),f=Qe.state(220),g=Qe.state("auto"),m=Qe.state(window.innerWidth-220),v=Qe.state(20),_=Qe.state(!1);try{const x=localStorage.getItem("threeEditor_Panel");if(x){const b=JSON.parse(x);d.forEach((M,T)=>M.folder.closed=b.panels[T].closed),m.val=b.x,v.val=b.y}}catch{}Qe.derive(()=>{if(_.val){const x=d.map(b=>{const{parent:M}=b.folder,T=b.folder.name;return delete M.__folders[T],M.load&&M.load.folders&&M.load.folders[T]&&delete M.load.folders[T],{closed:b.folder.closed}});localStorage.setItem("threeEditor_Panel",JSON.stringify({panels:x,x:m.val,y:v.val}))}});const y=Vd(Ne({title:"3D-配置",x:m,y:v,closed:_,width:f,height:g},rh),x1({style:`
            
                border: 1px solid rgba(255, 255, 255, 0.2);
                
                border-radius: 3px;

                padding: 5px 0px 5px 0px;
            
            `},p));Qe.add(document.body,y)}(B3(t,r,s,a,n,o,u.addFolder("场景")),q3(t,n,l,c,u.addFolder("操作")),WP(i,e,u.addFolder("元素")),qP(t,s,c,a,n,h,u.addFolder("动画")))}}}function KP(){const i=new $f;i.ssrList=[],function(t){t.commonFrames=[],t.mixerFrames=[],t.shaderFrames=[],t.renderFrames=function(){t.mixerFrames.forEach(r=>r.mixerAnimateRender()),t.shaderFrames.forEach(r=>r.shaderAnimateRender()),t.commonFrames.forEach(r=>{var s;return(s=r.commonAnimateRender)==null?void 0:s.call(r)})},t.resetFrames=function(){["mixerFrames","shaderFrames","commonFrames"].forEach(r=>t[r].length=0)},t.removeFrames=function(r){(r instanceof ye||r instanceof Ei||r.instanceOf===Aa)&&["commonFrames","mixerFrames","shaderFrames"].forEach(s=>{const a=t[s].indexOf(r);a!==-1&&t[s].splice(a,1)})}}(i),function(t){t.environmentEnabled=!1,t.envBackground=null,t.envMapChangeUseList=[];let r=null;Object.defineProperty(t,"envBackground",{get:()=>r,set:s=>{r=s,t.environmentEnabled?t.environment=t.envBackground:t.environment=null,t==null||t.envMapChangeUseList.forEach(a=>a())}}),t.setSceneBackground=function(s){var a;const n=new og().load(s);t.background=n,t.backgroundUrls=s,(a=t.backgroundLoadCallback)==null||a.call(t,n)},t.setEnvBackground=function(s){const a=new og().load(s);t.envBackground=a,t.envBackgroundUrls=s},t.resetEnv=function(){var s,a;t.envMapChangeUseList=[],(s=t.envBackground)==null||s.dispose(),t.envBackground=null,(a=t.background)==null||a.dispose(),t.background=null}}(i),i.setClassifyScene=function(t="全部"){i.children.forEach(r=>{(["Group","Mesh"].includes(r.type)||r.isLight)&&(t==="全部"||t.some(s=>r.name.indexOf(s)!==-1)?r.visible=!0:r.visible=!1)})},i.attach_add=function(t){i.add(t),i.transformControls.attach(t)};const e=i.remove;return i.remove=function(t){var r;i.removeFrames(t),i.transformControls.object===t&&i.transformControls.detach(),e.call(i,t),(r=i.removeCall)==null||r.call(i,t)},i}var Tc=function(){var i=0,e=document.createElement("div");function t(h){return e.appendChild(h.dom),h}function r(h){for(var u=0;u<e.children.length;u++)e.children[u].style.display=u===h?"block":"none";i=h}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(h){h.preventDefault(),r(++i%e.children.length)},!1);var s=(performance||Date).now(),a=s,n=0,o=t(new Tc.Panel("FPS","#0ff","#002")),l=t(new Tc.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new Tc.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:t,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){n++;var h=(performance||Date).now();if(l.update(h-s,200),h>=a+1e3&&(o.update(1e3*n/(h-a),100),a=h,n=0,c)){var u=performance.memory;c.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return h},update:function(){s=this.end()},domElement:e,setMode:r}};Tc.Panel=function(i,e,t){var r=1/0,s=0,a=Math.round,n=a(window.devicePixelRatio||1),o=80*n,l=48*n,c=3*n,h=2*n,u=3*n,d=15*n,p=74*n,f=30*n,g=document.createElement("canvas");g.width=o,g.height=l,g.style.cssText="width:80px;height:48px";var m=g.getContext("2d");return m.font="bold "+9*n+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=t,m.fillRect(0,0,o,l),m.fillStyle=e,m.fillText(i,c,h),m.fillRect(u,d,p,f),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(u,d,p,f),{dom:g,update:function(v,_){r=Math.min(r,v),s=Math.max(s,v),m.fillStyle=t,m.globalAlpha=1,m.fillRect(0,0,o,d),m.fillStyle=e,m.fillText(a(v)+" "+i+" ("+a(r)+"-"+a(s)+")",c,h),m.drawImage(g,u+n,d,p-n,f,u,d,p-n,f),m.fillRect(u+p-n,d,n,f),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(u+p-n,d,n,a((1-v/_)*f))}}};const tx={type:"change"},mf={type:"start"},ix={type:"end"},Gu=new Zn,rx=new jr,QP=Math.cos(70*ui.DEG2RAD);class JP extends ys{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new R,this.cursor=new R,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:mn.ROTATE,MIDDLE:mn.DOLLY,RIGHT:mn.PAN},this.touches={ONE:fn.ROTATE,TWO:fn.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(I){I.addEventListener("keydown",S),this._domElementKeyEvents=I},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",S),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(tx),r.update(),a=s.NONE},this.update=function(){const I=new R,V=new it().setFromUnitVectors(e.up,new R(0,1,0)),Y=V.clone().invert(),q=new R,pe=new it,_e=new R,le=2*Math.PI;return function(xe=null){const Pe=r.object.position;I.copy(Pe).sub(r.target),I.applyQuaternion(V),o.setFromVector3(I),r.autoRotate&&a===s.NONE&&D(function(ke){return ke!==null?2*Math.PI/60*r.autoRotateSpeed*ke:2*Math.PI/60/60*r.autoRotateSpeed}(xe)),r.enableDamping?(o.theta+=l.theta*r.dampingFactor,o.phi+=l.phi*r.dampingFactor):(o.theta+=l.theta,o.phi+=l.phi);let Re=r.minAzimuthAngle,Ee=r.maxAzimuthAngle;isFinite(Re)&&isFinite(Ee)&&(Re<-Math.PI?Re+=le:Re>Math.PI&&(Re-=le),Ee<-Math.PI?Ee+=le:Ee>Math.PI&&(Ee-=le),o.theta=Re<=Ee?Math.max(Re,Math.min(Ee,o.theta)):o.theta>(Re+Ee)/2?Math.max(Re,o.theta):Math.min(Ee,o.theta)),o.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,o.phi)),o.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(h,r.dampingFactor):r.target.add(h),r.target.sub(r.cursor),r.target.clampLength(r.minTargetRadius,r.maxTargetRadius),r.target.add(r.cursor);let $e=!1;if(r.zoomToCursor&&M||r.object.isOrthographicCamera)o.radius=se(o.radius);else{const ke=o.radius;o.radius=se(o.radius*c),$e=ke!=o.radius}if(I.setFromSpherical(o),I.applyQuaternion(Y),Pe.copy(r.target).add(I),r.object.lookAt(r.target),r.enableDamping===!0?(l.theta*=1-r.dampingFactor,l.phi*=1-r.dampingFactor,h.multiplyScalar(1-r.dampingFactor)):(l.set(0,0,0),h.set(0,0,0)),r.zoomToCursor&&M){let ke=null;if(r.object.isPerspectiveCamera){const vt=I.length();ke=se(vt*c);const st=vt-ke;r.object.position.addScaledVector(x,st),r.object.updateMatrixWorld(),$e=!!st}else if(r.object.isOrthographicCamera){const vt=new R(b.x,b.y,0);vt.unproject(r.object);const st=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/c)),r.object.updateProjectionMatrix(),$e=st!==r.object.zoom;const qi=new R(b.x,b.y,0);qi.unproject(r.object),r.object.position.sub(qi).add(vt),r.object.updateMatrixWorld(),ke=I.length()}else r.zoomToCursor=!1;ke!==null&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(ke).add(r.object.position):(Gu.origin.copy(r.object.position),Gu.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(Gu.direction))<QP?e.lookAt(r.target):(rx.setFromNormalAndCoplanarPoint(r.object.up,r.target),Gu.intersectPlane(rx,r.target))))}else if(r.object.isOrthographicCamera){const ke=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/c)),ke!==r.object.zoom&&(r.object.updateProjectionMatrix(),$e=!0)}return c=1,M=!1,!!($e||q.distanceToSquared(r.object.position)>n||8*(1-pe.dot(r.object.quaternion))>n||_e.distanceToSquared(r.target)>n)&&(r.dispatchEvent(tx),q.copy(r.object.position),pe.copy(r.object.quaternion),_e.copy(r.target),!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",X),r.domElement.removeEventListener("pointerdown",re),r.domElement.removeEventListener("pointercancel",Q),r.domElement.removeEventListener("wheel",O),r.domElement.removeEventListener("pointermove",j),r.domElement.removeEventListener("pointerup",Q),r.domElement.getRootNode().removeEventListener("keydown",J,{capture:!0}),r._domElementKeyEvents!==null&&(r._domElementKeyEvents.removeEventListener("keydown",S),r._domElementKeyEvents=null)};const r=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=s.NONE;const n=1e-6,o=new ug,l=new ug;let c=1;const h=new R,u=new ne,d=new ne,p=new ne,f=new ne,g=new ne,m=new ne,v=new ne,_=new ne,y=new ne,x=new R,b=new ne;let M=!1;const T=[],E={};let C=!1;function N(I){const V=Math.abs(.01*I);return Math.pow(.95,r.zoomSpeed*V)}function D(I){l.theta-=I}function A(I){l.phi-=I}const L=function(){const I=new R;return function(V,Y){I.setFromMatrixColumn(Y,0),I.multiplyScalar(-V),h.add(I)}}(),w=function(){const I=new R;return function(V,Y){r.screenSpacePanning===!0?I.setFromMatrixColumn(Y,1):(I.setFromMatrixColumn(Y,0),I.crossVectors(r.object.up,I)),I.multiplyScalar(V),h.add(I)}}(),B=function(){const I=new R;return function(V,Y){const q=r.domElement;if(r.object.isPerspectiveCamera){const pe=r.object.position;I.copy(pe).sub(r.target);let _e=I.length();_e*=Math.tan(r.object.fov/2*Math.PI/180),L(2*V*_e/q.clientHeight,r.object.matrix),w(2*Y*_e/q.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(L(V*(r.object.right-r.object.left)/r.object.zoom/q.clientWidth,r.object.matrix),w(Y*(r.object.top-r.object.bottom)/r.object.zoom/q.clientHeight,r.object.matrix)):r.enablePan=!1}}();function $(I){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?c/=I:r.enableZoom=!1}function K(I){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?c*=I:r.enableZoom=!1}function ae(I,V){if(!r.zoomToCursor)return;M=!0;const Y=r.domElement.getBoundingClientRect(),q=I-Y.left,pe=V-Y.top,_e=Y.width,le=Y.height;b.x=q/_e*2-1,b.y=-pe/le*2+1,x.set(b.x,b.y,1).unproject(r.object).sub(r.object.position).normalize()}function se(I){return Math.max(r.minDistance,Math.min(r.maxDistance,I))}function me(I){u.set(I.clientX,I.clientY)}function H(I){f.set(I.clientX,I.clientY)}function W(I){if(T.length===1)u.set(I.pageX,I.pageY);else{const V=P(I),Y=.5*(I.pageX+V.x),q=.5*(I.pageY+V.y);u.set(Y,q)}}function ce(I){if(T.length===1)f.set(I.pageX,I.pageY);else{const V=P(I),Y=.5*(I.pageX+V.x),q=.5*(I.pageY+V.y);f.set(Y,q)}}function te(I){const V=P(I),Y=I.pageX-V.x,q=I.pageY-V.y,pe=Math.sqrt(Y*Y+q*q);v.set(0,pe)}function k(I){if(T.length==1)d.set(I.pageX,I.pageY);else{const Y=P(I),q=.5*(I.pageX+Y.x),pe=.5*(I.pageY+Y.y);d.set(q,pe)}p.subVectors(d,u).multiplyScalar(r.rotateSpeed);const V=r.domElement;D(2*Math.PI*p.x/V.clientHeight),A(2*Math.PI*p.y/V.clientHeight),u.copy(d)}function z(I){if(T.length===1)g.set(I.pageX,I.pageY);else{const V=P(I),Y=.5*(I.pageX+V.x),q=.5*(I.pageY+V.y);g.set(Y,q)}m.subVectors(g,f).multiplyScalar(r.panSpeed),B(m.x,m.y),f.copy(g)}function ee(I){const V=P(I),Y=I.pageX-V.x,q=I.pageY-V.y,pe=Math.sqrt(Y*Y+q*q);_.set(0,pe),y.set(0,Math.pow(_.y/v.y,r.zoomSpeed)),$(y.y),v.copy(_),ae(.5*(I.pageX+V.x),.5*(I.pageY+V.y))}function re(I){r.enabled!==!1&&(T.length===0&&(r.domElement.setPointerCapture(I.pointerId),r.domElement.addEventListener("pointermove",j),r.domElement.addEventListener("pointerup",Q)),function(V){for(let Y=0;Y<T.length;Y++)if(T[Y]==V.pointerId)return!0;return!1}(I)||(function(V){T.push(V.pointerId)}(I),I.pointerType==="touch"?F(I):function(V){let Y;switch(V.button){case 0:Y=r.mouseButtons.LEFT;break;case 1:Y=r.mouseButtons.MIDDLE;break;case 2:Y=r.mouseButtons.RIGHT;break;default:Y=-1}switch(Y){case mn.DOLLY:if(r.enableZoom===!1)return;(function(q){ae(q.clientX,q.clientX),v.set(q.clientX,q.clientY)})(V),a=s.DOLLY;break;case mn.ROTATE:if(V.ctrlKey||V.metaKey||V.shiftKey){if(r.enablePan===!1)return;H(V),a=s.PAN}else{if(r.enableRotate===!1)return;me(V),a=s.ROTATE}break;case mn.PAN:if(V.ctrlKey||V.metaKey||V.shiftKey){if(r.enableRotate===!1)return;me(V),a=s.ROTATE}else{if(r.enablePan===!1)return;H(V),a=s.PAN}break;default:a=s.NONE}a!==s.NONE&&r.dispatchEvent(mf)}(I)))}function j(I){r.enabled!==!1&&(I.pointerType==="touch"?function(V){switch(U(V),a){case s.TOUCH_ROTATE:if(r.enableRotate===!1)return;k(V),r.update();break;case s.TOUCH_PAN:if(r.enablePan===!1)return;z(V),r.update();break;case s.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;(function(Y){r.enableZoom&&ee(Y),r.enablePan&&z(Y)})(V),r.update();break;case s.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;(function(Y){r.enableZoom&&ee(Y),r.enableRotate&&k(Y)})(V),r.update();break;default:a=s.NONE}}(I):function(V){switch(a){case s.ROTATE:if(r.enableRotate===!1)return;(function(Y){d.set(Y.clientX,Y.clientY),p.subVectors(d,u).multiplyScalar(r.rotateSpeed);const q=r.domElement;D(2*Math.PI*p.x/q.clientHeight),A(2*Math.PI*p.y/q.clientHeight),u.copy(d),r.update()})(V);break;case s.DOLLY:if(r.enableZoom===!1)return;(function(Y){_.set(Y.clientX,Y.clientY),y.subVectors(_,v),y.y>0?$(N(y.y)):y.y<0&&K(N(y.y)),v.copy(_),r.update()})(V);break;case s.PAN:if(r.enablePan===!1)return;(function(Y){g.set(Y.clientX,Y.clientY),m.subVectors(g,f).multiplyScalar(r.panSpeed),B(m.x,m.y),f.copy(g),r.update()})(V)}}(I))}function Q(I){switch(function(V){delete E[V.pointerId];for(let Y=0;Y<T.length;Y++)if(T[Y]==V.pointerId)return void T.splice(Y,1)}(I),T.length){case 0:r.domElement.releasePointerCapture(I.pointerId),r.domElement.removeEventListener("pointermove",j),r.domElement.removeEventListener("pointerup",Q),r.dispatchEvent(ix),a=s.NONE;break;case 1:const V=T[0],Y=E[V];F({pointerId:V,pageX:Y.x,pageY:Y.y})}}function O(I){r.enabled!==!1&&r.enableZoom!==!1&&a===s.NONE&&(I.preventDefault(),r.dispatchEvent(mf),function(V){ae(V.clientX,V.clientY),V.deltaY<0?K(N(V.deltaY)):V.deltaY>0&&$(N(V.deltaY)),r.update()}(function(V){const Y=V.deltaMode,q={clientX:V.clientX,clientY:V.clientY,deltaY:V.deltaY};switch(Y){case 1:q.deltaY*=16;break;case 2:q.deltaY*=100}return V.ctrlKey&&!C&&(q.deltaY*=10),q}(I)),r.dispatchEvent(ix))}function J(I){I.key==="Control"&&(C=!0,r.domElement.getRootNode().addEventListener("keyup",Z,{passive:!0,capture:!0}))}function Z(I){I.key==="Control"&&(C=!1,r.domElement.getRootNode().removeEventListener("keyup",Z,{passive:!0,capture:!0}))}function S(I){r.enabled!==!1&&r.enablePan!==!1&&function(V){let Y=!1;switch(V.code){case r.keys.UP:V.ctrlKey||V.metaKey||V.shiftKey?A(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):B(0,r.keyPanSpeed),Y=!0;break;case r.keys.BOTTOM:V.ctrlKey||V.metaKey||V.shiftKey?A(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):B(0,-r.keyPanSpeed),Y=!0;break;case r.keys.LEFT:V.ctrlKey||V.metaKey||V.shiftKey?D(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):B(r.keyPanSpeed,0),Y=!0;break;case r.keys.RIGHT:V.ctrlKey||V.metaKey||V.shiftKey?D(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):B(-r.keyPanSpeed,0),Y=!0}Y&&(V.preventDefault(),r.update())}(I)}function F(I){switch(U(I),T.length){case 1:switch(r.touches.ONE){case fn.ROTATE:if(r.enableRotate===!1)return;W(I),a=s.TOUCH_ROTATE;break;case fn.PAN:if(r.enablePan===!1)return;ce(I),a=s.TOUCH_PAN;break;default:a=s.NONE}break;case 2:switch(r.touches.TWO){case fn.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;(function(V){r.enableZoom&&te(V),r.enablePan&&ce(V)})(I),a=s.TOUCH_DOLLY_PAN;break;case fn.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;(function(V){r.enableZoom&&te(V),r.enableRotate&&W(V)})(I),a=s.TOUCH_DOLLY_ROTATE;break;default:a=s.NONE}break;default:a=s.NONE}a!==s.NONE&&r.dispatchEvent(mf)}function X(I){r.enabled!==!1&&I.preventDefault()}function U(I){let V=E[I.pointerId];V===void 0&&(V=new ne,E[I.pointerId]=V),V.set(I.pageX,I.pageY)}function P(I){const V=I.pointerId===T[0]?T[1]:T[0];return E[V]}r.domElement.addEventListener("contextmenu",X),r.domElement.addEventListener("pointerdown",re),r.domElement.addEventListener("pointercancel",Q),r.domElement.addEventListener("wheel",O,{passive:!1}),r.domElement.getRootNode().addEventListener("keydown",J,{passive:!0,capture:!0}),this.update()}}const pn=new Mp,Ii=new R,ua=new R,Ct=new it,sx={X:new R(1,0,0),Y:new R(0,1,0),Z:new R(0,0,1)},ff={type:"change"},ax={type:"mouseDown",mode:null},nx={type:"mouseUp",mode:null},ox={type:"objectChange"};class $P extends je{constructor(e,t){super(),t===void 0&&(t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const r=new aI;this._gizmo=r,this.add(r);const s=new nI;this._plane=s,this.add(s);const a=this;function n(v,_){let y=_;Object.defineProperty(a,v,{get:function(){return y!==void 0?y:_},set:function(x){y!==x&&(y=x,s[v]=x,r[v]=x,a.dispatchEvent({type:v+"-changed",value:x}),a.dispatchEvent(ff))}}),a[v]=_,s[v]=_,r[v]=_}n("camera",e),n("object",void 0),n("enabled",!0),n("axis",null),n("mode","translate"),n("translationSnap",null),n("rotationSnap",null),n("scaleSnap",null),n("space","world"),n("size",1),n("dragging",!1),n("showX",!0),n("showY",!0),n("showZ",!0);const o=new R,l=new R,c=new it,h=new it,u=new R,d=new it,p=new R,f=new R,g=new R,m=new R;n("worldPosition",o),n("worldPositionStart",l),n("worldQuaternion",c),n("worldQuaternionStart",h),n("cameraPosition",u),n("cameraQuaternion",d),n("pointStart",p),n("pointEnd",f),n("rotationAxis",g),n("rotationAngle",0),n("eye",m),this._offset=new R,this._startNorm=new R,this._endNorm=new R,this._cameraScale=new R,this._parentPosition=new R,this._parentQuaternion=new it,this._parentQuaternionInv=new it,this._parentScale=new R,this._worldScaleStart=new R,this._worldQuaternionInv=new it,this._worldScale=new R,this._positionStart=new R,this._quaternionStart=new it,this._scaleStart=new R,this._getPointer=eI.bind(this),this._onPointerDown=iI.bind(this),this._onPointerHover=tI.bind(this),this._onPointerMove=rI.bind(this),this._onPointerUp=sI.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(e){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null||this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(e)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&pn.setFromCamera(e,this.camera);const t=gf(this._gizmo.picker[this.mode],pn);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&(e==null||e.button===0)&&this.axis!==null){e!==null&&pn.setFromCamera(e,this.camera);const t=gf(this._plane,pn,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,ax.mode=this.mode,this.dispatchEvent(ax)}}pointerMove(e){const t=this.axis,r=this.mode,s=this.object;let a=this.space;if(r==="scale"?a="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(a="world"),s===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&pn.setFromCamera(e,this.camera);const n=gf(this._plane,pn,!0);if(n){if(this.pointEnd.copy(n.point).sub(this.worldPositionStart),r==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(s.position.applyQuaternion(Ct.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),a==="world"&&(s.parent&&s.position.add(Ii.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Ii.setFromMatrixPosition(s.parent.matrixWorld))));else if(r==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),ua.set(o,o,o)}else Ii.copy(this.pointStart),ua.copy(this.pointEnd),Ii.applyQuaternion(this._worldQuaternionInv),ua.applyQuaternion(this._worldQuaternionInv),ua.divide(Ii),t.search("X")===-1&&(ua.x=1),t.search("Y")===-1&&(ua.y=1),t.search("Z")===-1&&(ua.z=1);s.scale.copy(this._scaleStart).multiply(ua),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(r==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Ii.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ii.copy(this.rotationAxis).cross(this.eye))*o):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(sx[t]),Ii.copy(sx[t]),a==="local"&&Ii.applyQuaternion(this.worldQuaternion),Ii.cross(this.eye),Ii.length()===0?l=!0:this.rotationAngle=this._offset.dot(Ii.normalize())*o),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(Ct.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(Ct.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ff),this.dispatchEvent(ox)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(nx.mode=this.mode,this.dispatchEvent(nx)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ff),this.dispatchEvent(ox),this.pointStart.copy(this.pointEnd))}getRaycaster(){return pn}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function eI(i){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:i.button};{const e=this.domElement.getBoundingClientRect();return{x:(i.clientX-e.left)/e.width*2-1,y:-(i.clientY-e.top)/e.height*2+1,button:i.button}}}function tI(i){if(this.enabled)switch(i.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(i))}}function iI(i){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(i)),this.pointerDown(this._getPointer(i)))}function rI(i){this.enabled&&this.pointerMove(this._getPointer(i))}function sI(i){this.enabled&&(this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(i)))}function gf(i,e,t){const r=e.intersectObject(i,!0);for(let s=0;s<r.length;s++)if(r[s].object.visible||t)return r[s];return!1}const ju=new Rt,yt=new R(0,1,0),lx=new R(0,0,0),cx=new Me,Wu=new it,dd=new it,ns=new R,hx=new Me,hc=new R(1,0,0),yn=new R(0,1,0),uc=new R(0,0,1),Xu=new R,ec=new R,tc=new R;class aI extends je{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new ei({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Yt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const s=t.clone();s.opacity=.5;const a=e.clone();a.color.setHex(16711680);const n=e.clone();n.color.setHex(65280);const o=e.clone();o.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const u=e.clone();u.opacity=.25;const d=e.clone();d.color.setHex(16776960),d.opacity=.25,e.clone().color.setHex(16776960);const p=e.clone();p.color.setHex(7895160);const f=new zt(0,.04,.1,12);f.translate(0,.05,0);const g=new Ot(.08,.08,.08);g.translate(0,.04,0);const m=new Oe;m.setAttribute("position",new Se([0,0,0,1,0,0],3));const v=new zt(.0075,.0075,.5,3);function _(L,w){const B=new hs(L,.0075,3,64,w*Math.PI*2);return B.rotateY(Math.PI/2),B.rotateX(Math.PI/2),B}v.translate(0,.25,0);const y={X:[[new ye(f,a),[.5,0,0],[0,0,-Math.PI/2]],[new ye(f,a),[-.5,0,0],[0,0,Math.PI/2]],[new ye(v,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new ye(f,n),[0,.5,0]],[new ye(f,n),[0,-.5,0],[Math.PI,0,0]],[new ye(v,n)]],Z:[[new ye(f,o),[0,0,.5],[Math.PI/2,0,0]],[new ye(f,o),[0,0,-.5],[-Math.PI/2,0,0]],[new ye(v,o),null,[Math.PI/2,0,0]]],XYZ:[[new ye(new zs(.1,0),u.clone()),[0,0,0]]],XY:[[new ye(new Ot(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new ye(new Ot(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Ot(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},x={X:[[new ye(new zt(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new zt(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new zt(.2,0,.6,4),r),[0,.3,0]],[new ye(new zt(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new zt(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new ye(new zt(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new ye(new zs(.2,0),r)]],XY:[[new ye(new Ot(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new ye(new Ot(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Ot(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},b={START:[[new ye(new zs(.01,2),s),null,null,null,"helper"]],END:[[new ye(new zs(.01,2),s),null,null,null,"helper"]],DELTA:[[new vi(function(){const L=new Oe;return L.setAttribute("position",new Se([0,0,0,1,1,1],3)),L}(),s),null,null,null,"helper"]],X:[[new vi(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new vi(m,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new vi(m,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new ye(_(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new ye(_(.5,.5),a)]],Y:[[new ye(_(.5,.5),n),null,[0,0,-Math.PI/2]]],Z:[[new ye(_(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new ye(_(.75,1),d),null,[0,Math.PI/2,0]]]},T={AXIS:[[new vi(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},E={XYZE:[[new ye(new Wn(.25,10,8),r)]],X:[[new ye(new hs(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ye(new hs(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ye(new hs(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ye(new hs(.75,.1,2,24),r)]]},C={X:[[new ye(g,a),[.5,0,0],[0,0,-Math.PI/2]],[new ye(v,a),[0,0,0],[0,0,-Math.PI/2]],[new ye(g,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new ye(g,n),[0,.5,0]],[new ye(v,n)],[new ye(g,n),[0,-.5,0],[0,0,Math.PI]]],Z:[[new ye(g,o),[0,0,.5],[Math.PI/2,0,0]],[new ye(v,o),[0,0,0],[Math.PI/2,0,0]],[new ye(g,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new ye(new Ot(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new ye(new Ot(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Ot(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new Ot(.1,.1,.1),u.clone())]]},N={X:[[new ye(new zt(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new zt(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new zt(.2,0,.6,4),r),[0,.3,0]],[new ye(new zt(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new zt(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new ye(new zt(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new ye(new Ot(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new ye(new Ot(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Ot(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new Ot(.2,.2,.2),r),[0,0,0]]]},D={X:[[new vi(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new vi(m,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new vi(m,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function A(L){const w=new je;for(const B in L)for(let $=L[B].length;$--;){const K=L[B][$][0].clone(),ae=L[B][$][1],se=L[B][$][2],me=L[B][$][3],H=L[B][$][4];K.name=B,K.tag=H,ae&&K.position.set(ae[0],ae[1],ae[2]),se&&K.rotation.set(se[0],se[1],se[2]),me&&K.scale.set(me[0],me[1],me[2]),K.updateMatrix();const W=K.geometry.clone();W.applyMatrix4(K.matrix),K.geometry=W,K.renderOrder=1/0,K.position.set(0,0,0),K.rotation.set(0,0,0),K.scale.set(1,1,1),w.add(K)}return w}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=A(y)),this.add(this.gizmo.rotate=A(M)),this.add(this.gizmo.scale=A(C)),this.add(this.picker.translate=A(x)),this.add(this.picker.rotate=A(E)),this.add(this.picker.scale=A(N)),this.add(this.helper.translate=A(b)),this.add(this.helper.rotate=A(T)),this.add(this.helper.scale=A(D)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:dd;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let s=0;s<r.length;s++){const a=r[s];let n;a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition),n=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(n*this.size/4),a.tag!=="helper"?(a.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(a.name==="X"&&Math.abs(yt.copy(hc).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Y"&&Math.abs(yt.copy(yn).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Z"&&Math.abs(yt.copy(uc).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XY"&&Math.abs(yt.copy(uc).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="YZ"&&Math.abs(yt.copy(hc).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XZ"&&Math.abs(yt.copy(yn).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1)):this.mode==="rotate"&&(Wu.copy(t),yt.copy(this.eye).applyQuaternion(Ct.copy(t).invert()),a.name.search("E")!==-1&&a.quaternion.setFromRotationMatrix(cx.lookAt(this.eye,lx,yn)),a.name==="X"&&(Ct.setFromAxisAngle(hc,Math.atan2(-yt.y,yt.z)),Ct.multiplyQuaternions(Wu,Ct),a.quaternion.copy(Ct)),a.name==="Y"&&(Ct.setFromAxisAngle(yn,Math.atan2(yt.x,yt.z)),Ct.multiplyQuaternions(Wu,Ct),a.quaternion.copy(Ct)),a.name==="Z"&&(Ct.setFromAxisAngle(uc,Math.atan2(yt.y,yt.x)),Ct.multiplyQuaternions(Wu,Ct),a.quaternion.copy(Ct))),a.visible=a.visible&&(a.name.indexOf("X")===-1||this.showX),a.visible=a.visible&&(a.name.indexOf("Y")===-1||this.showY),a.visible=a.visible&&(a.name.indexOf("Z")===-1||this.showZ),a.visible=a.visible&&(a.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),a.material._color=a.material._color||a.material.color.clone(),a.material._opacity=a.material._opacity||a.material.opacity,a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled&&this.axis&&(a.name===this.axis||this.axis.split("").some(function(o){return a.name===o}))&&(a.material.color.setHex(16776960),a.material.opacity=1)):(a.visible=!1,a.name==="AXIS"?(a.visible=!!this.axis,this.axis==="X"&&(Ct.setFromEuler(ju.set(0,0,0)),a.quaternion.copy(t).multiply(Ct),Math.abs(yt.copy(hc).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Y"&&(Ct.setFromEuler(ju.set(0,0,Math.PI/2)),a.quaternion.copy(t).multiply(Ct),Math.abs(yt.copy(yn).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Z"&&(Ct.setFromEuler(ju.set(0,Math.PI/2,0)),a.quaternion.copy(t).multiply(Ct),Math.abs(yt.copy(uc).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="XYZE"&&(Ct.setFromEuler(ju.set(0,Math.PI/2,0)),yt.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(cx.lookAt(lx,yt,yn)),a.quaternion.multiply(Ct),a.visible=this.dragging),this.axis==="E"&&(a.visible=!1)):a.name==="START"?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):a.name==="END"?(a.position.copy(this.worldPosition),a.visible=this.dragging):a.name==="DELTA"?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),Ii.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ii.applyQuaternion(this.worldQuaternionStart.clone().invert()),a.scale.copy(Ii),a.visible=this.dragging):(a.quaternion.copy(t),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=this.axis.search(a.name)!==-1)))}super.updateMatrixWorld(e)}}class nI extends ye{constructor(){super(new ws(1e5,1e5,2,2),new ei({visible:!1,wireframe:!0,side:It,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Xu.copy(hc).applyQuaternion(t==="local"?this.worldQuaternion:dd),ec.copy(yn).applyQuaternion(t==="local"?this.worldQuaternion:dd),tc.copy(uc).applyQuaternion(t==="local"?this.worldQuaternion:dd),yt.copy(ec),this.mode){case"translate":case"scale":switch(this.axis){case"X":yt.copy(this.eye).cross(Xu),ns.copy(Xu).cross(yt);break;case"Y":yt.copy(this.eye).cross(ec),ns.copy(ec).cross(yt);break;case"Z":yt.copy(this.eye).cross(tc),ns.copy(tc).cross(yt);break;case"XY":ns.copy(tc);break;case"YZ":ns.copy(Xu);break;case"XZ":yt.copy(tc),ns.copy(ec);break;case"XYZ":case"E":ns.set(0,0,0)}break;default:ns.set(0,0,0)}ns.length()===0?this.quaternion.copy(this.cameraQuaternion):(hx.lookAt(Ii.set(0,0,0),ns,yt),this.quaternion.setFromRotationMatrix(hx)),super.updateMatrixWorld(e)}}const Gs={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class $s{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}dispose(){}}const oI=new Gn(-1,1,1,-1,0,1),lI=new class extends Oe{constructor(){super(),this.setAttribute("position",new Se([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Se([0,2,0,0,2,0],2))}};class wl{constructor(e){this._mesh=new ye(lI,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,oI)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class av extends $s{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof ct?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=ai.clone(e.uniforms),this.material=new ct({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new wl(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class ux extends $s{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const s=e.getContext(),a=e.state;let n,o;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(n=0,o=1):(n=1,o=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.buffers.stencil.setFunc(s.ALWAYS,n,4294967295),a.buffers.stencil.setClear(o),a.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.color.setMask(!0),a.buffers.depth.setMask(!0),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(s.EQUAL,1,4294967295),a.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.buffers.stencil.setLocked(!0)}}class cI extends $s{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class hI{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new ne);this._width=r.width,this._height=r.height,(t=new ft(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Qt})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new av(Gs),this.copyPass.material.blending=0,this.clock=new zc}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let s=0,a=this.passes.length;s<a;s++){const n=this.passes[s];if(n.enabled!==!1){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),n.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),n.needsSwap){if(r){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}ux!==void 0&&(n instanceof ux?r=!0:n instanceof cI&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new ne);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(r,s),this.renderTarget2.setSize(r,s);for(let a=0;a<this.passes.length;a++)this.passes[a].setSize(r,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class uI extends $s{constructor(e,t,r=null,s=null,a=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=s,this.clearAlpha=a,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new fe}render(e,t,r){const s=e.autoClear;let a,n;e.autoClear=!1,this.overrideMaterial!==null&&(n=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(a=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==1&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(a),this.overrideMaterial!==null&&(this.scene.overrideMaterial=n),e.autoClear=s}}class Ta extends $s{constructor(e,t,r,s){super(),this.renderScene=t,this.renderCamera=r,this.selectedObjects=s!==void 0?s:[],this.visibleEdgeColor=new fe(1,1,1),this.hiddenEdgeColor=new fe(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=e!==void 0?new ne(e.x,e.y):new ne(256,256);const a=Math.round(this.resolution.x/this.downSampleRatio),n=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new ft(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new up,this.depthMaterial.side=It,this.depthMaterial.depthPacking=t0,this.depthMaterial.blending=0,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=It,this.prepareMaskMaterial.fragmentShader=function(l,c){const h=c.isPerspectiveCamera?"perspective":"orthographic";return l.replace(/DEPTH_TO_VIEW_Z/g,h+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new ft(this.resolution.x,this.resolution.y,{type:Qt}),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new ft(a,n,{type:Qt}),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new ft(a,n,{type:Qt}),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new ft(Math.round(a/2),Math.round(n/2),{type:Qt}),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new ft(a,n,{type:Qt}),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new ft(Math.round(a/2),Math.round(n/2),{type:Qt}),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(a,n),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(a/2),Math.round(n/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();const o=Gs;this.copyUniforms=ai.clone(o.uniforms),this.materialCopy=new ct({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:0,depthTest:!1,depthWrite:!1}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new fe,this.oldClearAlpha=1,this.fsQuad=new wl(null),this.tempPulseColor1=new fe,this.tempPulseColor2=new fe,this.textureMatrix=new Me}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let r=Math.round(e/this.downSampleRatio),s=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,s),this.renderTargetBlurBuffer1.setSize(r,s),this.renderTargetEdgeBuffer1.setSize(r,s),this.separableBlurMaterial1.uniforms.texSize.value.set(r,s),r=Math.round(r/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(r,s),this.renderTargetEdgeBuffer2.setSize(r,s),this.separableBlurMaterial2.uniforms.texSize.value.set(r,s)}changeVisibilityOfSelectedObjects(e){const t=this._visibilityCache;function r(s){s.isMesh&&(e===!0?s.visible=t.get(s):(t.set(s,s.visible),s.visible=e))}for(let s=0;s<this.selectedObjects.length;s++)this.selectedObjects[s].traverse(r)}changeVisibilityOfNonSelectedObjects(e){const t=this._visibilityCache,r=[];function s(a){a.isMesh&&r.push(a)}for(let a=0;a<this.selectedObjects.length;a++)this.selectedObjects[a].traverse(s);this.renderScene.traverse(function(a){if(a.isMesh||a.isSprite){let n=!1;for(let o=0;o<r.length;o++)if(r[o].id===a.id){n=!0;break}if(n===!1){const o=a.visible;e!==!1&&t.get(a)!==!0||(a.visible=e),t.set(a,o)}}else(a.isPoints||a.isLine)&&(e===!0?a.visible=t.get(a):(t.set(a,a.visible),a.visible=e))})}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,r,s,a){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const n=e.autoClear;e.autoClear=!1,a&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const l=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ta.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ta.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Ta.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Ta.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,a&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new ct({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new ne(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif
					
					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new ct({uniforms:{maskTexture:{value:null},texSize:{value:new ne(.5,.5)},visibleEdgeColor:{value:new R(1,1,1)},hiddenEdgeColor:{value:new R(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new ct({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new ne(.5,.5)},direction:{value:new ne(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new ct({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:js,depthTest:!1,depthWrite:!1,transparent:!0})}}Ta.BlurDirectionX=new ne(1,0),Ta.BlurDirectionY=new ne(0,1);const dI={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = OptimizedCineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class pI extends $s{constructor(){super();const e=dI;this.uniforms=ai.clone(e.uniforms),this.material=new m0({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new wl(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,this._outputColorSpace===e.outputColorSpace&&this._toneMapping===e.toneMapping||(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},ht.getTransfer(this._outputColorSpace)===St&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===$d?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===ep?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===tp?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===ip?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===rp?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===jg&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const mI={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new fe(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class _l extends $s{constructor(e,t,r,s){super(),this.strength=t!==void 0?t:1,this.radius=r,this.threshold=s,this.resolution=e!==void 0?new ne(e.x,e.y):new ne(256,256),this.clearColor=new fe(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);this.renderTargetBright=new ft(a,n,{type:Qt}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let h=0;h<this.nMips;h++){const u=new ft(a,n,{type:Qt});u.texture.name="UnrealBloomPass.h"+h,u.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(u);const d=new ft(a,n,{type:Qt});d.texture.name="UnrealBloomPass.v"+h,d.texture.generateMipmaps=!1,this.renderTargetsVertical.push(d),a=Math.round(a/2),n=Math.round(n/2)}const o=mI;this.highPassUniforms=ai.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ct({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),this.separableBlurMaterials=[];const l=[3,5,7,9,11];a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);for(let h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[h])),this.separableBlurMaterials[h].uniforms.invSize.value=new ne(1/a,1/n),a=Math.round(a/2),n=Math.round(n/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new R(1,1,1),new R(1,1,1),new R(1,1,1),new R(1,1,1),new R(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const c=Gs;this.copyUniforms=ai.clone(c.uniforms),this.blendMaterial=new ct({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:js,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new fe,this.oldClearAlpha=1,this.basic=new ei,this.fsQuad=new wl(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let r=Math.round(e/2),s=Math.round(t/2);this.renderTargetBright.setSize(r,s);for(let a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(r,s),this.renderTargetsVertical[a].setSize(r,s),this.separableBlurMaterials[a].uniforms.invSize.value=new ne(1/r,1/s),r=Math.round(r/2),s=Math.round(s/2)}render(e,t,r,s,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const n=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let o=this.renderTargetBright;for(let l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[l].uniforms.direction.value=_l.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=_l.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}getSeperableBlurMaterial(e){const t=[];for(let r=0;r<e;r++)t.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return new ct({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new ne(.5,.5)},direction:{value:new ne(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new ct({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}_l.BlurDirectionX=new ne(1,0),_l.BlurDirectionY=new ne(0,1);class fI extends av{constructor(){super({name:"ScreenMaskShader",uniforms:{tDiffuse:{value:null},opacity:{value:1},intensity:{value:1},maskColor:{value:new fe(1,1,1)},R:{value:.2},sr:{value:1.2}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
      `,fragmentShader:`
        uniform float opacity;
        uniform float intensity;
        uniform sampler2D tDiffuse;
        uniform vec3 maskColor;
        uniform float R;
        uniform float sr;
        varying vec2 vUv;
        void main() {
          // 阴影颜色
          vec4 texel = texture2D( tDiffuse, vUv );
          // 距离中心的距离
          float dist = sqrt((vUv.x-0.5)*(vUv.x-0.5)+(vUv.y-0.5)*(vUv.y-0.5));
          // 渐变, sr 是开始黑色参数
          float rr = (sr - smoothstep(R, R + 0.5, dist));
          // 叠加黑色
          texel *= vec4(maskColor * rr * vec3(intensity,intensity,intensity), 1.0);
          gl_FragColor = opacity * texel;
        }
      `})}}const gI={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new ne(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		precision highp float;

		uniform sampler2D tDiffuse;

		uniform vec2 resolution;

		varying vec2 vUv;

		// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)

		//----------------------------------------------------------------------------------
		// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag
		// SDK Version: v3.00
		// Email:       gameworks@nvidia.com
		// Site:        http://developer.nvidia.com/
		//
		// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
		//
		// Redistribution and use in source and binary forms, with or without
		// modification, are permitted provided that the following conditions
		// are met:
		//  * Redistributions of source code must retain the above copyright
		//    notice, this list of conditions and the following disclaimer.
		//  * Redistributions in binary form must reproduce the above copyright
		//    notice, this list of conditions and the following disclaimer in the
		//    documentation and/or other materials provided with the distribution.
		//  * Neither the name of NVIDIA CORPORATION nor the names of its
		//    contributors may be used to endorse or promote products derived
		//    from this software without specific prior written permission.
		//
		// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY
		// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
		// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
		// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
		// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
		// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
		// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
		// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
		// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
		// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
		// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
		//
		//----------------------------------------------------------------------------------

		#ifndef FXAA_DISCARD
			//
			// Only valid for PC OpenGL currently.
			// Probably will not work when FXAA_GREEN_AS_LUMA = 1.
			//
			// 1 = Use discard on pixels which don't need AA.
			//     For APIs which enable concurrent TEX+ROP from same surface.
			// 0 = Return unchanged color on pixels which don't need AA.
			//
			#define FXAA_DISCARD 0
		#endif

		/*--------------------------------------------------------------------------*/
		#define FxaaTexTop(t, p) texture2D(t, p, -100.0)
		#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)
		/*--------------------------------------------------------------------------*/

		#define NUM_SAMPLES 5

		// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha
		float contrast( vec4 a, vec4 b ) {
			vec4 diff = abs( a - b );
			return max( max( max( diff.r, diff.g ), diff.b ), diff.a );
		}

		/*============================================================================

									FXAA3 QUALITY - PC

		============================================================================*/

		/*--------------------------------------------------------------------------*/
		vec4 FxaaPixelShader(
			vec2 posM,
			sampler2D tex,
			vec2 fxaaQualityRcpFrame,
			float fxaaQualityEdgeThreshold,
			float fxaaQualityinvEdgeThreshold
		) {
			vec4 rgbaM = FxaaTexTop(tex, posM);
			vec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);
			// . S .
			// W M E
			// . N .

			bool earlyExit = max( max( max(
					contrast( rgbaM, rgbaN ),
					contrast( rgbaM, rgbaS ) ),
					contrast( rgbaM, rgbaE ) ),
					contrast( rgbaM, rgbaW ) )
					< fxaaQualityEdgeThreshold;
			// . 0 .
			// 0 0 0
			// . 0 .

			#if (FXAA_DISCARD == 1)
				if(earlyExit) FxaaDiscard;
			#else
				if(earlyExit) return rgbaM;
			#endif

			float contrastN = contrast( rgbaM, rgbaN );
			float contrastS = contrast( rgbaM, rgbaS );
			float contrastE = contrast( rgbaM, rgbaE );
			float contrastW = contrast( rgbaM, rgbaW );

			float relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );
			relativeVContrast *= fxaaQualityinvEdgeThreshold;

			bool horzSpan = relativeVContrast > 0.;
			// . 1 .
			// 0 0 0
			// . 1 .

			// 45 deg edge detection and corners of objects, aka V/H contrast is too similar
			if( abs( relativeVContrast ) < .3 ) {
				// locate the edge
				vec2 dirToEdge;
				dirToEdge.x = contrastE > contrastW ? 1. : -1.;
				dirToEdge.y = contrastS > contrastN ? 1. : -1.;
				// . 2 .      . 1 .
				// 1 0 2  ~=  0 0 1
				// . 1 .      . 0 .

				// tap 2 pixels and see which ones are "outside" the edge, to
				// determine if the edge is vertical or horizontal

				vec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongH = contrast( rgbaM, rgbaAlongH );
				// . 1 .
				// 0 0 1
				// . 0 H

				vec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongV = contrast( rgbaM, rgbaAlongV );
				// V 1 .
				// 0 0 1
				// . 0 .

				relativeVContrast = matchAlongV - matchAlongH;
				relativeVContrast *= fxaaQualityinvEdgeThreshold;

				if( abs( relativeVContrast ) < .3 ) { // 45 deg edge
					// 1 1 .
					// 0 0 1
					// . 0 1

					// do a simple blur
					return mix(
						rgbaM,
						(rgbaN + rgbaS + rgbaE + rgbaW) * .25,
						.4
					);
				}

				horzSpan = relativeVContrast > 0.;
			}

			if(!horzSpan) rgbaN = rgbaW;
			if(!horzSpan) rgbaS = rgbaE;
			// . 0 .      1
			// 1 0 1  ->  0
			// . 0 .      1

			bool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );
			if(!pairN) rgbaN = rgbaS;

			vec2 offNP;
			offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
			offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;

			bool doneN = false;
			bool doneP = false;

			float nDist = 0.;
			float pDist = 0.;

			vec2 posN = posM;
			vec2 posP = posM;

			int iterationsUsed = 0;
			int iterationsUsedN = 0;
			int iterationsUsedP = 0;
			for( int i = 0; i < NUM_SAMPLES; i++ ) {
				iterationsUsed = i;

				float increment = float(i + 1);

				if(!doneN) {
					nDist += increment;
					posN = posM + offNP * nDist;
					vec4 rgbaEndN = FxaaTexTop(tex, posN.xy);
					doneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );
					iterationsUsedN = i;
				}

				if(!doneP) {
					pDist += increment;
					posP = posM - offNP * pDist;
					vec4 rgbaEndP = FxaaTexTop(tex, posP.xy);
					doneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );
					iterationsUsedP = i;
				}

				if(doneN || doneP) break;
			}


			if ( !doneP && !doneN ) return rgbaM; // failed to find end of edge

			float dist = min(
				doneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,
				doneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.
			);

			// hacky way of reduces blurriness of mostly diagonal edges
			// but reduces AA quality
			dist = pow(dist, .5);

			dist = 1. - dist;

			return mix(
				rgbaM,
				rgbaN,
				dist * .5
			);
		}

		void main() {
			const float edgeDetectionQuality = .2;
			const float invEdgeDetectionQuality = 1. / edgeDetectionQuality;

			gl_FragColor = FxaaPixelShader(
				vUv,
				tDiffuse,
				resolution,
				edgeDetectionQuality, // [0,1] contrast needed, otherwise early discard
				invEdgeDetectionQuality
			);

		}
	`},qu={name:"SAOShader",defines:{NUM_SAMPLES:7,NUM_RINGS:4,DIFFUSE_TEXTURE:0,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new ne(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new Me},cameraInverseProjectionMatrix:{value:new Me},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		#include <common>

		varying vec2 vUv;

		#if DIFFUSE_TEXTURE == 1
		uniform sampler2D tDiffuse;
		#endif

		uniform highp sampler2D tDepth;
		uniform highp sampler2D tNormal;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;

		uniform float scale;
		uniform float intensity;
		uniform float bias;
		uniform float kernelRadius;
		uniform float minResolution;
		uniform vec2 size;
		uniform float randomSeed;

		// RGBA depth

		#include <packing>

		vec4 getDefaultColor( const in vec2 screenPosition ) {
			#if DIFFUSE_TEXTURE == 1
			return texture2D( tDiffuse, vUv );
			#else
			return vec4( 1.0 );
			#endif
		}

		float getDepth( const in vec2 screenPosition ) {
			return texture2D( tDepth, screenPosition ).x;
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {
			float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];
			vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );
			clipPosition *= clipW; // unprojection.

			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;
		}

		vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {
			return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );
		}

		float scaleDividedByCameraFar;
		float minResolutionMultipliedByCameraFar;

		float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {
			vec3 viewDelta = sampleViewPosition - centerViewPosition;
			float viewDistance = length( viewDelta );
			float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;

			return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );
		}

		// moving costly divides into consts
		const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );
		const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );

		float getAmbientOcclusion( const in vec3 centerViewPosition ) {
			// precompute some variables require in getOcclusion.
			scaleDividedByCameraFar = scale / cameraFar;
			minResolutionMultipliedByCameraFar = minResolution * cameraFar;
			vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );

			// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/
			float angle = rand( vUv + randomSeed ) * PI2;
			vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;
			vec2 radiusStep = radius;

			float occlusionSum = 0.0;
			float weightSum = 0.0;

			for( int i = 0; i < NUM_SAMPLES; i ++ ) {
				vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;
				radius += radiusStep;
				angle += ANGLE_STEP;

				float sampleDepth = getDepth( sampleUv );
				if( sampleDepth >= ( 1.0 - EPSILON ) ) {
					continue;
				}

				float sampleViewZ = getViewZ( sampleDepth );
				vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );
				occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );
				weightSum += 1.0;
			}

			if( weightSum == 0.0 ) discard;

			return occlusionSum * ( intensity / weightSum );
		}

		void main() {
			float centerDepth = getDepth( vUv );
			if( centerDepth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = getViewZ( centerDepth );
			vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );

			float ambientOcclusion = getAmbientOcclusion( viewPosition );

			gl_FragColor = getDefaultColor( vUv );
			gl_FragColor.xyz *=  1.0 - ambientOcclusion;
		}`},da={name:"DepthLimitedBlurShader",defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new ne(512,512)},sampleUvOffsets:{value:[new ne(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:`

		#include <common>

		uniform vec2 size;

		varying vec2 vUv;
		varying vec2 vInvSize;

		void main() {
			vUv = uv;
			vInvSize = 1.0 / size;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		#include <common>
		#include <packing>

		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform float depthCutoff;

		uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];
		uniform float sampleWeights[ KERNEL_RADIUS + 1 ];

		varying vec2 vUv;
		varying vec2 vInvSize;

		float getDepth( const in vec2 screenPosition ) {
			#if DEPTH_PACKING == 1
			return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );
			#else
			return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		void main() {
			float depth = getDepth( vUv );
			if( depth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = -getViewZ( depth );
			bool rBreak = false, lBreak = false;

			float weightSum = sampleWeights[0];
			vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;

			for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {

				float sampleWeight = sampleWeights[i];
				vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;

				vec2 sampleUv = vUv + sampleUvOffset;
				float viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;

				if( ! rBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

				sampleUv = vUv - sampleUvOffset;
				viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;

				if( ! lBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

			}

			gl_FragColor = diffuseSum / weightSum;
		}`},Gd={createSampleWeights:function(i,e){const t=[];for(let r=0;r<=i;r++)t.push(vI(r,e));return t},createSampleOffsets:function(i,e){const t=[];for(let r=0;r<=i;r++)t.push(e.clone().multiplyScalar(r));return t},configure:function(i,e,t,r){i.defines.KERNEL_RADIUS=e,i.uniforms.sampleUvOffsets.value=Gd.createSampleOffsets(e,r),i.uniforms.sampleWeights.value=Gd.createSampleWeights(e,t),i.needsUpdate=!0}};function vI(i,e){return Math.exp(-i*i/(e*e*2))/(Math.sqrt(2*Math.PI)*e)}class ah extends $s{constructor(e,t,r=new ne(256,256)){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.originalClearColor=new fe,this._oldClearColor=new fe,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new ne(r.x,r.y),this.saoRenderTarget=new ft(this.resolution.x,this.resolution.y,{type:Qt}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone();const s=new dh;s.format=Oa,s.type=Da,this.normalRenderTarget=new ft(this.resolution.x,this.resolution.y,{minFilter:dt,magFilter:dt,type:Qt,depthTexture:s}),this.normalMaterial=new xp,this.normalMaterial.blending=0,this.saoMaterial=new ct({defines:Object.assign({},qu.defines),fragmentShader:qu.fragmentShader,vertexShader:qu.vertexShader,uniforms:ai.clone(qu.uniforms)}),this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=s,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=0,this.vBlurMaterial=new ct({uniforms:ai.clone(da.uniforms),defines:Object.assign({},da.defines),vertexShader:da.vertexShader,fragmentShader:da.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=0,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=s,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=0,this.hBlurMaterial=new ct({uniforms:ai.clone(da.uniforms),defines:Object.assign({},da.defines),vertexShader:da.vertexShader,fragmentShader:da.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=0,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=s,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=0,this.materialCopy=new ct({uniforms:ai.clone(Gs.uniforms),vertexShader:Gs.vertexShader,fragmentShader:Gs.fragmentShader,blending:0}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=Ko,this.materialCopy.blendSrc=lh,this.materialCopy.blendDst=Qo,this.materialCopy.blendEquation=ur,this.materialCopy.blendSrcAlpha=oh,this.materialCopy.blendDstAlpha=Qo,this.materialCopy.blendEquationAlpha=ur,this.fsQuad=new wl(null)}render(e,t,r){this.renderToScreen&&(this.materialCopy.blending=0,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const s=e.autoClear;e.autoClear=!1,this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const a=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=a,this.hBlurMaterial.uniforms.depthCutoff.value=a,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(Gd.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new ne(0,1)),Gd.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new ne(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));const n=this.materialCopy;this.params.output===ah.OUTPUT.Normal?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),this.params.output===ah.OUTPUT.Default?n.blending=Ko:n.blending=0,this.renderPass(e,n,this.renderToScreen?null:r),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=s}renderPass(e,t,r,s,a){e.getClearColor(this.originalClearColor);const n=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderOverride(e,t,r,s,a){e.getClearColor(this.originalClearColor);const n=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s=t.clearColor||s,a=t.clearAlpha||a,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}setSize(e,t){this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}}ah.OUTPUT={Default:0,SAO:1,Normal:2};const os={name:"SSRShader",defines:{MAX_STEP:0,PERSPECTIVE_CAMERA:!0,DISTANCE_ATTENUATION:!0,FRESNEL:!0,INFINITE_THICK:!1,SELECTIVE:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new ne},cameraProjectionMatrix:{value:new Me},cameraInverseProjectionMatrix:{value:new Me},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},thickness:{value:.018}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`
		// precision highp float;
		precision highp sampler2D;
		varying vec2 vUv;
		uniform sampler2D tDepth;
		uniform sampler2D tNormal;
		uniform sampler2D tMetalness;
		uniform sampler2D tDiffuse;
		uniform float cameraRange;
		uniform vec2 resolution;
		uniform float opacity;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform float maxDistance;
		uniform float thickness;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;
		#include <packing>
		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {
			//x0: point, x1: linePointA, x2: linePointB
			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html
			return length(cross(x0-x1,x0-x2))/length(x2-x1);
		}
		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){
			// https://mathworld.wolfram.com/Point-PlaneDistance.html
			//// https://en.wikipedia.org/wiki/Plane_(geometry)
			//// http://paulbourke.net/geometry/pointlineplane/
			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;
			float x0=point.x,y0=point.y,z0=point.z;
			float x=planePoint.x,y=planePoint.y,z=planePoint.z;
			float d=-(a*x+b*y+c*z);
			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);
			return distance;
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			#ifdef PERSPECTIVE_CAMERA
				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view
		}
		vec3 getViewNormal( const in vec2 uv ) {
			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );
		}
		vec2 viewPositionToXY(vec3 viewPosition){
			vec2 xy;
			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);
			xy=clip.xy;//clip
			float clipW=clip.w;
			xy/=clipW;//NDC
			xy=(xy+1.)/2.;//uv
			xy*=resolution;//screen
			return xy;
		}
		void main(){
			#ifdef SELECTIVE
				float metalness=texture2D(tMetalness,vUv).r;
				if(metalness==0.) return;
			#endif

			float depth = getDepth( vUv );
			float viewZ = getViewZ( depth );
			if(-viewZ>=cameraFar) return;

			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];
			vec3 viewPosition=getViewPosition( vUv, depth, clipW );

			vec2 d0=gl_FragCoord.xy;
			vec2 d1;

			vec3 viewNormal=getViewNormal( vUv );

			#ifdef PERSPECTIVE_CAMERA
				vec3 viewIncidentDir=normalize(viewPosition);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#else
				vec3 viewIncidentDir=vec3(0,0,-1);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#endif

			float maxReflectRayLen=maxDistance/dot(-viewIncidentDir,viewNormal);
			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html
			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)
			// maxDistance/maxReflectRayLen=cos(theta)
			// maxDistance/maxReflectRayLen==dot(a,b)
			// maxReflectRayLen==maxDistance/dot(a,b)

			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;
			#ifdef PERSPECTIVE_CAMERA
				if(d1viewPosition.z>-cameraNear){
					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx
					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;
					d1viewPosition=viewPosition+viewReflectDir*t;
				}
			#endif
			d1=viewPositionToXY(d1viewPosition);

			float totalLen=length(d1-d0);
			float xLen=d1.x-d0.x;
			float yLen=d1.y-d0.y;
			float totalStep=max(abs(xLen),abs(yLen));
			float xSpan=xLen/totalStep;
			float ySpan=yLen/totalStep;
			for(float i=0.;i<float(MAX_STEP);i++){
				if(i>=totalStep) break;
				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);
				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;
				float s=length(xy-d0)/totalLen;
				vec2 uv=xy/resolution;

				float d = getDepth(uv);
				float vZ = getViewZ( d );
				if(-vZ>=cameraFar) continue;
				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];
				vec3 vP=getViewPosition( uv, d, cW );

				#ifdef PERSPECTIVE_CAMERA
					// https://comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf
					float recipVPZ=1./viewPosition.z;
					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));
				#else
					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);
				#endif

				// if(viewReflectRayZ>vZ) continue; // will cause "npm run make-screenshot webgl_postprocessing_ssr" high probability hang.
				// https://github.com/mrdoob/three.js/pull/21539#issuecomment-821061164
				if(viewReflectRayZ<=vZ){

					bool hit;
					#ifdef INFINITE_THICK
						hit=true;
					#else
						float away=pointToLineDistance(vP,viewPosition,d1viewPosition);

						float minThickness;
						vec2 xyNeighbor=xy;
						xyNeighbor.x+=1.;
						vec2 uvNeighbor=xyNeighbor/resolution;
						vec3 vPNeighbor=getViewPosition(uvNeighbor,d,cW);
						minThickness=vPNeighbor.x-vP.x;
						minThickness*=3.;
						float tk=max(minThickness,thickness);

						hit=away<=tk;
					#endif

					if(hit){
						vec3 vN=getViewNormal( uv );
						if(dot(viewReflectDir,vN)>=0.) continue;
						float distance=pointPlaneDistance(vP,viewPosition,viewNormal);
						if(distance>maxDistance) break;
						float op=opacity;
						#ifdef DISTANCE_ATTENUATION
							float ratio=1.-(distance/maxDistance);
							float attenuation=ratio*ratio;
							op=opacity*attenuation;
						#endif
						#ifdef FRESNEL
							float fresnelCoe=(dot(viewIncidentDir,viewReflectDir)+1.)/2.;
							op*=fresnelCoe;
						#endif
						vec4 reflectColor=texture2D(tDiffuse,uv);
						gl_FragColor.xyz=reflectColor.xyz;
						gl_FragColor.a=op;
						break;
					}
				}
			}
		}
	`},Yu={name:"SSRDepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;

		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 uv ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, uv ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, uv ).x;

			#endif

		}

		void main() {

			float depth = getLinearDepth( vUv );
			float d = 1.0 - depth;
			// d=(d-.999)*1000.;
			gl_FragColor = vec4( vec3( d ), 1.0 );

		}

	`},pa={name:"SSRBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new ne},opacity:{value:.5}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;
		void main() {
			//reverse engineering from PhotoShop blur filter, then change coefficient

			vec2 texelSize = ( 1.0 / resolution );

			vec4 c=texture2D(tDiffuse,vUv);

			vec2 offset;

			offset=(vec2(-1,0))*texelSize;
			vec4 cl=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(1,0))*texelSize;
			vec4 cr=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,-1))*texelSize;
			vec4 cb=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,1))*texelSize;
			vec4 ct=texture2D(tDiffuse,vUv+offset);

			// float coeCenter=.5;
			// float coeSide=.125;
			float coeCenter=.2;
			float coeSide=.2;
			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;
			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;
			gl_FragColor=vec4(rgb,a);

		}
	`};class ks extends $s{constructor({renderer:e,scene:t,camera:r,width:s,height:a,selects:n,bouncing:o=!1,groundReflector:l}){super(),this.width=s!==void 0?s:512,this.height=a!==void 0?a:512,this.clear=!0,this.renderer=e,this.scene=t,this.camera=r,this.groundReflector=l,this.opacity=os.uniforms.opacity.value,this.output=0,this.maxDistance=os.uniforms.maxDistance.value,this.thickness=os.uniforms.thickness.value,this.tempColor=new fe,this._selects=n,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(h){this._selects!==h&&(this._selects=h,Array.isArray(h)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0,this.ssrMaterial.needsUpdate=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1,this.ssrMaterial.needsUpdate=!0))}}),this._bouncing=o,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(h){this._bouncing!==h&&(this._bouncing=h,this.ssrMaterial.uniforms.tDiffuse.value=h?this.prevRenderTarget.texture:this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=os.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(h){this._distanceAttenuation!==h&&(this._distanceAttenuation=h,this.ssrMaterial.defines.DISTANCE_ATTENUATION=h,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=os.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(h){this._fresnel!==h&&(this._fresnel=h,this.ssrMaterial.defines.FRESNEL=h,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=os.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(h){this._infiniteThick!==h&&(this._infiniteThick=h,this.ssrMaterial.defines.INFINITE_THICK=h,this.ssrMaterial.needsUpdate=!0)}});const c=new dh;c.type=$o,c.minFilter=dt,c.magFilter=dt,this.beautyRenderTarget=new ft(this.width,this.height,{minFilter:dt,magFilter:dt,type:Qt,depthTexture:c,depthBuffer:!0}),this.prevRenderTarget=new ft(this.width,this.height,{minFilter:dt,magFilter:dt}),this.normalRenderTarget=new ft(this.width,this.height,{minFilter:dt,magFilter:dt,type:Qt}),this.metalnessRenderTarget=new ft(this.width,this.height,{minFilter:dt,magFilter:dt,type:Qt}),this.ssrRenderTarget=new ft(this.width,this.height,{minFilter:dt,magFilter:dt}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new ct({defines:Object.assign({},os.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:ai.clone(os.uniforms),vertexShader:os.vertexShader,fragmentShader:os.fragmentShader,blending:0}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new xp,this.normalMaterial.blending=0,this.metalnessOnMaterial=new ei({color:"white"}),this.metalnessOffMaterial=new ei({color:"black"}),this.blurMaterial=new ct({defines:Object.assign({},pa.defines),uniforms:ai.clone(pa.uniforms),vertexShader:pa.vertexShader,fragmentShader:pa.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new ct({defines:Object.assign({},pa.defines),uniforms:ai.clone(pa.uniforms),vertexShader:pa.vertexShader,fragmentShader:pa.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ct({defines:Object.assign({},Yu.defines),uniforms:ai.clone(Yu.uniforms),vertexShader:Yu.vertexShader,fragmentShader:Yu.fragmentShader,blending:0}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ct({uniforms:ai.clone(Gs.uniforms),vertexShader:Gs.vertexShader,fragmentShader:Gs.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:Pa,blendDst:Ia,blendEquation:ur,blendSrcAlpha:Pa,blendDstAlpha:Ia,blendEquationAlpha:ur}),this.fsQuad=new wl(null),this.originalClearColor=new fe}dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),e.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(e,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(e,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.renderPass(e,this.blurMaterial2,this.blurRenderTarget2)),this.output){case ks.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t)):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t));break;case ks.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(e,this.copyMaterial,this.prevRenderTarget));break;case ks.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case ks.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case ks.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case ks.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t)}}renderPass(e,t,r,s,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));const n=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderOverride(e,t,r,s,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));const n=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s=t.clearColor||s,a=t.clearAlpha||a,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderMetalness(e,t,r,s,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));const n=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s=t.clearColor||s,a=t.clearAlpha||a,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.scene.traverseVisible(l=>{l._SSRPassBackupMaterial=l.material,this._selects.includes(l)?l.material=this.metalnessOnMaterial:l.material=this.metalnessOffMaterial}),e.render(this.scene,this.camera),this.scene.traverseVisible(l=>{l.material=l._SSRPassBackupMaterial}),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}setSize(e,t){this.width=e,this.height=t,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(e*e+t*t),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(e,t),this.prevRenderTarget.setSize(e,t),this.ssrRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.metalnessRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.blurRenderTarget2.setSize(e,t),this.ssrMaterial.uniforms.resolution.value.set(e,t),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t),this.blurMaterial2.uniforms.resolution.value.set(e,t)}}function _I(i,e,t,r){const s=new hI(t),a=t.getPixelRatio();s.setSize(r.clientWidth,r.clientHeight),s.setPixelRatio(a),s.setRenderWay=function(o="效果渲染"){this.effectComposerRender=o==="源渲染"?()=>t.render(i,e):()=>this.render(),this.renderWay=o},s.effectPass={},s.setRenderWay();const n=new uI(i,e);return s.addPass(n),function(o,l,c){const h=new ah(l,c);h.enabled=!1,h.params.saoIntensity=.01,h.params.saoScale=100,o.addPass(h),o.effectPass.saoPass=h}(s,i,e),function(o,l){const c=new _l(new ne(l.clientWidth,l.clientHeight),1.5,.4,.85);c.enabled=!1,o.addPass(c),o.effectPass.unrealBloomPass=c}(s,r),function(o,l,c,h,u){const d=new ks({renderer:o,scene:l,camera:c,width:u.clientWidth,height:u.clientHeight,selects:l.ssrList});d.thickness=.018,d.infiniteThick=!1,d.maxDistance=.01,d.opacity=.5,d.enabled=!1,h.addPass(d),h.effectPass.ssrPass=d}(t,i,e,s,r),function(o,l,c,h){const u=new Ta(new ne(h.clientWidth,h.clientHeight),l,c);u.renderToScreen=!0,u.edgeStrength=3,u.edgeGlow=0,u.edgeThickness=1,u.pulsePeriod=0,u.usePatternTexture=!1,u.visibleEdgeColor.set(16449071),u.hiddenEdgeColor.set(16449071),u.overlayMaterial.blending=Ko,u.overlayMaterial.blendSrc=nh,o.addPass(u),o.effectPass.outlinePass=u}(s,i,e,r),function(o){const l=new pI;o.addPass(l),o.effectPass.outputPass=l}(s),function(o,l,c){const h=new av(gI);h.multPixel=1,h.resize=function(){h.material.uniforms.resolution.value.x=h.multPixel/(l.clientWidth*c),h.material.uniforms.resolution.value.y=h.multPixel/(l.clientHeight*c)},h.resize(),o.addPass(h),o.effectPass.fxaaPass=h}(s,r,a),function(o){const l=new fI;l.enabled=!1,o.addPass(l),o.effectPass.screenMaskPass=l}(s),s.resize=function(){const{unrealBloomPass:o,fxaaPass:l}=s.effectPass;s.setSize(r.clientWidth,r.clientHeight),o.setSize(r.clientWidth,r.clientHeight),l.resize()},s}function yI(i,e={}){const t=KP(),r=function(f,g){const m=new Jt(50,g.clientWidth/g.clientHeight,.1,1e5);return m.position.set(10,10,10),m.name="PerspectiveCamera",f.add(m),m}(t,i),s=function({webglRenderParams:f,pixelRatio:g},m){const v=new Dx(Ne({antialias:!0,alpha:!0,logarithmicDepthBuffer:!0},f));return v.setSize(m.clientWidth,m.clientHeight),v.setPixelRatio(g||window.devicePixelRatio),m.appendChild(v.domElement),v}(e,i),a=function(f,g){const m=new JP(f,g.domElement);return m.enableDamping=!0,m.dampingFactor=.05,m.minDistance=.01,m.maxDistance=1e6,m.maxPolarAngle=Math.PI,m}(r,s),n=function(f,g,m,v){const _=new $P(g,m.domElement);f.transformControls=_,_.name="TransformControls",_.traverse(x=>x.isTransformControls=!0),f.add(_);const y=new Et;return _.addEventListener("dragging-changed",x=>{var b;v.enabled=!x.value,_.drag_change_callback(x.value),(b=_.dragChangeCallback)==null||b.call(_,x.value)}),_.addEventListener("change",()=>{var x;_.box3Helper&&(["Group","Mesh"].includes((x=_==null?void 0:_.object)==null?void 0:x.type)?(_.box3Helper.box=y.setFromObject(_.object),_.box3Helper.visible=!0):_.box3Helper.visible=!1)}),_}(t,r,s,a),o=_I(t,r,s,i),l=function(f){const g=new UC;return g.resize=()=>{g.setSize(f.clientWidth,f.clientHeight),g.domElement.style.zIndex=0,g.domElement.style.position="relative",g.domElement.style.top=-f.clientHeight+"px",g.domElement.style.height=f.clientHeight+"px",g.domElement.style.width=f.clientWidth+"px",g.domElement.style.pointerEvents="none"},g.reset=()=>g.domElement.childNodes.forEach(m=>m.remove()),g.resize(),f.appendChild(g.domElement),g}(i),c=function(f){const g=new NC;return g.resize=()=>{g.setSize(f.clientWidth,f.clientHeight),g.domElement.style.zIndex=0,g.domElement.style.position="relative",g.domElement.style.top=2*-f.clientHeight+"px",g.domElement.style.height=f.clientHeight+"px",g.domElement.style.width=f.clientWidth+"px",g.domElement.style.pointerEvents="none"},g.reset=()=>g.domElement.childNodes.forEach(m=>m.remove()),g.resize(),f.appendChild(g.domElement),g}(i),h=function(f){const g=new Tc;return g.setMode(0),g.style={offsetTop:0,offsetLeft:0},g.domElement.style.position="relative",g.domElement.style.zIndex="auto",g.domElement.style.width="80px",g.domElement.style.height="48px",g.resize=()=>{const{offsetTop:m,offsetLeft:v}=g.style;g.domElement.style.top=m-3*f.getBoundingClientRect().height+"px",g.domElement.style.left=v+"px"},g.resize(),g.setOffset=(m,v)=>{g.style.offsetTop=m,g.style.offsetLeft=v,g.resize()},g.showStats=!1,g.statsMode=0,g.created=()=>!f.contains(g.domElement)&&f.appendChild(g.domElement),g.destroy=()=>f.contains(g.domElement)&&f.removeChild(g.domElement),g}(i),u=YP({scene:t,camera:r,renderer:s,controls:a,transformControls:n,effectComposer:o,css3DRender:l,css2DRender:c,stats:h,DOM:i},e.sceneParams),d=function(f){const g=new zc;if(!f)return _=>_(g.getDelta());const m=1/f;let v=0;return _=>{const y=g.getDelta();v+=y,v>m&&(_(y),v=0)}}(e.fps);let p=null;return function f(){d(()=>{h.update(),a.update(),t.renderFrames(),o.effectComposerRender(),l.render(t,r),c.render(t,r)}),p=requestAnimationFrame(f)}(),Ne({scene:t,camera:r,renderer:s,controls:a,transformControls:n,stats:h,effectComposer:o,renderSceneResize:function(){r.aspect=i.clientWidth/i.clientHeight,r.updateProjectionMatrix(),s.setSize(i.clientWidth,i.clientHeight),o.resize(),t.shaderFrames.forEach(f=>f.uniforms.iResolution&&(f.uniforms.iResolution.value=new ne(i.clientWidth,i.clientHeight))),l.resize(),c.resize(),h.resize()},destroySceneRender:function(){cancelAnimationFrame(p),XM(t),s.dispose();for(let f in this)delete this[f];for(;i.children.length;)i.removeChild(i.firstChild);(function(){const f=document.body.getElementsByClassName("vanui-window");for(let g=f.length-1;g>=0;g--)f[g].parentNode.removeChild(f[g])})()}},u)}function xI(i,e,t){var r,s;const{scene:a,camera:n,handler:o,drawCore:l,transformControls:c,effectComposer:h,GUI:u}=i,{outlinePass:d}=h.effectPass;c.detach();const p=function(y,x,b){const M=new Mp;return M.setFromCamera(y,x),M.intersectObjects(b.children).filter(T=>!T.object.isTransformControls&&T.object.isMesh&&T.object.visible)}(Tw(e),n,a),f=p.find(y=>y.object.visible&&d1(y.object).visible);if(!f)return;const{object:g,point:m}=f,v=d1(g);switch(o.mode){case"变换":d.selectedObjects=[],o.isTransformChildren?c.attach(g):c.attach(v);break;case"选择":d.selectedObjects=[g],o.selectPanelEnable&&((r=u==null?void 0:u.createSelectPanel)==null||r.call(u,g));break;case"根选择":d.selectedObjects=[v],o.selectPanelEnable&&((s=u==null?void 0:u.createSelectPanel)==null||s.call(u,v));break;case"场景绘制":l.sceneEventCall(m,g)}const _={currentModel:g,currentRootModel:v,point:m,mode:o.mode};i.currentInfo=_,o.currentInfo=_,t(_)}ks.OUTPUT={Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7};class Bg{constructor(...e){Object.assign(this,yI(...e))}setCss2dDOM(e,t){e.style.pointerEvents="auto";const{scene:r}=this,s=new IM(e);return s.position.copy(t),r.add(s),s.destroy=()=>r.remove(s),s}setCss3dDOM(e,t){const{scene:r}=this,s=new LM(e);return s.position.copy(t),r.add(s),s.destroy=()=>r.remove(s),s}setLight(...e){const t=$0(...e);return t.target&&this.scene.add(t.target),this.scene.add(t),t}getSceneEvent(e,t){xI(this,e,r=>t==null?void 0:t(r))}getRawSceneEvent(){return function(e){const t=new Mp;return{raycaster:t,getIntersects:(r,s)=>(t.setFromCamera(Tw(r),e),t.intersectObjects(s))}}(this.camera)}setOutlinePass(e=[]){return this.effectComposer.effectPass.outlinePass.selectedObjects=e}getSceneEditorImage(e){return this.renderer.render(this.scene,this.camera),this.effectComposer.render(),this.renderer.domElement.toDataURL(...e)}setModelAnimationPlay(e){if(e!=null&&e.animationPlayParams)return this.modelCore.modelAnimationPlay(e,e.animationPlayParams)}getSceneCurveList(){return this.scene.children.filter(e=>e.isCurveMesh).map(e=>{var t,r;return{path:e.curvePath||((r=(t=e.geometry)==null?void 0:t.parameters)==null?void 0:r.path),mesh:e}})}setCurveAnimation(e,t=1){if(e)return function(r,s=1,a){return{id:Date.now(),curve:r,time:0,pause:!1,speed:s,start:function(){a.indexOf(this)>-1||(a.push(this),this.pause=!1)},destroy:function(){const n=a.indexOf(this);n>-1&&a.splice(n,1),delete this.start,delete this.destroy},frameCallback:null,frameEndCallback:null,commonAnimateRender:function(){var n,o;if(!this.pause){if(this.time+=this.speed/1e3,this.time>1||this.time<0)return this.time=this.time>1?1:0,this.pause=!0,(n=this.frameEndCallback)==null?void 0:n.call(this,"end");(o=this.frameCallback)==null||o.call(this,this.curve.getPointAt(this.time))}}}}(e,t,this.scene.commonFrames)}}xv(Bg,"dracoPath","/draco/"),xv(Bg,"styleOverrides",rh);const bI={class:"build"},MI={class:"back"},wI={class:"item"},SI={class:"back"},TI={class:"item"},AI={__name:"build",props:["emitEditor"],setup(i){const e=i,t=a=>a.length>20?a.slice(0,20)+"...":a;function r(a,n="online"){const o=a.split(".").pop().toUpperCase();let l;if(n==="online")l=ni.buildUrl+a;else{const u=e.emitEditor.IndexDBList.find(d=>d.name===a);if(u)l=URL.createObjectURL(u.blob);else return}if(!o||!["FBX","GLB","GLTF","OBJ"].includes(o))return;const c={url:l,type:o==="GLB"?"GLTF":o,indexDBNameUrl:n==="indexDB"?"IndexDB:"+a:""},{loaderService:h}=e.emitEditor.threeEditor.modelCore.insertModel(c);e.emitEditor.loading=!0,setTimeout(()=>{e.emitEditor.loading&&(e.emitEditor.loading=!1,Gr.error("网络较差,加载比较缓慢"))},8e3),h.complete=u=>{e.emitEditor.loading=!1;const{transformControls:d,camera:p,controls:f}=e.emitEditor.threeEditor,{maxView:g,target:m}=W0(u);Promise.all([Rr(p.position,g),Rr(f.target,m)]).then(()=>{e.emitEditor.threeEditor.setOutlinePass([u]),f.target.copy(m),d.attach(u)})}}const s=zg({list:[]});return yl(ni.buildUrl).then(a=>s.list=a==null?void 0:a.map(n=>({name:n,url:ni.buildUrl+n}))),(a,n)=>{const o=Mt("el-link");return Xe(),lt("div",bI,[(Xe(!0),lt(Wi,null,gr(i.emitEditor.IndexDBList,l=>(Xe(),lt("div",MI,[Ie("div",wI,[Ue(o,{onClick:c=>r(l.name,"indexDB")},{default:He(()=>[gt(" 本机: "+Qi(t(l.name)),1)]),_:2},1032,["onClick"])])]))),256)),(Xe(!0),lt(Wi,null,gr(xt(s).list,l=>(Xe(),lt("div",SI,[Ie("div",TI,[Ue(o,{onClick:c=>r(l.name)},{default:He(()=>[gt(Qi(l.name),1)]),_:2},1032,["onClick"])])]))),256))])}}},EI=Ks(AI,[["__scopeId","data-v-98bbc372"]]),CI=i=>(Wd("data-v-69264b38"),i=i(),Xd(),i),RI={class:"listScene"},PI={class:"back"},II={class:"item"},LI=CI(()=>Ie("img",{src:qd},null,-1)),NI={__name:"list",props:["emitEditor"],setup(i){const e=jd({list:[]}),t=i;function r(a){return a.replace(/.json/g,"")}function s(a){fetch(ni.editorJsonUrl+a).then(n=>n.json()).then(n=>{var l,c;const{emitEditor:o}=t;setTimeout(()=>o.createScene(n),100),(c=(l=o==null?void 0:o.threeEditor)==null?void 0:l.destroySceneRender)==null||c.call(l)})}return yl(ni.editorJsonUrl).then(a=>e.list=a),(a,n)=>{const o=Mt("el-link");return Xe(),lt("div",RI,[(Xe(!0),lt(Wi,null,gr(e.list,(l,c)=>(Xe(),lt("div",PI,[Ie("div",II,[LI,Ue(o,{onClick:h=>s(l)},{default:He(()=>[gt(Qi(r(l)),1)]),_:2},1032,["onClick"])])]))),256))])}}},DI=Ks(NI,[["__scopeId","data-v-69264b38"]]),OI="/three-editor/dist/vite.svg",UI=i=>(Wd("data-v-dcdb4b3c"),i=i(),Xd(),i),kI={class:"fontL"},FI={class:"back"},BI={class:"item"},zI=UI(()=>Ie("img",{src:OI},null,-1)),VI={__name:"font",props:["emitEditor"],setup(i){const e=jd({list:[]});function t(a){return a.replace(/.json/g,"")}function r(a){const n=document.createElement("textarea");n.value=a,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}function s(a){r(ni.fontUrl+a),Gr.success("已复制"+ni.fontUrl+a)}return yl(ni.fontUrl).then(a=>e.list=a),(a,n)=>{const o=Mt("el-link");return Xe(),lt("div",kI,[(Xe(!0),lt(Wi,null,gr(e.list,(l,c)=>(Xe(),lt("div",FI,[Ie("div",BI,[zI,Ue(o,{onClick:h=>s(l)},{default:He(()=>[gt(Qi(t(l)),1)]),_:2},1032,["onClick"])])]))),256))])}}},HI=Ks(VI,[["__scopeId","data-v-dcdb4b3c"]]),GI={class:"imageL"},jI={class:"back"},WI={class:"item"},XI=["src"],qI={__name:"image",props:["emitEditor"],setup(i){const e=jd({list:[]});function t(s){const a=document.createElement("textarea");a.value=s,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}function r(s){t(ni.channelUrl+s),Gr.success("已复制"+ni.channelUrl+s)}return yl(ni.channelUrl).then(s=>e.list=s),(s,a)=>{const n=Mt("el-link");return Xe(),lt("div",GI,[(Xe(!0),lt(Wi,null,gr(e.list,(o,l)=>(Xe(),lt("div",jI,[Ie("div",WI,[Ie("img",{src:xt(ni).channelUrl+o},null,8,XI),Ue(n,{onClick:c=>r(o)},{default:He(()=>[gt(Qi(o),1)]),_:2},1032,["onClick"])])]))),256))])}}},YI=Ks(qI,[["__scopeId","data-v-e372bc7c"]]),ZI={class:"imageL"},KI={class:"back"},QI={class:"item"},JI=["src"],$I={__name:"video",props:["emitEditor"],setup(i){const e=jd({list:[]});function t(s){const a=document.createElement("textarea");a.value=s,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}function r(s){t(ni.videoUrl+s),Gr.success("已复制"+ni.videoUrl+s)}return yl(ni.videoUrl).then(s=>e.list=s),(s,a)=>{const n=Mt("el-link");return Xe(),lt("div",ZI,[(Xe(!0),lt(Wi,null,gr(e.list,(o,l)=>(Xe(),lt("div",KI,[Ie("div",QI,[Ie("video",{src:xt(ni).videoUrl+o,autoplay:"",muted:""},null,8,JI),Ue(n,{onClick:c=>r(o)},{default:He(()=>[gt(Qi(o),1)]),_:2},1032,["onClick"])])]))),256))])}}},eL=Ks($I,[["__scopeId","data-v-8d77db4a"]]),tL={class:"left"},iL={class:"list"},rL=["onClick"],sL={__name:"leftPanel",props:["emitEditor"],setup(i){const e=ds(!0),t=[{icon:"set-up",title:"配置案例",component:DI},{icon:"office-building",title:"建筑",component:EI},{icon:"partly-cloudy",title:"天空盒",component:nS},{icon:"Picture",title:"图片",component:YI},{icon:"edit-pen",title:"字体",component:HI},{icon:"video-play",title:"视频",component:eL}];let r=localStorage.getItem("active");r||(r=0),r>=t.length&&(r=0);const s=ds(r);function a(n){localStorage.setItem("active",n),s.value=n}return(n,o)=>{const l=Mt("el-button"),c=Mt("Expand"),h=Mt("Fold"),u=Mt("el-icon");return Xe(),lt(Wi,null,[Ue(px,{name:"el-zoom-in-left"},{default:He(()=>[Vg(Ie("div",tL,[Ie("div",iL,[(Xe(),lt(Wi,null,gr(t,(d,p)=>Ie("div",{class:"iconotem",onClick:f=>a(p)},[Ue(l,{class:Xw(s.value==p?"active":"btn"),link:"",icon:d.icon,title:d.title},null,8,["class","icon","title"]),Ie("span",{style:vf(s.value==p?"color:rgb(182, 211, 244);font-weight:bold":"")},Qi(d.title),5)],8,rL)),64))]),(Xe(),Fo(qw(t[s.value].component),{emitEditor:i.emitEditor},null,8,["emitEditor"]))],512),[[dx,e.value]])]),_:1}),Ie("div",{class:"lico",style:vf({left:e.value?"287px":"0px"})},[Ue(u,{class:"icon",onClick:o[0]||(o[0]=d=>e.value=!e.value)},{default:He(()=>[e.value?(Xe(),Fo(h,{key:1})):(Xe(),Fo(c,{key:0}))]),_:1})],4)],64)}}},aL=Ks(sL,[["__scopeId","data-v-e396d8e5"]]),Ss=i=>(Wd("data-v-654b02df"),i=i(),Xd(),i),nL={class:"right"},oL={class:"main"},lL={class:"card-header"},cL={class:"text item"},hL=Ss(()=>Ie("br",null,null,-1)),uL=Ss(()=>Ie("div",{class:"card-header"},[Ie("span",null,"Css2D/3D 使用 ")],-1)),dL=Ss(()=>Ie("img",{class:"logo",src:qd,alt:"logo",width:"25px",height:"25px"},null,-1)),pL=Ss(()=>Ie("img",{class:"logo",src:qd,alt:"logo",width:"25px",height:"25px"},null,-1)),mL={style:{display:"flex"}},fL=Ss(()=>Ie("br",null,null,-1)),gL=Ss(()=>Ie("div",{class:"card-header"},[Ie("span",null,"自定义物体动画")],-1)),vL={key:0},_L=Ss(()=>Ie("span",{class:"text_a"},"物体:",-1)),yL={key:1},xL=Ss(()=>Ie("span",{class:"text_a"},"物体:",-1)),bL={key:2},ML=Ss(()=>Ie("span",{class:"text_a"},"视角:",-1)),wL={key:3},SL=Ss(()=>Ie("span",{class:"text_a"},"视角:",-1)),TL={style:{display:"flex"}},AL={__name:"rightPanel",props:["emitEditor"],setup(i){const e=i,t=ds(null),r=ds(null);let s=ds({transformAnimationList:[],transformAnimationMesh:null,viewAngleList:[]});const a=()=>e.emitEditor.threeEditor.setCss2dDOM(t.value,new ny.Vector3(0,0,0)),n=()=>e.emitEditor.threeEditor.setCss3dDOM(r.value,new ny.Vector3(0,0,0)).scale.set(.1,.1,.1),o=d=>kd(s.value.transformAnimationMesh,d._transformInfo,d.transformInfo_,d.gsapParams),l=d=>{const{camera:p,controls:f}=e.emitEditor.threeEditor;new Promise(g=>Rr(p.position,d.position,{duration:2,onComplete:g})),new Promise(g=>Rr(f.target,d.target,{duration:2,onComplete:g}))},c=()=>{const{camera:d,controls:p}=e.emitEditor.threeEditor;s.value.transformAnimationList.reduce(async(m,v)=>(await m,kd(s.value.transformAnimationMesh,v._transformInfo,v.transformInfo_,v.gsapParams)),Promise.resolve()),s.value.viewAngleList.reduce(async(m,v)=>(await m,Promise.all([new Promise(_=>Rr(d.position,v.position,{duration:2,onComplete:_})),new Promise(_=>Rr(p.target,v.target,{duration:2,onComplete:_}))])),Promise.resolve())};_f(()=>e.emitEditor.threeEditor,d=>{if(d){let p=!1;d.modelCore.progressList.forEach(f=>{f.params.name==="动画测试"&&(p=!0,f.loaderService.complete=g=>{s.value.transformAnimationList=f.params.transformAnimationList,s.value.transformAnimationMesh=g,s.value.viewAngleList=d.controls.viewAngleList})}),p||(s.value.transformAnimationList=[],s.value.transformAnimationMesh=null,s.value.viewAngleList=[])}});function h(d){return d?typeof d=="number"?d.toFixed(12):d.slice(0,12):""}const u=ds(!0);return(d,p)=>{const f=Mt("el-button"),g=Mt("el-card"),m=Mt("Expand"),v=Mt("Fold"),_=Mt("el-icon");return Xe(),lt(Wi,null,[Ue(px,{name:"el-zoom-in-bottom"},{default:He(()=>[Vg(Ie("div",nL,[Ie("div",oL,[Ue(g,{class:"box-card"},{header:He(()=>{var y,x;return[Ie("div",lL,[Ie("span",null,"名称："+Qi(h((x=(y=i.emitEditor.info)==null?void 0:y.currentModel)==null?void 0:x.name)),1)])]}),footer:He(()=>[Ue(f,{class:"button",onClick:p[0]||(p[0]=y=>i.emitEditor.threeEditor.setLight("AmbientLight",{intensity:3})),text:""},{default:He(()=>[gt("快速添加环境光")]),_:1})]),default:He(()=>[(Xe(),lt(Wi,null,gr(["x","y","z"],y=>{var x;return Ie("div",cL,Qi("坐标 "+y+" : "+h((x=i.emitEditor.info)==null?void 0:x.point[y])),1)}),64))]),_:1}),hL,Ue(g,{class:"box-card"},{header:He(()=>[uL]),footer:He(()=>[Ie("span",mL,[Ue(f,{class:"button",onClick:a,text:""},{default:He(()=>[gt("Css2D")]),_:1}),Ue(f,{class:"button",onClick:n,text:""},{default:He(()=>[gt("Css3D")]),_:1})])]),default:He(()=>[Ie("div",null,[gt("测试DOM: "),Ie("span",{ref_key:"card",ref:t},[gt(" 2D:"),dL],512),Ie("span",{ref_key:"card2",ref:r},[gt(" 3D:"),pL],512)])]),_:1}),fL,Ue(g,{class:"box-card"},{header:He(()=>[gL]),footer:He(()=>[Ie("span",TL,[Ue(f,{disabled:xt(s).transformAnimationList.length<1,class:"button",onClick:c,text:""},{default:He(()=>[gt("动画连续播放")]),_:1},8,["disabled"])])]),default:He(()=>[Ie("div",null,[xt(s).transformAnimationList.length>0?(Xe(),lt("div",vL,[_L,(Xe(!0),lt(Wi,null,gr(xt(s).transformAnimationList,(y,x)=>(Xe(),lt("span",{key:x},[Ue(f,{onClick:b=>o(y)},{default:He(()=>[gt(Qi(x),1)]),_:2},1032,["onClick"])]))),128))])):(Xe(),lt("div",yL,[xL,gt(" ——无——")])),xt(s).viewAngleList.length>0?(Xe(),lt("div",bL,[ML,(Xe(!0),lt(Wi,null,gr(xt(s).viewAngleList,(y,x)=>(Xe(),lt("span",{key:x},[Ue(f,{onClick:b=>l(y)},{default:He(()=>[gt(Qi(x),1)]),_:2},1032,["onClick"])]))),128))])):(Xe(),lt("div",wL,[SL,gt(" ——无——")]))])]),_:1})])],512),[[dx,u.value]])]),_:1}),Ie("div",{class:"lico1",style:vf({right:u.value?"287px":"0px"})},[Ue(_,{class:"icon",onClick:p[1]||(p[1]=y=>u.value=!u.value)},{default:He(()=>[u.value?(Xe(),Fo(v,{key:1})):(Xe(),Fo(m,{key:0}))]),_:1})],4)],64)}}},EL=Ks(AL,[["__scopeId","data-v-654b02df"]]);function Zu(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Dw={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,e){(function(t){i.exports=t()})(function(){return function t(r,s,a){function n(c,h){if(!s[c]){if(!r[c]){var u=typeof Zu=="function"&&Zu;if(!h&&u)return u(c,!0);if(o)return o(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var p=s[c]={exports:{}};r[c][0].call(p.exports,function(f){var g=r[c][1][f];return n(g||f)},p,p.exports,t,r,s,a)}return s[c].exports}for(var o=typeof Zu=="function"&&Zu,l=0;l<a.length;l++)n(a[l]);return n}({1:[function(t,r,s){var a=t("./utils"),n=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(l){for(var c,h,u,d,p,f,g,m=[],v=0,_=l.length,y=_,x=a.getTypeOf(l)!=="string";v<l.length;)y=_-v,u=x?(c=l[v++],h=v<_?l[v++]:0,v<_?l[v++]:0):(c=l.charCodeAt(v++),h=v<_?l.charCodeAt(v++):0,v<_?l.charCodeAt(v++):0),d=c>>2,p=(3&c)<<4|h>>4,f=1<y?(15&h)<<2|u>>6:64,g=2<y?63&u:64,m.push(o.charAt(d)+o.charAt(p)+o.charAt(f)+o.charAt(g));return m.join("")},s.decode=function(l){var c,h,u,d,p,f,g=0,m=0,v="data:";if(l.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var _,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&y--,l.charAt(l.length-2)===o.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=n.uint8array?new Uint8Array(0|y):new Array(0|y);g<l.length;)c=o.indexOf(l.charAt(g++))<<2|(d=o.indexOf(l.charAt(g++)))>>4,h=(15&d)<<4|(p=o.indexOf(l.charAt(g++)))>>2,u=(3&p)<<6|(f=o.indexOf(l.charAt(g++))),_[m++]=c,p!==64&&(_[m++]=h),f!==64&&(_[m++]=u);return _}},{"./support":30,"./utils":32}],2:[function(t,r,s){var a=t("./external"),n=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(h,u,d,p,f){this.compressedSize=h,this.uncompressedSize=u,this.crc32=d,this.compression=p,this.compressedContent=f}c.prototype={getContentWorker:function(){var h=new n(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),u=this;return h.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new n(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,u,d){return h.pipe(new o).pipe(new l("uncompressedSize")).pipe(u.compressWorker(d)).pipe(new l("compressedSize")).withStreamInfo("compression",u)},r.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,r,s){var a=t("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},s.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,r,s){var a=t("./utils"),n=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();r.exports=function(o,l){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?function(c,h,u,d){var p=n,f=d+u;c^=-1;for(var g=d;g<f;g++)c=c>>>8^p[255&(c^h[g])];return-1^c}(0|l,o,o.length,0):function(c,h,u,d){var p=n,f=d+u;c^=-1;for(var g=d;g<f;g++)c=c>>>8^p[255&(c^h.charCodeAt(g))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,r,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(t,r,s){var a=null;a=typeof Promise<"u"?Promise:t("lie"),r.exports={Promise:a}},{lie:37}],7:[function(t,r,s){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",n=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),c=a?"uint8array":"array";function h(u,d){l.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=d,this.meta={}}s.magic="\b\0",o.inherits(h,l),h.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,u.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(d){u.push({data:d,meta:u.meta})}},s.compressWorker=function(u){return new h("Deflate",u)},s.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,r,s){function a(p,f){var g,m="";for(g=0;g<f;g++)m+=String.fromCharCode(255&p),p>>>=8;return m}function n(p,f,g,m,v,_){var y,x,b=p.file,M=p.compression,T=_!==c.utf8encode,E=o.transformTo("string",_(b.name)),C=o.transformTo("string",c.utf8encode(b.name)),N=b.comment,D=o.transformTo("string",_(N)),A=o.transformTo("string",c.utf8encode(N)),L=C.length!==b.name.length,w=A.length!==N.length,B="",$="",K="",ae=b.dir,se=b.date,me={crc32:0,compressedSize:0,uncompressedSize:0};f&&!g||(me.crc32=p.crc32,me.compressedSize=p.compressedSize,me.uncompressedSize=p.uncompressedSize);var H=0;f&&(H|=8),T||!L&&!w||(H|=2048);var W=0,ce=0;ae&&(W|=16),v==="UNIX"?(ce=798,W|=function(k,z){var ee=k;return k||(ee=z?16893:33204),(65535&ee)<<16}(b.unixPermissions,ae)):(ce=20,W|=function(k){return 63&(k||0)}(b.dosPermissions)),y=se.getUTCHours(),y<<=6,y|=se.getUTCMinutes(),y<<=5,y|=se.getUTCSeconds()/2,x=se.getUTCFullYear()-1980,x<<=4,x|=se.getUTCMonth()+1,x<<=5,x|=se.getUTCDate(),L&&($=a(1,1)+a(h(E),4)+C,B+="up"+a($.length,2)+$),w&&(K=a(1,1)+a(h(D),4)+A,B+="uc"+a(K.length,2)+K);var te="";return te+=`
\0`,te+=a(H,2),te+=M.magic,te+=a(y,2),te+=a(x,2),te+=a(me.crc32,4),te+=a(me.compressedSize,4),te+=a(me.uncompressedSize,4),te+=a(E.length,2),te+=a(B.length,2),{fileRecord:u.LOCAL_FILE_HEADER+te+E+B,dirRecord:u.CENTRAL_FILE_HEADER+a(ce,2)+te+a(D.length,2)+"\0\0\0\0"+a(W,4)+a(m,4)+E+B+D}}var o=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),h=t("../crc32"),u=t("../signature");function d(p,f,g,m){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=f,this.zipPlatform=g,this.encodeFileName=m,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,l),d.prototype.push=function(p){var f=p.meta.percent||0,g=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:g?(f+100*(g-m-1))/g:100}}))},d.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var f=this.streamFiles&&!p.file.dir;if(f){var g=n(p,f,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(p){this.accumulate=!1;var f=this.streamFiles&&!p.file.dir,g=n(p,f,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),f)this.push({data:function(m){return u.DATA_DESCRIPTOR+a(m.crc32,4)+a(m.compressedSize,4)+a(m.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var p=this.bytesWritten,f=0;f<this.dirRecords.length;f++)this.push({data:this.dirRecords[f],meta:{percent:100}});var g=this.bytesWritten-p,m=function(v,_,y,x,b){var M=o.transformTo("string",b(x));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(v,2)+a(v,2)+a(_,4)+a(y,4)+a(M.length,2)+M}(this.dirRecords.length,g,p,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(p){this._sources.push(p);var f=this;return p.on("data",function(g){f.processChunk(g)}),p.on("end",function(){f.closedSource(f.previous.streamInfo),f._sources.length?f.prepareNextSource():f.end()}),p.on("error",function(g){f.error(g)}),this},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(p){var f=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var g=0;g<f.length;g++)try{f[g].error(p)}catch{}return!0},d.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,f=0;f<p.length;f++)p[f].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,r,s){var a=t("../compressions"),n=t("./ZipFileWorker");s.generateWorker=function(o,l,c){var h=new n(l.streamFiles,c,l.platform,l.encodeFileName),u=0;try{o.forEach(function(d,p){u++;var f=function(_,y){var x=_||y,b=a[x];if(!b)throw new Error(x+" is not a valid compression method !");return b}(p.options.compression,l.compression),g=p.options.compressionOptions||l.compressionOptions||{},m=p.dir,v=p.date;p._compressWorker(f,g).withStreamInfo("file",{name:d,dir:m,date:v,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(h)}),h.entriesCount=u}catch(d){h.error(d)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,r,s){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var n=new a;for(var o in this)typeof this[o]!="function"&&(n[o]=this[o]);return n}}(a.prototype=t("./object")).loadAsync=t("./load"),a.support=t("./support"),a.defaults=t("./defaults"),a.version="3.10.1",a.loadAsync=function(n,o){return new a().loadAsync(n,o)},a.external=t("./external"),r.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,r,s){var a=t("./utils"),n=t("./external"),o=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function u(d){return new n.Promise(function(p,f){var g=d.decompressed.getContentWorker().pipe(new c);g.on("error",function(m){f(m)}).on("end",function(){g.streamInfo.crc32!==d.decompressed.crc32?f(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}r.exports=function(d,p){var f=this;return p=a.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(d)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",d,!0,p.optimizedBinaryString,p.base64).then(function(g){var m=new l(p);return m.load(g),m}).then(function(g){var m=[n.Promise.resolve(g)],v=g.files;if(p.checkCRC32)for(var _=0;_<v.length;_++)m.push(u(v[_]));return n.Promise.all(m)}).then(function(g){for(var m=g.shift(),v=m.files,_=0;_<v.length;_++){var y=v[_],x=y.fileNameStr,b=a.resolve(y.fileNameStr);f.file(b,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:p.createFolders}),y.dir||(f.file(b).unsafeOriginalName=x)}return m.zipComment.length&&(f.comment=m.zipComment),f})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,r,s){var a=t("../utils"),n=t("../stream/GenericWorker");function o(l,c){n.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}a.inherits(o,n),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,r,s){var a=t("readable-stream").Readable;function n(o,l,c){a.call(this,l),this._helper=o;var h=this;o.on("data",function(u,d){h.push(u)||h._helper.pause(),c&&c(d)}).on("error",function(u){h.emit("error",u)}).on("end",function(){h.push(null)})}t("../utils").inherits(n,a),n.prototype._read=function(){this._helper.resume()},r.exports=n},{"../utils":32,"readable-stream":16}],14:[function(t,r,s){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(a,n){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,n);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,n)},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);var n=new Buffer(a);return n.fill(0),n},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"}}},{}],15:[function(t,r,s){function a(b,M,T){var E,C=o.getTypeOf(M),N=o.extend(T||{},h);N.date=N.date||new Date,N.compression!==null&&(N.compression=N.compression.toUpperCase()),typeof N.unixPermissions=="string"&&(N.unixPermissions=parseInt(N.unixPermissions,8)),N.unixPermissions&&16384&N.unixPermissions&&(N.dir=!0),N.dosPermissions&&16&N.dosPermissions&&(N.dir=!0),N.dir&&(b=v(b)),N.createFolders&&(E=m(b))&&_.call(this,E,!0);var D=C==="string"&&N.binary===!1&&N.base64===!1;T&&T.binary!==void 0||(N.binary=!D),(M instanceof u&&M.uncompressedSize===0||N.dir||!M||M.length===0)&&(N.base64=!1,N.binary=!0,M="",N.compression="STORE",C="string");var A=null;A=M instanceof u||M instanceof l?M:f.isNode&&f.isStream(M)?new g(b,M):o.prepareContent(b,M,N.binary,N.optimizedBinaryString,N.base64);var L=new d(b,A,N);this.files[b]=L}var n=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),h=t("./defaults"),u=t("./compressedObject"),d=t("./zipObject"),p=t("./generate"),f=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),m=function(b){b.slice(-1)==="/"&&(b=b.substring(0,b.length-1));var M=b.lastIndexOf("/");return 0<M?b.substring(0,M):""},v=function(b){return b.slice(-1)!=="/"&&(b+="/"),b},_=function(b,M){return M=M!==void 0?M:h.createFolders,b=v(b),this.files[b]||a.call(this,b,null,{dir:!0,createFolders:M}),this.files[b]};function y(b){return Object.prototype.toString.call(b)==="[object RegExp]"}var x={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(b){var M,T,E;for(M in this.files)E=this.files[M],(T=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&b(T,E)},filter:function(b){var M=[];return this.forEach(function(T,E){b(T,E)&&M.push(E)}),M},file:function(b,M,T){if(arguments.length!==1)return b=this.root+b,a.call(this,b,M,T),this;if(y(b)){var E=b;return this.filter(function(N,D){return!D.dir&&E.test(N)})}var C=this.files[this.root+b];return C&&!C.dir?C:null},folder:function(b){if(!b)return this;if(y(b))return this.filter(function(C,N){return N.dir&&b.test(C)});var M=this.root+b,T=_.call(this,M),E=this.clone();return E.root=T.name,E},remove:function(b){b=this.root+b;var M=this.files[b];if(M||(b.slice(-1)!=="/"&&(b+="/"),M=this.files[b]),M&&!M.dir)delete this.files[b];else for(var T=this.filter(function(C,N){return N.name.slice(0,b.length)===b}),E=0;E<T.length;E++)delete this.files[T[E].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(b){var M,T={};try{if((T=o.extend(b||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");o.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var E=T.comment||this.comment||"";M=p.generateWorker(this,T,E)}catch(C){(M=new l("error")).error(C)}return new c(M,T.type||"string",T.mimeType)},generateAsync:function(b,M){return this.generateInternalStream(b).accumulate(M)},generateNodeStream:function(b,M){return(b=b||{}).type||(b.type="nodebuffer"),this.generateInternalStream(b).toNodejsStream(M)}};r.exports=x},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,r,s){r.exports=t("stream")},{stream:void 0}],17:[function(t,r,s){var a=t("./DataReader");function n(o){a.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(n,a),n.prototype.byteAt=function(o){return this.data[this.zero+o]},n.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),u=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===l&&this.data[d+1]===c&&this.data[d+2]===h&&this.data[d+3]===u)return d-this.zero;return-1},n.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),u=o.charCodeAt(3),d=this.readData(4);return l===d[0]&&c===d[1]&&h===d[2]&&u===d[3]},n.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=n},{"../utils":32,"./DataReader":18}],18:[function(t,r,s){var a=t("../utils");function n(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return a.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},r.exports=n},{"../utils":32}],19:[function(t,r,s){var a=t("./Uint8ArrayReader");function n(o){a.call(this,o)}t("../utils").inherits(n,a),n.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,r,s){var a=t("./DataReader");function n(o){a.call(this,o)}t("../utils").inherits(n,a),n.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},n.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},n.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},n.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=n},{"../utils":32,"./DataReader":18}],21:[function(t,r,s){var a=t("./ArrayReader");function n(o){a.call(this,o)}t("../utils").inherits(n,a),n.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(t,r,s){var a=t("../utils"),n=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");r.exports=function(u){var d=a.getTypeOf(u);return a.checkSupport(d),d!=="string"||n.uint8array?d==="nodebuffer"?new c(u):n.uint8array?new h(a.transformTo("uint8array",u)):new o(a.transformTo("array",u)):new l(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,r,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,r,s){var a=t("./GenericWorker"),n=t("../utils");function o(l){a.call(this,"ConvertWorker to "+l),this.destType=l}n.inherits(o,a),o.prototype.processChunk=function(l){this.push({data:n.transformTo(this.destType,l.data),meta:l.meta})},r.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,r,s){var a=t("./GenericWorker"),n=t("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,a),o.prototype.processChunk=function(l){this.streamInfo.crc32=n(l.data,this.streamInfo.crc32||0),this.push(l)},r.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,r,s){var a=t("../utils"),n=t("./GenericWorker");function o(l){n.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}a.inherits(o,n),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}n.prototype.processChunk.call(this,l)},r.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,r,s){var a=t("../utils"),n=t("./GenericWorker");function o(l){n.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=a.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}a.inherits(o,n),o.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,r,s){function a(n){this.name=n||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(n){this.emit("data",n)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(n){this.emit("error",n)}return!0},error:function(n){return!this.isFinished&&(this.isPaused?this.generatedError=n:(this.isFinished=!0,this.emit("error",n),this.previous&&this.previous.error(n),this.cleanUp()),!0)},on:function(n,o){return this._listeners[n].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(n,o){if(this._listeners[n])for(var l=0;l<this._listeners[n].length;l++)this._listeners[n][l].call(this,o)},pipe:function(n){return n.registerPrevious(this)},registerPrevious:function(n){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=n.streamInfo,this.mergeStreamInfo(),this.previous=n;var o=this;return n.on("data",function(l){o.processChunk(l)}),n.on("end",function(){o.end()}),n.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var n=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),n=!0),this.previous&&this.previous.resume(),!n},flush:function(){},processChunk:function(n){this.push(n)},withStreamInfo:function(n,o){return this.extraStreamInfo[n]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var n in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,n)&&(this.streamInfo[n]=this.extraStreamInfo[n])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var n="Worker "+this.name;return this.previous?this.previous+" -> "+n:n}},r.exports=a},{}],29:[function(t,r,s){var a=t("../utils"),n=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),c=t("../support"),h=t("../external"),u=null;if(c.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(f,g){return new h.Promise(function(m,v){var _=[],y=f._internalType,x=f._outputType,b=f._mimeType;f.on("data",function(M,T){_.push(M),g&&g(T)}).on("error",function(M){_=[],v(M)}).on("end",function(){try{var M=function(T,E,C){switch(T){case"blob":return a.newBlob(a.transformTo("arraybuffer",E),C);case"base64":return l.encode(E);default:return a.transformTo(T,E)}}(x,function(T,E){var C,N=0,D=null,A=0;for(C=0;C<E.length;C++)A+=E[C].length;switch(T){case"string":return E.join("");case"array":return Array.prototype.concat.apply([],E);case"uint8array":for(D=new Uint8Array(A),C=0;C<E.length;C++)D.set(E[C],N),N+=E[C].length;return D;case"nodebuffer":return Buffer.concat(E);default:throw new Error("concat : unsupported type '"+T+"'")}}(y,_),b);m(M)}catch(T){v(T)}_=[]}).resume()})}function p(f,g,m){var v=g;switch(g){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=g,this._mimeType=m,a.checkSupport(v),this._worker=f.pipe(new n(v)),f.lock()}catch(_){this._worker=new o("error"),this._worker.error(_)}}p.prototype={accumulate:function(f){return d(this,f)},on:function(f,g){var m=this;return f==="data"?this._worker.on(f,function(v){g.call(m,v.data,v.meta)}):this._worker.on(f,function(){a.delay(g,arguments,m)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(f){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},f)}},r.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,r,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var a=new ArrayBuffer(0);try{s.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(a),s.blob=n.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!t("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(t,r,s){for(var a=t("./utils"),n=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function u(){l.call(this,"utf-8 decode"),this.leftOver=null}function d(){l.call(this,"utf-8 encode")}s.utf8encode=function(p){return n.nodebuffer?o.newBufferFrom(p,"utf-8"):function(f){var g,m,v,_,y,x=f.length,b=0;for(_=0;_<x;_++)(64512&(m=f.charCodeAt(_)))==55296&&_+1<x&&(64512&(v=f.charCodeAt(_+1)))==56320&&(m=65536+(m-55296<<10)+(v-56320),_++),b+=m<128?1:m<2048?2:m<65536?3:4;for(g=n.uint8array?new Uint8Array(b):new Array(b),_=y=0;y<b;_++)(64512&(m=f.charCodeAt(_)))==55296&&_+1<x&&(64512&(v=f.charCodeAt(_+1)))==56320&&(m=65536+(m-55296<<10)+(v-56320),_++),m<128?g[y++]=m:(m<2048?g[y++]=192|m>>>6:(m<65536?g[y++]=224|m>>>12:(g[y++]=240|m>>>18,g[y++]=128|m>>>12&63),g[y++]=128|m>>>6&63),g[y++]=128|63&m);return g}(p)},s.utf8decode=function(p){return n.nodebuffer?a.transformTo("nodebuffer",p).toString("utf-8"):function(f){var g,m,v,_,y=f.length,x=new Array(2*y);for(g=m=0;g<y;)if((v=f[g++])<128)x[m++]=v;else if(4<(_=c[v]))x[m++]=65533,g+=_-1;else{for(v&=_===2?31:_===3?15:7;1<_&&g<y;)v=v<<6|63&f[g++],_--;1<_?x[m++]=65533:v<65536?x[m++]=v:(v-=65536,x[m++]=55296|v>>10&1023,x[m++]=56320|1023&v)}return x.length!==m&&(x.subarray?x=x.subarray(0,m):x.length=m),a.applyFromCharCode(x)}(p=a.transformTo(n.uint8array?"uint8array":"array",p))},a.inherits(u,l),u.prototype.processChunk=function(p){var f=a.transformTo(n.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var g=f;(f=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),f.set(g,this.leftOver.length)}else f=this.leftOver.concat(f);this.leftOver=null}var m=function(_,y){var x;for((y=y||_.length)>_.length&&(y=_.length),x=y-1;0<=x&&(192&_[x])==128;)x--;return x<0||x===0?y:x+c[_[x]]>y?x:y}(f),v=f;m!==f.length&&(n.uint8array?(v=f.subarray(0,m),this.leftOver=f.subarray(m,f.length)):(v=f.slice(0,m),this.leftOver=f.slice(m,f.length))),this.push({data:s.utf8decode(v),meta:p.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=u,a.inherits(d,l),d.prototype.processChunk=function(p){this.push({data:s.utf8encode(p.data),meta:p.meta})},s.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,r,s){var a=t("./support"),n=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function c(g){return g}function h(g,m){for(var v=0;v<g.length;++v)m[v]=255&g.charCodeAt(v);return m}t("setimmediate"),s.newBlob=function(g,m){s.checkSupport("blob");try{return new Blob([g],{type:m})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(g),v.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(g,m,v){var _=[],y=0,x=g.length;if(x<=v)return String.fromCharCode.apply(null,g);for(;y<x;)m==="array"||m==="nodebuffer"?_.push(String.fromCharCode.apply(null,g.slice(y,Math.min(y+v,x)))):_.push(String.fromCharCode.apply(null,g.subarray(y,Math.min(y+v,x)))),y+=v;return _.join("")},stringifyByChar:function(g){for(var m="",v=0;v<g.length;v++)m+=String.fromCharCode(g[v]);return m},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function d(g){var m=65536,v=s.getTypeOf(g),_=!0;if(v==="uint8array"?_=u.applyCanBeUsed.uint8array:v==="nodebuffer"&&(_=u.applyCanBeUsed.nodebuffer),_)for(;1<m;)try{return u.stringifyByChunk(g,v,m)}catch{m=Math.floor(m/2)}return u.stringifyByChar(g)}function p(g,m){for(var v=0;v<g.length;v++)m[v]=g[v];return m}s.applyFromCharCode=d;var f={};f.string={string:c,array:function(g){return h(g,new Array(g.length))},arraybuffer:function(g){return f.string.uint8array(g).buffer},uint8array:function(g){return h(g,new Uint8Array(g.length))},nodebuffer:function(g){return h(g,o.allocBuffer(g.length))}},f.array={string:d,array:c,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(g)}},f.arraybuffer={string:function(g){return d(new Uint8Array(g))},array:function(g){return p(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:c,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(new Uint8Array(g))}},f.uint8array={string:d,array:function(g){return p(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:c,nodebuffer:function(g){return o.newBufferFrom(g)}},f.nodebuffer={string:d,array:function(g){return p(g,new Array(g.length))},arraybuffer:function(g){return f.nodebuffer.uint8array(g).buffer},uint8array:function(g){return p(g,new Uint8Array(g.length))},nodebuffer:c},s.transformTo=function(g,m){if(m=m||"",!g)return m;s.checkSupport(g);var v=s.getTypeOf(m);return f[v][g](m)},s.resolve=function(g){for(var m=g.split("/"),v=[],_=0;_<m.length;_++){var y=m[_];y==="."||y===""&&_!==0&&_!==m.length-1||(y===".."?v.pop():v.push(y))}return v.join("/")},s.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(g)?"nodebuffer":a.uint8array&&g instanceof Uint8Array?"uint8array":a.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(g){if(!a[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(g){var m,v,_="";for(v=0;v<(g||"").length;v++)_+="\\x"+((m=g.charCodeAt(v))<16?"0":"")+m.toString(16).toUpperCase();return _},s.delay=function(g,m,v){setImmediate(function(){g.apply(v||null,m||[])})},s.inherits=function(g,m){function v(){}v.prototype=m.prototype,g.prototype=new v},s.extend=function(){var g,m,v={};for(g=0;g<arguments.length;g++)for(m in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],m)&&v[m]===void 0&&(v[m]=arguments[g][m]);return v},s.prepareContent=function(g,m,v,_,y){return l.Promise.resolve(m).then(function(x){return a.blob&&(x instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(x))!==-1)&&typeof FileReader<"u"?new l.Promise(function(b,M){var T=new FileReader;T.onload=function(E){b(E.target.result)},T.onerror=function(E){M(E.target.error)},T.readAsArrayBuffer(x)}):x}).then(function(x){var b=s.getTypeOf(x);return b?(b==="arraybuffer"?x=s.transformTo("uint8array",x):b==="string"&&(y?x=n.decode(x):v&&_!==!0&&(x=function(M){return h(M,a.uint8array?new Uint8Array(M.length):new Array(M.length))}(x))),x):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,r,s){var a=t("./reader/readerFor"),n=t("./utils"),o=t("./signature"),l=t("./zipEntry"),c=t("./support");function h(u){this.files=[],this.loadOptions=u}h.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(d)+", expected "+n.pretty(u)+")")}},isSignature:function(u,d){var p=this.reader.index;this.reader.setIndex(u);var f=this.reader.readString(4)===d;return this.reader.setIndex(p),f},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),d=c.uint8array?"uint8array":"array",p=n.transformTo(d,u);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,d,p,f=this.zip64EndOfCentralSize-44;0<f;)u=this.reader.readInt(2),d=this.reader.readInt(4),p=this.reader.readData(d),this.zip64ExtensibleData[u]={id:u,length:d,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,d;for(u=0;u<this.files.length;u++)d=this.files[u],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(u=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var d=u;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var f=d-p;if(0<f)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=f);else if(f<0)throw new Error("Corrupted zip: missing "+Math.abs(f)+" bytes.")},prepareReader:function(u){this.reader=a(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,r,s){var a=t("./reader/readerFor"),n=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),h=t("./compressions"),u=t("./support");function d(p,f){this.options=p,this.loadOptions=f}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var f,g;if(p.skip(22),this.fileNameLength=p.readInt(2),g=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((f=function(m){for(var v in h)if(Object.prototype.hasOwnProperty.call(h,v)&&h[v].magic===m)return h[v];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,f,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var f=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(f),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=a(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var f,g,m,v=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<v;)f=p.readInt(2),g=p.readInt(2),m=p.readData(g),this.extraFields[f]={id:f,length:g,value:m};p.setIndex(v)},handleUTF8:function(){var p=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var f=this.findExtraFieldUnicodePath();if(f!==null)this.fileNameStr=f;else{var g=n.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var v=n.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var f=a(p.value);return f.readInt(1)!==1||l(this.fileName)!==f.readInt(4)?null:c.utf8decode(f.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var f=a(p.value);return f.readInt(1)!==1||l(this.fileComment)!==f.readInt(4)?null:c.utf8decode(f.readData(p.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,r,s){function a(f,g,m){this.name=f,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=g,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var n=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),h=t("./stream/GenericWorker");a.prototype={internalStream:function(f){var g=null,m="string";try{if(!f)throw new Error("No output type specified.");var v=(m=f.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),g=this._decompressWorker();var _=!this._dataBinary;_&&!v&&(g=g.pipe(new l.Utf8EncodeWorker)),!_&&v&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(y){(g=new h("error")).error(y)}return new n(g,m,"")},async:function(f,g){return this.internalStream(f).accumulate(g)},nodeStream:function(f,g){return this.internalStream(f||"nodebuffer").toNodejsStream(g)},_compressWorker:function(f,g){if(this._data instanceof c&&this._data.compression.magic===f.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(m,f,g)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new o(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<u.length;p++)a.prototype[u[p]]=d;r.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,r,s){(function(a){var n,o,l=a.MutationObserver||a.WebKitMutationObserver;if(l){var c=0,h=new l(f),u=a.document.createTextNode("");h.observe(u,{characterData:!0}),n=function(){u.data=c=++c%2}}else if(a.setImmediate||a.MessageChannel===void 0)n="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var g=a.document.createElement("script");g.onreadystatechange=function(){f(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},a.document.documentElement.appendChild(g)}:function(){setTimeout(f,0)};else{var d=new a.MessageChannel;d.port1.onmessage=f,n=function(){d.port2.postMessage(0)}}var p=[];function f(){var g,m;o=!0;for(var v=p.length;v;){for(m=p,p=[],g=-1;++g<v;)m[g]();v=p.length}o=!1}r.exports=function(g){p.push(g)!==1||o||n()}}).call(this,typeof Ch<"u"?Ch:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,r,s){var a=t("immediate");function n(){}var o={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function u(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,v!==n&&g(this,v)}function d(v,_,y){this.promise=v,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function p(v,_,y){a(function(){var x;try{x=_(y)}catch(b){return o.reject(v,b)}x===v?o.reject(v,new TypeError("Cannot resolve promise with itself")):o.resolve(v,x)})}function f(v){var _=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof _=="function")return function(){_.apply(v,arguments)}}function g(v,_){var y=!1;function x(T){y||(y=!0,o.reject(v,T))}function b(T){y||(y=!0,o.resolve(v,T))}var M=m(function(){_(b,x)});M.status==="error"&&x(M.value)}function m(v,_){var y={};try{y.value=v(_),y.status="success"}catch(x){y.status="error",y.value=x}return y}(r.exports=u).prototype.finally=function(v){if(typeof v!="function")return this;var _=this.constructor;return this.then(function(y){return _.resolve(v()).then(function(){return y})},function(y){return _.resolve(v()).then(function(){throw y})})},u.prototype.catch=function(v){return this.then(null,v)},u.prototype.then=function(v,_){if(typeof v!="function"&&this.state===c||typeof _!="function"&&this.state===l)return this;var y=new this.constructor(n);return this.state!==h?p(y,this.state===c?v:_,this.outcome):this.queue.push(new d(y,v,_)),y},d.prototype.callFulfilled=function(v){o.resolve(this.promise,v)},d.prototype.otherCallFulfilled=function(v){p(this.promise,this.onFulfilled,v)},d.prototype.callRejected=function(v){o.reject(this.promise,v)},d.prototype.otherCallRejected=function(v){p(this.promise,this.onRejected,v)},o.resolve=function(v,_){var y=m(f,_);if(y.status==="error")return o.reject(v,y.value);var x=y.value;if(x)g(v,x);else{v.state=c,v.outcome=_;for(var b=-1,M=v.queue.length;++b<M;)v.queue[b].callFulfilled(_)}return v},o.reject=function(v,_){v.state=l,v.outcome=_;for(var y=-1,x=v.queue.length;++y<x;)v.queue[y].callRejected(_);return v},u.resolve=function(v){return v instanceof this?v:o.resolve(new this(n),v)},u.reject=function(v){var _=new this(n);return o.reject(_,v)},u.all=function(v){var _=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=v.length,x=!1;if(!y)return this.resolve([]);for(var b=new Array(y),M=0,T=-1,E=new this(n);++T<y;)C(v[T],T);return E;function C(N,D){_.resolve(N).then(function(A){b[D]=A,++M!==y||x||(x=!0,o.resolve(E,b))},function(A){x||(x=!0,o.reject(E,A))})}},u.race=function(v){var _=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=v.length,x=!1;if(!y)return this.resolve([]);for(var b=-1,M=new this(n);++b<y;)T=v[b],_.resolve(T).then(function(E){x||(x=!0,o.resolve(M,E))},function(E){x||(x=!0,o.reject(M,E))});var T;return M}},{immediate:36}],38:[function(t,r,s){var a={};(0,t("./lib/utils/common").assign)(a,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),r.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,r,s){var a=t("./zlib/deflate"),n=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),h=Object.prototype.toString,u=0,d=-1,p=0,f=8;function g(v){if(!(this instanceof g))return new g(v);this.options=n.assign({level:d,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},v||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=a.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(y!==u)throw new Error(l[y]);if(_.header&&a.deflateSetHeader(this.strm,_.header),_.dictionary){var x;if(x=typeof _.dictionary=="string"?o.string2buf(_.dictionary):h.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(y=a.deflateSetDictionary(this.strm,x))!==u)throw new Error(l[y]);this._dict_set=!0}}function m(v,_){var y=new g(_);if(y.push(v,!0),y.err)throw y.msg||l[y.err];return y.result}g.prototype.push=function(v,_){var y,x,b=this.strm,M=this.options.chunkSize;if(this.ended)return!1;x=_===~~_?_:_===!0?4:0,typeof v=="string"?b.input=o.string2buf(v):h.call(v)==="[object ArrayBuffer]"?b.input=new Uint8Array(v):b.input=v,b.next_in=0,b.avail_in=b.input.length;do{if(b.avail_out===0&&(b.output=new n.Buf8(M),b.next_out=0,b.avail_out=M),(y=a.deflate(b,x))!==1&&y!==u)return this.onEnd(y),!(this.ended=!0);b.avail_out!==0&&(b.avail_in!==0||x!==4&&x!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(n.shrinkBuf(b.output,b.next_out))):this.onData(n.shrinkBuf(b.output,b.next_out)))}while((0<b.avail_in||b.avail_out===0)&&y!==1);return x===4?(y=a.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===u):x!==2||(this.onEnd(u),!(b.avail_out=0))},g.prototype.onData=function(v){this.chunks.push(v)},g.prototype.onEnd=function(v){v===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},s.Deflate=g,s.deflate=m,s.deflateRaw=function(v,_){return(_=_||{}).raw=!0,m(v,_)},s.gzip=function(v,_){return(_=_||{}).gzip=!0,m(v,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,r,s){var a=t("./zlib/inflate"),n=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),h=t("./zlib/zstream"),u=t("./zlib/gzheader"),d=Object.prototype.toString;function p(g){if(!(this instanceof p))return new p(g);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},g||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||g&&g.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&!(15&m.windowBits)&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var v=a.inflateInit2(this.strm,m.windowBits);if(v!==l.Z_OK)throw new Error(c[v]);this.header=new u,a.inflateGetHeader(this.strm,this.header)}function f(g,m){var v=new p(m);if(v.push(g,!0),v.err)throw v.msg||c[v.err];return v.result}p.prototype.push=function(g,m){var v,_,y,x,b,M,T=this.strm,E=this.options.chunkSize,C=this.options.dictionary,N=!1;if(this.ended)return!1;_=m===~~m?m:m===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?T.input=o.binstring2buf(g):d.call(g)==="[object ArrayBuffer]"?T.input=new Uint8Array(g):T.input=g,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new n.Buf8(E),T.next_out=0,T.avail_out=E),(v=a.inflate(T,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&C&&(M=typeof C=="string"?o.string2buf(C):d.call(C)==="[object ArrayBuffer]"?new Uint8Array(C):C,v=a.inflateSetDictionary(this.strm,M)),v===l.Z_BUF_ERROR&&N===!0&&(v=l.Z_OK,N=!1),v!==l.Z_STREAM_END&&v!==l.Z_OK)return this.onEnd(v),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&v!==l.Z_STREAM_END&&(T.avail_in!==0||_!==l.Z_FINISH&&_!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=o.utf8border(T.output,T.next_out),x=T.next_out-y,b=o.buf2string(T.output,y),T.next_out=x,T.avail_out=E-x,x&&n.arraySet(T.output,T.output,y,x,0),this.onData(b)):this.onData(n.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(N=!0)}while((0<T.avail_in||T.avail_out===0)&&v!==l.Z_STREAM_END);return v===l.Z_STREAM_END&&(_=l.Z_FINISH),_===l.Z_FINISH?(v=a.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===l.Z_OK):_!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(T.avail_out=0))},p.prototype.onData=function(g){this.chunks.push(g)},p.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},s.Inflate=p,s.inflate=f,s.inflateRaw=function(g,m){return(m=m||{}).raw=!0,f(g,m)},s.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,r,s){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var u in h)h.hasOwnProperty(u)&&(l[u]=h[u])}}return l},s.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var n={arraySet:function(l,c,h,u,d){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+u),d);else for(var p=0;p<u;p++)l[d+p]=c[h+p]},flattenChunks:function(l){var c,h,u,d,p,f;for(c=u=0,h=l.length;c<h;c++)u+=l[c].length;for(f=new Uint8Array(u),c=d=0,h=l.length;c<h;c++)p=l[c],f.set(p,d),d+=p.length;return f}},o={arraySet:function(l,c,h,u,d){for(var p=0;p<u;p++)l[d+p]=c[h+p]},flattenChunks:function(l){return[].concat.apply([],l)}};s.setTyped=function(l){l?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,n)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,o))},s.setTyped(a)},{}],42:[function(t,r,s){var a=t("./common"),n=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new a.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(u,d){if(d<65537&&(u.subarray&&o||!u.subarray&&n))return String.fromCharCode.apply(null,a.shrinkBuf(u,d));for(var p="",f=0;f<d;f++)p+=String.fromCharCode(u[f]);return p}l[254]=l[254]=1,s.string2buf=function(u){var d,p,f,g,m,v=u.length,_=0;for(g=0;g<v;g++)(64512&(p=u.charCodeAt(g)))==55296&&g+1<v&&(64512&(f=u.charCodeAt(g+1)))==56320&&(p=65536+(p-55296<<10)+(f-56320),g++),_+=p<128?1:p<2048?2:p<65536?3:4;for(d=new a.Buf8(_),g=m=0;m<_;g++)(64512&(p=u.charCodeAt(g)))==55296&&g+1<v&&(64512&(f=u.charCodeAt(g+1)))==56320&&(p=65536+(p-55296<<10)+(f-56320),g++),p<128?d[m++]=p:(p<2048?d[m++]=192|p>>>6:(p<65536?d[m++]=224|p>>>12:(d[m++]=240|p>>>18,d[m++]=128|p>>>12&63),d[m++]=128|p>>>6&63),d[m++]=128|63&p);return d},s.buf2binstring=function(u){return h(u,u.length)},s.binstring2buf=function(u){for(var d=new a.Buf8(u.length),p=0,f=d.length;p<f;p++)d[p]=u.charCodeAt(p);return d},s.buf2string=function(u,d){var p,f,g,m,v=d||u.length,_=new Array(2*v);for(p=f=0;p<v;)if((g=u[p++])<128)_[f++]=g;else if(4<(m=l[g]))_[f++]=65533,p+=m-1;else{for(g&=m===2?31:m===3?15:7;1<m&&p<v;)g=g<<6|63&u[p++],m--;1<m?_[f++]=65533:g<65536?_[f++]=g:(g-=65536,_[f++]=55296|g>>10&1023,_[f++]=56320|1023&g)}return h(_,f)},s.utf8border=function(u,d){var p;for((d=d||u.length)>u.length&&(d=u.length),p=d-1;0<=p&&(192&u[p])==128;)p--;return p<0||p===0?d:p+l[u[p]]>d?p:d}},{"./common":41}],43:[function(t,r,s){r.exports=function(a,n,o,l){for(var c=65535&a|0,h=a>>>16&65535|0,u=0;o!==0;){for(o-=u=2e3<o?2e3:o;h=h+(c=c+n[l++]|0)|0,--u;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(t,r,s){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,r,s){var a=function(){for(var n,o=[],l=0;l<256;l++){n=l;for(var c=0;c<8;c++)n=1&n?3988292384^n>>>1:n>>>1;o[l]=n}return o}();r.exports=function(n,o,l,c){var h=a,u=c+l;n^=-1;for(var d=c;d<u;d++)n=n>>>8^h[255&(n^o[d])];return-1^n}},{}],46:[function(t,r,s){var a,n=t("../utils/common"),o=t("./trees"),l=t("./adler32"),c=t("./crc32"),h=t("./messages"),u=0,d=4,p=0,f=-2,g=-1,m=4,v=2,_=8,y=9,x=286,b=30,M=19,T=2*x+1,E=15,C=3,N=258,D=N+C+1,A=42,L=113,w=1,B=2,$=3,K=4;function ae(S,F){return S.msg=h[F],F}function se(S){return(S<<1)-(4<S?9:0)}function me(S){for(var F=S.length;0<=--F;)S[F]=0}function H(S){var F=S.state,X=F.pending;X>S.avail_out&&(X=S.avail_out),X!==0&&(n.arraySet(S.output,F.pending_buf,F.pending_out,X,S.next_out),S.next_out+=X,F.pending_out+=X,S.total_out+=X,S.avail_out-=X,F.pending-=X,F.pending===0&&(F.pending_out=0))}function W(S,F){o._tr_flush_block(S,0<=S.block_start?S.block_start:-1,S.strstart-S.block_start,F),S.block_start=S.strstart,H(S.strm)}function ce(S,F){S.pending_buf[S.pending++]=F}function te(S,F){S.pending_buf[S.pending++]=F>>>8&255,S.pending_buf[S.pending++]=255&F}function k(S,F){var X,U,P=S.max_chain_length,I=S.strstart,V=S.prev_length,Y=S.nice_match,q=S.strstart>S.w_size-D?S.strstart-(S.w_size-D):0,pe=S.window,_e=S.w_mask,le=S.prev,xe=S.strstart+N,Pe=pe[I+V-1],Re=pe[I+V];S.prev_length>=S.good_match&&(P>>=2),Y>S.lookahead&&(Y=S.lookahead);do if(pe[(X=F)+V]===Re&&pe[X+V-1]===Pe&&pe[X]===pe[I]&&pe[++X]===pe[I+1]){I+=2,X++;do;while(pe[++I]===pe[++X]&&pe[++I]===pe[++X]&&pe[++I]===pe[++X]&&pe[++I]===pe[++X]&&pe[++I]===pe[++X]&&pe[++I]===pe[++X]&&pe[++I]===pe[++X]&&pe[++I]===pe[++X]&&I<xe);if(U=N-(xe-I),I=xe-N,V<U){if(S.match_start=F,Y<=(V=U))break;Pe=pe[I+V-1],Re=pe[I+V]}}while((F=le[F&_e])>q&&--P!=0);return V<=S.lookahead?V:S.lookahead}function z(S){var F,X,U,P,I,V,Y,q,pe,_e,le=S.w_size;do{if(P=S.window_size-S.lookahead-S.strstart,S.strstart>=le+(le-D)){for(n.arraySet(S.window,S.window,le,le,0),S.match_start-=le,S.strstart-=le,S.block_start-=le,F=X=S.hash_size;U=S.head[--F],S.head[F]=le<=U?U-le:0,--X;);for(F=X=le;U=S.prev[--F],S.prev[F]=le<=U?U-le:0,--X;);P+=le}if(S.strm.avail_in===0)break;if(V=S.strm,Y=S.window,q=S.strstart+S.lookahead,pe=P,_e=void 0,_e=V.avail_in,pe<_e&&(_e=pe),X=_e===0?0:(V.avail_in-=_e,n.arraySet(Y,V.input,V.next_in,_e,q),V.state.wrap===1?V.adler=l(V.adler,Y,_e,q):V.state.wrap===2&&(V.adler=c(V.adler,Y,_e,q)),V.next_in+=_e,V.total_in+=_e,_e),S.lookahead+=X,S.lookahead+S.insert>=C)for(I=S.strstart-S.insert,S.ins_h=S.window[I],S.ins_h=(S.ins_h<<S.hash_shift^S.window[I+1])&S.hash_mask;S.insert&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[I+C-1])&S.hash_mask,S.prev[I&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=I,I++,S.insert--,!(S.lookahead+S.insert<C)););}while(S.lookahead<D&&S.strm.avail_in!==0)}function ee(S,F){for(var X,U;;){if(S.lookahead<D){if(z(S),S.lookahead<D&&F===u)return w;if(S.lookahead===0)break}if(X=0,S.lookahead>=C&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+C-1])&S.hash_mask,X=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),X!==0&&S.strstart-X<=S.w_size-D&&(S.match_length=k(S,X)),S.match_length>=C)if(U=o._tr_tally(S,S.strstart-S.match_start,S.match_length-C),S.lookahead-=S.match_length,S.match_length<=S.max_lazy_match&&S.lookahead>=C){for(S.match_length--;S.strstart++,S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+C-1])&S.hash_mask,X=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart,--S.match_length!=0;);S.strstart++}else S.strstart+=S.match_length,S.match_length=0,S.ins_h=S.window[S.strstart],S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+1])&S.hash_mask;else U=o._tr_tally(S,0,S.window[S.strstart]),S.lookahead--,S.strstart++;if(U&&(W(S,!1),S.strm.avail_out===0))return w}return S.insert=S.strstart<C-1?S.strstart:C-1,F===d?(W(S,!0),S.strm.avail_out===0?$:K):S.last_lit&&(W(S,!1),S.strm.avail_out===0)?w:B}function re(S,F){for(var X,U,P;;){if(S.lookahead<D){if(z(S),S.lookahead<D&&F===u)return w;if(S.lookahead===0)break}if(X=0,S.lookahead>=C&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+C-1])&S.hash_mask,X=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),S.prev_length=S.match_length,S.prev_match=S.match_start,S.match_length=C-1,X!==0&&S.prev_length<S.max_lazy_match&&S.strstart-X<=S.w_size-D&&(S.match_length=k(S,X),S.match_length<=5&&(S.strategy===1||S.match_length===C&&4096<S.strstart-S.match_start)&&(S.match_length=C-1)),S.prev_length>=C&&S.match_length<=S.prev_length){for(P=S.strstart+S.lookahead-C,U=o._tr_tally(S,S.strstart-1-S.prev_match,S.prev_length-C),S.lookahead-=S.prev_length-1,S.prev_length-=2;++S.strstart<=P&&(S.ins_h=(S.ins_h<<S.hash_shift^S.window[S.strstart+C-1])&S.hash_mask,X=S.prev[S.strstart&S.w_mask]=S.head[S.ins_h],S.head[S.ins_h]=S.strstart),--S.prev_length!=0;);if(S.match_available=0,S.match_length=C-1,S.strstart++,U&&(W(S,!1),S.strm.avail_out===0))return w}else if(S.match_available){if((U=o._tr_tally(S,0,S.window[S.strstart-1]))&&W(S,!1),S.strstart++,S.lookahead--,S.strm.avail_out===0)return w}else S.match_available=1,S.strstart++,S.lookahead--}return S.match_available&&(U=o._tr_tally(S,0,S.window[S.strstart-1]),S.match_available=0),S.insert=S.strstart<C-1?S.strstart:C-1,F===d?(W(S,!0),S.strm.avail_out===0?$:K):S.last_lit&&(W(S,!1),S.strm.avail_out===0)?w:B}function j(S,F,X,U,P){this.good_length=S,this.max_lazy=F,this.nice_length=X,this.max_chain=U,this.func=P}function Q(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*T),this.dyn_dtree=new n.Buf16(2*(2*b+1)),this.bl_tree=new n.Buf16(2*(2*M+1)),me(this.dyn_ltree),me(this.dyn_dtree),me(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(E+1),this.heap=new n.Buf16(2*x+1),me(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*x+1),me(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function O(S){var F;return S&&S.state?(S.total_in=S.total_out=0,S.data_type=v,(F=S.state).pending=0,F.pending_out=0,F.wrap<0&&(F.wrap=-F.wrap),F.status=F.wrap?A:L,S.adler=F.wrap===2?0:1,F.last_flush=u,o._tr_init(F),p):ae(S,f)}function J(S){var F=O(S);return F===p&&function(X){X.window_size=2*X.w_size,me(X.head),X.max_lazy_match=a[X.level].max_lazy,X.good_match=a[X.level].good_length,X.nice_match=a[X.level].nice_length,X.max_chain_length=a[X.level].max_chain,X.strstart=0,X.block_start=0,X.lookahead=0,X.insert=0,X.match_length=X.prev_length=C-1,X.match_available=0,X.ins_h=0}(S.state),F}function Z(S,F,X,U,P,I){if(!S)return f;var V=1;if(F===g&&(F=6),U<0?(V=0,U=-U):15<U&&(V=2,U-=16),P<1||y<P||X!==_||U<8||15<U||F<0||9<F||I<0||m<I)return ae(S,f);U===8&&(U=9);var Y=new Q;return(S.state=Y).strm=S,Y.wrap=V,Y.gzhead=null,Y.w_bits=U,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=P+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+C-1)/C),Y.window=new n.Buf8(2*Y.w_size),Y.head=new n.Buf16(Y.hash_size),Y.prev=new n.Buf16(Y.w_size),Y.lit_bufsize=1<<P+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new n.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=F,Y.strategy=I,Y.method=X,J(S)}a=[new j(0,0,0,0,function(S,F){var X=65535;for(X>S.pending_buf_size-5&&(X=S.pending_buf_size-5);;){if(S.lookahead<=1){if(z(S),S.lookahead===0&&F===u)return w;if(S.lookahead===0)break}S.strstart+=S.lookahead,S.lookahead=0;var U=S.block_start+X;if((S.strstart===0||S.strstart>=U)&&(S.lookahead=S.strstart-U,S.strstart=U,W(S,!1),S.strm.avail_out===0)||S.strstart-S.block_start>=S.w_size-D&&(W(S,!1),S.strm.avail_out===0))return w}return S.insert=0,F===d?(W(S,!0),S.strm.avail_out===0?$:K):(S.strstart>S.block_start&&(W(S,!1),S.strm.avail_out),w)}),new j(4,4,8,4,ee),new j(4,5,16,8,ee),new j(4,6,32,32,ee),new j(4,4,16,16,re),new j(8,16,32,32,re),new j(8,16,128,128,re),new j(8,32,128,256,re),new j(32,128,258,1024,re),new j(32,258,258,4096,re)],s.deflateInit=function(S,F){return Z(S,F,_,15,8,0)},s.deflateInit2=Z,s.deflateReset=J,s.deflateResetKeep=O,s.deflateSetHeader=function(S,F){return S&&S.state?S.state.wrap!==2?f:(S.state.gzhead=F,p):f},s.deflate=function(S,F){var X,U,P,I;if(!S||!S.state||5<F||F<0)return S?ae(S,f):f;if(U=S.state,!S.output||!S.input&&S.avail_in!==0||U.status===666&&F!==d)return ae(S,S.avail_out===0?-5:f);if(U.strm=S,X=U.last_flush,U.last_flush=F,U.status===A)if(U.wrap===2)S.adler=0,ce(U,31),ce(U,139),ce(U,8),U.gzhead?(ce(U,(U.gzhead.text?1:0)+(U.gzhead.hcrc?2:0)+(U.gzhead.extra?4:0)+(U.gzhead.name?8:0)+(U.gzhead.comment?16:0)),ce(U,255&U.gzhead.time),ce(U,U.gzhead.time>>8&255),ce(U,U.gzhead.time>>16&255),ce(U,U.gzhead.time>>24&255),ce(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),ce(U,255&U.gzhead.os),U.gzhead.extra&&U.gzhead.extra.length&&(ce(U,255&U.gzhead.extra.length),ce(U,U.gzhead.extra.length>>8&255)),U.gzhead.hcrc&&(S.adler=c(S.adler,U.pending_buf,U.pending,0)),U.gzindex=0,U.status=69):(ce(U,0),ce(U,0),ce(U,0),ce(U,0),ce(U,0),ce(U,U.level===9?2:2<=U.strategy||U.level<2?4:0),ce(U,3),U.status=L);else{var V=_+(U.w_bits-8<<4)<<8;V|=(2<=U.strategy||U.level<2?0:U.level<6?1:U.level===6?2:3)<<6,U.strstart!==0&&(V|=32),V+=31-V%31,U.status=L,te(U,V),U.strstart!==0&&(te(U,S.adler>>>16),te(U,65535&S.adler)),S.adler=1}if(U.status===69)if(U.gzhead.extra){for(P=U.pending;U.gzindex<(65535&U.gzhead.extra.length)&&(U.pending!==U.pending_buf_size||(U.gzhead.hcrc&&U.pending>P&&(S.adler=c(S.adler,U.pending_buf,U.pending-P,P)),H(S),P=U.pending,U.pending!==U.pending_buf_size));)ce(U,255&U.gzhead.extra[U.gzindex]),U.gzindex++;U.gzhead.hcrc&&U.pending>P&&(S.adler=c(S.adler,U.pending_buf,U.pending-P,P)),U.gzindex===U.gzhead.extra.length&&(U.gzindex=0,U.status=73)}else U.status=73;if(U.status===73)if(U.gzhead.name){P=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>P&&(S.adler=c(S.adler,U.pending_buf,U.pending-P,P)),H(S),P=U.pending,U.pending===U.pending_buf_size)){I=1;break}I=U.gzindex<U.gzhead.name.length?255&U.gzhead.name.charCodeAt(U.gzindex++):0,ce(U,I)}while(I!==0);U.gzhead.hcrc&&U.pending>P&&(S.adler=c(S.adler,U.pending_buf,U.pending-P,P)),I===0&&(U.gzindex=0,U.status=91)}else U.status=91;if(U.status===91)if(U.gzhead.comment){P=U.pending;do{if(U.pending===U.pending_buf_size&&(U.gzhead.hcrc&&U.pending>P&&(S.adler=c(S.adler,U.pending_buf,U.pending-P,P)),H(S),P=U.pending,U.pending===U.pending_buf_size)){I=1;break}I=U.gzindex<U.gzhead.comment.length?255&U.gzhead.comment.charCodeAt(U.gzindex++):0,ce(U,I)}while(I!==0);U.gzhead.hcrc&&U.pending>P&&(S.adler=c(S.adler,U.pending_buf,U.pending-P,P)),I===0&&(U.status=103)}else U.status=103;if(U.status===103&&(U.gzhead.hcrc?(U.pending+2>U.pending_buf_size&&H(S),U.pending+2<=U.pending_buf_size&&(ce(U,255&S.adler),ce(U,S.adler>>8&255),S.adler=0,U.status=L)):U.status=L),U.pending!==0){if(H(S),S.avail_out===0)return U.last_flush=-1,p}else if(S.avail_in===0&&se(F)<=se(X)&&F!==d)return ae(S,-5);if(U.status===666&&S.avail_in!==0)return ae(S,-5);if(S.avail_in!==0||U.lookahead!==0||F!==u&&U.status!==666){var Y=U.strategy===2?function(q,pe){for(var _e;;){if(q.lookahead===0&&(z(q),q.lookahead===0)){if(pe===u)return w;break}if(q.match_length=0,_e=o._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,_e&&(W(q,!1),q.strm.avail_out===0))return w}return q.insert=0,pe===d?(W(q,!0),q.strm.avail_out===0?$:K):q.last_lit&&(W(q,!1),q.strm.avail_out===0)?w:B}(U,F):U.strategy===3?function(q,pe){for(var _e,le,xe,Pe,Re=q.window;;){if(q.lookahead<=N){if(z(q),q.lookahead<=N&&pe===u)return w;if(q.lookahead===0)break}if(q.match_length=0,q.lookahead>=C&&0<q.strstart&&(le=Re[xe=q.strstart-1])===Re[++xe]&&le===Re[++xe]&&le===Re[++xe]){Pe=q.strstart+N;do;while(le===Re[++xe]&&le===Re[++xe]&&le===Re[++xe]&&le===Re[++xe]&&le===Re[++xe]&&le===Re[++xe]&&le===Re[++xe]&&le===Re[++xe]&&xe<Pe);q.match_length=N-(Pe-xe),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=C?(_e=o._tr_tally(q,1,q.match_length-C),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(_e=o._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),_e&&(W(q,!1),q.strm.avail_out===0))return w}return q.insert=0,pe===d?(W(q,!0),q.strm.avail_out===0?$:K):q.last_lit&&(W(q,!1),q.strm.avail_out===0)?w:B}(U,F):a[U.level].func(U,F);if(Y!==$&&Y!==K||(U.status=666),Y===w||Y===$)return S.avail_out===0&&(U.last_flush=-1),p;if(Y===B&&(F===1?o._tr_align(U):F!==5&&(o._tr_stored_block(U,0,0,!1),F===3&&(me(U.head),U.lookahead===0&&(U.strstart=0,U.block_start=0,U.insert=0))),H(S),S.avail_out===0))return U.last_flush=-1,p}return F!==d?p:U.wrap<=0?1:(U.wrap===2?(ce(U,255&S.adler),ce(U,S.adler>>8&255),ce(U,S.adler>>16&255),ce(U,S.adler>>24&255),ce(U,255&S.total_in),ce(U,S.total_in>>8&255),ce(U,S.total_in>>16&255),ce(U,S.total_in>>24&255)):(te(U,S.adler>>>16),te(U,65535&S.adler)),H(S),0<U.wrap&&(U.wrap=-U.wrap),U.pending!==0?p:1)},s.deflateEnd=function(S){var F;return S&&S.state?(F=S.state.status)!==A&&F!==69&&F!==73&&F!==91&&F!==103&&F!==L&&F!==666?ae(S,f):(S.state=null,F===L?ae(S,-3):p):f},s.deflateSetDictionary=function(S,F){var X,U,P,I,V,Y,q,pe,_e=F.length;if(!S||!S.state||(I=(X=S.state).wrap)===2||I===1&&X.status!==A||X.lookahead)return f;for(I===1&&(S.adler=l(S.adler,F,_e,0)),X.wrap=0,_e>=X.w_size&&(I===0&&(me(X.head),X.strstart=0,X.block_start=0,X.insert=0),pe=new n.Buf8(X.w_size),n.arraySet(pe,F,_e-X.w_size,X.w_size,0),F=pe,_e=X.w_size),V=S.avail_in,Y=S.next_in,q=S.input,S.avail_in=_e,S.next_in=0,S.input=F,z(X);X.lookahead>=C;){for(U=X.strstart,P=X.lookahead-(C-1);X.ins_h=(X.ins_h<<X.hash_shift^X.window[U+C-1])&X.hash_mask,X.prev[U&X.w_mask]=X.head[X.ins_h],X.head[X.ins_h]=U,U++,--P;);X.strstart=U,X.lookahead=C-1,z(X)}return X.strstart+=X.lookahead,X.block_start=X.strstart,X.insert=X.lookahead,X.lookahead=0,X.match_length=X.prev_length=C-1,X.match_available=0,S.next_in=Y,S.input=q,S.avail_in=V,X.wrap=I,p},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,r,s){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,r,s){r.exports=function(a,n){var o,l,c,h,u,d,p,f,g,m,v,_,y,x,b,M,T,E,C,N,D,A,L,w,B;o=a.state,l=a.next_in,w=a.input,c=l+(a.avail_in-5),h=a.next_out,B=a.output,u=h-(n-a.avail_out),d=h+(a.avail_out-257),p=o.dmax,f=o.wsize,g=o.whave,m=o.wnext,v=o.window,_=o.hold,y=o.bits,x=o.lencode,b=o.distcode,M=(1<<o.lenbits)-1,T=(1<<o.distbits)-1;e:do{y<15&&(_+=w[l++]<<y,y+=8,_+=w[l++]<<y,y+=8),E=x[_&M];t:for(;;){if(_>>>=C=E>>>24,y-=C,(C=E>>>16&255)===0)B[h++]=65535&E;else{if(!(16&C)){if(!(64&C)){E=x[(65535&E)+(_&(1<<C)-1)];continue t}if(32&C){o.mode=12;break e}a.msg="invalid literal/length code",o.mode=30;break e}N=65535&E,(C&=15)&&(y<C&&(_+=w[l++]<<y,y+=8),N+=_&(1<<C)-1,_>>>=C,y-=C),y<15&&(_+=w[l++]<<y,y+=8,_+=w[l++]<<y,y+=8),E=b[_&T];i:for(;;){if(_>>>=C=E>>>24,y-=C,!(16&(C=E>>>16&255))){if(!(64&C)){E=b[(65535&E)+(_&(1<<C)-1)];continue i}a.msg="invalid distance code",o.mode=30;break e}if(D=65535&E,y<(C&=15)&&(_+=w[l++]<<y,(y+=8)<C&&(_+=w[l++]<<y,y+=8)),p<(D+=_&(1<<C)-1)){a.msg="invalid distance too far back",o.mode=30;break e}if(_>>>=C,y-=C,(C=h-u)<D){if(g<(C=D-C)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break e}if(L=v,(A=0)===m){if(A+=f-C,C<N){for(N-=C;B[h++]=v[A++],--C;);A=h-D,L=B}}else if(m<C){if(A+=f+m-C,(C-=m)<N){for(N-=C;B[h++]=v[A++],--C;);if(A=0,m<N){for(N-=C=m;B[h++]=v[A++],--C;);A=h-D,L=B}}}else if(A+=m-C,C<N){for(N-=C;B[h++]=v[A++],--C;);A=h-D,L=B}for(;2<N;)B[h++]=L[A++],B[h++]=L[A++],B[h++]=L[A++],N-=3;N&&(B[h++]=L[A++],1<N&&(B[h++]=L[A++]))}else{for(A=h-D;B[h++]=B[A++],B[h++]=B[A++],B[h++]=B[A++],2<(N-=3););N&&(B[h++]=B[A++],1<N&&(B[h++]=B[A++]))}break}}break}}while(l<c&&h<d);l-=N=y>>3,_&=(1<<(y-=N<<3))-1,a.next_in=l,a.next_out=h,a.avail_in=l<c?c-l+5:5-(l-c),a.avail_out=h<d?d-h+257:257-(h-d),o.hold=_,o.bits=y}},{}],49:[function(t,r,s){var a=t("../utils/common"),n=t("./adler32"),o=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),h=1,u=2,d=0,p=-2,f=1,g=852,m=592;function v(A){return(A>>>24&255)+(A>>>8&65280)+((65280&A)<<8)+((255&A)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(A){var L;return A&&A.state?(L=A.state,A.total_in=A.total_out=L.total=0,A.msg="",L.wrap&&(A.adler=1&L.wrap),L.mode=f,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new a.Buf32(g),L.distcode=L.distdyn=new a.Buf32(m),L.sane=1,L.back=-1,d):p}function x(A){var L;return A&&A.state?((L=A.state).wsize=0,L.whave=0,L.wnext=0,y(A)):p}function b(A,L){var w,B;return A&&A.state?(B=A.state,L<0?(w=0,L=-L):(w=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?p:(B.window!==null&&B.wbits!==L&&(B.window=null),B.wrap=w,B.wbits=L,x(A))):p}function M(A,L){var w,B;return A?(B=new _,(A.state=B).window=null,(w=b(A,L))!==d&&(A.state=null),w):p}var T,E,C=!0;function N(A){if(C){var L;for(T=new a.Buf32(512),E=new a.Buf32(32),L=0;L<144;)A.lens[L++]=8;for(;L<256;)A.lens[L++]=9;for(;L<280;)A.lens[L++]=7;for(;L<288;)A.lens[L++]=8;for(c(h,A.lens,0,288,T,0,A.work,{bits:9}),L=0;L<32;)A.lens[L++]=5;c(u,A.lens,0,32,E,0,A.work,{bits:5}),C=!1}A.lencode=T,A.lenbits=9,A.distcode=E,A.distbits=5}function D(A,L,w,B){var $,K=A.state;return K.window===null&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new a.Buf8(K.wsize)),B>=K.wsize?(a.arraySet(K.window,L,w-K.wsize,K.wsize,0),K.wnext=0,K.whave=K.wsize):(B<($=K.wsize-K.wnext)&&($=B),a.arraySet(K.window,L,w-B,$,K.wnext),(B-=$)?(a.arraySet(K.window,L,w-B,B,0),K.wnext=B,K.whave=K.wsize):(K.wnext+=$,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=$))),0}s.inflateReset=x,s.inflateReset2=b,s.inflateResetKeep=y,s.inflateInit=function(A){return M(A,15)},s.inflateInit2=M,s.inflate=function(A,L){var w,B,$,K,ae,se,me,H,W,ce,te,k,z,ee,re,j,Q,O,J,Z,S,F,X,U,P=0,I=new a.Buf8(4),V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!A||!A.state||!A.output||!A.input&&A.avail_in!==0)return p;(w=A.state).mode===12&&(w.mode=13),ae=A.next_out,$=A.output,me=A.avail_out,K=A.next_in,B=A.input,se=A.avail_in,H=w.hold,W=w.bits,ce=se,te=me,F=d;e:for(;;)switch(w.mode){case f:if(w.wrap===0){w.mode=13;break}for(;W<16;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if(2&w.wrap&&H===35615){I[w.check=0]=255&H,I[1]=H>>>8&255,w.check=o(w.check,I,2,0),W=H=0,w.mode=2;break}if(w.flags=0,w.head&&(w.head.done=!1),!(1&w.wrap)||(((255&H)<<8)+(H>>8))%31){A.msg="incorrect header check",w.mode=30;break}if((15&H)!=8){A.msg="unknown compression method",w.mode=30;break}if(W-=4,S=8+(15&(H>>>=4)),w.wbits===0)w.wbits=S;else if(S>w.wbits){A.msg="invalid window size",w.mode=30;break}w.dmax=1<<S,A.adler=w.check=1,w.mode=512&H?10:12,W=H=0;break;case 2:for(;W<16;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if(w.flags=H,(255&w.flags)!=8){A.msg="unknown compression method",w.mode=30;break}if(57344&w.flags){A.msg="unknown header flags set",w.mode=30;break}w.head&&(w.head.text=H>>8&1),512&w.flags&&(I[0]=255&H,I[1]=H>>>8&255,w.check=o(w.check,I,2,0)),W=H=0,w.mode=3;case 3:for(;W<32;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}w.head&&(w.head.time=H),512&w.flags&&(I[0]=255&H,I[1]=H>>>8&255,I[2]=H>>>16&255,I[3]=H>>>24&255,w.check=o(w.check,I,4,0)),W=H=0,w.mode=4;case 4:for(;W<16;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}w.head&&(w.head.xflags=255&H,w.head.os=H>>8),512&w.flags&&(I[0]=255&H,I[1]=H>>>8&255,w.check=o(w.check,I,2,0)),W=H=0,w.mode=5;case 5:if(1024&w.flags){for(;W<16;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}w.length=H,w.head&&(w.head.extra_len=H),512&w.flags&&(I[0]=255&H,I[1]=H>>>8&255,w.check=o(w.check,I,2,0)),W=H=0}else w.head&&(w.head.extra=null);w.mode=6;case 6:if(1024&w.flags&&(se<(k=w.length)&&(k=se),k&&(w.head&&(S=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),a.arraySet(w.head.extra,B,K,k,S)),512&w.flags&&(w.check=o(w.check,B,k,K)),se-=k,K+=k,w.length-=k),w.length))break e;w.length=0,w.mode=7;case 7:if(2048&w.flags){if(se===0)break e;for(k=0;S=B[K+k++],w.head&&S&&w.length<65536&&(w.head.name+=String.fromCharCode(S)),S&&k<se;);if(512&w.flags&&(w.check=o(w.check,B,k,K)),se-=k,K+=k,S)break e}else w.head&&(w.head.name=null);w.length=0,w.mode=8;case 8:if(4096&w.flags){if(se===0)break e;for(k=0;S=B[K+k++],w.head&&S&&w.length<65536&&(w.head.comment+=String.fromCharCode(S)),S&&k<se;);if(512&w.flags&&(w.check=o(w.check,B,k,K)),se-=k,K+=k,S)break e}else w.head&&(w.head.comment=null);w.mode=9;case 9:if(512&w.flags){for(;W<16;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if(H!==(65535&w.check)){A.msg="header crc mismatch",w.mode=30;break}W=H=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0),A.adler=w.check=0,w.mode=12;break;case 10:for(;W<32;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}A.adler=w.check=v(H),W=H=0,w.mode=11;case 11:if(w.havedict===0)return A.next_out=ae,A.avail_out=me,A.next_in=K,A.avail_in=se,w.hold=H,w.bits=W,2;A.adler=w.check=1,w.mode=12;case 12:if(L===5||L===6)break e;case 13:if(w.last){H>>>=7&W,W-=7&W,w.mode=27;break}for(;W<3;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}switch(w.last=1&H,W-=1,3&(H>>>=1)){case 0:w.mode=14;break;case 1:if(N(w),w.mode=20,L!==6)break;H>>>=2,W-=2;break e;case 2:w.mode=17;break;case 3:A.msg="invalid block type",w.mode=30}H>>>=2,W-=2;break;case 14:for(H>>>=7&W,W-=7&W;W<32;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if((65535&H)!=(H>>>16^65535)){A.msg="invalid stored block lengths",w.mode=30;break}if(w.length=65535&H,W=H=0,w.mode=15,L===6)break e;case 15:w.mode=16;case 16:if(k=w.length){if(se<k&&(k=se),me<k&&(k=me),k===0)break e;a.arraySet($,B,K,k,ae),se-=k,K+=k,me-=k,ae+=k,w.length-=k;break}w.mode=12;break;case 17:for(;W<14;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if(w.nlen=257+(31&H),H>>>=5,W-=5,w.ndist=1+(31&H),H>>>=5,W-=5,w.ncode=4+(15&H),H>>>=4,W-=4,286<w.nlen||30<w.ndist){A.msg="too many length or distance symbols",w.mode=30;break}w.have=0,w.mode=18;case 18:for(;w.have<w.ncode;){for(;W<3;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}w.lens[V[w.have++]]=7&H,H>>>=3,W-=3}for(;w.have<19;)w.lens[V[w.have++]]=0;if(w.lencode=w.lendyn,w.lenbits=7,X={bits:w.lenbits},F=c(0,w.lens,0,19,w.lencode,0,w.work,X),w.lenbits=X.bits,F){A.msg="invalid code lengths set",w.mode=30;break}w.have=0,w.mode=19;case 19:for(;w.have<w.nlen+w.ndist;){for(;j=(P=w.lencode[H&(1<<w.lenbits)-1])>>>16&255,Q=65535&P,!((re=P>>>24)<=W);){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if(Q<16)H>>>=re,W-=re,w.lens[w.have++]=Q;else{if(Q===16){for(U=re+2;W<U;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if(H>>>=re,W-=re,w.have===0){A.msg="invalid bit length repeat",w.mode=30;break}S=w.lens[w.have-1],k=3+(3&H),H>>>=2,W-=2}else if(Q===17){for(U=re+3;W<U;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}W-=re,S=0,k=3+(7&(H>>>=re)),H>>>=3,W-=3}else{for(U=re+7;W<U;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}W-=re,S=0,k=11+(127&(H>>>=re)),H>>>=7,W-=7}if(w.have+k>w.nlen+w.ndist){A.msg="invalid bit length repeat",w.mode=30;break}for(;k--;)w.lens[w.have++]=S}}if(w.mode===30)break;if(w.lens[256]===0){A.msg="invalid code -- missing end-of-block",w.mode=30;break}if(w.lenbits=9,X={bits:w.lenbits},F=c(h,w.lens,0,w.nlen,w.lencode,0,w.work,X),w.lenbits=X.bits,F){A.msg="invalid literal/lengths set",w.mode=30;break}if(w.distbits=6,w.distcode=w.distdyn,X={bits:w.distbits},F=c(u,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,X),w.distbits=X.bits,F){A.msg="invalid distances set",w.mode=30;break}if(w.mode=20,L===6)break e;case 20:w.mode=21;case 21:if(6<=se&&258<=me){A.next_out=ae,A.avail_out=me,A.next_in=K,A.avail_in=se,w.hold=H,w.bits=W,l(A,te),ae=A.next_out,$=A.output,me=A.avail_out,K=A.next_in,B=A.input,se=A.avail_in,H=w.hold,W=w.bits,w.mode===12&&(w.back=-1);break}for(w.back=0;j=(P=w.lencode[H&(1<<w.lenbits)-1])>>>16&255,Q=65535&P,!((re=P>>>24)<=W);){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if(j&&!(240&j)){for(O=re,J=j,Z=Q;j=(P=w.lencode[Z+((H&(1<<O+J)-1)>>O)])>>>16&255,Q=65535&P,!(O+(re=P>>>24)<=W);){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}H>>>=O,W-=O,w.back+=O}if(H>>>=re,W-=re,w.back+=re,w.length=Q,j===0){w.mode=26;break}if(32&j){w.back=-1,w.mode=12;break}if(64&j){A.msg="invalid literal/length code",w.mode=30;break}w.extra=15&j,w.mode=22;case 22:if(w.extra){for(U=w.extra;W<U;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}w.length+=H&(1<<w.extra)-1,H>>>=w.extra,W-=w.extra,w.back+=w.extra}w.was=w.length,w.mode=23;case 23:for(;j=(P=w.distcode[H&(1<<w.distbits)-1])>>>16&255,Q=65535&P,!((re=P>>>24)<=W);){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if(!(240&j)){for(O=re,J=j,Z=Q;j=(P=w.distcode[Z+((H&(1<<O+J)-1)>>O)])>>>16&255,Q=65535&P,!(O+(re=P>>>24)<=W);){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}H>>>=O,W-=O,w.back+=O}if(H>>>=re,W-=re,w.back+=re,64&j){A.msg="invalid distance code",w.mode=30;break}w.offset=Q,w.extra=15&j,w.mode=24;case 24:if(w.extra){for(U=w.extra;W<U;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}w.offset+=H&(1<<w.extra)-1,H>>>=w.extra,W-=w.extra,w.back+=w.extra}if(w.offset>w.dmax){A.msg="invalid distance too far back",w.mode=30;break}w.mode=25;case 25:if(me===0)break e;if(k=te-me,w.offset>k){if((k=w.offset-k)>w.whave&&w.sane){A.msg="invalid distance too far back",w.mode=30;break}z=k>w.wnext?(k-=w.wnext,w.wsize-k):w.wnext-k,k>w.length&&(k=w.length),ee=w.window}else ee=$,z=ae-w.offset,k=w.length;for(me<k&&(k=me),me-=k,w.length-=k;$[ae++]=ee[z++],--k;);w.length===0&&(w.mode=21);break;case 26:if(me===0)break e;$[ae++]=w.length,me--,w.mode=21;break;case 27:if(w.wrap){for(;W<32;){if(se===0)break e;se--,H|=B[K++]<<W,W+=8}if(te-=me,A.total_out+=te,w.total+=te,te&&(A.adler=w.check=w.flags?o(w.check,$,te,ae-te):n(w.check,$,te,ae-te)),te=me,(w.flags?H:v(H))!==w.check){A.msg="incorrect data check",w.mode=30;break}W=H=0}w.mode=28;case 28:if(w.wrap&&w.flags){for(;W<32;){if(se===0)break e;se--,H+=B[K++]<<W,W+=8}if(H!==(4294967295&w.total)){A.msg="incorrect length check",w.mode=30;break}W=H=0}w.mode=29;case 29:F=1;break e;case 30:F=-3;break e;case 31:return-4;case 32:default:return p}return A.next_out=ae,A.avail_out=me,A.next_in=K,A.avail_in=se,w.hold=H,w.bits=W,(w.wsize||te!==A.avail_out&&w.mode<30&&(w.mode<27||L!==4))&&D(A,A.output,A.next_out,te-A.avail_out)?(w.mode=31,-4):(ce-=A.avail_in,te-=A.avail_out,A.total_in+=ce,A.total_out+=te,w.total+=te,w.wrap&&te&&(A.adler=w.check=w.flags?o(w.check,$,te,A.next_out-te):n(w.check,$,te,A.next_out-te)),A.data_type=w.bits+(w.last?64:0)+(w.mode===12?128:0)+(w.mode===20||w.mode===15?256:0),(ce==0&&te===0||L===4)&&F===d&&(F=-5),F)},s.inflateEnd=function(A){if(!A||!A.state)return p;var L=A.state;return L.window&&(L.window=null),A.state=null,d},s.inflateGetHeader=function(A,L){var w;return A&&A.state&&2&(w=A.state).wrap?((w.head=L).done=!1,d):p},s.inflateSetDictionary=function(A,L){var w,B=L.length;return A&&A.state?(w=A.state).wrap!==0&&w.mode!==11?p:w.mode===11&&n(1,L,B,0)!==w.check?-3:D(A,L,B,B)?(w.mode=31,-4):(w.havedict=1,d):p},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,r,s){var a=t("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(h,u,d,p,f,g,m,v){var _,y,x,b,M,T,E,C,N,D=v.bits,A=0,L=0,w=0,B=0,$=0,K=0,ae=0,se=0,me=0,H=0,W=null,ce=0,te=new a.Buf16(16),k=new a.Buf16(16),z=null,ee=0;for(A=0;A<=15;A++)te[A]=0;for(L=0;L<p;L++)te[u[d+L]]++;for($=D,B=15;1<=B&&te[B]===0;B--);if(B<$&&($=B),B===0)return f[g++]=20971520,f[g++]=20971520,v.bits=1,0;for(w=1;w<B&&te[w]===0;w++);for($<w&&($=w),A=se=1;A<=15;A++)if(se<<=1,(se-=te[A])<0)return-1;if(0<se&&(h===0||B!==1))return-1;for(k[1]=0,A=1;A<15;A++)k[A+1]=k[A]+te[A];for(L=0;L<p;L++)u[d+L]!==0&&(m[k[u[d+L]]++]=L);if(T=h===0?(W=z=m,19):h===1?(W=n,ce-=257,z=o,ee-=257,256):(W=l,z=c,-1),A=w,M=g,ae=L=H=0,x=-1,b=(me=1<<(K=$))-1,h===1&&852<me||h===2&&592<me)return 1;for(;;){for(E=A-ae,N=m[L]<T?(C=0,m[L]):m[L]>T?(C=z[ee+m[L]],W[ce+m[L]]):(C=96,0),_=1<<A-ae,w=y=1<<K;f[M+(H>>ae)+(y-=_)]=E<<24|C<<16|N|0,y!==0;);for(_=1<<A-1;H&_;)_>>=1;if(_!==0?(H&=_-1,H+=_):H=0,L++,--te[A]==0){if(A===B)break;A=u[d+m[L]]}if($<A&&(H&b)!==x){for(ae===0&&(ae=$),M+=w,se=1<<(K=A-ae);K+ae<B&&!((se-=te[K+ae])<=0);)K++,se<<=1;if(me+=1<<K,h===1&&852<me||h===2&&592<me)return 1;f[x=H&b]=$<<24|K<<16|M-g|0}}return H!==0&&(f[M+H]=A-ae<<24|64<<16|0),v.bits=$,0}},{"../utils/common":41}],51:[function(t,r,s){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,r,s){var a=t("../utils/common"),n=0,o=1;function l(P){for(var I=P.length;0<=--I;)P[I]=0}var c=0,h=29,u=256,d=u+1+h,p=30,f=19,g=2*d+1,m=15,v=16,_=7,y=256,x=16,b=17,M=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],C=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=new Array(2*(d+2));l(D);var A=new Array(2*p);l(A);var L=new Array(512);l(L);var w=new Array(256);l(w);var B=new Array(h);l(B);var $,K,ae,se=new Array(p);function me(P,I,V,Y,q){this.static_tree=P,this.extra_bits=I,this.extra_base=V,this.elems=Y,this.max_length=q,this.has_stree=P&&P.length}function H(P,I){this.dyn_tree=P,this.max_code=0,this.stat_desc=I}function W(P){return P<256?L[P]:L[256+(P>>>7)]}function ce(P,I){P.pending_buf[P.pending++]=255&I,P.pending_buf[P.pending++]=I>>>8&255}function te(P,I,V){P.bi_valid>v-V?(P.bi_buf|=I<<P.bi_valid&65535,ce(P,P.bi_buf),P.bi_buf=I>>v-P.bi_valid,P.bi_valid+=V-v):(P.bi_buf|=I<<P.bi_valid&65535,P.bi_valid+=V)}function k(P,I,V){te(P,V[2*I],V[2*I+1])}function z(P,I){for(var V=0;V|=1&P,P>>>=1,V<<=1,0<--I;);return V>>>1}function ee(P,I,V){var Y,q,pe=new Array(m+1),_e=0;for(Y=1;Y<=m;Y++)pe[Y]=_e=_e+V[Y-1]<<1;for(q=0;q<=I;q++){var le=P[2*q+1];le!==0&&(P[2*q]=z(pe[le]++,le))}}function re(P){var I;for(I=0;I<d;I++)P.dyn_ltree[2*I]=0;for(I=0;I<p;I++)P.dyn_dtree[2*I]=0;for(I=0;I<f;I++)P.bl_tree[2*I]=0;P.dyn_ltree[2*y]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0}function j(P){8<P.bi_valid?ce(P,P.bi_buf):0<P.bi_valid&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0}function Q(P,I,V,Y){var q=2*I,pe=2*V;return P[q]<P[pe]||P[q]===P[pe]&&Y[I]<=Y[V]}function O(P,I,V){for(var Y=P.heap[V],q=V<<1;q<=P.heap_len&&(q<P.heap_len&&Q(I,P.heap[q+1],P.heap[q],P.depth)&&q++,!Q(I,Y,P.heap[q],P.depth));)P.heap[V]=P.heap[q],V=q,q<<=1;P.heap[V]=Y}function J(P,I,V){var Y,q,pe,_e,le=0;if(P.last_lit!==0)for(;Y=P.pending_buf[P.d_buf+2*le]<<8|P.pending_buf[P.d_buf+2*le+1],q=P.pending_buf[P.l_buf+le],le++,Y===0?k(P,q,I):(k(P,(pe=w[q])+u+1,I),(_e=T[pe])!==0&&te(P,q-=B[pe],_e),k(P,pe=W(--Y),V),(_e=E[pe])!==0&&te(P,Y-=se[pe],_e)),le<P.last_lit;);k(P,y,I)}function Z(P,I){var V,Y,q,pe=I.dyn_tree,_e=I.stat_desc.static_tree,le=I.stat_desc.has_stree,xe=I.stat_desc.elems,Pe=-1;for(P.heap_len=0,P.heap_max=g,V=0;V<xe;V++)pe[2*V]!==0?(P.heap[++P.heap_len]=Pe=V,P.depth[V]=0):pe[2*V+1]=0;for(;P.heap_len<2;)pe[2*(q=P.heap[++P.heap_len]=Pe<2?++Pe:0)]=1,P.depth[q]=0,P.opt_len--,le&&(P.static_len-=_e[2*q+1]);for(I.max_code=Pe,V=P.heap_len>>1;1<=V;V--)O(P,pe,V);for(q=xe;V=P.heap[1],P.heap[1]=P.heap[P.heap_len--],O(P,pe,1),Y=P.heap[1],P.heap[--P.heap_max]=V,P.heap[--P.heap_max]=Y,pe[2*q]=pe[2*V]+pe[2*Y],P.depth[q]=(P.depth[V]>=P.depth[Y]?P.depth[V]:P.depth[Y])+1,pe[2*V+1]=pe[2*Y+1]=q,P.heap[1]=q++,O(P,pe,1),2<=P.heap_len;);P.heap[--P.heap_max]=P.heap[1],function(Re,Ee){var $e,ke,vt,st,qi,ie,Ui=Ee.dyn_tree,Jr=Ee.max_code,Lt=Ee.stat_desc.static_tree,wh=Ee.stat_desc.has_stree,Sh=Ee.stat_desc.extra_bits,Sl=Ee.stat_desc.extra_base,ea=Ee.stat_desc.max_length,Xa=0;for(st=0;st<=m;st++)Re.bl_count[st]=0;for(Ui[2*Re.heap[Re.heap_max]+1]=0,$e=Re.heap_max+1;$e<g;$e++)ea<(st=Ui[2*Ui[2*(ke=Re.heap[$e])+1]+1]+1)&&(st=ea,Xa++),Ui[2*ke+1]=st,Jr<ke||(Re.bl_count[st]++,qi=0,Sl<=ke&&(qi=Sh[ke-Sl]),ie=Ui[2*ke],Re.opt_len+=ie*(st+qi),wh&&(Re.static_len+=ie*(Lt[2*ke+1]+qi)));if(Xa!==0){do{for(st=ea-1;Re.bl_count[st]===0;)st--;Re.bl_count[st]--,Re.bl_count[st+1]+=2,Re.bl_count[ea]--,Xa-=2}while(0<Xa);for(st=ea;st!==0;st--)for(ke=Re.bl_count[st];ke!==0;)Jr<(vt=Re.heap[--$e])||(Ui[2*vt+1]!==st&&(Re.opt_len+=(st-Ui[2*vt+1])*Ui[2*vt],Ui[2*vt+1]=st),ke--)}}(P,I),ee(pe,Pe,P.bl_count)}function S(P,I,V){var Y,q,pe=-1,_e=I[1],le=0,xe=7,Pe=4;for(_e===0&&(xe=138,Pe=3),I[2*(V+1)+1]=65535,Y=0;Y<=V;Y++)q=_e,_e=I[2*(Y+1)+1],++le<xe&&q===_e||(le<Pe?P.bl_tree[2*q]+=le:q!==0?(q!==pe&&P.bl_tree[2*q]++,P.bl_tree[2*x]++):le<=10?P.bl_tree[2*b]++:P.bl_tree[2*M]++,pe=q,Pe=(le=0)===_e?(xe=138,3):q===_e?(xe=6,3):(xe=7,4))}function F(P,I,V){var Y,q,pe=-1,_e=I[1],le=0,xe=7,Pe=4;for(_e===0&&(xe=138,Pe=3),Y=0;Y<=V;Y++)if(q=_e,_e=I[2*(Y+1)+1],!(++le<xe&&q===_e)){if(le<Pe)for(;k(P,q,P.bl_tree),--le!=0;);else q!==0?(q!==pe&&(k(P,q,P.bl_tree),le--),k(P,x,P.bl_tree),te(P,le-3,2)):le<=10?(k(P,b,P.bl_tree),te(P,le-3,3)):(k(P,M,P.bl_tree),te(P,le-11,7));pe=q,Pe=(le=0)===_e?(xe=138,3):q===_e?(xe=6,3):(xe=7,4)}}l(se);var X=!1;function U(P,I,V,Y){te(P,(c<<1)+(Y?1:0),3),function(q,pe,_e,le){j(q),ce(q,_e),ce(q,~_e),a.arraySet(q.pending_buf,q.window,pe,_e,q.pending),q.pending+=_e}(P,I,V)}s._tr_init=function(P){X||(function(){var I,V,Y,q,pe,_e=new Array(m+1);for(q=Y=0;q<h-1;q++)for(B[q]=Y,I=0;I<1<<T[q];I++)w[Y++]=q;for(w[Y-1]=q,q=pe=0;q<16;q++)for(se[q]=pe,I=0;I<1<<E[q];I++)L[pe++]=q;for(pe>>=7;q<p;q++)for(se[q]=pe<<7,I=0;I<1<<E[q]-7;I++)L[256+pe++]=q;for(V=0;V<=m;V++)_e[V]=0;for(I=0;I<=143;)D[2*I+1]=8,I++,_e[8]++;for(;I<=255;)D[2*I+1]=9,I++,_e[9]++;for(;I<=279;)D[2*I+1]=7,I++,_e[7]++;for(;I<=287;)D[2*I+1]=8,I++,_e[8]++;for(ee(D,d+1,_e),I=0;I<p;I++)A[2*I+1]=5,A[2*I]=z(I,5);$=new me(D,T,u+1,d,m),K=new me(A,E,0,p,m),ae=new me(new Array(0),C,0,f,_)}(),X=!0),P.l_desc=new H(P.dyn_ltree,$),P.d_desc=new H(P.dyn_dtree,K),P.bl_desc=new H(P.bl_tree,ae),P.bi_buf=0,P.bi_valid=0,re(P)},s._tr_stored_block=U,s._tr_flush_block=function(P,I,V,Y){var q,pe,_e=0;0<P.level?(P.strm.data_type===2&&(P.strm.data_type=function(le){var xe,Pe=4093624447;for(xe=0;xe<=31;xe++,Pe>>>=1)if(1&Pe&&le.dyn_ltree[2*xe]!==0)return n;if(le.dyn_ltree[18]!==0||le.dyn_ltree[20]!==0||le.dyn_ltree[26]!==0)return o;for(xe=32;xe<u;xe++)if(le.dyn_ltree[2*xe]!==0)return o;return n}(P)),Z(P,P.l_desc),Z(P,P.d_desc),_e=function(le){var xe;for(S(le,le.dyn_ltree,le.l_desc.max_code),S(le,le.dyn_dtree,le.d_desc.max_code),Z(le,le.bl_desc),xe=f-1;3<=xe&&le.bl_tree[2*N[xe]+1]===0;xe--);return le.opt_len+=3*(xe+1)+5+5+4,xe}(P),q=P.opt_len+3+7>>>3,(pe=P.static_len+3+7>>>3)<=q&&(q=pe)):q=pe=V+5,V+4<=q&&I!==-1?U(P,I,V,Y):P.strategy===4||pe===q?(te(P,2+(Y?1:0),3),J(P,D,A)):(te(P,4+(Y?1:0),3),function(le,xe,Pe,Re){var Ee;for(te(le,xe-257,5),te(le,Pe-1,5),te(le,Re-4,4),Ee=0;Ee<Re;Ee++)te(le,le.bl_tree[2*N[Ee]+1],3);F(le,le.dyn_ltree,xe-1),F(le,le.dyn_dtree,Pe-1)}(P,P.l_desc.max_code+1,P.d_desc.max_code+1,_e+1),J(P,P.dyn_ltree,P.dyn_dtree)),re(P),Y&&j(P)},s._tr_tally=function(P,I,V){return P.pending_buf[P.d_buf+2*P.last_lit]=I>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&I,P.pending_buf[P.l_buf+P.last_lit]=255&V,P.last_lit++,I===0?P.dyn_ltree[2*V]++:(P.matches++,I--,P.dyn_ltree[2*(w[V]+u+1)]++,P.dyn_dtree[2*W(I)]++),P.last_lit===P.lit_bufsize-1},s._tr_align=function(P){te(P,2,3),k(P,y,D),function(I){I.bi_valid===16?(ce(I,I.bi_buf),I.bi_buf=0,I.bi_valid=0):8<=I.bi_valid&&(I.pending_buf[I.pending++]=255&I.bi_buf,I.bi_buf>>=8,I.bi_valid-=8)}(P)}},{"../utils/common":41}],53:[function(t,r,s){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,r,s){(function(a){(function(n,o){if(!n.setImmediate){var l,c,h,u,d=1,p={},f=!1,g=n.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(n);m=m&&m.setTimeout?m:n,l={}.toString.call(n.process)==="[object process]"?function(x){process.nextTick(function(){_(x)})}:function(){if(n.postMessage&&!n.importScripts){var x=!0,b=n.onmessage;return n.onmessage=function(){x=!1},n.postMessage("","*"),n.onmessage=b,x}}()?(u="setImmediate$"+Math.random()+"$",n.addEventListener?n.addEventListener("message",y,!1):n.attachEvent("onmessage",y),function(x){n.postMessage(u+x,"*")}):n.MessageChannel?((h=new MessageChannel).port1.onmessage=function(x){_(x.data)},function(x){h.port2.postMessage(x)}):g&&"onreadystatechange"in g.createElement("script")?(c=g.documentElement,function(x){var b=g.createElement("script");b.onreadystatechange=function(){_(x),b.onreadystatechange=null,c.removeChild(b),b=null},c.appendChild(b)}):function(x){setTimeout(_,0,x)},m.setImmediate=function(x){typeof x!="function"&&(x=new Function(""+x));for(var b=new Array(arguments.length-1),M=0;M<b.length;M++)b[M]=arguments[M+1];var T={callback:x,args:b};return p[d]=T,l(d),d++},m.clearImmediate=v}function v(x){delete p[x]}function _(x){if(f)setTimeout(_,0,x);else{var b=p[x];if(b){f=!0;try{(function(M){var T=M.callback,E=M.args;switch(E.length){case 0:T();break;case 1:T(E[0]);break;case 2:T(E[0],E[1]);break;case 3:T(E[0],E[1],E[2]);break;default:T.apply(o,E)}})(b)}finally{v(x),f=!1}}}}function y(x){x.source===n&&typeof x.data=="string"&&x.data.indexOf(u)===0&&_(+x.data.slice(u.length))}})(typeof self>"u"?a===void 0?this:a:self)}).call(this,typeof Ch<"u"?Ch:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Dw);var CL=Dw.exports;const RL=Yw(CL);async function PL(){return new Promise((i,e)=>{const t=window.indexedDB.open("threeEditor_db",1);t.onerror=r=>e({event:r,status:!1,message:"数据库打开失败"}),t.onupgradeneeded=r=>{r.target.result.createObjectStore("GLB",{keyPath:"name"})},t.onsuccess=r=>{const s=r.target.result;function a(l,c){return new Promise((h,u)=>{const f=s.transaction(["GLB"],"readwrite").objectStore("GLB").get(l);f.onerror=g=>u({event:g,status:!1,message:"获取失败"}),f.onsuccess=g=>{g.target.result&&!c&&h({event:g,status:!0,message:"获取成功",url:URL.createObjectURL(g.target.result.blob)}),fetch(c).then(m=>m.blob()).then(m=>{const y=s.transaction(["GLB"],"readwrite").objectStore("GLB").put({name:l,blob:m});y.onsuccess=x=>h({event:x,status:!0,message:"文件缓存成功",url:URL.createObjectURL(m)}),y.onerror=x=>u({event:x,status:!1,message:"添加失败"})}).catch(m=>u({e:m,status:!1,message:"新增失败,访问路由异常"}))}})}function n(l){return new Promise((c,h)=>{const p=s.transaction(["GLB"],"readwrite").objectStore("GLB").delete(l);p.onsuccess=f=>c({event:f,status:!0,message:"删除成功"}),p.onerror=f=>h({event:f,status:!1,message:"删除失败"})})}i({getRequest:a,clearRequest:n,getAllRequest:()=>new Promise((l,c)=>{const d=s.transaction(["GLB"],"readonly").objectStore("GLB").getAll();d.onerror=p=>c({event:p,status:!1,message:"获取失败"}),d.onsuccess=p=>l({event:p,status:!0,message:"获取成功",data:p.target.result})}),DATABASE:s,status:!0,message:"数据库打开成功"})}})}const Ow=i=>(Wd("data-v-943291ae"),i=i(),Xd(),i),IL={class:"layout"},LL={class:"header"},NL={class:"header-box"},DL={class:"header-left"},OL={style:{width:"100%",display:"flex","justify-content":"space-between"}},UL={class:"dialog-footer"},kL={class:"title"},FL=Ow(()=>Ie("img",{class:"logo",src:qd,alt:"logo",width:"25px",height:"25px"},null,-1)),BL={class:"header-right"},zL={class:"topl"},VL={style:{"pointer-events":"auto","background-color":"#181818",display:"flex","align-items":"center","border-radius":"3px"}},HL={class:"bot"},GL={class:"opt"},jL=Ow(()=>Ie("pre",null,`            1:选择 2:根选择 3:变换 4:绘制 5:信息
            变换 [r:旋转 g:平移 t:缩放] [ q w e a s d] 方位微调
            tab : 切换模式 z:撤销 y: 反撤销 del: 删除 esc: 退出操作
        `,-1)),WL={class:"main"},XL={__name:"index",setup(i){const e=Kw(()=>PL().then(async g=>{const{data:m}=await g.getAllRequest();return t.IndexDBList=m,t.IndexDB=g,vv(()=>import("./scene-wnN8WF_W.js"),__vite__mapDeps([0,1,2,3]))}).catch(()=>vv(()=>import("./scene-wnN8WF_W.js"),__vite__mapDeps([0,1,2,3]))));let t=zg({info:null,mode:"选择",loading:!1,threeEditor:null,selectPanelEnable:!1,openKey:!1,IndexDB:null,IndexDBList:[],sceneName:localStorage.getItem("sceneName")||""});const r=ds(JSON.parse(localStorage.getItem("sceneList"))||[]),s=ds(!1),a=ds(""),n=ds(null);r.value.find(g=>g.name===t.sceneName)||(r.value.length>0?t.sceneName=r.value[0].name:t.sceneName="");const o=g=>{if(!t.threeEditor)return Gr.error("请先创建场景");const[m,v]=g.name.split(".");if(n.value.clearFiles(),!["fbx","glb","FBX","GLB"].includes(v))return Gr.error("请上传fbx或glb格式的模型");const _=URL.createObjectURL(g.raw);t.IndexDB.getRequest(g.name,_).then(y=>{const x={url:y.url,type:v.toLocaleUpperCase()==="GLB"?"GLTF":v.toLocaleUpperCase(),indexDBNameUrl:"IndexDB:"+g.name},{loaderService:b}=t.threeEditor.modelCore.insertModel(x);b.complete=M=>{const{transformControls:T,camera:E,controls:C}=t.threeEditor,{maxView:N,target:D}=W0(M);Promise.all([Rr(E.position,N),Rr(C.target,D)]).then(()=>{t.threeEditor.setOutlinePass([M]),C.target.copy(D),T.attach(M)})}})};function l(g){const m=r.value.findIndex(v=>v.name===g.name);m>-1&&(r.value.splice(m,1),localStorage.removeItem(g.name),u())}_f(()=>t.sceneName,(g,m)=>{var v,_;g&&setTimeout(()=>t.createScene(),100),(_=(v=t==null?void 0:t.threeEditor)==null?void 0:v.destroySceneRender)==null||_.call(v)}),_f(()=>t.mode,(g,m)=>{g=="选中"?t.threeEditor.handler.mode="选择":g=="根级"?t.threeEditor.handler.mode="根选择":g=="平移"?(t.threeEditor.handler.mode="变换",t.threeEditor.transformControls.setMode("translate")):g=="旋转"?(t.threeEditor.handler.mode="变换",t.threeEditor.transformControls.setMode("rotate")):g=="缩放"?(t.threeEditor.handler.mode="变换",t.threeEditor.transformControls.setMode("scale")):g=="绘制"?t.threeEditor.handler.mode="场景绘制":g=="预览"&&(t.threeEditor.handler.mode="点击信息")});function c(){const g=t.threeEditor.getSceneEditorImage(["image/png","0.8"]),m=document.createElement("a");m.href=g,m.download="myImage.png",m.click()}function h(){if(r.value.some(g=>g.name===a.value))return Gr.error("场景名称已存在");r.value.push({name:a.value}),t.sceneName=a.value,Gr.success(t.sceneName+"添加成功"),u(),s.value=!1}function u(){localStorage.setItem("sceneList",JSON.stringify(r.value)),localStorage.setItem("sceneName",t.sceneName)}function d(){r.value.find(g=>g.name===t.sceneName)?localStorage.setItem(t.sceneName,JSON.stringify(t.threeEditor.saveSceneEdit())):t.sceneName="",Gr.success("保存成功"),u()}function p(){if(!t.threeEditor)return Gr.error("没有可导出的场景");const g=new Blob([JSON.stringify(t.threeEditor.saveSceneEdit())],{type:"application/json"}),m=document.createElement("a");m.href=URL.createObjectURL(g),m.download=t.sceneName||Date.now()+".json",m.click()}async function f(){if(!t.threeEditor)return Gr.error("没有可导出的场景");let g=JSON.stringify(t.threeEditor.saveSceneEdit());const m=/http[s]?:\/\/(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+/g,v=g.match(m),_=[...new Set(v)],y=await Promise.all(_.map(E=>fetch(E).then(C=>C.blob()))),x=new RL;_.forEach((E,C)=>{const N=C+"_"+E.substring(E.lastIndexOf("/")+1);g=g.replace(new RegExp(E,"g"),N),x.file(N,y[C])}),x.file(_.length+"_scene.json",g);const b=await x.generateAsync({type:"blob"}),M=URL.createObjectURL(b),T=document.createElement("a");T.href=M,T.download=t.sceneName||Date.now(),document.body.appendChild(T),T.click(),window.URL.revokeObjectURL(M),document.body.removeChild(T)}return(g,m)=>{const v=Mt("Close"),_=Mt("el-icon"),y=Mt("el-popconfirm"),x=Mt("el-option"),b=Mt("el-select"),M=Mt("el-button"),T=Mt("el-upload"),E=Mt("el-input"),C=Mt("el-dialog"),N=Mt("el-radio-button"),D=Mt("el-radio-group"),A=Mt("el-switch"),L=Zw("loading");return Vg((Xe(),lt("div",IL,[Ie("div",LL,[Ie("div",NL,[Ie("div",DL,[Ue(b,{modelValue:xt(t).sceneName,"onUpdate:modelValue":m[0]||(m[0]=w=>xt(t).sceneName=w),class:"m-2",placeholder:"场景",size:"large",style:{width:"200px"}},{default:He(()=>[(Xe(!0),lt(Wi,null,gr(r.value,w=>(Xe(),Fo(x,{key:w.name,label:w.name,value:w.name,style:{color:"rgb(255, 255, 255)"}},{default:He(()=>[Ie("div",OL,[Ie("span",null,Qi(w.name),1),Ie("span",null,[Ue(y,{title:"确定删除？",onConfirm:()=>l(w)},{reference:He(()=>[Ue(_,{style:{color:"aliceblue"}},{default:He(()=>[Ue(v)]),_:1})]),_:2},1032,["onConfirm"])])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),Ue(M,{class:"btn-add",link:"",icon:"plus",onClick:m[1]||(m[1]=w=>s.value=!0)},{default:He(()=>[gt("新建本地场景")]),_:1}),Ue(T,{class:"upload",ref_key:"myUpload",ref:n,"auto-upload":!1,action:"","on-change":o},{default:He(()=>[Ue(M,{class:"btn-add",link:"",icon:"plus"},{default:He(()=>[gt("导入本地模型到当前场景")]),_:1})]),_:1},512),Ue(C,{modelValue:s.value,"onUpdate:modelValue":m[4]||(m[4]=w=>s.value=w),title:"命名场景",width:"500"},{footer:He(()=>[Ie("div",UL,[Ue(M,{onClick:m[3]||(m[3]=w=>s.value=!1)},{default:He(()=>[gt("取消")]),_:1}),Ue(M,{onClick:h},{default:He(()=>[gt(" 确认 ")]),_:1})])]),default:He(()=>[Ue(E,{modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=w=>a.value=w),placeholder:"请输入场景名称"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),Ie("div",kL,[FL,gt("    "+Qi(xt(t).sceneName||" - - - - "),1)]),Ie("div",BL,[Ue(M,{class:"btn-add",link:"",icon:"Document",onClick:p},{default:He(()=>[gt("模板")]),_:1}),Ue(M,{class:"btn-add",link:""},{default:He(()=>[gt("|")]),_:1}),Ue(M,{class:"btn-add",link:"",onClick:f,icon:"Files"},{default:He(()=>[gt("导出")]),_:1}),Ue(M,{onClick:c,icon:"camera"}),Ue(M,{onClick:m[5]||(m[5]=()=>{var w;return(w=xt(t).threeEditor)==null?void 0:w.openControlPanel()})},{default:He(()=>[gt("控制板")]),_:1}),Ue(M,{onClick:d},{default:He(()=>[gt("保存")]),_:1})])])]),Ue(aL,{emitEditor:xt(t)},null,8,["emitEditor"]),Ue(EL,{emitEditor:xt(t)},null,8,["emitEditor"]),Ie("div",zL,[Ie("div",VL,[Ue(D,{modelValue:xt(t).mode,"onUpdate:modelValue":m[6]||(m[6]=w=>xt(t).mode=w),size:"small",fill:"#181818","text-color":"#a8d4fd"},{default:He(()=>[Ue(N,{label:"选中",value:"选中"}),Ue(N,{label:"根级",value:"根级"}),Ue(N,{label:"平移",value:"平移"}),Ue(N,{label:"旋转",value:"旋转"}),Ue(N,{label:"缩放",value:"缩放"}),Ue(N,{label:"绘制",value:"绘制"}),Ue(N,{label:"预览",value:"预览"})]),_:1},8,["modelValue"])])]),Ie("div",HL,[Ie("div",GL,[Ie("div",null,[Ie("div",null,[Ue(A,{"inactive-text":"选中弹窗",modelValue:xt(t).selectPanelEnable,"onUpdate:modelValue":m[7]||(m[7]=w=>xt(t).selectPanelEnable=w),"active-color":"#a8d4fd",onChange:m[8]||(m[8]=w=>xt(t).threeEditor.handler.selectPanelEnable=w)},null,8,["modelValue"])]),Ie("div",null,[Ue(A,{"inactive-text":"按键操作",modelValue:xt(t).openKey,"onUpdate:modelValue":m[9]||(m[9]=w=>xt(t).openKey=w),"active-color":"#a8d4fd",onChange:m[10]||(m[10]=w=>xt(t).threeEditor.handler.setHandlerOption("openKey",w))},null,8,["modelValue"])])]),jL])]),Ie("div",WL,[Ue(xt(e),{emitEditor:xt(t),options:r.value},null,8,["emitEditor","options"])])])),[[L,xt(t).loading]])}}},qL=Ks(XL,[["__scopeId","data-v-943291ae"]]),JL=Object.freeze(Object.defineProperty({__proto__:null,default:qL},Symbol.toStringTag,{value:"Module"}));export{ZL as R,Bg as c,Rr as d,JL as i};
