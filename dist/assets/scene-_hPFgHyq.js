import{d as p,I as B,a as h}from"./index-DdrEcCz1.js";import{_ as L,i as b,J as v,P as I,o as R,c as S}from"./index-CzM3I--g.js";const w={__name:"scene",props:["emitEditor","options"],setup(u){p.dracoPath="/three-editor/dist/draco/";const a=b(null),e=u;v(()=>e.emitEditor.sceneName!==""&&m());function g(o){e.emitEditor.threeEditor.getSceneEvent(o,t=>{if(e.emitEditor.info=t,t.mode==="点击信息"){const{camera:n,controls:i}=e.emitEditor.threeEditor,d=B(n.position,t.point,.8);h(n.position,d),h(i.target,t.point)}})}function m(o){var c;if(!o){let x=function(r,f){const{IndexDBList:l}=e.emitEditor,E=l.find(_=>_.name===f);E?r.rootInfo.url=URL.createObjectURL(E.blob):o.modelList.splice(o.modelList.indexOf(r),1)};const s=localStorage.getItem(e.emitEditor.sceneName);s&&(o=JSON.parse(s)),(c=o==null?void 0:o.modelList)==null||c.forEach(r=>{if(r.rootInfo.indexDBNameUrl){const[f,l]=r.rootInfo.indexDBNameUrl.split(":");x(r,l)}})}const t=new p(a.value,{pixelRatio:window.devicePixelRatio*1,webglRenderParams:{antialias:!0,alpha:!0,logarithmicDepthBuffer:!0},sceneParams:o});t.scene.children.every(s=>!s.isLight)&&t.setLight();const{mode:i}=t.handler,{transformControls:d}=t;i=="选择"?e.emitEditor.mode="选中":i=="根选择"?e.emitEditor.mode="根级":i=="变换"?d.mode=="translate"?e.emitEditor.mode="平移":d.mode=="rotate"?e.emitEditor.mode="旋转":d.mode=="scale"&&(e.emitEditor.mode="缩放"):i=="场景绘制"?e.emitEditor.mode="绘制":i=="点击信息"&&(e.emitEditor.mode="预览"),e.emitEditor.openKey=t.handler.openKey,e.emitEditor.selectPanelEnable=t.handler.selectPanelEnable,e.emitEditor.threeEditor=t,window.onresize=()=>t.renderSceneResize()}return I(()=>{var o;return(o=e.emitEditor.threeEditor)==null?void 0:o.destroySceneRender()}),e.emitEditor.createScene=m,(o,t)=>(R(),S("div",{class:"threeBox",ref_key:"threeBox",ref:a,onDblclick:t[0]||(t[0]=n=>g(n))},null,544))}},y=L(w,[["__scopeId","data-v-b3a92c8b"]]);export{y as default};
