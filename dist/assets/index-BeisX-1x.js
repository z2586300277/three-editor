const __vite__fileDeps=["assets/scene-CyHyMfiF.js","assets/index-DTzVwJ10.js","assets/index-CToguG_P.css","assets/scene-DEdmxwIK.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{_ as Xs,s as Ug,r as _t,o as Ge,c as it,F as Vi,a as cr,b as Pe,d as mt,t as Xi,e as Oe,u as gt,w as ze,E as zr,f as zd,p as Bd,g as Vd,h as Hd,i as ns,j as kg,v as ax,n as kw,k as uf,l as Bo,m as Fw,T as nx,q as df,x as Sh,y as zw,z as Bw,A as Vw,B as hv}from"./index-DTzVwJ10.js";const pf=localStorage.getItem("dev_local_server_url"),Hw=pf||"https://z2586300277.github.io/three-editor/dist/files/";function Gw(i){function e(s){const n=new DOMParser().parseFromString(s,"text/html");return Array.from(n.querySelectorAll("a")).map(l=>l.textContent).filter(l=>l!=="../"&&l.endsWith("/")).map(l=>l.slice(0,-1))}function t(s){const a=/<a href="([^"]+)">([^<]+)<\/a>\s+(\d{2}-[A-Za-z]{3}-\d{4} \d{2}:\d{2})\s+(\d+)/g,n=[];let o;for(;(o=a.exec(s))!==null;)n.push(o[2]);return n}const r=new XMLHttpRequest;return r.open("GET",i),r.send(),new Promise((s,a)=>r.onload=()=>{r.status===200?i.indexOf("scene")!==-1?s(e(r.responseText)):s(t(r.responseText)):s([])})}const _l=i=>pf?Gw(i):fetch(i+"index.json").then(e=>e.json()),uv={skyUrl:"scene/",buildUrl:"resource/",editorJsonUrl:"editorJson/",fontUrl:"font/",channelUrl:"channels/",iconUrl:"icon/",videoUrl:"video/"},ri=Object.keys(uv).reduce((i,e)=>(i[e]=Hw+uv[e],i),{}),jw={class:"skyList"},Ww={class:"item"},Xw={class:"title"},qw={class:"flex"},Yw={class:"resource"},Zw=["src"],Kw={__name:"sky",props:["emitEditor"],setup(i){const e=i,t=a=>e.emitEditor.threeEditor.scene.setSceneBackground([0,1,2,3,4,5].map(n=>ri.skyUrl+a+"/"+(n+1)+".png")),r=a=>{const{scene:n}=e.emitEditor.threeEditor;n.setEnvBackground([0,1,2,3,4,5].map(o=>ri.skyUrl+a+"/"+(o+1)+".png")),n.environmentEnabled=!0,n.environment=n.envBackground},s=Ug({list:[]});return _l(ri.skyUrl).then(a=>s.list=a),(a,n)=>{const o=_t("el-button");return Ge(),it("div",jw,[(Ge(!0),it(Vi,null,cr(gt(s).list,l=>(Ge(),it("div",Ww,[Pe("div",Xw,[mt(Xi(l)+" ",1),Pe("div",qw,[Oe(o,{onClick:c=>t(l),icon:"CircleCheckFilled",style:{height:"30px",width:"30px"},title:"设为天空"},null,8,["onClick"]),Oe(o,{onClick:c=>r(l),icon:"StarFilled",style:{height:"30px",width:"30px"},title:"设置为环境"},null,8,["onClick"])])]),Pe("div",Yw,[(Ge(),it(Vi,null,cr(6,(c,h)=>Pe("div",null,[Pe("img",{class:"img",src:gt(ri).skyUrl+l+"/"+(h+1)+".png",alt:""},null,8,Zw)])),64))])]))),256))])}}},Qw=Xs(Kw,[["__scopeId","data-v-e8a0bf13"]]);var $w=Object.defineProperty,Jw=Object.defineProperties,eS=Object.getOwnPropertyDescriptors,dv=Object.getOwnPropertySymbols,tS=Object.prototype.hasOwnProperty,iS=Object.prototype.propertyIsEnumerable,rS=Math.pow,mf=(i,e,t)=>e in i?$w(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Re=(i,e)=>{for(var t in e||(e={}))tS.call(e,t)&&mf(i,t,e[t]);if(dv)for(var t of dv(e))iS.call(e,t)&&mf(i,t,e[t]);return i},mi=(i,e)=>Jw(i,eS(e)),pv=(i,e,t)=>(mf(i,typeof e!="symbol"?e+"":e,t),t),os=(i,e,t)=>new Promise((r,s)=>{var a=l=>{try{o(t.next(l))}catch(c){s(c)}},n=l=>{try{o(t.throw(l))}catch(c){s(c)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(a,n);o((t=t.apply(i,e)).next())});const cd="164",un={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},dn={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Gd=1,Fg=2,kr=3,Er=0,Ri=1,Rt=2,Vs=2,$o=5,ar=100,sS=101,aS=102,Jo=200,ih=201,jd=202,Wd=203,Ra=204,Ia=205,rh=206,Xd=207,sh=208,qd=209,nS=210,oS=211,lS=212,cS=213,hS=214,ah=0,ox=1,lx=2,cs=0,Yd=1,Zd=2,Kd=3,Qd=4,zg=5,$d=6,Bg=7,ff="attached",cx="detached",Jd=300,Hs=301,La=302,el=303,wc=304,yl=306,Kt=1e3,bi=1001,Da=1002,lt=1003,ep=1004,Mn=1005,qt=1006,Vo=1007,hs=1008,Fn=1009,tp=1012,Vg=1013,zn=1014,wr=1015,Yt=1016,Hg=1017,Gg=1018,Zn=1020,Hr=1023,An=1026,Bn=1027,jg=1028,Wg=1029,Xg=1031,qg=1033,qu=33776,Yu=33777,Zu=33778,Ku=33779,gf=35840,vf=35841,_f=35842,yf=35843,xf=36196,bf=37492,Mf=37496,wf=37808,Sf=37809,Tf=37810,Ef=37811,Af=37812,Cf=37813,Pf=37814,Rf=37815,If=37816,Lf=37817,Df=37818,Of=37819,Nf=37820,Uf=37821,Qu=36492,kf=36494,Ff=36495,zf=36284,Bf=36285,Vf=36286,Yg=2200,Zg=2201,tl=2300,Vn=2301,$u=2302,wn=2400,Sn=2401,Sc=2402,hx=2500,Kg=2501,Qg=3201,vn="",Mt="srgb",si="srgb-linear",ip="display-p3",nh="display-p3-linear",Tc="linear",bt="srgb",Ec="rec709",Ac="p3",pn=7680,uS=512,dS=513,pS=514,mS=515,fS=516,gS=517,vS=518,_S=519,Cc=35044,Hf="300 es",Hn=2e3,Pc=2001;class fs{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const r=t.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}}const Si=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let mv=1234567;const Cn=Math.PI/180,il=180/Math.PI;function hr(){const i=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Si[255&i]+Si[i>>8&255]+Si[i>>16&255]+Si[i>>24&255]+"-"+Si[255&e]+Si[e>>8&255]+"-"+Si[e>>16&15|64]+Si[e>>24&255]+"-"+Si[63&t|128]+Si[t>>8&255]+"-"+Si[t>>16&255]+Si[t>>24&255]+Si[255&r]+Si[r>>8&255]+Si[r>>16&255]+Si[r>>24&255]).toLowerCase()}function zt(i,e,t){return Math.max(e,Math.min(t,i))}function Gf(i,e){return(i%e+e)%e}function cc(i,e,t){return(1-t)*i+t*e}function zi(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return i/4294967295;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int32Array:return Math.max(i/2147483647,-1);case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Be(i,e){switch(e.constructor){case Float32Array:return i;case Uint32Array:return Math.round(4294967295*i);case Uint16Array:return Math.round(65535*i);case Uint8Array:return Math.round(255*i);case Int32Array:return Math.round(2147483647*i);case Int16Array:return Math.round(32767*i);case Int8Array:return Math.round(127*i);default:throw new Error("Invalid component type.")}}const ni={DEG2RAD:Cn,RAD2DEG:il,generateUUID:hr,clamp:zt,euclideanModulo:Gf,mapLinear:function(i,e,t,r,s){return r+(i-e)*(s-r)/(t-e)},inverseLerp:function(i,e,t){return i!==e?(t-i)/(e-i):0},lerp:cc,damp:function(i,e,t,r){return cc(i,e,1-Math.exp(-t*r))},pingpong:function(i,e=1){return e-Math.abs(Gf(i,2*e)-e)},smoothstep:function(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e))*i*(3-2*i)},smootherstep:function(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e))*i*i*(i*(6*i-15)+10)},randInt:function(i,e){return i+Math.floor(Math.random()*(e-i+1))},randFloat:function(i,e){return i+Math.random()*(e-i)},randFloatSpread:function(i){return i*(.5-Math.random())},seededRandom:function(i){i!==void 0&&(mv=i);let e=mv+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(i){return i*Cn},radToDeg:function(i){return i*il},isPowerOfTwo:function(i){return!(i&i-1)&&i!==0},ceilPowerOfTwo:function(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},floorPowerOfTwo:function(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},setQuaternionFromProperEuler:function(i,e,t,r,s){const a=Math.cos,n=Math.sin,o=a(t/2),l=n(t/2),c=a((e+r)/2),h=n((e+r)/2),u=a((e-r)/2),d=n((e-r)/2),p=a((r-e)/2),f=n((r-e)/2);switch(s){case"XYX":i.set(o*h,l*u,l*d,o*c);break;case"YZY":i.set(l*d,o*h,l*u,o*c);break;case"ZXZ":i.set(l*u,l*d,o*h,o*c);break;case"XZX":i.set(o*h,l*f,l*p,o*c);break;case"YXY":i.set(l*p,o*h,l*f,o*c);break;case"ZYZ":i.set(l*f,l*p,o*h,o*c)}},normalize:Be,denormalize:zi};class se{constructor(e=0,t=0){se.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6],this.y=s[1]*t+s[4]*r+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(zt(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),s=Math.sin(t),a=this.x-e.x,n=this.y-e.y;return this.x=a*r-n*s+e.x,this.y=a*s+n*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ke{constructor(e,t,r,s,a,n,o,l,c){ke.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,s,a,n,o,l,c)}set(e,t,r,s,a,n,o,l,c){const h=this.elements;return h[0]=e,h[1]=s,h[2]=o,h[3]=t,h[4]=a,h[5]=l,h[6]=r,h[7]=n,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,s=t.elements,a=this.elements,n=r[0],o=r[3],l=r[6],c=r[1],h=r[4],u=r[7],d=r[2],p=r[5],f=r[8],g=s[0],m=s[3],v=s[6],_=s[1],y=s[4],x=s[7],b=s[2],M=s[5],T=s[8];return a[0]=n*g+o*_+l*b,a[3]=n*m+o*y+l*M,a[6]=n*v+o*x+l*T,a[1]=c*g+h*_+u*b,a[4]=c*m+h*y+u*M,a[7]=c*v+h*x+u*T,a[2]=d*g+p*_+f*b,a[5]=d*m+p*y+f*M,a[8]=d*v+p*x+f*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],c=e[7],h=e[8];return t*n*h-t*o*c-r*a*h+r*o*l+s*a*c-s*n*l}invert(){const e=this.elements,t=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=h*n-o*c,d=o*l-h*a,p=c*a-n*l,f=t*u+r*d+s*p;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/f;return e[0]=u*g,e[1]=(s*c-h*r)*g,e[2]=(o*r-s*n)*g,e[3]=d*g,e[4]=(h*t-s*l)*g,e[5]=(s*a-o*t)*g,e[6]=p*g,e[7]=(r*l-c*t)*g,e[8]=(n*t-r*a)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,s,a,n,o){const l=Math.cos(a),c=Math.sin(a);return this.set(r*l,r*c,-r*(l*n+c*o)+n+e,-s*c,s*l,-s*(-c*n+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(Dp.makeScale(e,t)),this}rotate(e){return this.premultiply(Dp.makeRotation(-e)),this}translate(e,t){return this.premultiply(Dp.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let s=0;s<9;s++)if(t[s]!==r[s])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Dp=new ke;function ux(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const yS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Ro(i,e){return new yS[i](e)}function Rc(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function dx(){const i=Rc("canvas");return i.style.display="block",i}const fv={};function px(i){i in fv||(fv[i]=!0)}const gv=new ke().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),vv=new ke().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Th={[si]:{transfer:Tc,primaries:Ec,toReference:i=>i,fromReference:i=>i},[Mt]:{transfer:bt,primaries:Ec,toReference:i=>i.convertSRGBToLinear(),fromReference:i=>i.convertLinearToSRGB()},[nh]:{transfer:Tc,primaries:Ac,toReference:i=>i.applyMatrix3(vv),fromReference:i=>i.applyMatrix3(gv)},[ip]:{transfer:bt,primaries:Ac,toReference:i=>i.convertSRGBToLinear().applyMatrix3(vv),fromReference:i=>i.applyMatrix3(gv).convertLinearToSRGB()}},xS=new Set([si,nh]),ct={enabled:!0,_workingColorSpace:si,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(i){if(!xS.has(i))throw new Error(`Unsupported working color space, "${i}".`);this._workingColorSpace=i},convert:function(i,e,t){if(this.enabled===!1||e===t||!e||!t)return i;const r=Th[e].toReference;return(0,Th[t].fromReference)(r(i))},fromWorkingColorSpace:function(i,e){return this.convert(i,this._workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this._workingColorSpace)},getPrimaries:function(i){return Th[i].primaries},getTransfer:function(i){return i===vn?Tc:Th[i].transfer}};function Ho(i){return i<.04045?.0773993808*i:Math.pow(.9478672986*i+.0521327014,2.4)}function Op(i){return i<.0031308?12.92*i:1.055*Math.pow(i,.41666)-.055}let to;class mx{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{to===void 0&&(to=Rc("canvas")),to.width=e.width,to.height=e.height;const r=to.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=to}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Rc("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height),a=s.data;for(let n=0;n<a.length;n++)a[n]=255*Ho(a[n]/255);return r.putImageData(s,0,0),t}if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(255*Ho(t[r]/255)):t[r]=Ho(t[r]);return{data:t,width:e.width,height:e.height}}return e}}let bS=0;class _n{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:bS++}),this.uuid=hr(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},s=this.data;if(s!==null){let a;if(Array.isArray(s)){a=[];for(let n=0,o=s.length;n<o;n++)s[n].isDataTexture?a.push(Np(s[n].image)):a.push(Np(s[n]))}else a=Np(s);r.url=a}return t||(e.images[this.uuid]=r),r}}function Np(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?mx.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:{}}let MS=0;class yt extends fs{constructor(e=yt.DEFAULT_IMAGE,t=yt.DEFAULT_MAPPING,r=bi,s=bi,a=1006,n=1008,o=1023,l=1009,c=yt.DEFAULT_ANISOTROPY,h=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:MS++}),this.uuid=hr(),this.name="",this.source=new _n(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=a,this.minFilter=n,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new se(0,0),this.repeat=new se(1,1),this.center=new se(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ke,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Jd)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Kt:e.x=e.x-Math.floor(e.x);break;case bi:e.x=e.x<0?0:1;break;case Da:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Kt:e.y=e.y-Math.floor(e.y);break;case bi:e.y=e.y<0?0:1;break;case Da:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}yt.DEFAULT_IMAGE=null,yt.DEFAULT_MAPPING=Jd,yt.DEFAULT_ANISOTROPY=1;class qe{constructor(e=0,t=0,r=0,s=1){qe.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,s){return this.x=e,this.y=t,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,s=this.z,a=this.w,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*s+n[12]*a,this.y=n[1]*t+n[5]*r+n[9]*s+n[13]*a,this.z=n[2]*t+n[6]*r+n[10]*s+n[14]*a,this.w=n[3]*t+n[7]*r+n[11]*s+n[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,s,a;const n=e.elements,o=n[0],l=n[4],c=n[8],h=n[1],u=n[5],d=n[9],p=n[2],f=n[6],g=n[10];if(Math.abs(l-h)<.01&&Math.abs(c-p)<.01&&Math.abs(d-f)<.01){if(Math.abs(l+h)<.1&&Math.abs(c+p)<.1&&Math.abs(d+f)<.1&&Math.abs(o+u+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const v=(o+1)/2,_=(u+1)/2,y=(g+1)/2,x=(l+h)/4,b=(c+p)/4,M=(d+f)/4;return v>_&&v>y?v<.01?(r=0,s=.707106781,a=.707106781):(r=Math.sqrt(v),s=x/r,a=b/r):_>y?_<.01?(r=.707106781,s=0,a=.707106781):(s=Math.sqrt(_),r=x/s,a=M/s):y<.01?(r=.707106781,s=.707106781,a=0):(a=Math.sqrt(y),r=b/a,s=M/a),this.set(r,s,a,t),this}let m=Math.sqrt((f-d)*(f-d)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(m)<.001&&(m=1),this.x=(f-d)/m,this.y=(c-p)/m,this.z=(h-l)/m,this.w=Math.acos((o+u+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class fx extends fs{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new qe(0,0,e,t),this.scissorTest=!1,this.viewport=new qe(0,0,e,t);const s={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:qt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const a=new yt(s,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);a.flipY=!1,a.generateMipmaps=r.generateMipmaps,a.internalFormat=r.internalFormat,this.textures=[];const n=r.count;for(let o=0;o<n;o++)this.textures[o]=a.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let s=0,a=this.textures.length;s<a;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,s=e.textures.length;r<s;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new _n(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class pt extends fx{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class hd extends yt{constructor(e=null,t=1,r=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:s},this.magFilter=lt,this.minFilter=lt,this.wrapR=bi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class jf extends yt{constructor(e=null,t=1,r=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:s},this.magFilter=lt,this.minFilter=lt,this.wrapR=bi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Qe{constructor(e=0,t=0,r=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=s}static slerpFlat(e,t,r,s,a,n,o){let l=r[s+0],c=r[s+1],h=r[s+2],u=r[s+3];const d=a[n+0],p=a[n+1],f=a[n+2],g=a[n+3];if(o===0)return e[t+0]=l,e[t+1]=c,e[t+2]=h,void(e[t+3]=u);if(o===1)return e[t+0]=d,e[t+1]=p,e[t+2]=f,void(e[t+3]=g);if(u!==g||l!==d||c!==p||h!==f){let m=1-o;const v=l*d+c*p+h*f+u*g,_=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){const b=Math.sqrt(y),M=Math.atan2(b,v*_);m=Math.sin(m*M)/b,o=Math.sin(o*M)/b}const x=o*_;if(l=l*m+d*x,c=c*m+p*x,h=h*m+f*x,u=u*m+g*x,m===1-o){const b=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=b,c*=b,h*=b,u*=b}}e[t]=l,e[t+1]=c,e[t+2]=h,e[t+3]=u}static multiplyQuaternionsFlat(e,t,r,s,a,n){const o=r[s],l=r[s+1],c=r[s+2],h=r[s+3],u=a[n],d=a[n+1],p=a[n+2],f=a[n+3];return e[t]=o*f+h*u+l*p-c*d,e[t+1]=l*f+h*d+c*u-o*p,e[t+2]=c*f+h*p+o*d-l*u,e[t+3]=h*f-o*u-l*d-c*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,s){return this._x=e,this._y=t,this._z=r,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,s=e._y,a=e._z,n=e._order,o=Math.cos,l=Math.sin,c=o(r/2),h=o(s/2),u=o(a/2),d=l(r/2),p=l(s/2),f=l(a/2);switch(n){case"XYZ":this._x=d*h*u+c*p*f,this._y=c*p*u-d*h*f,this._z=c*h*f+d*p*u,this._w=c*h*u-d*p*f;break;case"YXZ":this._x=d*h*u+c*p*f,this._y=c*p*u-d*h*f,this._z=c*h*f-d*p*u,this._w=c*h*u+d*p*f;break;case"ZXY":this._x=d*h*u-c*p*f,this._y=c*p*u+d*h*f,this._z=c*h*f+d*p*u,this._w=c*h*u-d*p*f;break;case"ZYX":this._x=d*h*u-c*p*f,this._y=c*p*u+d*h*f,this._z=c*h*f-d*p*u,this._w=c*h*u+d*p*f;break;case"YZX":this._x=d*h*u+c*p*f,this._y=c*p*u+d*h*f,this._z=c*h*f-d*p*u,this._w=c*h*u-d*p*f;break;case"XZY":this._x=d*h*u-c*p*f,this._y=c*p*u-d*h*f,this._z=c*h*f+d*p*u,this._w=c*h*u+d*p*f}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],s=t[4],a=t[8],n=t[1],o=t[5],l=t[9],c=t[2],h=t[6],u=t[10],d=r+o+u;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(h-l)*p,this._y=(a-c)*p,this._z=(n-s)*p}else if(r>o&&r>u){const p=2*Math.sqrt(1+r-o-u);this._w=(h-l)/p,this._x=.25*p,this._y=(s+n)/p,this._z=(a+c)/p}else if(o>u){const p=2*Math.sqrt(1+o-r-u);this._w=(a-c)/p,this._x=(s+n)/p,this._y=.25*p,this._z=(l+h)/p}else{const p=2*Math.sqrt(1+u-r-o);this._w=(n-s)/p,this._x=(a+c)/p,this._y=(l+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(zt(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const s=Math.min(1,t/r);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,s=e._y,a=e._z,n=e._w,o=t._x,l=t._y,c=t._z,h=t._w;return this._x=r*h+n*o+s*c-a*l,this._y=s*h+n*l+a*o-r*c,this._z=a*h+n*c+r*l-s*o,this._w=n*h-r*o-s*l-a*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,s=this._y,a=this._z,n=this._w;let o=n*e._w+r*e._x+s*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=n,this._x=r,this._y=s,this._z=a,this;const l=1-o*o;if(l<=Number.EPSILON){const p=1-t;return this._w=p*n+t*this._w,this._x=p*r+t*this._x,this._y=p*s+t*this._y,this._z=p*a+t*this._z,this.normalize(),this}const c=Math.sqrt(l),h=Math.atan2(c,o),u=Math.sin((1-t)*h)/c,d=Math.sin(t*h)/c;return this._w=n*u+this._w*d,this._x=r*u+this._x*d,this._y=s*u+this._y*d,this._z=a*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),s=Math.sqrt(1-r),a=Math.sqrt(r);return this.set(s*Math.sin(e),s*Math.cos(e),a*Math.sin(t),a*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class C{constructor(e=0,t=0,r=0){C.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_v.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_v.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,s=this.z,a=e.elements;return this.x=a[0]*t+a[3]*r+a[6]*s,this.y=a[1]*t+a[4]*r+a[7]*s,this.z=a[2]*t+a[5]*r+a[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,s=this.z,a=e.elements,n=1/(a[3]*t+a[7]*r+a[11]*s+a[15]);return this.x=(a[0]*t+a[4]*r+a[8]*s+a[12])*n,this.y=(a[1]*t+a[5]*r+a[9]*s+a[13])*n,this.z=(a[2]*t+a[6]*r+a[10]*s+a[14])*n,this}applyQuaternion(e){const t=this.x,r=this.y,s=this.z,a=e.x,n=e.y,o=e.z,l=e.w,c=2*(n*s-o*r),h=2*(o*t-a*s),u=2*(a*r-n*t);return this.x=t+l*c+n*u-o*h,this.y=r+l*h+o*c-a*u,this.z=s+l*u+a*h-n*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,s=this.z,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*s,this.y=a[1]*t+a[5]*r+a[9]*s,this.z=a[2]*t+a[6]*r+a[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,s=e.y,a=e.z,n=t.x,o=t.y,l=t.z;return this.x=s*l-a*o,this.y=a*n-r*l,this.z=r*o-s*n,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Up.copy(this).projectOnVector(e),this.sub(Up)}reflect(e){return this.sub(Up.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(zt(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,s=this.z-e.z;return t*t+r*r+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const s=Math.sin(t)*e;return this.x=s*Math.sin(r),this.y=Math.cos(t)*e,this.z=s*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Up=new C,_v=new Qe;class Tt{constructor(e=new C(1/0,1/0,1/0),t=new C(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Lr.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Lr.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Lr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const a=r.getAttribute("position");if(t===!0&&a!==void 0&&e.isInstancedMesh!==!0)for(let n=0,o=a.count;n<o;n++)e.isMesh===!0?e.getVertexPosition(n,Lr):Lr.fromBufferAttribute(a,n),Lr.applyMatrix4(e.matrixWorld),this.expandByPoint(Lr);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Eh.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Eh.copy(r.boundingBox)),Eh.applyMatrix4(e.matrixWorld),this.union(Eh)}const s=e.children;for(let a=0,n=s.length;a<n;a++)this.expandByObject(s[a],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Lr),Lr.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Tl),Ah.subVectors(this.max,Tl),io.subVectors(e.a,Tl),ro.subVectors(e.b,Tl),so.subVectors(e.c,Tl),Js.subVectors(ro,io),ea.subVectors(so,ro),Xa.subVectors(io,so);let t=[0,-Js.z,Js.y,0,-ea.z,ea.y,0,-Xa.z,Xa.y,Js.z,0,-Js.x,ea.z,0,-ea.x,Xa.z,0,-Xa.x,-Js.y,Js.x,0,-ea.y,ea.x,0,-Xa.y,Xa.x,0];return!!kp(t,io,ro,so,Ah)&&(t=[1,0,0,0,1,0,0,0,1],!!kp(t,io,ro,so,Ah)&&(Ch.crossVectors(Js,ea),t=[Ch.x,Ch.y,Ch.z],kp(t,io,ro,so,Ah)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Lr).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Lr).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Ss[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ss[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ss[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ss[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ss[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ss[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ss[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ss[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ss)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ss=[new C,new C,new C,new C,new C,new C,new C,new C],Lr=new C,Eh=new Tt,io=new C,ro=new C,so=new C,Js=new C,ea=new C,Xa=new C,Tl=new C,Ah=new C,Ch=new C,qa=new C;function kp(i,e,t,r,s){for(let a=0,n=i.length-3;a<=n;a+=3){qa.fromArray(i,a);const o=s.x*Math.abs(qa.x)+s.y*Math.abs(qa.y)+s.z*Math.abs(qa.z),l=e.dot(qa),c=t.dot(qa),h=r.dot(qa);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>o)return!1}return!0}const wS=new Tt,El=new C,Fp=new C;class oi{constructor(e=new C,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):wS.setFromPoints(e).getCenter(r);let s=0;for(let a=0,n=e.length;a<n;a++)s=Math.max(s,r.distanceToSquared(e[a]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;El.subVectors(e,this.center);const t=El.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),s=.5*(r-this.radius);this.center.addScaledVector(El,s/r),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Fp.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(El.copy(e.center).add(Fp)),this.expandByPoint(El.copy(e.center).sub(Fp))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ts=new C,zp=new C,Ph=new C,ta=new C,Bp=new C,Rh=new C,Vp=new C;class Kn{constructor(e=new C,t=new C(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ts)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ts.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ts.copy(this.origin).addScaledVector(this.direction,t),Ts.distanceToSquared(e))}distanceSqToSegment(e,t,r,s){zp.copy(e).add(t).multiplyScalar(.5),Ph.copy(t).sub(e).normalize(),ta.copy(this.origin).sub(zp);const a=.5*e.distanceTo(t),n=-this.direction.dot(Ph),o=ta.dot(this.direction),l=-ta.dot(Ph),c=ta.lengthSq(),h=Math.abs(1-n*n);let u,d,p,f;if(h>0)if(u=n*l-o,d=n*o-l,f=a*h,u>=0)if(d>=-f)if(d<=f){const g=1/h;u*=g,d*=g,p=u*(u+n*d+2*o)+d*(n*u+d+2*l)+c}else d=a,u=Math.max(0,-(n*d+o)),p=-u*u+d*(d+2*l)+c;else d=-a,u=Math.max(0,-(n*d+o)),p=-u*u+d*(d+2*l)+c;else d<=-f?(u=Math.max(0,-(-n*a+o)),d=u>0?-a:Math.min(Math.max(-a,-l),a),p=-u*u+d*(d+2*l)+c):d<=f?(u=0,d=Math.min(Math.max(-a,-l),a),p=d*(d+2*l)+c):(u=Math.max(0,-(n*a+o)),d=u>0?a:Math.min(Math.max(-a,-l),a),p=-u*u+d*(d+2*l)+c);else d=n>0?-a:a,u=Math.max(0,-(n*d+o)),p=-u*u+d*(d+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,u),s&&s.copy(zp).addScaledVector(Ph,d),p}intersectSphere(e,t){Ts.subVectors(e.center,this.origin);const r=Ts.dot(this.direction),s=Ts.dot(Ts)-r*r,a=e.radius*e.radius;if(s>a)return null;const n=Math.sqrt(a-s),o=r-n,l=r+n;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0?!0:e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,s,a,n,o,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(r=(e.min.x-d.x)*c,s=(e.max.x-d.x)*c):(r=(e.max.x-d.x)*c,s=(e.min.x-d.x)*c),h>=0?(a=(e.min.y-d.y)*h,n=(e.max.y-d.y)*h):(a=(e.max.y-d.y)*h,n=(e.min.y-d.y)*h),r>n||a>s?null:((a>r||isNaN(r))&&(r=a),(n<s||isNaN(s))&&(s=n),u>=0?(o=(e.min.z-d.z)*u,l=(e.max.z-d.z)*u):(o=(e.max.z-d.z)*u,l=(e.min.z-d.z)*u),r>l||o>s?null:((o>r||r!=r)&&(r=o),(l<s||s!=s)&&(s=l),s<0?null:this.at(r>=0?r:s,t)))}intersectsBox(e){return this.intersectBox(e,Ts)!==null}intersectTriangle(e,t,r,s,a){Bp.subVectors(t,e),Rh.subVectors(r,e),Vp.crossVectors(Bp,Rh);let n,o=this.direction.dot(Vp);if(o>0){if(s)return null;n=1}else{if(!(o<0))return null;n=-1,o=-o}ta.subVectors(this.origin,e);const l=n*this.direction.dot(Rh.crossVectors(ta,Rh));if(l<0)return null;const c=n*this.direction.dot(Bp.cross(ta));if(c<0||l+c>o)return null;const h=-n*ta.dot(Vp);return h<0?null:this.at(h/o,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Me{constructor(e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m){Me.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m)}set(e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m){const v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=s,v[1]=a,v[5]=n,v[9]=o,v[13]=l,v[2]=c,v[6]=h,v[10]=u,v[14]=d,v[3]=p,v[7]=f,v[11]=g,v[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Me().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,s=1/ao.setFromMatrixColumn(e,0).length(),a=1/ao.setFromMatrixColumn(e,1).length(),n=1/ao.setFromMatrixColumn(e,2).length();return t[0]=r[0]*s,t[1]=r[1]*s,t[2]=r[2]*s,t[3]=0,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=0,t[8]=r[8]*n,t[9]=r[9]*n,t[10]=r[10]*n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,s=e.y,a=e.z,n=Math.cos(r),o=Math.sin(r),l=Math.cos(s),c=Math.sin(s),h=Math.cos(a),u=Math.sin(a);if(e.order==="XYZ"){const d=n*h,p=n*u,f=o*h,g=o*u;t[0]=l*h,t[4]=-l*u,t[8]=c,t[1]=p+f*c,t[5]=d-g*c,t[9]=-o*l,t[2]=g-d*c,t[6]=f+p*c,t[10]=n*l}else if(e.order==="YXZ"){const d=l*h,p=l*u,f=c*h,g=c*u;t[0]=d+g*o,t[4]=f*o-p,t[8]=n*c,t[1]=n*u,t[5]=n*h,t[9]=-o,t[2]=p*o-f,t[6]=g+d*o,t[10]=n*l}else if(e.order==="ZXY"){const d=l*h,p=l*u,f=c*h,g=c*u;t[0]=d-g*o,t[4]=-n*u,t[8]=f+p*o,t[1]=p+f*o,t[5]=n*h,t[9]=g-d*o,t[2]=-n*c,t[6]=o,t[10]=n*l}else if(e.order==="ZYX"){const d=n*h,p=n*u,f=o*h,g=o*u;t[0]=l*h,t[4]=f*c-p,t[8]=d*c+g,t[1]=l*u,t[5]=g*c+d,t[9]=p*c-f,t[2]=-c,t[6]=o*l,t[10]=n*l}else if(e.order==="YZX"){const d=n*l,p=n*c,f=o*l,g=o*c;t[0]=l*h,t[4]=g-d*u,t[8]=f*u+p,t[1]=u,t[5]=n*h,t[9]=-o*h,t[2]=-c*h,t[6]=p*u+f,t[10]=d-g*u}else if(e.order==="XZY"){const d=n*l,p=n*c,f=o*l,g=o*c;t[0]=l*h,t[4]=-u,t[8]=c*h,t[1]=d*u+g,t[5]=n*h,t[9]=p*u-f,t[2]=f*u-p,t[6]=o*h,t[10]=g*u+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(SS,e,TS)}lookAt(e,t,r){const s=this.elements;return Ji.subVectors(e,t),Ji.lengthSq()===0&&(Ji.z=1),Ji.normalize(),ia.crossVectors(r,Ji),ia.lengthSq()===0&&(Math.abs(r.z)===1?Ji.x+=1e-4:Ji.z+=1e-4,Ji.normalize(),ia.crossVectors(r,Ji)),ia.normalize(),Ih.crossVectors(Ji,ia),s[0]=ia.x,s[4]=Ih.x,s[8]=Ji.x,s[1]=ia.y,s[5]=Ih.y,s[9]=Ji.y,s[2]=ia.z,s[6]=Ih.z,s[10]=Ji.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,s=t.elements,a=this.elements,n=r[0],o=r[4],l=r[8],c=r[12],h=r[1],u=r[5],d=r[9],p=r[13],f=r[2],g=r[6],m=r[10],v=r[14],_=r[3],y=r[7],x=r[11],b=r[15],M=s[0],T=s[4],A=s[8],L=s[12],U=s[1],P=s[5],E=s[9],I=s[13],S=s[2],V=s[6],J=s[10],X=s[14],te=s[3],ie=s[7],fe=s[11],B=s[15];return a[0]=n*M+o*U+l*S+c*te,a[4]=n*T+o*P+l*V+c*ie,a[8]=n*A+o*E+l*J+c*fe,a[12]=n*L+o*I+l*X+c*B,a[1]=h*M+u*U+d*S+p*te,a[5]=h*T+u*P+d*V+p*ie,a[9]=h*A+u*E+d*J+p*fe,a[13]=h*L+u*I+d*X+p*B,a[2]=f*M+g*U+m*S+v*te,a[6]=f*T+g*P+m*V+v*ie,a[10]=f*A+g*E+m*J+v*fe,a[14]=f*L+g*I+m*X+v*B,a[3]=_*M+y*U+x*S+b*te,a[7]=_*T+y*P+x*V+b*ie,a[11]=_*A+y*E+x*J+b*fe,a[15]=_*L+y*I+x*X+b*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],s=e[8],a=e[12],n=e[1],o=e[5],l=e[9],c=e[13],h=e[2],u=e[6],d=e[10],p=e[14];return e[3]*(+a*l*u-s*c*u-a*o*d+r*c*d+s*o*p-r*l*p)+e[7]*(+t*l*p-t*c*d+a*n*d-s*n*p+s*c*h-a*l*h)+e[11]*(+t*c*u-t*o*p-a*n*u+r*n*p+a*o*h-r*c*h)+e[15]*(-s*o*h-t*l*u+t*o*d+s*n*u-r*n*d+r*l*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],s=e[2],a=e[3],n=e[4],o=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],v=e[15],_=u*m*c-g*d*c+g*l*p-o*m*p-u*l*v+o*d*v,y=f*d*c-h*m*c-f*l*p+n*m*p+h*l*v-n*d*v,x=h*g*c-f*u*c+f*o*p-n*g*p-h*o*v+n*u*v,b=f*u*l-h*g*l-f*o*d+n*g*d+h*o*m-n*u*m,M=t*_+r*y+s*x+a*b;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/M;return e[0]=_*T,e[1]=(g*d*a-u*m*a-g*s*p+r*m*p+u*s*v-r*d*v)*T,e[2]=(o*m*a-g*l*a+g*s*c-r*m*c-o*s*v+r*l*v)*T,e[3]=(u*l*a-o*d*a-u*s*c+r*d*c+o*s*p-r*l*p)*T,e[4]=y*T,e[5]=(h*m*a-f*d*a+f*s*p-t*m*p-h*s*v+t*d*v)*T,e[6]=(f*l*a-n*m*a-f*s*c+t*m*c+n*s*v-t*l*v)*T,e[7]=(n*d*a-h*l*a+h*s*c-t*d*c-n*s*p+t*l*p)*T,e[8]=x*T,e[9]=(f*u*a-h*g*a-f*r*p+t*g*p+h*r*v-t*u*v)*T,e[10]=(n*g*a-f*o*a+f*r*c-t*g*c-n*r*v+t*o*v)*T,e[11]=(h*o*a-n*u*a-h*r*c+t*u*c+n*r*p-t*o*p)*T,e[12]=b*T,e[13]=(h*g*s-f*u*s+f*r*d-t*g*d-h*r*m+t*u*m)*T,e[14]=(f*o*s-n*g*s-f*r*l+t*g*l+n*r*m-t*o*m)*T,e[15]=(n*u*s-h*o*s+h*r*l-t*u*l-n*r*d+t*o*d)*T,this}scale(e){const t=this.elements,r=e.x,s=e.y,a=e.z;return t[0]*=r,t[4]*=s,t[8]*=a,t[1]*=r,t[5]*=s,t[9]*=a,t[2]*=r,t[6]*=s,t[10]*=a,t[3]*=r,t[7]*=s,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,s))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),s=Math.sin(t),a=1-r,n=e.x,o=e.y,l=e.z,c=a*n,h=a*o;return this.set(c*n+r,c*o-s*l,c*l+s*o,0,c*o+s*l,h*o+r,h*l-s*n,0,c*l-s*o,h*l+s*n,a*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,s,a,n){return this.set(1,r,a,0,e,1,n,0,t,s,1,0,0,0,0,1),this}compose(e,t,r){const s=this.elements,a=t._x,n=t._y,o=t._z,l=t._w,c=a+a,h=n+n,u=o+o,d=a*c,p=a*h,f=a*u,g=n*h,m=n*u,v=o*u,_=l*c,y=l*h,x=l*u,b=r.x,M=r.y,T=r.z;return s[0]=(1-(g+v))*b,s[1]=(p+x)*b,s[2]=(f-y)*b,s[3]=0,s[4]=(p-x)*M,s[5]=(1-(d+v))*M,s[6]=(m+_)*M,s[7]=0,s[8]=(f+y)*T,s[9]=(m-_)*T,s[10]=(1-(d+g))*T,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,r){const s=this.elements;let a=ao.set(s[0],s[1],s[2]).length();const n=ao.set(s[4],s[5],s[6]).length(),o=ao.set(s[8],s[9],s[10]).length();this.determinant()<0&&(a=-a),e.x=s[12],e.y=s[13],e.z=s[14],Dr.copy(this);const l=1/a,c=1/n,h=1/o;return Dr.elements[0]*=l,Dr.elements[1]*=l,Dr.elements[2]*=l,Dr.elements[4]*=c,Dr.elements[5]*=c,Dr.elements[6]*=c,Dr.elements[8]*=h,Dr.elements[9]*=h,Dr.elements[10]*=h,t.setFromRotationMatrix(Dr),r.x=a,r.y=n,r.z=o,this}makePerspective(e,t,r,s,a,n,o=2e3){const l=this.elements,c=2*a/(t-e),h=2*a/(r-s),u=(t+e)/(t-e),d=(r+s)/(r-s);let p,f;if(o===Hn)p=-(n+a)/(n-a),f=-2*n*a/(n-a);else{if(o!==Pc)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);p=-n/(n-a),f=-n*a/(n-a)}return l[0]=c,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=h,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=p,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,r,s,a,n,o=2e3){const l=this.elements,c=1/(t-e),h=1/(r-s),u=1/(n-a),d=(t+e)*c,p=(r+s)*h;let f,g;if(o===Hn)f=(n+a)*u,g=-2*u;else{if(o!==Pc)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);f=a*u,g=-1*u}return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-p,l[2]=0,l[6]=0,l[10]=g,l[14]=-f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let s=0;s<16;s++)if(t[s]!==r[s])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const ao=new C,Dr=new Me,SS=new C(0,0,0),TS=new C(1,1,1),ia=new C,Ih=new C,Ji=new C,yv=new Me,xv=new Qe;class Ct{constructor(e=0,t=0,r=0,s=Ct.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,s=this._order){return this._x=e,this._y=t,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const s=e.elements,a=s[0],n=s[4],o=s[8],l=s[1],c=s[5],h=s[9],u=s[2],d=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(zt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-n,a)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-zt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,a),this._z=0);break;case"ZXY":this._x=Math.asin(zt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-n,c)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-zt(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-n,c));break;case"YZX":this._z=Math.asin(zt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-zt(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-h,p),this._y=0)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return yv.makeRotationFromQuaternion(e),this.setFromRotationMatrix(yv,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return xv.setFromEuler(this),this.setFromQuaternion(xv,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ct.DEFAULT_ORDER="XYZ";class rp{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let ES=0;const bv=new C,no=new Qe,Es=new Me,Lh=new C,Al=new C,AS=new C,CS=new Qe,Mv=new C(1,0,0),wv=new C(0,1,0),Sv=new C(0,0,1),Tv={type:"added"},PS={type:"removed"},oo={type:"childadded",child:null},Hp={type:"childremoved",child:null};class Ve extends fs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ES++}),this.uuid=hr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ve.DEFAULT_UP.clone();const e=new C,t=new Ct,r=new Qe,s=new C(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Me},normalMatrix:{value:new ke}}),this.matrix=new Me,this.matrixWorld=new Me,this.matrixAutoUpdate=Ve.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ve.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new rp,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return no.setFromAxisAngle(e,t),this.quaternion.multiply(no),this}rotateOnWorldAxis(e,t){return no.setFromAxisAngle(e,t),this.quaternion.premultiply(no),this}rotateX(e){return this.rotateOnAxis(Mv,e)}rotateY(e){return this.rotateOnAxis(wv,e)}rotateZ(e){return this.rotateOnAxis(Sv,e)}translateOnAxis(e,t){return bv.copy(e).applyQuaternion(this.quaternion),this.position.add(bv.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Mv,e)}translateY(e){return this.translateOnAxis(wv,e)}translateZ(e){return this.translateOnAxis(Sv,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Es.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?Lh.copy(e):Lh.set(e,t,r);const s=this.parent;this.updateWorldMatrix(!0,!1),Al.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Es.lookAt(Al,Lh,this.up):Es.lookAt(Lh,Al,this.up),this.quaternion.setFromRotationMatrix(Es),s&&(Es.extractRotation(s.matrixWorld),no.setFromRotationMatrix(Es),this.quaternion.premultiply(no.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this||e&&e.isObject3D&&(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Tv),oo.child=e,this.dispatchEvent(oo),oo.child=null),this}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(PS),Hp.child=e,this.dispatchEvent(Hp),Hp.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Es.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Es.multiply(e.parent.matrixWorld)),e.applyMatrix4(Es),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Tv),oo.child=e,this.dispatchEvent(oo),oo.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const s=this.children;for(let a=0,n=s.length;a<n;a++)s[a].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Al,e,AS),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Al,CS,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,s=t.length;r<s;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,s=t.length;r<s;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,s=t.length;r<s;r++){const a=t[r];a.matrixWorldAutoUpdate!==!0&&e!==!0||a.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let a=0,n=s.length;a<n;a++){const o=s[a];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};function a(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=a(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];a(e.shapes,u)}else a(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(a(e.materials,this.material[l]));s.material=o}else s.material=a(e.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];s.animations.push(a(e.animations,l))}}if(t){const o=n(e.geometries),l=n(e.materials),c=n(e.textures),h=n(e.images),u=n(e.shapes),d=n(e.skeletons),p=n(e.animations),f=n(e.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),h.length>0&&(r.images=h),u.length>0&&(r.shapes=u),d.length>0&&(r.skeletons=d),p.length>0&&(r.animations=p),f.length>0&&(r.nodes=f)}return r.object=s,r;function n(o){const l=[];for(const c in o){const h=o[c];delete h.metadata,l.push(h)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const s=e.children[r];this.add(s.clone())}return this}}Ve.DEFAULT_UP=new C(0,1,0),Ve.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ve.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Or=new C,As=new C,Gp=new C,Cs=new C,lo=new C,co=new C,Ev=new C,jp=new C,Wp=new C,Xp=new C;class nr{constructor(e=new C,t=new C,r=new C){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,s){s.subVectors(r,t),Or.subVectors(e,t),s.cross(Or);const a=s.lengthSq();return a>0?s.multiplyScalar(1/Math.sqrt(a)):s.set(0,0,0)}static getBarycoord(e,t,r,s,a){Or.subVectors(s,t),As.subVectors(r,t),Gp.subVectors(e,t);const n=Or.dot(Or),o=Or.dot(As),l=Or.dot(Gp),c=As.dot(As),h=As.dot(Gp),u=n*c-o*o;if(u===0)return a.set(0,0,0),null;const d=1/u,p=(c*l-o*h)*d,f=(n*h-o*l)*d;return a.set(1-p-f,f,p)}static containsPoint(e,t,r,s){return this.getBarycoord(e,t,r,s,Cs)!==null&&Cs.x>=0&&Cs.y>=0&&Cs.x+Cs.y<=1}static getInterpolation(e,t,r,s,a,n,o,l){return this.getBarycoord(e,t,r,s,Cs)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(a,Cs.x),l.addScaledVector(n,Cs.y),l.addScaledVector(o,Cs.z),l)}static isFrontFacing(e,t,r,s){return Or.subVectors(r,t),As.subVectors(e,t),Or.cross(As).dot(s)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,s){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,r,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Or.subVectors(this.c,this.b),As.subVectors(this.a,this.b),.5*Or.cross(As).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return nr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return nr.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,s,a){return nr.getInterpolation(e,this.a,this.b,this.c,t,r,s,a)}containsPoint(e){return nr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return nr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,s=this.b,a=this.c;let n,o;lo.subVectors(s,r),co.subVectors(a,r),jp.subVectors(e,r);const l=lo.dot(jp),c=co.dot(jp);if(l<=0&&c<=0)return t.copy(r);Wp.subVectors(e,s);const h=lo.dot(Wp),u=co.dot(Wp);if(h>=0&&u<=h)return t.copy(s);const d=l*u-h*c;if(d<=0&&l>=0&&h<=0)return n=l/(l-h),t.copy(r).addScaledVector(lo,n);Xp.subVectors(e,a);const p=lo.dot(Xp),f=co.dot(Xp);if(f>=0&&p<=f)return t.copy(a);const g=p*c-l*f;if(g<=0&&c>=0&&f<=0)return o=c/(c-f),t.copy(r).addScaledVector(co,o);const m=h*f-p*u;if(m<=0&&u-h>=0&&p-f>=0)return Ev.subVectors(a,s),o=(u-h)/(u-h+(p-f)),t.copy(s).addScaledVector(Ev,o);const v=1/(m+g+d);return n=g*v,o=d*v,t.copy(r).addScaledVector(lo,n).addScaledVector(co,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const gx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ra={h:0,s:0,l:0},Dh={h:0,s:0,l:0};function qp(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+6*(e-i)*t:t<.5?e:t<2/3?i+6*(e-i)*(2/3-t):i}let ve=class{constructor(i,e,t){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(i,e,t)}set(i,e,t){if(e===void 0&&t===void 0){const r=i;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(i,e,t);return this}setScalar(i){return this.r=i,this.g=i,this.b=i,this}setHex(i,e=Mt){return i=Math.floor(i),this.r=(i>>16&255)/255,this.g=(i>>8&255)/255,this.b=(255&i)/255,ct.toWorkingColorSpace(this,e),this}setRGB(i,e,t,r=ct.workingColorSpace){return this.r=i,this.g=e,this.b=t,ct.toWorkingColorSpace(this,r),this}setHSL(i,e,t,r=ct.workingColorSpace){if(i=Gf(i,1),e=zt(e,0,1),t=zt(t,0,1),e===0)this.r=this.g=this.b=t;else{const s=t<=.5?t*(1+e):t+e-t*e,a=2*t-s;this.r=qp(a,s,i+1/3),this.g=qp(a,s,i),this.b=qp(a,s,i-1/3)}return ct.toWorkingColorSpace(this,r),this}setStyle(i,e=Mt){function t(s){}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(i)){let s;const a=r[1],n=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return s[4],this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return s[4],this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(n))return s[4],this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(i)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(s,16),e)}else if(i&&i.length>0)return this.setColorName(i,e);return this}setColorName(i,e=Mt){const t=gx[i.toLowerCase()];return t!==void 0&&this.setHex(t,e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(i){return this.r=i.r,this.g=i.g,this.b=i.b,this}copySRGBToLinear(i){return this.r=Ho(i.r),this.g=Ho(i.g),this.b=Ho(i.b),this}copyLinearToSRGB(i){return this.r=Op(i.r),this.g=Op(i.g),this.b=Op(i.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(i=Mt){return ct.fromWorkingColorSpace(Ti.copy(this),i),65536*Math.round(zt(255*Ti.r,0,255))+256*Math.round(zt(255*Ti.g,0,255))+Math.round(zt(255*Ti.b,0,255))}getHexString(i=Mt){return("000000"+this.getHex(i).toString(16)).slice(-6)}getHSL(i,e=ct.workingColorSpace){ct.fromWorkingColorSpace(Ti.copy(this),e);const t=Ti.r,r=Ti.g,s=Ti.b,a=Math.max(t,r,s),n=Math.min(t,r,s);let o,l;const c=(n+a)/2;if(n===a)o=0,l=0;else{const h=a-n;switch(l=c<=.5?h/(a+n):h/(2-a-n),a){case t:o=(r-s)/h+(r<s?6:0);break;case r:o=(s-t)/h+2;break;case s:o=(t-r)/h+4}o/=6}return i.h=o,i.s=l,i.l=c,i}getRGB(i,e=ct.workingColorSpace){return ct.fromWorkingColorSpace(Ti.copy(this),e),i.r=Ti.r,i.g=Ti.g,i.b=Ti.b,i}getStyle(i=Mt){ct.fromWorkingColorSpace(Ti.copy(this),i);const e=Ti.r,t=Ti.g,r=Ti.b;return i!==Mt?`color(${i} ${e.toFixed(3)} ${t.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*t)},${Math.round(255*r)})`}offsetHSL(i,e,t){return this.getHSL(ra),this.setHSL(ra.h+i,ra.s+e,ra.l+t)}add(i){return this.r+=i.r,this.g+=i.g,this.b+=i.b,this}addColors(i,e){return this.r=i.r+e.r,this.g=i.g+e.g,this.b=i.b+e.b,this}addScalar(i){return this.r+=i,this.g+=i,this.b+=i,this}sub(i){return this.r=Math.max(0,this.r-i.r),this.g=Math.max(0,this.g-i.g),this.b=Math.max(0,this.b-i.b),this}multiply(i){return this.r*=i.r,this.g*=i.g,this.b*=i.b,this}multiplyScalar(i){return this.r*=i,this.g*=i,this.b*=i,this}lerp(i,e){return this.r+=(i.r-this.r)*e,this.g+=(i.g-this.g)*e,this.b+=(i.b-this.b)*e,this}lerpColors(i,e,t){return this.r=i.r+(e.r-i.r)*t,this.g=i.g+(e.g-i.g)*t,this.b=i.b+(e.b-i.b)*t,this}lerpHSL(i,e){this.getHSL(ra),i.getHSL(Dh);const t=cc(ra.h,Dh.h,e),r=cc(ra.s,Dh.s,e),s=cc(ra.l,Dh.l,e);return this.setHSL(t,r,s),this}setFromVector3(i){return this.r=i.x,this.g=i.y,this.b=i.z,this}applyMatrix3(i){const e=this.r,t=this.g,r=this.b,s=i.elements;return this.r=s[0]*e+s[3]*t+s[6]*r,this.g=s[1]*e+s[4]*t+s[7]*r,this.b=s[2]*e+s[5]*t+s[8]*r,this}equals(i){return i.r===this.r&&i.g===this.g&&i.b===this.b}fromArray(i,e=0){return this.r=i[e],this.g=i[e+1],this.b=i[e+2],this}toArray(i=[],e=0){return i[e]=this.r,i[e+1]=this.g,i[e+2]=this.b,i}fromBufferAttribute(i,e){return this.r=i.getX(e),this.g=i.getY(e),this.b=i.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const Ti=new ve;ve.NAMES=gx;let RS=0;class $t extends fs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:RS++}),this.uuid=hr(),this.name="",this.type="Material",this.blending=1,this.side=Er,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ra,this.blendDst=Ia,this.blendEquation=ar,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ve(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=pn,this.stencilZFail=pn,this.stencilZPass=pn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0)continue;const s=this[t];s!==void 0&&(s&&s.isColor?s.set(r):s&&s.isVector3&&r&&r.isVector3?s.copy(r):this[t]=r)}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function s(a){const n=[];for(const o in a){const l=a[o];delete l.metadata,n.push(l)}return n}if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(r.blending=this.blending),this.side!==Er&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==Ra&&(r.blendSrc=this.blendSrc),this.blendDst!==Ia&&(r.blendDst=this.blendDst),this.blendEquation!==ar&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==3&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==519&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==pn&&(r.stencilFail=this.stencilFail),this.stencilZFail!==pn&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==pn&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData),t){const a=s(e.textures),n=s(e.images);a.length>0&&(r.textures=a),n.length>0&&(r.images=n)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const s=t.length;r=new Array(s);for(let a=0;a!==s;++a)r[a]=t[a].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Qt extends $t{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ve(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ct,this.combine=ah,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Us=IS();function IS(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),r=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[256|l]=32768,s[l]=24,s[256|l]=24):c<-14?(r[l]=1024>>-c-14,r[256|l]=1024>>-c-14|32768,s[l]=-c-1,s[256|l]=-c-1):c<=15?(r[l]=c+15<<10,r[256|l]=c+15<<10|32768,s[l]=13,s[256|l]=13):c<128?(r[l]=31744,r[256|l]=64512,s[l]=24,s[256|l]=24):(r[l]=31744,r[256|l]=64512,s[l]=13,s[256|l]=13)}const a=new Uint32Array(2048),n=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(8388608&c);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,a[l]=c|h}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)n[l]=l<<23;n[31]=1199570944,n[32]=2147483648;for(let l=33;l<63;++l)n[l]=2147483648+(l-32<<23);n[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:r,shiftTable:s,mantissaTable:a,exponentTable:n,offsetTable:o}}function Gi(i){i=zt(i,-65504,65504),Us.floatView[0]=i;const e=Us.uint32View[0],t=e>>23&511;return Us.baseTable[t]+((8388607&e)>>Us.shiftTable[t])}function ec(i){const e=i>>10;return Us.uint32View[0]=Us.mantissaTable[Us.offsetTable[e]+(1023&i)]+Us.exponentTable[e],Us.floatView[0]}const LS={toHalfFloat:Gi,fromHalfFloat:ec},ei=new C,Oh=new se;class Ke{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=Cc,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=wr,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return px("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let s=0,a=this.itemSize;s<a;s++)this.array[e+s]=t.array[r+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)Oh.fromBufferAttribute(this,t),Oh.applyMatrix3(e),this.setXY(t,Oh.x,Oh.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)ei.fromBufferAttribute(this,t),ei.applyMatrix3(e),this.setXYZ(t,ei.x,ei.y,ei.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)ei.fromBufferAttribute(this,t),ei.applyMatrix4(e),this.setXYZ(t,ei.x,ei.y,ei.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)ei.fromBufferAttribute(this,t),ei.applyNormalMatrix(e),this.setXYZ(t,ei.x,ei.y,ei.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)ei.fromBufferAttribute(this,t),ei.transformDirection(e),this.setXYZ(t,ei.x,ei.y,ei.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=zi(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Be(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=zi(t,this.array)),t}setX(e,t){return this.normalized&&(t=Be(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=zi(t,this.array)),t}setY(e,t){return this.normalized&&(t=Be(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=zi(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Be(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=zi(t,this.array)),t}setW(e,t){return this.normalized&&(t=Be(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Be(t,this.array),r=Be(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,s){return e*=this.itemSize,this.normalized&&(t=Be(t,this.array),r=Be(r,this.array),s=Be(s,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=s,this}setXYZW(e,t,r,s,a){return e*=this.itemSize,this.normalized&&(t=Be(t,this.array),r=Be(r,this.array),s=Be(s,this.array),a=Be(a,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=s,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Cc&&(e.usage=this.usage),e}}class sp extends Ke{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class $g extends Ke{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Se extends Ke{constructor(e,t,r){super(new Float32Array(e),t,r)}}let DS=0;const gr=new Me,Yp=new Ve,ho=new C,er=new Tt,Cl=new Tt,hi=new C;class Ie extends fs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:DS++}),this.uuid=hr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(ux(e)?$g:sp)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const a=new ke().getNormalMatrix(e);r.applyNormalMatrix(a),r.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return gr.makeRotationFromQuaternion(e),this.applyMatrix4(gr),this}rotateX(e){return gr.makeRotationX(e),this.applyMatrix4(gr),this}rotateY(e){return gr.makeRotationY(e),this.applyMatrix4(gr),this}rotateZ(e){return gr.makeRotationZ(e),this.applyMatrix4(gr),this}translate(e,t,r){return gr.makeTranslation(e,t,r),this.applyMatrix4(gr),this}scale(e,t,r){return gr.makeScale(e,t,r),this.applyMatrix4(gr),this}lookAt(e){return Yp.lookAt(e),Yp.updateMatrix(),this.applyMatrix4(Yp.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ho).negate(),this.translate(ho.x,ho.y,ho.z),this}setFromPoints(e){const t=[];for(let r=0,s=e.length;r<s;r++){const a=e[r];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new Se(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingBox.set(new C(-1/0,-1/0,-1/0),new C(1/0,1/0,1/0));else{if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,s=t.length;r<s;r++){const a=t[r];er.setFromBufferAttribute(a),this.morphTargetsRelative?(hi.addVectors(this.boundingBox.min,er.min),this.boundingBox.expandByPoint(hi),hi.addVectors(this.boundingBox.max,er.max),this.boundingBox.expandByPoint(hi)):(this.boundingBox.expandByPoint(er.min),this.boundingBox.expandByPoint(er.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new oi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingSphere.set(new C,1/0);else if(e){const r=this.boundingSphere.center;if(er.setFromBufferAttribute(e),t)for(let a=0,n=t.length;a<n;a++){const o=t[a];Cl.setFromBufferAttribute(o),this.morphTargetsRelative?(hi.addVectors(er.min,Cl.min),er.expandByPoint(hi),hi.addVectors(er.max,Cl.max),er.expandByPoint(hi)):(er.expandByPoint(Cl.min),er.expandByPoint(Cl.max))}er.getCenter(r);let s=0;for(let a=0,n=e.count;a<n;a++)hi.fromBufferAttribute(e,a),s=Math.max(s,r.distanceToSquared(hi));if(t)for(let a=0,n=t.length;a<n;a++){const o=t[a],l=this.morphTargetsRelative;for(let c=0,h=o.count;c<h;c++)hi.fromBufferAttribute(o,c),l&&(ho.fromBufferAttribute(e,c),hi.add(ho)),s=Math.max(s,r.distanceToSquared(hi))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0)return;const r=t.position,s=t.normal,a=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ke(new Float32Array(4*r.count),4));const n=this.getAttribute("tangent"),o=[],l=[];for(let A=0;A<r.count;A++)o[A]=new C,l[A]=new C;const c=new C,h=new C,u=new C,d=new se,p=new se,f=new se,g=new C,m=new C;function v(A,L,U){c.fromBufferAttribute(r,A),h.fromBufferAttribute(r,L),u.fromBufferAttribute(r,U),d.fromBufferAttribute(a,A),p.fromBufferAttribute(a,L),f.fromBufferAttribute(a,U),h.sub(c),u.sub(c),p.sub(d),f.sub(d);const P=1/(p.x*f.y-f.x*p.y);isFinite(P)&&(g.copy(h).multiplyScalar(f.y).addScaledVector(u,-p.y).multiplyScalar(P),m.copy(u).multiplyScalar(p.x).addScaledVector(h,-f.x).multiplyScalar(P),o[A].add(g),o[L].add(g),o[U].add(g),l[A].add(m),l[L].add(m),l[U].add(m))}let _=this.groups;_.length===0&&(_=[{start:0,count:e.count}]);for(let A=0,L=_.length;A<L;++A){const U=_[A],P=U.start;for(let E=P,I=P+U.count;E<I;E+=3)v(e.getX(E+0),e.getX(E+1),e.getX(E+2))}const y=new C,x=new C,b=new C,M=new C;function T(A){b.fromBufferAttribute(s,A),M.copy(b);const L=o[A];y.copy(L),y.sub(b.multiplyScalar(b.dot(L))).normalize(),x.crossVectors(M,L);const U=x.dot(l[A])<0?-1:1;n.setXYZW(A,y.x,y.y,y.z,U)}for(let A=0,L=_.length;A<L;++A){const U=_[A],P=U.start;for(let E=P,I=P+U.count;E<I;E+=3)T(e.getX(E+0)),T(e.getX(E+1)),T(e.getX(E+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Ke(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let d=0,p=r.count;d<p;d++)r.setXYZ(d,0,0,0);const s=new C,a=new C,n=new C,o=new C,l=new C,c=new C,h=new C,u=new C;if(e)for(let d=0,p=e.count;d<p;d+=3){const f=e.getX(d+0),g=e.getX(d+1),m=e.getX(d+2);s.fromBufferAttribute(t,f),a.fromBufferAttribute(t,g),n.fromBufferAttribute(t,m),h.subVectors(n,a),u.subVectors(s,a),h.cross(u),o.fromBufferAttribute(r,f),l.fromBufferAttribute(r,g),c.fromBufferAttribute(r,m),o.add(h),l.add(h),c.add(h),r.setXYZ(f,o.x,o.y,o.z),r.setXYZ(g,l.x,l.y,l.z),r.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,p=t.count;d<p;d+=3)s.fromBufferAttribute(t,d+0),a.fromBufferAttribute(t,d+1),n.fromBufferAttribute(t,d+2),h.subVectors(n,a),u.subVectors(s,a),h.cross(u),r.setXYZ(d+0,h.x,h.y,h.z),r.setXYZ(d+1,h.x,h.y,h.z),r.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)hi.fromBufferAttribute(e,t),hi.normalize(),e.setXYZ(t,hi.x,hi.y,hi.z)}toNonIndexed(){function e(o,l){const c=o.array,h=o.itemSize,u=o.normalized,d=new c.constructor(l.length*h);let p=0,f=0;for(let g=0,m=l.length;g<m;g++){p=o.isInterleavedBufferAttribute?l[g]*o.data.stride+o.offset:l[g]*h;for(let v=0;v<h;v++)d[f++]=c[p++]}return new Ke(d,h,u)}if(this.index===null)return this;const t=new Ie,r=this.index.array,s=this.attributes;for(const o in s){const l=e(s[o],r);t.setAttribute(o,l)}const a=this.morphAttributes;for(const o in a){const l=[],c=a[o];for(let h=0,u=c.length;h<u;h++){const d=e(c[h],r);l.push(d)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const n=this.groups;for(let o=0,l=n.length;o<l;o++){const c=n[o];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const s={};let a=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,d=c.length;u<d;u++){const p=c[u];h.push(p.toJSON(e.data))}h.length>0&&(s[l]=h,a=!0)}a&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const n=this.groups;n.length>0&&(e.data.groups=JSON.parse(JSON.stringify(n)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const s=e.attributes;for(const c in s){const h=s[c];this.setAttribute(c,h.clone(t))}const a=e.morphAttributes;for(const c in a){const h=[],u=a[c];for(let d=0,p=u.length;d<p;d++)h.push(u[d].clone(t));this.morphAttributes[c]=h}this.morphTargetsRelative=e.morphTargetsRelative;const n=e.groups;for(let c=0,h=n.length;c<h;c++){const u=n[c];this.addGroup(u.start,u.count,u.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Av=new Me,Ya=new Kn,Nh=new oi,Cv=new C,uo=new C,po=new C,mo=new C,Zp=new C,Uh=new C,kh=new se,Fh=new se,zh=new se,Pv=new C,Rv=new C,Iv=new C,Bh=new C,Vh=new C;class ye extends Ve{constructor(e=new Ie,t=new Qt){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}getVertexPosition(e,t){const r=this.geometry,s=r.attributes.position,a=r.morphAttributes.position,n=r.morphTargetsRelative;t.fromBufferAttribute(s,e);const o=this.morphTargetInfluences;if(a&&o){Uh.set(0,0,0);for(let l=0,c=a.length;l<c;l++){const h=o[l],u=a[l];h!==0&&(Zp.fromBufferAttribute(u,e),n?Uh.addScaledVector(Zp,h):Uh.addScaledVector(Zp.sub(t),h))}t.add(Uh)}return t}raycast(e,t){const r=this.geometry,s=this.material,a=this.matrixWorld;if(s!==void 0){if(r.boundingSphere===null&&r.computeBoundingSphere(),Nh.copy(r.boundingSphere),Nh.applyMatrix4(a),Ya.copy(e.ray).recast(e.near),Nh.containsPoint(Ya.origin)===!1&&(Ya.intersectSphere(Nh,Cv)===null||Ya.origin.distanceToSquared(Cv)>rS(e.far-e.near,2)))return;Av.copy(a).invert(),Ya.copy(e.ray).applyMatrix4(Av),r.boundingBox!==null&&Ya.intersectsBox(r.boundingBox)===!1||this._computeIntersections(e,t,Ya)}}_computeIntersections(e,t,r){let s;const a=this.geometry,n=this.material,o=a.index,l=a.attributes.position,c=a.attributes.uv,h=a.attributes.uv1,u=a.attributes.normal,d=a.groups,p=a.drawRange;if(o!==null)if(Array.isArray(n))for(let f=0,g=d.length;f<g;f++){const m=d[f],v=n[m.materialIndex];for(let _=Math.max(m.start,p.start),y=Math.min(o.count,Math.min(m.start+m.count,p.start+p.count));_<y;_+=3)s=Hh(this,v,e,r,c,h,u,o.getX(_),o.getX(_+1),o.getX(_+2)),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=m.materialIndex,t.push(s))}else for(let f=Math.max(0,p.start),g=Math.min(o.count,p.start+p.count);f<g;f+=3)s=Hh(this,n,e,r,c,h,u,o.getX(f),o.getX(f+1),o.getX(f+2)),s&&(s.faceIndex=Math.floor(f/3),t.push(s));else if(l!==void 0)if(Array.isArray(n))for(let f=0,g=d.length;f<g;f++){const m=d[f],v=n[m.materialIndex];for(let _=Math.max(m.start,p.start),y=Math.min(l.count,Math.min(m.start+m.count,p.start+p.count));_<y;_+=3)s=Hh(this,v,e,r,c,h,u,_,_+1,_+2),s&&(s.faceIndex=Math.floor(_/3),s.face.materialIndex=m.materialIndex,t.push(s))}else for(let f=Math.max(0,p.start),g=Math.min(l.count,p.start+p.count);f<g;f+=3)s=Hh(this,n,e,r,c,h,u,f,f+1,f+2),s&&(s.faceIndex=Math.floor(f/3),t.push(s))}}function Hh(i,e,t,r,s,a,n,o,l,c){i.getVertexPosition(o,uo),i.getVertexPosition(l,po),i.getVertexPosition(c,mo);const h=function(u,d,p,f,g,m,v,_){let y;if(y=d.side===Ri?f.intersectTriangle(v,m,g,!0,_):f.intersectTriangle(g,m,v,d.side===Er,_),y===null)return null;Vh.copy(_),Vh.applyMatrix4(u.matrixWorld);const x=p.ray.origin.distanceTo(Vh);return x<p.near||x>p.far?null:{distance:x,point:Vh.clone(),object:u}}(i,e,t,r,uo,po,mo,Bh);if(h){s&&(kh.fromBufferAttribute(s,o),Fh.fromBufferAttribute(s,l),zh.fromBufferAttribute(s,c),h.uv=nr.getInterpolation(Bh,uo,po,mo,kh,Fh,zh,new se)),a&&(kh.fromBufferAttribute(a,o),Fh.fromBufferAttribute(a,l),zh.fromBufferAttribute(a,c),h.uv1=nr.getInterpolation(Bh,uo,po,mo,kh,Fh,zh,new se)),n&&(Pv.fromBufferAttribute(n,o),Rv.fromBufferAttribute(n,l),Iv.fromBufferAttribute(n,c),h.normal=nr.getInterpolation(Bh,uo,po,mo,Pv,Rv,Iv,new C),h.normal.dot(r.direction)>0&&h.normal.multiplyScalar(-1));const u={a:o,b:l,c,normal:new C,materialIndex:0};nr.getNormal(uo,po,mo,u.normal),h.face=u}return h}class Lt extends Ie{constructor(e=1,t=1,r=1,s=1,a=1,n=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:s,heightSegments:a,depthSegments:n};const o=this;s=Math.floor(s),a=Math.floor(a),n=Math.floor(n);const l=[],c=[],h=[],u=[];let d=0,p=0;function f(g,m,v,_,y,x,b,M,T,A,L){const U=x/T,P=b/A,E=x/2,I=b/2,S=M/2,V=T+1,J=A+1;let X=0,te=0;const ie=new C;for(let fe=0;fe<J;fe++){const B=fe*P-I;for(let j=0;j<V;j++){const ae=j*U-E;ie[g]=ae*_,ie[m]=B*y,ie[v]=S,c.push(ie.x,ie.y,ie.z),ie[g]=0,ie[m]=0,ie[v]=M>0?1:-1,h.push(ie.x,ie.y,ie.z),u.push(j/T),u.push(1-fe/A),X+=1}}for(let fe=0;fe<A;fe++)for(let B=0;B<T;B++){const j=d+B+V*fe,ae=d+B+V*(fe+1),O=d+(B+1)+V*(fe+1),D=d+(B+1)+V*fe;l.push(j,ae,D),l.push(ae,O,D),te+=6}o.addGroup(p,te,L),p+=te,d+=X}f("z","y","x",-1,-1,r,t,e,n,a,0),f("z","y","x",1,-1,r,t,-e,n,a,1),f("x","z","y",1,1,e,r,t,s,n,2),f("x","z","y",1,-1,e,r,-t,s,n,3),f("x","y","z",1,-1,e,t,r,s,a,4),f("x","y","z",-1,-1,e,t,-r,s,a,5),this.setIndex(l),this.setAttribute("position",new Se(c,3)),this.setAttribute("normal",new Se(h,3)),this.setAttribute("uv",new Se(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lt(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function rl(i){const e={};for(const t in i){e[t]={};for(const r in i[t]){const s=i[t][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?e[t][r]=null:e[t][r]=s.clone():Array.isArray(s)?e[t][r]=s.slice():e[t][r]=s}}return e}function Oi(i){const e={};for(let t=0;t<i.length;t++){const r=rl(i[t]);for(const s in r)e[s]=r[s]}return e}function vx(i){const e=i.getRenderTarget();return e===null?i.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ct.workingColorSpace}const ii={clone:rl,merge:Oi};class at extends $t{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=rl(e.uniforms),this.uniformsGroups=function(t){const r=[];for(let s=0;s<t.length;s++)r.push(t[s].clone());return r}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?t.uniforms[s]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[s]={type:"m4",value:a.toArray()}:t.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const s in this.extensions)this.extensions[s]===!0&&(r[s]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class ap extends Ve{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Me,this.projectionMatrix=new Me,this.projectionMatrixInverse=new Me,this.coordinateSystem=Hn}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const sa=new C,Lv=new se,Dv=new se;class Zt extends ap{constructor(e=50,t=1,r=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*il*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Cn*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*il*Math.atan(Math.tan(.5*Cn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){sa.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(sa.x,sa.y).multiplyScalar(-e/sa.z),sa.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(sa.x,sa.y).multiplyScalar(-e/sa.z)}getViewSize(e,t){return this.getViewBounds(e,Lv,Dv),t.subVectors(Dv,Lv)}setViewOffset(e,t,r,s,a,n){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=s,this.view.width=a,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Cn*this.fov)/this.zoom,r=2*t,s=this.aspect*r,a=-.5*s;const n=this.view;if(this.view!==null&&this.view.enabled){const l=n.fullWidth,c=n.fullHeight;a+=n.offsetX*s/l,t-=n.offsetY*r/c,s*=n.width/l,r*=n.height/c}const o=this.filmOffset;o!==0&&(a+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+s,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const fo=-90;class _x extends Ve{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Zt(fo,1,e,t);s.layers=this.layers,this.add(s);const a=new Zt(fo,1,e,t);a.layers=this.layers,this.add(a);const n=new Zt(fo,1,e,t);n.layers=this.layers,this.add(n);const o=new Zt(fo,1,e,t);o.layers=this.layers,this.add(o);const l=new Zt(fo,1,e,t);l.layers=this.layers,this.add(l);const c=new Zt(fo,1,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,s,a,n,o,l]=t;for(const c of t)this.remove(c);if(e===Hn)r.up.set(0,1,0),r.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),n.up.set(0,0,1),n.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else{if(e!==Pc)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),n.up.set(0,0,-1),n.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1)}for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[a,n,o,l,c,h]=this.children,u=e.getRenderTarget(),d=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),f=e.xr.enabled;e.xr.enabled=!1;const g=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,s),e.render(t,a),e.setRenderTarget(r,1,s),e.render(t,n),e.setRenderTarget(r,2,s),e.render(t,o),e.setRenderTarget(r,3,s),e.render(t,l),e.setRenderTarget(r,4,s),e.render(t,c),r.texture.generateMipmaps=g,e.setRenderTarget(r,5,s),e.render(t,h),e.setRenderTarget(u,d,p),e.xr.enabled=f,r.texture.needsPMREMUpdate=!0}}class Ic extends yt{constructor(e,t,r,s,a,n,o,l,c,h){super(e=e!==void 0?e:[],t=t!==void 0?t:Hs,r,s,a,n,o,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class yx extends pt{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},s=[r,r,r,r,r,r];this.texture=new Ic(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0&&t.generateMipmaps,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:qt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Lt(5,5,5),a=new at({name:"CubemapFromEquirect",uniforms:rl(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Ri,blending:0});a.uniforms.tEquirect.value=t;const n=new ye(s,a),o=t.minFilter;return t.minFilter===hs&&(t.minFilter=qt),new _x(1,10,this).update(e,n),t.minFilter=o,n.geometry.dispose(),n.material.dispose(),this}clear(e,t,r,s){const a=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,r,s);e.setRenderTarget(a)}}const Kp=new C,OS=new C,NS=new ke;class Br{constructor(e=new C(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,s){return this.normal.set(e,t,r),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const s=Kp.subVectors(r,t).cross(OS.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(Kp),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/s;return a<0||a>1?null:t.copy(e.start).addScaledVector(r,a)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||NS.getNormalMatrix(e),s=this.coplanarPoint(Kp).applyMatrix4(e),a=this.normal.applyMatrix3(r).normalize();return this.constant=-s.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Za=new oi,Gh=new C;class oh{constructor(e=new Br,t=new Br,r=new Br,s=new Br,a=new Br,n=new Br){this.planes=[e,t,r,s,a,n]}set(e,t,r,s,a,n){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(r),o[3].copy(s),o[4].copy(a),o[5].copy(n),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=2e3){const r=this.planes,s=e.elements,a=s[0],n=s[1],o=s[2],l=s[3],c=s[4],h=s[5],u=s[6],d=s[7],p=s[8],f=s[9],g=s[10],m=s[11],v=s[12],_=s[13],y=s[14],x=s[15];if(r[0].setComponents(l-a,d-c,m-p,x-v).normalize(),r[1].setComponents(l+a,d+c,m+p,x+v).normalize(),r[2].setComponents(l+n,d+h,m+f,x+_).normalize(),r[3].setComponents(l-n,d-h,m-f,x-_).normalize(),r[4].setComponents(l-o,d-u,m-g,x-y).normalize(),t===Hn)r[5].setComponents(l+o,d+u,m+g,x+y).normalize();else{if(t!==Pc)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(o,u,g,y).normalize()}return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Za.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Za.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Za)}intersectsSprite(e){return Za.center.set(0,0,0),Za.radius=.7071067811865476,Za.applyMatrix4(e.matrixWorld),this.intersectsSphere(Za)}intersectsSphere(e){const t=this.planes,r=e.center,s=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(r)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const s=t[r];if(Gh.x=s.normal.x>0?e.max.x:e.min.x,Gh.y=s.normal.y>0?e.max.y:e.min.y,Gh.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Gh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function xx(){let i=null,e=!1,t=null,r=null;function s(a,n){t(a,n),r=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(r=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(a){t=a},setContext:function(a){i=a}}}function US(i){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const r=e.get(t);r&&(i.deleteBuffer(r.buffer),e.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const a=e.get(t);return void((!a||a.version<t.version)&&e.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=e.get(t);if(s===void 0)e.set(t,function(a,n){const o=a.array,l=a.usage,c=o.byteLength,h=i.createBuffer();let u;if(i.bindBuffer(n,h),i.bufferData(n,o,l),a.onUploadCallback(),o instanceof Float32Array)u=i.FLOAT;else if(o instanceof Uint16Array)u=a.isFloat16BufferAttribute?i.HALF_FLOAT:i.UNSIGNED_SHORT;else if(o instanceof Int16Array)u=i.SHORT;else if(o instanceof Uint32Array)u=i.UNSIGNED_INT;else if(o instanceof Int32Array)u=i.INT;else if(o instanceof Int8Array)u=i.BYTE;else if(o instanceof Uint8Array)u=i.UNSIGNED_BYTE;else{if(!(o instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+o);u=i.UNSIGNED_BYTE}return{buffer:h,type:u,bytesPerElement:o.BYTES_PER_ELEMENT,version:a.version,size:c}}(t,r));else if(s.version<t.version){if(s.size!==t.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");(function(a,n,o){const l=n.array,c=n._updateRange,h=n.updateRanges;if(i.bindBuffer(o,a),c.count===-1&&h.length===0&&i.bufferSubData(o,0,l),h.length!==0){for(let u=0,d=h.length;u<d;u++){const p=h[u];i.bufferSubData(o,p.start*l.BYTES_PER_ELEMENT,l,p.start,p.count)}n.clearUpdateRanges()}c.count!==-1&&(i.bufferSubData(o,c.offset*l.BYTES_PER_ELEMENT,l,c.offset,c.count),c.count=-1),n.onUploadCallback()})(s.buffer,t,r),s.version=t.version}}}}class ys extends Ie{constructor(e=1,t=1,r=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:s};const a=e/2,n=t/2,o=Math.floor(r),l=Math.floor(s),c=o+1,h=l+1,u=e/o,d=t/l,p=[],f=[],g=[],m=[];for(let v=0;v<h;v++){const _=v*d-n;for(let y=0;y<c;y++){const x=y*u-a;f.push(x,-_,0),g.push(0,0,1),m.push(y/o),m.push(1-v/l)}}for(let v=0;v<l;v++)for(let _=0;_<o;_++){const y=_+c*v,x=_+c*(v+1),b=_+1+c*(v+1),M=_+1+c*v;p.push(y,x,M),p.push(x,b,M)}this.setIndex(p),this.setAttribute("position",new Se(f,3)),this.setAttribute("normal",new Se(g,3)),this.setAttribute("uv",new Se(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ys(e.width,e.height,e.widthSegments,e.heightSegments)}}const He={alphahash_fragment:`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment:`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex:`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,batching_vertex:`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,begin_vertex:`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex:`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps:`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex:`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,backgroundCube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,backgroundCube_frag:`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,depth_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`},Te={common:{diffuse:{value:new ve(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ke},alphaMap:{value:null},alphaMapTransform:{value:new ke},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ke}},envmap:{envMap:{value:null},envMapRotation:{value:new ke},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ke}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ke}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ke},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ke},normalScale:{value:new se(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ke},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ke}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ke}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ke}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ve(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ve(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ke},alphaTest:{value:0},uvTransform:{value:new ke}},sprite:{diffuse:{value:new ve(16777215)},opacity:{value:1},center:{value:new se(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ke},alphaMap:{value:null},alphaMapTransform:{value:new ke},alphaTest:{value:0}}},ki={basic:{uniforms:Oi([Te.common,Te.specularmap,Te.envmap,Te.aomap,Te.lightmap,Te.fog]),vertexShader:He.meshbasic_vert,fragmentShader:He.meshbasic_frag},lambert:{uniforms:Oi([Te.common,Te.specularmap,Te.envmap,Te.aomap,Te.lightmap,Te.emissivemap,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.fog,Te.lights,{emissive:{value:new ve(0)}}]),vertexShader:He.meshlambert_vert,fragmentShader:He.meshlambert_frag},phong:{uniforms:Oi([Te.common,Te.specularmap,Te.envmap,Te.aomap,Te.lightmap,Te.emissivemap,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.fog,Te.lights,{emissive:{value:new ve(0)},specular:{value:new ve(1118481)},shininess:{value:30}}]),vertexShader:He.meshphong_vert,fragmentShader:He.meshphong_frag},standard:{uniforms:Oi([Te.common,Te.envmap,Te.aomap,Te.lightmap,Te.emissivemap,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.roughnessmap,Te.metalnessmap,Te.fog,Te.lights,{emissive:{value:new ve(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:He.meshphysical_vert,fragmentShader:He.meshphysical_frag},toon:{uniforms:Oi([Te.common,Te.aomap,Te.lightmap,Te.emissivemap,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.gradientmap,Te.fog,Te.lights,{emissive:{value:new ve(0)}}]),vertexShader:He.meshtoon_vert,fragmentShader:He.meshtoon_frag},matcap:{uniforms:Oi([Te.common,Te.bumpmap,Te.normalmap,Te.displacementmap,Te.fog,{matcap:{value:null}}]),vertexShader:He.meshmatcap_vert,fragmentShader:He.meshmatcap_frag},points:{uniforms:Oi([Te.points,Te.fog]),vertexShader:He.points_vert,fragmentShader:He.points_frag},dashed:{uniforms:Oi([Te.common,Te.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:He.linedashed_vert,fragmentShader:He.linedashed_frag},depth:{uniforms:Oi([Te.common,Te.displacementmap]),vertexShader:He.depth_vert,fragmentShader:He.depth_frag},normal:{uniforms:Oi([Te.common,Te.bumpmap,Te.normalmap,Te.displacementmap,{opacity:{value:1}}]),vertexShader:He.meshnormal_vert,fragmentShader:He.meshnormal_frag},sprite:{uniforms:Oi([Te.sprite,Te.fog]),vertexShader:He.sprite_vert,fragmentShader:He.sprite_frag},background:{uniforms:{uvTransform:{value:new ke},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:He.background_vert,fragmentShader:He.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ke}},vertexShader:He.backgroundCube_vert,fragmentShader:He.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:He.cube_vert,fragmentShader:He.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:He.equirect_vert,fragmentShader:He.equirect_frag},distanceRGBA:{uniforms:Oi([Te.common,Te.displacementmap,{referencePosition:{value:new C},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:He.distanceRGBA_vert,fragmentShader:He.distanceRGBA_frag},shadow:{uniforms:Oi([Te.lights,Te.fog,{color:{value:new ve(0)},opacity:{value:1}}]),vertexShader:He.shadow_vert,fragmentShader:He.shadow_frag}};ki.physical={uniforms:Oi([ki.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ke},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ke},clearcoatNormalScale:{value:new se(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ke},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ke},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ke},sheen:{value:0},sheenColor:{value:new ve(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ke},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ke},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ke},transmissionSamplerSize:{value:new se},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ke},attenuationDistance:{value:0},attenuationColor:{value:new ve(0)},specularColor:{value:new ve(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ke},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ke},anisotropyVector:{value:new se},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ke}}]),vertexShader:He.meshphysical_vert,fragmentShader:He.meshphysical_frag};const jh={r:0,b:0,g:0},Ka=new Ct,kS=new Me;function FS(i,e,t,r,s,a,n){const o=new ve(0);let l,c,h=a===!0?0:1,u=null,d=0,p=null;function f(m){let v=m.isScene===!0?m.background:null;return v&&v.isTexture&&(v=(m.backgroundBlurriness>0?t:e).get(v)),v}function g(m,v){m.getRGB(jh,vx(i)),r.buffers.color.setClear(jh.r,jh.g,jh.b,v,n)}return{getClearColor:function(){return o},setClearColor:function(m,v=1){o.set(m),h=v,g(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(m){h=m,g(o,h)},render:function(m){let v=!1;const _=f(m);_===null?g(o,h):_&&_.isColor&&(g(_,1),v=!0);const y=i.xr.getEnvironmentBlendMode();y==="additive"?r.buffers.color.setClear(0,0,0,1,n):y==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,n),(i.autoClear||v)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil)},addToRenderList:function(m,v){const _=f(v);_&&(_.isCubeTexture||_.mapping===yl)?(c===void 0&&(c=new ye(new Lt(1,1,1),new at({name:"BackgroundCubeMaterial",uniforms:rl(ki.backgroundCube.uniforms),vertexShader:ki.backgroundCube.vertexShader,fragmentShader:ki.backgroundCube.fragmentShader,side:Ri,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(y,x,b){this.matrixWorld.copyPosition(b.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(c)),Ka.copy(v.backgroundRotation),Ka.x*=-1,Ka.y*=-1,Ka.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(Ka.y*=-1,Ka.z*=-1),c.material.uniforms.envMap.value=_,c.material.uniforms.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(kS.makeRotationFromEuler(Ka)),c.material.toneMapped=ct.getTransfer(_.colorSpace)!==bt,u===_&&d===_.version&&p===i.toneMapping||(c.material.needsUpdate=!0,u=_,d=_.version,p=i.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null)):_&&_.isTexture&&(l===void 0&&(l=new ye(new ys(2,2),new at({name:"BackgroundMaterial",uniforms:rl(ki.background.uniforms),vertexShader:ki.background.vertexShader,fragmentShader:ki.background.fragmentShader,side:Er,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(l)),l.material.uniforms.t2D.value=_,l.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,l.material.toneMapped=ct.getTransfer(_.colorSpace)!==bt,_.matrixAutoUpdate===!0&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),u===_&&d===_.version&&p===i.toneMapping||(l.material.needsUpdate=!0,u=_,d=_.version,p=i.toneMapping),l.layers.enableAll(),m.unshift(l,l.geometry,l.material,0,0,null))}}}function zS(i,e){const t=i.getParameter(i.MAX_VERTEX_ATTRIBS),r={},s=c(null);let a=s,n=!1;function o(v){return i.bindVertexArray(v)}function l(v){return i.deleteVertexArray(v)}function c(v){const _=[],y=[],x=[];for(let b=0;b<t;b++)_[b]=0,y[b]=0,x[b]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:_,enabledAttributes:y,attributeDivisors:x,object:v,attributes:{},index:null}}function h(){const v=a.newAttributes;for(let _=0,y=v.length;_<y;_++)v[_]=0}function u(v){d(v,0)}function d(v,_){const y=a.newAttributes,x=a.enabledAttributes,b=a.attributeDivisors;y[v]=1,x[v]===0&&(i.enableVertexAttribArray(v),x[v]=1),b[v]!==_&&(i.vertexAttribDivisor(v,_),b[v]=_)}function p(){const v=a.newAttributes,_=a.enabledAttributes;for(let y=0,x=_.length;y<x;y++)_[y]!==v[y]&&(i.disableVertexAttribArray(y),_[y]=0)}function f(v,_,y,x,b,M,T){T===!0?i.vertexAttribIPointer(v,_,y,b,M):i.vertexAttribPointer(v,_,y,x,b,M)}function g(){m(),n=!0,a!==s&&(a=s,o(a.object))}function m(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:function(v,_,y,x,b){let M=!1;const T=function(A,L,U){const P=U.wireframe===!0;let E=r[A.id];E===void 0&&(E={},r[A.id]=E);let I=E[L.id];I===void 0&&(I={},E[L.id]=I);let S=I[P];return S===void 0&&(S=c(i.createVertexArray()),I[P]=S),S}(x,y,_);a!==T&&(a=T,o(a.object)),M=function(A,L,U,P){const E=a.attributes,I=L.attributes;let S=0;const V=U.getAttributes();for(const J in V)if(V[J].location>=0){const X=E[J];let te=I[J];if(te===void 0&&(J==="instanceMatrix"&&A.instanceMatrix&&(te=A.instanceMatrix),J==="instanceColor"&&A.instanceColor&&(te=A.instanceColor)),X===void 0||X.attribute!==te||te&&X.data!==te.data)return!0;S++}return a.attributesNum!==S||a.index!==P}(v,x,y,b),M&&function(A,L,U,P){const E={},I=L.attributes;let S=0;const V=U.getAttributes();for(const J in V)if(V[J].location>=0){let X=I[J];X===void 0&&(J==="instanceMatrix"&&A.instanceMatrix&&(X=A.instanceMatrix),J==="instanceColor"&&A.instanceColor&&(X=A.instanceColor));const te={};te.attribute=X,X&&X.data&&(te.data=X.data),E[J]=te,S++}a.attributes=E,a.attributesNum=S,a.index=P}(v,x,y,b),b!==null&&e.update(b,i.ELEMENT_ARRAY_BUFFER),(M||n)&&(n=!1,function(A,L,U,P){h();const E=P.attributes,I=U.getAttributes(),S=L.defaultAttributeValues;for(const V in I){const J=I[V];if(J.location>=0){let X=E[V];if(X===void 0&&(V==="instanceMatrix"&&A.instanceMatrix&&(X=A.instanceMatrix),V==="instanceColor"&&A.instanceColor&&(X=A.instanceColor)),X!==void 0){const te=X.normalized,ie=X.itemSize,fe=e.get(X);if(fe===void 0)continue;const B=fe.buffer,j=fe.type,ae=fe.bytesPerElement,O=j===i.INT||j===i.UNSIGNED_INT||X.gpuType===Vg;if(X.isInterleavedBufferAttribute){const D=X.data,ee=D.stride,ne=X.offset;if(D.isInstancedInterleavedBuffer){for(let K=0;K<J.locationSize;K++)d(J.location+K,D.meshPerAttribute);A.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=D.meshPerAttribute*D.count)}else for(let K=0;K<J.locationSize;K++)u(J.location+K);i.bindBuffer(i.ARRAY_BUFFER,B);for(let K=0;K<J.locationSize;K++)f(J.location+K,ie/J.locationSize,j,te,ee*ae,(ne+ie/J.locationSize*K)*ae,O)}else{if(X.isInstancedBufferAttribute){for(let D=0;D<J.locationSize;D++)d(J.location+D,X.meshPerAttribute);A.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=X.meshPerAttribute*X.count)}else for(let D=0;D<J.locationSize;D++)u(J.location+D);i.bindBuffer(i.ARRAY_BUFFER,B);for(let D=0;D<J.locationSize;D++)f(J.location+D,ie/J.locationSize,j,te,ie*ae,ie/J.locationSize*D*ae,O)}}else if(S!==void 0){const te=S[V];if(te!==void 0)switch(te.length){case 2:i.vertexAttrib2fv(J.location,te);break;case 3:i.vertexAttrib3fv(J.location,te);break;case 4:i.vertexAttrib4fv(J.location,te);break;default:i.vertexAttrib1fv(J.location,te)}}}}p()}(v,_,y,x),b!==null&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.get(b).buffer))},reset:g,resetDefaultState:m,dispose:function(){g();for(const v in r){const _=r[v];for(const y in _){const x=_[y];for(const b in x)l(x[b].object),delete x[b];delete _[y]}delete r[v]}},releaseStatesOfGeometry:function(v){if(r[v.id]===void 0)return;const _=r[v.id];for(const y in _){const x=_[y];for(const b in x)l(x[b].object),delete x[b];delete _[y]}delete r[v.id]},releaseStatesOfProgram:function(v){for(const _ in r){const y=r[_];if(y[v.id]===void 0)continue;const x=y[v.id];for(const b in x)l(x[b].object),delete x[b];delete y[v.id]}},initAttributes:h,enableAttribute:u,disableUnusedAttributes:p}}function BS(i,e,t){let r;function s(a,n,o){o!==0&&(i.drawArraysInstanced(r,a,n,o),t.update(n,r,o))}this.setMode=function(a){r=a},this.render=function(a,n){i.drawArrays(r,a,n),t.update(n,r,1)},this.renderInstances=s,this.renderMultiDraw=function(a,n,o){if(o===0)return;const l=e.get("WEBGL_multi_draw");if(l===null)for(let c=0;c<o;c++)this.render(a[c],n[c]);else{l.multiDrawArraysWEBGL(r,a,0,n,0,o);let c=0;for(let h=0;h<o;h++)c+=n[h];t.update(c,r,1)}},this.renderMultiDrawInstances=function(a,n,o,l){if(o===0)return;const c=e.get("WEBGL_multi_draw");if(c===null)for(let h=0;h<a.length;h++)s(a[h],n[h],l[h]);else{c.multiDrawArraysInstancedWEBGL(r,a,0,n,0,l,0,o);let h=0;for(let u=0;u<o;u++)h+=n[u];for(let u=0;u<l.length;u++)t.update(h,r,l[u])}}}function VS(i,e,t,r){let s;function a(u){if(u==="highp"){if(i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.HIGH_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision>0)return"highp";u="mediump"}return u==="mediump"&&i.getShaderPrecisionFormat(i.VERTEX_SHADER,i.MEDIUM_FLOAT).precision>0&&i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let n=t.precision!==void 0?t.precision:"highp";const o=a(n);o!==n&&(n=o);const l=t.logarithmicDepthBuffer===!0,c=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),h=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const u=e.get("EXT_texture_filter_anisotropic");s=i.getParameter(u.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s},getMaxPrecision:a,textureFormatReadable:function(u){return u===Hr||r.convert(u)===i.getParameter(i.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(u){const d=u===Yt&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(u!==Fn&&r.convert(u)!==i.getParameter(i.IMPLEMENTATION_COLOR_READ_TYPE)&&u!==wr&&!d)},precision:n,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:i.getParameter(i.MAX_TEXTURE_SIZE),maxCubemapSize:i.getParameter(i.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:i.getParameter(i.MAX_VERTEX_ATTRIBS),maxVertexUniforms:i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:i.getParameter(i.MAX_VARYING_VECTORS),maxFragmentUniforms:i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:h>0,maxSamples:i.getParameter(i.MAX_SAMPLES)}}function HS(i){const e=this;let t=null,r=0,s=!1,a=!1;const n=new Br,o=new ke,l={value:null,needsUpdate:!1};function c(h,u,d,p){const f=h!==null?h.length:0;let g=null;if(f!==0){if(g=l.value,p!==!0||g===null){const m=d+4*f,v=u.matrixWorldInverse;o.getNormalMatrix(v),(g===null||g.length<m)&&(g=new Float32Array(m));for(let _=0,y=d;_!==f;++_,y+=4)n.copy(h[_]).applyMatrix4(v,o),n.normal.toArray(g,y),g[y+3]=n.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=f,e.numIntersection=0,g}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,u){const d=h.length!==0||u||r!==0||s;return s=u,r=h.length,d},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(h,u){t=c(h,u,0)},this.setState=function(h,u,d){const p=h.clippingPlanes,f=h.clipIntersection,g=h.clipShadows,m=i.get(h);if(!s||p===null||p.length===0||a&&!g)a?c(null):function(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}();else{const v=a?0:r,_=4*v;let y=m.clippingState||null;l.value=y,y=c(p,u,_,d);for(let x=0;x!==_;++x)y[x]=t[x];m.clippingState=y,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=v}}}function GS(i){let e=new WeakMap;function t(s,a){return a===el?s.mapping=Hs:a===wc&&(s.mapping=La),s}function r(s){const a=s.target;a.removeEventListener("dispose",r);const n=e.get(a);n!==void 0&&(e.delete(a),n.dispose())}return{get:function(s){if(s&&s.isTexture){const a=s.mapping;if(a===el||a===wc){if(e.has(s))return t(e.get(s).texture,s.mapping);{const n=s.image;if(n&&n.height>0){const o=new yx(n.height);return o.fromEquirectangularTexture(i,s),e.set(s,o),s.addEventListener("dispose",r),t(o.texture,s.mapping)}return null}}}return s},dispose:function(){e=new WeakMap}}}class Gn extends ap{constructor(e=-1,t=1,r=1,s=-1,a=.1,n=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=s,this.near=a,this.far=n,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,s,a,n){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=s,this.view.width=a,this.view.height=n,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let a=r-e,n=r+e,o=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=c*this.view.offsetX,n=a+c*this.view.width,o-=h*this.view.offsetY,l=o-h*this.view.height}this.projectionMatrix.makeOrthographic(a,n,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Ov=[.125,.215,.35,.446,.526,.582],Wh=20,Qp=new Gn,Nv=new ve;let $p=null,Jp=0,em=0,tm=!1;const mn=(1+Math.sqrt(5))/2,go=1/mn,Uv=[new C(-mn,go,0),new C(mn,go,0),new C(-go,0,mn),new C(go,0,mn),new C(0,mn,-go),new C(0,mn,go),new C(-1,1,-1),new C(1,1,-1),new C(-1,1,1),new C(1,1,1)];class Wf{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,s=100){$p=this._renderer.getRenderTarget(),Jp=this._renderer.getActiveCubeFace(),em=this._renderer.getActiveMipmapLevel(),tm=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,r,s,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=zv(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Fv(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget($p,Jp,em),this._renderer.xr.enabled=tm,e.scissorTest=!1,Xh(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Hs||e.mapping===La?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),$p=this._renderer.getRenderTarget(),Jp=this._renderer.getActiveCubeFace(),em=this._renderer.getActiveMipmapLevel(),tm=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:qt,minFilter:qt,generateMipmaps:!1,type:Yt,format:Hr,colorSpace:si,depthBuffer:!1},s=kv(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=kv(e,t,r);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(n){const o=[],l=[],c=[];let h=n;const u=n-4+1+Ov.length;for(let d=0;d<u;d++){const p=Math.pow(2,h);l.push(p);let f=1/p;d>n-4?f=Ov[d-n+4-1]:d===0&&(f=0),c.push(f);const g=1/(p-2),m=-g,v=1+g,_=[m,m,v,m,v,v,m,m,v,v,m,v],y=6,x=6,b=3,M=2,T=1,A=new Float32Array(b*x*y),L=new Float32Array(M*x*y),U=new Float32Array(T*x*y);for(let E=0;E<y;E++){const I=E%3*2/3-1,S=E>2?0:-1,V=[I,S,0,I+2/3,S,0,I+2/3,S+1,0,I,S,0,I+2/3,S+1,0,I,S+1,0];A.set(V,b*x*E),L.set(_,M*x*E);const J=[E,E,E,E,E,E];U.set(J,T*x*E)}const P=new Ie;P.setAttribute("position",new Ke(A,b)),P.setAttribute("uv",new Ke(L,M)),P.setAttribute("faceIndex",new Ke(U,T)),o.push(P),h>4&&h--}return{lodPlanes:o,sizeLods:l,sigmas:c}}(a)),this._blurMaterial=function(n,o,l){const c=new Float32Array(Wh),h=new C(0,1,0);return new at({name:"SphericalGaussianBlur",defines:{n:Wh,CUBEUV_TEXEL_WIDTH:1/o,CUBEUV_TEXEL_HEIGHT:1/l,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:c},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:h}},vertexShader:Jg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}(a,e,t)}return s}_compileMaterial(e){const t=new ye(this._lodPlanes[0],e);this._renderer.compile(t,Qp)}_sceneToCubeUV(e,t,r,s){const a=new Zt(90,1,t,r),n=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,c=l.autoClear,h=l.toneMapping;l.getClearColor(Nv),l.toneMapping=cs,l.autoClear=!1;const u=new Qt({name:"PMREM.Background",side:Ri,depthWrite:!1,depthTest:!1}),d=new ye(new Lt,u);let p=!1;const f=e.background;f?f.isColor&&(u.color.copy(f),e.background=null,p=!0):(u.color.copy(Nv),p=!0);for(let g=0;g<6;g++){const m=g%3;m===0?(a.up.set(0,n[g],0),a.lookAt(o[g],0,0)):m===1?(a.up.set(0,0,n[g]),a.lookAt(0,o[g],0)):(a.up.set(0,n[g],0),a.lookAt(0,0,o[g]));const v=this._cubeSize;Xh(s,m*v,g>2?v:0,v,v),l.setRenderTarget(s),p&&l.render(d,a),l.render(e,a)}d.geometry.dispose(),d.material.dispose(),l.toneMapping=h,l.autoClear=c,e.background=f}_textureToCubeUV(e,t){const r=this._renderer,s=e.mapping===Hs||e.mapping===La;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=zv()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Fv());const a=s?this._cubemapMaterial:this._equirectMaterial,n=new ye(this._lodPlanes[0],a);a.uniforms.envMap.value=e;const o=this._cubeSize;Xh(t,0,0,3*o,2*o),r.setRenderTarget(t),r.render(n,Qp)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let a=1;a<s;a++){const n=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),o=Uv[(s-a-1)%Uv.length];this._blur(e,a-1,a,n,o)}t.autoClear=r}_blur(e,t,r,s,a){const n=this._pingPongRenderTarget;this._halfBlur(e,n,t,r,s,"latitudinal",a),this._halfBlur(n,e,r,r,s,"longitudinal",a)}_halfBlur(e,t,r,s,a,n,o){const l=this._renderer,c=this._blurMaterial,h=new ye(this._lodPlanes[s],c),u=c.uniforms,d=this._sizeLods[r]-1,p=isFinite(a)?Math.PI/(2*d):2*Math.PI/39,f=a/p,g=isFinite(a)?1+Math.floor(3*f):Wh,m=[];let v=0;for(let x=0;x<Wh;++x){const b=x/f,M=Math.exp(-b*b/2);m.push(M),x===0?v+=M:x<g&&(v+=2*M)}for(let x=0;x<m.length;x++)m[x]=m[x]/v;u.envMap.value=e.texture,u.samples.value=g,u.weights.value=m,u.latitudinal.value=n==="latitudinal",o&&(u.poleAxis.value=o);const{_lodMax:_}=this;u.dTheta.value=p,u.mipInt.value=_-r;const y=this._sizeLods[s];Xh(t,3*y*(s>_-4?s-_+4:0),4*(this._cubeSize-y),3*y,2*y),l.setRenderTarget(t),l.render(h,Qp)}}function kv(i,e,t){const r=new pt(i,e,t);return r.texture.mapping=yl,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Xh(i,e,t,r,s){i.viewport.set(e,t,r,s),i.scissor.set(e,t,r,s)}function Fv(){return new at({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Jg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function zv(){return new at({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Jg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:0,depthTest:!1,depthWrite:!1})}function Jg(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function jS(i){let e=new WeakMap,t=null;function r(s){const a=s.target;a.removeEventListener("dispose",r);const n=e.get(a);n!==void 0&&(e.delete(a),n.dispose())}return{get:function(s){if(s&&s.isTexture){const a=s.mapping,n=a===el||a===wc,o=a===Hs||a===La;if(n||o){let l=e.get(s);const c=l!==void 0?l.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==c)return t===null&&(t=new Wf(i)),l=n?t.fromEquirectangular(s,l):t.fromCubemap(s,l),l.texture.pmremVersion=s.pmremVersion,e.set(s,l),l.texture;if(l!==void 0)return l.texture;{const h=s.image;return n&&h&&h.height>0||o&&h&&function(u){let d=0;const p=6;for(let f=0;f<p;f++)u[f]!==void 0&&d++;return d===p}(h)?(t===null&&(t=new Wf(i)),l=n?t.fromEquirectangular(s):t.fromCubemap(s),l.texture.pmremVersion=s.pmremVersion,e.set(s,l),s.addEventListener("dispose",r),l.texture):null}}}return s},dispose:function(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}}}function WS(i){const e={};function t(r){if(e[r]!==void 0)return e[r];let s;switch(r){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(r)}return e[r]=s,s}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){return t(r)}}}function XS(i,e,t,r){const s={},a=new WeakMap;function n(l){const c=l.target;c.index!==null&&e.remove(c.index);for(const u in c.attributes)e.remove(c.attributes[u]);for(const u in c.morphAttributes){const d=c.morphAttributes[u];for(let p=0,f=d.length;p<f;p++)e.remove(d[p])}c.removeEventListener("dispose",n),delete s[c.id];const h=a.get(c);h&&(e.remove(h),a.delete(c)),r.releaseStatesOfGeometry(c),c.isInstancedBufferGeometry===!0&&delete c._maxInstanceCount,t.memory.geometries--}function o(l){const c=[],h=l.index,u=l.attributes.position;let d=0;if(h!==null){const g=h.array;d=h.version;for(let m=0,v=g.length;m<v;m+=3){const _=g[m+0],y=g[m+1],x=g[m+2];c.push(_,y,y,x,x,_)}}else{if(u===void 0)return;{const g=u.array;d=u.version;for(let m=0,v=g.length/3-1;m<v;m+=3){const _=m+0,y=m+1,x=m+2;c.push(_,y,y,x,x,_)}}}const p=new(ux(c)?$g:sp)(c,1);p.version=d;const f=a.get(l);f&&e.remove(f),a.set(l,p)}return{get:function(l,c){return s[c.id]===!0||(c.addEventListener("dispose",n),s[c.id]=!0,t.memory.geometries++),c},update:function(l){const c=l.attributes;for(const u in c)e.update(c[u],i.ARRAY_BUFFER);const h=l.morphAttributes;for(const u in h){const d=h[u];for(let p=0,f=d.length;p<f;p++)e.update(d[p],i.ARRAY_BUFFER)}},getWireframeAttribute:function(l){const c=a.get(l);if(c){const h=l.index;h!==null&&c.version<h.version&&o(l)}else o(l);return a.get(l)}}}function qS(i,e,t){let r,s,a;function n(o,l,c){c!==0&&(i.drawElementsInstanced(r,l,s,o*a,c),t.update(l,r,c))}this.setMode=function(o){r=o},this.setIndex=function(o){s=o.type,a=o.bytesPerElement},this.render=function(o,l){i.drawElements(r,l,s,o*a),t.update(l,r,1)},this.renderInstances=n,this.renderMultiDraw=function(o,l,c){if(c===0)return;const h=e.get("WEBGL_multi_draw");if(h===null)for(let u=0;u<c;u++)this.render(o[u]/a,l[u]);else{h.multiDrawElementsWEBGL(r,l,0,s,o,0,c);let u=0;for(let d=0;d<c;d++)u+=l[d];t.update(u,r,1)}},this.renderMultiDrawInstances=function(o,l,c,h){if(c===0)return;const u=e.get("WEBGL_multi_draw");if(u===null)for(let d=0;d<o.length;d++)n(o[d]/a,l[d],h[d]);else{u.multiDrawElementsInstancedWEBGL(r,l,0,s,o,0,h,0,c);let d=0;for(let p=0;p<c;p++)d+=l[p];for(let p=0;p<h.length;p++)t.update(d,r,h[p])}}}function YS(i){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,r,s){switch(e.calls++,r){case i.TRIANGLES:e.triangles+=s*(t/3);break;case i.LINES:e.lines+=s*(t/2);break;case i.LINE_STRIP:e.lines+=s*(t-1);break;case i.LINE_LOOP:e.lines+=s*t;break;case i.POINTS:e.points+=s*t}}}}function ZS(i,e,t){const r=new WeakMap,s=new qe;return{update:function(a,n,o){const l=a.morphTargetInfluences,c=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,h=c!==void 0?c.length:0;let u=r.get(n);if(u===void 0||u.count!==h){u!==void 0&&u.texture.dispose();const d=n.morphAttributes.position!==void 0,p=n.morphAttributes.normal!==void 0,f=n.morphAttributes.color!==void 0,g=n.morphAttributes.position||[],m=n.morphAttributes.normal||[],v=n.morphAttributes.color||[];let _=0;d===!0&&(_=1),p===!0&&(_=2),f===!0&&(_=3);let y=n.attributes.position.count*_,x=1;y>e.maxTextureSize&&(x=Math.ceil(y/e.maxTextureSize),y=e.maxTextureSize);const b=new Float32Array(y*x*4*h),M=new hd(b,y,x,h);M.type=wr,M.needsUpdate=!0;const T=4*_;for(let A=0;A<h;A++){const L=g[A],U=m[A],P=v[A],E=y*x*4*A;for(let I=0;I<L.count;I++){const S=I*T;d===!0&&(s.fromBufferAttribute(L,I),b[E+S+0]=s.x,b[E+S+1]=s.y,b[E+S+2]=s.z,b[E+S+3]=0),p===!0&&(s.fromBufferAttribute(U,I),b[E+S+4]=s.x,b[E+S+5]=s.y,b[E+S+6]=s.z,b[E+S+7]=0),f===!0&&(s.fromBufferAttribute(P,I),b[E+S+8]=s.x,b[E+S+9]=s.y,b[E+S+10]=s.z,b[E+S+11]=P.itemSize===4?s.w:1)}}u={count:h,texture:M,size:new se(y,x)},r.set(n,u),n.addEventListener("dispose",function A(){M.dispose(),r.delete(n),n.removeEventListener("dispose",A)})}if(a.isInstancedMesh===!0&&a.morphTexture!==null)o.getUniforms().setValue(i,"morphTexture",a.morphTexture,t);else{let d=0;for(let f=0;f<l.length;f++)d+=l[f];const p=n.morphTargetsRelative?1:1-d;o.getUniforms().setValue(i,"morphTargetBaseInfluence",p),o.getUniforms().setValue(i,"morphTargetInfluences",l)}o.getUniforms().setValue(i,"morphTargetsTexture",u.texture,t),o.getUniforms().setValue(i,"morphTargetsTextureSize",u.size)}}}function KS(i,e,t,r){let s=new WeakMap;function a(n){const o=n.target;o.removeEventListener("dispose",a),t.remove(o.instanceMatrix),o.instanceColor!==null&&t.remove(o.instanceColor)}return{update:function(n){const o=r.render.frame,l=n.geometry,c=e.get(n,l);if(s.get(c)!==o&&(e.update(c),s.set(c,o)),n.isInstancedMesh&&(n.hasEventListener("dispose",a)===!1&&n.addEventListener("dispose",a),s.get(n)!==o&&(t.update(n.instanceMatrix,i.ARRAY_BUFFER),n.instanceColor!==null&&t.update(n.instanceColor,i.ARRAY_BUFFER),s.set(n,o))),n.isSkinnedMesh){const h=n.skeleton;s.get(h)!==o&&(h.update(),s.set(h,o))}return c},dispose:function(){s=new WeakMap}}}class lh extends yt{constructor(e,t,r,s,a,n,o,l,c,h){if((h=h!==void 0?h:An)!==An&&h!==Bn)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&h===An&&(r=zn),r===void 0&&h===Bn&&(r=Zn),super(null,s,a,n,o,l,h,r,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:lt,this.minFilter=l!==void 0?l:lt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const bx=new yt,Mx=new lh(1,1);Mx.compareFunction=515;const wx=new hd,Sx=new jf,Tx=new Ic,Bv=[],Vv=[],Hv=new Float32Array(16),Gv=new Float32Array(9),jv=new Float32Array(4);function xl(i,e,t){const r=i[0];if(r<=0||r>0)return i;const s=e*t;let a=Bv[s];if(a===void 0&&(a=new Float32Array(s),Bv[s]=a),e!==0){r.toArray(a,0);for(let n=1,o=0;n!==e;++n)o+=t,i[n].toArray(a,o)}return a}function li(i,e){if(i.length!==e.length)return!1;for(let t=0,r=i.length;t<r;t++)if(i[t]!==e[t])return!1;return!0}function ci(i,e){for(let t=0,r=e.length;t<r;t++)i[t]=e[t]}function np(i,e){let t=Vv[e];t===void 0&&(t=new Int32Array(e),Vv[e]=t);for(let r=0;r!==e;++r)t[r]=i.allocateTextureUnit();return t}function QS(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function $S(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(li(t,e))return;i.uniform2fv(this.addr,e),ci(t,e)}}function JS(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)t[0]===e.r&&t[1]===e.g&&t[2]===e.b||(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(li(t,e))return;i.uniform3fv(this.addr,e),ci(t,e)}}function e2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(li(t,e))return;i.uniform4fv(this.addr,e),ci(t,e)}}function t2(i,e){const t=this.cache,r=e.elements;if(r===void 0){if(li(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),ci(t,e)}else{if(li(t,r))return;jv.set(r),i.uniformMatrix2fv(this.addr,!1,jv),ci(t,r)}}function i2(i,e){const t=this.cache,r=e.elements;if(r===void 0){if(li(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),ci(t,e)}else{if(li(t,r))return;Gv.set(r),i.uniformMatrix3fv(this.addr,!1,Gv),ci(t,r)}}function r2(i,e){const t=this.cache,r=e.elements;if(r===void 0){if(li(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),ci(t,e)}else{if(li(t,r))return;Hv.set(r),i.uniformMatrix4fv(this.addr,!1,Hv),ci(t,r)}}function s2(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function a2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(i.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(li(t,e))return;i.uniform2iv(this.addr,e),ci(t,e)}}function n2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(i.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(li(t,e))return;i.uniform3iv(this.addr,e),ci(t,e)}}function o2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(i.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(li(t,e))return;i.uniform4iv(this.addr,e),ci(t,e)}}function l2(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function c2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(i.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(li(t,e))return;i.uniform2uiv(this.addr,e),ci(t,e)}}function h2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(i.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(li(t,e))return;i.uniform3uiv(this.addr,e),ci(t,e)}}function u2(i,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(i.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(li(t,e))return;i.uniform4uiv(this.addr,e),ci(t,e)}}function d2(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s);const a=this.type===i.SAMPLER_2D_SHADOW?Mx:bx;t.setTexture2D(e||a,s)}function p2(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),t.setTexture3D(e||Sx,s)}function m2(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),t.setTextureCube(e||Tx,s)}function f2(i,e,t){const r=this.cache,s=t.allocateTextureUnit();r[0]!==s&&(i.uniform1i(this.addr,s),r[0]=s),t.setTexture2DArray(e||wx,s)}function g2(i,e){i.uniform1fv(this.addr,e)}function v2(i,e){const t=xl(e,this.size,2);i.uniform2fv(this.addr,t)}function _2(i,e){const t=xl(e,this.size,3);i.uniform3fv(this.addr,t)}function y2(i,e){const t=xl(e,this.size,4);i.uniform4fv(this.addr,t)}function x2(i,e){const t=xl(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function b2(i,e){const t=xl(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function M2(i,e){const t=xl(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function w2(i,e){i.uniform1iv(this.addr,e)}function S2(i,e){i.uniform2iv(this.addr,e)}function T2(i,e){i.uniform3iv(this.addr,e)}function E2(i,e){i.uniform4iv(this.addr,e)}function A2(i,e){i.uniform1uiv(this.addr,e)}function C2(i,e){i.uniform2uiv(this.addr,e)}function P2(i,e){i.uniform3uiv(this.addr,e)}function R2(i,e){i.uniform4uiv(this.addr,e)}function I2(i,e,t){const r=this.cache,s=e.length,a=np(t,s);li(r,a)||(i.uniform1iv(this.addr,a),ci(r,a));for(let n=0;n!==s;++n)t.setTexture2D(e[n]||bx,a[n])}function L2(i,e,t){const r=this.cache,s=e.length,a=np(t,s);li(r,a)||(i.uniform1iv(this.addr,a),ci(r,a));for(let n=0;n!==s;++n)t.setTexture3D(e[n]||Sx,a[n])}function D2(i,e,t){const r=this.cache,s=e.length,a=np(t,s);li(r,a)||(i.uniform1iv(this.addr,a),ci(r,a));for(let n=0;n!==s;++n)t.setTextureCube(e[n]||Tx,a[n])}function O2(i,e,t){const r=this.cache,s=e.length,a=np(t,s);li(r,a)||(i.uniform1iv(this.addr,a),ci(r,a));for(let n=0;n!==s;++n)t.setTexture2DArray(e[n]||wx,a[n])}class N2{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=function(s){switch(s){case 5126:return QS;case 35664:return $S;case 35665:return JS;case 35666:return e2;case 35674:return t2;case 35675:return i2;case 35676:return r2;case 5124:case 35670:return s2;case 35667:case 35671:return a2;case 35668:case 35672:return n2;case 35669:case 35673:return o2;case 5125:return l2;case 36294:return c2;case 36295:return h2;case 36296:return u2;case 35678:case 36198:case 36298:case 36306:case 35682:return d2;case 35679:case 36299:case 36307:return p2;case 35680:case 36300:case 36308:case 36293:return m2;case 36289:case 36303:case 36311:case 36292:return f2}}(t.type)}}class U2{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(s){switch(s){case 5126:return g2;case 35664:return v2;case 35665:return _2;case 35666:return y2;case 35674:return x2;case 35675:return b2;case 35676:return M2;case 5124:case 35670:return w2;case 35667:case 35671:return S2;case 35668:case 35672:return T2;case 35669:case 35673:return E2;case 5125:return A2;case 36294:return C2;case 36295:return P2;case 36296:return R2;case 35678:case 36198:case 36298:case 36306:case 35682:return I2;case 35679:case 36299:case 36307:return L2;case 35680:case 36300:case 36308:case 36293:return D2;case 36289:case 36303:case 36311:case 36292:return O2}}(t.type)}}class k2{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const s=this.seq;for(let a=0,n=s.length;a!==n;++a){const o=s[a];o.setValue(e,t[o.id],r)}}}const im=/(\w+)(\])?(\[|\.)?/g;function Wv(i,e){i.seq.push(e),i.map[e.id]=e}function F2(i,e,t){const r=i.name,s=r.length;for(im.lastIndex=0;;){const a=im.exec(r),n=im.lastIndex;let o=a[1];const l=a[2]==="]",c=a[3];if(l&&(o|=0),c===void 0||c==="["&&n+2===s){Wv(t,c===void 0?new N2(o,i,e):new U2(o,i,e));break}{let h=t.map[o];h===void 0&&(h=new k2(o),Wv(t,h)),t=h}}}class Ju{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<r;++s){const a=e.getActiveUniform(t,s);F2(a,e.getUniformLocation(t,a.name),this)}}setValue(e,t,r,s){const a=this.map[t];a!==void 0&&a.setValue(e,r,s)}setOptional(e,t,r){const s=t[r];s!==void 0&&this.setValue(e,r,s)}static upload(e,t,r,s){for(let a=0,n=t.length;a!==n;++a){const o=t[a],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,s)}}static seqWithValue(e,t){const r=[];for(let s=0,a=e.length;s!==a;++s){const n=e[s];n.id in t&&r.push(n)}return r}}function Xv(i,e,t){const r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}const z2=37297;let B2=0;function qv(i,e,t){const r=i.getShaderParameter(e,i.COMPILE_STATUS),s=i.getShaderInfoLog(e).trim();if(r&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const n=parseInt(a[1]);return t.toUpperCase()+`

`+s+`

`+function(o,l){const c=o.split(`
`),h=[],u=Math.max(l-6,0),d=Math.min(l+6,c.length);for(let p=u;p<d;p++){const f=p+1;h.push(`${f===l?">":" "} ${f}: ${c[p]}`)}return h.join(`
`)}(i.getShaderSource(e),n)}return s}function V2(i,e){const t=function(r){const s=ct.getPrimaries(ct.workingColorSpace),a=ct.getPrimaries(r);let n;switch(s===a?n="":s===Ac&&a===Ec?n="LinearDisplayP3ToLinearSRGB":s===Ec&&a===Ac&&(n="LinearSRGBToLinearDisplayP3"),r){case si:case nh:return[n,"LinearTransferOETF"];case Mt:case ip:return[n,"sRGBTransferOETF"];default:return[n,"LinearTransferOETF"]}}(e);return`vec4 ${i}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function H2(i,e){let t;switch(e){case Yd:t="Linear";break;case Zd:t="Reinhard";break;case Kd:t="OptimizedCineon";break;case Qd:t="ACESFilmic";break;case $d:t="AgX";break;case Bg:t="Neutral";break;case zg:t="Custom";break;default:t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Pl(i){return i!==""}function Yv(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Zv(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const G2=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xf(i){return i.replace(G2,W2)}const j2=new Map;function W2(i,e){let t=He[e];if(t===void 0){const r=j2.get(e);if(r===void 0)throw new Error("Can not resolve #include <"+e+">");t=He[r]}return Xf(t)}const X2=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Kv(i){return i.replace(X2,q2)}function q2(i,e,t,r){let s="";for(let a=parseInt(e);a<parseInt(t);a++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return s}function Qv(i){let e=`precision ${i.precision} float;
	precision ${i.precision} int;
	precision ${i.precision} sampler2D;
	precision ${i.precision} samplerCube;
	precision ${i.precision} sampler3D;
	precision ${i.precision} sampler2DArray;
	precision ${i.precision} sampler2DShadow;
	precision ${i.precision} samplerCubeShadow;
	precision ${i.precision} sampler2DArrayShadow;
	precision ${i.precision} isampler2D;
	precision ${i.precision} isampler3D;
	precision ${i.precision} isamplerCube;
	precision ${i.precision} isampler2DArray;
	precision ${i.precision} usampler2D;
	precision ${i.precision} usampler3D;
	precision ${i.precision} usamplerCube;
	precision ${i.precision} usampler2DArray;
	`;return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Y2(i,e,t,r){const s=i.getContext(),a=t.defines;let n=t.vertexShader,o=t.fragmentShader;const l=function(P){let E="SHADOWMAP_TYPE_BASIC";return P.shadowMapType===Gd?E="SHADOWMAP_TYPE_PCF":P.shadowMapType===Fg?E="SHADOWMAP_TYPE_PCF_SOFT":P.shadowMapType===kr&&(E="SHADOWMAP_TYPE_VSM"),E}(t),c=function(P){let E="ENVMAP_TYPE_CUBE";if(P.envMap)switch(P.envMapMode){case Hs:case La:E="ENVMAP_TYPE_CUBE";break;case yl:E="ENVMAP_TYPE_CUBE_UV"}return E}(t),h=function(P){let E="ENVMAP_MODE_REFLECTION";return P.envMap&&P.envMapMode===La&&(E="ENVMAP_MODE_REFRACTION"),E}(t),u=function(P){let E="ENVMAP_BLENDING_NONE";if(P.envMap)switch(P.combine){case ah:E="ENVMAP_BLENDING_MULTIPLY";break;case ox:E="ENVMAP_BLENDING_MIX";break;case lx:E="ENVMAP_BLENDING_ADD"}return E}(t),d=function(P){const E=P.envMapCubeUVHeight;if(E===null)return null;const I=Math.log2(E)-2,S=1/E;return{texelWidth:1/(3*Math.max(Math.pow(2,I),112)),texelHeight:S,maxMip:I}}(t),p=function(P){return[P.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",P.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Pl).join(`
`)}(t),f=function(P){const E=[];for(const I in P){const S=P[I];S!==!1&&E.push("#define "+I+" "+S)}return E.join(`
`)}(a),g=s.createProgram();let m,v,_=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(Pl).join(`
`),m.length>0&&(m+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f].filter(Pl).join(`
`),v.length>0&&(v+=`
`)):(m=[Qv(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Pl).join(`
`),v=[Qv(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,f,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",t.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==cs?"#define TONE_MAPPING":"",t.toneMapping!==cs?He.tonemapping_pars_fragment:"",t.toneMapping!==cs?H2("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",He.colorspace_pars_fragment,V2("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Pl).join(`
`)),n=Xf(n),n=Yv(n,t),n=Zv(n,t),o=Xf(o),o=Yv(o,t),o=Zv(o,t),n=Kv(n),o=Kv(o),t.isRawShaderMaterial!==!0&&(_=`#version 300 es
`,m=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["#define varying in",t.glslVersion===Hf?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Hf?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const y=_+m+n,x=_+v+o,b=Xv(s,s.VERTEX_SHADER,y),M=Xv(s,s.FRAGMENT_SHADER,x);function T(P){if(i.debug.checkShaderErrors){const E=s.getProgramInfoLog(g).trim(),I=s.getShaderInfoLog(b).trim(),S=s.getShaderInfoLog(M).trim();let V=!0,J=!0;s.getProgramParameter(g,s.LINK_STATUS)===!1?(V=!1,typeof i.debug.onShaderError=="function"?i.debug.onShaderError(s,g,b,M):(qv(s,b,"vertex"),qv(s,M,"fragment"))):E!==""||I!==""&&S!==""||(J=!1),J&&(P.diagnostics={runnable:V,programLog:E,vertexShader:{log:I,prefix:m},fragmentShader:{log:S,prefix:v}})}s.deleteShader(b),s.deleteShader(M),A=new Ju(s,g),L=function(E,I){const S={},V=E.getProgramParameter(I,E.ACTIVE_ATTRIBUTES);for(let J=0;J<V;J++){const X=E.getActiveAttrib(I,J),te=X.name;let ie=1;X.type===E.FLOAT_MAT2&&(ie=2),X.type===E.FLOAT_MAT3&&(ie=3),X.type===E.FLOAT_MAT4&&(ie=4),S[te]={type:X.type,location:E.getAttribLocation(I,te),locationSize:ie}}return S}(s,g)}let A,L;s.attachShader(g,b),s.attachShader(g,M),t.index0AttributeName!==void 0?s.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(g,0,"position"),s.linkProgram(g),this.getUniforms=function(){return A===void 0&&T(this),A},this.getAttributes=function(){return L===void 0&&T(this),L};let U=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return U===!1&&(U=s.getProgramParameter(g,z2)),U},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=B2++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=b,this.fragmentShader=M,this}let Z2=0;class K2{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,s=this._getShaderStage(t),a=this._getShaderStage(r),n=this._getShaderCacheForMaterial(e);return n.has(s)===!1&&(n.add(s),s.usedTimes++),n.has(a)===!1&&(n.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new Q2(e),t.set(e,r)),r}}class Q2{constructor(e){this.id=Z2++,this.code=e,this.usedTimes=0}}function $2(i,e,t,r,s,a,n){const o=new rp,l=new K2,c=new Set,h=[],u=s.logarithmicDepthBuffer,d=s.vertexTextures;let p=s.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(m){return c.add(m),m===0?"uv":`uv${m}`}return{getParameters:function(m,v,_,y,x){const b=y.fog,M=x.geometry,T=m.isMeshStandardMaterial?y.environment:null,A=(m.isMeshStandardMaterial?t:e).get(m.envMap||T),L=A&&A.mapping===yl?A.image.height:null,U=f[m.type];m.precision!==null&&(p=s.getMaxPrecision(m.precision),m.precision);const P=M.morphAttributes.position||M.morphAttributes.normal||M.morphAttributes.color,E=P!==void 0?P.length:0;let I,S,V,J,X=0;if(M.morphAttributes.position!==void 0&&(X=1),M.morphAttributes.normal!==void 0&&(X=2),M.morphAttributes.color!==void 0&&(X=3),U){const Ga=ki[U];I=Ga.vertexShader,S=Ga.fragmentShader}else I=m.vertexShader,S=m.fragmentShader,l.update(m),V=l.getVertexShaderID(m),J=l.getFragmentShaderID(m);const te=i.getRenderTarget(),ie=x.isInstancedMesh===!0,fe=x.isBatchedMesh===!0,B=!!m.map,j=!!m.matcap,ae=!!A,O=!!m.aoMap,D=!!m.lightMap,ee=!!m.bumpMap,ne=!!m.normalMap,K=!!m.displacementMap,W=!!m.emissiveMap,$=!!m.metalnessMap,k=!!m.roughnessMap,Q=m.anisotropy>0,re=m.clearcoat>0,w=m.dispersion>0,G=m.iridescence>0,Z=m.sheen>0,F=m.transmission>0,R=Q&&!!m.anisotropyMap,N=re&&!!m.clearcoatMap,z=re&&!!m.clearcoatNormalMap,Y=re&&!!m.clearcoatRoughnessMap,q=G&&!!m.iridescenceMap,he=G&&!!m.iridescenceThicknessMap,de=Z&&!!m.sheenColorMap,ue=Z&&!!m.sheenRoughnessMap,we=!!m.specularMap,Ne=!!m.specularColorMap,xe=!!m.specularIntensityMap,Ue=F&&!!m.transmissionMap,je=F&&!!m.thicknessMap,Je=!!m.gradientMap,It=!!m.alphaMap,nt=m.alphaTest>0,ce=!!m.alphaHash,bs=!!m.extensions;let Li=cs;m.toneMapped&&(te!==null&&te.isXRRenderTarget!==!0||(Li=i.toneMapping));const Et={shaderID:U,shaderType:m.type,shaderName:m.name,vertexShader:I,fragmentShader:S,defines:m.defines,customVertexShaderID:V,customFragmentShaderID:J,isRawShaderMaterial:m.isRawShaderMaterial===!0,glslVersion:m.glslVersion,precision:p,batching:fe,instancing:ie,instancingColor:ie&&x.instanceColor!==null,instancingMorph:ie&&x.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:te===null?i.outputColorSpace:te.isXRRenderTarget===!0?te.texture.colorSpace:si,alphaToCoverage:!!m.alphaToCoverage,map:B,matcap:j,envMap:ae,envMapMode:ae&&A.mapping,envMapCubeUVHeight:L,aoMap:O,lightMap:D,bumpMap:ee,normalMap:ne,displacementMap:d&&K,emissiveMap:W,normalMapObjectSpace:ne&&m.normalMapType===1,normalMapTangentSpace:ne&&m.normalMapType===0,metalnessMap:$,roughnessMap:k,anisotropy:Q,anisotropyMap:R,clearcoat:re,clearcoatMap:N,clearcoatNormalMap:z,clearcoatRoughnessMap:Y,dispersion:w,iridescence:G,iridescenceMap:q,iridescenceThicknessMap:he,sheen:Z,sheenColorMap:de,sheenRoughnessMap:ue,specularMap:we,specularColorMap:Ne,specularIntensityMap:xe,transmission:F,transmissionMap:Ue,thicknessMap:je,gradientMap:Je,opaque:m.transparent===!1&&m.blending===1&&m.alphaToCoverage===!1,alphaMap:It,alphaTest:nt,alphaHash:ce,combine:m.combine,mapUv:B&&g(m.map.channel),aoMapUv:O&&g(m.aoMap.channel),lightMapUv:D&&g(m.lightMap.channel),bumpMapUv:ee&&g(m.bumpMap.channel),normalMapUv:ne&&g(m.normalMap.channel),displacementMapUv:K&&g(m.displacementMap.channel),emissiveMapUv:W&&g(m.emissiveMap.channel),metalnessMapUv:$&&g(m.metalnessMap.channel),roughnessMapUv:k&&g(m.roughnessMap.channel),anisotropyMapUv:R&&g(m.anisotropyMap.channel),clearcoatMapUv:N&&g(m.clearcoatMap.channel),clearcoatNormalMapUv:z&&g(m.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Y&&g(m.clearcoatRoughnessMap.channel),iridescenceMapUv:q&&g(m.iridescenceMap.channel),iridescenceThicknessMapUv:he&&g(m.iridescenceThicknessMap.channel),sheenColorMapUv:de&&g(m.sheenColorMap.channel),sheenRoughnessMapUv:ue&&g(m.sheenRoughnessMap.channel),specularMapUv:we&&g(m.specularMap.channel),specularColorMapUv:Ne&&g(m.specularColorMap.channel),specularIntensityMapUv:xe&&g(m.specularIntensityMap.channel),transmissionMapUv:Ue&&g(m.transmissionMap.channel),thicknessMapUv:je&&g(m.thicknessMap.channel),alphaMapUv:It&&g(m.alphaMap.channel),vertexTangents:!!M.attributes.tangent&&(ne||Q),vertexColors:m.vertexColors,vertexAlphas:m.vertexColors===!0&&!!M.attributes.color&&M.attributes.color.itemSize===4,pointsUvs:x.isPoints===!0&&!!M.attributes.uv&&(B||It),fog:!!b,useFog:m.fog===!0,fogExp2:!!b&&b.isFogExp2,flatShading:m.flatShading===!0,sizeAttenuation:m.sizeAttenuation===!0,logarithmicDepthBuffer:u,skinning:x.isSkinnedMesh===!0,morphTargets:M.morphAttributes.position!==void 0,morphNormals:M.morphAttributes.normal!==void 0,morphColors:M.morphAttributes.color!==void 0,morphTargetsCount:E,morphTextureStride:X,numDirLights:v.directional.length,numPointLights:v.point.length,numSpotLights:v.spot.length,numSpotLightMaps:v.spotLightMap.length,numRectAreaLights:v.rectArea.length,numHemiLights:v.hemi.length,numDirLightShadows:v.directionalShadowMap.length,numPointLightShadows:v.pointShadowMap.length,numSpotLightShadows:v.spotShadowMap.length,numSpotLightShadowsWithMaps:v.numSpotLightShadowsWithMaps,numLightProbes:v.numLightProbes,numClippingPlanes:n.numPlanes,numClipIntersection:n.numIntersection,dithering:m.dithering,shadowMapEnabled:i.shadowMap.enabled&&_.length>0,shadowMapType:i.shadowMap.type,toneMapping:Li,useLegacyLights:i._useLegacyLights,decodeVideoTexture:B&&m.map.isVideoTexture===!0&&ct.getTransfer(m.map.colorSpace)===bt,premultipliedAlpha:m.premultipliedAlpha,doubleSided:m.side===Rt,flipSided:m.side===Ri,useDepthPacking:m.depthPacking>=0,depthPacking:m.depthPacking||0,index0AttributeName:m.index0AttributeName,extensionClipCullDistance:bs&&m.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:bs&&m.extensions.multiDraw===!0&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:m.customProgramCacheKey()};return Et.vertexUv1s=c.has(1),Et.vertexUv2s=c.has(2),Et.vertexUv3s=c.has(3),c.clear(),Et},getProgramCacheKey:function(m){const v=[];if(m.shaderID?v.push(m.shaderID):(v.push(m.customVertexShaderID),v.push(m.customFragmentShaderID)),m.defines!==void 0)for(const _ in m.defines)v.push(_),v.push(m.defines[_]);return m.isRawShaderMaterial===!1&&(function(_,y){_.push(y.precision),_.push(y.outputColorSpace),_.push(y.envMapMode),_.push(y.envMapCubeUVHeight),_.push(y.mapUv),_.push(y.alphaMapUv),_.push(y.lightMapUv),_.push(y.aoMapUv),_.push(y.bumpMapUv),_.push(y.normalMapUv),_.push(y.displacementMapUv),_.push(y.emissiveMapUv),_.push(y.metalnessMapUv),_.push(y.roughnessMapUv),_.push(y.anisotropyMapUv),_.push(y.clearcoatMapUv),_.push(y.clearcoatNormalMapUv),_.push(y.clearcoatRoughnessMapUv),_.push(y.iridescenceMapUv),_.push(y.iridescenceThicknessMapUv),_.push(y.sheenColorMapUv),_.push(y.sheenRoughnessMapUv),_.push(y.specularMapUv),_.push(y.specularColorMapUv),_.push(y.specularIntensityMapUv),_.push(y.transmissionMapUv),_.push(y.thicknessMapUv),_.push(y.combine),_.push(y.fogExp2),_.push(y.sizeAttenuation),_.push(y.morphTargetsCount),_.push(y.morphAttributeCount),_.push(y.numDirLights),_.push(y.numPointLights),_.push(y.numSpotLights),_.push(y.numSpotLightMaps),_.push(y.numHemiLights),_.push(y.numRectAreaLights),_.push(y.numDirLightShadows),_.push(y.numPointLightShadows),_.push(y.numSpotLightShadows),_.push(y.numSpotLightShadowsWithMaps),_.push(y.numLightProbes),_.push(y.shadowMapType),_.push(y.toneMapping),_.push(y.numClippingPlanes),_.push(y.numClipIntersection),_.push(y.depthPacking)}(v,m),function(_,y){o.disableAll(),y.supportsVertexTextures&&o.enable(0),y.instancing&&o.enable(1),y.instancingColor&&o.enable(2),y.instancingMorph&&o.enable(3),y.matcap&&o.enable(4),y.envMap&&o.enable(5),y.normalMapObjectSpace&&o.enable(6),y.normalMapTangentSpace&&o.enable(7),y.clearcoat&&o.enable(8),y.iridescence&&o.enable(9),y.alphaTest&&o.enable(10),y.vertexColors&&o.enable(11),y.vertexAlphas&&o.enable(12),y.vertexUv1s&&o.enable(13),y.vertexUv2s&&o.enable(14),y.vertexUv3s&&o.enable(15),y.vertexTangents&&o.enable(16),y.anisotropy&&o.enable(17),y.alphaHash&&o.enable(18),y.batching&&o.enable(19),y.dispersion&&o.enable(20),_.push(o.mask),o.disableAll(),y.fog&&o.enable(0),y.useFog&&o.enable(1),y.flatShading&&o.enable(2),y.logarithmicDepthBuffer&&o.enable(3),y.skinning&&o.enable(4),y.morphTargets&&o.enable(5),y.morphNormals&&o.enable(6),y.morphColors&&o.enable(7),y.premultipliedAlpha&&o.enable(8),y.shadowMapEnabled&&o.enable(9),y.useLegacyLights&&o.enable(10),y.doubleSided&&o.enable(11),y.flipSided&&o.enable(12),y.useDepthPacking&&o.enable(13),y.dithering&&o.enable(14),y.transmission&&o.enable(15),y.sheen&&o.enable(16),y.opaque&&o.enable(17),y.pointsUvs&&o.enable(18),y.decodeVideoTexture&&o.enable(19),y.alphaToCoverage&&o.enable(20),_.push(o.mask)}(v,m),v.push(i.outputColorSpace)),v.push(m.customProgramCacheKey),v.join()},getUniforms:function(m){const v=f[m.type];let _;if(v){const y=ki[v];_=ii.clone(y.uniforms)}else _=m.uniforms;return _},acquireProgram:function(m,v){let _;for(let y=0,x=h.length;y<x;y++){const b=h[y];if(b.cacheKey===v){_=b,++_.usedTimes;break}}return _===void 0&&(_=new Y2(i,v,m,a),h.push(_)),_},releaseProgram:function(m){if(--m.usedTimes==0){const v=h.indexOf(m);h[v]=h[h.length-1],h.pop(),m.destroy()}},releaseShaderCache:function(m){l.remove(m)},programs:h,dispose:function(){l.dispose()}}}function J2(){let i=new WeakMap;return{get:function(e){let t=i.get(e);return t===void 0&&(t={},i.set(e,t)),t},remove:function(e){i.delete(e)},update:function(e,t,r){i.get(e)[t]=r},dispose:function(){i=new WeakMap}}}function eT(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function $v(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function Jv(){const i=[];let e=0;const t=[],r=[],s=[];function a(n,o,l,c,h,u){let d=i[e];return d===void 0?(d={id:n.id,object:n,geometry:o,material:l,groupOrder:c,renderOrder:n.renderOrder,z:h,group:u},i[e]=d):(d.id=n.id,d.object=n,d.geometry=o,d.material=l,d.groupOrder=c,d.renderOrder=n.renderOrder,d.z=h,d.group=u),e++,d}return{opaque:t,transmissive:r,transparent:s,init:function(){e=0,t.length=0,r.length=0,s.length=0},push:function(n,o,l,c,h,u){const d=a(n,o,l,c,h,u);l.transmission>0?r.push(d):l.transparent===!0?s.push(d):t.push(d)},unshift:function(n,o,l,c,h,u){const d=a(n,o,l,c,h,u);l.transmission>0?r.unshift(d):l.transparent===!0?s.unshift(d):t.unshift(d)},finish:function(){for(let n=e,o=i.length;n<o;n++){const l=i[n];if(l.id===null)break;l.id=null,l.object=null,l.geometry=null,l.material=null,l.group=null}},sort:function(n,o){t.length>1&&t.sort(n||eT),r.length>1&&r.sort(o||$v),s.length>1&&s.sort(o||$v)}}}function tT(){let i=new WeakMap;return{get:function(e,t){const r=i.get(e);let s;return r===void 0?(s=new Jv,i.set(e,[s])):t>=r.length?(s=new Jv,r.push(s)):s=r[t],s},dispose:function(){i=new WeakMap}}}function iT(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new C,color:new ve};break;case"SpotLight":t={position:new C,direction:new C,color:new ve,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new C,color:new ve,distance:0,decay:0};break;case"HemisphereLight":t={direction:new C,skyColor:new ve,groundColor:new ve};break;case"RectAreaLight":t={color:new ve,position:new C,halfWidth:new C,halfHeight:new C}}return i[e.id]=t,t}}}let rT=0;function sT(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function aT(i){const e=new iT,t=function(){const o={};return{get:function(l){if(o[l.id]!==void 0)return o[l.id];let c;switch(l.type){case"DirectionalLight":case"SpotLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new se};break;case"PointLight":c={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new se,shadowCameraNear:1,shadowCameraFar:1e3}}return o[l.id]=c,c}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let o=0;o<9;o++)r.probe.push(new C);const s=new C,a=new Me,n=new Me;return{setup:function(o,l){let c=0,h=0,u=0;for(let L=0;L<9;L++)r.probe[L].set(0,0,0);let d=0,p=0,f=0,g=0,m=0,v=0,_=0,y=0,x=0,b=0,M=0;o.sort(sT);const T=l===!0?Math.PI:1;for(let L=0,U=o.length;L<U;L++){const P=o[L],E=P.color,I=P.intensity,S=P.distance,V=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)c+=E.r*I*T,h+=E.g*I*T,u+=E.b*I*T;else if(P.isLightProbe){for(let J=0;J<9;J++)r.probe[J].addScaledVector(P.sh.coefficients[J],I);M++}else if(P.isDirectionalLight){const J=e.get(P);if(J.color.copy(P.color).multiplyScalar(P.intensity*T),P.castShadow){const X=P.shadow,te=t.get(P);te.shadowBias=X.bias,te.shadowNormalBias=X.normalBias,te.shadowRadius=X.radius,te.shadowMapSize=X.mapSize,r.directionalShadow[d]=te,r.directionalShadowMap[d]=V,r.directionalShadowMatrix[d]=P.shadow.matrix,v++}r.directional[d]=J,d++}else if(P.isSpotLight){const J=e.get(P);J.position.setFromMatrixPosition(P.matrixWorld),J.color.copy(E).multiplyScalar(I*T),J.distance=S,J.coneCos=Math.cos(P.angle),J.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),J.decay=P.decay,r.spot[f]=J;const X=P.shadow;if(P.map&&(r.spotLightMap[x]=P.map,x++,X.updateMatrices(P),P.castShadow&&b++),r.spotLightMatrix[f]=X.matrix,P.castShadow){const te=t.get(P);te.shadowBias=X.bias,te.shadowNormalBias=X.normalBias,te.shadowRadius=X.radius,te.shadowMapSize=X.mapSize,r.spotShadow[f]=te,r.spotShadowMap[f]=V,y++}f++}else if(P.isRectAreaLight){const J=e.get(P);J.color.copy(E).multiplyScalar(I),J.halfWidth.set(.5*P.width,0,0),J.halfHeight.set(0,.5*P.height,0),r.rectArea[g]=J,g++}else if(P.isPointLight){const J=e.get(P);if(J.color.copy(P.color).multiplyScalar(P.intensity*T),J.distance=P.distance,J.decay=P.decay,P.castShadow){const X=P.shadow,te=t.get(P);te.shadowBias=X.bias,te.shadowNormalBias=X.normalBias,te.shadowRadius=X.radius,te.shadowMapSize=X.mapSize,te.shadowCameraNear=X.camera.near,te.shadowCameraFar=X.camera.far,r.pointShadow[p]=te,r.pointShadowMap[p]=V,r.pointShadowMatrix[p]=P.shadow.matrix,_++}r.point[p]=J,p++}else if(P.isHemisphereLight){const J=e.get(P);J.skyColor.copy(P.color).multiplyScalar(I*T),J.groundColor.copy(P.groundColor).multiplyScalar(I*T),r.hemi[m]=J,m++}}g>0&&(i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Te.LTC_FLOAT_1,r.rectAreaLTC2=Te.LTC_FLOAT_2):(r.rectAreaLTC1=Te.LTC_HALF_1,r.rectAreaLTC2=Te.LTC_HALF_2)),r.ambient[0]=c,r.ambient[1]=h,r.ambient[2]=u;const A=r.hash;A.directionalLength===d&&A.pointLength===p&&A.spotLength===f&&A.rectAreaLength===g&&A.hemiLength===m&&A.numDirectionalShadows===v&&A.numPointShadows===_&&A.numSpotShadows===y&&A.numSpotMaps===x&&A.numLightProbes===M||(r.directional.length=d,r.spot.length=f,r.rectArea.length=g,r.point.length=p,r.hemi.length=m,r.directionalShadow.length=v,r.directionalShadowMap.length=v,r.pointShadow.length=_,r.pointShadowMap.length=_,r.spotShadow.length=y,r.spotShadowMap.length=y,r.directionalShadowMatrix.length=v,r.pointShadowMatrix.length=_,r.spotLightMatrix.length=y+x-b,r.spotLightMap.length=x,r.numSpotLightShadowsWithMaps=b,r.numLightProbes=M,A.directionalLength=d,A.pointLength=p,A.spotLength=f,A.rectAreaLength=g,A.hemiLength=m,A.numDirectionalShadows=v,A.numPointShadows=_,A.numSpotShadows=y,A.numSpotMaps=x,A.numLightProbes=M,r.version=rT++)},setupView:function(o,l){let c=0,h=0,u=0,d=0,p=0;const f=l.matrixWorldInverse;for(let g=0,m=o.length;g<m;g++){const v=o[g];if(v.isDirectionalLight){const _=r.directional[c];_.direction.setFromMatrixPosition(v.matrixWorld),s.setFromMatrixPosition(v.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(f),c++}else if(v.isSpotLight){const _=r.spot[u];_.position.setFromMatrixPosition(v.matrixWorld),_.position.applyMatrix4(f),_.direction.setFromMatrixPosition(v.matrixWorld),s.setFromMatrixPosition(v.target.matrixWorld),_.direction.sub(s),_.direction.transformDirection(f),u++}else if(v.isRectAreaLight){const _=r.rectArea[d];_.position.setFromMatrixPosition(v.matrixWorld),_.position.applyMatrix4(f),n.identity(),a.copy(v.matrixWorld),a.premultiply(f),n.extractRotation(a),_.halfWidth.set(.5*v.width,0,0),_.halfHeight.set(0,.5*v.height,0),_.halfWidth.applyMatrix4(n),_.halfHeight.applyMatrix4(n),d++}else if(v.isPointLight){const _=r.point[h];_.position.setFromMatrixPosition(v.matrixWorld),_.position.applyMatrix4(f),h++}else if(v.isHemisphereLight){const _=r.hemi[p];_.direction.setFromMatrixPosition(v.matrixWorld),_.direction.transformDirection(f),p++}}},state:r}}function e_(i){const e=new aT(i),t=[],r=[],s={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(a){s.camera=a,t.length=0,r.length=0},state:s,setupLights:function(a){e.setup(t,a)},setupLightsView:function(a){e.setupView(t,a)},pushLight:function(a){t.push(a)},pushShadow:function(a){r.push(a)}}}function nT(i){let e=new WeakMap;return{get:function(t,r=0){const s=e.get(t);let a;return s===void 0?(a=new e_(i),e.set(t,[a])):r>=s.length?(a=new e_(i),s.push(a)):a=s[r],a},dispose:function(){e=new WeakMap}}}class op extends $t{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class e0 extends $t{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function oT(i,e,t){let r=new oh;const s=new se,a=new se,n=new qe,o=new op({depthPacking:Qg}),l=new e0,c={},h=t.maxTextureSize,u={[Er]:Ri,[Ri]:Er,[Rt]:Rt},d=new at({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new se},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new Ie;f.setAttribute("position",new Ke(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new ye(f,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Gd;let v=this.type;function _(M,T){const A=e.update(g);d.defines.VSM_SAMPLES!==M.blurSamples&&(d.defines.VSM_SAMPLES=M.blurSamples,p.defines.VSM_SAMPLES=M.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),M.mapPass===null&&(M.mapPass=new pt(s.x,s.y)),d.uniforms.shadow_pass.value=M.map.texture,d.uniforms.resolution.value=M.mapSize,d.uniforms.radius.value=M.radius,i.setRenderTarget(M.mapPass),i.clear(),i.renderBufferDirect(T,null,A,d,g,null),p.uniforms.shadow_pass.value=M.mapPass.texture,p.uniforms.resolution.value=M.mapSize,p.uniforms.radius.value=M.radius,i.setRenderTarget(M.map),i.clear(),i.renderBufferDirect(T,null,A,p,g,null)}function y(M,T,A,L){let U=null;const P=A.isPointLight===!0?M.customDistanceMaterial:M.customDepthMaterial;if(P!==void 0)U=P;else if(U=A.isPointLight===!0?l:o,i.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){const E=U.uuid,I=T.uuid;let S=c[E];S===void 0&&(S={},c[E]=S);let V=S[I];V===void 0&&(V=U.clone(),S[I]=V,T.addEventListener("dispose",b)),U=V}return U.visible=T.visible,U.wireframe=T.wireframe,U.side=L===kr?T.shadowSide!==null?T.shadowSide:T.side:T.shadowSide!==null?T.shadowSide:u[T.side],U.alphaMap=T.alphaMap,U.alphaTest=T.alphaTest,U.map=T.map,U.clipShadows=T.clipShadows,U.clippingPlanes=T.clippingPlanes,U.clipIntersection=T.clipIntersection,U.displacementMap=T.displacementMap,U.displacementScale=T.displacementScale,U.displacementBias=T.displacementBias,U.wireframeLinewidth=T.wireframeLinewidth,U.linewidth=T.linewidth,A.isPointLight===!0&&U.isMeshDistanceMaterial===!0&&(i.properties.get(U).light=A),U}function x(M,T,A,L,U){if(M.visible===!1)return;if(M.layers.test(T.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&U===kr)&&(!M.frustumCulled||r.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(A.matrixWorldInverse,M.matrixWorld);const E=e.update(M),I=M.material;if(Array.isArray(I)){const S=E.groups;for(let V=0,J=S.length;V<J;V++){const X=S[V],te=I[X.materialIndex];if(te&&te.visible){const ie=y(M,te,L,U);M.onBeforeShadow(i,M,T,A,E,ie,X),i.renderBufferDirect(A,null,E,ie,M,X),M.onAfterShadow(i,M,T,A,E,ie,X)}}}else if(I.visible){const S=y(M,I,L,U);M.onBeforeShadow(i,M,T,A,E,S,null),i.renderBufferDirect(A,null,E,S,M,null),M.onAfterShadow(i,M,T,A,E,S,null)}}const P=M.children;for(let E=0,I=P.length;E<I;E++)x(P[E],T,A,L,U)}function b(M){M.target.removeEventListener("dispose",b);for(const T in c){const A=c[T],L=M.target.uuid;L in A&&(A[L].dispose(),delete A[L])}}this.render=function(M,T,A){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||M.length===0)return;const L=i.getRenderTarget(),U=i.getActiveCubeFace(),P=i.getActiveMipmapLevel(),E=i.state;E.setBlending(0),E.buffers.color.setClear(1,1,1,1),E.buffers.depth.setTest(!0),E.setScissorTest(!1);const I=v!==kr&&this.type===kr,S=v===kr&&this.type!==kr;for(let V=0,J=M.length;V<J;V++){const X=M[V],te=X.shadow;if(te===void 0||te.autoUpdate===!1&&te.needsUpdate===!1)continue;s.copy(te.mapSize);const ie=te.getFrameExtents();if(s.multiply(ie),a.copy(te.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(a.x=Math.floor(h/ie.x),s.x=a.x*ie.x,te.mapSize.x=a.x),s.y>h&&(a.y=Math.floor(h/ie.y),s.y=a.y*ie.y,te.mapSize.y=a.y)),te.map===null||I===!0||S===!0){const B=this.type!==kr?{minFilter:lt,magFilter:lt}:{};te.map!==null&&te.map.dispose(),te.map=new pt(s.x,s.y,B),te.map.texture.name=X.name+".shadowMap",te.camera.updateProjectionMatrix()}i.setRenderTarget(te.map),i.clear();const fe=te.getViewportCount();for(let B=0;B<fe;B++){const j=te.getViewport(B);n.set(a.x*j.x,a.y*j.y,a.x*j.z,a.y*j.w),E.viewport(n),te.updateMatrices(X,B),r=te.getFrustum(),x(T,A,te.camera,X,this.type)}te.isPointLightShadow!==!0&&this.type===kr&&_(te,A),te.needsUpdate=!1}v=this.type,m.needsUpdate=!1,i.setRenderTarget(L,U,P)}}function lT(i){const e=new function(){let k=!1;const Q=new qe;let re=null;const w=new qe(0,0,0,0);return{setMask:function(G){re===G||k||(i.colorMask(G,G,G,G),re=G)},setLocked:function(G){k=G},setClear:function(G,Z,F,R,N){N===!0&&(G*=R,Z*=R,F*=R),Q.set(G,Z,F,R),w.equals(Q)===!1&&(i.clearColor(G,Z,F,R),w.copy(Q))},reset:function(){k=!1,re=null,w.set(-1,0,0,0)}}},t=new function(){let k=!1,Q=null,re=null,w=null;return{setTest:function(G){G?ae(i.DEPTH_TEST):O(i.DEPTH_TEST)},setMask:function(G){Q===G||k||(i.depthMask(G),Q=G)},setFunc:function(G){if(re!==G){switch(G){case 0:i.depthFunc(i.NEVER);break;case 1:i.depthFunc(i.ALWAYS);break;case 2:i.depthFunc(i.LESS);break;case 3:default:i.depthFunc(i.LEQUAL);break;case 4:i.depthFunc(i.EQUAL);break;case 5:i.depthFunc(i.GEQUAL);break;case 6:i.depthFunc(i.GREATER);break;case 7:i.depthFunc(i.NOTEQUAL)}re=G}},setLocked:function(G){k=G},setClear:function(G){w!==G&&(i.clearDepth(G),w=G)},reset:function(){k=!1,Q=null,re=null,w=null}}},r=new function(){let k=!1,Q=null,re=null,w=null,G=null,Z=null,F=null,R=null,N=null;return{setTest:function(z){k||(z?ae(i.STENCIL_TEST):O(i.STENCIL_TEST))},setMask:function(z){Q===z||k||(i.stencilMask(z),Q=z)},setFunc:function(z,Y,q){re===z&&w===Y&&G===q||(i.stencilFunc(z,Y,q),re=z,w=Y,G=q)},setOp:function(z,Y,q){Z===z&&F===Y&&R===q||(i.stencilOp(z,Y,q),Z=z,F=Y,R=q)},setLocked:function(z){k=z},setClear:function(z){N!==z&&(i.clearStencil(z),N=z)},reset:function(){k=!1,Q=null,re=null,w=null,G=null,Z=null,F=null,R=null,N=null}}},s=new WeakMap,a=new WeakMap;let n={},o={},l=new WeakMap,c=[],h=null,u=!1,d=null,p=null,f=null,g=null,m=null,v=null,_=null,y=new ve(0,0,0),x=0,b=!1,M=null,T=null,A=null,L=null,U=null;const P=i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let E=!1,I=0;const S=i.getParameter(i.VERSION);S.indexOf("WebGL")!==-1?(I=parseFloat(/^WebGL (\d)/.exec(S)[1]),E=I>=1):S.indexOf("OpenGL ES")!==-1&&(I=parseFloat(/^OpenGL ES (\d)/.exec(S)[1]),E=I>=2);let V=null,J={};const X=i.getParameter(i.SCISSOR_BOX),te=i.getParameter(i.VIEWPORT),ie=new qe().fromArray(X),fe=new qe().fromArray(te);function B(k,Q,re,w){const G=new Uint8Array(4),Z=i.createTexture();i.bindTexture(k,Z),i.texParameteri(k,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(k,i.TEXTURE_MAG_FILTER,i.NEAREST);for(let F=0;F<re;F++)k===i.TEXTURE_3D||k===i.TEXTURE_2D_ARRAY?i.texImage3D(Q,0,i.RGBA,1,1,w,0,i.RGBA,i.UNSIGNED_BYTE,G):i.texImage2D(Q+F,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,G);return Z}const j={};function ae(k){n[k]!==!0&&(i.enable(k),n[k]=!0)}function O(k){n[k]!==!1&&(i.disable(k),n[k]=!1)}j[i.TEXTURE_2D]=B(i.TEXTURE_2D,i.TEXTURE_2D,1),j[i.TEXTURE_CUBE_MAP]=B(i.TEXTURE_CUBE_MAP,i.TEXTURE_CUBE_MAP_POSITIVE_X,6),j[i.TEXTURE_2D_ARRAY]=B(i.TEXTURE_2D_ARRAY,i.TEXTURE_2D_ARRAY,1,1),j[i.TEXTURE_3D]=B(i.TEXTURE_3D,i.TEXTURE_3D,1,1),e.setClear(0,0,0,1),t.setClear(1),r.setClear(0),ae(i.DEPTH_TEST),t.setFunc(3),K(!1),W(1),ae(i.CULL_FACE),ne(0);const D={[ar]:i.FUNC_ADD,[sS]:i.FUNC_SUBTRACT,[aS]:i.FUNC_REVERSE_SUBTRACT};D[103]=i.MIN,D[104]=i.MAX;const ee={[Jo]:i.ZERO,[ih]:i.ONE,[jd]:i.SRC_COLOR,[Ra]:i.SRC_ALPHA,[nS]:i.SRC_ALPHA_SATURATE,[sh]:i.DST_COLOR,[rh]:i.DST_ALPHA,[Wd]:i.ONE_MINUS_SRC_COLOR,[Ia]:i.ONE_MINUS_SRC_ALPHA,[qd]:i.ONE_MINUS_DST_COLOR,[Xd]:i.ONE_MINUS_DST_ALPHA,[oS]:i.CONSTANT_COLOR,[lS]:i.ONE_MINUS_CONSTANT_COLOR,[cS]:i.CONSTANT_ALPHA,[hS]:i.ONE_MINUS_CONSTANT_ALPHA};function ne(k,Q,re,w,G,Z,F,R,N,z){if(k!==0){if(u===!1&&(ae(i.BLEND),u=!0),k===$o)G=G||Q,Z=Z||re,F=F||w,Q===p&&G===m||(i.blendEquationSeparate(D[Q],D[G]),p=Q,m=G),re===f&&w===g&&Z===v&&F===_||(i.blendFuncSeparate(ee[re],ee[w],ee[Z],ee[F]),f=re,g=w,v=Z,_=F),R.equals(y)!==!1&&N===x||(i.blendColor(R.r,R.g,R.b,N),y.copy(R),x=N),d=k,b=!1;else if(k!==d||z!==b){if(p===ar&&m===ar||(i.blendEquation(i.FUNC_ADD),p=ar,m=ar),z)switch(k){case 1:i.blendFuncSeparate(i.ONE,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case Vs:i.blendFunc(i.ONE,i.ONE);break;case 3:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case 4:i.blendFuncSeparate(i.ZERO,i.SRC_COLOR,i.ZERO,i.SRC_ALPHA)}else switch(k){case 1:i.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA);break;case Vs:i.blendFunc(i.SRC_ALPHA,i.ONE);break;case 3:i.blendFuncSeparate(i.ZERO,i.ONE_MINUS_SRC_COLOR,i.ZERO,i.ONE);break;case 4:i.blendFunc(i.ZERO,i.SRC_COLOR)}f=null,g=null,v=null,_=null,y.set(0,0,0),x=0,d=k,b=z}}else u===!0&&(O(i.BLEND),u=!1)}function K(k){M!==k&&(k?i.frontFace(i.CW):i.frontFace(i.CCW),M=k)}function W(k){k!==0?(ae(i.CULL_FACE),k!==T&&(k===1?i.cullFace(i.BACK):k===2?i.cullFace(i.FRONT):i.cullFace(i.FRONT_AND_BACK))):O(i.CULL_FACE),T=k}function $(k,Q,re){k?(ae(i.POLYGON_OFFSET_FILL),L===Q&&U===re||(i.polygonOffset(Q,re),L=Q,U=re)):O(i.POLYGON_OFFSET_FILL)}return{buffers:{color:e,depth:t,stencil:r},enable:ae,disable:O,bindFramebuffer:function(k,Q){return o[k]!==Q&&(i.bindFramebuffer(k,Q),o[k]=Q,k===i.DRAW_FRAMEBUFFER&&(o[i.FRAMEBUFFER]=Q),k===i.FRAMEBUFFER&&(o[i.DRAW_FRAMEBUFFER]=Q),!0)},drawBuffers:function(k,Q){let re=c,w=!1;if(k){re=l.get(Q),re===void 0&&(re=[],l.set(Q,re));const G=k.textures;if(re.length!==G.length||re[0]!==i.COLOR_ATTACHMENT0){for(let Z=0,F=G.length;Z<F;Z++)re[Z]=i.COLOR_ATTACHMENT0+Z;re.length=G.length,w=!0}}else re[0]!==i.BACK&&(re[0]=i.BACK,w=!0);w&&i.drawBuffers(re)},useProgram:function(k){return h!==k&&(i.useProgram(k),h=k,!0)},setBlending:ne,setMaterial:function(k,Q){k.side===Rt?O(i.CULL_FACE):ae(i.CULL_FACE);let re=k.side===Ri;Q&&(re=!re),K(re),k.blending===1&&k.transparent===!1?ne(0):ne(k.blending,k.blendEquation,k.blendSrc,k.blendDst,k.blendEquationAlpha,k.blendSrcAlpha,k.blendDstAlpha,k.blendColor,k.blendAlpha,k.premultipliedAlpha),t.setFunc(k.depthFunc),t.setTest(k.depthTest),t.setMask(k.depthWrite),e.setMask(k.colorWrite);const w=k.stencilWrite;r.setTest(w),w&&(r.setMask(k.stencilWriteMask),r.setFunc(k.stencilFunc,k.stencilRef,k.stencilFuncMask),r.setOp(k.stencilFail,k.stencilZFail,k.stencilZPass)),$(k.polygonOffset,k.polygonOffsetFactor,k.polygonOffsetUnits),k.alphaToCoverage===!0?ae(i.SAMPLE_ALPHA_TO_COVERAGE):O(i.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:K,setCullFace:W,setLineWidth:function(k){k!==A&&(E&&i.lineWidth(k),A=k)},setPolygonOffset:$,setScissorTest:function(k){k?ae(i.SCISSOR_TEST):O(i.SCISSOR_TEST)},activeTexture:function(k){k===void 0&&(k=i.TEXTURE0+P-1),V!==k&&(i.activeTexture(k),V=k)},bindTexture:function(k,Q,re){re===void 0&&(re=V===null?i.TEXTURE0+P-1:V);let w=J[re];w===void 0&&(w={type:void 0,texture:void 0},J[re]=w),w.type===k&&w.texture===Q||(V!==re&&(i.activeTexture(re),V=re),i.bindTexture(k,Q||j[k]),w.type=k,w.texture=Q)},unbindTexture:function(){const k=J[V];k!==void 0&&k.type!==void 0&&(i.bindTexture(k.type,null),k.type=void 0,k.texture=void 0)},compressedTexImage2D:function(){try{i.compressedTexImage2D.apply(i,arguments)}catch{}},compressedTexImage3D:function(){try{i.compressedTexImage3D.apply(i,arguments)}catch{}},texImage2D:function(){try{i.texImage2D.apply(i,arguments)}catch{}},texImage3D:function(){try{i.texImage3D.apply(i,arguments)}catch{}},updateUBOMapping:function(k,Q){let re=a.get(Q);re===void 0&&(re=new WeakMap,a.set(Q,re));let w=re.get(k);w===void 0&&(w=i.getUniformBlockIndex(Q,k.name),re.set(k,w))},uniformBlockBinding:function(k,Q){const re=a.get(Q).get(k);s.get(Q)!==re&&(i.uniformBlockBinding(Q,re,k.__bindingPointIndex),s.set(Q,re))},texStorage2D:function(){try{i.texStorage2D.apply(i,arguments)}catch{}},texStorage3D:function(){try{i.texStorage3D.apply(i,arguments)}catch{}},texSubImage2D:function(){try{i.texSubImage2D.apply(i,arguments)}catch{}},texSubImage3D:function(){try{i.texSubImage3D.apply(i,arguments)}catch{}},compressedTexSubImage2D:function(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch{}},compressedTexSubImage3D:function(){try{i.compressedTexSubImage3D.apply(i,arguments)}catch{}},scissor:function(k){ie.equals(k)===!1&&(i.scissor(k.x,k.y,k.z,k.w),ie.copy(k))},viewport:function(k){fe.equals(k)===!1&&(i.viewport(k.x,k.y,k.z,k.w),fe.copy(k))},reset:function(){i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.POLYGON_OFFSET_FILL),i.disable(i.SCISSOR_TEST),i.disable(i.STENCIL_TEST),i.disable(i.SAMPLE_ALPHA_TO_COVERAGE),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.blendFuncSeparate(i.ONE,i.ZERO,i.ONE,i.ZERO),i.blendColor(0,0,0,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(i.LESS),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.clearStencil(0),i.cullFace(i.BACK),i.frontFace(i.CCW),i.polygonOffset(0,0),i.activeTexture(i.TEXTURE0),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),n={},V=null,J={},o={},l=new WeakMap,c=[],h=null,u=!1,d=null,p=null,f=null,g=null,m=null,v=null,_=null,y=new ve(0,0,0),x=0,b=!1,M=null,T=null,A=null,L=null,U=null,ie.set(0,0,i.canvas.width,i.canvas.height),fe.set(0,0,i.canvas.width,i.canvas.height),e.reset(),t.reset(),r.reset()}}}function cT(i,e,t,r,s,a,n){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),c=new se,h=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(O,D){return p?new OffscreenCanvas(O,D):Rc("canvas")}function g(O,D,ee){let ne=1;const K=ae(O);if((K.width>ee||K.height>ee)&&(ne=ee/Math.max(K.width,K.height)),ne<1){if(typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&O instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&O instanceof ImageBitmap||typeof VideoFrame<"u"&&O instanceof VideoFrame){const W=Math.floor(ne*K.width),$=Math.floor(ne*K.height);u===void 0&&(u=f(W,$));const k=D?f(W,$):u;return k.width=W,k.height=$,k.getContext("2d").drawImage(O,0,0,W,$),k}return O}return O}function m(O){return O.generateMipmaps&&O.minFilter!==lt&&O.minFilter!==qt}function v(O){i.generateMipmap(O)}function _(O,D,ee,ne,K=!1){if(O!==null&&i[O]!==void 0)return i[O];let W=D;if(D===i.RED&&(ee===i.FLOAT&&(W=i.R32F),ee===i.HALF_FLOAT&&(W=i.R16F),ee===i.UNSIGNED_BYTE&&(W=i.R8)),D===i.RED_INTEGER&&(ee===i.UNSIGNED_BYTE&&(W=i.R8UI),ee===i.UNSIGNED_SHORT&&(W=i.R16UI),ee===i.UNSIGNED_INT&&(W=i.R32UI),ee===i.BYTE&&(W=i.R8I),ee===i.SHORT&&(W=i.R16I),ee===i.INT&&(W=i.R32I)),D===i.RG&&(ee===i.FLOAT&&(W=i.RG32F),ee===i.HALF_FLOAT&&(W=i.RG16F),ee===i.UNSIGNED_BYTE&&(W=i.RG8)),D===i.RG_INTEGER&&(ee===i.UNSIGNED_BYTE&&(W=i.RG8UI),ee===i.UNSIGNED_SHORT&&(W=i.RG16UI),ee===i.UNSIGNED_INT&&(W=i.RG32UI),ee===i.BYTE&&(W=i.RG8I),ee===i.SHORT&&(W=i.RG16I),ee===i.INT&&(W=i.RG32I)),D===i.RGB&&ee===i.UNSIGNED_INT_5_9_9_9_REV&&(W=i.RGB9_E5),D===i.RGBA){const $=K?Tc:ct.getTransfer(ne);ee===i.FLOAT&&(W=i.RGBA32F),ee===i.HALF_FLOAT&&(W=i.RGBA16F),ee===i.UNSIGNED_BYTE&&(W=$===bt?i.SRGB8_ALPHA8:i.RGBA8),ee===i.UNSIGNED_SHORT_4_4_4_4&&(W=i.RGBA4),ee===i.UNSIGNED_SHORT_5_5_5_1&&(W=i.RGB5_A1)}return W!==i.R16F&&W!==i.R32F&&W!==i.RG16F&&W!==i.RG32F&&W!==i.RGBA16F&&W!==i.RGBA32F||e.get("EXT_color_buffer_float"),W}function y(O,D){return m(O)===!0||O.isFramebufferTexture&&O.minFilter!==lt&&O.minFilter!==qt?Math.log2(Math.max(D.width,D.height))+1:O.mipmaps!==void 0&&O.mipmaps.length>0?O.mipmaps.length:O.isCompressedTexture&&Array.isArray(O.image)?D.mipmaps.length:1}function x(O){const D=O.target;D.removeEventListener("dispose",x),function(ee){const ne=r.get(ee);if(ne.__webglInit===void 0)return;const K=ee.source,W=d.get(K);if(W){const $=W[ne.__cacheKey];$.usedTimes--,$.usedTimes===0&&M(ee),Object.keys(W).length===0&&d.delete(K)}r.remove(ee)}(D),D.isVideoTexture&&h.delete(D)}function b(O){const D=O.target;D.removeEventListener("dispose",b),function(ee){const ne=r.get(ee);if(ee.depthTexture&&ee.depthTexture.dispose(),ee.isWebGLCubeRenderTarget)for(let W=0;W<6;W++){if(Array.isArray(ne.__webglFramebuffer[W]))for(let $=0;$<ne.__webglFramebuffer[W].length;$++)i.deleteFramebuffer(ne.__webglFramebuffer[W][$]);else i.deleteFramebuffer(ne.__webglFramebuffer[W]);ne.__webglDepthbuffer&&i.deleteRenderbuffer(ne.__webglDepthbuffer[W])}else{if(Array.isArray(ne.__webglFramebuffer))for(let W=0;W<ne.__webglFramebuffer.length;W++)i.deleteFramebuffer(ne.__webglFramebuffer[W]);else i.deleteFramebuffer(ne.__webglFramebuffer);if(ne.__webglDepthbuffer&&i.deleteRenderbuffer(ne.__webglDepthbuffer),ne.__webglMultisampledFramebuffer&&i.deleteFramebuffer(ne.__webglMultisampledFramebuffer),ne.__webglColorRenderbuffer)for(let W=0;W<ne.__webglColorRenderbuffer.length;W++)ne.__webglColorRenderbuffer[W]&&i.deleteRenderbuffer(ne.__webglColorRenderbuffer[W]);ne.__webglDepthRenderbuffer&&i.deleteRenderbuffer(ne.__webglDepthRenderbuffer)}const K=ee.textures;for(let W=0,$=K.length;W<$;W++){const k=r.get(K[W]);k.__webglTexture&&(i.deleteTexture(k.__webglTexture),n.memory.textures--),r.remove(K[W])}r.remove(ee)}(D)}function M(O){const D=r.get(O);i.deleteTexture(D.__webglTexture);const ee=O.source;delete d.get(ee)[D.__cacheKey],n.memory.textures--}let T=0;function A(O,D){const ee=r.get(O);if(O.isVideoTexture&&function(ne){const K=n.render.frame;h.get(ne)!==K&&(h.set(ne,K),ne.update())}(O),O.isRenderTargetTexture===!1&&O.version>0&&ee.__version!==O.version){const ne=O.image;if(ne!==null&&ne.complete!==!1)return void S(ee,O,D)}t.bindTexture(i.TEXTURE_2D,ee.__webglTexture,i.TEXTURE0+D)}const L={[Kt]:i.REPEAT,[bi]:i.CLAMP_TO_EDGE,[Da]:i.MIRRORED_REPEAT},U={[lt]:i.NEAREST,[ep]:i.NEAREST_MIPMAP_NEAREST,[Mn]:i.NEAREST_MIPMAP_LINEAR,[qt]:i.LINEAR,[Vo]:i.LINEAR_MIPMAP_NEAREST,[hs]:i.LINEAR_MIPMAP_LINEAR},P={[uS]:i.NEVER,[_S]:i.ALWAYS,[dS]:i.LESS,[mS]:i.LEQUAL,[pS]:i.EQUAL,[vS]:i.GEQUAL,[fS]:i.GREATER,[gS]:i.NOTEQUAL};function E(O,D){if(D.type===wr&&e.has("OES_texture_float_linear")===!1&&(D.magFilter===qt||D.magFilter===Vo||D.magFilter===Mn||D.magFilter===hs||D.minFilter===qt||D.minFilter===Vo||D.minFilter===Mn||D.minFilter),i.texParameteri(O,i.TEXTURE_WRAP_S,L[D.wrapS]),i.texParameteri(O,i.TEXTURE_WRAP_T,L[D.wrapT]),O!==i.TEXTURE_3D&&O!==i.TEXTURE_2D_ARRAY||i.texParameteri(O,i.TEXTURE_WRAP_R,L[D.wrapR]),i.texParameteri(O,i.TEXTURE_MAG_FILTER,U[D.magFilter]),i.texParameteri(O,i.TEXTURE_MIN_FILTER,U[D.minFilter]),D.compareFunction&&(i.texParameteri(O,i.TEXTURE_COMPARE_MODE,i.COMPARE_REF_TO_TEXTURE),i.texParameteri(O,i.TEXTURE_COMPARE_FUNC,P[D.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(D.magFilter===lt||D.minFilter!==Mn&&D.minFilter!==hs||D.type===wr&&e.has("OES_texture_float_linear")===!1)return;if(D.anisotropy>1||r.get(D).__currentAnisotropy){const ee=e.get("EXT_texture_filter_anisotropic");i.texParameterf(O,ee.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(D.anisotropy,s.getMaxAnisotropy())),r.get(D).__currentAnisotropy=D.anisotropy}}}function I(O,D){let ee=!1;O.__webglInit===void 0&&(O.__webglInit=!0,D.addEventListener("dispose",x));const ne=D.source;let K=d.get(ne);K===void 0&&(K={},d.set(ne,K));const W=function($){const k=[];return k.push($.wrapS),k.push($.wrapT),k.push($.wrapR||0),k.push($.magFilter),k.push($.minFilter),k.push($.anisotropy),k.push($.internalFormat),k.push($.format),k.push($.type),k.push($.generateMipmaps),k.push($.premultiplyAlpha),k.push($.flipY),k.push($.unpackAlignment),k.push($.colorSpace),k.join()}(D);if(W!==O.__cacheKey){K[W]===void 0&&(K[W]={texture:i.createTexture(),usedTimes:0},n.memory.textures++,ee=!0),K[W].usedTimes++;const $=K[O.__cacheKey];$!==void 0&&(K[O.__cacheKey].usedTimes--,$.usedTimes===0&&M(D)),O.__cacheKey=W,O.__webglTexture=K[W].texture}return ee}function S(O,D,ee){let ne=i.TEXTURE_2D;(D.isDataArrayTexture||D.isCompressedArrayTexture)&&(ne=i.TEXTURE_2D_ARRAY),D.isData3DTexture&&(ne=i.TEXTURE_3D);const K=I(O,D),W=D.source;t.bindTexture(ne,O.__webglTexture,i.TEXTURE0+ee);const $=r.get(W);if(W.version!==$.__version||K===!0){t.activeTexture(i.TEXTURE0+ee);const k=ct.getPrimaries(ct.workingColorSpace),Q=D.colorSpace===vn?null:ct.getPrimaries(D.colorSpace),re=D.colorSpace===vn||k===Q?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,D.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,D.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,re);let w=g(D.image,!1,s.maxTextureSize);w=j(D,w);const G=a.convert(D.format,D.colorSpace),Z=a.convert(D.type);let F,R=_(D.internalFormat,G,Z,D.colorSpace,D.isVideoTexture);E(ne,D);const N=D.mipmaps,z=D.isVideoTexture!==!0,Y=$.__version===void 0||K===!0,q=W.dataReady,he=y(D,w);if(D.isDepthTexture)R=i.DEPTH_COMPONENT16,D.type===wr?R=i.DEPTH_COMPONENT32F:D.type===zn?R=i.DEPTH_COMPONENT24:D.type===Zn&&(R=i.DEPTH24_STENCIL8),Y&&(z?t.texStorage2D(i.TEXTURE_2D,1,R,w.width,w.height):t.texImage2D(i.TEXTURE_2D,0,R,w.width,w.height,0,G,Z,null));else if(D.isDataTexture)if(N.length>0){z&&Y&&t.texStorage2D(i.TEXTURE_2D,he,R,N[0].width,N[0].height);for(let de=0,ue=N.length;de<ue;de++)F=N[de],z?q&&t.texSubImage2D(i.TEXTURE_2D,de,0,0,F.width,F.height,G,Z,F.data):t.texImage2D(i.TEXTURE_2D,de,R,F.width,F.height,0,G,Z,F.data);D.generateMipmaps=!1}else z?(Y&&t.texStorage2D(i.TEXTURE_2D,he,R,w.width,w.height),q&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,w.width,w.height,G,Z,w.data)):t.texImage2D(i.TEXTURE_2D,0,R,w.width,w.height,0,G,Z,w.data);else if(D.isCompressedTexture)if(D.isCompressedArrayTexture){z&&Y&&t.texStorage3D(i.TEXTURE_2D_ARRAY,he,R,N[0].width,N[0].height,w.depth);for(let de=0,ue=N.length;de<ue;de++)F=N[de],D.format!==Hr?G!==null&&(z?q&&t.compressedTexSubImage3D(i.TEXTURE_2D_ARRAY,de,0,0,0,F.width,F.height,w.depth,G,F.data,0,0):t.compressedTexImage3D(i.TEXTURE_2D_ARRAY,de,R,F.width,F.height,w.depth,0,F.data,0,0)):z?q&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,de,0,0,0,F.width,F.height,w.depth,G,Z,F.data):t.texImage3D(i.TEXTURE_2D_ARRAY,de,R,F.width,F.height,w.depth,0,G,Z,F.data)}else{z&&Y&&t.texStorage2D(i.TEXTURE_2D,he,R,N[0].width,N[0].height);for(let de=0,ue=N.length;de<ue;de++)F=N[de],D.format!==Hr?G!==null&&(z?q&&t.compressedTexSubImage2D(i.TEXTURE_2D,de,0,0,F.width,F.height,G,F.data):t.compressedTexImage2D(i.TEXTURE_2D,de,R,F.width,F.height,0,F.data)):z?q&&t.texSubImage2D(i.TEXTURE_2D,de,0,0,F.width,F.height,G,Z,F.data):t.texImage2D(i.TEXTURE_2D,de,R,F.width,F.height,0,G,Z,F.data)}else if(D.isDataArrayTexture)z?(Y&&t.texStorage3D(i.TEXTURE_2D_ARRAY,he,R,w.width,w.height,w.depth),q&&t.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,0,w.width,w.height,w.depth,G,Z,w.data)):t.texImage3D(i.TEXTURE_2D_ARRAY,0,R,w.width,w.height,w.depth,0,G,Z,w.data);else if(D.isData3DTexture)z?(Y&&t.texStorage3D(i.TEXTURE_3D,he,R,w.width,w.height,w.depth),q&&t.texSubImage3D(i.TEXTURE_3D,0,0,0,0,w.width,w.height,w.depth,G,Z,w.data)):t.texImage3D(i.TEXTURE_3D,0,R,w.width,w.height,w.depth,0,G,Z,w.data);else if(D.isFramebufferTexture){if(Y)if(z)t.texStorage2D(i.TEXTURE_2D,he,R,w.width,w.height);else{let de=w.width,ue=w.height;for(let we=0;we<he;we++)t.texImage2D(i.TEXTURE_2D,we,R,de,ue,0,G,Z,null),de>>=1,ue>>=1}}else if(N.length>0){if(z&&Y){const de=ae(N[0]);t.texStorage2D(i.TEXTURE_2D,he,R,de.width,de.height)}for(let de=0,ue=N.length;de<ue;de++)F=N[de],z?q&&t.texSubImage2D(i.TEXTURE_2D,de,0,0,G,Z,F):t.texImage2D(i.TEXTURE_2D,de,R,G,Z,F);D.generateMipmaps=!1}else if(z){if(Y){const de=ae(w);t.texStorage2D(i.TEXTURE_2D,he,R,de.width,de.height)}q&&t.texSubImage2D(i.TEXTURE_2D,0,0,0,G,Z,w)}else t.texImage2D(i.TEXTURE_2D,0,R,G,Z,w);m(D)&&v(ne),$.__version=W.version,D.onUpdate&&D.onUpdate(D)}O.__version=D.version}function V(O,D,ee,ne,K,W){const $=a.convert(ee.format,ee.colorSpace),k=a.convert(ee.type),Q=_(ee.internalFormat,$,k,ee.colorSpace);if(!r.get(D).__hasExternalTextures){const re=Math.max(1,D.width>>W),w=Math.max(1,D.height>>W);K===i.TEXTURE_3D||K===i.TEXTURE_2D_ARRAY?t.texImage3D(K,W,Q,re,w,D.depth,0,$,k,null):t.texImage2D(K,W,Q,re,w,0,$,k,null)}t.bindFramebuffer(i.FRAMEBUFFER,O),B(D)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,ne,K,r.get(ee).__webglTexture,0,fe(D)):(K===i.TEXTURE_2D||K>=i.TEXTURE_CUBE_MAP_POSITIVE_X&&K<=i.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&i.framebufferTexture2D(i.FRAMEBUFFER,ne,K,r.get(ee).__webglTexture,W),t.bindFramebuffer(i.FRAMEBUFFER,null)}function J(O,D,ee){if(i.bindRenderbuffer(i.RENDERBUFFER,O),D.depthBuffer&&!D.stencilBuffer){let ne=i.DEPTH_COMPONENT24;if(ee||B(D)){const K=D.depthTexture;K&&K.isDepthTexture&&(K.type===wr?ne=i.DEPTH_COMPONENT32F:K.type===zn&&(ne=i.DEPTH_COMPONENT24));const W=fe(D);B(D)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,W,ne,D.width,D.height):i.renderbufferStorageMultisample(i.RENDERBUFFER,W,ne,D.width,D.height)}else i.renderbufferStorage(i.RENDERBUFFER,ne,D.width,D.height);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,O)}else if(D.depthBuffer&&D.stencilBuffer){const ne=fe(D);ee&&B(D)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,ne,i.DEPTH24_STENCIL8,D.width,D.height):B(D)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,ne,i.DEPTH24_STENCIL8,D.width,D.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,D.width,D.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,O)}else{const ne=D.textures;for(let K=0;K<ne.length;K++){const W=ne[K],$=a.convert(W.format,W.colorSpace),k=a.convert(W.type),Q=_(W.internalFormat,$,k,W.colorSpace),re=fe(D);ee&&B(D)===!1?i.renderbufferStorageMultisample(i.RENDERBUFFER,re,Q,D.width,D.height):B(D)?o.renderbufferStorageMultisampleEXT(i.RENDERBUFFER,re,Q,D.width,D.height):i.renderbufferStorage(i.RENDERBUFFER,Q,D.width,D.height)}}i.bindRenderbuffer(i.RENDERBUFFER,null)}function X(O){const D=r.get(O),ee=O.isWebGLCubeRenderTarget===!0;if(O.depthTexture&&!D.__autoAllocateDepthBuffer){if(ee)throw new Error("target.depthTexture not supported in Cube render targets");(function(ne,K){if(K&&K.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(i.FRAMEBUFFER,ne),!K.depthTexture||!K.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(K.depthTexture).__webglTexture&&K.depthTexture.image.width===K.width&&K.depthTexture.image.height===K.height||(K.depthTexture.image.width=K.width,K.depthTexture.image.height=K.height,K.depthTexture.needsUpdate=!0),A(K.depthTexture,0);const W=r.get(K.depthTexture).__webglTexture,$=fe(K);if(K.depthTexture.format===An)B(K)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,W,0,$):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,W,0);else{if(K.depthTexture.format!==Bn)throw new Error("Unknown depthTexture format");B(K)?o.framebufferTexture2DMultisampleEXT(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,W,0,$):i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,W,0)}})(D.__webglFramebuffer,O)}else if(ee){D.__webglDepthbuffer=[];for(let ne=0;ne<6;ne++)t.bindFramebuffer(i.FRAMEBUFFER,D.__webglFramebuffer[ne]),D.__webglDepthbuffer[ne]=i.createRenderbuffer(),J(D.__webglDepthbuffer[ne],O,!1)}else t.bindFramebuffer(i.FRAMEBUFFER,D.__webglFramebuffer),D.__webglDepthbuffer=i.createRenderbuffer(),J(D.__webglDepthbuffer,O,!1);t.bindFramebuffer(i.FRAMEBUFFER,null)}const te=[],ie=[];function fe(O){return Math.min(s.maxSamples,O.samples)}function B(O){const D=r.get(O);return O.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&D.__useRenderToTexture!==!1}function j(O,D){const ee=O.colorSpace;return O.format,O.type,O.isCompressedTexture===!0||O.isVideoTexture===!0||ee!==si&&ee!==vn&&ct.getTransfer(ee),D}function ae(O){return typeof HTMLImageElement<"u"&&O instanceof HTMLImageElement?(c.width=O.naturalWidth||O.width,c.height=O.naturalHeight||O.height):typeof VideoFrame<"u"&&O instanceof VideoFrame?(c.width=O.displayWidth,c.height=O.displayHeight):(c.width=O.width,c.height=O.height),c}this.allocateTextureUnit=function(){const O=T;return s.maxTextures,T+=1,O},this.resetTextureUnits=function(){T=0},this.setTexture2D=A,this.setTexture2DArray=function(O,D){const ee=r.get(O);O.version>0&&ee.__version!==O.version?S(ee,O,D):t.bindTexture(i.TEXTURE_2D_ARRAY,ee.__webglTexture,i.TEXTURE0+D)},this.setTexture3D=function(O,D){const ee=r.get(O);O.version>0&&ee.__version!==O.version?S(ee,O,D):t.bindTexture(i.TEXTURE_3D,ee.__webglTexture,i.TEXTURE0+D)},this.setTextureCube=function(O,D){const ee=r.get(O);O.version>0&&ee.__version!==O.version?function(ne,K,W){if(K.image.length!==6)return;const $=I(ne,K),k=K.source;t.bindTexture(i.TEXTURE_CUBE_MAP,ne.__webglTexture,i.TEXTURE0+W);const Q=r.get(k);if(k.version!==Q.__version||$===!0){t.activeTexture(i.TEXTURE0+W);const re=ct.getPrimaries(ct.workingColorSpace),w=K.colorSpace===vn?null:ct.getPrimaries(K.colorSpace),G=K.colorSpace===vn||re===w?i.NONE:i.BROWSER_DEFAULT_WEBGL;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,K.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,K.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,K.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,G);const Z=K.isCompressedTexture||K.image[0].isCompressedTexture,F=K.image[0]&&K.image[0].isDataTexture,R=[];for(let xe=0;xe<6;xe++)R[xe]=Z||F?F?K.image[xe].image:K.image[xe]:g(K.image[xe],!0,s.maxCubemapSize),R[xe]=j(K,R[xe]);const N=R[0],z=a.convert(K.format,K.colorSpace),Y=a.convert(K.type),q=_(K.internalFormat,z,Y,K.colorSpace),he=K.isVideoTexture!==!0,de=Q.__version===void 0||$===!0,ue=k.dataReady;let we,Ne=y(K,N);if(E(i.TEXTURE_CUBE_MAP,K),Z){he&&de&&t.texStorage2D(i.TEXTURE_CUBE_MAP,Ne,q,N.width,N.height);for(let xe=0;xe<6;xe++){we=R[xe].mipmaps;for(let Ue=0;Ue<we.length;Ue++){const je=we[Ue];K.format!==Hr?z!==null&&(he?ue&&t.compressedTexSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,Ue,0,0,je.width,je.height,z,je.data):t.compressedTexImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,Ue,q,je.width,je.height,0,je.data)):he?ue&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,Ue,0,0,je.width,je.height,z,Y,je.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,Ue,q,je.width,je.height,0,z,Y,je.data)}}}else{if(we=K.mipmaps,he&&de){we.length>0&&Ne++;const xe=ae(R[0]);t.texStorage2D(i.TEXTURE_CUBE_MAP,Ne,q,xe.width,xe.height)}for(let xe=0;xe<6;xe++)if(F){he?ue&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,0,0,R[xe].width,R[xe].height,z,Y,R[xe].data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,q,R[xe].width,R[xe].height,0,z,Y,R[xe].data);for(let Ue=0;Ue<we.length;Ue++){const je=we[Ue].image[xe].image;he?ue&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,Ue+1,0,0,je.width,je.height,z,Y,je.data):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,Ue+1,q,je.width,je.height,0,z,Y,je.data)}}else{he?ue&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,0,0,z,Y,R[xe]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,q,z,Y,R[xe]);for(let Ue=0;Ue<we.length;Ue++){const je=we[Ue];he?ue&&t.texSubImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,Ue+1,0,0,z,Y,je.image[xe]):t.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+xe,Ue+1,q,z,Y,je.image[xe])}}}m(K)&&v(i.TEXTURE_CUBE_MAP),Q.__version=k.version,K.onUpdate&&K.onUpdate(K)}ne.__version=K.version}(ee,O,D):t.bindTexture(i.TEXTURE_CUBE_MAP,ee.__webglTexture,i.TEXTURE0+D)},this.rebindTextures=function(O,D,ee){const ne=r.get(O);D!==void 0&&V(ne.__webglFramebuffer,O,O.texture,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,0),ee!==void 0&&X(O)},this.setupRenderTarget=function(O){const D=O.texture,ee=r.get(O),ne=r.get(D);O.addEventListener("dispose",b);const K=O.textures,W=O.isWebGLCubeRenderTarget===!0,$=K.length>1;if($||(ne.__webglTexture===void 0&&(ne.__webglTexture=i.createTexture()),ne.__version=D.version,n.memory.textures++),W){ee.__webglFramebuffer=[];for(let k=0;k<6;k++)if(D.mipmaps&&D.mipmaps.length>0){ee.__webglFramebuffer[k]=[];for(let Q=0;Q<D.mipmaps.length;Q++)ee.__webglFramebuffer[k][Q]=i.createFramebuffer()}else ee.__webglFramebuffer[k]=i.createFramebuffer()}else{if(D.mipmaps&&D.mipmaps.length>0){ee.__webglFramebuffer=[];for(let k=0;k<D.mipmaps.length;k++)ee.__webglFramebuffer[k]=i.createFramebuffer()}else ee.__webglFramebuffer=i.createFramebuffer();if($)for(let k=0,Q=K.length;k<Q;k++){const re=r.get(K[k]);re.__webglTexture===void 0&&(re.__webglTexture=i.createTexture(),n.memory.textures++)}if(O.samples>0&&B(O)===!1){ee.__webglMultisampledFramebuffer=i.createFramebuffer(),ee.__webglColorRenderbuffer=[],t.bindFramebuffer(i.FRAMEBUFFER,ee.__webglMultisampledFramebuffer);for(let k=0;k<K.length;k++){const Q=K[k];ee.__webglColorRenderbuffer[k]=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,ee.__webglColorRenderbuffer[k]);const re=a.convert(Q.format,Q.colorSpace),w=a.convert(Q.type),G=_(Q.internalFormat,re,w,Q.colorSpace,O.isXRRenderTarget===!0),Z=fe(O);i.renderbufferStorageMultisample(i.RENDERBUFFER,Z,G,O.width,O.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+k,i.RENDERBUFFER,ee.__webglColorRenderbuffer[k])}i.bindRenderbuffer(i.RENDERBUFFER,null),O.depthBuffer&&(ee.__webglDepthRenderbuffer=i.createRenderbuffer(),J(ee.__webglDepthRenderbuffer,O,!0)),t.bindFramebuffer(i.FRAMEBUFFER,null)}}if(W){t.bindTexture(i.TEXTURE_CUBE_MAP,ne.__webglTexture),E(i.TEXTURE_CUBE_MAP,D);for(let k=0;k<6;k++)if(D.mipmaps&&D.mipmaps.length>0)for(let Q=0;Q<D.mipmaps.length;Q++)V(ee.__webglFramebuffer[k][Q],O,D,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+k,Q);else V(ee.__webglFramebuffer[k],O,D,i.COLOR_ATTACHMENT0,i.TEXTURE_CUBE_MAP_POSITIVE_X+k,0);m(D)&&v(i.TEXTURE_CUBE_MAP),t.unbindTexture()}else if($){for(let k=0,Q=K.length;k<Q;k++){const re=K[k],w=r.get(re);t.bindTexture(i.TEXTURE_2D,w.__webglTexture),E(i.TEXTURE_2D,re),V(ee.__webglFramebuffer,O,re,i.COLOR_ATTACHMENT0+k,i.TEXTURE_2D,0),m(re)&&v(i.TEXTURE_2D)}t.unbindTexture()}else{let k=i.TEXTURE_2D;if((O.isWebGL3DRenderTarget||O.isWebGLArrayRenderTarget)&&(k=O.isWebGL3DRenderTarget?i.TEXTURE_3D:i.TEXTURE_2D_ARRAY),t.bindTexture(k,ne.__webglTexture),E(k,D),D.mipmaps&&D.mipmaps.length>0)for(let Q=0;Q<D.mipmaps.length;Q++)V(ee.__webglFramebuffer[Q],O,D,i.COLOR_ATTACHMENT0,k,Q);else V(ee.__webglFramebuffer,O,D,i.COLOR_ATTACHMENT0,k,0);m(D)&&v(k),t.unbindTexture()}O.depthBuffer&&X(O)},this.updateRenderTargetMipmap=function(O){const D=O.textures;for(let ee=0,ne=D.length;ee<ne;ee++){const K=D[ee];if(m(K)){const W=O.isWebGLCubeRenderTarget?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D,$=r.get(K).__webglTexture;t.bindTexture(W,$),v(W),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function(O){if(O.samples>0){if(B(O)===!1){const D=O.textures,ee=O.width,ne=O.height;let K=i.COLOR_BUFFER_BIT;const W=O.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT,$=r.get(O),k=D.length>1;if(k)for(let Q=0;Q<D.length;Q++)t.bindFramebuffer(i.FRAMEBUFFER,$.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Q,i.RENDERBUFFER,null),t.bindFramebuffer(i.FRAMEBUFFER,$.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Q,i.TEXTURE_2D,null,0);t.bindFramebuffer(i.READ_FRAMEBUFFER,$.__webglMultisampledFramebuffer),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,$.__webglFramebuffer);for(let Q=0;Q<D.length;Q++){if(O.resolveDepthBuffer&&(O.depthBuffer&&(K|=i.DEPTH_BUFFER_BIT),O.stencilBuffer&&O.resolveStencilBuffer&&(K|=i.STENCIL_BUFFER_BIT)),k){i.framebufferRenderbuffer(i.READ_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,$.__webglColorRenderbuffer[Q]);const re=r.get(D[Q]).__webglTexture;i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,re,0)}i.blitFramebuffer(0,0,ee,ne,0,0,ee,ne,K,i.NEAREST),l===!0&&(te.length=0,ie.length=0,te.push(i.COLOR_ATTACHMENT0+Q),O.depthBuffer&&O.resolveDepthBuffer===!1&&(te.push(W),ie.push(W),i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,ie)),i.invalidateFramebuffer(i.READ_FRAMEBUFFER,te))}if(t.bindFramebuffer(i.READ_FRAMEBUFFER,null),t.bindFramebuffer(i.DRAW_FRAMEBUFFER,null),k)for(let Q=0;Q<D.length;Q++){t.bindFramebuffer(i.FRAMEBUFFER,$.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+Q,i.RENDERBUFFER,$.__webglColorRenderbuffer[Q]);const re=r.get(D[Q]).__webglTexture;t.bindFramebuffer(i.FRAMEBUFFER,$.__webglFramebuffer),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,i.COLOR_ATTACHMENT0+Q,i.TEXTURE_2D,re,0)}t.bindFramebuffer(i.DRAW_FRAMEBUFFER,$.__webglMultisampledFramebuffer)}else if(O.depthBuffer&&O.resolveDepthBuffer===!1&&l){const D=O.stencilBuffer?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;i.invalidateFramebuffer(i.DRAW_FRAMEBUFFER,[D])}}},this.setupDepthRenderbuffer=X,this.setupFrameBufferTexture=V,this.useMultisampledRTT=B}function Ex(i,e){return{convert:function(t,r=""){let s;const a=ct.getTransfer(r);if(t===Fn)return i.UNSIGNED_BYTE;if(t===Hg)return i.UNSIGNED_SHORT_4_4_4_4;if(t===Gg)return i.UNSIGNED_SHORT_5_5_5_1;if(t===35902)return i.UNSIGNED_INT_5_9_9_9_REV;if(t===1010)return i.BYTE;if(t===1011)return i.SHORT;if(t===tp)return i.UNSIGNED_SHORT;if(t===Vg)return i.INT;if(t===zn)return i.UNSIGNED_INT;if(t===wr)return i.FLOAT;if(t===Yt)return i.HALF_FLOAT;if(t===1021)return i.ALPHA;if(t===1022)return i.RGB;if(t===Hr)return i.RGBA;if(t===1024)return i.LUMINANCE;if(t===1025)return i.LUMINANCE_ALPHA;if(t===An)return i.DEPTH_COMPONENT;if(t===Bn)return i.DEPTH_STENCIL;if(t===jg)return i.RED;if(t===Wg)return i.RED_INTEGER;if(t===1030)return i.RG;if(t===Xg)return i.RG_INTEGER;if(t===qg)return i.RGBA_INTEGER;if(t===qu||t===Yu||t===Zu||t===Ku)if(a===bt){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s===null)return null;if(t===qu)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===Yu)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===Zu)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===Ku)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),s===null)return null;if(t===qu)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Yu)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Zu)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Ku)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===gf||t===vf||t===_f||t===yf){if(s=e.get("WEBGL_compressed_texture_pvrtc"),s===null)return null;if(t===gf)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===vf)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===_f)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===yf)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===xf||t===bf||t===Mf){if(s=e.get("WEBGL_compressed_texture_etc"),s===null)return null;if(t===xf||t===bf)return a===bt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(t===Mf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(t===wf||t===Sf||t===Tf||t===Ef||t===Af||t===Cf||t===Pf||t===Rf||t===If||t===Lf||t===Df||t===Of||t===Nf||t===Uf){if(s=e.get("WEBGL_compressed_texture_astc"),s===null)return null;if(t===wf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===Sf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===Tf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===Ef)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===Af)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===Cf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===Pf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===Rf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===If)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===Lf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===Df)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===Of)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===Nf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===Uf)return a===bt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===Qu||t===kf||t===Ff){if(s=e.get("EXT_texture_compression_bptc"),s===null)return null;if(t===Qu)return a===bt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(t===kf)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(t===Ff)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(t===36283||t===zf||t===Bf||t===Vf){if(s=e.get("EXT_texture_compression_rgtc"),s===null)return null;if(t===Qu)return s.COMPRESSED_RED_RGTC1_EXT;if(t===zf)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===Bf)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===Vf)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return t===Zn?i.UNSIGNED_INT_24_8:i[t]!==void 0?i[t]:null}}}class Ax extends Zt{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Mi extends Ve{constructor(){super(),this.isGroup=!0,this.type="Group"}}const hT={type:"move"};class rm{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Mi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Mi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new C,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new C),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Mi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new C,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new C),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let s=null,a=null,n=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){n=!0;for(const g of e.hand.values()){const m=t.getJointPose(g,r),v=this._getHandJoint(c,g);m!==null&&(v.matrix.fromArray(m.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=m.radius),v.visible=m!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],d=h.position.distanceTo(u.position),p=.02,f=.005;c.inputState.pinching&&d>p+f?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=p-f&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(a=t.getPose(e.gripSpace,r),a!==null&&(l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,a.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(a.linearVelocity)):l.hasLinearVelocity=!1,a.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(a.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(s=t.getPose(e.targetRaySpace,r),s===null&&a!==null&&(s=a),s!==null&&(o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,s.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(s.linearVelocity)):o.hasLinearVelocity=!1,s.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(s.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(hT)))}return o!==null&&(o.visible=s!==null),l!==null&&(l.visible=a!==null),c!==null&&(c.visible=n!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new Mi;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class uT{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const s=new yt;e.properties.get(s).__webglTexture=t.texture,t.depthNear==r.depthNear&&t.depthFar==r.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}render(e,t){if(this.texture!==null){if(this.mesh===null){const r=t.cameras[0].viewport,s=new at({vertexShader:`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,fragmentShader:`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`,uniforms:{depthColor:{value:this.texture},depthWidth:{value:r.z},depthHeight:{value:r.w}}});this.mesh=new ye(new ys(20,20),s)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class dT extends fs{constructor(e,t){super();const r=this;let s=null,a=1,n=null,o="local-floor",l=1,c=null,h=null,u=null,d=null,p=null,f=null;const g=new uT,m=t.getContextAttributes();let v=null,_=null;const y=[],x=[],b=new se;let M=null;const T=new Zt;T.layers.enable(1),T.viewport=new qe;const A=new Zt;A.layers.enable(2),A.viewport=new qe;const L=[T,A],U=new Ax;U.layers.enable(1),U.layers.enable(2);let P=null,E=null;function I(B){const j=x.indexOf(B.inputSource);if(j===-1)return;const ae=y[j];ae!==void 0&&(ae.update(B.inputSource,B.frame,c||n),ae.dispatchEvent({type:B.type,data:B.inputSource}))}function S(){s.removeEventListener("select",I),s.removeEventListener("selectstart",I),s.removeEventListener("selectend",I),s.removeEventListener("squeeze",I),s.removeEventListener("squeezestart",I),s.removeEventListener("squeezeend",I),s.removeEventListener("end",S),s.removeEventListener("inputsourceschange",V);for(let B=0;B<y.length;B++){const j=x[B];j!==null&&(x[B]=null,y[B].disconnect(j))}P=null,E=null,g.reset(),e.setRenderTarget(v),p=null,d=null,u=null,s=null,_=null,fe.stop(),r.isPresenting=!1,e.setPixelRatio(M),e.setSize(b.width,b.height,!1),r.dispatchEvent({type:"sessionend"})}function V(B){for(let j=0;j<B.removed.length;j++){const ae=B.removed[j],O=x.indexOf(ae);O>=0&&(x[O]=null,y[O].disconnect(ae))}for(let j=0;j<B.added.length;j++){const ae=B.added[j];let O=x.indexOf(ae);if(O===-1){for(let ee=0;ee<y.length;ee++){if(ee>=x.length){x.push(ae),O=ee;break}if(x[ee]===null){x[ee]=ae,O=ee;break}}if(O===-1)break}const D=y[O];D&&D.connect(ae)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(B){let j=y[B];return j===void 0&&(j=new rm,y[B]=j),j.getTargetRaySpace()},this.getControllerGrip=function(B){let j=y[B];return j===void 0&&(j=new rm,y[B]=j),j.getGripSpace()},this.getHand=function(B){let j=y[B];return j===void 0&&(j=new rm,y[B]=j),j.getHandSpace()},this.setFramebufferScaleFactor=function(B){a=B,r.isPresenting},this.setReferenceSpaceType=function(B){o=B,r.isPresenting},this.getReferenceSpace=function(){return c||n},this.setReferenceSpace=function(B){c=B},this.getBaseLayer=function(){return d!==null?d:p},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return s},this.setSession=function(B){return os(this,null,function*(){if(s=B,s!==null){if(v=e.getRenderTarget(),s.addEventListener("select",I),s.addEventListener("selectstart",I),s.addEventListener("selectend",I),s.addEventListener("squeeze",I),s.addEventListener("squeezestart",I),s.addEventListener("squeezeend",I),s.addEventListener("end",S),s.addEventListener("inputsourceschange",V),m.xrCompatible!==!0&&(yield t.makeXRCompatible()),M=e.getPixelRatio(),e.getSize(b),s.renderState.layers===void 0){const j={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:a};p=new XRWebGLLayer(s,t,j),s.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),_=new pt(p.framebufferWidth,p.framebufferHeight,{format:Hr,type:Fn,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let j=null,ae=null,O=null;m.depth&&(O=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,j=m.stencil?Bn:An,ae=m.stencil?Zn:zn);const D={colorFormat:t.RGBA8,depthFormat:O,scaleFactor:a};u=new XRWebGLBinding(s,t),d=u.createProjectionLayer(D),s.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),_=new pt(d.textureWidth,d.textureHeight,{format:Hr,type:Fn,depthTexture:new lh(d.textureWidth,d.textureHeight,ae,void 0,void 0,void 0,void 0,void 0,void 0,j),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}_.isXRRenderTarget=!0,this.setFoveation(l),c=null,n=yield s.requestReferenceSpace(o),fe.setContext(s),fe.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}})},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};const J=new C,X=new C;function te(B,j){j===null?B.matrixWorld.copy(B.matrix):B.matrixWorld.multiplyMatrices(j.matrixWorld,B.matrix),B.matrixWorldInverse.copy(B.matrixWorld).invert()}this.updateCamera=function(B){if(s===null)return;g.texture!==null&&(B.near=g.depthNear,B.far=g.depthFar),U.near=A.near=T.near=B.near,U.far=A.far=T.far=B.far,P===U.near&&E===U.far||(s.updateRenderState({depthNear:U.near,depthFar:U.far}),P=U.near,E=U.far,T.near=P,T.far=E,A.near=P,A.far=E,T.updateProjectionMatrix(),A.updateProjectionMatrix(),B.updateProjectionMatrix());const j=B.parent,ae=U.cameras;te(U,j);for(let O=0;O<ae.length;O++)te(ae[O],j);ae.length===2?function(O,D,ee){J.setFromMatrixPosition(D.matrixWorld),X.setFromMatrixPosition(ee.matrixWorld);const ne=J.distanceTo(X),K=D.projectionMatrix.elements,W=ee.projectionMatrix.elements,$=K[14]/(K[10]-1),k=K[14]/(K[10]+1),Q=(K[9]+1)/K[5],re=(K[9]-1)/K[5],w=(K[8]-1)/K[0],G=(W[8]+1)/W[0],Z=$*w,F=$*G,R=ne/(-w+G),N=R*-w;D.matrixWorld.decompose(O.position,O.quaternion,O.scale),O.translateX(N),O.translateZ(R),O.matrixWorld.compose(O.position,O.quaternion,O.scale),O.matrixWorldInverse.copy(O.matrixWorld).invert();const z=$+R,Y=k+R,q=Z-N,he=F+(ne-N),de=Q*k/Y*z,ue=re*k/Y*z;O.projectionMatrix.makePerspective(q,he,de,ue,z,Y),O.projectionMatrixInverse.copy(O.projectionMatrix).invert()}(U,T,A):U.projectionMatrix.copy(T.projectionMatrix),function(O,D,ee){ee===null?O.matrix.copy(D.matrixWorld):(O.matrix.copy(ee.matrixWorld),O.matrix.invert(),O.matrix.multiply(D.matrixWorld)),O.matrix.decompose(O.position,O.quaternion,O.scale),O.updateMatrixWorld(!0),O.projectionMatrix.copy(D.projectionMatrix),O.projectionMatrixInverse.copy(D.projectionMatrixInverse),O.isPerspectiveCamera&&(O.fov=2*il*Math.atan(1/O.projectionMatrix.elements[5]),O.zoom=1)}(B,U,j)},this.getCamera=function(){return U},this.getFoveation=function(){return d===null&&p===null?void 0:l},this.setFoveation=function(B){l=B,d!==null&&(d.fixedFoveation=B),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=B)},this.hasDepthSensing=function(){return g.texture!==null};let ie=null;const fe=new xx;fe.setAnimationLoop(function(B,j){if(h=j.getViewerPose(c||n),f=j,h!==null){const ae=h.views;p!==null&&(e.setRenderTargetFramebuffer(_,p.framebuffer),e.setRenderTarget(_));let O=!1;ae.length!==U.cameras.length&&(U.cameras.length=0,O=!0);for(let ee=0;ee<ae.length;ee++){const ne=ae[ee];let K=null;if(p!==null)K=p.getViewport(ne);else{const $=u.getViewSubImage(d,ne);K=$.viewport,ee===0&&(e.setRenderTargetTextures(_,$.colorTexture,d.ignoreDepthValues?void 0:$.depthStencilTexture),e.setRenderTarget(_))}let W=L[ee];W===void 0&&(W=new Zt,W.layers.enable(ee),W.viewport=new qe,L[ee]=W),W.matrix.fromArray(ne.transform.matrix),W.matrix.decompose(W.position,W.quaternion,W.scale),W.projectionMatrix.fromArray(ne.projectionMatrix),W.projectionMatrixInverse.copy(W.projectionMatrix).invert(),W.viewport.set(K.x,K.y,K.width,K.height),ee===0&&(U.matrix.copy(W.matrix),U.matrix.decompose(U.position,U.quaternion,U.scale)),O===!0&&U.cameras.push(W)}const D=s.enabledFeatures;if(D&&D.includes("depth-sensing")){const ee=u.getDepthInformation(ae[0]);ee&&ee.isValid&&ee.texture&&g.init(e,ee,s.renderState)}}for(let ae=0;ae<y.length;ae++){const O=x[ae],D=y[ae];O!==null&&D!==void 0&&D.update(O,j,c||n)}g.render(e,U),ie&&ie(B,j),j.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:j}),f=null}),this.setAnimationLoop=function(B){ie=B},this.dispose=function(){}}}const Qa=new Ct,pT=new Me;function mT(i,e){function t(s,a){s.matrixAutoUpdate===!0&&s.updateMatrix(),a.value.copy(s.matrix)}function r(s,a){s.opacity.value=a.opacity,a.color&&s.diffuse.value.copy(a.color),a.emissive&&s.emissive.value.copy(a.emissive).multiplyScalar(a.emissiveIntensity),a.map&&(s.map.value=a.map,t(a.map,s.mapTransform)),a.alphaMap&&(s.alphaMap.value=a.alphaMap,t(a.alphaMap,s.alphaMapTransform)),a.bumpMap&&(s.bumpMap.value=a.bumpMap,t(a.bumpMap,s.bumpMapTransform),s.bumpScale.value=a.bumpScale,a.side===Ri&&(s.bumpScale.value*=-1)),a.normalMap&&(s.normalMap.value=a.normalMap,t(a.normalMap,s.normalMapTransform),s.normalScale.value.copy(a.normalScale),a.side===Ri&&s.normalScale.value.negate()),a.displacementMap&&(s.displacementMap.value=a.displacementMap,t(a.displacementMap,s.displacementMapTransform),s.displacementScale.value=a.displacementScale,s.displacementBias.value=a.displacementBias),a.emissiveMap&&(s.emissiveMap.value=a.emissiveMap,t(a.emissiveMap,s.emissiveMapTransform)),a.specularMap&&(s.specularMap.value=a.specularMap,t(a.specularMap,s.specularMapTransform)),a.alphaTest>0&&(s.alphaTest.value=a.alphaTest);const n=e.get(a),o=n.envMap,l=n.envMapRotation;if(o&&(s.envMap.value=o,Qa.copy(l),Qa.x*=-1,Qa.y*=-1,Qa.z*=-1,o.isCubeTexture&&o.isRenderTargetTexture===!1&&(Qa.y*=-1,Qa.z*=-1),s.envMapRotation.value.setFromMatrix4(pT.makeRotationFromEuler(Qa)),s.flipEnvMap.value=o.isCubeTexture&&o.isRenderTargetTexture===!1?-1:1,s.reflectivity.value=a.reflectivity,s.ior.value=a.ior,s.refractionRatio.value=a.refractionRatio),a.lightMap){s.lightMap.value=a.lightMap;const c=i._useLegacyLights===!0?Math.PI:1;s.lightMapIntensity.value=a.lightMapIntensity*c,t(a.lightMap,s.lightMapTransform)}a.aoMap&&(s.aoMap.value=a.aoMap,s.aoMapIntensity.value=a.aoMapIntensity,t(a.aoMap,s.aoMapTransform))}return{refreshFogUniforms:function(s,a){a.color.getRGB(s.fogColor.value,vx(i)),a.isFog?(s.fogNear.value=a.near,s.fogFar.value=a.far):a.isFogExp2&&(s.fogDensity.value=a.density)},refreshMaterialUniforms:function(s,a,n,o,l){a.isMeshBasicMaterial||a.isMeshLambertMaterial?r(s,a):a.isMeshToonMaterial?(r(s,a),function(c,h){h.gradientMap&&(c.gradientMap.value=h.gradientMap)}(s,a)):a.isMeshPhongMaterial?(r(s,a),function(c,h){c.specular.value.copy(h.specular),c.shininess.value=Math.max(h.shininess,1e-4)}(s,a)):a.isMeshStandardMaterial?(r(s,a),function(c,h){c.metalness.value=h.metalness,h.metalnessMap&&(c.metalnessMap.value=h.metalnessMap,t(h.metalnessMap,c.metalnessMapTransform)),c.roughness.value=h.roughness,h.roughnessMap&&(c.roughnessMap.value=h.roughnessMap,t(h.roughnessMap,c.roughnessMapTransform)),h.envMap&&(c.envMapIntensity.value=h.envMapIntensity)}(s,a),a.isMeshPhysicalMaterial&&function(c,h,u){c.ior.value=h.ior,h.sheen>0&&(c.sheenColor.value.copy(h.sheenColor).multiplyScalar(h.sheen),c.sheenRoughness.value=h.sheenRoughness,h.sheenColorMap&&(c.sheenColorMap.value=h.sheenColorMap,t(h.sheenColorMap,c.sheenColorMapTransform)),h.sheenRoughnessMap&&(c.sheenRoughnessMap.value=h.sheenRoughnessMap,t(h.sheenRoughnessMap,c.sheenRoughnessMapTransform))),h.clearcoat>0&&(c.clearcoat.value=h.clearcoat,c.clearcoatRoughness.value=h.clearcoatRoughness,h.clearcoatMap&&(c.clearcoatMap.value=h.clearcoatMap,t(h.clearcoatMap,c.clearcoatMapTransform)),h.clearcoatRoughnessMap&&(c.clearcoatRoughnessMap.value=h.clearcoatRoughnessMap,t(h.clearcoatRoughnessMap,c.clearcoatRoughnessMapTransform)),h.clearcoatNormalMap&&(c.clearcoatNormalMap.value=h.clearcoatNormalMap,t(h.clearcoatNormalMap,c.clearcoatNormalMapTransform),c.clearcoatNormalScale.value.copy(h.clearcoatNormalScale),h.side===Ri&&c.clearcoatNormalScale.value.negate())),h.dispersion>0&&(c.dispersion.value=h.dispersion),h.iridescence>0&&(c.iridescence.value=h.iridescence,c.iridescenceIOR.value=h.iridescenceIOR,c.iridescenceThicknessMinimum.value=h.iridescenceThicknessRange[0],c.iridescenceThicknessMaximum.value=h.iridescenceThicknessRange[1],h.iridescenceMap&&(c.iridescenceMap.value=h.iridescenceMap,t(h.iridescenceMap,c.iridescenceMapTransform)),h.iridescenceThicknessMap&&(c.iridescenceThicknessMap.value=h.iridescenceThicknessMap,t(h.iridescenceThicknessMap,c.iridescenceThicknessMapTransform))),h.transmission>0&&(c.transmission.value=h.transmission,c.transmissionSamplerMap.value=u.texture,c.transmissionSamplerSize.value.set(u.width,u.height),h.transmissionMap&&(c.transmissionMap.value=h.transmissionMap,t(h.transmissionMap,c.transmissionMapTransform)),c.thickness.value=h.thickness,h.thicknessMap&&(c.thicknessMap.value=h.thicknessMap,t(h.thicknessMap,c.thicknessMapTransform)),c.attenuationDistance.value=h.attenuationDistance,c.attenuationColor.value.copy(h.attenuationColor)),h.anisotropy>0&&(c.anisotropyVector.value.set(h.anisotropy*Math.cos(h.anisotropyRotation),h.anisotropy*Math.sin(h.anisotropyRotation)),h.anisotropyMap&&(c.anisotropyMap.value=h.anisotropyMap,t(h.anisotropyMap,c.anisotropyMapTransform))),c.specularIntensity.value=h.specularIntensity,c.specularColor.value.copy(h.specularColor),h.specularColorMap&&(c.specularColorMap.value=h.specularColorMap,t(h.specularColorMap,c.specularColorMapTransform)),h.specularIntensityMap&&(c.specularIntensityMap.value=h.specularIntensityMap,t(h.specularIntensityMap,c.specularIntensityMapTransform))}(s,a,l)):a.isMeshMatcapMaterial?(r(s,a),function(c,h){h.matcap&&(c.matcap.value=h.matcap)}(s,a)):a.isMeshDepthMaterial?r(s,a):a.isMeshDistanceMaterial?(r(s,a),function(c,h){const u=e.get(h).light;c.referencePosition.value.setFromMatrixPosition(u.matrixWorld),c.nearDistance.value=u.shadow.camera.near,c.farDistance.value=u.shadow.camera.far}(s,a)):a.isMeshNormalMaterial?r(s,a):a.isLineBasicMaterial?(function(c,h){c.diffuse.value.copy(h.color),c.opacity.value=h.opacity,h.map&&(c.map.value=h.map,t(h.map,c.mapTransform))}(s,a),a.isLineDashedMaterial&&function(c,h){c.dashSize.value=h.dashSize,c.totalSize.value=h.dashSize+h.gapSize,c.scale.value=h.scale}(s,a)):a.isPointsMaterial?function(c,h,u,d){c.diffuse.value.copy(h.color),c.opacity.value=h.opacity,c.size.value=h.size*u,c.scale.value=.5*d,h.map&&(c.map.value=h.map,t(h.map,c.uvTransform)),h.alphaMap&&(c.alphaMap.value=h.alphaMap,t(h.alphaMap,c.alphaMapTransform)),h.alphaTest>0&&(c.alphaTest.value=h.alphaTest)}(s,a,n,o):a.isSpriteMaterial?function(c,h){c.diffuse.value.copy(h.color),c.opacity.value=h.opacity,c.rotation.value=h.rotation,h.map&&(c.map.value=h.map,t(h.map,c.mapTransform)),h.alphaMap&&(c.alphaMap.value=h.alphaMap,t(h.alphaMap,c.alphaMapTransform)),h.alphaTest>0&&(c.alphaTest.value=h.alphaTest)}(s,a):a.isShadowMaterial?(s.color.value.copy(a.color),s.opacity.value=a.opacity):a.isShaderMaterial&&(a.uniformsNeedUpdate=!1)}}}function fT(i,e,t,r){let s={},a={},n=[];const o=i.getParameter(i.MAX_UNIFORM_BUFFER_BINDINGS);function l(u,d,p,f){const g=u.value,m=d+"_"+p;if(f[m]===void 0)return f[m]=typeof g=="number"||typeof g=="boolean"?g:g.clone(),!0;{const v=f[m];if(typeof g=="number"||typeof g=="boolean"){if(v!==g)return f[m]=g,!0}else if(v.equals(g)===!1)return v.copy(g),!0}return!1}function c(u){const d={boundary:0,storage:0};return typeof u=="number"||typeof u=="boolean"?(d.boundary=4,d.storage=4):u.isVector2?(d.boundary=8,d.storage=8):u.isVector3||u.isColor?(d.boundary=16,d.storage=12):u.isVector4?(d.boundary=16,d.storage=16):u.isMatrix3?(d.boundary=48,d.storage=48):u.isMatrix4?(d.boundary=64,d.storage=64):u.isTexture,d}function h(u){const d=u.target;d.removeEventListener("dispose",h);const p=n.indexOf(d.__bindingPointIndex);n.splice(p,1),i.deleteBuffer(s[d.id]),delete s[d.id],delete a[d.id]}return{bind:function(u,d){const p=d.program;r.uniformBlockBinding(u,p)},update:function(u,d){let p=s[u.id];p===void 0&&(function(m){const v=m.uniforms;let _=0;const y=16;for(let b=0,M=v.length;b<M;b++){const T=Array.isArray(v[b])?v[b]:[v[b]];for(let A=0,L=T.length;A<L;A++){const U=T[A],P=Array.isArray(U.value)?U.value:[U.value];for(let E=0,I=P.length;E<I;E++){const S=c(P[E]),V=_%y;V!==0&&y-V<S.boundary&&(_+=y-V),U.__data=new Float32Array(S.storage/Float32Array.BYTES_PER_ELEMENT),U.__offset=_,_+=S.storage}}}const x=_%y;x>0&&(_+=y-x),m.__size=_,m.__cache={}}(u),p=function(m){const v=function(){for(let b=0;b<o;b++)if(n.indexOf(b)===-1)return n.push(b),b;return 0}();m.__bindingPointIndex=v;const _=i.createBuffer(),y=m.__size,x=m.usage;return i.bindBuffer(i.UNIFORM_BUFFER,_),i.bufferData(i.UNIFORM_BUFFER,y,x),i.bindBuffer(i.UNIFORM_BUFFER,null),i.bindBufferBase(i.UNIFORM_BUFFER,v,_),_}(u),s[u.id]=p,u.addEventListener("dispose",h));const f=d.program;r.updateUBOMapping(u,f);const g=e.render.frame;a[u.id]!==g&&(function(m){const v=s[m.id],_=m.uniforms,y=m.__cache;i.bindBuffer(i.UNIFORM_BUFFER,v);for(let x=0,b=_.length;x<b;x++){const M=Array.isArray(_[x])?_[x]:[_[x]];for(let T=0,A=M.length;T<A;T++){const L=M[T];if(l(L,x,T,y)===!0){const U=L.__offset,P=Array.isArray(L.value)?L.value:[L.value];let E=0;for(let I=0;I<P.length;I++){const S=P[I],V=c(S);typeof S=="number"||typeof S=="boolean"?(L.__data[0]=S,i.bufferSubData(i.UNIFORM_BUFFER,U+E,L.__data)):S.isMatrix3?(L.__data[0]=S.elements[0],L.__data[1]=S.elements[1],L.__data[2]=S.elements[2],L.__data[3]=0,L.__data[4]=S.elements[3],L.__data[5]=S.elements[4],L.__data[6]=S.elements[5],L.__data[7]=0,L.__data[8]=S.elements[6],L.__data[9]=S.elements[7],L.__data[10]=S.elements[8],L.__data[11]=0):(S.toArray(L.__data,E),E+=V.storage/Float32Array.BYTES_PER_ELEMENT)}i.bufferSubData(i.UNIFORM_BUFFER,U,L.__data)}}}i.bindBuffer(i.UNIFORM_BUFFER,null)}(u),a[u.id]=g)},dispose:function(){for(const u in s)i.deleteBuffer(s[u]);n=[],s={},a={}}}}class Cx{constructor(e={}){const{canvas:t=dx(),context:r=null,depth:s=!0,stencil:a=!1,alpha:n=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1}=e;let d;if(this.isWebGLRenderer=!0,r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");d=r.getContextAttributes().alpha}else d=n;const p=new Uint32Array(4),f=new Int32Array(4);let g=null,m=null;const v=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Mt,this._useLegacyLights=!1,this.toneMapping=cs,this.toneMappingExposure=1;const y=this;let x=!1,b=0,M=0,T=null,A=-1,L=null;const U=new qe,P=new qe;let E=null;const I=new ve(0);let S=0,V=t.width,J=t.height,X=1,te=null,ie=null;const fe=new qe(0,0,V,J),B=new qe(0,0,V,J);let j=!1;const ae=new oh;let O=!1,D=!1;const ee=new Me,ne=new C,K={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return T===null?X:1}let $,k,Q,re,w,G,Z,F,R,N,z,Y,q,he,de,ue,we,Ne,xe,Ue,je,Je,It,nt,ce=r;function bs(H,le){return t.getContext(H,le)}try{const H={alpha:!0,depth:s,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${cd}`),t.addEventListener("webglcontextlost",Ga,!1),t.addEventListener("webglcontextrestored",yh,!1),t.addEventListener("webglcontextcreationerror",xh,!1),ce===null){const le="webgl2";if(ce=bs(le,H),ce===null)throw bs(le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(H){throw H}function Li(){$=new WS(ce),$.init(),Je=new Ex(ce,$),k=new VS(ce,$,e,Je),Q=new lT(ce),re=new YS(ce),w=new J2,G=new cT(ce,$,Q,w,k,Je,re),Z=new GS(y),F=new jS(y),R=new US(ce),It=new zS(ce,R),N=new XS(ce,R,re,It),z=new KS(ce,N,R,re),xe=new ZS(ce,k,G),ue=new HS(w),Y=new $2(y,Z,F,$,k,It,ue),q=new mT(y,w),he=new tT,de=new nT($),Ne=new FS(y,Z,F,Q,z,d,l),we=new oT(y,z,k),nt=new fT(ce,re,k,Q),Ue=new BS(ce,$,re),je=new qS(ce,$,re),re.programs=Y.programs,y.capabilities=k,y.extensions=$,y.properties=w,y.renderLists=he,y.shadowMap=we,y.state=Q,y.info=re}Li();const Et=new dT(y,ce);function Ga(H){H.preventDefault(),x=!0}function yh(){x=!1;const H=re.autoReset,le=we.enabled,pe=we.autoUpdate,ge=we.needsUpdate,me=we.type;Li(),re.autoReset=H,we.enabled=le,we.autoUpdate=pe,we.needsUpdate=ge,we.type=me}function xh(H){}function wl(H){const le=H.target;le.removeEventListener("dispose",wl),function(pe){(function(ge){const me=w.get(ge).programs;me!==void 0&&(me.forEach(function(Ee){Y.releaseProgram(Ee)}),ge.isShaderMaterial&&Y.releaseShaderCache(ge))})(pe),w.remove(pe)}(le)}function Ks(H,le,pe){H.transparent===!0&&H.side===Rt&&H.forceSinglePass===!1?(H.side=Ri,H.needsUpdate=!0,Mh(H,le,pe),H.side=Er,H.needsUpdate=!0,Mh(H,le,pe),H.side=Rt):Mh(H,le,pe)}this.xr=Et,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const H=$.get("WEBGL_lose_context");H&&H.loseContext()},this.forceContextRestore=function(){const H=$.get("WEBGL_lose_context");H&&H.restoreContext()},this.getPixelRatio=function(){return X},this.setPixelRatio=function(H){H!==void 0&&(X=H,this.setSize(V,J,!1))},this.getSize=function(H){return H.set(V,J)},this.setSize=function(H,le,pe=!0){Et.isPresenting||(V=H,J=le,t.width=Math.floor(H*X),t.height=Math.floor(le*X),pe===!0&&(t.style.width=H+"px",t.style.height=le+"px"),this.setViewport(0,0,H,le))},this.getDrawingBufferSize=function(H){return H.set(V*X,J*X).floor()},this.setDrawingBufferSize=function(H,le,pe){V=H,J=le,X=pe,t.width=Math.floor(H*pe),t.height=Math.floor(le*pe),this.setViewport(0,0,H,le)},this.getCurrentViewport=function(H){return H.copy(U)},this.getViewport=function(H){return H.copy(fe)},this.setViewport=function(H,le,pe,ge){H.isVector4?fe.set(H.x,H.y,H.z,H.w):fe.set(H,le,pe,ge),Q.viewport(U.copy(fe).multiplyScalar(X).round())},this.getScissor=function(H){return H.copy(B)},this.setScissor=function(H,le,pe,ge){H.isVector4?B.set(H.x,H.y,H.z,H.w):B.set(H,le,pe,ge),Q.scissor(P.copy(B).multiplyScalar(X).round())},this.getScissorTest=function(){return j},this.setScissorTest=function(H){Q.setScissorTest(j=H)},this.setOpaqueSort=function(H){te=H},this.setTransparentSort=function(H){ie=H},this.getClearColor=function(H){return H.copy(Ne.getClearColor())},this.setClearColor=function(){Ne.setClearColor.apply(Ne,arguments)},this.getClearAlpha=function(){return Ne.getClearAlpha()},this.setClearAlpha=function(){Ne.setClearAlpha.apply(Ne,arguments)},this.clear=function(H=!0,le=!0,pe=!0){let ge=0;if(H){let me=!1;if(T!==null){const Ee=T.texture.format;me=Ee===qg||Ee===Xg||Ee===Wg}if(me){const Ee=T.texture.type,De=Ee===Fn||Ee===zn||Ee===tp||Ee===Zn||Ee===Hg||Ee===Gg,Le=Ne.getClearColor(),Fe=Ne.getClearAlpha(),Ze=Le.r,ot=Le.g,rt=Le.b;De?(p[0]=Ze,p[1]=ot,p[2]=rt,p[3]=Fe,ce.clearBufferuiv(ce.COLOR,0,p)):(f[0]=Ze,f[1]=ot,f[2]=rt,f[3]=Fe,ce.clearBufferiv(ce.COLOR,0,f))}else ge|=ce.COLOR_BUFFER_BIT}le&&(ge|=ce.DEPTH_BUFFER_BIT),pe&&(ge|=ce.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ce.clear(ge)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ga,!1),t.removeEventListener("webglcontextrestored",yh,!1),t.removeEventListener("webglcontextcreationerror",xh,!1),he.dispose(),de.dispose(),w.dispose(),Z.dispose(),F.dispose(),z.dispose(),It.dispose(),nt.dispose(),Y.dispose(),Et.dispose(),Et.removeEventListener("sessionstart",$0),Et.removeEventListener("sessionend",J0),ja.stop()},this.renderBufferDirect=function(H,le,pe,ge,me,Ee){le===null&&(le=K);const De=me.isMesh&&me.matrixWorld.determinant()<0,Le=function(Jt,ws,Pr,et,ht){ws.isScene!==!0&&(ws=K),G.resetTextureUnits();const Pp=ws.fog,Aw=et.isMeshStandardMaterial?ws.environment:null,Cw=T===null?y.outputColorSpace:T.isXRRenderTarget===!0?T.texture.colorSpace:si,wh=(et.isMeshStandardMaterial?F:Z).get(et.envMap||Aw),Pw=et.vertexColors===!0&&!!Pr.attributes.color&&Pr.attributes.color.itemSize===4,Rw=!!Pr.attributes.tangent&&(!!et.normalMap||et.anisotropy>0),Iw=!!Pr.morphAttributes.position,Lw=!!Pr.morphAttributes.normal,Dw=!!Pr.morphAttributes.color;let nv=cs;et.toneMapped&&(T!==null&&T.isXRRenderTarget!==!0||(nv=y.toneMapping));const ov=Pr.morphAttributes.position||Pr.morphAttributes.normal||Pr.morphAttributes.color,Ow=ov!==void 0?ov.length:0,st=w.get(et),Nw=m.state.lights;if(O===!0&&(D===!0||Jt!==L)){const fr=Jt===L&&et.id===A;ue.setState(et,Jt,fr)}let Rr=!1;et.version===st.__version?st.needsLights&&st.lightsStateVersion!==Nw.state.version||st.outputColorSpace!==Cw||ht.isBatchedMesh&&st.batching===!1?Rr=!0:ht.isBatchedMesh||st.batching!==!0?ht.isInstancedMesh&&st.instancing===!1?Rr=!0:ht.isInstancedMesh||st.instancing!==!0?ht.isSkinnedMesh&&st.skinning===!1?Rr=!0:ht.isSkinnedMesh||st.skinning!==!0?ht.isInstancedMesh&&st.instancingColor===!0&&ht.instanceColor===null||ht.isInstancedMesh&&st.instancingColor===!1&&ht.instanceColor!==null||ht.isInstancedMesh&&st.instancingMorph===!0&&ht.morphTexture===null||ht.isInstancedMesh&&st.instancingMorph===!1&&ht.morphTexture!==null||st.envMap!==wh||et.fog===!0&&st.fog!==Pp?Rr=!0:st.numClippingPlanes===void 0||st.numClippingPlanes===ue.numPlanes&&st.numIntersection===ue.numIntersection?(st.vertexAlphas!==Pw||st.vertexTangents!==Rw||st.morphTargets!==Iw||st.morphNormals!==Lw||st.morphColors!==Dw||st.toneMapping!==nv||st.morphTargetsCount!==Ow)&&(Rr=!0):Rr=!0:Rr=!0:Rr=!0:Rr=!0:(Rr=!0,st.__version=et.version);let Wa=st.currentProgram;Rr===!0&&(Wa=Mh(et,ws,ht));let lv=!1,Sl=!1,Rp=!1;const wi=Wa.getUniforms(),$s=st.uniforms;if(Q.useProgram(Wa.program)&&(lv=!0,Sl=!0,Rp=!0),et.id!==A&&(A=et.id,Sl=!0),lv||L!==Jt){wi.setValue(ce,"projectionMatrix",Jt.projectionMatrix),wi.setValue(ce,"viewMatrix",Jt.matrixWorldInverse);const fr=wi.map.cameraPosition;fr!==void 0&&fr.setValue(ce,ne.setFromMatrixPosition(Jt.matrixWorld)),k.logarithmicDepthBuffer&&wi.setValue(ce,"logDepthBufFC",2/(Math.log(Jt.far+1)/Math.LN2)),(et.isMeshPhongMaterial||et.isMeshToonMaterial||et.isMeshLambertMaterial||et.isMeshBasicMaterial||et.isMeshStandardMaterial||et.isShaderMaterial)&&wi.setValue(ce,"isOrthographic",Jt.isOrthographicCamera===!0),L!==Jt&&(L=Jt,Sl=!0,Rp=!0)}if(ht.isSkinnedMesh){wi.setOptional(ce,ht,"bindMatrix"),wi.setOptional(ce,ht,"bindMatrixInverse");const fr=ht.skeleton;fr&&(fr.boneTexture===null&&fr.computeBoneTexture(),wi.setValue(ce,"boneTexture",fr.boneTexture,G))}ht.isBatchedMesh&&(wi.setOptional(ce,ht,"batchingTexture"),wi.setValue(ce,"batchingTexture",ht._matricesTexture,G));const Ip=Pr.morphAttributes;Ip.position===void 0&&Ip.normal===void 0&&Ip.color===void 0||xe.update(ht,Pr,Wa),(Sl||st.receiveShadow!==ht.receiveShadow)&&(st.receiveShadow=ht.receiveShadow,wi.setValue(ce,"receiveShadow",ht.receiveShadow)),et.isMeshGouraudMaterial&&et.envMap!==null&&($s.envMap.value=wh,$s.flipEnvMap.value=wh.isCubeTexture&&wh.isRenderTargetTexture===!1?-1:1),et.isMeshStandardMaterial&&et.envMap===null&&ws.environment!==null&&($s.envMapIntensity.value=ws.environmentIntensity),Sl&&(wi.setValue(ce,"toneMappingExposure",y.toneMappingExposure),st.needsLights&&(Ir=Rp,(Yr=$s).ambientLightColor.needsUpdate=Ir,Yr.lightProbe.needsUpdate=Ir,Yr.directionalLights.needsUpdate=Ir,Yr.directionalLightShadows.needsUpdate=Ir,Yr.pointLights.needsUpdate=Ir,Yr.pointLightShadows.needsUpdate=Ir,Yr.spotLights.needsUpdate=Ir,Yr.spotLightShadows.needsUpdate=Ir,Yr.rectAreaLights.needsUpdate=Ir,Yr.hemisphereLights.needsUpdate=Ir),Pp&&et.fog===!0&&q.refreshFogUniforms($s,Pp),q.refreshMaterialUniforms($s,et,X,J,m.state.transmissionRenderTarget[Jt.id]),Ju.upload(ce,sv(st),$s,G));var Yr,Ir;if(et.isShaderMaterial&&et.uniformsNeedUpdate===!0&&(Ju.upload(ce,sv(st),$s,G),et.uniformsNeedUpdate=!1),et.isSpriteMaterial&&wi.setValue(ce,"center",ht.center),wi.setValue(ce,"modelViewMatrix",ht.modelViewMatrix),wi.setValue(ce,"normalMatrix",ht.normalMatrix),wi.setValue(ce,"modelMatrix",ht.matrixWorld),et.isShaderMaterial||et.isRawShaderMaterial){const fr=et.uniformsGroups;for(let Lp=0,Uw=fr.length;Lp<Uw;Lp++){const cv=fr[Lp];nt.update(cv,Wa),nt.bind(cv,Wa)}}return Wa}(H,le,pe,ge,me);Q.setMaterial(ge,De);let Fe=pe.index,Ze=1;if(ge.wireframe===!0){if(Fe=N.getWireframeAttribute(pe),Fe===void 0)return;Ze=2}const ot=pe.drawRange,rt=pe.attributes.position;let wt=ot.start*Ze,pr=(ot.start+ot.count)*Ze;Ee!==null&&(wt=Math.max(wt,Ee.start*Ze),pr=Math.min(pr,(Ee.start+Ee.count)*Ze)),Fe!==null?(wt=Math.max(wt,0),pr=Math.min(pr,Fe.count)):rt!=null&&(wt=Math.max(wt,0),pr=Math.min(pr,rt.count));const Ms=pr-wt;if(Ms<0||Ms===1/0)return;let mr;It.setup(me,ge,Le,pe,Fe);let Ut=Ue;if(Fe!==null&&(mr=R.get(Fe),Ut=je,Ut.setIndex(mr)),me.isMesh)ge.wireframe===!0?(Q.setLineWidth(ge.wireframeLinewidth*W()),Ut.setMode(ce.LINES)):Ut.setMode(ce.TRIANGLES);else if(me.isLine){let Jt=ge.linewidth;Jt===void 0&&(Jt=1),Q.setLineWidth(Jt*W()),me.isLineSegments?Ut.setMode(ce.LINES):me.isLineLoop?Ut.setMode(ce.LINE_LOOP):Ut.setMode(ce.LINE_STRIP)}else me.isPoints?Ut.setMode(ce.POINTS):me.isSprite&&Ut.setMode(ce.TRIANGLES);if(me.isBatchedMesh)me._multiDrawInstances!==null?Ut.renderMultiDrawInstances(me._multiDrawStarts,me._multiDrawCounts,me._multiDrawCount,me._multiDrawInstances):Ut.renderMultiDraw(me._multiDrawStarts,me._multiDrawCounts,me._multiDrawCount);else if(me.isInstancedMesh)Ut.renderInstances(wt,Ms,me.count);else if(pe.isInstancedBufferGeometry){const Jt=pe._maxInstanceCount!==void 0?pe._maxInstanceCount:1/0,ws=Math.min(pe.instanceCount,Jt);Ut.renderInstances(wt,Ms,ws)}else Ut.render(wt,Ms)},this.compile=function(H,le,pe=null){pe===null&&(pe=H),m=de.get(pe),m.init(le),_.push(m),pe.traverseVisible(function(me){me.isLight&&me.layers.test(le.layers)&&(m.pushLight(me),me.castShadow&&m.pushShadow(me))}),H!==pe&&H.traverseVisible(function(me){me.isLight&&me.layers.test(le.layers)&&(m.pushLight(me),me.castShadow&&m.pushShadow(me))}),m.setupLights(y._useLegacyLights);const ge=new Set;return H.traverse(function(me){const Ee=me.material;if(Ee)if(Array.isArray(Ee))for(let De=0;De<Ee.length;De++){const Le=Ee[De];Ks(Le,pe,me),ge.add(Le)}else Ks(Ee,pe,me),ge.add(Ee)}),_.pop(),m=null,ge},this.compileAsync=function(H,le,pe=null){const ge=this.compile(H,le,pe);return new Promise(me=>{function Ee(){ge.forEach(function(De){w.get(De).currentProgram.isReady()&&ge.delete(De)}),ge.size!==0?setTimeout(Ee,10):me(H)}$.get("KHR_parallel_shader_compile")!==null?Ee():setTimeout(Ee,10)})};let Qs=null;function $0(){ja.stop()}function J0(){ja.start()}const ja=new xx;function ev(H,le,pe,ge){if(H.visible===!1)return;if(H.layers.test(le.layers)){if(H.isGroup)pe=H.renderOrder;else if(H.isLOD)H.autoUpdate===!0&&H.update(le);else if(H.isLight)m.pushLight(H),H.castShadow&&m.pushShadow(H);else if(H.isSprite){if(!H.frustumCulled||ae.intersectsSprite(H)){ge&&ne.setFromMatrixPosition(H.matrixWorld).applyMatrix4(ee);const Ee=z.update(H),De=H.material;De.visible&&g.push(H,Ee,De,pe,ne.z,null)}}else if((H.isMesh||H.isLine||H.isPoints)&&(!H.frustumCulled||ae.intersectsObject(H))){const Ee=z.update(H),De=H.material;if(ge&&(H.boundingSphere!==void 0?(H.boundingSphere===null&&H.computeBoundingSphere(),ne.copy(H.boundingSphere.center)):(Ee.boundingSphere===null&&Ee.computeBoundingSphere(),ne.copy(Ee.boundingSphere.center)),ne.applyMatrix4(H.matrixWorld).applyMatrix4(ee)),Array.isArray(De)){const Le=Ee.groups;for(let Fe=0,Ze=Le.length;Fe<Ze;Fe++){const ot=Le[Fe],rt=De[ot.materialIndex];rt&&rt.visible&&g.push(H,Ee,rt,pe,ne.z,ot)}}else De.visible&&g.push(H,Ee,De,pe,ne.z,null)}}const me=H.children;for(let Ee=0,De=me.length;Ee<De;Ee++)ev(me[Ee],le,pe,ge)}function tv(H,le,pe,ge){const me=H.opaque,Ee=H.transmissive,De=H.transparent;m.setupLightsView(pe),O===!0&&ue.setGlobalState(y.clippingPlanes,pe),ge&&Q.viewport(U.copy(ge)),me.length>0&&bh(me,le,pe),Ee.length>0&&bh(Ee,le,pe),De.length>0&&bh(De,le,pe),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function iv(H,le,pe,ge){if((pe.isScene===!0?pe.overrideMaterial:null)!==null)return;m.state.transmissionRenderTarget[ge.id]===void 0&&(m.state.transmissionRenderTarget[ge.id]=new pt(1,1,{generateMipmaps:!0,type:$.has("EXT_color_buffer_half_float")||$.has("EXT_color_buffer_float")?Yt:Fn,minFilter:hs,samples:4,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));const me=m.state.transmissionRenderTarget[ge.id],Ee=ge.viewport||U;me.setSize(Ee.z,Ee.w);const De=y.getRenderTarget();y.setRenderTarget(me),y.getClearColor(I),S=y.getClearAlpha(),S<1&&y.setClearColor(16777215,.5),y.clear();const Le=y.toneMapping;y.toneMapping=cs;const Fe=ge.viewport;if(ge.viewport!==void 0&&(ge.viewport=void 0),m.setupLightsView(ge),O===!0&&ue.setGlobalState(y.clippingPlanes,ge),bh(H,pe,ge),G.updateMultisampleRenderTarget(me),G.updateRenderTargetMipmap(me),$.has("WEBGL_multisampled_render_to_texture")===!1){let Ze=!1;for(let ot=0,rt=le.length;ot<rt;ot++){const wt=le[ot],pr=wt.object,Ms=wt.geometry,mr=wt.material,Ut=wt.group;if(mr.side===Rt&&pr.layers.test(ge.layers)){const Jt=mr.side;mr.side=Ri,mr.needsUpdate=!0,rv(pr,pe,ge,Ms,mr,Ut),mr.side=Jt,mr.needsUpdate=!0,Ze=!0}}Ze===!0&&(G.updateMultisampleRenderTarget(me),G.updateRenderTargetMipmap(me))}y.setRenderTarget(De),y.setClearColor(I,S),Fe!==void 0&&(ge.viewport=Fe),y.toneMapping=Le}function bh(H,le,pe){const ge=le.isScene===!0?le.overrideMaterial:null;for(let me=0,Ee=H.length;me<Ee;me++){const De=H[me],Le=De.object,Fe=De.geometry,Ze=ge===null?De.material:ge,ot=De.group;Le.layers.test(pe.layers)&&rv(Le,le,pe,Fe,Ze,ot)}}function rv(H,le,pe,ge,me,Ee){H.onBeforeRender(y,le,pe,ge,me,Ee),H.modelViewMatrix.multiplyMatrices(pe.matrixWorldInverse,H.matrixWorld),H.normalMatrix.getNormalMatrix(H.modelViewMatrix),me.onBeforeRender(y,le,pe,ge,H,Ee),me.transparent===!0&&me.side===Rt&&me.forceSinglePass===!1?(me.side=Ri,me.needsUpdate=!0,y.renderBufferDirect(pe,le,ge,me,H,Ee),me.side=Er,me.needsUpdate=!0,y.renderBufferDirect(pe,le,ge,me,H,Ee),me.side=Rt):y.renderBufferDirect(pe,le,ge,me,H,Ee),H.onAfterRender(y,le,pe,ge,me,Ee)}function Mh(H,le,pe){le.isScene!==!0&&(le=K);const ge=w.get(H),me=m.state.lights,Ee=m.state.shadowsArray,De=me.state.version,Le=Y.getParameters(H,me.state,Ee,le,pe),Fe=Y.getProgramCacheKey(Le);let Ze=ge.programs;ge.environment=H.isMeshStandardMaterial?le.environment:null,ge.fog=le.fog,ge.envMap=(H.isMeshStandardMaterial?F:Z).get(H.envMap||ge.environment),ge.envMapRotation=ge.environment!==null&&H.envMap===null?le.environmentRotation:H.envMapRotation,Ze===void 0&&(H.addEventListener("dispose",wl),Ze=new Map,ge.programs=Ze);let ot=Ze.get(Fe);if(ot!==void 0){if(ge.currentProgram===ot&&ge.lightsStateVersion===De)return av(H,Le),ot}else Le.uniforms=Y.getUniforms(H),H.onBuild(pe,Le,y),H.onBeforeCompile(Le,y),ot=Y.acquireProgram(Le,Fe),Ze.set(Fe,ot),ge.uniforms=Le.uniforms;const rt=ge.uniforms;return(H.isShaderMaterial||H.isRawShaderMaterial)&&H.clipping!==!0||(rt.clippingPlanes=ue.uniform),av(H,Le),ge.needsLights=function(wt){return wt.isMeshLambertMaterial||wt.isMeshToonMaterial||wt.isMeshPhongMaterial||wt.isMeshStandardMaterial||wt.isShadowMaterial||wt.isShaderMaterial&&wt.lights===!0}(H),ge.lightsStateVersion=De,ge.needsLights&&(rt.ambientLightColor.value=me.state.ambient,rt.lightProbe.value=me.state.probe,rt.directionalLights.value=me.state.directional,rt.directionalLightShadows.value=me.state.directionalShadow,rt.spotLights.value=me.state.spot,rt.spotLightShadows.value=me.state.spotShadow,rt.rectAreaLights.value=me.state.rectArea,rt.ltc_1.value=me.state.rectAreaLTC1,rt.ltc_2.value=me.state.rectAreaLTC2,rt.pointLights.value=me.state.point,rt.pointLightShadows.value=me.state.pointShadow,rt.hemisphereLights.value=me.state.hemi,rt.directionalShadowMap.value=me.state.directionalShadowMap,rt.directionalShadowMatrix.value=me.state.directionalShadowMatrix,rt.spotShadowMap.value=me.state.spotShadowMap,rt.spotLightMatrix.value=me.state.spotLightMatrix,rt.spotLightMap.value=me.state.spotLightMap,rt.pointShadowMap.value=me.state.pointShadowMap,rt.pointShadowMatrix.value=me.state.pointShadowMatrix),ge.currentProgram=ot,ge.uniformsList=null,ot}function sv(H){if(H.uniformsList===null){const le=H.currentProgram.getUniforms();H.uniformsList=Ju.seqWithValue(le.seq,H.uniforms)}return H.uniformsList}function av(H,le){const pe=w.get(H);pe.outputColorSpace=le.outputColorSpace,pe.batching=le.batching,pe.instancing=le.instancing,pe.instancingColor=le.instancingColor,pe.instancingMorph=le.instancingMorph,pe.skinning=le.skinning,pe.morphTargets=le.morphTargets,pe.morphNormals=le.morphNormals,pe.morphColors=le.morphColors,pe.morphTargetsCount=le.morphTargetsCount,pe.numClippingPlanes=le.numClippingPlanes,pe.numIntersection=le.numClipIntersection,pe.vertexAlphas=le.vertexAlphas,pe.vertexTangents=le.vertexTangents,pe.toneMapping=le.toneMapping}ja.setAnimationLoop(function(H){Qs&&Qs(H)}),typeof self<"u"&&ja.setContext(self),this.setAnimationLoop=function(H){Qs=H,Et.setAnimationLoop(H),H===null?ja.stop():ja.start()},Et.addEventListener("sessionstart",$0),Et.addEventListener("sessionend",J0),this.render=function(H,le){if(le!==void 0&&le.isCamera!==!0||x===!0)return;H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),le.parent===null&&le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),Et.enabled===!0&&Et.isPresenting===!0&&(Et.cameraAutoUpdate===!0&&Et.updateCamera(le),le=Et.getCamera()),H.isScene===!0&&H.onBeforeRender(y,H,le,T),m=de.get(H,_.length),m.init(le),_.push(m),ee.multiplyMatrices(le.projectionMatrix,le.matrixWorldInverse),ae.setFromProjectionMatrix(ee),D=this.localClippingEnabled,O=ue.init(this.clippingPlanes,D),g=he.get(H,v.length),g.init(),v.push(g),ev(H,le,0,y.sortObjects),g.finish(),y.sortObjects===!0&&g.sort(te,ie);const pe=Et.enabled===!1||Et.isPresenting===!1||Et.hasDepthSensing()===!1;pe&&Ne.addToRenderList(g,H),this.info.render.frame++,O===!0&&ue.beginShadows();const ge=m.state.shadowsArray;we.render(ge,H,le),O===!0&&ue.endShadows(),this.info.autoReset===!0&&this.info.reset();const me=g.opaque,Ee=g.transmissive;if(m.setupLights(y._useLegacyLights),le.isArrayCamera){const De=le.cameras;if(Ee.length>0)for(let Le=0,Fe=De.length;Le<Fe;Le++)iv(me,Ee,H,De[Le]);pe&&Ne.render(H);for(let Le=0,Fe=De.length;Le<Fe;Le++){const Ze=De[Le];tv(g,H,Ze,Ze.viewport)}}else Ee.length>0&&iv(me,Ee,H,le),pe&&Ne.render(H),tv(g,H,le);T!==null&&(G.updateMultisampleRenderTarget(T),G.updateRenderTargetMipmap(T)),H.isScene===!0&&H.onAfterRender(y,H,le),It.resetDefaultState(),A=-1,L=null,_.pop(),_.length>0?(m=_[_.length-1],O===!0&&ue.setGlobalState(y.clippingPlanes,m.state.camera)):m=null,v.pop(),g=v.length>0?v[v.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(H,le,pe){w.get(H.texture).__webglTexture=le,w.get(H.depthTexture).__webglTexture=pe;const ge=w.get(H);ge.__hasExternalTextures=!0,ge.__autoAllocateDepthBuffer=pe===void 0,ge.__autoAllocateDepthBuffer||$.has("WEBGL_multisampled_render_to_texture")===!0&&(ge.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(H,le){const pe=w.get(H);pe.__webglFramebuffer=le,pe.__useDefaultFramebuffer=le===void 0},this.setRenderTarget=function(H,le=0,pe=0){T=H,b=le,M=pe;let ge=!0,me=null,Ee=!1,De=!1;if(H){const Le=w.get(H);Le.__useDefaultFramebuffer!==void 0?(Q.bindFramebuffer(ce.FRAMEBUFFER,null),ge=!1):Le.__webglFramebuffer===void 0?G.setupRenderTarget(H):Le.__hasExternalTextures&&G.rebindTextures(H,w.get(H.texture).__webglTexture,w.get(H.depthTexture).__webglTexture);const Fe=H.texture;(Fe.isData3DTexture||Fe.isDataArrayTexture||Fe.isCompressedArrayTexture)&&(De=!0);const Ze=w.get(H).__webglFramebuffer;H.isWebGLCubeRenderTarget?(me=Array.isArray(Ze[le])?Ze[le][pe]:Ze[le],Ee=!0):me=H.samples>0&&G.useMultisampledRTT(H)===!1?w.get(H).__webglMultisampledFramebuffer:Array.isArray(Ze)?Ze[pe]:Ze,U.copy(H.viewport),P.copy(H.scissor),E=H.scissorTest}else U.copy(fe).multiplyScalar(X).floor(),P.copy(B).multiplyScalar(X).floor(),E=j;if(Q.bindFramebuffer(ce.FRAMEBUFFER,me)&&ge&&Q.drawBuffers(H,me),Q.viewport(U),Q.scissor(P),Q.setScissorTest(E),Ee){const Le=w.get(H.texture);ce.framebufferTexture2D(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_CUBE_MAP_POSITIVE_X+le,Le.__webglTexture,pe)}else if(De){const Le=w.get(H.texture),Fe=le||0;ce.framebufferTextureLayer(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,Le.__webglTexture,pe||0,Fe)}A=-1},this.readRenderTargetPixels=function(H,le,pe,ge,me,Ee,De){if(!H||!H.isWebGLRenderTarget)return;let Le=w.get(H).__webglFramebuffer;if(H.isWebGLCubeRenderTarget&&De!==void 0&&(Le=Le[De]),Le){Q.bindFramebuffer(ce.FRAMEBUFFER,Le);try{const Fe=H.texture,Ze=Fe.format,ot=Fe.type;if(!k.textureFormatReadable(Ze)||!k.textureTypeReadable(ot))return;le>=0&&le<=H.width-ge&&pe>=0&&pe<=H.height-me&&ce.readPixels(le,pe,ge,me,Je.convert(Ze),Je.convert(ot),Ee)}finally{const Fe=T!==null?w.get(T).__webglFramebuffer:null;Q.bindFramebuffer(ce.FRAMEBUFFER,Fe)}}},this.copyFramebufferToTexture=function(H,le,pe=0){const ge=Math.pow(2,-pe),me=Math.floor(le.image.width*ge),Ee=Math.floor(le.image.height*ge);G.setTexture2D(le,0),ce.copyTexSubImage2D(ce.TEXTURE_2D,pe,0,0,H.x,H.y,me,Ee),Q.unbindTexture()},this.copyTextureToTexture=function(H,le,pe,ge=0){const me=le.image.width,Ee=le.image.height,De=Je.convert(pe.format),Le=Je.convert(pe.type);G.setTexture2D(pe,0),ce.pixelStorei(ce.UNPACK_FLIP_Y_WEBGL,pe.flipY),ce.pixelStorei(ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),ce.pixelStorei(ce.UNPACK_ALIGNMENT,pe.unpackAlignment),le.isDataTexture?ce.texSubImage2D(ce.TEXTURE_2D,ge,H.x,H.y,me,Ee,De,Le,le.image.data):le.isCompressedTexture?ce.compressedTexSubImage2D(ce.TEXTURE_2D,ge,H.x,H.y,le.mipmaps[0].width,le.mipmaps[0].height,De,le.mipmaps[0].data):ce.texSubImage2D(ce.TEXTURE_2D,ge,H.x,H.y,De,Le,le.image),ge===0&&pe.generateMipmaps&&ce.generateMipmap(ce.TEXTURE_2D),Q.unbindTexture()},this.copyTextureToTexture3D=function(H,le,pe,ge,me=0){const Ee=H.max.x-H.min.x,De=H.max.y-H.min.y,Le=H.max.z-H.min.z,Fe=Je.convert(ge.format),Ze=Je.convert(ge.type);let ot;if(ge.isData3DTexture)G.setTexture3D(ge,0),ot=ce.TEXTURE_3D;else{if(!ge.isDataArrayTexture&&!ge.isCompressedArrayTexture)return;G.setTexture2DArray(ge,0),ot=ce.TEXTURE_2D_ARRAY}ce.pixelStorei(ce.UNPACK_FLIP_Y_WEBGL,ge.flipY),ce.pixelStorei(ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ge.premultiplyAlpha),ce.pixelStorei(ce.UNPACK_ALIGNMENT,ge.unpackAlignment);const rt=ce.getParameter(ce.UNPACK_ROW_LENGTH),wt=ce.getParameter(ce.UNPACK_IMAGE_HEIGHT),pr=ce.getParameter(ce.UNPACK_SKIP_PIXELS),Ms=ce.getParameter(ce.UNPACK_SKIP_ROWS),mr=ce.getParameter(ce.UNPACK_SKIP_IMAGES),Ut=pe.isCompressedTexture?pe.mipmaps[me]:pe.image;ce.pixelStorei(ce.UNPACK_ROW_LENGTH,Ut.width),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,Ut.height),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,H.min.x),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,H.min.y),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,H.min.z),pe.isDataTexture||pe.isData3DTexture?ce.texSubImage3D(ot,me,le.x,le.y,le.z,Ee,De,Le,Fe,Ze,Ut.data):ge.isCompressedArrayTexture?ce.compressedTexSubImage3D(ot,me,le.x,le.y,le.z,Ee,De,Le,Fe,Ut.data):ce.texSubImage3D(ot,me,le.x,le.y,le.z,Ee,De,Le,Fe,Ze,Ut),ce.pixelStorei(ce.UNPACK_ROW_LENGTH,rt),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,wt),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,pr),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,Ms),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,mr),me===0&&ge.generateMipmaps&&ce.generateMipmap(ot),Q.unbindTexture()},this.initTexture=function(H){H.isCubeTexture?G.setTextureCube(H,0):H.isData3DTexture?G.setTexture3D(H,0):H.isDataArrayTexture||H.isCompressedArrayTexture?G.setTexture2DArray(H,0):G.setTexture2D(H,0),Q.unbindTexture()},this.resetState=function(){b=0,M=0,T=null,Q.reset(),It.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Hn}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===ip?"display-p3":"srgb",t.unpackColorSpace=ct.workingColorSpace===nh?"display-p3":"srgb"}get useLegacyLights(){return this._useLegacyLights}set useLegacyLights(e){this._useLegacyLights=e}}class sl{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ve(e),this.density=t}clone(){return new sl(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class al{constructor(e,t=1,r=1e3){this.isFog=!0,this.name="",this.color=new ve(e),this.near=t,this.far=r}clone(){return new al(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class qf extends Ve{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ct,this.environmentIntensity=1,this.environmentRotation=new Ct,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class ch{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Cc,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=hr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return px("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let s=0,a=this.stride;s<a;s++)this.array[e+s]=t.array[r+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=hr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=hr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Di=new C;class qi{constructor(e,t,r,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)Di.fromBufferAttribute(this,t),Di.applyMatrix4(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Di.fromBufferAttribute(this,t),Di.applyNormalMatrix(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Di.fromBufferAttribute(this,t),Di.transformDirection(e),this.setXYZ(t,Di.x,Di.y,Di.z);return this}getComponent(e,t){let r=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(r=zi(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Be(r,this.array)),this.data.array[e*this.data.stride+this.offset+t]=r,this}setX(e,t){return this.normalized&&(t=Be(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Be(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Be(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Be(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=zi(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=zi(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=zi(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=zi(t,this.array)),t}setXY(e,t,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Be(t,this.array),r=Be(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Be(t,this.array),r=Be(r,this.array),s=Be(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=s,this}setXYZW(e,t,r,s,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=Be(t,this.array),r=Be(r,this.array),s=Be(s,this.array),a=Be(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=s,this.data.array[e+3]=a,this}clone(e){if(e===void 0){const t=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[s+a])}return new Ke(new this.array.constructor(t),this.itemSize,this.normalized)}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new qi(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){const t=[];for(let r=0;r<this.count;r++){const s=r*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[s+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class t0 extends $t{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ve(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let vo;const Rl=new C,_o=new C,yo=new C,xo=new se,Il=new se,Px=new Me,qh=new C,Ll=new C,Yh=new C,t_=new se,sm=new se,i_=new se;class r_ extends Ve{constructor(e=new t0){if(super(),this.isSprite=!0,this.type="Sprite",vo===void 0){vo=new Ie;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new ch(t,5);vo.setIndex([0,1,2,0,2,3]),vo.setAttribute("position",new qi(r,3,0,!1)),vo.setAttribute("uv",new qi(r,2,3,!1))}this.geometry=vo,this.material=e,this.center=new se(.5,.5)}raycast(e,t){e.camera,_o.setFromMatrixScale(this.matrixWorld),Px.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),yo.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_o.multiplyScalar(-yo.z);const r=this.material.rotation;let s,a;r!==0&&(a=Math.cos(r),s=Math.sin(r));const n=this.center;Zh(qh.set(-.5,-.5,0),yo,n,_o,s,a),Zh(Ll.set(.5,-.5,0),yo,n,_o,s,a),Zh(Yh.set(.5,.5,0),yo,n,_o,s,a),t_.set(0,0),sm.set(1,0),i_.set(1,1);let o=e.ray.intersectTriangle(qh,Ll,Yh,!1,Rl);if(o===null&&(Zh(Ll.set(-.5,.5,0),yo,n,_o,s,a),sm.set(0,1),o=e.ray.intersectTriangle(qh,Yh,Ll,!1,Rl),o===null))return;const l=e.ray.origin.distanceTo(Rl);l<e.near||l>e.far||t.push({distance:l,point:Rl.clone(),uv:nr.getInterpolation(Rl,qh,Ll,Yh,t_,sm,i_,new se),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Zh(i,e,t,r,s,a){xo.subVectors(i,t).addScalar(.5).multiply(r),s!==void 0?(Il.x=a*xo.x-s*xo.y,Il.y=s*xo.x+a*xo.y):Il.copy(xo),i.copy(e),i.x+=Il.x,i.y+=Il.y,i.applyMatrix4(Px)}const Kh=new C,s_=new C;class a_ extends Ve{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let r=0,s=t.length;r<s;r++){const a=t[r];this.addLevel(a.object.clone(),a.distance,a.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,r=0){t=Math.abs(t);const s=this.levels;let a;for(a=0;a<s.length&&!(t<s[a].distance);a++);return s.splice(a,0,{distance:t,hysteresis:r,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let r,s;for(r=1,s=t.length;r<s;r++){let a=t[r].distance;if(t[r].object.visible&&(a-=a*t[r].hysteresis),e<a)break}return t[r-1].object}return null}raycast(e,t){if(this.levels.length>0){Kh.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(Kh);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Kh.setFromMatrixPosition(e.matrixWorld),s_.setFromMatrixPosition(this.matrixWorld);const r=Kh.distanceTo(s_)/e.zoom;let s,a;for(t[0].object.visible=!0,s=1,a=t.length;s<a;s++){let n=t[s].distance;if(t[s].object.visible&&(n-=n*t[s].hysteresis),!(r>=n))break;t[s-1].object.visible=!1,t[s].object.visible=!0}for(this._currentLevel=s-1;s<a;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const r=this.levels;for(let s=0,a=r.length;s<a;s++){const n=r[s];t.object.levels.push({object:n.object.uuid,distance:n.distance,hysteresis:n.hysteresis})}return t}}const n_=new C,o_=new qe,l_=new qe,gT=new C,c_=new Me,Qh=new C,am=new oi,h_=new Me,nm=new Kn;class ud extends ye{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=ff,this.bindMatrix=new Me,this.bindMatrixInverse=new Me,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Tt),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,Qh),this.boundingBox.expandByPoint(Qh)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new oi),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let r=0;r<t.count;r++)this.getVertexPosition(r,Qh),this.boundingSphere.expandByPoint(Qh)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const r=this.material,s=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),am.copy(this.boundingSphere),am.applyMatrix4(s),e.ray.intersectsSphere(am)!==!1&&(h_.copy(s).invert(),nm.copy(e.ray).applyMatrix4(h_),this.boundingBox!==null&&nm.intersectsBox(this.boundingBox)===!1||this._computeIntersections(e,t,nm)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new qe,t=this.geometry.attributes.skinWeight;for(let r=0,s=t.count;r<s;r++){e.fromBufferAttribute(t,r);const a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===ff?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===cx&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}applyBoneTransform(e,t){const r=this.skeleton,s=this.geometry;o_.fromBufferAttribute(s.attributes.skinIndex,e),l_.fromBufferAttribute(s.attributes.skinWeight,e),n_.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let a=0;a<4;a++){const n=l_.getComponent(a);if(n!==0){const o=o_.getComponent(a);c_.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),t.addScaledVector(gT.copy(n_).applyMatrix4(c_),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}class nl extends Ve{constructor(){super(),this.isBone=!0,this.type="Bone"}}class pa extends yt{constructor(e=null,t=1,r=1,s,a,n,o,l,c=1003,h=1003,u,d){super(null,n,o,l,c,h,s,a,u,d),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const u_=new Me,vT=new Me;class ol{constructor(e=[],t=[]){this.uuid=hr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),t.length===0)this.calculateInverses();else if(e.length!==t.length){this.boneInverses=[];for(let r=0,s=this.bones.length;r<s;r++)this.boneInverses.push(new Me)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const r=new Me;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,t=this.boneInverses,r=this.boneMatrices,s=this.boneTexture;for(let a=0,n=e.length;a<n;a++){const o=e[a]?e[a].matrixWorld:vT;u_.multiplyMatrices(o,t[a]),u_.toArray(r,16*a)}s!==null&&(s.needsUpdate=!0)}clone(){return new ol(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const r=new pa(t,e,e,Hr,wr);return r.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=r,this}getBoneByName(e){for(let t=0,r=this.bones.length;t<r;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let r=0,s=e.bones.length;r<s;r++){let a=t[e.bones[r]];a===void 0&&(a=new nl),this.bones.push(a),this.boneInverses.push(new Me().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,r=this.boneInverses;for(let s=0,a=t.length;s<a;s++){const n=t[s];e.bones.push(n.uuid);const o=r[s];e.boneInverses.push(o.toArray())}return e}}class Pn extends Ke{constructor(e,t,r,s=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const bo=new Me,d_=new Me,$h=[],p_=new Tt,_T=new Me,Dl=new ye,Ol=new oi;class Yf extends ye{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Pn(new Float32Array(16*r),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<r;s++)this.setMatrixAt(s,_T)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Tt),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,bo),p_.copy(e.boundingBox).applyMatrix4(bo),this.boundingBox.union(p_)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new oi),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,bo),Ol.copy(e.boundingSphere).applyMatrix4(bo),this.boundingSphere.union(Ol)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const r=t.morphTargetInfluences,s=this.morphTexture.source.data.data,a=e*(r.length+1)+1;for(let n=0;n<r.length;n++)r[n]=s[a+n]}raycast(e,t){const r=this.matrixWorld,s=this.count;if(Dl.geometry=this.geometry,Dl.material=this.material,Dl.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Ol.copy(this.boundingSphere),Ol.applyMatrix4(r),e.ray.intersectsSphere(Ol)!==!1))for(let a=0;a<s;a++){this.getMatrixAt(a,bo),d_.multiplyMatrices(r,bo),Dl.matrixWorld=d_,Dl.raycast(e,$h);for(let n=0,o=$h.length;n<o;n++){const l=$h[n];l.instanceId=a,l.object=this,t.push(l)}$h.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Pn(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const r=t.morphTargetInfluences,s=r.length+1;this.morphTexture===null&&(this.morphTexture=new pa(new Float32Array(s*this.count),s,this.count,jg,wr));const a=this.morphTexture.source.data.data;let n=0;for(let c=0;c<r.length;c++)n+=r[c];const o=this.geometry.morphTargetsRelative?1:1-n,l=s*e;a[l]=o,a.set(r,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function yT(i,e){return i.z-e.z}function xT(i,e){return e.z-i.z}class bT{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t){const r=this.pool,s=this.list;this.index>=r.length&&r.push({start:-1,count:-1,z:-1});const a=r[this.index];s.push(a),this.index++,a.start=e.start,a.count=e.count,a.z=t}reset(){this.list.length=0,this.index=0}}const Mo="batchId",aa=new Me,m_=new Me,MT=new Me,f_=new Me,om=new oh,Jh=new Tt,$a=new oi,Nl=new C,lm=new bT,Ei=new ye,eu=[];function wT(i,e,t=0){const r=e.itemSize;if(i.isInterleavedBufferAttribute||i.array.constructor!==e.array.constructor){const s=i.count;for(let a=0;a<s;a++)for(let n=0;n<r;n++)e.setComponent(a+t,n,i.getComponent(a,n))}else e.array.set(i.array,t*r);e.needsUpdate=!0}class g_ extends ye{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,t,r=2*t,s){super(new Ie,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=t,this._maxIndexCount=r,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture()}_initMatricesTexture(){let e=Math.sqrt(4*this._maxGeometryCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),r=new pa(t,e,e,Hr,wr);this._matricesTexture=r}_initializeGeometry(e){const t=this.geometry,r=this._maxVertexCount,s=this._maxGeometryCount,a=this._maxIndexCount;if(this._geometryInitialized===!1){for(const o in e.attributes){const l=e.getAttribute(o),{array:c,itemSize:h,normalized:u}=l,d=new c.constructor(r*h),p=new Ke(d,h,u);t.setAttribute(o,p)}if(e.getIndex()!==null){const o=r>65536?new Uint32Array(a):new Uint16Array(a);t.setIndex(new Ke(o,1))}const n=s>65536?new Uint32Array(r):new Uint16Array(r);t.setAttribute(Mo,new Ke(n,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(Mo))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Mo}"`);const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const r in t.attributes){if(r===Mo)continue;if(!e.hasAttribute(r))throw new Error(`BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const s=e.getAttribute(r),a=t.getAttribute(r);if(s.itemSize!==a.itemSize||s.normalized!==a.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tt);const e=this._geometryCount,t=this.boundingBox,r=this._active;t.makeEmpty();for(let s=0;s<e;s++)r[s]!==!1&&(this.getMatrixAt(s,aa),this.getBoundingBoxAt(s,Jh).applyMatrix4(aa),t.union(Jh))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new oi);const e=this._geometryCount,t=this.boundingSphere,r=this._active;t.makeEmpty();for(let s=0;s<e;s++)r[s]!==!1&&(this.getMatrixAt(s,aa),this.getBoundingSphereAt(s,$a).applyMatrix4(aa),t.union($a))}addGeometry(e,t=-1,r=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const s={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let a=null;const n=this._reservedRanges,o=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(a=n[n.length-1]),s.vertexCount=t===-1?e.getAttribute("position").count:t,s.vertexStart=a===null?0:a.vertexStart+a.vertexCount;const c=e.getIndex(),h=c!==null;if(h&&(s.indexCount=r===-1?c.count:r,s.indexStart=a===null?0:a.indexStart+a.indexCount),s.indexStart!==-1&&s.indexStart+s.indexCount>this._maxIndexCount||s.vertexStart+s.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const u=this._visibility,d=this._active,p=this._matricesTexture,f=this._matricesTexture.image.data;u.push(!0),d.push(!0);const g=this._geometryCount;this._geometryCount++,MT.toArray(f,16*g),p.needsUpdate=!0,n.push(s),o.push({start:h?s.indexStart:s.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new Tt,sphereInitialized:!1,sphere:new oi});const m=this.geometry.getAttribute(Mo);for(let v=0;v<s.vertexCount;v++)m.setX(s.vertexStart+v,g);return m.needsUpdate=!0,this.setGeometryAt(g,e),g}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const r=this.geometry,s=r.getIndex()!==null,a=r.getIndex(),n=t.getIndex(),o=this._reservedRanges[e];if(s&&n.count>o.indexCount||t.attributes.position.count>o.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.vertexCount;for(const p in r.attributes){if(p===Mo)continue;const f=t.getAttribute(p),g=r.getAttribute(p);wT(f,g,l);const m=f.itemSize;for(let v=f.count,_=c;v<_;v++){const y=l+v;for(let x=0;x<m;x++)g.setComponent(y,x,0)}g.needsUpdate=!0,g.addUpdateRange(l*m,c*m)}if(s){const p=o.indexStart;for(let f=0;f<n.count;f++)a.setX(p+f,l+n.getX(f));for(let f=n.count,g=o.indexCount;f<g;f++)a.setX(p+f,l);a.needsUpdate=!0,a.addUpdateRange(p,o.indexCount)}const h=this._bounds[e];t.boundingBox!==null?(h.box.copy(t.boundingBox),h.boxInitialized=!0):h.boxInitialized=!1,t.boundingSphere!==null?(h.sphere.copy(t.boundingSphere),h.sphereInitialized=!0):h.sphereInitialized=!1;const u=this._drawRanges[e],d=t.getAttribute("position");return u.count=s?n.count:d.count,this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._active;return e>=t.length||t[e]===!1||(t[e]=!1,this._visibilityChanged=!0),this}getInstanceCountAt(e){return this._multiDrawInstances===null?null:this._multiDrawInstances[e]}setInstanceCountAt(e,t){return this._multiDrawInstances===null&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[e]=t,e}getBoundingBoxAt(e,t){if(this._active[e]===!1)return null;const r=this._bounds[e],s=r.box,a=this.geometry;if(r.boxInitialized===!1){s.makeEmpty();const n=a.index,o=a.attributes.position,l=this._drawRanges[e];for(let c=l.start,h=l.start+l.count;c<h;c++){let u=c;n&&(u=n.getX(u)),s.expandByPoint(Nl.fromBufferAttribute(o,u))}r.boxInitialized=!0}return t.copy(s),t}getBoundingSphereAt(e,t){if(this._active[e]===!1)return null;const r=this._bounds[e],s=r.sphere,a=this.geometry;if(r.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(e,Jh),Jh.getCenter(s.center);const n=a.index,o=a.attributes.position,l=this._drawRanges[e];let c=0;for(let h=l.start,u=l.start+l.count;h<u;h++){let d=h;n&&(d=n.getX(d)),Nl.fromBufferAttribute(o,d),c=Math.max(c,s.center.distanceToSquared(Nl))}s.radius=Math.sqrt(c),r.sphereInitialized=!0}return t.copy(s),t}setMatrixAt(e,t){const r=this._active,s=this._matricesTexture,a=this._matricesTexture.image.data;return e>=this._geometryCount||r[e]===!1||(t.toArray(a,16*e),s.needsUpdate=!0),this}getMatrixAt(e,t){const r=this._active,s=this._matricesTexture.image.data;return e>=this._geometryCount||r[e]===!1?null:t.fromArray(s,16*e)}setVisibleAt(e,t){const r=this._visibility,s=this._active;return e>=this._geometryCount||s[e]===!1||r[e]===t||(r[e]=t,this._visibilityChanged=!0),this}getVisibleAt(e){const t=this._visibility,r=this._active;return!(e>=this._geometryCount||r[e]===!1)&&t[e]}raycast(e,t){const r=this._visibility,s=this._active,a=this._drawRanges,n=this._geometryCount,o=this.matrixWorld,l=this.geometry;Ei.material=this.material,Ei.geometry.index=l.index,Ei.geometry.attributes=l.attributes,Ei.geometry.boundingBox===null&&(Ei.geometry.boundingBox=new Tt),Ei.geometry.boundingSphere===null&&(Ei.geometry.boundingSphere=new oi);for(let c=0;c<n;c++){if(!r[c]||!s[c])continue;const h=a[c];Ei.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(c,Ei.matrixWorld).premultiply(o),this.getBoundingBoxAt(c,Ei.geometry.boundingBox),this.getBoundingSphereAt(c,Ei.geometry.boundingSphere),Ei.raycast(e,eu);for(let u=0,d=eu.length;u<d;u++){const p=eu[u];p.object=this,p.batchId=c,t.push(p)}eu.length=0}Ei.material=null,Ei.geometry.index=null,Ei.geometry.attributes={},Ei.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>Re({},t)),this._reservedRanges=e._reservedRanges.map(t=>Re({},t)),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this}onBeforeRender(e,t,r,s,a){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const n=s.getIndex(),o=n===null?1:n.array.BYTES_PER_ELEMENT,l=this._active,c=this._visibility,h=this._multiDrawStarts,u=this._multiDrawCounts,d=this._drawRanges,p=this.perObjectFrustumCulled;p&&(f_.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),om.setFromProjectionMatrix(f_,e.coordinateSystem));let f=0;if(this.sortObjects){m_.copy(this.matrixWorld).invert(),Nl.setFromMatrixPosition(r.matrixWorld).applyMatrix4(m_);for(let v=0,_=c.length;v<_;v++)if(c[v]&&l[v]){this.getMatrixAt(v,aa),this.getBoundingSphereAt(v,$a).applyMatrix4(aa);let y=!1;if(p&&(y=!om.intersectsSphere($a)),!y){const x=Nl.distanceTo($a.center);lm.push(d[v],x)}}const g=lm.list,m=this.customSort;m===null?g.sort(a.transparent?xT:yT):m.call(this,g,r);for(let v=0,_=g.length;v<_;v++){const y=g[v];h[f]=y.start*o,u[f]=y.count,f++}lm.reset()}else for(let g=0,m=c.length;g<m;g++)if(c[g]&&l[g]){let v=!1;if(p&&(this.getMatrixAt(g,aa),this.getBoundingSphereAt(g,$a).applyMatrix4(aa),v=!om.intersectsSphere($a)),!v){const _=d[g];h[f]=_.start*o,u[f]=_.count,f++}}this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,r,s,a,n){this.onBeforeRender(e,null,s,a,n)}}class Wt extends $t{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ve(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const dd=new C,pd=new C,v_=new Me,Ul=new Kn,tu=new oi,cm=new C,__=new C;class di extends Ve{constructor(e=new Ie,t=new Wt){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[0];for(let s=1,a=t.count;s<a;s++)dd.fromBufferAttribute(t,s-1),pd.fromBufferAttribute(t,s),r[s]=r[s-1],r[s]+=dd.distanceTo(pd);e.setAttribute("lineDistance",new Se(r,1))}return this}raycast(e,t){const r=this.geometry,s=this.matrixWorld,a=e.params.Line.threshold,n=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),tu.copy(r.boundingSphere),tu.applyMatrix4(s),tu.radius+=a,e.ray.intersectsSphere(tu)===!1)return;v_.copy(s).invert(),Ul.copy(e.ray).applyMatrix4(v_);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,h=r.index,u=r.attributes.position;if(h!==null){const d=Math.max(0,n.start),p=Math.min(h.count,n.start+n.count);for(let f=d,g=p-1;f<g;f+=c){const m=h.getX(f),v=h.getX(f+1),_=iu(this,e,Ul,l,m,v);_&&t.push(_)}if(this.isLineLoop){const f=h.getX(p-1),g=h.getX(d),m=iu(this,e,Ul,l,f,g);m&&t.push(m)}}else{const d=Math.max(0,n.start),p=Math.min(u.count,n.start+n.count);for(let f=d,g=p-1;f<g;f+=c){const m=iu(this,e,Ul,l,f,f+1);m&&t.push(m)}if(this.isLineLoop){const f=iu(this,e,Ul,l,p-1,d);f&&t.push(f)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}}function iu(i,e,t,r,s,a){const n=i.geometry.attributes.position;if(dd.fromBufferAttribute(n,s),pd.fromBufferAttribute(n,a),t.distanceSqToSegment(dd,pd,cm,__)>r)return;cm.applyMatrix4(i.matrixWorld);const o=e.ray.origin.distanceTo(cm);return o<e.near||o>e.far?void 0:{distance:o,point:__.clone().applyMatrix4(i.matrixWorld),index:s,face:null,faceIndex:null,object:i}}const y_=new C,x_=new C;class tr extends di{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,r=[];for(let s=0,a=t.count;s<a;s+=2)y_.fromBufferAttribute(t,s),x_.fromBufferAttribute(t,s+1),r[s]=s===0?0:r[s-1],r[s+1]=r[s]+y_.distanceTo(x_);e.setAttribute("lineDistance",new Se(r,1))}return this}}class Zf extends di{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class ga extends $t{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ve(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const b_=new Me,Kf=new Kn,ru=new oi,su=new C;class Ea extends Ve{constructor(e=new Ie,t=new ga){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,s=this.matrixWorld,a=e.params.Points.threshold,n=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),ru.copy(r.boundingSphere),ru.applyMatrix4(s),ru.radius+=a,e.ray.intersectsSphere(ru)===!1)return;b_.copy(s).invert(),Kf.copy(e.ray).applyMatrix4(b_);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,h=r.attributes.position;if(c!==null)for(let u=Math.max(0,n.start),d=Math.min(c.count,n.start+n.count);u<d;u++){const p=c.getX(u);su.fromBufferAttribute(h,p),M_(su,p,l,s,e,t,this)}else for(let u=Math.max(0,n.start),d=Math.min(h.count,n.start+n.count);u<d;u++)su.fromBufferAttribute(h,u),M_(su,u,l,s,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const n=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=s}}}}}function M_(i,e,t,r,s,a,n){const o=Kf.distanceSqToPoint(i);if(o<t){const l=new C;Kf.closestPointToPoint(i,l),l.applyMatrix4(r);const c=s.ray.origin.distanceTo(l);if(c<s.near||c>s.far)return;a.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,object:n})}}class Rx extends yt{constructor(e,t,r,s,a,n,o,l,c){super(e,t,r,s,a,n,o,l,c),this.isVideoTexture=!0,this.minFilter=n!==void 0?n:qt,this.magFilter=a!==void 0?a:qt,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function u(){h.needsUpdate=!0,e.requestVideoFrameCallback(u)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class au extends yt{constructor(e,t,r,s,a,n,o,l,c,h,u,d){super(null,n,o,l,c,h,s,a,u,d),this.isCompressedTexture=!0,this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Cr{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,s=this.getPoint(0),a=0;t.push(0);for(let n=1;n<=e;n++)r=this.getPoint(n/e),a+=r.distanceTo(s),t.push(a),s=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let s=0;const a=r.length;let n;n=t||e*r[a-1];let o,l=0,c=a-1;for(;l<=c;)if(s=Math.floor(l+(c-l)/2),o=r[s]-n,o<0)l=s+1;else{if(!(o>0)){c=s;break}c=s-1}if(s=c,r[s]===n)return s/(a-1);const h=r[s];return(s+(n-h)/(r[s+1]-h))/(a-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const a=this.getPoint(r),n=this.getPoint(s),o=t||(a.isVector2?new se:new C);return o.copy(n).sub(a).normalize(),o}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new C,s=[],a=[],n=[],o=new C,l=new Me;for(let p=0;p<=e;p++){const f=p/e;s[p]=this.getTangentAt(f,new C)}a[0]=new C,n[0]=new C;let c=Number.MAX_VALUE;const h=Math.abs(s[0].x),u=Math.abs(s[0].y),d=Math.abs(s[0].z);h<=c&&(c=h,r.set(1,0,0)),u<=c&&(c=u,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(s[0],r).normalize(),a[0].crossVectors(s[0],o),n[0].crossVectors(s[0],a[0]);for(let p=1;p<=e;p++){if(a[p]=a[p-1].clone(),n[p]=n[p-1].clone(),o.crossVectors(s[p-1],s[p]),o.length()>Number.EPSILON){o.normalize();const f=Math.acos(zt(s[p-1].dot(s[p]),-1,1));a[p].applyMatrix4(l.makeRotationAxis(o,f))}n[p].crossVectors(s[p],a[p])}if(t===!0){let p=Math.acos(zt(a[0].dot(a[e]),-1,1));p/=e,s[0].dot(o.crossVectors(a[0],a[e]))>0&&(p=-p);for(let f=1;f<=e;f++)a[f].applyMatrix4(l.makeRotationAxis(s[f],p*f)),n[f].crossVectors(s[f],a[f])}return{tangents:s,normals:a,binormals:n}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class lp extends Cr{constructor(e=0,t=0,r=1,s=1,a=0,n=2*Math.PI,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=s,this.aStartAngle=a,this.aEndAngle=n,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new se){const r=t,s=2*Math.PI;let a=this.aEndAngle-this.aStartAngle;const n=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=s;for(;a>s;)a-=s;a<Number.EPSILON&&(a=n?0:s),this.aClockwise!==!0||n||(a===s?a=-s:a-=s);const o=this.aStartAngle+e*a;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=l-this.aX,p=c-this.aY;l=d*h-p*u+this.aX,c=d*u+p*h+this.aY}return r.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Ix extends lp{constructor(e,t,r,s,a,n){super(e,t,r,r,s,a,n),this.isArcCurve=!0,this.type="ArcCurve"}}function i0(){let i=0,e=0,t=0,r=0;function s(a,n,o,l){i=a,e=o,t=-3*a+3*n-2*o-l,r=2*a-2*n+o+l}return{initCatmullRom:function(a,n,o,l,c){s(n,o,c*(o-a),c*(l-n))},initNonuniformCatmullRom:function(a,n,o,l,c,h,u){let d=(n-a)/c-(o-a)/(c+h)+(o-n)/h,p=(o-n)/h-(l-n)/(h+u)+(l-o)/u;d*=h,p*=h,s(n,o,d,p)},calc:function(a){const n=a*a;return i+e*a+t*n+r*(n*a)}}}const nu=new C,hm=new i0,um=new i0,dm=new i0;class cp extends Cr{constructor(e=[],t=!1,r="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=s}getPoint(e,t=new C){const r=t,s=this.points,a=s.length,n=(a-(this.closed?0:1))*e;let o,l,c=Math.floor(n),h=n-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/a)+1)*a:h===0&&c===a-1&&(c=a-2,h=1),this.closed||c>0?o=s[(c-1)%a]:(nu.subVectors(s[0],s[1]).add(s[0]),o=nu);const u=s[c%a],d=s[(c+1)%a];if(this.closed||c+2<a?l=s[(c+2)%a]:(nu.subVectors(s[a-1],s[a-2]).add(s[a-1]),l=nu),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let f=Math.pow(o.distanceToSquared(u),p),g=Math.pow(u.distanceToSquared(d),p),m=Math.pow(d.distanceToSquared(l),p);g<1e-4&&(g=1),f<1e-4&&(f=g),m<1e-4&&(m=g),hm.initNonuniformCatmullRom(o.x,u.x,d.x,l.x,f,g,m),um.initNonuniformCatmullRom(o.y,u.y,d.y,l.y,f,g,m),dm.initNonuniformCatmullRom(o.z,u.z,d.z,l.z,f,g,m)}else this.curveType==="catmullrom"&&(hm.initCatmullRom(o.x,u.x,d.x,l.x,this.tension),um.initCatmullRom(o.y,u.y,d.y,l.y,this.tension),dm.initCatmullRom(o.z,u.z,d.z,l.z,this.tension));return r.set(hm.calc(h),um.calc(h),dm.calc(h)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(new C().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function w_(i,e,t,r,s){const a=.5*(r-e),n=.5*(s-t),o=i*i;return(2*t-2*r+a+n)*(i*o)+(-3*t+3*r-2*a-n)*o+a*i+t}function hc(i,e,t,r){return function(s,a){const n=1-s;return n*n*a}(i,e)+function(s,a){return 2*(1-s)*s*a}(i,t)+function(s,a){return s*s*a}(i,r)}function uc(i,e,t,r,s){return function(a,n){const o=1-a;return o*o*o*n}(i,e)+function(a,n){const o=1-a;return 3*o*o*a*n}(i,t)+function(a,n){return 3*(1-a)*a*a*n}(i,r)+function(a,n){return a*a*a*n}(i,s)}class r0 extends Cr{constructor(e=new se,t=new se,r=new se,s=new se){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=s}getPoint(e,t=new se){const r=t,s=this.v0,a=this.v1,n=this.v2,o=this.v3;return r.set(uc(e,s.x,a.x,n.x,o.x),uc(e,s.y,a.y,n.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Lx extends Cr{constructor(e=new C,t=new C,r=new C,s=new C){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=s}getPoint(e,t=new C){const r=t,s=this.v0,a=this.v1,n=this.v2,o=this.v3;return r.set(uc(e,s.x,a.x,n.x,o.x),uc(e,s.y,a.y,n.y,o.y),uc(e,s.z,a.z,n.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class s0 extends Cr{constructor(e=new se,t=new se){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new se){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new se){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Dx extends Cr{constructor(e=new C,t=new C){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new C){const r=t;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new C){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class a0 extends Cr{constructor(e=new se,t=new se,r=new se){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new se){const r=t,s=this.v0,a=this.v1,n=this.v2;return r.set(hc(e,s.x,a.x,n.x),hc(e,s.y,a.y,n.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class n0 extends Cr{constructor(e=new C,t=new C,r=new C){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new C){const r=t,s=this.v0,a=this.v1,n=this.v2;return r.set(hc(e,s.x,a.x,n.x),hc(e,s.y,a.y,n.y),hc(e,s.z,a.z,n.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class o0 extends Cr{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new se){const r=t,s=this.points,a=(s.length-1)*e,n=Math.floor(a),o=a-n,l=s[n===0?n:n-1],c=s[n],h=s[n>s.length-2?s.length-1:n+1],u=s[n>s.length-3?s.length-1:n+2];return r.set(w_(o,l.x,c.x,h.x,u.x),w_(o,l.y,c.y,h.y,u.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const s=e.points[t];this.points.push(new se().fromArray(s))}return this}}var md=Object.freeze({__proto__:null,ArcCurve:Ix,CatmullRomCurve3:cp,CubicBezierCurve:r0,CubicBezierCurve3:Lx,EllipseCurve:lp,LineCurve:s0,LineCurve3:Dx,QuadraticBezierCurve:a0,QuadraticBezierCurve3:n0,SplineCurve:o0});class Ox extends Cr{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new md[r](t,e))}return this}getPoint(e,t){const r=e*this.getLength(),s=this.getCurveLengths();let a=0;for(;a<s.length;){if(s[a]>=r){const n=s[a]-r,o=this.curves[a],l=o.getLength(),c=l===0?0:1-n/l;return o.getPointAt(c,t)}a++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,s=this.curves.length;r<s;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let s=0,a=this.curves;s<a.length;s++){const n=a[s],o=n.isEllipseCurve?2*e:n.isLineCurve||n.isLineCurve3?1:n.isSplineCurve?e*n.points.length:e,l=n.getPoints(o);for(let c=0;c<l.length;c++){const h=l[c];r&&r.equals(h)||(t.push(h),r=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const s=e.curves[t];this.curves.push(new md[s.type]().fromJSON(s))}return this}}class ll extends Ox{constructor(e){super(),this.type="Path",this.currentPoint=new se,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new s0(this.currentPoint.clone(),new se(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,s){const a=new a0(this.currentPoint.clone(),new se(e,t),new se(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}bezierCurveTo(e,t,r,s,a,n){const o=new r0(this.currentPoint.clone(),new se(e,t),new se(r,s),new se(a,n));return this.curves.push(o),this.currentPoint.set(a,n),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new o0(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,s,a,n){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,t+l,r,s,a,n),this}absarc(e,t,r,s,a,n){return this.absellipse(e,t,r,r,s,a,n),this}ellipse(e,t,r,s,a,n,o,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+c,t+h,r,s,a,n,o,l),this}absellipse(e,t,r,s,a,n,o,l){const c=new lp(e,t,r,s,a,n,o,l);if(this.curves.length>0){const u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class hh extends Ie{constructor(e=[new se(0,-.5),new se(.5,0),new se(0,.5)],t=12,r=0,s=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:s},t=Math.floor(t),s=zt(s,0,2*Math.PI);const a=[],n=[],o=[],l=[],c=[],h=1/t,u=new C,d=new se,p=new C,f=new C,g=new C;let m=0,v=0;for(let _=0;_<=e.length-1;_++)switch(_){case 0:m=e[_+1].x-e[_].x,v=e[_+1].y-e[_].y,p.x=1*v,p.y=-m,p.z=0*v,g.copy(p),p.normalize(),l.push(p.x,p.y,p.z);break;case e.length-1:l.push(g.x,g.y,g.z);break;default:m=e[_+1].x-e[_].x,v=e[_+1].y-e[_].y,p.x=1*v,p.y=-m,p.z=0*v,f.copy(p),p.x+=g.x,p.y+=g.y,p.z+=g.z,p.normalize(),l.push(p.x,p.y,p.z),g.copy(f)}for(let _=0;_<=t;_++){const y=r+_*h*s,x=Math.sin(y),b=Math.cos(y);for(let M=0;M<=e.length-1;M++){u.x=e[M].x*x,u.y=e[M].y,u.z=e[M].x*b,n.push(u.x,u.y,u.z),d.x=_/t,d.y=M/(e.length-1),o.push(d.x,d.y);const T=l[3*M+0]*x,A=l[3*M+1],L=l[3*M+0]*b;c.push(T,A,L)}}for(let _=0;_<t;_++)for(let y=0;y<e.length-1;y++){const x=y+_*e.length,b=x,M=x+e.length,T=x+e.length+1,A=x+1;a.push(b,M,A),a.push(T,A,M)}this.setIndex(a),this.setAttribute("position",new Se(n,3)),this.setAttribute("uv",new Se(o,2)),this.setAttribute("normal",new Se(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hh(e.points,e.segments,e.phiStart,e.phiLength)}}class uh extends hh{constructor(e=1,t=1,r=4,s=8){const a=new ll;a.absarc(0,-t/2,e,1.5*Math.PI,0),a.absarc(0,t/2,e,0,.5*Math.PI),super(a.getPoints(r),s),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:r,radialSegments:s}}static fromJSON(e){return new uh(e.radius,e.length,e.capSegments,e.radialSegments)}}class dh extends Ie{constructor(e=1,t=32,r=0,s=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:s},t=Math.max(3,t);const a=[],n=[],o=[],l=[],c=new C,h=new se;n.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let u=0,d=3;u<=t;u++,d+=3){const p=r+u/t*s;c.x=e*Math.cos(p),c.y=e*Math.sin(p),n.push(c.x,c.y,c.z),o.push(0,0,1),h.x=(n[d]/e+1)/2,h.y=(n[d+1]/e+1)/2,l.push(h.x,h.y)}for(let u=1;u<=t;u++)a.push(u,u+1,0);this.setIndex(a),this.setAttribute("position",new Se(n,3)),this.setAttribute("normal",new Se(o,3)),this.setAttribute("uv",new Se(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new dh(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Ft extends Ie{constructor(e=1,t=1,r=1,s=32,a=1,n=!1,o=0,l=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:s,heightSegments:a,openEnded:n,thetaStart:o,thetaLength:l};const c=this;s=Math.floor(s),a=Math.floor(a);const h=[],u=[],d=[],p=[];let f=0;const g=[],m=r/2;let v=0;function _(y){const x=f,b=new se,M=new C;let T=0;const A=y===!0?e:t,L=y===!0?1:-1;for(let P=1;P<=s;P++)u.push(0,m*L,0),d.push(0,L,0),p.push(.5,.5),f++;const U=f;for(let P=0;P<=s;P++){const E=P/s*l+o,I=Math.cos(E),S=Math.sin(E);M.x=A*S,M.y=m*L,M.z=A*I,u.push(M.x,M.y,M.z),d.push(0,L,0),b.x=.5*I+.5,b.y=.5*S*L+.5,p.push(b.x,b.y),f++}for(let P=0;P<s;P++){const E=x+P,I=U+P;y===!0?h.push(I,I+1,E):h.push(I+1,I,E),T+=3}c.addGroup(v,T,y===!0?1:2),v+=T}(function(){const y=new C,x=new C;let b=0;const M=(t-e)/r;for(let T=0;T<=a;T++){const A=[],L=T/a,U=L*(t-e)+e;for(let P=0;P<=s;P++){const E=P/s,I=E*l+o,S=Math.sin(I),V=Math.cos(I);x.x=U*S,x.y=-L*r+m,x.z=U*V,u.push(x.x,x.y,x.z),y.set(S,M,V).normalize(),d.push(y.x,y.y,y.z),p.push(E,1-L),A.push(f++)}g.push(A)}for(let T=0;T<s;T++)for(let A=0;A<a;A++){const L=g[A][T],U=g[A+1][T],P=g[A+1][T+1],E=g[A][T+1];h.push(L,U,E),h.push(U,P,E),b+=6}c.addGroup(v,b,0),v+=b})(),n===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(h),this.setAttribute("position",new Se(u,3)),this.setAttribute("normal",new Se(d,3)),this.setAttribute("uv",new Se(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ft(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ph extends Ft{constructor(e=1,t=1,r=32,s=1,a=!1,n=0,o=2*Math.PI){super(0,e,t,r,s,a,n,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:n,thetaLength:o}}static fromJSON(e){return new ph(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ba extends Ie{constructor(e=[],t=[],r=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:s};const a=[],n=[];function o(d,p,f,g){const m=g+1,v=[];for(let _=0;_<=m;_++){v[_]=[];const y=d.clone().lerp(f,_/m),x=p.clone().lerp(f,_/m),b=m-_;for(let M=0;M<=b;M++)v[_][M]=M===0&&_===m?y:y.clone().lerp(x,M/b)}for(let _=0;_<m;_++)for(let y=0;y<2*(m-_)-1;y++){const x=Math.floor(y/2);y%2==0?(l(v[_][x+1]),l(v[_+1][x]),l(v[_][x])):(l(v[_][x+1]),l(v[_+1][x+1]),l(v[_+1][x]))}}function l(d){a.push(d.x,d.y,d.z)}function c(d,p){const f=3*d;p.x=e[f+0],p.y=e[f+1],p.z=e[f+2]}function h(d,p,f,g){g<0&&d.x===1&&(n[p]=d.x-1),f.x===0&&f.z===0&&(n[p]=g/2/Math.PI+.5)}function u(d){return Math.atan2(d.z,-d.x)}(function(d){const p=new C,f=new C,g=new C;for(let m=0;m<t.length;m+=3)c(t[m+0],p),c(t[m+1],f),c(t[m+2],g),o(p,f,g,d)})(s),function(d){const p=new C;for(let f=0;f<a.length;f+=3)p.x=a[f+0],p.y=a[f+1],p.z=a[f+2],p.normalize().multiplyScalar(d),a[f+0]=p.x,a[f+1]=p.y,a[f+2]=p.z}(r),function(){const d=new C;for(let f=0;f<a.length;f+=3){d.x=a[f+0],d.y=a[f+1],d.z=a[f+2];const g=u(d)/2/Math.PI+.5,m=(p=d,Math.atan2(-p.y,Math.sqrt(p.x*p.x+p.z*p.z))/Math.PI+.5);n.push(g,1-m)}var p;(function(){const f=new C,g=new C,m=new C,v=new C,_=new se,y=new se,x=new se;for(let b=0,M=0;b<a.length;b+=9,M+=6){f.set(a[b+0],a[b+1],a[b+2]),g.set(a[b+3],a[b+4],a[b+5]),m.set(a[b+6],a[b+7],a[b+8]),_.set(n[M+0],n[M+1]),y.set(n[M+2],n[M+3]),x.set(n[M+4],n[M+5]),v.copy(f).add(g).add(m).divideScalar(3);const T=u(v);h(_,M+0,f,T),h(y,M+2,g,T),h(x,M+4,m,T)}})(),function(){for(let f=0;f<n.length;f+=6){const g=n[f+0],m=n[f+2],v=n[f+4],_=Math.max(g,m,v),y=Math.min(g,m,v);_>.9&&y<.1&&(g<.2&&(n[f+0]+=1),m<.2&&(n[f+2]+=1),v<.2&&(n[f+4]+=1))}}()}(),this.setAttribute("position",new Se(a,3)),this.setAttribute("normal",new Se(a.slice(),3)),this.setAttribute("uv",new Se(n,2)),s===0?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ba(e.vertices,e.indices,e.radius,e.details)}}class hp extends Ba{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2,s=1/r;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-r,0,-s,r,0,s,-r,0,s,r,-s,-r,0,-s,r,0,s,-r,0,s,r,0,-r,0,-s,r,0,-s,-r,0,s,r,0,s],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new hp(e.radius,e.detail)}}const ou=new C,lu=new C,pm=new C,cu=new nr;class Nx extends Ie{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(Cn*t),a=e.getIndex(),n=e.getAttribute("position"),o=a?a.count:n.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let p=0;p<o;p+=3){a?(l[0]=a.getX(p),l[1]=a.getX(p+1),l[2]=a.getX(p+2)):(l[0]=p,l[1]=p+1,l[2]=p+2);const{a:f,b:g,c:m}=cu;if(f.fromBufferAttribute(n,l[0]),g.fromBufferAttribute(n,l[1]),m.fromBufferAttribute(n,l[2]),cu.getNormal(pm),h[0]=`${Math.round(f.x*r)},${Math.round(f.y*r)},${Math.round(f.z*r)}`,h[1]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,h[2]=`${Math.round(m.x*r)},${Math.round(m.y*r)},${Math.round(m.z*r)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let v=0;v<3;v++){const _=(v+1)%3,y=h[v],x=h[_],b=cu[c[v]],M=cu[c[_]],T=`${y}_${x}`,A=`${x}_${y}`;A in u&&u[A]?(pm.dot(u[A].normal)<=s&&(d.push(b.x,b.y,b.z),d.push(M.x,M.y,M.z)),u[A]=null):T in u||(u[T]={index0:l[v],index1:l[_],normal:pm.clone()})}}for(const p in u)if(u[p]){const{index0:f,index1:g}=u[p];ou.fromBufferAttribute(n,f),lu.fromBufferAttribute(n,g),d.push(ou.x,ou.y,ou.z),d.push(lu.x,lu.y,lu.z)}this.setAttribute("position",new Se(d,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Aa extends ll{constructor(e){super(e),this.uuid=hr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,s=this.holes.length;r<s;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const s=e.holes[t];this.holes.push(new ll().fromJSON(s))}return this}}const ST=function(i,e,t=2){const r=e&&e.length,s=r?e[0]*t:i.length;let a=S_(i,0,s,t,!0);const n=[];if(!a||a.next===a.prev)return n;let o,l,c,h,u,d,p;if(r&&(a=function(f,g,m,v){const _=[];let y,x,b,M,T;for(y=0,x=g.length;y<x;y++)b=g[y]*v,M=y<x-1?g[y+1]*v:f.length,T=S_(f,b,M,v,!1),T===T.next&&(T.steiner=!0),_.push(LT(T));for(_.sort(PT),y=0;y<_.length;y++)m=RT(_[y],m);return m}(i,e,a,t)),i.length>80*t){o=c=i[0],l=h=i[1];for(let f=t;f<s;f+=t)u=i[f],d=i[f+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=p!==0?32767/p:0}return Lc(a,n,t,o,l,p,0),n};function S_(i,e,t,r,s){let a,n;if(s===function(o,l,c,h){let u=0;for(let d=l,p=c-h;d<c;d+=h)u+=(o[p]-o[d])*(o[d+1]+o[p+1]),p=d;return u}(i,e,t,r)>0)for(a=e;a<t;a+=r)n=T_(a,i[a],i[a+1],n);else for(a=t-r;a>=e;a-=r)n=T_(a,i[a],i[a+1],n);return n&&up(n,n.next)&&(Oc(n),n=n.next),n}function jn(i,e){if(!i)return i;e||(e=i);let t,r=i;do if(t=!1,r.steiner||!up(r,r.next)&&Ot(r.prev,r,r.next)!==0)r=r.next;else{if(Oc(r),r=e=r.prev,r===r.next)break;t=!0}while(t||r!==e);return e}function Lc(i,e,t,r,s,a,n){if(!i)return;!n&&a&&function(h,u,d,p){let f=h;do f.z===0&&(f.z=Qf(f.x,f.y,u,d,p)),f.prevZ=f.prev,f.nextZ=f.next,f=f.next;while(f!==h);f.prevZ.nextZ=null,f.prevZ=null,function(g){let m,v,_,y,x,b,M,T,A=1;do{for(v=g,g=null,x=null,b=0;v;){for(b++,_=v,M=0,m=0;m<A&&(M++,_=_.nextZ,_);m++);for(T=A;M>0||T>0&&_;)M!==0&&(T===0||!_||v.z<=_.z)?(y=v,v=v.nextZ,M--):(y=_,_=_.nextZ,T--),x?x.nextZ=y:g=y,y.prevZ=x,x=y;v=_}x.nextZ=null,A*=2}while(b>1)}(f)}(i,r,s,a);let o,l,c=i;for(;i.prev!==i.next;)if(o=i.prev,l=i.next,a?ET(i,r,s,a):TT(i))e.push(o.i/t|0),e.push(i.i/t|0),e.push(l.i/t|0),Oc(i),i=l.next,c=l.next;else if((i=l)===c){n?n===1?Lc(i=AT(jn(i),e,t),e,t,r,s,a,2):n===2&&CT(i,e,t,r,s,a):Lc(jn(i),e,t,r,s,a,1);break}}function TT(i){const e=i.prev,t=i,r=i.next;if(Ot(e,t,r)>=0)return!1;const s=e.x,a=t.x,n=r.x,o=e.y,l=t.y,c=r.y,h=s<a?s<n?s:n:a<n?a:n,u=o<l?o<c?o:c:l<c?l:c,d=s>a?s>n?s:n:a>n?a:n,p=o>l?o>c?o:c:l>c?l:c;let f=r.next;for(;f!==e;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&Io(s,o,a,l,n,c,f.x,f.y)&&Ot(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function ET(i,e,t,r){const s=i.prev,a=i,n=i.next;if(Ot(s,a,n)>=0)return!1;const o=s.x,l=a.x,c=n.x,h=s.y,u=a.y,d=n.y,p=o<l?o<c?o:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,g=o>l?o>c?o:c:l>c?l:c,m=h>u?h>d?h:d:u>d?u:d,v=Qf(p,f,e,t,r),_=Qf(g,m,e,t,r);let y=i.prevZ,x=i.nextZ;for(;y&&y.z>=v&&x&&x.z<=_;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==s&&y!==n&&Io(o,h,l,u,c,d,y.x,y.y)&&Ot(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==s&&x!==n&&Io(o,h,l,u,c,d,x.x,x.y)&&Ot(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=v;){if(y.x>=p&&y.x<=g&&y.y>=f&&y.y<=m&&y!==s&&y!==n&&Io(o,h,l,u,c,d,y.x,y.y)&&Ot(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=g&&x.y>=f&&x.y<=m&&x!==s&&x!==n&&Io(o,h,l,u,c,d,x.x,x.y)&&Ot(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function AT(i,e,t){let r=i;do{const s=r.prev,a=r.next.next;!up(s,a)&&Ux(s,r,r.next,a)&&Dc(s,a)&&Dc(a,s)&&(e.push(s.i/t|0),e.push(r.i/t|0),e.push(a.i/t|0),Oc(r),Oc(r.next),r=i=a),r=r.next}while(r!==i);return jn(r)}function CT(i,e,t,r,s,a){let n=i;do{let o=n.next.next;for(;o!==n.prev;){if(n.i!==o.i&&DT(n,o)){let l=kx(n,o);return n=jn(n,n.next),l=jn(l,l.next),Lc(n,e,t,r,s,a,0),void Lc(l,e,t,r,s,a,0)}o=o.next}n=n.next}while(n!==i)}function PT(i,e){return i.x-e.x}function RT(i,e){const t=function(s,a){let n,o=a,l=-1/0;const c=s.x,h=s.y;do{if(h<=o.y&&h>=o.next.y&&o.next.y!==o.y){const m=o.x+(h-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(m<=c&&m>l&&(l=m,n=o.x<o.next.x?o:o.next,m===c))return n}o=o.next}while(o!==a);if(!n)return null;const u=n,d=n.x,p=n.y;let f,g=1/0;o=n;do c>=o.x&&o.x>=d&&c!==o.x&&Io(h<p?c:l,h,d,p,h<p?l:c,h,o.x,o.y)&&(f=Math.abs(h-o.y)/(c-o.x),Dc(o,s)&&(f<g||f===g&&(o.x>n.x||o.x===n.x&&IT(n,o)))&&(n=o,g=f)),o=o.next;while(o!==u);return n}(i,e);if(!t)return e;const r=kx(t,i);return jn(r,r.next),jn(t,t.next)}function IT(i,e){return Ot(i.prev,i,e.prev)<0&&Ot(e.next,i,i.next)<0}function Qf(i,e,t,r,s){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-t)*s|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function LT(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function Io(i,e,t,r,s,a,n,o){return(s-n)*(e-o)>=(i-n)*(a-o)&&(i-n)*(r-o)>=(t-n)*(e-o)&&(t-n)*(a-o)>=(s-n)*(r-o)}function DT(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(t,r){let s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==r.i&&s.next.i!==r.i&&Ux(s,s.next,t,r))return!0;s=s.next}while(s!==t);return!1}(i,e)&&(Dc(i,e)&&Dc(e,i)&&function(t,r){let s=t,a=!1;const n=(t.x+r.x)/2,o=(t.y+r.y)/2;do s.y>o!=s.next.y>o&&s.next.y!==s.y&&n<(s.next.x-s.x)*(o-s.y)/(s.next.y-s.y)+s.x&&(a=!a),s=s.next;while(s!==t);return a}(i,e)&&(Ot(i.prev,i,e.prev)||Ot(i,e.prev,e))||up(i,e)&&Ot(i.prev,i,i.next)>0&&Ot(e.prev,e,e.next)>0)}function Ot(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function up(i,e){return i.x===e.x&&i.y===e.y}function Ux(i,e,t,r){const s=uu(Ot(i,e,t)),a=uu(Ot(i,e,r)),n=uu(Ot(t,r,i)),o=uu(Ot(t,r,e));return s!==a&&n!==o||!(s!==0||!hu(i,t,e))||!(a!==0||!hu(i,r,e))||!(n!==0||!hu(t,i,r))||!(o!==0||!hu(t,e,r))}function hu(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function uu(i){return i>0?1:i<0?-1:0}function Dc(i,e){return Ot(i.prev,i,i.next)<0?Ot(i,e,i.next)>=0&&Ot(i,i.prev,e)>=0:Ot(i,e,i.prev)<0||Ot(i,i.next,e)<0}function kx(i,e){const t=new $f(i.i,i.x,i.y),r=new $f(e.i,e.x,e.y),s=i.next,a=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,r.next=t,t.prev=r,a.next=r,r.prev=a,r}function T_(i,e,t,r){const s=new $f(i,e,t);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Oc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function $f(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Gr{static area(e){const t=e.length;let r=0;for(let s=t-1,a=0;a<t;s=a++)r+=e[s].x*e[a].y-e[a].x*e[s].y;return .5*r}static isClockWise(e){return Gr.area(e)<0}static triangulateShape(e,t){const r=[],s=[],a=[];E_(e),A_(r,e);let n=e.length;t.forEach(E_);for(let l=0;l<t.length;l++)s.push(n),n+=t[l].length,A_(r,t[l]);const o=ST(r,s);for(let l=0;l<o.length;l+=3)a.push(o.slice(l,l+3));return a}}function E_(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function A_(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class Qn extends Ie{constructor(e=new Aa([new se(.5,.5),new se(-.5,.5),new se(-.5,-.5),new se(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,s=[],a=[];for(let o=0,l=e.length;o<l;o++)n(e[o]);function n(o){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,u=t.depth!==void 0?t.depth:1;let d=t.bevelEnabled===void 0||t.bevelEnabled,p=t.bevelThickness!==void 0?t.bevelThickness:.2,f=t.bevelSize!==void 0?t.bevelSize:p-.1,g=t.bevelOffset!==void 0?t.bevelOffset:0,m=t.bevelSegments!==void 0?t.bevelSegments:3;const v=t.extrudePath,_=t.UVGenerator!==void 0?t.UVGenerator:OT;let y,x,b,M,T,A=!1;v&&(y=v.getSpacedPoints(h),A=!0,d=!1,x=v.computeFrenetFrames(h,!1),b=new C,M=new C,T=new C),d||(m=0,p=0,f=0,g=0);const L=o.extractPoints(c);let U=L.shape;const P=L.holes;if(!Gr.isClockWise(U)){U=U.reverse();for(let W=0,$=P.length;W<$;W++){const k=P[W];Gr.isClockWise(k)&&(P[W]=k.reverse())}}const E=Gr.triangulateShape(U,P),I=U;for(let W=0,$=P.length;W<$;W++){const k=P[W];U=U.concat(k)}function S(W,$,k){return W.clone().addScaledVector($,k)}const V=U.length,J=E.length;function X(W,$,k){let Q,re,w;const G=W.x-$.x,Z=W.y-$.y,F=k.x-W.x,R=k.y-W.y,N=G*G+Z*Z,z=G*R-Z*F;if(Math.abs(z)>Number.EPSILON){const Y=Math.sqrt(N),q=Math.sqrt(F*F+R*R),he=$.x-Z/Y,de=$.y+G/Y,ue=((k.x-R/q-he)*R-(k.y+F/q-de)*F)/(G*R-Z*F);Q=he+G*ue-W.x,re=de+Z*ue-W.y;const we=Q*Q+re*re;if(we<=2)return new se(Q,re);w=Math.sqrt(we/2)}else{let Y=!1;G>Number.EPSILON?F>Number.EPSILON&&(Y=!0):G<-Number.EPSILON?F<-Number.EPSILON&&(Y=!0):Math.sign(Z)===Math.sign(R)&&(Y=!0),Y?(Q=-Z,re=G,w=Math.sqrt(N)):(Q=G,re=Z,w=Math.sqrt(N/2))}return new se(Q/w,re/w)}const te=[];for(let W=0,$=I.length,k=$-1,Q=W+1;W<$;W++,k++,Q++)k===$&&(k=0),Q===$&&(Q=0),te[W]=X(I[W],I[k],I[Q]);const ie=[];let fe,B=te.concat();for(let W=0,$=P.length;W<$;W++){const k=P[W];fe=[];for(let Q=0,re=k.length,w=re-1,G=Q+1;Q<re;Q++,w++,G++)w===re&&(w=0),G===re&&(G=0),fe[Q]=X(k[Q],k[w],k[G]);ie.push(fe),B=B.concat(fe)}for(let W=0;W<m;W++){const $=W/m,k=p*Math.cos($*Math.PI/2),Q=f*Math.sin($*Math.PI/2)+g;for(let re=0,w=I.length;re<w;re++){const G=S(I[re],te[re],Q);O(G.x,G.y,-k)}for(let re=0,w=P.length;re<w;re++){const G=P[re];fe=ie[re];for(let Z=0,F=G.length;Z<F;Z++){const R=S(G[Z],fe[Z],Q);O(R.x,R.y,-k)}}}const j=f+g;for(let W=0;W<V;W++){const $=d?S(U[W],B[W],j):U[W];A?(M.copy(x.normals[0]).multiplyScalar($.x),b.copy(x.binormals[0]).multiplyScalar($.y),T.copy(y[0]).add(M).add(b),O(T.x,T.y,T.z)):O($.x,$.y,0)}for(let W=1;W<=h;W++)for(let $=0;$<V;$++){const k=d?S(U[$],B[$],j):U[$];A?(M.copy(x.normals[W]).multiplyScalar(k.x),b.copy(x.binormals[W]).multiplyScalar(k.y),T.copy(y[W]).add(M).add(b),O(T.x,T.y,T.z)):O(k.x,k.y,u/h*W)}for(let W=m-1;W>=0;W--){const $=W/m,k=p*Math.cos($*Math.PI/2),Q=f*Math.sin($*Math.PI/2)+g;for(let re=0,w=I.length;re<w;re++){const G=S(I[re],te[re],Q);O(G.x,G.y,u+k)}for(let re=0,w=P.length;re<w;re++){const G=P[re];fe=ie[re];for(let Z=0,F=G.length;Z<F;Z++){const R=S(G[Z],fe[Z],Q);A?O(R.x,R.y+y[h-1].y,y[h-1].x+k):O(R.x,R.y,u+k)}}}function ae(W,$){let k=W.length;for(;--k>=0;){const Q=k;let re=k-1;re<0&&(re=W.length-1);for(let w=0,G=h+2*m;w<G;w++){const Z=V*w,F=V*(w+1);ee($+Q+Z,$+re+Z,$+re+F,$+Q+F)}}}function O(W,$,k){l.push(W),l.push($),l.push(k)}function D(W,$,k){ne(W),ne($),ne(k);const Q=s.length/3,re=_.generateTopUV(r,s,Q-3,Q-2,Q-1);K(re[0]),K(re[1]),K(re[2])}function ee(W,$,k,Q){ne(W),ne($),ne(Q),ne($),ne(k),ne(Q);const re=s.length/3,w=_.generateSideWallUV(r,s,re-6,re-3,re-2,re-1);K(w[0]),K(w[1]),K(w[3]),K(w[1]),K(w[2]),K(w[3])}function ne(W){s.push(l[3*W+0]),s.push(l[3*W+1]),s.push(l[3*W+2])}function K(W){a.push(W.x),a.push(W.y)}(function(){const W=s.length/3;if(d){let $=0,k=V*$;for(let Q=0;Q<J;Q++){const re=E[Q];D(re[2]+k,re[1]+k,re[0]+k)}$=h+2*m,k=V*$;for(let Q=0;Q<J;Q++){const re=E[Q];D(re[0]+k,re[1]+k,re[2]+k)}}else{for(let $=0;$<J;$++){const k=E[$];D(k[2],k[1],k[0])}for(let $=0;$<J;$++){const k=E[$];D(k[0]+V*h,k[1]+V*h,k[2]+V*h)}}r.addGroup(W,s.length/3-W,0)})(),function(){const W=s.length/3;let $=0;ae(I,$),$+=I.length;for(let k=0,Q=P.length;k<Q;k++){const re=P[k];ae(re,$),$+=re.length}r.addGroup(W,s.length/3-W,1)}()}this.setAttribute("position",new Se(s,3)),this.setAttribute("uv",new Se(a,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(t,r,s){if(s.shapes=[],Array.isArray(t))for(let a=0,n=t.length;a<n;a++){const o=t[a];s.shapes.push(o.uuid)}else s.shapes.push(t.uuid);return s.options=Object.assign({},r),r.extrudePath!==void 0&&(s.options.extrudePath=r.extrudePath.toJSON()),s}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const r=[];for(let a=0,n=e.shapes.length;a<n;a++){const o=t[e.shapes[a]];r.push(o)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new md[s.type]().fromJSON(s)),new Qn(r,e.options)}}const OT={generateTopUV:function(i,e,t,r,s){const a=e[3*t],n=e[3*t+1],o=e[3*r],l=e[3*r+1],c=e[3*s],h=e[3*s+1];return[new se(a,n),new se(o,l),new se(c,h)]},generateSideWallUV:function(i,e,t,r,s,a){const n=e[3*t],o=e[3*t+1],l=e[3*t+2],c=e[3*r],h=e[3*r+1],u=e[3*r+2],d=e[3*s],p=e[3*s+1],f=e[3*s+2],g=e[3*a],m=e[3*a+1],v=e[3*a+2];return Math.abs(o-h)<Math.abs(n-c)?[new se(n,1-l),new se(c,1-u),new se(d,1-f),new se(g,1-v)]:[new se(o,1-l),new se(h,1-u),new se(p,1-f),new se(m,1-v)]}};class dp extends Ba{constructor(e=1,t=0){const r=(1+Math.sqrt(5))/2;super([-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new dp(e.radius,e.detail)}}class ks extends Ba{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ks(e.radius,e.detail)}}class mh extends Ie{constructor(e=.5,t=1,r=32,s=1,a=0,n=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:s,thetaStart:a,thetaLength:n},r=Math.max(3,r);const o=[],l=[],c=[],h=[];let u=e;const d=(t-e)/(s=Math.max(1,s)),p=new C,f=new se;for(let g=0;g<=s;g++){for(let m=0;m<=r;m++){const v=a+m/r*n;p.x=u*Math.cos(v),p.y=u*Math.sin(v),l.push(p.x,p.y,p.z),c.push(0,0,1),f.x=(p.x/t+1)/2,f.y=(p.y/t+1)/2,h.push(f.x,f.y)}u+=d}for(let g=0;g<s;g++){const m=g*(r+1);for(let v=0;v<r;v++){const _=v+m,y=_,x=_+r+1,b=_+r+2,M=_+1;o.push(y,x,M),o.push(x,b,M)}}this.setIndex(o),this.setAttribute("position",new Se(l,3)),this.setAttribute("normal",new Se(c,3)),this.setAttribute("uv",new Se(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new mh(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class pp extends Ie{constructor(e=new Aa([new se(0,.5),new se(-.5,-.5),new se(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],s=[],a=[],n=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let h=0;h<e.length;h++)c(e[h]),this.addGroup(o,l,h),o+=l,l=0;function c(h){const u=s.length/3,d=h.extractPoints(t);let p=d.shape;const f=d.holes;Gr.isClockWise(p)===!1&&(p=p.reverse());for(let m=0,v=f.length;m<v;m++){const _=f[m];Gr.isClockWise(_)===!0&&(f[m]=_.reverse())}const g=Gr.triangulateShape(p,f);for(let m=0,v=f.length;m<v;m++){const _=f[m];p=p.concat(_)}for(let m=0,v=p.length;m<v;m++){const _=p[m];s.push(_.x,_.y,0),a.push(0,0,1),n.push(_.x,_.y)}for(let m=0,v=g.length;m<v;m++){const _=g[m],y=_[0]+u,x=_[1]+u,b=_[2]+u;r.push(y,x,b),l+=3}}this.setIndex(r),this.setAttribute("position",new Se(s,3)),this.setAttribute("normal",new Se(a,3)),this.setAttribute("uv",new Se(n,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(t,r){if(r.shapes=[],Array.isArray(t))for(let s=0,a=t.length;s<a;s++){const n=t[s];r.shapes.push(n.uuid)}else r.shapes.push(t.uuid);return r}(this.parameters.shapes,e)}static fromJSON(e,t){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const n=t[e.shapes[s]];r.push(n)}return new pp(r,e.curveSegments)}}class Wn extends Ie{constructor(e=1,t=32,r=16,s=0,a=2*Math.PI,n=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:s,phiLength:a,thetaStart:n,thetaLength:o},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(n+o,Math.PI);let c=0;const h=[],u=new C,d=new C,p=[],f=[],g=[],m=[];for(let v=0;v<=r;v++){const _=[],y=v/r;let x=0;v===0&&n===0?x=.5/t:v===r&&l===Math.PI&&(x=-.5/t);for(let b=0;b<=t;b++){const M=b/t;u.x=-e*Math.cos(s+M*a)*Math.sin(n+y*o),u.y=e*Math.cos(n+y*o),u.z=e*Math.sin(s+M*a)*Math.sin(n+y*o),f.push(u.x,u.y,u.z),d.copy(u).normalize(),g.push(d.x,d.y,d.z),m.push(M+x,1-y),_.push(c++)}h.push(_)}for(let v=0;v<r;v++)for(let _=0;_<t;_++){const y=h[v][_+1],x=h[v][_],b=h[v+1][_],M=h[v+1][_+1];(v!==0||n>0)&&p.push(y,x,M),(v!==r-1||l<Math.PI)&&p.push(x,b,M)}this.setIndex(p),this.setAttribute("position",new Se(f,3)),this.setAttribute("normal",new Se(g,3)),this.setAttribute("uv",new Se(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Wn(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class mp extends Ba{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new mp(e.radius,e.detail)}}class ss extends Ie{constructor(e=1,t=.4,r=12,s=48,a=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:s,arc:a},r=Math.floor(r),s=Math.floor(s);const n=[],o=[],l=[],c=[],h=new C,u=new C,d=new C;for(let p=0;p<=r;p++)for(let f=0;f<=s;f++){const g=f/s*a,m=p/r*Math.PI*2;u.x=(e+t*Math.cos(m))*Math.cos(g),u.y=(e+t*Math.cos(m))*Math.sin(g),u.z=t*Math.sin(m),o.push(u.x,u.y,u.z),h.x=e*Math.cos(g),h.y=e*Math.sin(g),d.subVectors(u,h).normalize(),l.push(d.x,d.y,d.z),c.push(f/s),c.push(p/r)}for(let p=1;p<=r;p++)for(let f=1;f<=s;f++){const g=(s+1)*p+f-1,m=(s+1)*(p-1)+f-1,v=(s+1)*(p-1)+f,_=(s+1)*p+f;n.push(g,m,_),n.push(m,v,_)}this.setIndex(n),this.setAttribute("position",new Se(o,3)),this.setAttribute("normal",new Se(l,3)),this.setAttribute("uv",new Se(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ss(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class fp extends Ie{constructor(e=1,t=.4,r=64,s=8,a=2,n=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:s,p:a,q:n},r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[],u=new C,d=new C,p=new C,f=new C,g=new C,m=new C,v=new C;for(let y=0;y<=r;++y){const x=y/r*a*Math.PI*2;_(x,a,n,e,p),_(x+.01,a,n,e,f),m.subVectors(f,p),v.addVectors(f,p),g.crossVectors(m,v),v.crossVectors(g,m),g.normalize(),v.normalize();for(let b=0;b<=s;++b){const M=b/s*Math.PI*2,T=-t*Math.cos(M),A=t*Math.sin(M);u.x=p.x+(T*v.x+A*g.x),u.y=p.y+(T*v.y+A*g.y),u.z=p.z+(T*v.z+A*g.z),l.push(u.x,u.y,u.z),d.subVectors(u,p).normalize(),c.push(d.x,d.y,d.z),h.push(y/r),h.push(b/s)}}for(let y=1;y<=r;y++)for(let x=1;x<=s;x++){const b=(s+1)*(y-1)+(x-1),M=(s+1)*y+(x-1),T=(s+1)*y+x,A=(s+1)*(y-1)+x;o.push(b,M,A),o.push(M,T,A)}function _(y,x,b,M,T){const A=Math.cos(y),L=Math.sin(y),U=b/x*y,P=Math.cos(U);T.x=M*(2+P)*.5*A,T.y=M*(2+P)*L*.5,T.z=M*Math.sin(U)*.5}this.setIndex(o),this.setAttribute("position",new Se(l,3)),this.setAttribute("normal",new Se(c,3)),this.setAttribute("uv",new Se(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new fp(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Gs extends Ie{constructor(e=new n0(new C(-1,-1,0),new C(-1,1,0),new C(1,1,0)),t=64,r=1,s=8,a=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:s,closed:a};const n=e.computeFrenetFrames(t,a);this.tangents=n.tangents,this.normals=n.normals,this.binormals=n.binormals;const o=new C,l=new C,c=new se;let h=new C;const u=[],d=[],p=[],f=[];function g(m){h=e.getPointAt(m/t,h);const v=n.normals[m],_=n.binormals[m];for(let y=0;y<=s;y++){const x=y/s*Math.PI*2,b=Math.sin(x),M=-Math.cos(x);l.x=M*v.x+b*_.x,l.y=M*v.y+b*_.y,l.z=M*v.z+b*_.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=h.x+r*l.x,o.y=h.y+r*l.y,o.z=h.z+r*l.z,u.push(o.x,o.y,o.z)}}(function(){for(let m=0;m<t;m++)g(m);g(a===!1?t:0),function(){for(let m=0;m<=t;m++)for(let v=0;v<=s;v++)c.x=m/t,c.y=v/s,p.push(c.x,c.y)}(),function(){for(let m=1;m<=t;m++)for(let v=1;v<=s;v++){const _=(s+1)*(m-1)+(v-1),y=(s+1)*m+(v-1),x=(s+1)*m+v,b=(s+1)*(m-1)+v;f.push(_,y,b),f.push(y,x,b)}}()})(),this.setIndex(f),this.setAttribute("position",new Se(u,3)),this.setAttribute("normal",new Se(d,3)),this.setAttribute("uv",new Se(p,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Gs(new md[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class l0 extends Ie{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],r=new Set,s=new C,a=new C;if(e.index!==null){const n=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const u=l[c],d=u.start;for(let p=d,f=d+u.count;p<f;p+=3)for(let g=0;g<3;g++){const m=o.getX(p+g),v=o.getX(p+(g+1)%3);s.fromBufferAttribute(n,m),a.fromBufferAttribute(n,v),C_(s,a,r)===!0&&(t.push(s.x,s.y,s.z),t.push(a.x,a.y,a.z))}}}else{const n=e.attributes.position;for(let o=0,l=n.count/3;o<l;o++)for(let c=0;c<3;c++){const h=3*o+c,u=3*o+(c+1)%3;s.fromBufferAttribute(n,h),a.fromBufferAttribute(n,u),C_(s,a,r)===!0&&(t.push(s.x,s.y,s.z),t.push(a.x,a.y,a.z))}}this.setAttribute("position",new Se(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function C_(i,e,t){const r=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(r)!==!0&&t.has(s)!==!0&&(t.add(r),t.add(s),!0)}var P_=Object.freeze({__proto__:null,BoxGeometry:Lt,CapsuleGeometry:uh,CircleGeometry:dh,ConeGeometry:ph,CylinderGeometry:Ft,DodecahedronGeometry:hp,EdgesGeometry:Nx,ExtrudeGeometry:Qn,IcosahedronGeometry:dp,LatheGeometry:hh,OctahedronGeometry:ks,PlaneGeometry:ys,PolyhedronGeometry:Ba,RingGeometry:mh,ShapeGeometry:pp,SphereGeometry:Wn,TetrahedronGeometry:mp,TorusGeometry:ss,TorusKnotGeometry:fp,TubeGeometry:Gs,WireframeGeometry:l0});class Fx extends $t{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ve(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class c0 extends at{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class cl extends $t{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ve(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ct,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class dr extends cl{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new se(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return zt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ve(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ve(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ve(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class Xn extends $t{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ve(16777215),this.specular=new ve(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ct,this.combine=ah,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class h0 extends $t{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ve(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class gp extends $t{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class vp extends $t{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ve(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ve(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ct,this.combine=ah,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class zx extends $t{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ve(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Bx extends Wt{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Tn(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function Vx(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function Hx(i){const e=i.length,t=new Array(e);for(let r=0;r!==e;++r)t[r]=r;return t.sort(function(r,s){return i[r]-i[s]}),t}function Jf(i,e,t){const r=i.length,s=new i.constructor(r);for(let a=0,n=0;n!==r;++a){const o=t[a]*e;for(let l=0;l!==e;++l)s[n++]=i[o+l]}return s}function u0(i,e,t,r){let s=1,a=i[0];for(;a!==void 0&&a[r]===void 0;)a=i[s++];if(a===void 0)return;let n=a[r];if(n!==void 0)if(Array.isArray(n))do n=a[r],n!==void 0&&(e.push(a.time),t.push.apply(t,n)),a=i[s++];while(a!==void 0);else if(n.toArray!==void 0)do n=a[r],n!==void 0&&(e.push(a.time),n.toArray(t,t.length)),a=i[s++];while(a!==void 0);else do n=a[r],n!==void 0&&(e.push(a.time),t.push(n)),a=i[s++];while(a!==void 0)}const NT={convertArray:Tn,isTypedArray:Vx,getKeyframeOrder:Hx,sortedArray:Jf,flattenJSON:u0,subclip:function(i,e,t,r,s=30){const a=i.clone();a.name=e;const n=[];for(let l=0;l<a.tracks.length;++l){const c=a.tracks[l],h=c.getValueSize(),u=[],d=[];for(let p=0;p<c.times.length;++p){const f=c.times[p]*s;if(!(f<t||f>=r)){u.push(c.times[p]);for(let g=0;g<h;++g)d.push(c.values[p*h+g])}}u.length!==0&&(c.times=Tn(u,c.times.constructor),c.values=Tn(d,c.values.constructor),n.push(c))}a.tracks=n;let o=1/0;for(let l=0;l<a.tracks.length;++l)o>a.tracks[l].times[0]&&(o=a.tracks[l].times[0]);for(let l=0;l<a.tracks.length;++l)a.tracks[l].shift(-1*o);return a.resetDuration(),a},makeClipAdditive:function(i,e=0,t=i,r=30){r<=0&&(r=30);const s=t.tracks.length,a=e/r;for(let n=0;n<s;++n){const o=t.tracks[n],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=i.tracks.find(function(v){return v.name===o.name&&v.ValueTypeName===l});if(c===void 0)continue;let h=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=u/3);let d=0;const p=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);const f=o.times.length-1;let g;if(a<=o.times[0]){const v=h,_=u-h;g=o.values.slice(v,_)}else if(a>=o.times[f]){const v=f*u+h,_=v+u-h;g=o.values.slice(v,_)}else{const v=o.createInterpolant(),_=h,y=u-h;v.evaluate(a),g=v.resultBuffer.slice(_,y)}l==="quaternion"&&new Qe().fromArray(g).normalize().conjugate().toArray(g);const m=c.times.length;for(let v=0;v<m;++v){const _=v*p+d;if(l==="quaternion")Qe.multiplyQuaternionsFlat(c.values,_,g,0,c.values,_);else{const y=p-2*d;for(let x=0;x<y;++x)c.values[_+x]-=g[x]}}}return i.blendMode=Kg,i}};class bl{constructor(e,t,r,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,s=t[r],a=t[r-1];e:{t:{let n;i:{r:if(!(e<s)){for(let o=r+2;;){if(s===void 0){if(e<a)break r;return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(a=s,s=t[++r],e<s)break t}n=t.length;break i}if(e>=a)break e;{const o=t[1];e<o&&(r=2,a=o);for(let l=r-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(s=a,a=t[--r-1],e>=a)break t}n=r,r=0}}for(;r<n;){const o=r+n>>>1;e<t[o]?n=o:r=o+1}if(s=t[r],a=t[r-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return r=t.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,a,s)}return this.interpolate_(r,a,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s;for(let n=0;n!==s;++n)t[n]=r[a+n];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Gx extends bl{constructor(e,t,r,s){super(e,t,r,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:wn,endingEnd:wn}}intervalChanged_(e,t,r){const s=this.parameterPositions;let a=e-2,n=e+1,o=s[a],l=s[n];if(o===void 0)switch(this.getSettings_().endingStart){case Sn:a=e,o=2*t-r;break;case Sc:a=s.length-2,o=t+s[a]-s[a+1];break;default:a=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case Sn:n=e,l=2*r-t;break;case Sc:n=1,l=r+s[1]-s[0];break;default:n=e-1,l=t}const c=.5*(r-t),h=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(l-r),this._offsetPrev=a*h,this._offsetNext=n*h}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,p=this._weightNext,f=(r-t)/(s-t),g=f*f,m=g*f,v=-d*m+2*d*g-d*f,_=(1+d)*m+(-1.5-2*d)*g+(-.5+d)*f+1,y=(-1-p)*m+(1.5+p)*g+.5*f,x=p*m-p*g;for(let b=0;b!==o;++b)a[b]=v*n[h+b]+_*n[c+b]+y*n[l+b]+x*n[u+b];return a}}class d0 extends bl{constructor(e,t,r,s){super(e,t,r,s)}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,h=(r-t)/(s-t),u=1-h;for(let d=0;d!==o;++d)a[d]=n[c+d]*u+n[l+d]*h;return a}}class jx extends bl{constructor(e,t,r,s){super(e,t,r,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class jr{constructor(e,t,r,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Tn(t,this.TimeBufferType),this.values=Tn(r,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:Tn(e.times,Array),values:Tn(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(r.interpolation=s)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new jx(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new d0(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Gx(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case tl:t=this.InterpolantFactoryMethodDiscrete;break;case Vn:t=this.InterpolantFactoryMethodLinear;break;case $u:t=this.InterpolantFactoryMethodSmooth}if(t===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return tl;case this.InterpolantFactoryMethodLinear:return Vn;case this.InterpolantFactoryMethodSmooth:return $u}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let r=0,s=t.length;r!==s;++r)t[r]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let r=0,s=t.length;r!==s;++r)t[r]*=e}return this}trim(e,t){const r=this.times,s=r.length;let a=0,n=s-1;for(;a!==s&&r[a]<e;)++a;for(;n!==-1&&r[n]>t;)--n;if(++n,a!==0||n!==s){a>=n&&(n=Math.max(n,1),a=n-1);const o=this.getValueSize();this.times=r.slice(a,n),this.values=this.values.slice(a*o,n*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(e=!1);const r=this.times,s=this.values,a=r.length;a===0&&(e=!1);let n=null;for(let o=0;o!==a;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){e=!1;break}if(n!==null&&n>l){e=!1;break}n=l}if(s!==void 0&&Vx(s))for(let o=0,l=s.length;o!==l;++o){const c=s[o];if(isNaN(c)){e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),r=this.getValueSize(),s=this.getInterpolation()===$u,a=e.length-1;let n=1;for(let o=1;o<a;++o){let l=!1;const c=e[o];if(c!==e[o+1]&&(o!==1||c!==e[0]))if(s)l=!0;else{const h=o*r,u=h-r,d=h+r;for(let p=0;p!==r;++p){const f=t[h+p];if(f!==t[u+p]||f!==t[d+p]){l=!0;break}}}if(l){if(o!==n){e[n]=e[o];const h=o*r,u=n*r;for(let d=0;d!==r;++d)t[u+d]=t[h+d]}++n}}if(a>0){e[n]=e[a];for(let o=a*r,l=n*r,c=0;c!==r;++c)t[l+c]=t[o+c];++n}return n!==e.length?(this.times=e.slice(0,n),this.values=t.slice(0,n*r)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),r=new this.constructor(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}jr.prototype.TimeBufferType=Float32Array,jr.prototype.ValueBufferType=Float32Array,jr.prototype.DefaultInterpolation=Vn;class yn extends jr{}yn.prototype.ValueTypeName="bool",yn.prototype.ValueBufferType=Array,yn.prototype.DefaultInterpolation=tl,yn.prototype.InterpolantFactoryMethodLinear=void 0,yn.prototype.InterpolantFactoryMethodSmooth=void 0;class p0 extends jr{}p0.prototype.ValueTypeName="color";class Oa extends jr{}Oa.prototype.ValueTypeName="number";class Wx extends bl{constructor(e,t,r,s){super(e,t,r,s)}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=(r-t)/(s-t);let c=e*o;for(let h=c+o;c!==h;c+=4)Qe.slerpFlat(a,0,n,c-o,n,c,l);return a}}class us extends jr{InterpolantFactoryMethodLinear(e){return new Wx(this.times,this.values,this.getValueSize(),e)}}us.prototype.ValueTypeName="quaternion",us.prototype.DefaultInterpolation=Vn,us.prototype.InterpolantFactoryMethodSmooth=void 0;class xn extends jr{}xn.prototype.ValueTypeName="string",xn.prototype.ValueBufferType=Array,xn.prototype.DefaultInterpolation=tl,xn.prototype.InterpolantFactoryMethodLinear=void 0,xn.prototype.InterpolantFactoryMethodSmooth=void 0;class Na extends jr{}Na.prototype.ValueTypeName="vector";class Rn{constructor(e="",t=-1,r=[],s=2500){this.name=e,this.tracks=r,this.duration=t,this.blendMode=s,this.uuid=hr(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,s=1/(e.fps||1);for(let n=0,o=r.length;n!==o;++n)t.push(UT(r[n]).scale(s));const a=new this(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a}static toJSON(e){const t=[],r=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let a=0,n=r.length;a!==n;++a)t.push(jr.toJSON(r[a]));return s}static CreateFromMorphTargetSequence(e,t,r,s){const a=t.length,n=[];for(let o=0;o<a;o++){let l=[],c=[];l.push((o+a-1)%a,o,(o+1)%a),c.push(0,1,0);const h=Hx(l);l=Jf(l,1,h),c=Jf(c,1,h),s||l[0]!==0||(l.push(a),c.push(c[0])),n.push(new Oa(".morphTargetInfluences["+t[o].name+"]",l,c).scale(1/r))}return new this(e,-1,n)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const s=e;r=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<r.length;s++)if(r[s].name===t)return r[s];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const s={},a=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],h=c.name.match(a);if(h&&h.length>1){const u=h[1];let d=s[u];d||(s[u]=d=[]),d.push(c)}}const n=[];for(const o in s)n.push(this.CreateFromMorphTargetSequence(o,s[o],t,r));return n}static parseAnimation(e,t){if(!e)return null;const r=function(h,u,d,p,f){if(d.length!==0){const g=[],m=[];u0(d,g,m,p),g.length!==0&&f.push(new h(u,g,m))}},s=[],a=e.name||"default",n=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const u=c[h].keys;if(u&&u.length!==0)if(u[0].morphTargets){const d={};let p;for(p=0;p<u.length;p++)if(u[p].morphTargets)for(let f=0;f<u[p].morphTargets.length;f++)d[u[p].morphTargets[f]]=-1;for(const f in d){const g=[],m=[];for(let v=0;v!==u[p].morphTargets.length;++v){const _=u[p];g.push(_.time),m.push(_.morphTarget===f?1:0)}s.push(new Oa(".morphTargetInfluence["+f+"]",g,m))}l=d.length*n}else{const d=".bones["+t[h].name+"]";r(Na,d+".position",u,"pos",s),r(us,d+".quaternion",u,"rot",s),r(Na,d+".scale",u,"scl",s)}}return s.length===0?null:new this(a,l,s,o)}resetDuration(){let e=0;for(let t=0,r=this.tracks.length;t!==r;++t){const s=this.tracks[t];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function UT(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Oa;case"vector":case"vector2":case"vector3":case"vector4":return Na;case"color":return p0;case"quaternion":return us;case"bool":case"boolean":return yn;case"string":return xn}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(i.type);if(i.times===void 0){const t=[],r=[];u0(i.keys,t,r,"value"),i.times=t,i.values=r}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const Fs={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class eg{constructor(e,t,r){const s=this;let a=!1,n=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(h){o++,a===!1&&s.onStart!==void 0&&s.onStart(h,n,o),a=!0},this.itemEnd=function(h){n++,s.onProgress!==void 0&&s.onProgress(h,n,o),n===o&&(a=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(h){s.onError!==void 0&&s.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=c.length;u<d;u+=2){const p=c[u],f=c[u+1];if(p.global&&(p.lastIndex=0),p.test(h))return f}return null}}}const m0=new eg;class Bt{constructor(e){this.manager=e!==void 0?e:m0,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(s,a){r.load(e,s,t,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Bt.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ps={};class kT extends Error{constructor(e,t){super(e),this.response=t}}class xi extends Bt{constructor(e){super(e)}load(e,t,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=Fs.get(e);if(a!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(a),this.manager.itemEnd(e)},0),a;if(Ps[e]!==void 0)return void Ps[e].push({onLoad:t,onProgress:r,onError:s});Ps[e]=[],Ps[e].push({onLoad:t,onProgress:r,onError:s});const n=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,l=this.responseType;fetch(n).then(c=>{if(c.status===200||c.status===0){if(c.status,typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=Ps[e],u=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),p=d?parseInt(d):0,f=p!==0;let g=0;const m=new ReadableStream({start(v){(function _(){u.read().then(({done:y,value:x})=>{if(y)v.close();else{g+=x.byteLength;const b=new ProgressEvent("progress",{lengthComputable:f,loaded:g,total:p});for(let M=0,T=h.length;M<T;M++){const A=h[M];A.onProgress&&A.onProgress(b)}v.enqueue(x),_()}})})()}});return new Response(m)}throw new kT(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,o));case"json":return c.json();default:if(o===void 0)return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),u=h&&h[1]?h[1].toLowerCase():void 0,d=new TextDecoder(u);return c.arrayBuffer().then(p=>d.decode(p))}}}).then(c=>{Fs.add(e,c);const h=Ps[e];delete Ps[e];for(let u=0,d=h.length;u<d;u++){const p=h[u];p.onLoad&&p.onLoad(c)}}).catch(c=>{const h=Ps[e];if(h===void 0)throw this.manager.itemError(e),c;delete Ps[e];for(let u=0,d=h.length;u<d;u++){const p=h[u];p.onError&&p.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class dc extends Bt{constructor(e){super(e)}load(e,t,r,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,n=Fs.get(e);if(n!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(n),a.manager.itemEnd(e)},0),n;const o=Rc("img");function l(){h(),Fs.add(e,this),t&&t(this),a.manager.itemEnd(e)}function c(u){h(),s&&s(u),a.manager.itemError(e),a.manager.itemEnd(e)}function h(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),a.manager.itemStart(e),o.src=e,o}}class tg extends Bt{constructor(e){super(e)}load(e,t,r,s){const a=new Ic;a.colorSpace=Mt;const n=new dc(this.manager);n.setCrossOrigin(this.crossOrigin),n.setPath(this.path);let o=0;function l(c){n.load(e[c],function(h){a.images[c]=h,o++,o===6&&(a.needsUpdate=!0,t&&t(a))},void 0,s)}for(let c=0;c<e.length;++c)l(c);return a}}class gs extends Bt{constructor(e){super(e)}load(e,t,r,s){const a=new yt,n=new dc(this.manager);return n.setCrossOrigin(this.crossOrigin),n.setPath(this.path),n.load(e,function(o){a.image=o,a.needsUpdate=!0,t!==void 0&&t(a)},r,s),a}}class qs extends Ve{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ve(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class ig extends qs{constructor(e,t,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ve.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ve(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const mm=new Me,R_=new C,I_=new C;class f0{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new se(512,512),this.map=null,this.mapPass=null,this.matrix=new Me,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new oh,this._frameExtents=new se(1,1),this._viewportCount=1,this._viewports=[new qe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;R_.setFromMatrixPosition(e.matrixWorld),t.position.copy(R_),I_.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(I_),t.updateMatrixWorld(),mm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(mm),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(mm)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class FT extends f0{constructor(){super(new Zt(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,r=2*il*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;r===t.fov&&s===t.aspect&&a===t.far||(t.fov=r,t.aspect=s,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Nc extends qs{constructor(e,t,r=0,s=Math.PI/3,a=0,n=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ve.DEFAULT_UP),this.updateMatrix(),this.target=new Ve,this.distance=r,this.angle=s,this.penumbra=a,this.decay=n,this.map=null,this.shadow=new FT}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const L_=new Me,kl=new C,fm=new C;class zT extends f0{constructor(){super(new Zt(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new se(4,2),this._viewportCount=6,this._viewports=[new qe(2,1,1,1),new qe(0,1,1,1),new qe(3,1,1,1),new qe(1,1,1,1),new qe(3,0,1,1),new qe(1,0,1,1)],this._cubeDirections=[new C(1,0,0),new C(-1,0,0),new C(0,0,1),new C(0,0,-1),new C(0,1,0),new C(0,-1,0)],this._cubeUps=[new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,0,1),new C(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,s=this.matrix,a=e.distance||r.far;a!==r.far&&(r.far=a,r.updateProjectionMatrix()),kl.setFromMatrixPosition(e.matrixWorld),r.position.copy(kl),fm.copy(r.position),fm.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(fm),r.updateMatrixWorld(),s.makeTranslation(-kl.x,-kl.y,-kl.z),L_.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(L_)}}class hl extends qs{constructor(e,t,r=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=s,this.shadow=new zT}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class BT extends f0{constructor(){super(new Gn(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Uc extends qs{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ve.DEFAULT_UP),this.updateMatrix(),this.target=new Ve,this.shadow=new BT}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class fd extends qs{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class rg extends qs{constructor(e,t,r=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class Xx{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new C)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,s=e.y,a=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.282095),t.addScaledVector(n[1],.488603*s),t.addScaledVector(n[2],.488603*a),t.addScaledVector(n[3],.488603*r),t.addScaledVector(n[4],r*s*1.092548),t.addScaledVector(n[5],s*a*1.092548),t.addScaledVector(n[6],.315392*(3*a*a-1)),t.addScaledVector(n[7],r*a*1.092548),t.addScaledVector(n[8],.546274*(r*r-s*s)),t}getIrradianceAt(e,t){const r=e.x,s=e.y,a=e.z,n=this.coefficients;return t.copy(n[0]).multiplyScalar(.886227),t.addScaledVector(n[1],1.023328*s),t.addScaledVector(n[2],1.023328*a),t.addScaledVector(n[3],1.023328*r),t.addScaledVector(n[4],.858086*r*s),t.addScaledVector(n[5],.858086*s*a),t.addScaledVector(n[6],.743125*a*a-.247708),t.addScaledVector(n[7],.858086*r*a),t.addScaledVector(n[8],.429043*(r*r-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].fromArray(e,t+3*s);return this}toArray(e=[],t=0){const r=this.coefficients;for(let s=0;s<9;s++)r[s].toArray(e,t+3*s);return e}static getBasisAt(e,t){const r=e.x,s=e.y,a=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*a,t[3]=.488603*r,t[4]=1.092548*r*s,t[5]=1.092548*s*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*r*a,t[8]=.546274*(r*r-s*s)}}class D_ extends qs{constructor(e=new Xx,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class gd extends Bt{constructor(e){super(e),this.textures={}}load(e,t,r,s){const a=this,n=new xi(a.manager);n.setPath(a.path),n.setRequestHeader(a.requestHeader),n.setWithCredentials(a.withCredentials),n.load(e,function(o){try{t(a.parse(JSON.parse(o)))}catch(l){s&&s(l),a.manager.itemError(e)}},r,s)}parse(e){const t=this.textures;function r(a){return t[a],t[a]}const s=gd.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new ve().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(s.dispersion=e.dispersion),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const a in e.uniforms){const n=e.uniforms[a];switch(s.uniforms[a]={},n.type){case"t":s.uniforms[a].value=r(n.value);break;case"c":s.uniforms[a].value=new ve().setHex(n.value);break;case"v2":s.uniforms[a].value=new se().fromArray(n.value);break;case"v3":s.uniforms[a].value=new C().fromArray(n.value);break;case"v4":s.uniforms[a].value=new qe().fromArray(n.value);break;case"m3":s.uniforms[a].value=new ke().fromArray(n.value);break;case"m4":s.uniforms[a].value=new Me().fromArray(n.value);break;default:s.uniforms[a].value=n.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const a in e.extensions)s.extensions[a]=e.extensions[a];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=r(e.map)),e.matcap!==void 0&&(s.matcap=r(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let a=e.normalScale;Array.isArray(a)===!1&&(a=[a,a]),s.normalScale=new se().fromArray(a)}return e.displacementMap!==void 0&&(s.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=r(e.envMap)),e.envMapRotation!==void 0&&s.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new se().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=r(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){return new{ShadowMaterial:Fx,SpriteMaterial:t0,RawShaderMaterial:c0,ShaderMaterial:at,PointsMaterial:ga,MeshPhysicalMaterial:dr,MeshStandardMaterial:cl,MeshPhongMaterial:Xn,MeshToonMaterial:h0,MeshNormalMaterial:gp,MeshLambertMaterial:vp,MeshDepthMaterial:op,MeshDistanceMaterial:e0,MeshBasicMaterial:Qt,MeshMatcapMaterial:zx,LineDashedMaterial:Bx,LineBasicMaterial:Wt,Material:$t}[e]}}class ds{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let r=0,s=e.length;r<s;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class g0 extends Ie{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class O_ extends Bt{constructor(e){super(e)}load(e,t,r,s){const a=this,n=new xi(a.manager);n.setPath(a.path),n.setRequestHeader(a.requestHeader),n.setWithCredentials(a.withCredentials),n.load(e,function(o){try{t(a.parse(JSON.parse(o)))}catch(l){s&&s(l),a.manager.itemError(e)}},r,s)}parse(e){const t={},r={};function s(u,d){if(t[d]!==void 0)return t[d];const p=u.interleavedBuffers[d],f=function(v,_){if(r[_]!==void 0)return r[_];const y=v.arrayBuffers,x=y[_],b=new Uint32Array(x).buffer;return r[_]=b,b}(u,p.buffer),g=Ro(p.type,f),m=new ch(g,p.stride);return m.uuid=p.uuid,t[d]=m,m}const a=e.isInstancedBufferGeometry?new g0:new Ie,n=e.data.index;if(n!==void 0){const u=Ro(n.type,n.array);a.setIndex(new Ke(u,1))}const o=e.data.attributes;for(const u in o){const d=o[u];let p;if(d.isInterleavedBufferAttribute){const f=s(e.data,d.data);p=new qi(f,d.itemSize,d.offset,d.normalized)}else{const f=Ro(d.type,d.array);p=new(d.isInstancedBufferAttribute?Pn:Ke)(f,d.itemSize,d.normalized)}d.name!==void 0&&(p.name=d.name),d.usage!==void 0&&p.setUsage(d.usage),a.setAttribute(u,p)}const l=e.data.morphAttributes;if(l)for(const u in l){const d=l[u],p=[];for(let f=0,g=d.length;f<g;f++){const m=d[f];let v;if(m.isInterleavedBufferAttribute){const _=s(e.data,m.data);v=new qi(_,m.itemSize,m.offset,m.normalized)}else{const _=Ro(m.type,m.array);v=new Ke(_,m.itemSize,m.normalized)}m.name!==void 0&&(v.name=m.name),p.push(v)}a.morphAttributes[u]=p}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(c!==void 0)for(let u=0,d=c.length;u!==d;++u){const p=c[u];a.addGroup(p.start,p.count,p.materialIndex)}const h=e.data.boundingSphere;if(h!==void 0){const u=new C;h.center!==void 0&&u.fromArray(h.center),a.boundingSphere=new oi(u,h.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}const VT={UVMapping:Jd,CubeReflectionMapping:Hs,CubeRefractionMapping:La,EquirectangularReflectionMapping:el,EquirectangularRefractionMapping:wc,CubeUVReflectionMapping:yl},N_={RepeatWrapping:Kt,ClampToEdgeWrapping:bi,MirroredRepeatWrapping:Da},U_={NearestFilter:lt,NearestMipmapNearestFilter:ep,NearestMipmapLinearFilter:Mn,LinearFilter:qt,LinearMipmapNearestFilter:Vo,LinearMipmapLinearFilter:hs};class qx extends Bt{constructor(e){super(e),this.isImageBitmapLoader=!0,this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,n=Fs.get(e);if(n!==void 0)return a.manager.itemStart(e),n.then?void n.then(c=>{t&&t(c),a.manager.itemEnd(e)}).catch(c=>{s&&s(c)}):(setTimeout(function(){t&&t(n),a.manager.itemEnd(e)},0),n);const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const l=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(c){return Fs.add(e,c),t&&t(c),a.manager.itemEnd(e),c}).catch(function(c){s&&s(c),Fs.remove(e),a.manager.itemError(e),a.manager.itemEnd(e)});Fs.add(e,l),a.manager.itemStart(e)}}let du;class gm{static getContext(){return du===void 0&&(du=new(window.AudioContext||window.webkitAudioContext)),du}static setContext(e){du=e}}const k_=new Me,F_=new Me,Ja=new Me;class kc{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=z_(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=z_();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function z_(){return(typeof performance>"u"?Date:performance).now()}const en=new C,B_=new Qe,HT=new C,tn=new C;class V_ extends Ve{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0||this.hasPlaybackControl===!1)return;this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl!==!1&&this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const rn=new C,H_=new Qe,GT=new C,sn=new C;class Yx{constructor(e,t,r){let s,a,n;switch(this.binding=e,this.valueSize=r,t){case"quaternion":s=this._slerp,a=this._slerpAdditive,n=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":s=this._select,a=this._select,n=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:s=this._lerp,a=this._lerpAdditive,n=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=a,this._setIdentity=n,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,s=this.valueSize,a=e*s+s;let n=this.cumulativeWeight;if(n===0){for(let o=0;o!==s;++o)r[a+o]=r[o];n=t}else{n+=t;const o=t/n;this._mixBufferRegion(r,a,0,o,s)}this.cumulativeWeight=n}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,s=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,s=e*t+t,a=this.cumulativeWeight,n=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const l=t*this._origIndex;this._mixBufferRegion(r,s,l,1-a,t)}n>0&&this._mixBufferRegionAdditive(r,s,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(r[l]!==r[l+t]){o.setValue(r,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,r=this.valueSize,s=r*this._origIndex;e.getValue(t,s);for(let a=r,n=s;a!==n;++a)t[a]=t[s+a%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,s,a){if(s>=.5)for(let n=0;n!==a;++n)e[t+n]=e[r+n]}_slerp(e,t,r,s){Qe.slerpFlat(e,t,e,t,e,r,s)}_slerpAdditive(e,t,r,s,a){const n=this._workIndex*a;Qe.multiplyQuaternionsFlat(e,n,e,t,e,r),Qe.slerpFlat(e,t,e,t,e,n,s)}_lerp(e,t,r,s,a){const n=1-s;for(let o=0;o!==a;++o){const l=t+o;e[l]=e[l]*n+e[r+o]*s}}_lerpAdditive(e,t,r,s,a){for(let n=0;n!==a;++n){const o=t+n;e[o]=e[o]+e[r+n]*s}}}const v0="\\[\\]\\.:\\/",jT=new RegExp("["+v0+"]","g"),vm="[^"+v0+"]",WT="[^"+v0.replace("\\.","")+"]",XT=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",vm)+/(WCOD+)?/.source.replace("WCOD",WT)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",vm)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",vm)+"$"),qT=["material","materials","bones","map"];class Ye{constructor(e,t,r){this.path=t,this.parsedPath=r||Ye.parseTrackName(t),this.node=Ye.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,r){return e&&e.isAnimationObjectGroup?new Ye.Composite(e,t,r):new Ye(e,t,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(jT,"")}static parseTrackName(e){const t=XT.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const a=r.nodeName.substring(s+1);qT.indexOf(a)!==-1&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=a)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){const r=function(a){for(let n=0;n<a.length;n++){const o=a[n];if(o.name===t||o.uuid===t)return o;const l=r(o.children);if(l)return l}return null},s=r(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)e[t++]=r[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const r=this.resolvedProperty;for(let s=0,a=r.length;s!==a;++s)r[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,r=t.objectName,s=t.propertyName;let a=t.propertyIndex;if(e||(e=Ye.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return;if(r){let c=t.objectIndex;switch(r){case"materials":if(!e.material||!e.material.materials)return;e=e.material.materials;break;case"bones":if(!e.skeleton)return;e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===c){c=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material||!e.material.map)return;e=e.material.map;break;default:if(e[r]===void 0)return;e=e[r]}if(c!==void 0){if(e[c]===void 0)return;e=e[c]}}const n=e[s];if(n===void 0){t.nodeName;return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(a!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry||!e.geometry.morphAttributes)return;e.morphTargetDictionary[a]!==void 0&&(a=e.morphTargetDictionary[a])}l=this.BindingType.ArrayElement,this.resolvedProperty=n,this.propertyIndex=a}else n.fromArray!==void 0&&n.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(l=this.BindingType.EntireArray,this.resolvedProperty=n):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ye.Composite=class{constructor(i,e,t){const r=t||Ye.parseTrackName(e);this._targetGroup=i,this._bindings=i.subscribe_(e,r)}getValue(i,e){this.bind();const t=this._targetGroup.nCachedObjects_,r=this._bindings[t];r!==void 0&&r.getValue(i,e)}setValue(i,e){const t=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=t.length;r!==s;++r)t[r].setValue(i,e)}bind(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].bind()}unbind(){const i=this._bindings;for(let e=this._targetGroup.nCachedObjects_,t=i.length;e!==t;++e)i[e].unbind()}},Ye.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ye.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ye.prototype.GetterByBindingType=[Ye.prototype._getValue_direct,Ye.prototype._getValue_array,Ye.prototype._getValue_arrayElement,Ye.prototype._getValue_toArray],Ye.prototype.SetterByBindingTypeAndVersioning=[[Ye.prototype._setValue_direct,Ye.prototype._setValue_direct_setNeedsUpdate,Ye.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ye.prototype._setValue_array,Ye.prototype._setValue_array_setNeedsUpdate,Ye.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ye.prototype._setValue_arrayElement,Ye.prototype._setValue_arrayElement_setNeedsUpdate,Ye.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ye.prototype._setValue_fromArray,Ye.prototype._setValue_fromArray_setNeedsUpdate,Ye.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Zx{constructor(e,t,r=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=s;const a=t.tracks,n=a.length,o=new Array(n),l={endingStart:wn,endingEnd:wn};for(let c=0;c!==n;++c){const h=a[c].createInterpolant(null);o[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Zg,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const s=this._clip.duration,a=e._clip.duration,n=a/s,o=s/a;e.warp(1,n,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const s=this._mixer,a=s.time,n=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=s._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=a,l[1]=a+r,c[0]=e/n,c[1]=t/n,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,s){if(!this.enabled)return void this._updateWeight(e);const a=this._startTime;if(a!==null){const l=(e-a)*r;l<0||r===0?t=0:(this._startTime=null,t=r*l)}t*=this._updateTimeScale(e);const n=this._updateTime(t),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;if(this.blendMode===Kg)for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(n),c[h].accumulateAdditive(o);else for(let h=0,u=l.length;h!==u;++h)l[h].evaluate(n),c[h].accumulate(s,o)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(r!==null){const s=r.evaluate(e)[0];t*=s,e>r.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;r!==null&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let s=this.time+e,a=this._loopCount;const n=r===2202;if(e===0)return a===-1||!n||1&~a?s:t-s;if(r===Yg){a===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else{if(!(s<0)){this.time=s;break e}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(a===-1&&(e>=0?(a=0,this._setEndings(!0,this.repetitions===0,n)):this._setEndings(this.repetitions===0,!0,n)),s>=t||s<0){const o=Math.floor(s/t);s-=t*o,a+=Math.abs(o);const l=this.repetitions-a;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,n)}else this._setEndings(!1,!1,n);this._loopCount=a,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(n&&!(1&~a))return t-s}return s}_setEndings(e,t,r){const s=this._interpolantSettings;r?(s.endingStart=Sn,s.endingEnd=Sn):(s.endingStart=e?this.zeroSlopeAtStart?Sn:wn:Sc,s.endingEnd=t?this.zeroSlopeAtEnd?Sn:wn:Sc)}_scheduleFading(e,t,r){const s=this._mixer,a=s.time;let n=this._weightInterpolant;n===null&&(n=s._lendControlInterpolant(),this._weightInterpolant=n);const o=n.parameterPositions,l=n.sampleValues;return o[0]=a,l[0]=t,o[1]=a+e,l[1]=r,this}}const YT=new Float32Array(1);class Kx extends fs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,s=e._clip.tracks,a=s.length,n=e._propertyBindings,o=e._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let u=0;u!==a;++u){const d=s[u],p=d.name;let f=h[p];if(f!==void 0)++f.referenceCount,n[u]=f;else{if(f=n[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,l,p));continue}const g=t&&t._propertyBindings[u].binding.parsedPath;f=new Yx(Ye.create(r,p,g),d.ValueTypeName,d.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,l,p),n[u]=f}o[u].resultBuffer=f.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,s=e._clip.uuid,a=this._actionsByClip[s];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,s,r)}const t=e._propertyBindings;for(let r=0,s=t.length;r!==s;++r){const a=t[r];a.useCount++==0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,s=t.length;r!==s;++r){const a=t[r];--a.useCount==0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,r){const s=this._actions,a=this._actionsByClip;let n=a[t];if(n===void 0)n={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=n;else{const o=n.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=s.length,s.push(e),n.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],s=e._cacheIndex;r._cacheIndex=s,t[s]=r,t.pop(),e._cacheIndex=null;const a=e._clip.uuid,n=this._actionsByClip,o=n[a],l=o.knownActions,c=l[l.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],l.length===0&&delete n[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,s=t.length;r!==s;++r){const a=t[r];--a.referenceCount==0&&this._removeInactiveBinding(a)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,s=this._nActiveActions++,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,s=--this._nActiveActions,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_addInactiveBinding(e,t,r){const s=this._bindingsByRootAndName,a=this._bindings;let n=s[t];n===void 0&&(n={},s[t]=n),n[r]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,s=r.rootNode.uuid,a=r.path,n=this._bindingsByRootAndName,o=n[s],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete o[a],Object.keys(o).length===0&&delete n[s]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,s=this._nActiveBindings++,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,s=--this._nActiveBindings,a=t[s];e._cacheIndex=s,t[s]=e,a._cacheIndex=r,t[r]=a}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return r===void 0&&(r=new d0(new Float32Array(2),new Float32Array(2),1,YT),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,s=--this._nActiveControlInterpolants,a=t[s];e.__cacheIndex=s,t[s]=e,a.__cacheIndex=r,t[r]=a}clipAction(e,t,r){const s=t||this._root,a=s.uuid;let n=typeof e=="string"?Rn.findByName(s,e):e;const o=n!==null?n.uuid:e,l=this._actionsByClip[o];let c=null;if(r===void 0&&(r=n!==null?n.blendMode:hx),l!==void 0){const u=l.actionByRoot[a];if(u!==void 0&&u.blendMode===r)return u;c=l.knownActions[0],n===null&&(n=c._clip)}if(n===null)return null;const h=new Zx(this,n,t,r);return this._bindAction(h,c),this._addInactiveAction(h,o,a),h}existingAction(e,t){const r=t||this._root,s=r.uuid,a=typeof e=="string"?Rn.findByName(r,e):e,n=a?a.uuid:e,o=this._actionsByClip[n];return o!==void 0&&o.actionByRoot[s]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,r=this._nActiveActions,s=this.time+=e,a=Math.sign(e),n=this._accuIndex^=1;for(let c=0;c!==r;++c)t[c]._update(s,e,a,n);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(n);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,s=this._actionsByClip,a=s[r];if(a!==void 0){const n=a.knownActions;for(let o=0,l=n.length;o!==l;++o){const c=n[o];this._deactivateAction(c);const h=c._cacheIndex,u=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,u._cacheIndex=h,t[h]=u,t.pop(),this._removeInactiveBindingsForAction(c)}delete s[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const a in r){const n=r[a].actionByRoot[t];n!==void 0&&(this._deactivateAction(n),this._removeInactiveAction(n))}const s=this._bindingsByRootAndName[t];if(s!==void 0)for(const a in s){const n=s[a];n.restoreOriginalState(),this._removeInactiveBinding(n)}}uncacheAction(e,t){const r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class _0{constructor(e){this.value=e}clone(){return new _0(this.value.clone===void 0?this.value:this.value.clone())}}let ZT=0;class vd extends ch{constructor(e,t,r=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const G_=new Me;class _p{constructor(e,t,r=0,s=1/0){this.ray=new Kn(e,t),this.near=r,this.far=s,this.camera=null,this.layers=new rp,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera&&(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t)}setFromXRController(e){return G_.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(G_),this}intersectObject(e,t=!0,r=[]){return sg(e,this,r,t),r.sort(j_),r}intersectObjects(e,t=!0,r=[]){for(let s=0,a=e.length;s<a;s++)sg(e[s],this,r,t);return r.sort(j_),r}}function j_(i,e){return i.distance-e.distance}function sg(i,e,t,r){if(i.layers.test(e.layers)&&i.raycast(e,t),r===!0){const s=i.children;for(let a=0,n=s.length;a<n;a++)sg(s[a],e,t,!0)}}class ag{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(zt(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const W_=new se,X_=new C,pu=new C;class Qx{constructor(e=new C,t=new C){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){X_.subVectors(e,this.start),pu.subVectors(this.end,this.start);const r=pu.dot(pu);let s=pu.dot(X_)/r;return t&&(s=zt(s,0,1)),s}closestPointToPoint(e,t,r){const s=this.closestPointToPointParameter(e,t);return this.delta(r).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const q_=new C,na=new C,mu=new Me,_m=new Me;function $x(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,$x(i.children[t]));return e}const KT=new C,Y_=new ve,Z_=new ve;class Jx extends tr{constructor(e=10,t=10,r=4473924,s=8947848){r=new ve(r),s=new ve(s);const a=t/2,n=e/t,o=e/2,l=[],c=[];for(let u=0,d=0,p=-o;u<=t;u++,p+=n){l.push(-o,0,p,o,0,p),l.push(p,0,-o,p,0,o);const f=u===a?r:s;f.toArray(c,d),d+=3,f.toArray(c,d),d+=3,f.toArray(c,d),d+=3,f.toArray(c,d),d+=3}const h=new Ie;h.setAttribute("position",new Se(l,3)),h.setAttribute("color",new Se(c,3)),super(h,new Wt({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const K_=new C,fu=new C,Q_=new C,gu=new C,kt=new ap;function Ht(i,e,t,r,s,a,n){gu.set(s,a,n).unproject(r);const o=e[i];if(o!==void 0){const l=t.getAttribute("position");for(let c=0,h=o.length;c<h;c++)l.setXYZ(o[c],gu.x,gu.y,gu.z)}}const vu=new Tt;class eb extends tr{constructor(e,t=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Ie;s.setIndex(new Ke(r,1)),s.setAttribute("position",new Se([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(s,new Wt({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class tb extends di{constructor(e,t=1,r=16776960){const s=r,a=new Ie;a.setAttribute("position",new Se([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),a.computeBoundingSphere(),super(a,new Wt({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const n=new Ie;n.setAttribute("position",new Se([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),n.computeBoundingSphere(),this.add(new ye(n,new Qt({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const $_=new C;let _u,ym;class ib extends tr{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new Ie;r.setAttribute("position",new Se(t,3)),r.setAttribute("color",new Se([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(r,new Wt({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,r){const s=new ve,a=this.geometry.attributes.color.array;return s.set(e),s.toArray(a,0),s.toArray(a,3),s.set(t),s.toArray(a,6),s.toArray(a,9),s.set(r),s.toArray(a,12),s.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class rb{constructor(){this.type="ShapePath",this.color=new ve,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new ll,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,r,s){return this.currentPath.quadraticCurveTo(e,t,r,s),this}bezierCurveTo(e,t,r,s,a,n){return this.currentPath.bezierCurveTo(e,t,r,s,a,n),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(m,v){const _=v.length;let y=!1;for(let x=_-1,b=0;b<_;x=b++){let M=v[x],T=v[b],A=T.x-M.x,L=T.y-M.y;if(Math.abs(L)>Number.EPSILON){if(L<0&&(M=v[b],A=-A,T=v[x],L=-L),m.y<M.y||m.y>T.y)continue;if(m.y===M.y){if(m.x===M.x)return!0}else{const U=L*(m.x-M.x)-A*(m.y-M.y);if(U===0)return!0;if(U<0)continue;y=!y}}else{if(m.y!==M.y)continue;if(T.x<=m.x&&m.x<=M.x||M.x<=m.x&&m.x<=T.x)return!0}}return y}const r=Gr.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,n,o;const l=[];if(s.length===1)return n=s[0],o=new Aa,o.curves=n.curves,l.push(o),l;let c=!r(s[0].getPoints());c=e?!c:c;const h=[],u=[];let d,p,f=[],g=0;u[g]=void 0,f[g]=[];for(let m=0,v=s.length;m<v;m++)n=s[m],d=n.getPoints(),a=r(d),a=e?!a:a,a?(!c&&u[g]&&g++,u[g]={s:new Aa,p:d},u[g].s.curves=n.curves,c&&g++,f[g]=[]):f[g].push({h:n,p:d[0]});if(!u[0])return function(m){const v=[];for(let _=0,y=m.length;_<y;_++){const x=m[_],b=new Aa;b.curves=x.curves,v.push(b)}return v}(s);if(u.length>1){let m=!1,v=0;for(let _=0,y=u.length;_<y;_++)h[_]=[];for(let _=0,y=u.length;_<y;_++){const x=f[_];for(let b=0;b<x.length;b++){const M=x[b];let T=!0;for(let A=0;A<u.length;A++)t(M.p,u[A].p)&&(_!==A&&v++,T?(T=!1,h[A].push(M)):m=!0);T&&h[_].push(M)}}v>0&&m===!1&&(f=h)}for(let m=0,v=u.length;m<v;m++){o=u[m].s,l.push(o),p=f[m];for(let _=0,y=p.length;_<y;_++)o.holes.push(p[_].h)}return l}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:cd}})),typeof window<"u"&&(window.__THREE__||(window.__THREE__=cd));const J_=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Qd,AddEquation:ar,AddOperation:lx,AdditiveAnimationBlendMode:Kg,AdditiveBlending:Vs,AgXToneMapping:$d,AlphaFormat:1021,AlwaysCompare:519,AlwaysDepth:1,AlwaysStencilFunc:519,AmbientLight:fd,AnimationAction:Zx,AnimationClip:Rn,AnimationLoader:class extends Bt{constructor(i){super(i)}load(i,e,t,r){const s=this,a=new xi(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(i,function(n){try{e(s.parse(JSON.parse(n)))}catch(o){r&&r(o),s.manager.itemError(i)}},t,r)}parse(i){const e=[];for(let t=0;t<i.length;t++){const r=Rn.parse(i[t]);e.push(r)}return e}},AnimationMixer:Kx,AnimationObjectGroup:class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=hr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const i={};this._indicesByUUID=i;for(let t=0,r=arguments.length;t!==r;++t)i[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const i=this._objects,e=this._indicesByUUID,t=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length;let n=i.length,o=this.nCachedObjects_;for(let l=0,c=arguments.length;l!==c;++l){const h=arguments[l],u=h.uuid;let d=e[u];if(d===void 0){d=n++,e[u]=d,i.push(h);for(let p=0,f=a;p!==f;++p)s[p].push(new Ye(h,t[p],r[p]))}else if(d<o){i[d];const p=--o,f=i[p];e[f.uuid]=d,i[d]=f,e[u]=p,i[p]=h;for(let g=0,m=a;g!==m;++g){const v=s[g],_=v[p];let y=v[d];v[d]=_,y===void 0&&(y=new Ye(h,t[g],r[g])),v[p]=y}}else i[d]}this.nCachedObjects_=o}remove(){const i=this._objects,e=this._indicesByUUID,t=this._bindings,r=t.length;let s=this.nCachedObjects_;for(let a=0,n=arguments.length;a!==n;++a){const o=arguments[a],l=o.uuid,c=e[l];if(c!==void 0&&c>=s){const h=s++,u=i[h];e[u.uuid]=c,i[c]=u,e[l]=h,i[h]=o;for(let d=0,p=r;d!==p;++d){const f=t[d],g=f[h],m=f[c];f[c]=g,f[h]=m}}}this.nCachedObjects_=s}uncache(){const i=this._objects,e=this._indicesByUUID,t=this._bindings,r=t.length;let s=this.nCachedObjects_,a=i.length;for(let n=0,o=arguments.length;n!==o;++n){const l=arguments[n].uuid,c=e[l];if(c!==void 0)if(delete e[l],c<s){const h=--s,u=i[h],d=--a,p=i[d];e[u.uuid]=c,i[c]=u,e[p.uuid]=h,i[h]=p,i.pop();for(let f=0,g=r;f!==g;++f){const m=t[f],v=m[h],_=m[d];m[c]=v,m[h]=_,m.pop()}}else{const h=--a,u=i[h];h>0&&(e[u.uuid]=c),i[c]=u,i.pop();for(let d=0,p=r;d!==p;++d){const f=t[d];f[c]=f[h],f.pop()}}}this.nCachedObjects_=s}subscribe_(i,e){const t=this._bindingsIndicesByPath;let r=t[i];const s=this._bindings;if(r!==void 0)return s[r];const a=this._paths,n=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);r=s.length,t[i]=r,a.push(i),n.push(e),s.push(h);for(let u=c,d=o.length;u!==d;++u){const p=o[u];h[u]=new Ye(p,i,e)}return h}unsubscribe_(i){const e=this._bindingsIndicesByPath,t=e[i];if(t!==void 0){const r=this._paths,s=this._parsedPaths,a=this._bindings,n=a.length-1,o=a[n];e[i[n]]=t,a[t]=o,a.pop(),s[t]=s[n],s.pop(),r[t]=r[n],r.pop()}}},AnimationUtils:NT,ArcCurve:Ix,ArrayCamera:Ax,ArrowHelper:class extends Ve{constructor(i=new C(0,0,1),e=new C(0,0,0),t=1,r=16776960,s=.2*t,a=.2*s){super(),this.type="ArrowHelper",_u===void 0&&(_u=new Ie,_u.setAttribute("position",new Se([0,0,0,0,1,0],3)),ym=new Ft(0,.5,1,5,1),ym.translate(0,-.5,0)),this.position.copy(e),this.line=new di(_u,new Wt({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ye(ym,new Qt({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(t,s,a)}setDirection(i){if(i.y>.99999)this.quaternion.set(0,0,0,1);else if(i.y<-.99999)this.quaternion.set(1,0,0,0);else{$_.set(i.z,0,-i.x).normalize();const e=Math.acos(i.y);this.quaternion.setFromAxisAngle($_,e)}}setLength(i,e=.2*i,t=.2*e){this.line.scale.set(1,Math.max(1e-4,i-e),1),this.line.updateMatrix(),this.cone.scale.set(t,e,t),this.cone.position.y=i,this.cone.updateMatrix()}setColor(i){this.line.material.color.set(i),this.cone.material.color.set(i)}copy(i){return super.copy(i,!1),this.line.copy(i.line),this.cone.copy(i.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},AttachedBindMode:ff,Audio:V_,AudioAnalyser:class{constructor(i,e=2048){this.analyser=i.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),i.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let i=0;const e=this.getFrequencyData();for(let t=0;t<e.length;t++)i+=e[t];return i/e.length}},AudioContext:gm,AudioListener:class extends Ve{constructor(){super(),this.type="AudioListener",this.context=gm.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new kc}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(i){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=i,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(i){return this.gain.gain.setTargetAtTime(i,this.context.currentTime,.01),this}updateMatrixWorld(i){super.updateMatrixWorld(i);const e=this.context.listener,t=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(en,B_,HT),tn.set(0,0,-1).applyQuaternion(B_),e.positionX){const r=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(en.x,r),e.positionY.linearRampToValueAtTime(en.y,r),e.positionZ.linearRampToValueAtTime(en.z,r),e.forwardX.linearRampToValueAtTime(tn.x,r),e.forwardY.linearRampToValueAtTime(tn.y,r),e.forwardZ.linearRampToValueAtTime(tn.z,r),e.upX.linearRampToValueAtTime(t.x,r),e.upY.linearRampToValueAtTime(t.y,r),e.upZ.linearRampToValueAtTime(t.z,r)}else e.setPosition(en.x,en.y,en.z),e.setOrientation(tn.x,tn.y,tn.z,t.x,t.y,t.z)}},AudioLoader:class extends Bt{constructor(i){super(i)}load(i,e,t,r){const s=this,a=new xi(this.manager);function n(o){r&&r(o),s.manager.itemError(i)}a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(i,function(o){try{const l=o.slice(0);gm.getContext().decodeAudioData(l,function(c){e(c)}).catch(n)}catch(l){n(l)}},t,r)}},AxesHelper:ib,BackSide:Ri,BasicDepthPacking:3200,BasicShadowMap:0,BatchedMesh:g_,Bone:nl,BooleanKeyframeTrack:yn,Box2:class{constructor(i=new se(1/0,1/0),e=new se(-1/0,-1/0)){this.isBox2=!0,this.min=i,this.max=e}set(i,e){return this.min.copy(i),this.max.copy(e),this}setFromPoints(i){this.makeEmpty();for(let e=0,t=i.length;e<t;e++)this.expandByPoint(i[e]);return this}setFromCenterAndSize(i,e){const t=W_.copy(e).multiplyScalar(.5);return this.min.copy(i).sub(t),this.max.copy(i).add(t),this}clone(){return new this.constructor().copy(this)}copy(i){return this.min.copy(i.min),this.max.copy(i.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(i){return this.isEmpty()?i.set(0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(i){return this.isEmpty()?i.set(0,0):i.subVectors(this.max,this.min)}expandByPoint(i){return this.min.min(i),this.max.max(i),this}expandByVector(i){return this.min.sub(i),this.max.add(i),this}expandByScalar(i){return this.min.addScalar(-i),this.max.addScalar(i),this}containsPoint(i){return!(i.x<this.min.x||i.x>this.max.x||i.y<this.min.y||i.y>this.max.y)}containsBox(i){return this.min.x<=i.min.x&&i.max.x<=this.max.x&&this.min.y<=i.min.y&&i.max.y<=this.max.y}getParameter(i,e){return e.set((i.x-this.min.x)/(this.max.x-this.min.x),(i.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(i){return!(i.max.x<this.min.x||i.min.x>this.max.x||i.max.y<this.min.y||i.min.y>this.max.y)}clampPoint(i,e){return e.copy(i).clamp(this.min,this.max)}distanceToPoint(i){return this.clampPoint(i,W_).distanceTo(i)}intersect(i){return this.min.max(i.min),this.max.min(i.max),this.isEmpty()&&this.makeEmpty(),this}union(i){return this.min.min(i.min),this.max.max(i.max),this}translate(i){return this.min.add(i),this.max.add(i),this}equals(i){return i.min.equals(this.min)&&i.max.equals(this.max)}},Box3:Tt,Box3Helper:eb,BoxGeometry:Lt,BoxHelper:class extends tr{constructor(i,e=16776960){const t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),s=new Ie;s.setIndex(new Ke(t,1)),s.setAttribute("position",new Ke(r,3)),super(s,new Wt({color:e,toneMapped:!1})),this.object=i,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(i){if(this.object!==void 0&&vu.setFromObject(this.object),vu.isEmpty())return;const e=vu.min,t=vu.max,r=this.geometry.attributes.position,s=r.array;s[0]=t.x,s[1]=t.y,s[2]=t.z,s[3]=e.x,s[4]=t.y,s[5]=t.z,s[6]=e.x,s[7]=e.y,s[8]=t.z,s[9]=t.x,s[10]=e.y,s[11]=t.z,s[12]=t.x,s[13]=t.y,s[14]=e.z,s[15]=e.x,s[16]=t.y,s[17]=e.z,s[18]=e.x,s[19]=e.y,s[20]=e.z,s[21]=t.x,s[22]=e.y,s[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(i){return this.object=i,this.update(),this}copy(i,e){return super.copy(i,e),this.object=i.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BufferAttribute:Ke,BufferGeometry:Ie,BufferGeometryLoader:O_,ByteType:1010,Cache:Fs,Camera:ap,CameraHelper:class extends tr{constructor(i){const e=new Ie,t=new Wt({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],a={};function n(p,f){o(p),o(f)}function o(p){r.push(0,0,0),s.push(0,0,0),a[p]===void 0&&(a[p]=[]),a[p].push(r.length/3-1)}n("n1","n2"),n("n2","n4"),n("n4","n3"),n("n3","n1"),n("f1","f2"),n("f2","f4"),n("f4","f3"),n("f3","f1"),n("n1","f1"),n("n2","f2"),n("n3","f3"),n("n4","f4"),n("p","n1"),n("p","n2"),n("p","n3"),n("p","n4"),n("u1","u2"),n("u2","u3"),n("u3","u1"),n("c","t"),n("p","c"),n("cn1","cn2"),n("cn3","cn4"),n("cf1","cf2"),n("cf3","cf4"),e.setAttribute("position",new Se(r,3)),e.setAttribute("color",new Se(s,3)),super(e,t),this.type="CameraHelper",this.camera=i,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const l=new ve(16755200),c=new ve(16711680),h=new ve(43775),u=new ve(16777215),d=new ve(3355443);this.setColors(l,c,h,u,d)}setColors(i,e,t,r,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,i.r,i.g,i.b),a.setXYZ(1,i.r,i.g,i.b),a.setXYZ(2,i.r,i.g,i.b),a.setXYZ(3,i.r,i.g,i.b),a.setXYZ(4,i.r,i.g,i.b),a.setXYZ(5,i.r,i.g,i.b),a.setXYZ(6,i.r,i.g,i.b),a.setXYZ(7,i.r,i.g,i.b),a.setXYZ(8,i.r,i.g,i.b),a.setXYZ(9,i.r,i.g,i.b),a.setXYZ(10,i.r,i.g,i.b),a.setXYZ(11,i.r,i.g,i.b),a.setXYZ(12,i.r,i.g,i.b),a.setXYZ(13,i.r,i.g,i.b),a.setXYZ(14,i.r,i.g,i.b),a.setXYZ(15,i.r,i.g,i.b),a.setXYZ(16,i.r,i.g,i.b),a.setXYZ(17,i.r,i.g,i.b),a.setXYZ(18,i.r,i.g,i.b),a.setXYZ(19,i.r,i.g,i.b),a.setXYZ(20,i.r,i.g,i.b),a.setXYZ(21,i.r,i.g,i.b),a.setXYZ(22,i.r,i.g,i.b),a.setXYZ(23,i.r,i.g,i.b),a.setXYZ(24,e.r,e.g,e.b),a.setXYZ(25,e.r,e.g,e.b),a.setXYZ(26,e.r,e.g,e.b),a.setXYZ(27,e.r,e.g,e.b),a.setXYZ(28,e.r,e.g,e.b),a.setXYZ(29,e.r,e.g,e.b),a.setXYZ(30,e.r,e.g,e.b),a.setXYZ(31,e.r,e.g,e.b),a.setXYZ(32,t.r,t.g,t.b),a.setXYZ(33,t.r,t.g,t.b),a.setXYZ(34,t.r,t.g,t.b),a.setXYZ(35,t.r,t.g,t.b),a.setXYZ(36,t.r,t.g,t.b),a.setXYZ(37,t.r,t.g,t.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const i=this.geometry,e=this.pointMap;kt.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ht("c",e,i,kt,0,0,-1),Ht("t",e,i,kt,0,0,1),Ht("n1",e,i,kt,-1,-1,-1),Ht("n2",e,i,kt,1,-1,-1),Ht("n3",e,i,kt,-1,1,-1),Ht("n4",e,i,kt,1,1,-1),Ht("f1",e,i,kt,-1,-1,1),Ht("f2",e,i,kt,1,-1,1),Ht("f3",e,i,kt,-1,1,1),Ht("f4",e,i,kt,1,1,1),Ht("u1",e,i,kt,.7,1.1,-1),Ht("u2",e,i,kt,-.7,1.1,-1),Ht("u3",e,i,kt,0,2,-1),Ht("cf1",e,i,kt,-1,0,1),Ht("cf2",e,i,kt,1,0,1),Ht("cf3",e,i,kt,0,-1,1),Ht("cf4",e,i,kt,0,1,1),Ht("cn1",e,i,kt,-1,0,-1),Ht("cn2",e,i,kt,1,0,-1),Ht("cn3",e,i,kt,0,-1,-1),Ht("cn4",e,i,kt,0,1,-1),i.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},CanvasTexture:class extends yt{constructor(i,e,t,r,s,a,n,o,l){super(i,e,t,r,s,a,n,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},CapsuleGeometry:uh,CatmullRomCurve3:cp,CineonToneMapping:Kd,CircleGeometry:dh,ClampToEdgeWrapping:bi,Clock:kc,Color:ve,ColorKeyframeTrack:p0,ColorManagement:ct,CompressedArrayTexture:class extends au{constructor(i,e,t,r,s,a){super(i,e,t,s,a),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=bi}},CompressedCubeTexture:class extends au{constructor(i,e,t){super(void 0,i[0].width,i[0].height,e,t,Hs),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=i}},CompressedTexture:au,CompressedTextureLoader:class extends Bt{constructor(i){super(i)}load(i,e,t,r){const s=this,a=[],n=new au,o=new xi(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(s.withCredentials);let l=0;function c(h){o.load(i[h],function(u){const d=s.parse(u,!0);a[h]={width:d.width,height:d.height,format:d.format,mipmaps:d.mipmaps},l+=1,l===6&&(d.mipmapCount===1&&(n.minFilter=qt),n.image=a,n.format=d.format,n.needsUpdate=!0,e&&e(n))},t,r)}if(Array.isArray(i))for(let h=0,u=i.length;h<u;++h)c(h);else o.load(i,function(h){const u=s.parse(h,!0);if(u.isCubemap){const d=u.mipmaps.length/u.mipmapCount;for(let p=0;p<d;p++){a[p]={mipmaps:[]};for(let f=0;f<u.mipmapCount;f++)a[p].mipmaps.push(u.mipmaps[p*u.mipmapCount+f]),a[p].format=u.format,a[p].width=u.width,a[p].height=u.height}n.image=a}else n.image.width=u.width,n.image.height=u.height,n.mipmaps=u.mipmaps;u.mipmapCount===1&&(n.minFilter=qt),n.format=u.format,n.needsUpdate=!0,e&&e(n)},t,r);return n}},ConeGeometry:ph,ConstantAlphaFactor:213,ConstantColorFactor:211,CubeCamera:_x,CubeReflectionMapping:Hs,CubeRefractionMapping:La,CubeTexture:Ic,CubeTextureLoader:tg,CubeUVReflectionMapping:yl,CubicBezierCurve:r0,CubicBezierCurve3:Lx,CubicInterpolant:Gx,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,CullFaceNone:0,Curve:Cr,CurvePath:Ox,CustomBlending:$o,CustomToneMapping:zg,CylinderGeometry:Ft,Cylindrical:class{constructor(i=1,e=0,t=0){return this.radius=i,this.theta=e,this.y=t,this}set(i,e,t){return this.radius=i,this.theta=e,this.y=t,this}copy(i){return this.radius=i.radius,this.theta=i.theta,this.y=i.y,this}setFromVector3(i){return this.setFromCartesianCoords(i.x,i.y,i.z)}setFromCartesianCoords(i,e,t){return this.radius=Math.sqrt(i*i+t*t),this.theta=Math.atan2(i,t),this.y=e,this}clone(){return new this.constructor().copy(this)}},Data3DTexture:jf,DataArrayTexture:hd,DataTexture:pa,DataTextureLoader:class extends Bt{constructor(i){super(i)}load(i,e,t,r){const s=this,a=new pa,n=new xi(this.manager);return n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setPath(this.path),n.setWithCredentials(s.withCredentials),n.load(i,function(o){let l;try{l=s.parse(o)}catch(c){if(r===void 0)return;r(c)}l.image!==void 0?a.image=l.image:l.data!==void 0&&(a.image.width=l.width,a.image.height=l.height,a.image.data=l.data),a.wrapS=l.wrapS!==void 0?l.wrapS:bi,a.wrapT=l.wrapT!==void 0?l.wrapT:bi,a.magFilter=l.magFilter!==void 0?l.magFilter:qt,a.minFilter=l.minFilter!==void 0?l.minFilter:qt,a.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.colorSpace!==void 0&&(a.colorSpace=l.colorSpace),l.flipY!==void 0&&(a.flipY=l.flipY),l.format!==void 0&&(a.format=l.format),l.type!==void 0&&(a.type=l.type),l.mipmaps!==void 0&&(a.mipmaps=l.mipmaps,a.minFilter=hs),l.mipmapCount===1&&(a.minFilter=qt),l.generateMipmaps!==void 0&&(a.generateMipmaps=l.generateMipmaps),a.needsUpdate=!0,e&&e(a,l)},t,r),a}},DataUtils:LS,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:m0,DepthFormat:An,DepthStencilFormat:Bn,DepthTexture:lh,DetachedBindMode:cx,DirectionalLight:Uc,DirectionalLightHelper:class extends Ve{constructor(i,e,t){super(),this.light=i,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="DirectionalLightHelper",e===void 0&&(e=1);let r=new Ie;r.setAttribute("position",new Se([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const s=new Wt({fog:!1,toneMapped:!1});this.lightPlane=new di(r,s),this.add(this.lightPlane),r=new Ie,r.setAttribute("position",new Se([0,0,0,0,0,1],3)),this.targetLine=new di(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),K_.setFromMatrixPosition(this.light.matrixWorld),fu.setFromMatrixPosition(this.light.target.matrixWorld),Q_.subVectors(fu,K_),this.lightPlane.lookAt(fu),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(fu),this.targetLine.scale.z=Q_.length()}},DiscreteInterpolant:jx,DisplayP3ColorSpace:ip,DodecahedronGeometry:hp,DoubleSide:Rt,DstAlphaFactor:rh,DstColorFactor:sh,DynamicCopyUsage:35050,DynamicDrawUsage:35048,DynamicReadUsage:35049,EdgesGeometry:Nx,EllipseCurve:lp,EqualCompare:514,EqualDepth:4,EqualStencilFunc:514,EquirectangularReflectionMapping:el,EquirectangularRefractionMapping:wc,Euler:Ct,EventDispatcher:fs,ExtrudeGeometry:Qn,FileLoader:xi,Float16BufferAttribute:class extends Ke{constructor(i,e,t){super(new Uint16Array(i),e,t),this.isFloat16BufferAttribute=!0}getX(i){let e=ec(this.array[i*this.itemSize]);return this.normalized&&(e=zi(e,this.array)),e}setX(i,e){return this.normalized&&(e=Be(e,this.array)),this.array[i*this.itemSize]=Gi(e),this}getY(i){let e=ec(this.array[i*this.itemSize+1]);return this.normalized&&(e=zi(e,this.array)),e}setY(i,e){return this.normalized&&(e=Be(e,this.array)),this.array[i*this.itemSize+1]=Gi(e),this}getZ(i){let e=ec(this.array[i*this.itemSize+2]);return this.normalized&&(e=zi(e,this.array)),e}setZ(i,e){return this.normalized&&(e=Be(e,this.array)),this.array[i*this.itemSize+2]=Gi(e),this}getW(i){let e=ec(this.array[i*this.itemSize+3]);return this.normalized&&(e=zi(e,this.array)),e}setW(i,e){return this.normalized&&(e=Be(e,this.array)),this.array[i*this.itemSize+3]=Gi(e),this}setXY(i,e,t){return i*=this.itemSize,this.normalized&&(e=Be(e,this.array),t=Be(t,this.array)),this.array[i+0]=Gi(e),this.array[i+1]=Gi(t),this}setXYZ(i,e,t,r){return i*=this.itemSize,this.normalized&&(e=Be(e,this.array),t=Be(t,this.array),r=Be(r,this.array)),this.array[i+0]=Gi(e),this.array[i+1]=Gi(t),this.array[i+2]=Gi(r),this}setXYZW(i,e,t,r,s){return i*=this.itemSize,this.normalized&&(e=Be(e,this.array),t=Be(t,this.array),r=Be(r,this.array),s=Be(s,this.array)),this.array[i+0]=Gi(e),this.array[i+1]=Gi(t),this.array[i+2]=Gi(r),this.array[i+3]=Gi(s),this}},Float32BufferAttribute:Se,FloatType:wr,Fog:al,FogExp2:sl,FramebufferTexture:class extends yt{constructor(i,e){super({width:i,height:e}),this.isFramebufferTexture=!0,this.magFilter=lt,this.minFilter=lt,this.generateMipmaps=!1,this.needsUpdate=!0}},FrontSide:Er,Frustum:oh,GLBufferAttribute:class{constructor(i,e,t,r,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=i,this.type=e,this.itemSize=t,this.elementSize=r,this.count=s,this.version=0}set needsUpdate(i){i===!0&&this.version++}setBuffer(i){return this.buffer=i,this}setType(i,e){return this.type=i,this.elementSize=e,this}setItemSize(i){return this.itemSize=i,this}setCount(i){return this.count=i,this}},GLSL1:"100",GLSL3:Hf,GreaterCompare:516,GreaterDepth:6,GreaterEqualCompare:518,GreaterEqualDepth:5,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:Jx,Group:Mi,HalfFloatType:Yt,HemisphereLight:ig,HemisphereLightHelper:class extends Ve{constructor(i,e,t){super(),this.light=i,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="HemisphereLightHelper";const r=new ks(e);r.rotateY(.5*Math.PI),this.material=new Qt({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),a=new Float32Array(3*s.count);r.setAttribute("color",new Ke(a,3)),this.add(new ye(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const i=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=i.geometry.getAttribute("color");Y_.copy(this.light.color),Z_.copy(this.light.groundColor);for(let t=0,r=e.count;t<r;t++){const s=t<r/2?Y_:Z_;e.setXYZ(t,s.r,s.g,s.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),i.lookAt(KT.setFromMatrixPosition(this.light.matrixWorld).negate())}},IcosahedronGeometry:dp,ImageBitmapLoader:qx,ImageLoader:dc,ImageUtils:mx,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:Pn,InstancedBufferGeometry:g0,InstancedInterleavedBuffer:vd,InstancedMesh:Yf,Int16BufferAttribute:class extends Ke{constructor(i,e,t){super(new Int16Array(i),e,t)}},Int32BufferAttribute:class extends Ke{constructor(i,e,t){super(new Int32Array(i),e,t)}},Int8BufferAttribute:class extends Ke{constructor(i,e,t){super(new Int8Array(i),e,t)}},IntType:Vg,InterleavedBuffer:ch,InterleavedBufferAttribute:qi,Interpolant:bl,InterpolateDiscrete:tl,InterpolateLinear:Vn,InterpolateSmooth:$u,InvertStencilOp:5386,KeepStencilOp:pn,KeyframeTrack:jr,LOD:a_,LatheGeometry:hh,Layers:rp,LessCompare:513,LessDepth:2,LessEqualCompare:515,LessEqualDepth:3,LessEqualStencilFunc:515,LessStencilFunc:513,Light:qs,LightProbe:D_,Line:di,Line3:Qx,LineBasicMaterial:Wt,LineCurve:s0,LineCurve3:Dx,LineDashedMaterial:Bx,LineLoop:Zf,LineSegments:tr,LinearDisplayP3ColorSpace:nh,LinearFilter:qt,LinearInterpolant:d0,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:hs,LinearMipmapNearestFilter:Vo,LinearSRGBColorSpace:si,LinearToneMapping:Yd,LinearTransfer:Tc,Loader:Bt,LoaderUtils:ds,LoadingManager:eg,LoopOnce:Yg,LoopPingPong:2202,LoopRepeat:Zg,LuminanceAlphaFormat:1025,LuminanceFormat:1024,MOUSE:un,Material:$t,MaterialLoader:gd,MathUtils:ni,Matrix3:ke,Matrix4:Me,MaxEquation:104,Mesh:ye,MeshBasicMaterial:Qt,MeshDepthMaterial:op,MeshDistanceMaterial:e0,MeshLambertMaterial:vp,MeshMatcapMaterial:zx,MeshNormalMaterial:gp,MeshPhongMaterial:Xn,MeshPhysicalMaterial:dr,MeshStandardMaterial:cl,MeshToonMaterial:h0,MinEquation:103,MirroredRepeatWrapping:Da,MixOperation:ox,MultiplyBlending:4,MultiplyOperation:ah,NearestFilter:lt,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:Mn,NearestMipmapNearestFilter:ep,NeutralToneMapping:Bg,NeverCompare:512,NeverDepth:0,NeverStencilFunc:512,NoBlending:0,NoColorSpace:vn,NoToneMapping:cs,NormalAnimationBlendMode:hx,NormalBlending:1,NotEqualCompare:517,NotEqualDepth:7,NotEqualStencilFunc:517,NumberKeyframeTrack:Oa,Object3D:Ve,ObjectLoader:class extends Bt{constructor(i){super(i)}load(i,e,t,r){const s=this,a=this.path===""?ds.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||a;const n=new xi(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(i,function(o){let l=null;try{l=JSON.parse(o)}catch(h){return void(r!==void 0&&r(h))}const c=l.metadata;c!==void 0&&c.type!==void 0&&c.type.toLowerCase()!=="geometry"?s.parse(l,e):r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+i))},t,r)}loadAsync(i,e){return os(this,null,function*(){const t=this.path===""?ds.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||t;const r=new xi(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const s=yield r.loadAsync(i,e),a=JSON.parse(s),n=a.metadata;if(n===void 0||n.type===void 0||n.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+i);return yield this.parseAsync(a)})}parse(i,e){const t=this.parseAnimations(i.animations),r=this.parseShapes(i.shapes),s=this.parseGeometries(i.geometries,r),a=this.parseImages(i.images,function(){e!==void 0&&e(l)}),n=this.parseTextures(i.textures,a),o=this.parseMaterials(i.materials,n),l=this.parseObject(i.object,s,o,n,t),c=this.parseSkeletons(i.skeletons,l);if(this.bindSkeletons(l,c),e!==void 0){let h=!1;for(const u in a)if(a[u].data instanceof HTMLImageElement){h=!0;break}h===!1&&e(l)}return l}parseAsync(i){return os(this,null,function*(){const e=this.parseAnimations(i.animations),t=this.parseShapes(i.shapes),r=this.parseGeometries(i.geometries,t),s=yield this.parseImagesAsync(i.images),a=this.parseTextures(i.textures,s),n=this.parseMaterials(i.materials,a),o=this.parseObject(i.object,r,n,a,e),l=this.parseSkeletons(i.skeletons,o);return this.bindSkeletons(o,l),o})}parseShapes(i){const e={};if(i!==void 0)for(let t=0,r=i.length;t<r;t++){const s=new Aa().fromJSON(i[t]);e[s.uuid]=s}return e}parseSkeletons(i,e){const t={},r={};if(e.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),i!==void 0)for(let s=0,a=i.length;s<a;s++){const n=new ol().fromJSON(i[s],r);t[n.uuid]=n}return t}parseGeometries(i,e){const t={};if(i!==void 0){const r=new O_;for(let s=0,a=i.length;s<a;s++){let n;const o=i[s];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":n=r.parse(o);break;default:o.type in P_&&(n=P_[o.type].fromJSON(o,e))}n.uuid=o.uuid,o.name!==void 0&&(n.name=o.name),o.userData!==void 0&&(n.userData=o.userData),t[o.uuid]=n}}return t}parseMaterials(i,e){const t={},r={};if(i!==void 0){const s=new gd;s.setTextures(e);for(let a=0,n=i.length;a<n;a++){const o=i[a];t[o.uuid]===void 0&&(t[o.uuid]=s.parse(o)),r[o.uuid]=t[o.uuid]}}return r}parseAnimations(i){const e={};if(i!==void 0)for(let t=0;t<i.length;t++){const r=i[t],s=Rn.parse(r);e[s.uuid]=s}return e}parseImages(i,e){const t=this,r={};let s;function a(n){if(typeof n=="string"){const o=n;return function(l){return t.manager.itemStart(l),s.load(l,function(){t.manager.itemEnd(l)},void 0,function(){t.manager.itemError(l),t.manager.itemEnd(l)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:t.resourcePath+o)}return n.data?{data:Ro(n.type,n.data),width:n.width,height:n.height}:null}if(i!==void 0&&i.length>0){const n=new eg(e);s=new dc(n),s.setCrossOrigin(this.crossOrigin);for(let o=0,l=i.length;o<l;o++){const c=i[o],h=c.url;if(Array.isArray(h)){const u=[];for(let d=0,p=h.length;d<p;d++){const f=a(h[d]);f!==null&&(f instanceof HTMLImageElement?u.push(f):u.push(new pa(f.data,f.width,f.height)))}r[c.uuid]=new _n(u)}else{const u=a(c.url);r[c.uuid]=new _n(u)}}}return r}parseImagesAsync(i){return os(this,null,function*(){const e=this,t={};let r;function s(a){return os(this,null,function*(){if(typeof a=="string"){const n=a,o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return yield r.loadAsync(o)}return a.data?{data:Ro(a.type,a.data),width:a.width,height:a.height}:null})}if(i!==void 0&&i.length>0){r=new dc(this.manager),r.setCrossOrigin(this.crossOrigin);for(let a=0,n=i.length;a<n;a++){const o=i[a],l=o.url;if(Array.isArray(l)){const c=[];for(let h=0,u=l.length;h<u;h++){const d=l[h],p=yield s(d);p!==null&&(p instanceof HTMLImageElement?c.push(p):c.push(new pa(p.data,p.width,p.height)))}t[o.uuid]=new _n(c)}else{const c=yield s(o.url);t[o.uuid]=new _n(c)}}}return t})}parseTextures(i,e){function t(s,a){return typeof s=="number"?s:a[s]}const r={};if(i!==void 0)for(let s=0,a=i.length;s<a;s++){const n=i[s];n.image,e[n.image];const o=e[n.image],l=o.data;let c;Array.isArray(l)?(c=new Ic,l.length===6&&(c.needsUpdate=!0)):(c=l&&l.data?new pa:new yt,l&&(c.needsUpdate=!0)),c.source=o,c.uuid=n.uuid,n.name!==void 0&&(c.name=n.name),n.mapping!==void 0&&(c.mapping=t(n.mapping,VT)),n.channel!==void 0&&(c.channel=n.channel),n.offset!==void 0&&c.offset.fromArray(n.offset),n.repeat!==void 0&&c.repeat.fromArray(n.repeat),n.center!==void 0&&c.center.fromArray(n.center),n.rotation!==void 0&&(c.rotation=n.rotation),n.wrap!==void 0&&(c.wrapS=t(n.wrap[0],N_),c.wrapT=t(n.wrap[1],N_)),n.format!==void 0&&(c.format=n.format),n.internalFormat!==void 0&&(c.internalFormat=n.internalFormat),n.type!==void 0&&(c.type=n.type),n.colorSpace!==void 0&&(c.colorSpace=n.colorSpace),n.minFilter!==void 0&&(c.minFilter=t(n.minFilter,U_)),n.magFilter!==void 0&&(c.magFilter=t(n.magFilter,U_)),n.anisotropy!==void 0&&(c.anisotropy=n.anisotropy),n.flipY!==void 0&&(c.flipY=n.flipY),n.generateMipmaps!==void 0&&(c.generateMipmaps=n.generateMipmaps),n.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=n.premultiplyAlpha),n.unpackAlignment!==void 0&&(c.unpackAlignment=n.unpackAlignment),n.compareFunction!==void 0&&(c.compareFunction=n.compareFunction),n.userData!==void 0&&(c.userData=n.userData),r[n.uuid]=c}return r}parseObject(i,e,t,r,s){let a,n,o;function l(u){return e[u],e[u]}function c(u){if(u!==void 0){if(Array.isArray(u)){const d=[];for(let p=0,f=u.length;p<f;p++){const g=u[p];t[g],d.push(t[g])}return d}return t[u],t[u]}}function h(u){return r[u],r[u]}switch(i.type){case"Scene":a=new qf,i.background!==void 0&&(Number.isInteger(i.background)?a.background=new ve(i.background):a.background=h(i.background)),i.environment!==void 0&&(a.environment=h(i.environment)),i.fog!==void 0&&(i.fog.type==="Fog"?a.fog=new al(i.fog.color,i.fog.near,i.fog.far):i.fog.type==="FogExp2"&&(a.fog=new sl(i.fog.color,i.fog.density)),i.fog.name!==""&&(a.fog.name=i.fog.name)),i.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=i.backgroundBlurriness),i.backgroundIntensity!==void 0&&(a.backgroundIntensity=i.backgroundIntensity),i.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(i.backgroundRotation),i.environmentIntensity!==void 0&&(a.environmentIntensity=i.environmentIntensity),i.environmentRotation!==void 0&&a.environmentRotation.fromArray(i.environmentRotation);break;case"PerspectiveCamera":a=new Zt(i.fov,i.aspect,i.near,i.far),i.focus!==void 0&&(a.focus=i.focus),i.zoom!==void 0&&(a.zoom=i.zoom),i.filmGauge!==void 0&&(a.filmGauge=i.filmGauge),i.filmOffset!==void 0&&(a.filmOffset=i.filmOffset),i.view!==void 0&&(a.view=Object.assign({},i.view));break;case"OrthographicCamera":a=new Gn(i.left,i.right,i.top,i.bottom,i.near,i.far),i.zoom!==void 0&&(a.zoom=i.zoom),i.view!==void 0&&(a.view=Object.assign({},i.view));break;case"AmbientLight":a=new fd(i.color,i.intensity);break;case"DirectionalLight":a=new Uc(i.color,i.intensity);break;case"PointLight":a=new hl(i.color,i.intensity,i.distance,i.decay);break;case"RectAreaLight":a=new rg(i.color,i.intensity,i.width,i.height);break;case"SpotLight":a=new Nc(i.color,i.intensity,i.distance,i.angle,i.penumbra,i.decay);break;case"HemisphereLight":a=new ig(i.color,i.groundColor,i.intensity);break;case"LightProbe":a=new D_().fromJSON(i);break;case"SkinnedMesh":n=l(i.geometry),o=c(i.material),a=new ud(n,o),i.bindMode!==void 0&&(a.bindMode=i.bindMode),i.bindMatrix!==void 0&&a.bindMatrix.fromArray(i.bindMatrix),i.skeleton!==void 0&&(a.skeleton=i.skeleton);break;case"Mesh":n=l(i.geometry),o=c(i.material),a=new ye(n,o);break;case"InstancedMesh":n=l(i.geometry),o=c(i.material);const u=i.count,d=i.instanceMatrix,p=i.instanceColor;a=new Yf(n,o,u),a.instanceMatrix=new Pn(new Float32Array(d.array),16),p!==void 0&&(a.instanceColor=new Pn(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":n=l(i.geometry),o=c(i.material),a=new g_(i.maxGeometryCount,i.maxVertexCount,i.maxIndexCount,o),a.geometry=n,a.perObjectFrustumCulled=i.perObjectFrustumCulled,a.sortObjects=i.sortObjects,a._drawRanges=i.drawRanges,a._reservedRanges=i.reservedRanges,a._visibility=i.visibility,a._active=i.active,a._bounds=i.bounds.map(f=>{const g=new Tt;g.min.fromArray(f.boxMin),g.max.fromArray(f.boxMax);const m=new oi;return m.radius=f.sphereRadius,m.center.fromArray(f.sphereCenter),{boxInitialized:f.boxInitialized,box:g,sphereInitialized:f.sphereInitialized,sphere:m}}),a._maxGeometryCount=i.maxGeometryCount,a._maxVertexCount=i.maxVertexCount,a._maxIndexCount=i.maxIndexCount,a._geometryInitialized=i.geometryInitialized,a._geometryCount=i.geometryCount,a._matricesTexture=h(i.matricesTexture.uuid);break;case"LOD":a=new a_;break;case"Line":a=new di(l(i.geometry),c(i.material));break;case"LineLoop":a=new Zf(l(i.geometry),c(i.material));break;case"LineSegments":a=new tr(l(i.geometry),c(i.material));break;case"PointCloud":case"Points":a=new Ea(l(i.geometry),c(i.material));break;case"Sprite":a=new r_(c(i.material));break;case"Group":a=new Mi;break;case"Bone":a=new nl;break;default:a=new Ve}if(a.uuid=i.uuid,i.name!==void 0&&(a.name=i.name),i.matrix!==void 0?(a.matrix.fromArray(i.matrix),i.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=i.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(i.position!==void 0&&a.position.fromArray(i.position),i.rotation!==void 0&&a.rotation.fromArray(i.rotation),i.quaternion!==void 0&&a.quaternion.fromArray(i.quaternion),i.scale!==void 0&&a.scale.fromArray(i.scale)),i.up!==void 0&&a.up.fromArray(i.up),i.castShadow!==void 0&&(a.castShadow=i.castShadow),i.receiveShadow!==void 0&&(a.receiveShadow=i.receiveShadow),i.shadow&&(i.shadow.bias!==void 0&&(a.shadow.bias=i.shadow.bias),i.shadow.normalBias!==void 0&&(a.shadow.normalBias=i.shadow.normalBias),i.shadow.radius!==void 0&&(a.shadow.radius=i.shadow.radius),i.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(i.shadow.mapSize),i.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(i.shadow.camera))),i.visible!==void 0&&(a.visible=i.visible),i.frustumCulled!==void 0&&(a.frustumCulled=i.frustumCulled),i.renderOrder!==void 0&&(a.renderOrder=i.renderOrder),i.userData!==void 0&&(a.userData=i.userData),i.layers!==void 0&&(a.layers.mask=i.layers),i.children!==void 0){const u=i.children;for(let d=0;d<u.length;d++)a.add(this.parseObject(u[d],e,t,r,s))}if(i.animations!==void 0){const u=i.animations;for(let d=0;d<u.length;d++){const p=u[d];a.animations.push(s[p])}}if(i.type==="LOD"){i.autoUpdate!==void 0&&(a.autoUpdate=i.autoUpdate);const u=i.levels;for(let d=0;d<u.length;d++){const p=u[d],f=a.getObjectByProperty("uuid",p.object);f!==void 0&&a.addLevel(f,p.distance,p.hysteresis)}}return a}bindSkeletons(i,e){Object.keys(e).length!==0&&i.traverse(function(t){if(t.isSkinnedMesh===!0&&t.skeleton!==void 0){const r=e[t.skeleton];r===void 0||t.bind(r,t.bindMatrix)}})}},ObjectSpaceNormalMap:1,OctahedronGeometry:ks,OneFactor:ih,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:Xd,OneMinusDstColorFactor:qd,OneMinusSrcAlphaFactor:Ia,OneMinusSrcColorFactor:Wd,OrthographicCamera:Gn,P3Primaries:Ac,PCFShadowMap:Gd,PCFSoftShadowMap:Fg,PMREMGenerator:Wf,Path:ll,PerspectiveCamera:Zt,Plane:Br,PlaneGeometry:ys,PlaneHelper:tb,PointLight:hl,PointLightHelper:class extends ye{constructor(i,e,t){super(new Wn(e,4,2),new Qt({wireframe:!0,fog:!1,toneMapped:!1})),this.light=i,this.color=t,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:Ea,PointsMaterial:ga,PolarGridHelper:class extends tr{constructor(i=10,e=16,t=8,r=64,s=4473924,a=8947848){s=new ve(s),a=new ve(a);const n=[],o=[];if(e>1)for(let c=0;c<e;c++){const h=c/e*(2*Math.PI),u=Math.sin(h)*i,d=Math.cos(h)*i;n.push(0,0,0),n.push(u,0,d);const p=1&c?s:a;o.push(p.r,p.g,p.b),o.push(p.r,p.g,p.b)}for(let c=0;c<t;c++){const h=1&c?s:a,u=i-i/t*c;for(let d=0;d<r;d++){let p=d/r*(2*Math.PI),f=Math.sin(p)*u,g=Math.cos(p)*u;n.push(f,0,g),o.push(h.r,h.g,h.b),p=(d+1)/r*(2*Math.PI),f=Math.sin(p)*u,g=Math.cos(p)*u,n.push(f,0,g),o.push(h.r,h.g,h.b)}}const l=new Ie;l.setAttribute("position",new Se(n,3)),l.setAttribute("color",new Se(o,3)),super(l,new Wt({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},PolyhedronGeometry:Ba,PositionalAudio:class extends V_{constructor(i){super(i),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(i){return this.panner.refDistance=i,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(i){return this.panner.rolloffFactor=i,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(i){return this.panner.distanceModel=i,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(i){return this.panner.maxDistance=i,this}setDirectionalCone(i,e,t){return this.panner.coneInnerAngle=i,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=t,this}updateMatrixWorld(i){if(super.updateMatrixWorld(i),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(rn,H_,GT),sn.set(0,0,1).applyQuaternion(H_);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(rn.x,t),e.positionY.linearRampToValueAtTime(rn.y,t),e.positionZ.linearRampToValueAtTime(rn.z,t),e.orientationX.linearRampToValueAtTime(sn.x,t),e.orientationY.linearRampToValueAtTime(sn.y,t),e.orientationZ.linearRampToValueAtTime(sn.z,t)}else e.setPosition(rn.x,rn.y,rn.z),e.setOrientation(sn.x,sn.y,sn.z)}},PropertyBinding:Ye,PropertyMixer:Yx,QuadraticBezierCurve:a0,QuadraticBezierCurve3:n0,Quaternion:Qe,QuaternionKeyframeTrack:us,QuaternionLinearInterpolant:Wx,RED_GREEN_RGTC2_Format:Bf,RED_RGTC1_Format:36283,REVISION:cd,RGBADepthPacking:Qg,RGBAFormat:Hr,RGBAIntegerFormat:qg,RGBA_ASTC_10x10_Format:Of,RGBA_ASTC_10x5_Format:If,RGBA_ASTC_10x6_Format:Lf,RGBA_ASTC_10x8_Format:Df,RGBA_ASTC_12x10_Format:Nf,RGBA_ASTC_12x12_Format:Uf,RGBA_ASTC_4x4_Format:wf,RGBA_ASTC_5x4_Format:Sf,RGBA_ASTC_5x5_Format:Tf,RGBA_ASTC_6x5_Format:Ef,RGBA_ASTC_6x6_Format:Af,RGBA_ASTC_8x5_Format:Cf,RGBA_ASTC_8x6_Format:Pf,RGBA_ASTC_8x8_Format:Rf,RGBA_BPTC_Format:Qu,RGBA_ETC2_EAC_Format:Mf,RGBA_PVRTC_2BPPV1_Format:yf,RGBA_PVRTC_4BPPV1_Format:_f,RGBA_S3TC_DXT1_Format:Yu,RGBA_S3TC_DXT3_Format:Zu,RGBA_S3TC_DXT5_Format:Ku,RGBFormat:1022,RGB_BPTC_SIGNED_Format:kf,RGB_BPTC_UNSIGNED_Format:Ff,RGB_ETC1_Format:xf,RGB_ETC2_Format:bf,RGB_PVRTC_2BPPV1_Format:vf,RGB_PVRTC_4BPPV1_Format:gf,RGB_S3TC_DXT1_Format:qu,RGFormat:1030,RGIntegerFormat:Xg,RawShaderMaterial:c0,Ray:Kn,Raycaster:_p,Rec709Primaries:Ec,RectAreaLight:rg,RedFormat:jg,RedIntegerFormat:Wg,ReinhardToneMapping:Zd,RenderTarget:fx,RepeatWrapping:Kt,ReplaceStencilOp:7681,ReverseSubtractEquation:102,RingGeometry:mh,SIGNED_RED_GREEN_RGTC2_Format:Vf,SIGNED_RED_RGTC1_Format:zf,SRGBColorSpace:Mt,SRGBTransfer:bt,Scene:qf,ShaderChunk:He,ShaderLib:ki,ShaderMaterial:at,ShadowMaterial:Fx,Shape:Aa,ShapeGeometry:pp,ShapePath:rb,ShapeUtils:Gr,ShortType:1011,Skeleton:ol,SkeletonHelper:class extends tr{constructor(i){const e=$x(i),t=new Ie,r=[],s=[],a=new ve(0,0,1),n=new ve(0,1,0);for(let o=0;o<e.length;o++){const l=e[o];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(a.r,a.g,a.b),s.push(n.r,n.g,n.b))}t.setAttribute("position",new Se(r,3)),t.setAttribute("color",new Se(s,3)),super(t,new Wt({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=i,this.bones=e,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(i){const e=this.bones,t=this.geometry,r=t.getAttribute("position");_m.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<e.length;s++){const n=e[s];n.parent&&n.parent.isBone&&(mu.multiplyMatrices(_m,n.matrixWorld),na.setFromMatrixPosition(mu),r.setXYZ(a,na.x,na.y,na.z),mu.multiplyMatrices(_m,n.parent.matrixWorld),na.setFromMatrixPosition(mu),r.setXYZ(a+1,na.x,na.y,na.z),a+=2)}t.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(i)}dispose(){this.geometry.dispose(),this.material.dispose()}},SkinnedMesh:ud,Source:_n,Sphere:oi,SphereGeometry:Wn,Spherical:ag,SphericalHarmonics3:Xx,SplineCurve:o0,SpotLight:Nc,SpotLightHelper:class extends Ve{constructor(i,e){super(),this.light=i,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const t=new Ie,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,n=1,o=32;a<o;a++,n++){const l=a/o*Math.PI*2,c=n/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}t.setAttribute("position",new Se(r,3));const s=new Wt({fog:!1,toneMapped:!1});this.cone=new tr(t,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const i=this.light.distance?this.light.distance:1e3,e=i*Math.tan(this.light.angle);this.cone.scale.set(e,e,i),q_.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(q_),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:r_,SpriteMaterial:t0,SrcAlphaFactor:Ra,SrcAlphaSaturateFactor:210,SrcColorFactor:jd,StaticCopyUsage:35046,StaticDrawUsage:Cc,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Zt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Zt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(i){const e=this._cache;if(e.focus!==i.focus||e.fov!==i.fov||e.aspect!==i.aspect*this.aspect||e.near!==i.near||e.far!==i.far||e.zoom!==i.zoom||e.eyeSep!==this.eyeSep){e.focus=i.focus,e.fov=i.fov,e.aspect=i.aspect*this.aspect,e.near=i.near,e.far=i.far,e.zoom=i.zoom,e.eyeSep=this.eyeSep,Ja.copy(i.projectionMatrix);const t=e.eyeSep/2,r=t*e.near/e.focus,s=e.near*Math.tan(Cn*e.fov*.5)/e.zoom;let a,n;F_.elements[12]=-t,k_.elements[12]=t,a=-s*e.aspect+r,n=s*e.aspect+r,Ja.elements[0]=2*e.near/(n-a),Ja.elements[8]=(n+a)/(n-a),this.cameraL.projectionMatrix.copy(Ja),a=-s*e.aspect-r,n=s*e.aspect-r,Ja.elements[0]=2*e.near/(n-a),Ja.elements[8]=(n+a)/(n-a),this.cameraR.projectionMatrix.copy(Ja)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(F_),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(k_)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:xn,SubtractEquation:101,SubtractiveBlending:3,TOUCH:dn,TangentSpaceNormalMap:0,TetrahedronGeometry:mp,Texture:yt,TextureLoader:gs,TorusGeometry:ss,TorusKnotGeometry:fp,Triangle:nr,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeGeometry:Gs,UVMapping:Jd,Uint16BufferAttribute:sp,Uint32BufferAttribute:$g,Uint8BufferAttribute:class extends Ke{constructor(i,e,t){super(new Uint8Array(i),e,t)}},Uint8ClampedBufferAttribute:class extends Ke{constructor(i,e,t){super(new Uint8ClampedArray(i),e,t)}},Uniform:_0,UniformsGroup:class extends fs{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:ZT++}),this.name="",this.usage=Cc,this.uniforms=[]}add(i){return this.uniforms.push(i),this}remove(i){const e=this.uniforms.indexOf(i);return e!==-1&&this.uniforms.splice(e,1),this}setName(i){return this.name=i,this}setUsage(i){return this.usage=i,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(i){this.name=i.name,this.usage=i.usage;const e=i.uniforms;this.uniforms.length=0;for(let t=0,r=e.length;t<r;t++){const s=Array.isArray(e[t])?e[t]:[e[t]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}},UniformsLib:Te,UniformsUtils:ii,UnsignedByteType:Fn,UnsignedInt248Type:Zn,UnsignedInt5999Type:35902,UnsignedIntType:zn,UnsignedShort4444Type:Hg,UnsignedShort5551Type:Gg,UnsignedShortType:tp,VSMShadowMap:kr,Vector2:se,Vector3:C,Vector4:qe,VectorKeyframeTrack:Na,VideoTexture:Rx,WebGL3DRenderTarget:class extends pt{constructor(i=1,e=1,t=1,r={}){super(i,e,r),this.isWebGL3DRenderTarget=!0,this.depth=t,this.texture=new jf(null,i,e,t),this.texture.isRenderTargetTexture=!0}},WebGLArrayRenderTarget:class extends pt{constructor(i=1,e=1,t=1,r={}){super(i,e,r),this.isWebGLArrayRenderTarget=!0,this.depth=t,this.texture=new hd(null,i,e,t),this.texture.isRenderTargetTexture=!0}},WebGLCoordinateSystem:Hn,WebGLCubeRenderTarget:yx,WebGLMultipleRenderTargets:class extends pt{constructor(i=1,e=1,t=1,r={}){super(i,e,mi(Re({},r),{count:t})),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}},WebGLRenderTarget:pt,WebGLRenderer:Cx,WebGLUtils:Ex,WebGPUCoordinateSystem:Pc,WireframeGeometry:l0,WrapAroundEnding:Sc,ZeroCurvatureEnding:wn,ZeroFactor:Jo,ZeroSlopeEnding:Sn,ZeroStencilOp:0,createCanvasElement:dx},Symbol.toStringTag,{value:"Module"}));function Is(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}function sb(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}var y0,Ii,Pt,Dt,rs,ng,x0,ab,nb,Lo,Fc,Fl,yu,xm,ey,ty,iy,ur={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},ul={duration:.5,overwrite:!1,delay:0},zs=1e8,Hi=1e-8,og=2*Math.PI,QT=og/4,$T=0,ob=Math.sqrt,JT=Math.cos,eE=Math.sin,fi=function(i){return typeof i=="string"},Vt=function(i){return typeof i=="function"},js=function(i){return typeof i=="number"},b0=function(i){return i===void 0},vs=function(i){return typeof i=="object"},Zi=function(i){return i!==!1},M0=function(){return typeof window<"u"},xu=function(i){return Vt(i)||fi(i)},lb=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Ci=Array.isArray,lg=/(?:-?\.?\d|\.)+/gi,cb=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Do=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,bm=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,hb=/[+-]=-?[.\d]+/,ub=/[^,'"\[\]\s]+/gi,tE=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,lr={},_d={},db=function(i){return(_d=qn(i,lr))&&Qi},zc=function(i,e){return!e&&void 0},pb=function(i,e){return i&&(lr[i]=e)&&_d&&(_d[i]=e)||lr},Bc=function(){return 0},iE={suppressEvents:!0,isStart:!0,kill:!1},ed={suppressEvents:!0,kill:!1},rE={suppressEvents:!0},w0={},Ca=[],cg={},ir={},Mm={},ry=30,td=[],S0="",T0=function(i){var e,t,r=i[0];if(vs(r)||Vt(r)||(i=[i]),!(e=(r._gsap||{}).harness)){for(t=td.length;t--&&!td[t].targetTest(r););e=td[t]}for(t=i.length;t--;)i[t]&&(i[t]._gsap||(i[t]._gsap=new Ob(i[t],e)))||i.splice(t,1);return i},In=function(i){return i._gsap||T0(Sr(i))[0]._gsap},mb=function(i,e,t){return(t=i[e])&&Vt(t)?i[e]():b0(t)&&i.getAttribute&&i.getAttribute(e)||t},Yi=function(i,e){return(i=i.split(",")).forEach(e)||i},Xt=function(i){return Math.round(1e5*i)/1e5||0},pi=function(i){return Math.round(1e7*i)/1e7||0},Go=function(i,e){var t=e.charAt(0),r=parseFloat(e.substr(2));return i=parseFloat(i),t==="+"?i+r:t==="-"?i-r:t==="*"?i*r:i/r},sE=function(i,e){for(var t=e.length,r=0;i.indexOf(e[r])<0&&++r<t;);return r<t},yd=function(){var i,e,t=Ca.length,r=Ca.slice(0);for(cg={},Ca.length=0,i=0;i<t;i++)(e=r[i])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},fb=function(i,e,t,r){Ca.length&&!Ii&&yd(),i.render(e,t,Ii&&e<0&&(i._initted||i._startAt)),Ca.length&&!Ii&&yd()},gb=function(i){var e=parseFloat(i);return(e||e===0)&&(i+"").match(ub).length<2?e:fi(i)?i.trim():i},vb=function(i){return i},Ar=function(i,e){for(var t in e)t in i||(i[t]=e[t]);return i},qn=function(i,e){for(var t in e)i[t]=e[t];return i},sy=function i(e,t){for(var r in t)r!=="__proto__"&&r!=="constructor"&&r!=="prototype"&&(e[r]=vs(t[r])?i(e[r]||(e[r]={}),t[r]):t[r]);return e},xd=function(i,e){var t,r={};for(t in i)t in e||(r[t]=i[t]);return r},pc=function(i){var e,t=i.parent||Dt,r=i.keyframes?(e=Ci(i.keyframes),function(s,a){for(var n in a)n in s||n==="duration"&&e||n==="ease"||(s[n]=a[n])}):Ar;if(Zi(i.inherit))for(;t;)r(i,t.vars.defaults),t=t.parent||t._dp;return i},_b=function(i,e,t,r,s){var a,n=i[r];if(s)for(a=e[s];n&&n[s]>a;)n=n._prev;return n?(e._next=n._next,n._next=e):(e._next=i[t],i[t]=e),e._next?e._next._prev=e:i[r]=e,e._prev=n,e.parent=e._dp=i,e},yp=function(i,e,t,r){t===void 0&&(t="_first"),r===void 0&&(r="_last");var s=e._prev,a=e._next;s?s._next=a:i[t]===e&&(i[t]=a),a?a._prev=s:i[r]===e&&(i[r]=s),e._next=e._prev=e.parent=null},Ua=function(i,e){i.parent&&(!e||i.parent.autoRemoveChildren)&&i.parent.remove&&i.parent.remove(i),i._act=0},Ln=function(i,e){if(i&&(!e||e._end>i._dur||e._start<0))for(var t=i;t;)t._dirty=1,t=t.parent;return i},wm=function(i,e,t,r){return i._startAt&&(Ii?i._startAt.revert(ed):i.vars.immediateRender&&!i.vars.autoRevert||i._startAt.render(e,!0,r))},aE=function i(e){return!e||e._ts&&i(e.parent)},ay=function(i){return i._repeat?jo(i._tTime,i=i.duration()+i._rDelay)*i:0},jo=function(i,e){var t=Math.floor(i/=e);return i&&t===i?t-1:t},bd=function(i,e){return(i-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},xp=function(i){return i._end=pi(i._start+(i._tDur/Math.abs(i._ts||i._rts||Hi)||0))},bp=function(i,e){var t=i._dp;return t&&t.smoothChildTiming&&i._ts&&(i._start=pi(t._time-(i._ts>0?e/i._ts:((i._dirty?i.totalDuration():i._tDur)-e)/-i._ts)),xp(i),t._dirty||Ln(t,i)),i},yb=function(i,e){var t;if((e._time||!e._dur&&e._initted||e._start<i._time&&(e._dur||!e.add))&&(t=bd(i.rawTime(),e),(!e._dur||fh(0,e.totalDuration(),t)-e._tTime>Hi)&&e.render(t,!0)),Ln(i,e)._dp&&i._initted&&i._time>=i._dur&&i._ts){if(i._dur<i.duration())for(t=i;t._dp;)t.rawTime()>=0&&t.totalTime(t._tTime),t=t._dp;i._zTime=-1e-8}},as=function(i,e,t,r){return e.parent&&Ua(e),e._start=pi((js(t)?t:t||i!==Dt?_r(i,t,e):i._time)+e._delay),e._end=pi(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),_b(i,e,"_first","_last",i._sort?"_start":0),hg(e)||(i._recent=e),r||yb(i,e),i._ts<0&&bp(i,i._tTime),i},xb=function(i,e){return lr.ScrollTrigger?lr.ScrollTrigger.create(e,i):void 0},ny=function(i,e,t,r,s){return fg(i,e,s),i._initted?!t&&i._pt&&!Ii&&(i._dur&&i.vars.lazy!==!1||!i._dur&&i.vars.lazy)&&nb!==or.frame?(Ca.push(i),i._lazy=[s,r],1):void 0:1},nE=function i(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||i(t))},hg=function(i){var e=i.data;return e==="isFromStart"||e==="isStart"},dl=function(i,e,t,r){var s=i._repeat,a=pi(e)||0,n=i._tTime/i._tDur;return n&&!r&&(i._time*=a/i._dur),i._dur=a,i._tDur=s?s<0?1e10:pi(a*(s+1)+i._rDelay*s):a,n>0&&!r&&bp(i,i._tTime=i._tDur*n),i.parent&&xp(i),t||Ln(i.parent,i),i},oy=function(i){return i instanceof Bi?Ln(i):dl(i,i._dur)},oE={_start:0,endTime:Bc,totalDuration:Bc},_r=function i(e,t,r){var s,a,n,o=e.labels,l=e._recent||oE,c=e.duration()>=zs?l.endTime(!1):e._dur;return fi(t)&&(isNaN(t)||t in o)?(a=t.charAt(0),n=t.substr(-1)==="%",s=t.indexOf("="),a==="<"||a===">"?(s>=0&&(t=t.replace(/=/,"")),(a==="<"?l._start:l.endTime(l._repeat>=0))+(parseFloat(t.substr(1))||0)*(n?(s<0?l:r).totalDuration()/100:1)):s<0?(t in o||(o[t]=c),o[t]):(a=parseFloat(t.charAt(s-1)+t.substr(s+1)),n&&r&&(a=a/100*(Ci(r)?r[0]:r).totalDuration()),s>1?i(e,t.substr(0,s-1),r)+a:c+a)):t==null?c:+t},mc=function(i,e,t){var r,s,a=js(e[1]),n=(a?2:1)+(i<2?0:1),o=e[n];if(a&&(o.duration=e[1]),o.parent=t,i){for(r=o,s=t;s&&!("immediateRender"in r);)r=s.vars.defaults||{},s=Zi(s.vars.inherit)&&s.parent;o.immediateRender=Zi(r.immediateRender),i<2?o.runBackwards=1:o.startAt=e[n-1]}return new ti(e[0],o,e[n+1])},va=function(i,e){return i||i===0?e(i):e},fh=function(i,e,t){return t<i?i:t>e?e:t},Pi=function(i,e){return fi(i)&&(e=tE.exec(i))?e[1]:""},ug=[].slice,bb=function(i,e){return i&&vs(i)&&"length"in i&&(!e&&!i.length||i.length-1 in i&&vs(i[0]))&&!i.nodeType&&i!==rs},lE=function(i,e,t){return t===void 0&&(t=[]),i.forEach(function(r){var s;return fi(r)&&!e||bb(r,1)?(s=t).push.apply(s,Sr(r)):t.push(r)})||t},Sr=function(i,e,t){return Pt&&!e&&Pt.selector?Pt.selector(i):!fi(i)||t||!ng&&pl()?Ci(i)?lE(i,t):bb(i)?ug.call(i,0):i?[i]:[]:ug.call((e||x0).querySelectorAll(i),0)},dg=function(i){return i=Sr(i)[0]||zc()||{},function(e){var t=i.current||i.nativeElement||i;return Sr(e,t.querySelectorAll?t:t===i?zc()||x0.createElement("div"):i)}},Mb=function(i){return i.sort(function(){return .5-Math.random()})},wb=function(i){if(Vt(i))return i;var e=vs(i)?i:{each:i},t=Dn(e.ease),r=e.from||0,s=parseFloat(e.base)||0,a={},n=r>0&&r<1,o=isNaN(r)||n,l=e.axis,c=r,h=r;return fi(r)?c=h={center:.5,edges:.5,end:1}[r]||0:!n&&o&&(c=r[0],h=r[1]),function(u,d,p){var f,g,m,v,_,y,x,b,M,T=(p||e).length,A=a[T];if(!A){if(!(M=e.grid==="auto"?0:(e.grid||[1,zs])[1])){for(x=-1e8;x<(x=p[M++].getBoundingClientRect().left)&&M<T;);M<T&&M--}for(A=a[T]=[],f=o?Math.min(M,T)*c-.5:r%M,g=M===zs?0:o?T*h/M-.5:r/M|0,x=0,b=zs,y=0;y<T;y++)m=y%M-f,v=g-(y/M|0),A[y]=_=l?Math.abs(l==="y"?v:m):ob(m*m+v*v),_>x&&(x=_),_<b&&(b=_);r==="random"&&Mb(A),A.max=x-b,A.min=b,A.v=T=(parseFloat(e.amount)||parseFloat(e.each)*(M>T?T-1:l?l==="y"?T/M:M:Math.max(M,T/M))||0)*(r==="edges"?-1:1),A.b=T<0?s-T:s,A.u=Pi(e.amount||e.each)||0,t=t&&T<0?Ib(t):t}return T=(A[u]-A.min)/A.max||0,pi(A.b+(t?t(T):T)*A.v)+A.u}},pg=function(i){var e=Math.pow(10,((i+"").split(".")[1]||"").length);return function(t){var r=pi(Math.round(parseFloat(t)/i)*i*e);return(r-r%1)/e+(js(t)?0:Pi(t))}},Sb=function(i,e){var t,r,s=Ci(i);return!s&&vs(i)&&(t=s=i.radius||zs,i.values?(i=Sr(i.values),(r=!js(i[0]))&&(t*=t)):i=pg(i.increment)),va(e,s?Vt(i)?function(a){return r=i(a),Math.abs(r-a)<=t?r:a}:function(a){for(var n,o,l=parseFloat(r?a.x:a),c=parseFloat(r?a.y:0),h=zs,u=0,d=i.length;d--;)(n=r?(n=i[d].x-l)*n+(o=i[d].y-c)*o:Math.abs(i[d]-l))<h&&(h=n,u=d);return u=!t||h<=t?i[u]:a,r||u===a||js(a)?u:u+Pi(a)}:pg(i))},Tb=function(i,e,t,r){return va(Ci(i)?!e:t===!0?!!(t=0):!r,function(){return Ci(i)?i[~~(Math.random()*i.length)]:(t=t||1e-5)&&(r=t<1?Math.pow(10,(t+"").length-2):1)&&Math.floor(Math.round((i-t/2+Math.random()*(e-i+.99*t))/t)*t*r)/r})},ly=function(i,e,t){return va(t,function(r){return i[~~e(r)]})},Vc=function(i){for(var e,t,r,s,a=0,n="";~(e=i.indexOf("random(",a));)r=i.indexOf(")",e),s=i.charAt(e+7)==="[",t=i.substr(e+7,r-e-7).match(s?ub:lg),n+=i.substr(a,e-a)+Tb(s?t:+t[0],s?0:+t[1],+t[2]||1e-5),a=r+1;return n+i.substr(a,i.length-a)},cy=function(i,e,t,r,s){var a=e-i,n=r-t;return va(s,function(o){return t+((o-i)/a*n||0)})},hy=function(i,e,t){var r,s,a,n=i.labels,o=zs;for(r in n)(s=n[r]-e)<0==!!t&&s&&o>(s=Math.abs(s))&&(a=r,o=s);return a},rr=function(i,e,t){var r,s,a,n=i.vars,o=n[e],l=Pt,c=i._ctx;if(o)return r=n[e+"Params"],s=n.callbackScope||i,t&&Ca.length&&yd(),c&&(Pt=c),a=r?o.apply(s,r):o.call(s),Pt=l,a},tc=function(i){return Ua(i),i.scrollTrigger&&i.scrollTrigger.kill(!!Ii),i.progress()<1&&rr(i,"onInterrupt"),i},Eb=[],Ab=function(i){if(i)if(i=!i.name&&i.default||i,M0()||i.headless){var e=i.name,t=Vt(i),r=e&&!t&&i.init?function(){this._props=[]}:i,s={init:Bc,render:gg,add:E0,kill:yE,modifier:_E,rawVars:0},a={targetTest:0,get:0,getSetter:C0,aliases:{},register:0};if(pl(),i!==r){if(ir[e])return;Ar(r,Ar(xd(i,s),a)),qn(r.prototype,qn(s,xd(i,a))),ir[r.prop=e]=r,i.targetTest&&(td.push(r),w0[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}pb(e,r),i.register&&i.register(Qi,r,Ki)}else Eb.push(i)},vt=255,ic={aqua:[0,vt,vt],lime:[0,vt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,vt],navy:[0,0,128],white:[vt,vt,vt],olive:[128,128,0],yellow:[vt,vt,0],orange:[vt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[vt,0,0],pink:[vt,192,203],cyan:[0,vt,vt],transparent:[vt,vt,vt,0]},Sm=function(i,e,t){return(6*(i+=i<0?1:i>1?-1:0)<1?e+(t-e)*i*6:i<.5?t:3*i<2?e+(t-e)*(2/3-i)*6:e)*vt+.5|0},Cb=function(i,e,t){var r,s,a,n,o,l,c,h,u,d,p=i?js(i)?[i>>16,i>>8&vt,i&vt]:0:ic.black;if(!p){if(i.substr(-1)===","&&(i=i.substr(0,i.length-1)),ic[i])p=ic[i];else if(i.charAt(0)==="#"){if(i.length<6&&(r=i.charAt(1),s=i.charAt(2),a=i.charAt(3),i="#"+r+r+s+s+a+a+(i.length===5?i.charAt(4)+i.charAt(4):"")),i.length===9)return[(p=parseInt(i.substr(1,6),16))>>16,p>>8&vt,p&vt,parseInt(i.substr(7),16)/255];p=[(i=parseInt(i.substr(1),16))>>16,i>>8&vt,i&vt]}else if(i.substr(0,3)==="hsl")if(p=d=i.match(lg),e){if(~i.indexOf("="))return p=i.match(cb),t&&p.length<4&&(p[3]=1),p}else n=+p[0]%360/360,o=+p[1]/100,r=2*(l=+p[2]/100)-(s=l<=.5?l*(o+1):l+o-l*o),p.length>3&&(p[3]*=1),p[0]=Sm(n+1/3,r,s),p[1]=Sm(n,r,s),p[2]=Sm(n-1/3,r,s);else p=i.match(lg)||ic.transparent;p=p.map(Number)}return e&&!d&&(r=p[0]/vt,s=p[1]/vt,a=p[2]/vt,l=((c=Math.max(r,s,a))+(h=Math.min(r,s,a)))/2,c===h?n=o=0:(u=c-h,o=l>.5?u/(2-c-h):u/(c+h),n=c===r?(s-a)/u+(s<a?6:0):c===s?(a-r)/u+2:(r-s)/u+4,n*=60),p[0]=~~(n+.5),p[1]=~~(100*o+.5),p[2]=~~(100*l+.5)),t&&p.length<4&&(p[3]=1),p},Pb=function(i){var e=[],t=[],r=-1;return i.split(Pa).forEach(function(s){var a=s.match(Do)||[];e.push.apply(e,a),t.push(r+=a.length+1)}),e.c=t,e},uy=function(i,e,t){var r,s,a,n,o="",l=(i+o).match(Pa),c=e?"hsla(":"rgba(",h=0;if(!l)return i;if(l=l.map(function(u){return(u=Cb(u,e,1))&&c+(e?u[0]+","+u[1]+"%,"+u[2]+"%,"+u[3]:u.join(","))+")"}),t&&(a=Pb(i),(r=t.c).join(o)!==a.c.join(o)))for(n=(s=i.replace(Pa,"1").split(Do)).length-1;h<n;h++)o+=s[h]+(~r.indexOf(h)?l.shift()||c+"0,0,0,0)":(a.length?a:l.length?l:t).shift());if(!s)for(n=(s=i.split(Pa)).length-1;h<n;h++)o+=s[h]+l[h];return o+s[n]},Pa=function(){var i,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(i in ic)e+="|"+i+"\\b";return new RegExp(e+")","gi")}(),cE=/hsl[a]?\(/,Rb=function(i){var e,t=i.join(" ");if(Pa.lastIndex=0,Pa.test(t))return e=cE.test(t),i[1]=uy(i[1],e),i[0]=uy(i[0],e,Pb(i[1])),!0},or=function(){var i,e,t,r,s,a,n=Date.now,o=500,l=33,c=n(),h=c,u=1e3/240,d=u,p=[],f=function g(m){var v,_,y,x,b=n()-h,M=m===!0;if((b>o||b<0)&&(c+=b-l),((v=(y=(h+=b)-c)-d)>0||M)&&(x=++r.frame,s=y-1e3*r.time,r.time=y/=1e3,d+=v+(v>=u?4:u-v),_=1),M||(i=e(g)),_)for(a=0;a<p.length;a++)p[a](y,s,x,m)};return r={time:0,frame:0,tick:function(){f(!0)},deltaRatio:function(g){return s/(1e3/(g||60))},wake:function(){ab&&(!ng&&M0()&&(rs=ng=window,x0=rs.document||{},lr.gsap=Qi,(rs.gsapVersions||(rs.gsapVersions=[])).push(Qi.version),db(_d||rs.GreenSockGlobals||!rs.gsap&&rs||{}),Eb.forEach(Ab)),t=typeof requestAnimationFrame<"u"&&requestAnimationFrame,i&&r.sleep(),e=t||function(g){return setTimeout(g,d-1e3*r.time+1|0)},Fc=1,f(2))},sleep:function(){(t?cancelAnimationFrame:clearTimeout)(i),Fc=0,e=Bc},lagSmoothing:function(g,m){o=g||1/0,l=Math.min(m||33,o)},fps:function(g){u=1e3/(g||240),d=1e3*r.time+u},add:function(g,m,v){var _=m?function(y,x,b,M){g(y,x,b,M),r.remove(_)}:g;return r.remove(g),p[v?"unshift":"push"](_),pl(),_},remove:function(g,m){~(m=p.indexOf(g))&&p.splice(m,1)&&a>=m&&a--},_listeners:p},r}(),pl=function(){return!Fc&&or.wake()},tt={},hE=/^[\d.\-M][\d.\-,\s]/,uE=/["']/g,dE=function(i){for(var e,t,r,s={},a=i.substr(1,i.length-3).split(":"),n=a[0],o=1,l=a.length;o<l;o++)t=a[o],e=o!==l-1?t.lastIndexOf(","):t.length,r=t.substr(0,e),s[n]=isNaN(r)?r.replace(uE,"").trim():+r,n=t.substr(e+1).trim();return s},Ib=function(i){return function(e){return 1-i(1-e)}},Lb=function i(e,t){for(var r,s=e._first;s;)s instanceof Bi?i(s,t):!s.vars.yoyoEase||s._yoyo&&s._repeat||s._yoyo===t||(s.timeline?i(s.timeline,t):(r=s._ease,s._ease=s._yEase,s._yEase=r,s._yoyo=t)),s=s._next},Dn=function(i,e){return i&&(Vt(i)?i:tt[i]||function(t){var r,s,a,n,o=(t+"").split("("),l=tt[o[0]];return l&&o.length>1&&l.config?l.config.apply(null,~t.indexOf("{")?[dE(o[1])]:(r=t,s=r.indexOf("(")+1,a=r.indexOf(")"),n=r.indexOf("(",s),r.substring(s,~n&&n<a?r.indexOf(")",a+1):a)).split(",").map(gb)):tt._CE&&hE.test(t)?tt._CE("",t):l}(i))||e},an=function(i,e,t,r){t===void 0&&(t=function(n){return 1-e(1-n)}),r===void 0&&(r=function(n){return n<.5?e(2*n)/2:1-e(2*(1-n))/2});var s,a={easeIn:e,easeOut:t,easeInOut:r};return Yi(i,function(n){for(var o in tt[n]=lr[n]=a,tt[s=n.toLowerCase()]=t,a)tt[s+(o==="easeIn"?".in":o==="easeOut"?".out":".inOut")]=tt[n+"."+o]=a[o]}),a},Db=function(i){return function(e){return e<.5?(1-i(1-2*e))/2:.5+i(2*(e-.5))/2}},Tm=function i(e,t,r){var s=t>=1?t:1,a=(r||(e?.3:.45))/(t<1?t:1),n=a/og*(Math.asin(1/s)||0),o=function(c){return c===1?1:s*Math.pow(2,-10*c)*eE((c-n)*a)+1},l=e==="out"?o:e==="in"?function(c){return 1-o(1-c)}:Db(o);return a=og/a,l.config=function(c,h){return i(e,c,h)},l},Em=function i(e,t){t===void 0&&(t=1.70158);var r=function(a){return a?--a*a*((t+1)*a+t)+1:0},s=e==="out"?r:e==="in"?function(a){return 1-r(1-a)}:Db(r);return s.config=function(a){return i(e,a)},s};Yi("Linear,Quad,Cubic,Quart,Quint,Strong",function(i,e){var t=e<5?e+1:e;an(i+",Power"+(t-1),e?function(r){return Math.pow(r,t)}:function(r){return r},function(r){return 1-Math.pow(1-r,t)},function(r){return r<.5?Math.pow(2*r,t)/2:1-Math.pow(2*(1-r),t)/2})}),tt.Linear.easeNone=tt.none=tt.Linear.easeIn,an("Elastic",Tm("in"),Tm("out"),Tm()),Fl=7.5625,ey=2*(xm=1/(yu=2.75)),ty=2.5*xm,an("Bounce",function(i){return 1-iy(1-i)},iy=function(i){return i<xm?Fl*i*i:i<ey?Fl*Math.pow(i-1.5/yu,2)+.75:i<ty?Fl*(i-=2.25/yu)*i+.9375:Fl*Math.pow(i-2.625/yu,2)+.984375}),an("Expo",function(i){return i?Math.pow(2,10*(i-1)):0}),an("Circ",function(i){return-(ob(1-i*i)-1)}),an("Sine",function(i){return i===1?1:1-JT(i*QT)}),an("Back",Em("in"),Em("out"),Em()),tt.SteppedEase=tt.steps=lr.SteppedEase={config:function(i,e){i===void 0&&(i=1);var t=1/i,r=i+(e?0:1),s=e?1:0;return function(a){return((r*fh(0,.99999999,a)|0)+s)*t}}},ul.ease=tt["quad.out"],Yi("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(i){return S0+=i+","+i+"Params,"});var Ob=function(i,e){this.id=$T++,i._gsap=this,this.target=i,this.harness=e,this.get=e?e.get:mb,this.set=e?e.getSetter:C0},Hc=function(){function i(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,dl(this,+t.duration,1,1),this.data=t.data,Pt&&(this._ctx=Pt,Pt.data.push(this)),Fc||or.wake()}var e=i.prototype;return e.delay=function(t){return t||t===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,dl(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,r){if(pl(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(bp(this,t),!s._dp||s.parent||yb(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&as(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===Hi||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),fb(this,t,r)),this},e.time=function(t,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+ay(this))%(this._dur+this._rDelay)||(t?this._dur:0),r):this._time},e.totalProgress=function(t,r){return arguments.length?this.totalTime(this.totalDuration()*t,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(t,r){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+ay(this),r):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,r){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*s,r):this._repeat?jo(this._tTime,s)+1:1},e.timeScale=function(t,r){if(!arguments.length)return this._rts===-1e-8?0:this._rts;if(this._rts===t)return this;var s=this.parent&&this._ts?bd(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||t===-1e-8?0:this._rts,this.totalTime(fh(-Math.abs(this._delay),this._tDur,s),r!==!1),xp(this),function(a){for(var n=a.parent;n&&n.parent;)n._dirty=1,n.totalDuration(),n=n.parent;return a}(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(pl(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Hi&&(this._tTime-=Hi)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&as(r,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(Zi(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var r=this.parent||this._dp;return r?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?bd(r.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){t===void 0&&(t=rE);var r=Ii;return Ii=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),this.data!=="nested"&&t.kill!==!1&&this.kill(),Ii=r,this},e.globalTime=function(t){for(var r=this,s=arguments.length?t:r.rawTime();r;)s=r._start+s/(Math.abs(r._ts)||1),r=r._dp;return!this.parent&&this._sat?this._sat.globalTime(t):s},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,oy(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var r=this._time;return this._rDelay=t,oy(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,r){return this.totalTime(_r(this,t),Zi(r))},e.restart=function(t,r){return this.play().totalTime(t?-this._delay:0,Zi(r))},e.play=function(t,r){return t!=null&&this.seek(t,r),this.reversed(!1).paused(!1)},e.reverse=function(t,r){return t!=null&&this.seek(t||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(t,r){return t!=null&&this.seek(t,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,r=this.parent||this._dp,s=this._start;return!(r&&!(this._ts&&this._initted&&r.isActive()&&(t=r.rawTime(!0))>=s&&t<this.endTime(!0)-Hi))},e.eventCallback=function(t,r,s){var a=this.vars;return arguments.length>1?(r?(a[t]=r,s&&(a[t+"Params"]=s),t==="onUpdate"&&(this._onUpdate=r)):delete a[t],this):a[t]},e.then=function(t){var r=this;return new Promise(function(s){var a=Vt(t)?t:vb,n=function(){var o=r.then;r.then=null,Vt(a)&&(a=a(r))&&(a.then||a===r)&&(r.then=o),s(a),r.then=o};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?n():r._prom=n})},e.kill=function(){tc(this)},i}();Ar(Hc.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Bi=function(i){function e(r,s){var a;return r===void 0&&(r={}),(a=i.call(this,r)||this).labels={},a.smoothChildTiming=!!r.smoothChildTiming,a.autoRemoveChildren=!!r.autoRemoveChildren,a._sort=Zi(r.sortChildren),Dt&&as(r.parent||Dt,Is(a),s),r.reversed&&a.reverse(),r.paused&&a.paused(!0),r.scrollTrigger&&xb(Is(a),r.scrollTrigger),a}sb(e,i);var t=e.prototype;return t.to=function(r,s,a){return mc(0,arguments,this),this},t.from=function(r,s,a){return mc(1,arguments,this),this},t.fromTo=function(r,s,a,n){return mc(2,arguments,this),this},t.set=function(r,s,a){return s.duration=0,s.parent=this,pc(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new ti(r,s,_r(this,a),1),this},t.call=function(r,s,a){return as(this,ti.delayedCall(0,r,s),a)},t.staggerTo=function(r,s,a,n,o,l,c){return a.duration=s,a.stagger=a.stagger||n,a.onComplete=l,a.onCompleteParams=c,a.parent=this,new ti(r,a,_r(this,o)),this},t.staggerFrom=function(r,s,a,n,o,l,c){return a.runBackwards=1,pc(a).immediateRender=Zi(a.immediateRender),this.staggerTo(r,s,a,n,o,l,c)},t.staggerFromTo=function(r,s,a,n,o,l,c,h){return n.startAt=a,pc(n).immediateRender=Zi(n.immediateRender),this.staggerTo(r,s,n,o,l,c,h)},t.render=function(r,s,a){var n,o,l,c,h,u,d,p,f,g,m,v,_=this._time,y=this._dirty?this.totalDuration():this._tDur,x=this._dur,b=r<=0?0:pi(r),M=this._zTime<0!=r<0&&(this._initted||!x);if(this!==Dt&&b>y&&r>=0&&(b=y),b!==this._tTime||a||M){if(_!==this._time&&x&&(b+=this._time-_,r+=this._time-_),n=b,f=this._start,u=!(p=this._ts),M&&(x||(_=this._zTime),(r||!s)&&(this._zTime=r)),this._repeat){if(m=this._yoyo,h=x+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(100*h+r,s,a);if(n=pi(b%h),b===y?(c=this._repeat,n=x):((c=~~(b/h))&&c===b/h&&(n=x,c--),n>x&&(n=x)),g=jo(this._tTime,h),!_&&this._tTime&&g!==c&&this._tTime-g*h-this._dur<=0&&(g=c),m&&1&c&&(n=x-n,v=1),c!==g&&!this._lock){var T=m&&1&g,A=T===(m&&1&c);if(c<g&&(T=!T),_=T?0:b%x?x:b,this._lock=1,this.render(_||(v?0:pi(c*h)),s,!x)._lock=0,this._tTime=b,!s&&this.parent&&rr(this,"onRepeat"),this.vars.repeatRefresh&&!v&&(this.invalidate()._lock=1),_&&_!==this._time||u!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(x=this._dur,y=this._tDur,A&&(this._lock=2,_=T?x:-1e-4,this.render(_,!0),this.vars.repeatRefresh&&!v&&this.invalidate()),this._lock=0,!this._ts&&!u)return this;Lb(this,v)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(d=function(U,P,E){var I;if(E>P)for(I=U._first;I&&I._start<=E;){if(I.data==="isPause"&&I._start>P)return I;I=I._next}else for(I=U._last;I&&I._start>=E;){if(I.data==="isPause"&&I._start<P)return I;I=I._prev}}(this,pi(_),pi(n)),d&&(b-=n-(n=d._start))),this._tTime=b,this._time=n,this._act=!p,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,_=0),!_&&n&&!s&&!c&&(rr(this,"onStart"),this._tTime!==b))return this;if(n>=_&&r>=0)for(o=this._first;o;){if(l=o._next,(o._act||n>=o._start)&&o._ts&&d!==o){if(o.parent!==this)return this.render(r,s,a);if(o.render(o._ts>0?(n-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(n-o._start)*o._ts,s,a),n!==this._time||!this._ts&&!u){d=0,l&&(b+=this._zTime=-1e-8);break}}o=l}else{o=this._last;for(var L=r<0?r:n;o;){if(l=o._prev,(o._act||L<=o._end)&&o._ts&&d!==o){if(o.parent!==this)return this.render(r,s,a);if(o.render(o._ts>0?(L-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(L-o._start)*o._ts,s,a||Ii&&(o._initted||o._startAt)),n!==this._time||!this._ts&&!u){d=0,l&&(b+=this._zTime=L?-1e-8:Hi);break}}o=l}}if(d&&!s&&(this.pause(),d.render(n>=_?0:-1e-8)._zTime=n>=_?1:-1,this._ts))return this._start=f,xp(this),this.render(r,s,a);this._onUpdate&&!s&&rr(this,"onUpdate",!0),(b===y&&this._tTime>=this.totalDuration()||!b&&_)&&(f!==this._start&&Math.abs(p)===Math.abs(this._ts)||this._lock||((r||!x)&&(b===y&&this._ts>0||!b&&this._ts<0)&&Ua(this,1),s||r<0&&!_||!b&&!_&&y||(rr(this,b===y&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(b<y&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,s){var a=this;if(js(s)||(s=_r(this,s,r)),!(r instanceof Hc)){if(Ci(r))return r.forEach(function(n){return a.add(n,s)}),this;if(fi(r))return this.addLabel(r,s);if(!Vt(r))return this;r=ti.delayedCall(0,r)}return this!==r?as(this,r,s):this},t.getChildren=function(r,s,a,n){r===void 0&&(r=!0),s===void 0&&(s=!0),a===void 0&&(a=!0),n===void 0&&(n=-1e8);for(var o=[],l=this._first;l;)l._start>=n&&(l instanceof ti?s&&o.push(l):(a&&o.push(l),r&&o.push.apply(o,l.getChildren(!0,s,a)))),l=l._next;return o},t.getById=function(r){for(var s=this.getChildren(1,1,1),a=s.length;a--;)if(s[a].vars.id===r)return s[a]},t.remove=function(r){return fi(r)?this.removeLabel(r):Vt(r)?this.killTweensOf(r):(yp(this,r),r===this._recent&&(this._recent=this._last),Ln(this))},t.totalTime=function(r,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=pi(or.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),i.prototype.totalTime.call(this,r,s),this._forcing=0,this):this._tTime},t.addLabel=function(r,s){return this.labels[r]=_r(this,s),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,s,a){var n=ti.delayedCall(0,s||Bc,a);return n.data="isPause",this._hasPause=1,as(this,n,_r(this,r))},t.removePause=function(r){var s=this._first;for(r=_r(this,r);s;)s._start===r&&s.data==="isPause"&&Ua(s),s=s._next},t.killTweensOf=function(r,s,a){for(var n=this.getTweensOf(r,a),o=n.length;o--;)_a!==n[o]&&n[o].kill(r,s);return this},t.getTweensOf=function(r,s){for(var a,n=[],o=Sr(r),l=this._first,c=js(s);l;)l instanceof ti?sE(l._targets,o)&&(c?(!_a||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&n.push(l):(a=l.getTweensOf(o,s)).length&&n.push.apply(n,a),l=l._next;return n},t.tweenTo=function(r,s){s=s||{};var a,n=this,o=_r(n,r),l=s,c=l.startAt,h=l.onStart,u=l.onStartParams,d=l.immediateRender,p=ti.to(n,Ar({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:s.duration||Math.abs((o-(c&&"time"in c?c.time:n._time))/n.timeScale())||Hi,onStart:function(){if(n.pause(),!a){var f=s.duration||Math.abs((o-(c&&"time"in c?c.time:n._time))/n.timeScale());p._dur!==f&&dl(p,f,0,1).render(p._time,!0,!0),a=1}h&&h.apply(p,u||[])}},s));return d?p.render(0):p},t.tweenFromTo=function(r,s,a){return this.tweenTo(s,Ar({startAt:{time:_r(this,r)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),hy(this,_r(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),hy(this,_r(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+Hi)},t.shiftChildren=function(r,s,a){a===void 0&&(a=0);for(var n,o=this._first,l=this.labels;o;)o._start>=a&&(o._start+=r,o._end+=r),o=o._next;if(s)for(n in l)l[n]>=a&&(l[n]+=r);return Ln(this)},t.invalidate=function(r){var s=this._first;for(this._lock=0;s;)s.invalidate(r),s=s._next;return i.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var s,a=this._first;a;)s=a._next,this.remove(a),a=s;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),Ln(this)},t.totalDuration=function(r){var s,a,n,o=0,l=this,c=l._last,h=zs;if(arguments.length)return l.timeScale((l._repeat<0?l.duration():l.totalDuration())/(l.reversed()?-r:r));if(l._dirty){for(n=l.parent;c;)s=c._prev,c._dirty&&c.totalDuration(),(a=c._start)>h&&l._sort&&c._ts&&!l._lock?(l._lock=1,as(l,c,a-c._delay,1)._lock=0):h=a,a<0&&c._ts&&(o-=a,(!n&&!l._dp||n&&n.smoothChildTiming)&&(l._start+=a/l._ts,l._time-=a,l._tTime-=a),l.shiftChildren(-a,!1,-1/0),h=0),c._end>o&&c._ts&&(o=c._end),c=s;dl(l,l===Dt&&l._time>o?l._time:o,1,1),l._dirty=0}return l._tDur},e.updateRoot=function(r){if(Dt._ts&&(fb(Dt,bd(r,Dt)),nb=or.frame),or.frame>=ry){ry+=ur.autoSleep||120;var s=Dt._first;if((!s||!s._ts)&&ur.autoSleep&&or._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||or.sleep()}}},e}(Hc);Ar(Bi.prototype,{_lock:0,_hasPause:0,_forcing:0});var _a,mg,pE=function(i,e,t,r,s,a,n){var o,l,c,h,u,d,p,f,g=new Ki(this._pt,i,e,0,1,Bb,null,s),m=0,v=0;for(g.b=t,g.e=r,t+="",(p=~(r+="").indexOf("random("))&&(r=Vc(r)),a&&(a(f=[t,r],i,e),t=f[0],r=f[1]),l=t.match(bm)||[];o=bm.exec(r);)h=o[0],u=r.substring(m,o.index),c?c=(c+1)%5:u.substr(-5)==="rgba("&&(c=1),h!==l[v++]&&(d=parseFloat(l[v-1])||0,g._pt={_next:g._pt,p:u||v===1?u:",",s:d,c:h.charAt(1)==="="?Go(d,h)-d:parseFloat(h)-d,m:c&&c<4?Math.round:0},m=bm.lastIndex);return g.c=m<r.length?r.substring(m,r.length):"",g.fp=n,(hb.test(r)||p)&&(g.e=0),this._pt=g,g},E0=function(i,e,t,r,s,a,n,o,l,c){Vt(r)&&(r=r(s||0,i,a));var h,u=i[e],d=t!=="get"?t:Vt(u)?l?i[e.indexOf("set")||!Vt(i["get"+e.substr(3)])?e:"get"+e.substr(3)](l):i[e]():u,p=Vt(u)?l?fE:Fb:A0;if(fi(r)&&(~r.indexOf("random(")&&(r=Vc(r)),r.charAt(1)==="="&&((h=Go(d,r)+(Pi(d)||0))||h===0)&&(r=h)),!c||d!==r||mg)return isNaN(d*r)||r===""?pE.call(this,i,e,d,r,p,o||ur.stringFilter,l):(h=new Ki(this._pt,i,e,+d||0,r-(d||0),typeof u=="boolean"?vE:zb,0,p),l&&(h.fp=l),n&&h.modifier(n,this,i),this._pt=h)},Nb=function(i,e,t,r,s,a){var n,o,l,c;if(ir[i]&&(n=new ir[i]).init(s,n.rawVars?e[i]:function(h,u,d,p,f){if(Vt(h)&&(h=fc(h,f,u,d,p)),!vs(h)||h.style&&h.nodeType||Ci(h)||lb(h))return fi(h)?fc(h,f,u,d,p):h;var g,m={};for(g in h)m[g]=fc(h[g],f,u,d,p);return m}(e[i],r,s,a,t),t,r,a)!==!1&&(t._pt=o=new Ki(t._pt,s,i,0,1,n.render,n,0,n.priority),t!==Lo))for(l=t._ptLookup[t._targets.indexOf(s)],c=n._props.length;c--;)l[n._props[c]]=o;return n},fg=function i(e,t,r){var s,a,n,o,l,c,h,u,d,p,f,g,m,v=e.vars,_=v.ease,y=v.startAt,x=v.immediateRender,b=v.lazy,M=v.onUpdate,T=v.runBackwards,A=v.yoyoEase,L=v.keyframes,U=v.autoRevert,P=e._dur,E=e._startAt,I=e._targets,S=e.parent,V=S&&S.data==="nested"?S.vars.targets:I,J=e._overwrite==="auto"&&!y0,X=e.timeline;if(X&&(!L||!_)&&(_="none"),e._ease=Dn(_,ul.ease),e._yEase=A?Ib(Dn(A===!0?_:A,ul.ease)):0,A&&e._yoyo&&!e._repeat&&(A=e._yEase,e._yEase=e._ease,e._ease=A),e._from=!X&&!!v.runBackwards,!X||L&&!v.stagger){if(g=(u=I[0]?In(I[0]).harness:0)&&v[u.prop],s=xd(v,w0),E&&(E._zTime<0&&E.progress(1),t<0&&T&&x&&!U?E.render(-1,!0):E.revert(T&&P?ed:iE),E._lazy=0),y){if(Ua(e._startAt=ti.set(I,Ar({data:"isStart",overwrite:!1,parent:S,immediateRender:!0,lazy:!E&&Zi(b),startAt:null,delay:0,onUpdate:M&&function(){return rr(e,"onUpdate")},stagger:0},y))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Ii||!x&&!U)&&e._startAt.revert(ed),x&&P&&t<=0&&r<=0)return void(t&&(e._zTime=t))}else if(T&&P&&!E)if(t&&(x=!1),n=Ar({overwrite:!1,data:"isFromStart",lazy:x&&!E&&Zi(b),immediateRender:x,stagger:0,parent:S},s),g&&(n[u.prop]=g),Ua(e._startAt=ti.set(I,n)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Ii?e._startAt.revert(ed):e._startAt.render(-1,!0)),e._zTime=t,x){if(!t)return}else i(e._startAt,Hi,Hi);for(e._pt=e._ptCache=0,b=P&&Zi(b)||b&&!P,a=0;a<I.length;a++){if(h=(l=I[a])._gsap||T0(I)[a]._gsap,e._ptLookup[a]=p={},cg[h.id]&&Ca.length&&yd(),f=V===I?a:V.indexOf(l),u&&(d=new u).init(l,g||s,e,f,V)!==!1&&(e._pt=o=new Ki(e._pt,l,d.name,0,1,d.render,d,0,d.priority),d._props.forEach(function(te){p[te]=o}),d.priority&&(c=1)),!u||g)for(n in s)ir[n]&&(d=Nb(n,s,e,f,l,V))?d.priority&&(c=1):p[n]=o=E0.call(e,l,n,"get",s[n],f,V,0,v.stringFilter);e._op&&e._op[a]&&e.kill(l,e._op[a]),J&&e._pt&&(_a=e,Dt.killTweensOf(l,p,e.globalTime(t)),m=!e.parent,_a=0),e._pt&&b&&(cg[h.id]=1)}c&&Vb(e),e._onInit&&e._onInit(e)}e._onUpdate=M,e._initted=(!e._op||e._pt)&&!m,L&&t<=0&&X.render(zs,!0,!0)},mE=function(i,e,t,r){var s,a,n=e.ease||r||"power1.inOut";if(Ci(e))a=t[i]||(t[i]=[]),e.forEach(function(o,l){return a.push({t:l/(e.length-1)*100,v:o,e:n})});else for(s in e)a=t[s]||(t[s]=[]),s==="ease"||a.push({t:parseFloat(i),v:e[s],e:n})},fc=function(i,e,t,r,s){return Vt(i)?i.call(e,t,r,s):fi(i)&&~i.indexOf("random(")?Vc(i):i},Ub=S0+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",kb={};Yi(Ub+",id,stagger,delay,duration,paused,scrollTrigger",function(i){return kb[i]=1});var ti=function(i){function e(r,s,a,n){var o;typeof s=="number"&&(a.duration=s,s=a,a=null);var l,c,h,u,d,p,f,g,m=(o=i.call(this,n?s:pc(s))||this).vars,v=m.duration,_=m.delay,y=m.immediateRender,x=m.stagger,b=m.overwrite,M=m.keyframes,T=m.defaults,A=m.scrollTrigger,L=m.yoyoEase,U=s.parent||Dt,P=(Ci(r)||lb(r)?js(r[0]):"length"in s)?[r]:Sr(r);if(o._targets=P.length?T0(P):zc(0,!ur.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=b,M||x||xu(v)||xu(_)){if(s=o.vars,(l=o.timeline=new Bi({data:"nested",defaults:T||{},targets:U&&U.data==="nested"?U.vars.targets:P})).kill(),l.parent=l._dp=Is(o),l._start=0,x||xu(v)||xu(_)){if(u=P.length,f=x&&wb(x),vs(x))for(d in x)~Ub.indexOf(d)&&(g||(g={}),g[d]=x[d]);for(c=0;c<u;c++)(h=xd(s,kb)).stagger=0,L&&(h.yoyoEase=L),g&&qn(h,g),p=P[c],h.duration=+fc(v,Is(o),c,p,P),h.delay=(+fc(_,Is(o),c,p,P)||0)-o._delay,!x&&u===1&&h.delay&&(o._delay=_=h.delay,o._start+=_,h.delay=0),l.to(p,h,f?f(c,p,P):0),l._ease=tt.none;l.duration()?v=_=0:o.timeline=0}else if(M){pc(Ar(l.vars.defaults,{ease:"none"})),l._ease=Dn(M.ease||s.ease||"none");var E,I,S,V=0;if(Ci(M))M.forEach(function(J){return l.to(P,J,">")}),l.duration();else{for(d in h={},M)d==="ease"||d==="easeEach"||mE(d,M[d],h,M.easeEach);for(d in h)for(E=h[d].sort(function(J,X){return J.t-X.t}),V=0,c=0;c<E.length;c++)(S={ease:(I=E[c]).e,duration:(I.t-(c?E[c-1].t:0))/100*v})[d]=I.v,l.to(P,S,V),V+=S.duration;l.duration()<v&&l.to({},{duration:v-l.duration()})}}v||o.duration(v=l.duration())}else o.timeline=0;return b!==!0||y0||(_a=Is(o),Dt.killTweensOf(P),_a=0),as(U,Is(o),a),s.reversed&&o.reverse(),s.paused&&o.paused(!0),(y||!v&&!M&&o._start===pi(U._time)&&Zi(y)&&aE(Is(o))&&U.data!=="nested")&&(o._tTime=-1e-8,o.render(Math.max(0,-_)||0)),A&&xb(Is(o),A),o}sb(e,i);var t=e.prototype;return t.render=function(r,s,a){var n,o,l,c,h,u,d,p,f,g=this._time,m=this._tDur,v=this._dur,_=r<0,y=r>m-Hi&&!_?m:r<Hi?0:r;if(v){if(y!==this._tTime||!r||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==_){if(n=y,p=this.timeline,this._repeat){if(c=v+this._rDelay,this._repeat<-1&&_)return this.totalTime(100*c+r,s,a);if(n=pi(y%c),y===m?(l=this._repeat,n=v):((l=~~(y/c))&&l===pi(y/c)&&(n=v,l--),n>v&&(n=v)),(u=this._yoyo&&1&l)&&(f=this._yEase,n=v-n),h=jo(this._tTime,c),n===g&&!a&&this._initted&&l===h)return this._tTime=y,this;l!==h&&(p&&this._yEase&&Lb(p,u),this.vars.repeatRefresh&&!u&&!this._lock&&this._time!==c&&this._initted&&(this._lock=a=1,this.render(pi(c*l),!0).invalidate()._lock=0))}if(!this._initted){if(ny(this,_?r:n,a,s,y))return this._tTime=0,this;if(!(g===this._time||a&&this.vars.repeatRefresh&&l!==h))return this;if(v!==this._dur)return this.render(r,s,a)}if(this._tTime=y,this._time=n,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=d=(f||this._ease)(n/v),this._from&&(this.ratio=d=1-d),n&&!g&&!s&&!l&&(rr(this,"onStart"),this._tTime!==y))return this;for(o=this._pt;o;)o.r(d,o.d),o=o._next;p&&p.render(r<0?r:p._dur*p._ease(n/this._dur),s,a)||this._startAt&&(this._zTime=r),this._onUpdate&&!s&&(_&&wm(this,r,0,a),rr(this,"onUpdate")),this._repeat&&l!==h&&this.vars.onRepeat&&!s&&this.parent&&rr(this,"onRepeat"),y!==this._tDur&&y||this._tTime!==y||(_&&!this._onUpdate&&wm(this,r,0,!0),(r||!v)&&(y===this._tDur&&this._ts>0||!y&&this._ts<0)&&Ua(this,1),s||_&&!g||!(y||g||u)||(rr(this,y===m?"onComplete":"onReverseComplete",!0),this._prom&&!(y<m&&this.timeScale()>0)&&this._prom()))}}else(function(x,b,M,T){var A,L,U,P=x.ratio,E=b<0||!b&&(!x._start&&nE(x)&&(x._initted||!hg(x))||(x._ts<0||x._dp._ts<0)&&!hg(x))?0:1,I=x._rDelay,S=0;if(I&&x._repeat&&(S=fh(0,x._tDur,b),L=jo(S,I),x._yoyo&&1&L&&(E=1-E),L!==jo(x._tTime,I)&&(P=1-E,x.vars.repeatRefresh&&x._initted&&x.invalidate())),E!==P||Ii||T||x._zTime===Hi||!b&&x._zTime){if(!x._initted&&ny(x,b,T,M,S))return;for(U=x._zTime,x._zTime=b||(M?Hi:0),M||(M=b&&!U),x.ratio=E,x._from&&(E=1-E),x._time=0,x._tTime=S,A=x._pt;A;)A.r(E,A.d),A=A._next;b<0&&wm(x,b,0,!0),x._onUpdate&&!M&&rr(x,"onUpdate"),S&&x._repeat&&!M&&x.parent&&rr(x,"onRepeat"),(b>=x._tDur||b<0)&&x.ratio===E&&(E&&Ua(x,1),M||Ii||(rr(x,E?"onComplete":"onReverseComplete",!0),x._prom&&x._prom()))}else x._zTime||(x._zTime=b)})(this,r,s,a);return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),i.prototype.invalidate.call(this,r)},t.resetTo=function(r,s,a,n,o){Fc||or.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||fg(this,l),function(c,h,u,d,p,f,g,m){var v,_,y,x,b=(c._pt&&c._ptCache||(c._ptCache={}))[h];if(!b)for(b=c._ptCache[h]=[],y=c._ptLookup,x=c._targets.length;x--;){if((v=y[x][h])&&v.d&&v.d._pt)for(v=v.d._pt;v&&v.p!==h&&v.fp!==h;)v=v._next;if(!v)return mg=1,c.vars[h]="+=0",fg(c,g),mg=0,m?zc():1;b.push(v)}for(x=b.length;x--;)(v=(_=b[x])._pt||_).s=!d&&d!==0||p?v.s+(d||0)+f*v.c:d,v.c=u-v.s,_.e&&(_.e=Xt(u)+Pi(_.e)),_.b&&(_.b=v.s+Pi(_.b))}(this,r,s,a,n,this._ease(l/this._dur),l,o)?this.resetTo(r,s,a,n,1):(bp(this,0),this.parent||_b(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,s){if(s===void 0&&(s="all"),!(r||s&&s!=="all"))return this._lazy=this._pt=0,this.parent?tc(this):this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(r,s,_a&&_a.vars.overwrite!==!0)._first||tc(this),this.parent&&a!==this.timeline.totalDuration()&&dl(this,this._dur*this.timeline._tDur/a,0,1),this}var n,o,l,c,h,u,d,p=this._targets,f=r?Sr(r):p,g=this._ptLookup,m=this._pt;if((!s||s==="all")&&function(v,_){for(var y=v.length,x=y===_.length;x&&y--&&v[y]===_[y];);return y<0}(p,f))return s==="all"&&(this._pt=0),tc(this);for(n=this._op=this._op||[],s!=="all"&&(fi(s)&&(h={},Yi(s,function(v){return h[v]=1}),s=h),s=function(v,_){var y,x,b,M,T=v[0]?In(v[0]).harness:0,A=T&&T.aliases;if(!A)return _;for(x in y=qn({},_),A)if(x in y)for(b=(M=A[x].split(",")).length;b--;)y[M[b]]=y[x];return y}(p,s)),d=p.length;d--;)if(~f.indexOf(p[d]))for(h in o=g[d],s==="all"?(n[d]=s,c=o,l={}):(l=n[d]=n[d]||{},c=s),c)(u=o&&o[h])&&("kill"in u.d&&u.d.kill(h)!==!0||yp(this,u,"_pt"),delete o[h]),l!=="all"&&(l[h]=1);return this._initted&&!this._pt&&m&&tc(this),this},e.to=function(r,s){return new e(r,s,arguments[2])},e.from=function(r,s){return mc(1,arguments)},e.delayedCall=function(r,s,a,n){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:s,onReverseComplete:s,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:n})},e.fromTo=function(r,s,a){return mc(2,arguments)},e.set=function(r,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(r,s)},e.killTweensOf=function(r,s,a){return Dt.killTweensOf(r,s,a)},e}(Hc);Ar(ti.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Yi("staggerTo,staggerFrom,staggerFromTo",function(i){ti[i]=function(){var e=new Bi,t=ug.call(arguments,0);return t.splice(i==="staggerFromTo"?5:4,0,0),e[i].apply(e,t)}});var A0=function(i,e,t){return i[e]=t},Fb=function(i,e,t){return i[e](t)},fE=function(i,e,t,r){return i[e](r.fp,t)},gE=function(i,e,t){return i.setAttribute(e,t)},C0=function(i,e){return Vt(i[e])?Fb:b0(i[e])&&i.setAttribute?gE:A0},zb=function(i,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*i))/1e6,e)},vE=function(i,e){return e.set(e.t,e.p,!!(e.s+e.c*i),e)},Bb=function(i,e){var t=e._pt,r="";if(!i&&e.b)r=e.b;else if(i===1&&e.e)r=e.e;else{for(;t;)r=t.p+(t.m?t.m(t.s+t.c*i):Math.round(1e4*(t.s+t.c*i))/1e4)+r,t=t._next;r+=e.c}e.set(e.t,e.p,r,e)},gg=function(i,e){for(var t=e._pt;t;)t.r(i,t.d),t=t._next},_E=function(i,e,t,r){for(var s,a=this._pt;a;)s=a._next,a.p===r&&a.modifier(i,e,t),a=s},yE=function(i){for(var e,t,r=this._pt;r;)t=r._next,r.p===i&&!r.op||r.op===i?yp(this,r,"_pt"):r.dep||(e=1),r=t;return!e},xE=function(i,e,t,r){r.mSet(i,e,r.m.call(r.tween,t,r.mt),r)},Vb=function(i){for(var e,t,r,s,a=i._pt;a;){for(e=a._next,t=r;t&&t.pr>a.pr;)t=t._next;(a._prev=t?t._prev:s)?a._prev._next=a:r=a,(a._next=t)?t._prev=a:s=a,a=e}i._pt=r},Ki=function(){function i(e,t,r,s,a,n,o,l,c){this.t=t,this.s=s,this.c=a,this.p=r,this.r=n||zb,this.d=o||this,this.set=l||A0,this.pr=c||0,this._next=e,e&&(e._prev=this)}return i.prototype.modifier=function(e,t,r){this.mSet=this.mSet||this.set,this.set=xE,this.m=e,this.mt=r,this.tween=t},i}();Yi(S0+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(i){return w0[i]=1}),lr.TweenMax=lr.TweenLite=ti,lr.TimelineLite=lr.TimelineMax=Bi,Dt=new Bi({sortChildren:!1,defaults:ul,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),ur.stringFilter=Rb;var On=[],id={},bE=[],dy=0,ME=0,Am=function(i){return(id[i]||bE).map(function(e){return e()})},vg=function(){var i=Date.now(),e=[];i-dy>2&&(Am("matchMediaInit"),On.forEach(function(t){var r,s,a,n,o=t.queries,l=t.conditions;for(s in o)(r=rs.matchMedia(o[s]).matches)&&(a=1),r!==l[s]&&(l[s]=r,n=1);n&&(t.revert(),a&&e.push(t))}),Am("matchMediaRevert"),e.forEach(function(t){return t.onMatch(t,function(r){return t.add(null,r)})}),dy=i,Am("matchMedia"))},Hb=function(){function i(t,r){this.selector=r&&dg(r),this.data=[],this._r=[],this.isReverted=!1,this.id=ME++,t&&this.add(t)}var e=i.prototype;return e.add=function(t,r,s){Vt(t)&&(s=r,r=t,t=Vt);var a=this,n=function(){var o,l=Pt,c=a.selector;return l&&l!==a&&l.data.push(a),s&&(a.selector=dg(s)),Pt=a,o=r.apply(a,arguments),Vt(o)&&a._r.push(o),Pt=l,a.selector=c,a.isReverted=!1,o};return a.last=n,t===Vt?n(a,function(o){return a.add(null,o)}):t?a[t]=n:n},e.ignore=function(t){var r=Pt;Pt=null,t(this),Pt=r},e.getTweens=function(){var t=[];return this.data.forEach(function(r){return r instanceof i?t.push.apply(t,r.getTweens()):r instanceof ti&&!(r.parent&&r.parent.data==="nested")&&t.push(r)}),t},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,r){var s=this;if(t?function(){for(var n,o=s.getTweens(),l=s.data.length;l--;)(n=s.data[l]).data==="isFlip"&&(n.revert(),n.getChildren(!0,!0,!1).forEach(function(c){return o.splice(o.indexOf(c),1)}));for(o.map(function(c){return{g:c._dur||c._delay||c._sat&&!c._sat.vars.immediateRender?c.globalTime(0):-1/0,t:c}}).sort(function(c,h){return h.g-c.g||-1/0}).forEach(function(c){return c.t.revert(t)}),l=s.data.length;l--;)(n=s.data[l])instanceof Bi?n.data!=="nested"&&(n.scrollTrigger&&n.scrollTrigger.revert(),n.kill()):!(n instanceof ti)&&n.revert&&n.revert(t);s._r.forEach(function(c){return c(t,s)}),s.isReverted=!0}():this.data.forEach(function(n){return n.kill&&n.kill()}),this.clear(),r)for(var a=On.length;a--;)On[a].id===this.id&&On.splice(a,1)},e.revert=function(t){this.kill(t||{})},i}(),wE=function(){function i(t){this.contexts=[],this.scope=t,Pt&&Pt.data.push(this)}var e=i.prototype;return e.add=function(t,r,s){vs(t)||(t={matches:t});var a,n,o,l=new Hb(0,s||this.scope),c=l.conditions={};for(n in Pt&&!l.selector&&(l.selector=Pt.selector),this.contexts.push(l),r=l.add("onMatch",r),l.queries=t,t)n==="all"?o=1:(a=rs.matchMedia(t[n]))&&(On.indexOf(l)<0&&On.push(l),(c[n]=a.matches)&&(o=1),a.addListener?a.addListener(vg):a.addEventListener("change",vg));return o&&r(l,function(h){return l.add(null,h)}),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach(function(r){return r.kill(t,!0)})},i}(),Md={registerPlugin:function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];e.forEach(function(r){return Ab(r)})},timeline:function(i){return new Bi(i)},getTweensOf:function(i,e){return Dt.getTweensOf(i,e)},getProperty:function(i,e,t,r){fi(i)&&(i=Sr(i)[0]);var s=In(i||{}).get,a=t?vb:gb;return t==="native"&&(t=""),i&&(e?a((ir[e]&&ir[e].get||s)(i,e,t,r)):function(n,o,l){return a((ir[n]&&ir[n].get||s)(i,n,o,l))})},quickSetter:function(i,e,t){if((i=Sr(i)).length>1){var r=i.map(function(c){return Qi.quickSetter(c,e,t)}),s=r.length;return function(c){for(var h=s;h--;)r[h](c)}}i=i[0]||{};var a=ir[e],n=In(i),o=n.harness&&(n.harness.aliases||{})[e]||e,l=a?function(c){var h=new a;Lo._pt=0,h.init(i,t?c+t:c,Lo,0,[i]),h.render(1,h),Lo._pt&&gg(1,Lo)}:n.set(i,o);return a?l:function(c){return l(i,o,t?c+t:c,n,1)}},quickTo:function(i,e,t){var r,s=Qi.to(i,qn(((r={})[e]="+=0.1",r.paused=!0,r),t||{})),a=function(n,o,l){return s.resetTo(e,n,o,l)};return a.tween=s,a},isTweening:function(i){return Dt.getTweensOf(i,!0).length>0},defaults:function(i){return i&&i.ease&&(i.ease=Dn(i.ease,ul.ease)),sy(ul,i||{})},config:function(i){return sy(ur,i||{})},registerEffect:function(i){var e=i.name,t=i.effect,r=i.plugins,s=i.defaults,a=i.extendTimeline;(r||"").split(",").forEach(function(n){return n&&!ir[n]&&!lr[n]&&zc()}),Mm[e]=function(n,o,l){return t(Sr(n),Ar(o||{},s),l)},a&&(Bi.prototype[e]=function(n,o,l){return this.add(Mm[e](n,vs(o)?o:(l=o)&&{},this),l)})},registerEase:function(i,e){tt[i]=Dn(e)},parseEase:function(i,e){return arguments.length?Dn(i,e):tt},getById:function(i){return Dt.getById(i)},exportRoot:function(i,e){i===void 0&&(i={});var t,r,s=new Bi(i);for(s.smoothChildTiming=Zi(i.smoothChildTiming),Dt.remove(s),s._dp=0,s._time=s._tTime=Dt._time,t=Dt._first;t;)r=t._next,!e&&!t._dur&&t instanceof ti&&t.vars.onComplete===t._targets[0]||as(s,t,t._start-t._delay),t=r;return as(Dt,s,0),s},context:function(i,e){return i?new Hb(i,e):Pt},matchMedia:function(i){return new wE(i)},matchMediaRefresh:function(){return On.forEach(function(i){var e,t,r=i.conditions;for(t in r)r[t]&&(r[t]=!1,e=1);e&&i.revert()})||vg()},addEventListener:function(i,e){var t=id[i]||(id[i]=[]);~t.indexOf(e)||t.push(e)},removeEventListener:function(i,e){var t=id[i],r=t&&t.indexOf(e);r>=0&&t.splice(r,1)},utils:{wrap:function i(e,t,r){var s=t-e;return Ci(e)?ly(e,i(0,e.length),t):va(r,function(a){return(s+(a-e)%s)%s+e})},wrapYoyo:function i(e,t,r){var s=t-e,a=2*s;return Ci(e)?ly(e,i(0,e.length-1),t):va(r,function(n){return e+((n=(a+(n-e)%a)%a||0)>s?a-n:n)})},distribute:wb,random:Tb,snap:Sb,normalize:function(i,e,t){return cy(i,e,0,1,t)},getUnit:Pi,clamp:function(i,e,t){return va(t,function(r){return fh(i,e,r)})},splitColor:Cb,toArray:Sr,selector:dg,mapRange:cy,pipe:function(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];return function(r){return e.reduce(function(s,a){return a(s)},r)}},unitize:function(i,e){return function(t){return i(parseFloat(t))+(e||Pi(t))}},interpolate:function i(e,t,r,s){var a=isNaN(e+t)?0:function(p){return(1-p)*e+p*t};if(!a){var n,o,l,c,h,u=fi(e),d={};if(r===!0&&(s=1)&&(r=null),u)e={p:e},t={p:t};else if(Ci(e)&&!Ci(t)){for(l=[],c=e.length,h=c-2,o=1;o<c;o++)l.push(i(e[o-1],e[o]));c--,a=function(p){p*=c;var f=Math.min(h,~~p);return l[f](p-f)},r=t}else s||(e=qn(Ci(e)?[]:{},e));if(!l){for(n in t)E0.call(d,e,n,"get",t[n]);a=function(p){return gg(p,d)||(u?e.p:e)}}}return va(r,a)},shuffle:Mb},install:db,effects:Mm,ticker:or,updateRoot:Bi.updateRoot,plugins:ir,globalTimeline:Dt,core:{PropTween:Ki,globals:pb,Tween:ti,Timeline:Bi,Animation:Hc,getCache:In,_removeLinkedListItem:yp,reverting:function(){return Ii},context:function(i){return i&&Pt&&(Pt.data.push(i),i._ctx=Pt),Pt},suppressOverwrites:function(i){return y0=i}}};Yi("to,from,fromTo,delayedCall,set,killTweensOf",function(i){return Md[i]=ti[i]}),or.add(Bi.updateRoot),Lo=Md.to({},{duration:0});var SE=function(i,e){for(var t=i._pt;t&&t.p!==e&&t.op!==e&&t.fp!==e;)t=t._next;return t},Cm=function(i,e){return{name:i,rawVars:1,init:function(t,r,s){s._onInit=function(a){var n,o;if(fi(r)&&(n={},Yi(r,function(l){return n[l]=1}),r=n),e){for(o in n={},r)n[o]=e(r[o]);r=n}(function(l,c){var h,u,d,p=l._targets;for(h in c)for(u=p.length;u--;)(d=l._ptLookup[u][h])&&(d=d.d)&&(d._pt&&(d=SE(d,h)),d&&d.modifier&&d.modifier(c[h],l,p[u],h))})(a,r)}}}},Qi=Md.registerPlugin({name:"attr",init:function(i,e,t,r,s){var a,n,o;for(a in this.tween=t,e)o=i.getAttribute(a)||"",(n=this.add(i,"setAttribute",(o||0)+"",e[a],r,s,0,0,a)).op=a,n.b=o,this._props.push(a)},render:function(i,e){for(var t=e._pt;t;)Ii?t.set(t.t,t.p,t.b,t):t.r(i,t.d),t=t._next}},{name:"endArray",init:function(i,e){for(var t=e.length;t--;)this.add(i,t,i[t]||0,e[t],0,0,0,0,0,1)}},Cm("roundProps",pg),Cm("modifiers"),Cm("snap",Sb))||Md;ti.version=Bi.version=Qi.version="3.12.5",ab=1,M0()&&pl(),tt.Power0,tt.Power1,tt.Power2,tt.Power3,tt.Power4,tt.Linear,tt.Quad,tt.Cubic,tt.Quart,tt.Quint,tt.Strong,tt.Elastic,tt.Back,tt.SteppedEase,tt.Bounce,tt.Sine,tt.Expo,tt.Circ;var py,ya,Wo,P0,En,my,R0,Gb,Ws={},fn=180/Math.PI,Xo=Math.PI/180,wo=Math.atan2,I0=/([A-Z])/g,TE=/(left|right|width|margin|padding|x)/i,EE=/[\s,\(]\S/,ls={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_g=function(i,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*i))/1e4+e.u,e)},AE=function(i,e){return e.set(e.t,e.p,i===1?e.e:Math.round(1e4*(e.s+e.c*i))/1e4+e.u,e)},CE=function(i,e){return e.set(e.t,e.p,i?Math.round(1e4*(e.s+e.c*i))/1e4+e.u:e.b,e)},PE=function(i,e){var t=e.s+e.c*i;e.set(e.t,e.p,~~(t+(t<0?-.5:.5))+e.u,e)},jb=function(i,e){return e.set(e.t,e.p,i?e.e:e.b,e)},Wb=function(i,e){return e.set(e.t,e.p,i!==1?e.b:e.e,e)},RE=function(i,e,t){return i.style[e]=t},IE=function(i,e,t){return i.style.setProperty(e,t)},LE=function(i,e,t){return i._gsap[e]=t},DE=function(i,e,t){return i._gsap.scaleX=i._gsap.scaleY=t},OE=function(i,e,t,r,s){var a=i._gsap;a.scaleX=a.scaleY=t,a.renderTransform(s,a)},NE=function(i,e,t,r,s){var a=i._gsap;a[e]=t,a.renderTransform(s,a)},Nt="transform",$i=Nt+"Origin",UE=function i(e,t){var r=this,s=this.target,a=s.style,n=s._gsap;if(e in Ws&&a){if(this.tfm=this.tfm||{},e==="transform")return ls.transform.split(",").forEach(function(o){return i.call(r,o,t)});if(~(e=ls[e]||e).indexOf(",")?e.split(",").forEach(function(o){return r.tfm[o]=Ls(s,o)}):this.tfm[e]=n.x?n[e]:Ls(s,e),e===$i&&(this.tfm.zOrigin=n.zOrigin),this.props.indexOf(Nt)>=0)return;n.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push($i,t,"")),e=Nt}(a||t)&&this.props.push(e,t,a[e])},Xb=function(i){i.translate&&(i.removeProperty("translate"),i.removeProperty("scale"),i.removeProperty("rotate"))},kE=function(){var i,e,t=this.props,r=this.target,s=r.style,a=r._gsap;for(i=0;i<t.length;i+=3)t[i+1]?r[t[i]]=t[i+2]:t[i+2]?s[t[i]]=t[i+2]:s.removeProperty(t[i].substr(0,2)==="--"?t[i]:t[i].replace(I0,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)a[e]=this.tfm[e];a.svg&&(a.renderTransform(),r.setAttribute("data-svg-origin",this.svgo||"")),(i=R0())&&i.isStart||s[Nt]||(Xb(s),a.zOrigin&&s[$i]&&(s[$i]+=" "+a.zOrigin+"px",a.zOrigin=0,a.renderTransform()),a.uncache=1)}},qb=function(i,e){var t={target:i,props:[],revert:kE,save:UE};return i._gsap||Qi.core.getCache(i),e&&e.split(",").forEach(function(r){return t.save(r)}),t},yg=function(i,e){var t=ya.createElementNS?ya.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),i):ya.createElement(i);return t&&t.style?t:ya.createElement(i)},ps=function i(e,t,r){var s=getComputedStyle(e);return s[t]||s.getPropertyValue(t.replace(I0,"-$1").toLowerCase())||s.getPropertyValue(t)||!r&&i(e,ml(t)||t,1)||""},fy="O,Moz,ms,Ms,Webkit".split(","),ml=function(i,e,t){var r=(e||En).style,s=5;if(i in r&&!t)return i;for(i=i.charAt(0).toUpperCase()+i.substr(1);s--&&!(fy[s]+i in r););return s<0?null:(s===3?"ms":s>=0?fy[s]:"")+i},xg=function(){typeof window<"u"&&window.document&&(py=window,ya=py.document,Wo=ya.documentElement,En=yg("div")||{style:{}},yg("div"),Nt=ml(Nt),$i=Nt+"Origin",En.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Gb=!!ml("perspective"),R0=Qi.core.reverting,P0=1)},Pm=function i(e){var t,r=yg("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,a=this.nextSibling,n=this.style.cssText;if(Wo.appendChild(r),r.appendChild(this),this.style.display="block",e)try{t=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=i}catch{}else this._gsapBBox&&(t=this._gsapBBox());return s&&(a?s.insertBefore(this,a):s.appendChild(this)),Wo.removeChild(r),this.style.cssText=n,t},gy=function(i,e){for(var t=e.length;t--;)if(i.hasAttribute(e[t]))return i.getAttribute(e[t])},Yb=function(i){var e;try{e=i.getBBox()}catch{e=Pm.call(i,!0)}return e&&(e.width||e.height)||i.getBBox===Pm||(e=Pm.call(i,!0)),!e||e.width||e.x||e.y?e:{x:+gy(i,["x","cx","x1"])||0,y:+gy(i,["y","cy","y1"])||0,width:0,height:0}},Zb=function(i){return!(!i.getCTM||i.parentNode&&!i.ownerSVGElement||!Yb(i))},Yn=function(i,e){if(e){var t,r=i.style;e in Ws&&e!==$i&&(e=Nt),r.removeProperty?((t=e.substr(0,2))!=="ms"&&e.substr(0,6)!=="webkit"||(e="-"+e),r.removeProperty(t==="--"?e:e.replace(I0,"-$1").toLowerCase())):r.removeAttribute(e)}},xa=function(i,e,t,r,s,a){var n=new Ki(i._pt,e,t,0,1,a?Wb:jb);return i._pt=n,n.b=r,n.e=s,i._props.push(t),n},vy={deg:1,rad:1,turn:1},FE={grid:1,flex:1},ka=function i(e,t,r,s){var a,n,o,l,c=parseFloat(r)||0,h=(r+"").trim().substr((c+"").length)||"px",u=En.style,d=TE.test(t),p=e.tagName.toLowerCase()==="svg",f=(p?"client":"offset")+(d?"Width":"Height"),g=100,m=s==="px",v=s==="%";if(s===h||!c||vy[s]||vy[h])return c;if(h!=="px"&&!m&&(c=i(e,t,r,"px")),l=e.getCTM&&Zb(e),(v||h==="%")&&(Ws[t]||~t.indexOf("adius")))return a=l?e.getBBox()[d?"width":"height"]:e[f],Xt(v?c/a*g:c/100*a);if(u[d?"width":"height"]=g+(m?h:s),n=~t.indexOf("adius")||s==="em"&&e.appendChild&&!p?e:e.parentNode,l&&(n=(e.ownerSVGElement||{}).parentNode),n&&n!==ya&&n.appendChild||(n=ya.body),(o=n._gsap)&&v&&o.width&&d&&o.time===or.time&&!o.uncache)return Xt(c/o.width*g);if(!v||t!=="height"&&t!=="width")(v||h==="%")&&!FE[ps(n,"display")]&&(u.position=ps(e,"position")),n===e&&(u.position="static"),n.appendChild(En),a=En[f],n.removeChild(En),u.position="absolute";else{var _=e.style[t];e.style[t]=g+s,a=e[f],_?e.style[t]=_:Yn(e,t)}return d&&v&&((o=In(n)).time=or.time,o.width=n[f]),Xt(m?a*c/g:a&&c?g/a*c:0)},Ls=function(i,e,t,r){var s;return P0||xg(),e in ls&&e!=="transform"&&~(e=ls[e]).indexOf(",")&&(e=e.split(",")[0]),Ws[e]&&e!=="transform"?(s=jc(i,r),s=e!=="transformOrigin"?s[e]:s.svg?s.origin:Sd(ps(i,$i))+" "+s.zOrigin+"px"):(!(s=i.style[e])||s==="auto"||r||~(s+"").indexOf("calc("))&&(s=wd[e]&&wd[e](i,e,t)||ps(i,e)||mb(i,e)||(e==="opacity"?1:0)),t&&!~(s+"").trim().indexOf(" ")?ka(i,e,s,t)+t:s},zE=function(i,e,t,r){if(!t||t==="none"){var s=ml(e,i,1),a=s&&ps(i,s,1);a&&a!==t?(e=s,t=a):e==="borderColor"&&(t=ps(i,"borderTopColor"))}var n,o,l,c,h,u,d,p,f,g,m,v=new Ki(this._pt,i.style,e,0,1,Bb),_=0,y=0;if(v.b=t,v.e=r,t+="",(r+="")=="auto"&&(u=i.style[e],i.style[e]=r,r=ps(i,e)||r,u?i.style[e]=u:Yn(i,e)),Rb(n=[t,r]),r=n[1],l=(t=n[0]).match(Do)||[],(r.match(Do)||[]).length){for(;o=Do.exec(r);)d=o[0],f=r.substring(_,o.index),h?h=(h+1)%5:f.substr(-5)!=="rgba("&&f.substr(-5)!=="hsla("||(h=1),d!==(u=l[y++]||"")&&(c=parseFloat(u)||0,m=u.substr((c+"").length),d.charAt(1)==="="&&(d=Go(c,d)+m),p=parseFloat(d),g=d.substr((p+"").length),_=Do.lastIndex-g.length,g||(g=g||ur.units[e]||m,_===r.length&&(r+=g,v.e+=g)),m!==g&&(c=ka(i,e,u,g)||0),v._pt={_next:v._pt,p:f||y===1?f:",",s:c,c:p-c,m:h&&h<4||e==="zIndex"?Math.round:0});v.c=_<r.length?r.substring(_,r.length):""}else v.r=e==="display"&&r==="none"?Wb:jb;return hb.test(r)&&(v.e=0),this._pt=v,v},_y={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},BE=function(i){var e=i.split(" "),t=e[0],r=e[1]||"50%";return t!=="top"&&t!=="bottom"&&r!=="left"&&r!=="right"||(i=t,t=r,r=i),e[0]=_y[t]||t,e[1]=_y[r]||r,e.join(" ")},VE=function(i,e){if(e.tween&&e.tween._time===e.tween._dur){var t,r,s,a=e.t,n=a.style,o=e.u,l=a._gsap;if(o==="all"||o===!0)n.cssText="",r=1;else for(s=(o=o.split(",")).length;--s>-1;)t=o[s],Ws[t]&&(r=1,t=t==="transformOrigin"?$i:Nt),Yn(a,t);r&&(Yn(a,Nt),l&&(l.svg&&a.removeAttribute("transform"),jc(a,1),l.uncache=1,Xb(n)))}},wd={clearProps:function(i,e,t,r,s){if(s.data!=="isFromStart"){var a=i._pt=new Ki(i._pt,e,t,0,0,VE);return a.u=r,a.pr=-10,a.tween=s,i._props.push(t),1}}},Gc=[1,0,0,1,0,0],Kb={},Qb=function(i){return i==="matrix(1, 0, 0, 1, 0, 0)"||i==="none"||!i},yy=function(i){var e=ps(i,Nt);return Qb(e)?Gc:e.substr(7).match(cb).map(Xt)},L0=function(i,e){var t,r,s,a,n=i._gsap||In(i),o=i.style,l=yy(i);return n.svg&&i.getAttribute("transform")?(l=[(s=i.transform.baseVal.consolidate().matrix).a,s.b,s.c,s.d,s.e,s.f]).join(",")==="1,0,0,1,0,0"?Gc:l:(l!==Gc||i.offsetParent||i===Wo||n.svg||(s=o.display,o.display="block",(t=i.parentNode)&&i.offsetParent||(a=1,r=i.nextElementSibling,Wo.appendChild(i)),l=yy(i),s?o.display=s:Yn(i,"display"),a&&(r?t.insertBefore(i,r):t?t.appendChild(i):Wo.removeChild(i))),e&&l.length>6?[l[0],l[1],l[4],l[5],l[12],l[13]]:l)},bg=function(i,e,t,r,s,a){var n,o,l,c=i._gsap,h=s||L0(i,!0),u=c.xOrigin||0,d=c.yOrigin||0,p=c.xOffset||0,f=c.yOffset||0,g=h[0],m=h[1],v=h[2],_=h[3],y=h[4],x=h[5],b=e.split(" "),M=parseFloat(b[0])||0,T=parseFloat(b[1])||0;t?h!==Gc&&(o=g*_-m*v)&&(l=M*(-m/o)+T*(g/o)-(g*x-m*y)/o,M=M*(_/o)+T*(-v/o)+(v*x-_*y)/o,T=l):(M=(n=Yb(i)).x+(~b[0].indexOf("%")?M/100*n.width:M),T=n.y+(~(b[1]||b[0]).indexOf("%")?T/100*n.height:T)),r||r!==!1&&c.smooth?(y=M-u,x=T-d,c.xOffset=p+(y*g+x*v)-y,c.yOffset=f+(y*m+x*_)-x):c.xOffset=c.yOffset=0,c.xOrigin=M,c.yOrigin=T,c.smooth=!!r,c.origin=e,c.originIsAbsolute=!!t,i.style[$i]="0px 0px",a&&(xa(a,c,"xOrigin",u,M),xa(a,c,"yOrigin",d,T),xa(a,c,"xOffset",p,c.xOffset),xa(a,c,"yOffset",f,c.yOffset)),i.setAttribute("data-svg-origin",M+" "+T)},jc=function(i,e){var t=i._gsap||new Ob(i);if("x"in t&&!e&&!t.uncache)return t;var r,s,a,n,o,l,c,h,u,d,p,f,g,m,v,_,y,x,b,M,T,A,L,U,P,E,I,S,V,J,X,te,ie=i.style,fe=t.scaleX<0,B="px",j="deg",ae=getComputedStyle(i),O=ps(i,$i)||"0";return r=s=a=l=c=h=u=d=p=0,n=o=1,t.svg=!(!i.getCTM||!Zb(i)),ae.translate&&(ae.translate==="none"&&ae.scale==="none"&&ae.rotate==="none"||(ie[Nt]=(ae.translate!=="none"?"translate3d("+(ae.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(ae.rotate!=="none"?"rotate("+ae.rotate+") ":"")+(ae.scale!=="none"?"scale("+ae.scale.split(" ").join(",")+") ":"")+(ae[Nt]!=="none"?ae[Nt]:"")),ie.scale=ie.rotate=ie.translate="none"),m=L0(i,t.svg),t.svg&&(t.uncache?(P=i.getBBox(),O=t.xOrigin-P.x+"px "+(t.yOrigin-P.y)+"px",U=""):U=!e&&i.getAttribute("data-svg-origin"),bg(i,U||O,!!U||t.originIsAbsolute,t.smooth!==!1,m)),f=t.xOrigin||0,g=t.yOrigin||0,m!==Gc&&(x=m[0],b=m[1],M=m[2],T=m[3],r=A=m[4],s=L=m[5],m.length===6?(n=Math.sqrt(x*x+b*b),o=Math.sqrt(T*T+M*M),l=x||b?wo(b,x)*fn:0,(u=M||T?wo(M,T)*fn+l:0)&&(o*=Math.abs(Math.cos(u*Xo))),t.svg&&(r-=f-(f*x+g*M),s-=g-(f*b+g*T))):(te=m[6],J=m[7],I=m[8],S=m[9],V=m[10],X=m[11],r=m[12],s=m[13],a=m[14],c=(v=wo(te,V))*fn,v&&(U=A*(_=Math.cos(-v))+I*(y=Math.sin(-v)),P=L*_+S*y,E=te*_+V*y,I=A*-y+I*_,S=L*-y+S*_,V=te*-y+V*_,X=J*-y+X*_,A=U,L=P,te=E),h=(v=wo(-M,V))*fn,v&&(_=Math.cos(-v),X=T*(y=Math.sin(-v))+X*_,x=U=x*_-I*y,b=P=b*_-S*y,M=E=M*_-V*y),l=(v=wo(b,x))*fn,v&&(U=x*(_=Math.cos(v))+b*(y=Math.sin(v)),P=A*_+L*y,b=b*_-x*y,L=L*_-A*y,x=U,A=P),c&&Math.abs(c)+Math.abs(l)>359.9&&(c=l=0,h=180-h),n=Xt(Math.sqrt(x*x+b*b+M*M)),o=Xt(Math.sqrt(L*L+te*te)),v=wo(A,L),u=Math.abs(v)>2e-4?v*fn:0,p=X?1/(X<0?-X:X):0),t.svg&&(U=i.getAttribute("transform"),t.forceCSS=i.setAttribute("transform","")||!Qb(ps(i,Nt)),U&&i.setAttribute("transform",U))),Math.abs(u)>90&&Math.abs(u)<270&&(fe?(n*=-1,u+=l<=0?180:-180,l+=l<=0?180:-180):(o*=-1,u+=u<=0?180:-180)),e=e||t.uncache,t.x=r-((t.xPercent=r&&(!e&&t.xPercent||(Math.round(i.offsetWidth/2)===Math.round(-r)?-50:0)))?i.offsetWidth*t.xPercent/100:0)+B,t.y=s-((t.yPercent=s&&(!e&&t.yPercent||(Math.round(i.offsetHeight/2)===Math.round(-s)?-50:0)))?i.offsetHeight*t.yPercent/100:0)+B,t.z=a+B,t.scaleX=Xt(n),t.scaleY=Xt(o),t.rotation=Xt(l)+j,t.rotationX=Xt(c)+j,t.rotationY=Xt(h)+j,t.skewX=u+j,t.skewY=d+j,t.transformPerspective=p+B,(t.zOrigin=parseFloat(O.split(" ")[2])||!e&&t.zOrigin||0)&&(ie[$i]=Sd(O)),t.xOffset=t.yOffset=0,t.force3D=ur.force3D,t.renderTransform=t.svg?GE:Gb?$b:HE,t.uncache=0,t},Sd=function(i){return(i=i.split(" "))[0]+" "+i[1]},Rm=function(i,e,t){var r=Pi(e);return Xt(parseFloat(e)+parseFloat(ka(i,"x",t+"px",r)))+r},HE=function(i,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,$b(i,e)},nn="0deg",zl="0px",on=") ",$b=function(i,e){var t=e||this,r=t.xPercent,s=t.yPercent,a=t.x,n=t.y,o=t.z,l=t.rotation,c=t.rotationY,h=t.rotationX,u=t.skewX,d=t.skewY,p=t.scaleX,f=t.scaleY,g=t.transformPerspective,m=t.force3D,v=t.target,_=t.zOrigin,y="",x=m==="auto"&&i&&i!==1||m===!0;if(_&&(h!==nn||c!==nn)){var b,M=parseFloat(c)*Xo,T=Math.sin(M),A=Math.cos(M);M=parseFloat(h)*Xo,b=Math.cos(M),a=Rm(v,a,T*b*-_),n=Rm(v,n,-Math.sin(M)*-_),o=Rm(v,o,A*b*-_+_)}g!==zl&&(y+="perspective("+g+on),(r||s)&&(y+="translate("+r+"%, "+s+"%) "),(x||a!==zl||n!==zl||o!==zl)&&(y+=o!==zl||x?"translate3d("+a+", "+n+", "+o+") ":"translate("+a+", "+n+on),l!==nn&&(y+="rotate("+l+on),c!==nn&&(y+="rotateY("+c+on),h!==nn&&(y+="rotateX("+h+on),u===nn&&d===nn||(y+="skew("+u+", "+d+on),p===1&&f===1||(y+="scale("+p+", "+f+on),v.style[Nt]=y||"translate(0, 0)"},GE=function(i,e){var t,r,s,a,n,o=e||this,l=o.xPercent,c=o.yPercent,h=o.x,u=o.y,d=o.rotation,p=o.skewX,f=o.skewY,g=o.scaleX,m=o.scaleY,v=o.target,_=o.xOrigin,y=o.yOrigin,x=o.xOffset,b=o.yOffset,M=o.forceCSS,T=parseFloat(h),A=parseFloat(u);d=parseFloat(d),p=parseFloat(p),(f=parseFloat(f))&&(p+=f=parseFloat(f),d+=f),d||p?(d*=Xo,p*=Xo,t=Math.cos(d)*g,r=Math.sin(d)*g,s=Math.sin(d-p)*-m,a=Math.cos(d-p)*m,p&&(f*=Xo,n=Math.tan(p-f),s*=n=Math.sqrt(1+n*n),a*=n,f&&(n=Math.tan(f),t*=n=Math.sqrt(1+n*n),r*=n)),t=Xt(t),r=Xt(r),s=Xt(s),a=Xt(a)):(t=g,a=m,r=s=0),(T&&!~(h+"").indexOf("px")||A&&!~(u+"").indexOf("px"))&&(T=ka(v,"x",h,"px"),A=ka(v,"y",u,"px")),(_||y||x||b)&&(T=Xt(T+_-(_*t+y*s)+x),A=Xt(A+y-(_*r+y*a)+b)),(l||c)&&(n=v.getBBox(),T=Xt(T+l/100*n.width),A=Xt(A+c/100*n.height)),n="matrix("+t+","+r+","+s+","+a+","+T+","+A+")",v.setAttribute("transform",n),M&&(v.style[Nt]=n)},jE=function(i,e,t,r,s){var a,n,o=360,l=fi(s),c=parseFloat(s)*(l&&~s.indexOf("rad")?fn:1)-r,h=r+c+"deg";return l&&((a=s.split("_")[1])==="short"&&(c%=o)!==c%180&&(c+=c<0?o:-360),a==="cw"&&c<0?c=(c+36e9)%o-~~(c/o)*o:a==="ccw"&&c>0&&(c=(c-36e9)%o-~~(c/o)*o)),i._pt=n=new Ki(i._pt,e,t,r,c,AE),n.e=h,n.u="deg",i._props.push(t),n},xy=function(i,e){for(var t in e)i[t]=e[t];return i},WE=function(i,e,t){var r,s,a,n,o,l,c,h=xy({},t._gsap),u=t.style;for(s in h.svg?(a=t.getAttribute("transform"),t.setAttribute("transform",""),u[Nt]=e,r=jc(t,1),Yn(t,Nt),t.setAttribute("transform",a)):(a=getComputedStyle(t)[Nt],u[Nt]=e,r=jc(t,1),u[Nt]=a),Ws)(a=h[s])!==(n=r[s])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(s)<0&&(o=Pi(a)!==(c=Pi(n))?ka(t,s,a,c):parseFloat(a),l=parseFloat(n),i._pt=new Ki(i._pt,r,s,o,l-o,_g),i._pt.u=c||0,i._props.push(s));xy(r,h)};Yi("padding,margin,Width,Radius",function(i,e){var t="Top",r="Right",s="Bottom",a="Left",n=(e<3?[t,r,s,a]:[t+a,t+r,s+r,s+a]).map(function(o){return e<2?i+o:"border"+o+i});wd[e>1?"border"+i:i]=function(o,l,c,h,u){var d,p;if(arguments.length<4)return d=n.map(function(f){return Ls(o,f,c)}),(p=d.join(" ")).split(d[0]).length===5?d[0]:p;d=(h+"").split(" "),p={},n.forEach(function(f,g){return p[f]=d[g]=d[g]||d[(g-1)/2|0]}),o.init(l,p,u)}});var by,Im,Lm,Jb={name:"css",register:xg,targetTest:function(i){return i.style&&i.nodeType},init:function(i,e,t,r,s){var a,n,o,l,c,h,u,d,p,f,g,m,v,_,y,x,b=this._props,M=i.style,T=t.vars.startAt;for(u in P0||xg(),this.styles=this.styles||qb(i),x=this.styles.props,this.tween=t,e)if(u!=="autoRound"&&(n=e[u],!ir[u]||!Nb(u,e,t,r,i,s))){if(c=typeof n,h=wd[u],c==="function"&&(c=typeof(n=n.call(t,r,i,s))),c==="string"&&~n.indexOf("random(")&&(n=Vc(n)),h)h(this,i,u,n,t)&&(y=1);else if(u.substr(0,2)==="--")a=(getComputedStyle(i).getPropertyValue(u)+"").trim(),n+="",Pa.lastIndex=0,Pa.test(a)||(d=Pi(a),p=Pi(n)),p?d!==p&&(a=ka(i,u,a,p)+p):d&&(n+=d),this.add(M,"setProperty",a,n,r,s,0,0,u),b.push(u),x.push(u,0,M[u]);else if(c!=="undefined"){if(T&&u in T?(a=typeof T[u]=="function"?T[u].call(t,r,i,s):T[u],fi(a)&&~a.indexOf("random(")&&(a=Vc(a)),Pi(a+"")||a==="auto"||(a+=ur.units[u]||Pi(Ls(i,u))||""),(a+"").charAt(1)==="="&&(a=Ls(i,u))):a=Ls(i,u),l=parseFloat(a),(f=c==="string"&&n.charAt(1)==="="&&n.substr(0,2))&&(n=n.substr(2)),o=parseFloat(n),u in ls&&(u==="autoAlpha"&&(l===1&&Ls(i,"visibility")==="hidden"&&o&&(l=0),x.push("visibility",0,M.visibility),xa(this,M,"visibility",l?"inherit":"hidden",o?"inherit":"hidden",!o)),u!=="scale"&&u!=="transform"&&~(u=ls[u]).indexOf(",")&&(u=u.split(",")[0])),g=u in Ws)if(this.styles.save(u),m||((v=i._gsap).renderTransform&&!e.parseTransform||jc(i,e.parseTransform),_=e.smoothOrigin!==!1&&v.smooth,(m=this._pt=new Ki(this._pt,M,Nt,0,1,v.renderTransform,v,0,-1)).dep=1),u==="scale")this._pt=new Ki(this._pt,v,"scaleY",v.scaleY,(f?Go(v.scaleY,f+o):o)-v.scaleY||0,_g),this._pt.u=0,b.push("scaleY",u),u+="X";else{if(u==="transformOrigin"){x.push($i,0,M[$i]),n=BE(n),v.svg?bg(i,n,0,_,0,this):((p=parseFloat(n.split(" ")[2])||0)!==v.zOrigin&&xa(this,v,"zOrigin",v.zOrigin,p),xa(this,M,u,Sd(a),Sd(n)));continue}if(u==="svgOrigin"){bg(i,n,1,_,0,this);continue}if(u in Kb){jE(this,v,u,l,f?Go(l,f+n):n);continue}if(u==="smoothOrigin"){xa(this,v,"smooth",v.smooth,n);continue}if(u==="force3D"){v[u]=n;continue}if(u==="transform"){WE(this,n,i);continue}}else u in M||(u=ml(u)||u);if(g||(o||o===0)&&(l||l===0)&&!EE.test(n)&&u in M)o||(o=0),(d=(a+"").substr((l+"").length))!==(p=Pi(n)||(u in ur.units?ur.units[u]:d))&&(l=ka(i,u,a,p)),this._pt=new Ki(this._pt,g?v:M,u,l,(f?Go(l,f+o):o)-l,g||p!=="px"&&u!=="zIndex"||e.autoRound===!1?_g:PE),this._pt.u=p||0,d!==p&&p!=="%"&&(this._pt.b=a,this._pt.r=CE);else if(u in M)zE.call(this,i,u,a,f?f+n:n);else if(u in i)this.add(i,u,a||i[u],f?f+n:n,r,s);else if(u!=="parseTransform")continue;g||(u in M?x.push(u,0,M[u]):x.push(u,1,a||i[u])),b.push(u)}}y&&Vb(this)},render:function(i,e){if(e.tween._time||!R0())for(var t=e._pt;t;)t.r(i,t.d),t=t._next;else e.styles.revert()},get:Ls,aliases:ls,getSetter:function(i,e,t){var r=ls[e];return r&&r.indexOf(",")<0&&(e=r),e in Ws&&e!==$i&&(i._gsap.x||Ls(i,"x"))?t&&my===t?e==="scale"?DE:LE:(my=t||{})&&(e==="scale"?OE:NE):i.style&&!b0(i.style[e])?RE:~e.indexOf("-")?IE:C0(i,e)},core:{_removeProperty:Yn,_getMatrix:L0}};Qi.utils.checkPrefix=ml,Qi.core.getStyleSaver=qb,Lm=Yi((by="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(Im="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",function(i){Ws[i]=1}),Yi(Im,function(i){ur.units[i]="deg",Kb[i]=1}),ls[Lm[13]]=by+","+Im,Yi("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",function(i){var e=i.split(":");ls[e[1]]=Lm[e[0]]}),Yi("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(i){ur.units[i]="px"}),Qi.registerPlugin(Jb);var D0=Qi.registerPlugin(Jb)||Qi;D0.core.Tween;class eM extends Ve{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new se(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const So=new C,My=new Me,wy=new Me,Sy=new C,Ty=new C;class XE{constructor(e={}){const t=this;let r,s,a,n;const o={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");function c(u,d,p){if(u.isCSS2DObject){So.setFromMatrixPosition(u.matrixWorld),So.applyMatrix4(wy);const f=u.visible===!0&&So.z>=-1&&So.z<=1&&u.layers.test(p.layers)===!0;if(u.element.style.display=f===!0?"":"none",f===!0){u.onBeforeRender(t,d,p);const m=u.element;m.style.transform="translate("+-100*u.center.x+"%,"+-100*u.center.y+"%)translate("+(So.x*a+a)+"px,"+(-So.y*n+n)+"px)",m.parentNode!==l&&l.appendChild(m),u.onAfterRender(t,d,p)}const g={distanceToCameraSquared:h(p,u)};o.objects.set(u,g)}for(let f=0,g=u.children.length;f<g;f++)c(u.children[f],d,p)}function h(u,d){return Sy.setFromMatrixPosition(u.matrixWorld),Ty.setFromMatrixPosition(d.matrixWorld),Sy.distanceToSquared(Ty)}l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:r,height:s}},this.render=function(u,d){u.matrixWorldAutoUpdate===!0&&u.updateMatrixWorld(),d.parent===null&&d.matrixWorldAutoUpdate===!0&&d.updateMatrixWorld(),My.copy(d.matrixWorldInverse),wy.multiplyMatrices(d.projectionMatrix,My),c(u,u,d),function(p){const f=function(m){const v=[];return m.traverse(function(_){_.isCSS2DObject&&v.push(_)}),v}(p).sort(function(m,v){return m.renderOrder!==v.renderOrder?v.renderOrder-m.renderOrder:o.objects.get(m).distanceToCameraSquared-o.objects.get(v).distanceToCameraSquared}),g=f.length;for(let m=0,v=f.length;m<v;m++)f[m].element.style.zIndex=g-m}(u)},this.setSize=function(u,d){r=u,s=d,a=r/2,n=s/2,l.style.width=u+"px",l.style.height=d+"px"}}}const Ey=new C,qE=new Qe,Ay=new C;class tM extends Ve{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const Zr=new Me,YE=new Me;class ZE{constructor(e={}){const t=this;let r,s,a,n;const o={camera:{style:""},objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l;const c=document.createElement("div");c.style.transformOrigin="0 0",c.style.pointerEvents="none",l.appendChild(c);const h=document.createElement("div");function u(g){return Math.abs(g)<1e-10?0:g}function d(g){const m=g.elements;return"matrix3d("+u(m[0])+","+u(-m[1])+","+u(m[2])+","+u(m[3])+","+u(m[4])+","+u(-m[5])+","+u(m[6])+","+u(m[7])+","+u(m[8])+","+u(-m[9])+","+u(m[10])+","+u(m[11])+","+u(m[12])+","+u(-m[13])+","+u(m[14])+","+u(m[15])+")"}function p(g){const m=g.elements;return"translate(-50%,-50%)"+("matrix3d("+u(m[0])+","+u(m[1])+","+u(m[2])+","+u(m[3])+","+u(-m[4])+","+u(-m[5])+","+u(-m[6])+","+u(-m[7])+","+u(m[8])+","+u(m[9])+","+u(m[10])+","+u(m[11])+","+u(m[12])+","+u(m[13])+","+u(m[14])+","+u(m[15])+")")}function f(g,m,v,_){if(g.isCSS3DObject){const y=g.visible===!0&&g.layers.test(v.layers)===!0;if(g.element.style.display=y===!0?"":"none",y===!0){let x;g.onBeforeRender(t,m,v),g.isCSS3DSprite?(Zr.copy(v.matrixWorldInverse),Zr.transpose(),g.rotation2D!==0&&Zr.multiply(YE.makeRotationZ(g.rotation2D)),g.matrixWorld.decompose(Ey,qE,Ay),Zr.setPosition(Ey),Zr.scale(Ay),Zr.elements[3]=0,Zr.elements[7]=0,Zr.elements[11]=0,Zr.elements[15]=1,x=p(Zr)):x=p(g.matrixWorld);const b=g.element,M=o.objects.get(g);if(M===void 0||M.style!==x){b.style.transform=x;const T={style:x};o.objects.set(g,T)}b.parentNode!==h&&h.appendChild(b),g.onAfterRender(t,m,v)}}for(let y=0,x=g.children.length;y<x;y++)f(g.children[y],m,v)}h.style.transformStyle="preserve-3d",c.appendChild(h),this.getSize=function(){return{width:r,height:s}},this.render=function(g,m){const v=m.projectionMatrix.elements[5]*n;let _,y;m.view&&m.view.enabled?(c.style.transform=`translate( ${-m.view.offsetX*(r/m.view.width)}px, ${-m.view.offsetY*(s/m.view.height)}px )`,c.style.transform+=`scale( ${m.view.fullWidth/m.view.width}, ${m.view.fullHeight/m.view.height} )`):c.style.transform="",g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),m.parent===null&&m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),m.isOrthographicCamera&&(_=-(m.right+m.left)/2,y=(m.top+m.bottom)/2);const x=m.view&&m.view.enabled?m.view.height/m.view.fullHeight:1,b=m.isOrthographicCamera?`scale( ${x} )scale(`+v+")translate("+u(_)+"px,"+u(y)+"px)"+d(m.matrixWorldInverse):`scale( ${x} )translateZ(`+v+"px)"+d(m.matrixWorldInverse),M=(m.isPerspectiveCamera?"perspective("+v+"px) ":"")+b+"translate("+a+"px,"+n+"px)";o.camera.style!==M&&(h.style.transform=M,o.camera.style=M),f(g,g,m)},this.setSize=function(g,m){r=g,s=m,a=r/2,n=s/2,l.style.width=g+"px",l.style.height=m+"px",c.style.width=g+"px",c.style.height=m+"px",h.style.width=g+"px",h.style.height=m+"px"}}}function zL(i,e,t=.9){const r=i.distanceTo(e);return new C().subVectors(e,i).normalize().multiplyScalar(r*t).add(i)}function Cy(i){for(;i!=null&&i.parent&&i.parent.type!=="Scene";)i=i.parent;return i}function fl(i){if(i)return i.type==="Scene"?i:fl(i.parent)}function KE(i){const e=new Tt().setFromObject(i),{max:t,min:r}=e,s=new C;return e.getCenter(s),{box:e,max:t,min:r,center:s,radius:new C().subVectors(t,r).length()/2}}function O0(i,e=50){const{center:t,radius:r,max:s}=KE(i),a=i.getWorldDirection(new C),n=r/Math.tan(Math.PI*e/360),o=a.multiplyScalar(n),l=o.clone().add(t),c=o.clone().applyAxisAngle(new C(0,1,0),-Math.PI/2).add(t),h=o.clone().applyAxisAngle(new C(0,1,0),Math.PI/2).add(t),u=o.clone().applyAxisAngle(new C(1,0,0),-Math.PI/2).add(t),d=o.clone().applyAxisAngle(new C(1,0,0),Math.PI/2).add(t),p=o.clone().applyAxisAngle(new C(0,1,0),Math.PI).add(t),f=function(g,m,v){return new C().subVectors(m,g).normalize().multiplyScalar(v).add(g)}(t,s,t.distanceTo(s)/Math.tan(Math.PI*e/360));return{frontView:l,leftView:c,rightView:h,topView:u,bottomView:d,backView:p,maxView:f,target:t}}const QE=["立方体","球体","平面","胶囊","圆锥","圆面","圆柱","圆环","环面"];function N0(i,e={}){let t=null;switch(i){case"立方体":default:t=$E(e);break;case"球体":t=function(r={}){return new Wn(r.radius||5,r.widthSegments||32,r.heightSegments||32)}(e);break;case"平面":t=function(r={}){return new ys(r.width||5,r.height||5,r.widthSegments||32,r.heightSegments||32)}(e);break;case"胶囊":t=function(r={}){return new uh(r.radius||5,r.length||5,r.capSegments||32,r.radialSegments||32)}(e);break;case"圆锥":t=function(r={}){return new ph(r.radius||5,r.height||5,r.radialSegments||32)}(e);break;case"圆面":t=function(r={}){return new dh(r.radius||5,r.segments||32,r.thetaStart||0,r.thetaLength||2*Math.PI)}(e);break;case"圆柱":t=function(r={}){return new Ft(r.radiusTop||5,r.radiusBottom||5,r.height||5,r.radialSegments||32)}(e);break;case"圆环":t=function(r={}){return new ss(r.radius||10,r.tube||3,r.radialSegments||32,r.tubularSegments||32,r.arc||2*Math.PI)}(e);break;case"环面":t=function(r={}){return new mh(r.innerRadius||5,r.outerRadius||10,r.thetaSegments||32,r.phiSegments||32,r.thetaStart||0,r.thetaLength||2*Math.PI)}(e)}return t.geometryType=i,t}function $E(i={}){return new Lt(i.width||5,i.height||5,i.depth||5,i.widthSegments||1,i.heightSegments||1,i.depthSegments||1)}const qo=["基础材质","标准材质","镜面高光材质","Lambert材质","物理材质","卡通材质"];function Wr(i,e=null){let t=null;switch(i){case"基础材质":default:t=JE(e);break;case"标准材质":t=function(r){return new cl(Re({color:16777215,side:Rt},r))}(e);break;case"镜面高光材质":t=function(r){return new Xn(Re({color:16777215,side:Rt},r))}(e);break;case"Lambert材质":t=function(r){return new vp(Re({color:16777215,side:Rt},r))}(e);break;case"物理材质":t=function(r){return new dr(Re({color:16777215,side:Rt},r))}(e);break;case"卡通材质":t=function(r){return new h0(Re({color:16777215,side:Rt},r))}(e)}return t.materialType=i||"基础材质",t.transparent=!0,t}function JE(i){return new Qt(Re({color:16777215,side:Rt},i))}function eA(i){const e=document.createElement("video");return e.crossOrigin="anonymous",e.src=i,e.muted=!0,e.loop=!0,e.play(),new Rx(e)}function tA(i){const{mapType:e,mapUrl:t,map:r}=i;if(t&&r)return{mapType:e,mapUrl:t,map:{wrapS:r.wrapS,wrapT:r.wrapT,rotation:r.rotation,center:r.center,repeat:r.repeat,offset:r.offset,textureAnimation:r.textureAnimation}}}function iM(i,e,t){var r;if(!e.mapUrl)return e.map=null;e.mapType=="视频"?e.map=eA(e.mapUrl):e.map=new gs().load(e.mapUrl),t&&(e.map.wrapS=t.wrapS,e.map.wrapT=t.wrapT,e.map.repeat.set(t.repeat.x,t.repeat.y),e.map.offset.set(t.offset.x,t.offset.y),e.map.center.set(t.center.x,t.center.y),e.map.rotation=t.rotation,(r=t.textureAnimation)!=null&&r.isTextureAnimation&&(e.map.textureAnimation=t.textureAnimation,e.map.commonAnimateRender=function(){e.map.offset.x+=t.textureAnimation.offset.x,e.map.offset.y+=t.textureAnimation.offset.y,e.map.rotation+=t.textureAnimation.rotation},i.push(e.map))),e.map.center.set(.5,.5),e.isCustomTexture=!0,e.needsUpdate=!0}const U0={无混合:0,正常混合:1,叠加混合:Vs,减去混合:3,乘法混合:4,自定义混合:$o},iA={加法:ar,减法:101,反向减法:102,最小值:103,最大值:104},rA={零:Jo,一:ih,源颜色:jd,"1-源颜色":Wd,源透明度:Ra,"1-源透明度":Ia,目标透明度:rh,"1-目标透明度":Xd,目标颜色:sh,"1-目标颜色":qd,源透明饱和:210},sA={零:Jo,一:ih,源颜色:jd,"1-源颜色":Wd,源透明度:Ra,"1-源透明度":Ia,目标透明度:rh,"1-目标透明度":Xd,目标颜色:sh,"1-目标颜色":qd},aA={正面:Er,背面:Ri,双面:Rt};function nA(i){const{visible:e,color:t,wireframe:r,transparent:s,opacity:a,alphaTest:n,blending:o,side:l}=i;return Re({visible:e,color:t,wireframe:r,transparent:s,opacity:a,alphaTest:n,blending:o,side:l},tA(i))}function oA(i,e,t){t.add(e,"visible").name("显示"),t.addHexColor(e.color).name("颜色"),t.add(e,"wireframe").name("线框模式"),t.add(e,"side",aA).name("面类型").onFinishChange(r=>(e.side=Number(r),e.needsUpdate=!0)),t.add(e,"transparent").name("透明"),t.add(e,"opacity",0,1).name("透明度"),t.add(e,"alphaTest",0,1).name("剔除阈值"),t.add(e,"blending",U0).name("混合模式").onChange(r=>(e.blending=Number(r),e.needsUpdate=!0)),function(r,s,a){!Reflect.has(s,"mapUrl")&&(s.mapUrl=""),a.add(s,"mapUrl").name("贴图"),!Reflect.has(s,"mapType")&&(s.mapType="图片"),a.add(s,"mapType",["图片","视频"]).name("贴图类型"),a.add({updateMap:()=>iM(r,s)},"updateMap").name("更新贴图")}(i,e,t.addFolder("贴图"))}function lA(i){switch(i.type){case"MeshBasicMaterial":return{envMap:!!i.envMap,reflectivity:i.reflectivity};case"MeshStandardMaterial":return{emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,metalness:i.metalness,roughness:i.roughness,envMap:!!i.envMap,envMapIntensity:i.envMapIntensity};case"MeshLambertMaterial":return{emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,envMap:!!i.envMap,reflectivity:i.reflectivity};case"MeshPhongMaterial":return{shininess:i.shininess,specular:i.specular.getHex(),emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,envMap:!!i.envMap,reflectivity:i.reflectivity};case"MeshToonMaterial":return{emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity};case"MeshPhysicalMaterial":return{metalness:i.metalness,roughness:i.roughness,clearcoat:i.clearcoat,clearcoatRoughness:i.clearcoatRoughness,sheen:i.sheen,sheenRoughness:i.sheenRoughness,sheenColor:i.sheenColor.getHex(),specularColor:i.specularColor.getHex(),specularIntensity:i.specularIntensity,transmission:i.transmission,emissive:i.emissive.getHex(),emissiveIntensity:i.emissiveIntensity,envMap:!!i.envMap,envMapIntensity:i.envMapIntensity,reflectivity:i.reflectivity}}}function Mp(i){return Re(Re({materialType:i.materialType},nA(i)),lA(i))}function wp(i,e,t){t&&(function(r,s,a){const{visible:n,color:o,wireframe:l,side:c,transparent:h,opacity:u,alphaTest:d,blending:p,map:f,mapUrl:g,mapType:m}=a;s.visible=n,s.color.setHex(o),s.wireframe=l,s.transparent=h,s.opacity=u,s.alphaTest=d,s.blending=p,s.side=c??Rt,g&&(s.mapUrl=g,s.mapType=m,iM(r,s,f))}(i.commonFrames,e,t),function(r,s,a){switch(s.type){case"MeshBasicMaterial":a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.reflectivity=a.reflectivity;break;case"MeshStandardMaterial":s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.envMapIntensity=a.envMapIntensity,s.metalness=a.metalness,s.roughness=a.roughness;break;case"MeshLambertMaterial":s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.reflectivity=a.reflectivity;break;case"MeshPhongMaterial":s.shininess=a.shininess,s.specular.setHex(a.specular),s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.reflectivity=a.reflectivity;break;case"MeshToonMaterial":s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity;break;case"MeshPhysicalMaterial":s.metalness=a.metalness,s.roughness=a.roughness,s.clearcoat=a.clearcoat,s.clearcoatRoughness=a.clearcoatRoughness,s.sheen=a.sheen,s.sheenRoughness=a.sheenRoughness,s.sheenColor.setHex(a.sheenColor),s.specularColor.setHex(a.specularColor),s.specularIntensity=a.specularIntensity,s.transmission=a.transmission,s.emissive.setHex(a.emissive),s.emissiveIntensity=a.emissiveIntensity,a.envMap&&(s.envMap=r.envBackground,r.envMapChangeUseList.push(()=>s.envMap=r.envBackground)),s.envMapIntensity=a.envMapIntensity,s.reflectivity=a.reflectivity}}(i,e,t))}function Sp(i,e,t){oA(i.commonFrames,e,t),function(r,s,a){switch(s.type){case"MeshBasicMaterial":a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"reflectivity",0,1).name("反射率");break;case"MeshStandardMaterial":a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度"),a.add(s,"metalness",0,1).name("金属度"),a.add(s,"roughness",0,1).name("粗糙度"),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"envMapIntensity",0).name("环境贴图强度");break;case"MeshLambertMaterial":a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度"),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"reflectivity",0,1).name("反射率");break;case"MeshPhongMaterial":a.add(s,"shininess",0,100).name("高光亮度").onChange(n=>s.needsUpdate=!0),a.addHexColor(s.specular).name("高光颜色"),a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度"),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"reflectivity",0,1).name("反射率");break;case"MeshToonMaterial":a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度");break;case"MeshPhysicalMaterial":a.add(s,"metalness",0,1).name("金属度"),a.add(s,"roughness",0,1).name("粗糙度"),a.add(s,"clearcoat",0,1).name("清漆层"),a.add(s,"clearcoatRoughness",0,1).name("清漆层粗糙度"),a.add(s,"sheen",0,1).name("光泽度"),a.add(s,"sheenRoughness",0,1).name("光泽粗糙度"),a.addHexColor(s.sheenColor).name("光泽颜色"),a.addHexColor(s.specularColor).name("高光颜色"),a.add(s,"specularIntensity",0,1).name("高光强度"),a.add(s,"transmission",0,1).name("透射率"),a.addHexColor(s.emissive).name("自发光颜色"),a.add(s,"emissiveIntensity",0).name("自发光强度"),a.add({isEnvMap:!!s.envMap},"isEnvMap").name("环境贴图").onChange(n=>s.envMap=n?r.envBackground:null),a.add(s,"envMapIntensity",0).name("环境贴图强度"),a.add(s,"reflectivity",0,1).name("反射率")}}(i,e,t.addFolder(e.materialType+"配置"))}const rM={material:"vUv = uv;",position:"vUv = position.xy/ position.z;",modelMatrix:"vUv = (modelMatrix * vec4(position, 1.0)).xy;",modelViewMatrix:"vUv = (modelViewMatrix * vec4(position, 1.0)).xy;",projectionMatrix:"vUv = (projectionMatrix * vec4(position, 1.0)).xy;",viewMatrix:"vUv = (viewMatrix * vec4(position, 1.0)).xy;",custom_uv1:`
    
        vec4 projectedPosition = projectionMatrix * modelMatrix  * vec4(position, 1.0);

        vec3 ndcPosition = projectedPosition.xyz / projectedPosition.w;

        vUv = ndcPosition.xy / ndcPosition.z;
    `},cA=Object.keys(rM),sM=[{name:"彩虹光",commonUniforms:!0,vertex:"vUv-material",fragment:`
            vec3 c;
            float l,z=iTime;
            for(int i=0;i<3;i++) {
                vec2 uv,p=gl_FragCoord.xy/iResolution/2.0;
                uv=p;
                p-=.3;
                <UV_PLACEHOLDER>
                z+=.07;
                l=length(p);
                uv+=p/l*(sin(z)+1.)*abs(sin(l*9.-z-z));
                c[i]=.01/length(mod(uv,1.)-.5);
            }
        `,commonFinish:!0,key:"c",isParticle:!0,render:"iTime+speed"},{name:"水波纹",commonUniforms:!0,customUniforms:["TAU-number-float-6.28318530718","MAX_ITER-number-int-5"],vertex:"vUv-material",fragment:`
            float time = iTime * .5+23.0;
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            <UV_PLACEHOLDER>
            #ifdef SHOW_TILING
                vec2 p = mod(uv*TAU*2.0, TAU)-250.0;
            #else
                vec2 p = mod(uv*TAU, TAU)-250.0;
            #endif
            vec2 i = vec2(p);
            float c = 1.0;
            float inten = .005;
            for (int n = 0; n < MAX_ITER; n++) 
            {
                float t = time * (1.0 - (3.5 / float(n+1)));
                i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));
                c += 1.0/length(vec2(p.x / (sin(i.x+t)/inten),p.y / (cos(i.y+t)/inten)));
            }
            c /= float(MAX_ITER);
            c = 1.17-pow(c, 1.4);
            vec3 colour = vec3(pow(abs(c), 8.0));
            colour = clamp(colour + vec3(0.0, 0.35, 0.5), 0.0, 1.0);
            #ifdef SHOW_TILING
            // Flash tile borders...
            vec2 pixel = 2.0 / iResolution.xy;
            uv *= 2.0;
            float f = floor(mod(iTime*.5, 2.0)); 	// Flash value.
            vec2 first = step(pixel, uv) * f;		   	// Rule out first screen pixels and flash.
            uv  = step(fract(uv), pixel);				// Add one line of pixels per tile.
            colour = mix(colour, vec3(1.0, 1.0, 0.0), (uv.x + uv.y) * first.x * first.y); // Yellow line
            #endif
        `,commonFinish:!0,key:"colour",isParticle:!0,render:"iTime+speed"},{name:"光圈扫射",commonUniforms:!1,customUniforms:["innerCircleWidth-number-float-1","circleWidth-number-float-2","circleMax-number-float-2","opacityScale-number-float-1","reverseOpacity-bool-bool-true","circleSpeed-number-float-0.01","diff-color-vec3-0.0,0.0,1.0","color3-color-vec3-0.0,0.0,1.0","center-position-vec3-0,0,0","intensity-number-float-1","isDisCard-bool-bool-false"],vertex:"vUv-material,vPosition",fragment:`
            float dis = length(vPosition - center);
            vec4 diffuseColor;
            if(dis < (innerCircleWidth + circleWidth) && dis > innerCircleWidth) {
                float r = (dis - innerCircleWidth) / circleWidth;
                float cOpacity = reverseOpacity ? (innerCircleWidth / circleMax) : 1. - ( innerCircleWidth / circleMax );
                #ifdef USE_MAP
                    vec3 textureColor = texture2D(map, vUv).rgb;
                    if(isDisCard && textureColor.r < 0.1 && textureColor.g < 0.1  && textureColor.b < 0.1 ) discard;
                #endif
                diffuseColor = vec4( mix(diff, color3, r) * vec3(intensity, intensity, intensity)  , opacity * cOpacity * opacityScale);
            }
            else {
                if(isDisCard)  discard ;
                else diffuseColor = vec4( diffuse, opacity );
            }
        `,commonFinish:!1,render:"this.innerCircleWidth.value < this.circleMax.value ? this.innerCircleWidth.value += this.circleSpeed.value : this.innerCircleWidth.value = 0"},{name:"晶片着色",commonUniforms:!0,vertex:"vUv-material",key:"col",fragment:`
            float gTime = 0.;
            const float REPEAT = 5.0;
            mat2 rot(float a) {
                float c = cos(a), s = sin(a);
                return mat2(c,s,-s,c);
            }
            float sdBox( vec3 p, vec3 b )
            {
                vec3 q = abs(p) - b;
                return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
            }
            float box(vec3 pos, float scale) {
                pos *= scale;
                float base = sdBox(pos, vec3(.4,.4,.1)) /1.5;
                pos.xy *= 5.;
                pos.y -= 3.5;
                pos.xy *= rot(.75);
                float result = -base;
                return result;
            }
            float box_set(vec3 pos, float iTime) {
                vec3 pos_origin = pos;
                pos = pos_origin;
                pos .y += sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box1 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);
                pos = pos_origin;
                pos .y -=sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box2 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);
                pos = pos_origin;
                pos .x +=sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box3 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);	
                pos = pos_origin;
                pos .x -=sin(gTime * 0.4) * 2.5;
                pos.xy *=   rot(.8);
                float box4 = box(pos,2. - abs(sin(gTime * 0.4)) * 1.5);	
                pos = pos_origin;
                pos.xy *=   rot(.8);
                float box5 = box(pos,.5) * 6.;	
                pos = pos_origin;
                float box6 = box(pos,.5) * 6.;	
                float result = max(max(max(max(max(box1,box2),box3),box4),box5),box6);
                return result;
            }
            float mapf(vec3 pos, float iTime) {
                vec3 pos_origin = pos;
                float box_set1 = box_set(pos, iTime);

                return box_set1;
            }
            <SPLIT_PLACEHOLDER>
            vec2 p = gl_FragCoord.xy / iResolution.xy;
            p.x -=.5;
            p.y -=.5;
            p.x *= iResolution.x / iResolution.y;
            vec2 uv = p;
            <UV_PLACEHOLDER>
            p = uv;
            vec3 ro = vec3(0., -0.2 ,iTime * 4.);
            vec3 ray = normalize(vec3(p, 1.5));
            ray.xy = ray.xy * rot(sin(iTime * .03) * 5.);
            ray.yz = ray.yz * rot(sin(iTime * .05) * .2);
            float t = 0.1;
            vec3 col = vec3(0.);
            float ac = 0.0;
            for (int i = 0; i < 99; i++){
                vec3 pos = ro + ray * t;
                pos = mod(pos-2., 4.) -2.;
                gTime = iTime -float(i) * 0.01;
                
                float d = mapf(pos, iTime);

                d = max(abs(d), 0.01);
                ac += exp(-d*23.);

                t += d* 0.55;
            }
            col = vec3(ac * 0.02);
            col +=vec3(0.,0.2 * abs(sin(iTime)),0.5 + sin(iTime) * 0.2);  
        `,commonFinish:!0,isParticle:!0,render:"iTime+speed"},{name:"流光围栏",commonUniforms:!1,customUniforms:["iTime-number-float-0.0","speed-number-float-0.05","intensity-number-float-2","density-number-float-5","mixColor-color-vec3-1.0,1.0,1.0","high-number-float-0.5","medium-number-float-0.4"],vertex:"vUv-material",fragment:`
            vec4 fragColor = vec4(0.);
            float sin = sin((vUv.y - iTime * speed) * 10. * density);
            if (sin > high) {
            fragColor = vec4( mixColor, (1. - sin) / (1. - high));
            } else if(sin > medium) {
            fragColor = vec4(mixColor, mix(1., 0., 1.-(sin - medium) / (high - medium)));
            } else {
            fragColor = vec4(mixColor, 0.);
            }
            fragColor = mix(fragColor, vec4(mix(mixColor, vec3(0., 0., 0.), vUv.y), 1.), 0.);
            vec4 diffuseColor = vec4(fragColor.rgb * vec3(intensity, intensity, intensity), fragColor.a * opacity * (1. - vUv.y));
        `,commonFinish:!1,render:"iTime+speed"},{name:"雪片着色",commonUniforms:!0,customUniforms:!1,vertex:"precision-lowp,vUv-material",fragment:`
            mat2 rot(float a) {
                float c = cos(a), s = sin(a);
                return mat2(c,s,-s,c);
            }
            const float pi = acos(-1.0);
            const float pi2 = pi*2.0;
            vec2 pmod(vec2 p, float r) {
                float a = atan(p.x, p.y) + pi/r;
                float n = pi2 / r;
                a = floor(a/n)*n;
                return p*rot(-a);
            }
            float box( vec3 p, vec3 b ) {
                vec3 d = abs(p) - b;
                return min(max(d.x,max(d.y,d.z)),0.0) + length(max(d,0.0));
            }
            float ifsBox(vec3 p) {
                for (int i=0; i<5; i++) {
                    p = abs(p) - 1.0;
                    p.xy *= rot(iTime*0.3);
                    p.xz *= rot(iTime*0.1);
                }
                p.xz *= rot(iTime);
                return box(p, vec3(0.4,0.8,0.3));
            }
            float mapSnow(vec3 p, vec3 cPos) {
                vec3 p1 = p;
                p1.x = mod(p1.x-5., 10.) - 5.;
                p1.y = mod(p1.y-5., 10.) - 5.;
                p1.z = mod(p1.z, 16.)-8.;
                p1.xy = pmod(p1.xy, 5.0);
                return ifsBox(p1);
            }  
            <SPLIT_PLACEHOLDER>
            vec2 p = (gl_FragCoord.xy * 2.0  - iResolution.xy) / min(iResolution.x, iResolution.y);
            vec2 uv = p;
            <UV_PLACEHOLDER>
            p = uv;
            vec3 cPos = vec3(0.0,0.0, -3.0 * iTime);
            vec3 cDir = normalize(vec3(0.0, 0.0, -1.0));
            vec3 cUp  = vec3(sin(iTime), 1.0, 0.0);
            vec3 cSide = cross(cDir, cUp);
            vec3 ray = normalize(cSide * p.x + cUp * p.y + cDir);
            float acc = 0.0;
            float acc2 = 0.0;
            float t = 0.0;
            for (int i = 0; i < 99; i++) {
                vec3 pos = cPos + ray * t;
                float dist = mapSnow(pos, cPos);
                dist = max(abs(dist), 0.02);
                float a = exp(-dist*3.0);
                if (mod(length(pos)+24.0*iTime, 30.0) < 3.0) {
                    a *= 2.0;
                    acc2 += a;
                }
                acc += a;
                t += dist * 0.5;
            }
            vec3 col = vec3(acc * 0.01, acc * 0.011 + acc2*0.002, acc * 0.012+ acc2*0.005);
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"},{name:"光线叠加",commonUniforms:!0,customUniforms:!1,vertex:"vUv-material",fragment:`
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            vec3 wave_color = vec3(0.0);
            float wave_width = 0.0;
            uv  = -3.0 + 2.0 * uv;
            uv.y += 0.0;
            <UV_PLACEHOLDER>
            for(float i = 0.0; i <= 28.0; i++) {
                uv.y += (0.2+(0.9*sin(iTime*0.4) * sin(uv.x + i/3.0 + 3.0 *iTime )));
                uv.x += 1.7* sin(iTime*0.4);
                wave_width = abs(1.0 / (200.0*abs(cos(iTime)) * uv.y));
                wave_color += vec3(wave_width *( 0.4+((i+1.0)/18.0)), wave_width * (i / 9.0), wave_width * ((i+1.0)/ 8.0) * 1.9);
        }`,commonFinish:!0,key:"wave_color",isParticle:!0,render:"iTime+speed"},{name:"绚烂线条",commonUniforms:!0,customUniforms:!1,vertex:"vUv-material",fragment:`
            vec3 hsv2rgb( vec3 c ){
                vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),
                                        6.0)-3.0)-1.0,
                                0.0,
                                1.0 );
                rgb = rgb*rgb*(3.0-2.0*rgb);
                return c.z * mix(vec3(1.0), rgb, c.y);
            }
            float rands(vec2 v){
                v = fract(v * vec2(70.26593, 1.6682));
                v += dot(v, v+23.45);
                return fract(v.x*v.y);
            }
            vec2 rand_2(vec2 v){
                float n = rands(v);
                return vec2(n, rands(v + n));
            }
            float dist_line(vec2 which, vec2 p1, vec2 p2){
                float r = clamp(dot(which - p1, p2 - p1) / dot(p2 - p1, p2 - p1), .0, 1.);
                return length((which - p1)-(p2 - p1)*r);
            }
            float drawline(vec2 which, vec2 p1, vec2 p2, float w){
                float dis = dist_line(which, p1, p2);
                return smoothstep(.015*w, .005*w, dis)*smoothstep(.8, .0, distance(p1, p2)-.25);
            }
            vec2 Getpos(vec2 v){
                vec2 p = rand_2(v);
                return vec2(.5)+.4*vec2(cos(p.x*(iTime+5.)), sin(p.y*(iTime+5.)));
            }
            vec3 layer(vec2 uv, float w){
                float m=.0;
                vec2 fl_uv = floor(uv);
                vec2 fr_uv = fract(uv);
                vec2 id = Getpos(fl_uv);
                m = smoothstep(.08*w, .01*w, distance(fr_uv, id))*abs(sin((iTime+id.x)*4.));
                vec2 p[9];
                int num = 0;
                for(float i=-1.; i<=1.; i++){
                    for(float j=-1.; j<=1.; j++){
                        p[num++] = vec2(i,j)+Getpos(fl_uv + vec2(i,j));
                    }
                }
                for(int i=0; i<9; i++){
                m += drawline(fr_uv, p[4], p[i], w);
                }
                m += drawline(fr_uv, p[1], p[3], w);
                m += drawline(fr_uv, p[1], p[5], w);
                m += drawline(fr_uv, p[3], p[7], w);
                m += drawline(fr_uv, p[5], p[7], w);
                return vec3(m);
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            <UV_PLACEHOLDER>
            float yy = uv.y;
            uv -= .5;
            uv.x *= iResolution.x / iResolution.y;
            uv *= .5;
            float t = iTime*.1;
            float rs = sin(2.*t);
            float rc = cos(2.*t);
            uv *= mat2(rc, -rs, rs, rc);
            float m = .0;
            vec3 v3 = vec3(1.);
            vec2 fl_uv = floor(uv);
            vec2 fr_uv = fract(uv);
            
            vec2 id = Getpos(fl_uv);
            vec3 col = vec3(.0);
            
            for(float i=.0; i<1.; i+=1./8.){
                float z = fract(i+t);
                float size = mix(10., .5, z);
                float al = smoothstep(.0, .8, z) * smoothstep(1., .8, z);
                v3 = 0.5 + 0.5*cos(-1.2*z+iTime+uv.xyx+vec3(0,2,4));
            col += layer(uv*size + i*27.385, 1.)*al*v3;
            col += layer(uv*size + i*27.385, .4)*pow(al, 2.);
            }
            //col *= smoothstep(1., .7, yy)*smoothstep(.0, .3, yy);
            v3 = 0.5 + 0.5*cos(iTime-1.2+uv.xyx+vec3(0,2,4));
            col += vec3(.8*yy)*.3*v3;
            col += vec3(.2*(1.-yy))*.3*v3;
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"}],aM=[{name:"流光闪电",commonUniforms:!0,vertex:"vUv-material",fragment:`
            float hash11(float p)
            {
                p = fract(p * .1031);
                p *= p + 33.33;
                p *= p + p;
                return fract(p);
            }
            float hash12(vec2 p)
            {
                vec3 p3 = fract(vec3(p.xyx) * .1031);
                p3 += dot(p3, p3.yzx + 33.33);
                return fract((p3.x + p3.y) * p3.z);
            }
            mat2 rotate2d(float theta)
            {
                float c = cos(theta);
                float s = sin(theta);
                return mat2(
                    c, -s,
                    s, c
                );
            }
            float noise(vec2 p)
            {
                vec2 ip = floor(p);
                vec2 fp = fract(p);
                float a = hash12(ip);
                float b = hash12(ip + vec2(1, 0));
                float c = hash12(ip + vec2(0, 1));
                float d = hash12(ip + vec2(1, 1));
                
                vec2 t = smoothstep(0.0, 1.0, fp);
                return mix(mix(a, b, t.x), mix(c, d, t.x), t.y);
            }
            float fbm(vec2 p)
            {
                float value = 0.0;
                float amplitude = 0.5;
                for (int i = 0; i < 8; ++i)
                {
                    value += amplitude * noise(p);
                    p *= rotate2d(0.45);
                    p *= 2.0;
                    amplitude *= 0.5;
                }
                return value;
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy; 
            <UV_PLACEHOLDER>
            uv = 2.0 * uv - 1.0;
            uv.x *= iResolution.x / iResolution.y;
            uv += 2.0 * fbm(uv+0.8*iTime) - 1.0;
            float dist = abs(uv.x);
            vec3 col = vec3(0.2, 0.3, 0.8) * pow(mix(0.0, 0.07, hash11(iTime)) / dist, 1.0);
            col = pow(col, vec3(1.0));  
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"},{name:"火焰燃烧",commonUniforms:!0,customUniforms:["isDiscard-bool-bool-false"],vertex:"vUv-material",fragment:`
            const vec3 c = vec3(1, 0, -1);
            const mat2 m = .4 * mat2(4, 3, -3, 4);
            float hash12(vec2 p)
            {
                vec3 p3  = fract(vec3(p.xyx) * .1031);
                p3 += dot(p3, p3.yzx + 33.33);
                return fract(dot(p3.xy, p3.zz));
            }
            float lfnoise(vec2 t)
            {
                vec2 i = floor(t);
                t = c.xx * smoothstep(0., 1., fract(t));
                vec2 v1 = 2. * mix(vec2(hash12(i), hash12(i + c.xy)), vec2(hash12(i + c.yx), hash12(i + c.xx)), t.y) - 1.;
                return mix(v1.x, v1.y, t.x);
            }
            float fbm(vec2 uv)
            {
                vec2 uv0 = uv;
                uv = uv * vec2(5., 2.) - vec2(-2., -.25) - 3.1 * iTime * c.yx;
                float f = 1.,
                    a = .5,
                    c = 2.5;
                
                for(int i = 0; i < 5; ++i) {
                    uv.x -= .15 * clamp(1. - pow(uv0.y, 4.), 0., 1.) * lfnoise(c * (uv + float(i) * .612 + iTime));
                    c *= 2.;
                    f += a * lfnoise(uv + float(i) * .415);
                    a /= 2.;
                    uv *= m;
                }
                return f / 2.;
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy; 
            <UV_PLACEHOLDER>
            vec3 col = clamp(1.5 * pow(clamp(pow(fbm(uv), 1. + 4. * clamp(uv.y * uv.y, 0., 1.)) * 1.5, 0., 1.) * c.xxx, vec3(1, 3, 6)), 0., 1.);
            if(isDiscard && col.r < 0.1 && col.g < 0.1  && col.b < 0.1 ) discard;
        `,commonFinish:!0,key:"col",isParticle:!0,render:"iTime+speed"},{name:"流光栅格",commonUniforms:!0,vertex:"vUv-material",fragment:`
            vec3 palette( float t ) {
                vec3 a = vec3(0.5, 0.5, 0.5);
                vec3 b = vec3(0.5, 0.5, 0.5);
                vec3 c = vec3(1.0, 1.0, 1.0);
                vec3 d = vec3(0.263,0.416,0.557);
                return a + b*cos( 6.28318*(c*t+d) );
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = (gl_FragCoord.xy * 2.0 - iResolution.xy) / iResolution.y;
            <UV_PLACEHOLDER>
            vec2 vv0 = uv;
            vec3 finalColor = vec3(0.0);
            for (float i = 0.0; i < 4.0; i++) {
                uv = fract(uv * 1.5) - 0.5;
                float d = length(uv) * exp(-length(vv0));
                vec3 col = palette(length(vv0) + i*.4 + iTime*.4);
                d = sin(d*8. + iTime)/8.;
                d = abs(d);
                d = pow(0.01 / d, 1.2);
                finalColor += col * d;
            }
        `,commonFinish:!0,key:"finalColor",isParticle:!0,render:"iTime+speed"},{name:"水面着色",commonUniforms:!0,customUniforms:["EPSILON-number-float-0.001","SEA_BASE-color-vec3-0.11,0.19,0.22","SEA_WATER_COLOR-color-vec3-0.55,0.9,0.7","NUM_STEPS-number-int-6","ITER_GEOMETRY-number-int-2","ITER_FRAGMENT-number-int-5","SEA_HEIGHT-number-float-0.5","SEA_CHOPPY-number-float-3.0","SEA_SPEED-number-float-1.9","SEA_FREQ-number-float-0.24"],vertex:"vUv-material",fragment:`
            #define  EPSILON_NRM (1. / iResolution.x)
            #define SEA_TIME (iTime * SEA_SPEED)
            mat2 octave_m = mat2(1.7,1.2,-1.2,1.4);
            const float KEY_SP    = 32.5/256.0;
            vec3 rgb2hsv(vec3 c)
            {
                vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
                vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
                vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
                float d = q.x - min(q.w, q.y);
                float e = 1.0e-10;
                return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
            }
            vec3 hsv2rgb(vec3 c)
            {
                vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
                vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
                return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
            }
            mat3 fromEuler(vec3 ang) {
                vec2 a1 = vec2(sin(ang.x),cos(ang.x));
                vec2 a2 = vec2(sin(ang.y),cos(ang.y));
                vec2 a3 = vec2(sin(ang.z),cos(ang.z));
                mat3 m;
                m[0] = vec3(a1.y*a3.y+a1.x*a2.x*a3.x,a1.y*a2.x*a3.x+a3.y*a1.x,-a2.y*a3.x);
                m[1] = vec3(-a2.y*a1.x,a1.y*a2.y,a2.x);
                m[2] = vec3(a3.y*a1.x*a2.x+a1.y*a3.x,a1.x*a3.x-a1.y*a3.y*a2.x,a2.y*a3.y);
                return m;
            }
            float hash( vec2 p ) {
                float h = dot(p,vec2(127.1,311.7));	
                return fract(sin(h)*83758.5453123);
            }
            
            float noise( in vec2 p ) {
                vec2 i = floor( p );
                vec2 f = fract( p );	
                vec2 u = f*f*(3.0-2.0*f);
                return -1.0+2.0*mix( 
                            mix( hash( i + vec2(0.0,0.0) ), 
                                hash( i + vec2(1.0,0.0) ), 
                                    u.x),
                            mix( hash( i + vec2(0.0,1.0) ), 
                                hash( i + vec2(1.0,1.0) ), 
                                    u.x), 
                            u.y);
            }
            float diffuseL(vec3 n,vec3 l,float p) {
                return pow(dot(n,l) * 0.4 + 0.6,p);
            }
            float specularS(vec3 n,vec3 l,vec3 e,float s) {    
                float nrm = (s + 8.0) / (3.1415 * 8.0);
                return pow(max(dot(reflect(e,n),l),0.0),s) * nrm;
            }
            
            float sea_octave(vec2 uv, float choppy) {
                uv += noise(uv);
                vec2 wv = 1.0-abs(sin(uv)); 
                vec2 swv = abs(cos(uv));  
                wv = mix(wv,swv,wv);
                return pow(1.0-pow(wv.x * wv.y,0.65),choppy);
            }
            float mapL(vec3 p) {
                float freq = SEA_FREQ;
                float amp = SEA_HEIGHT;
                float choppy = SEA_CHOPPY;
                vec2 uv = p.xz; uv.x *= 0.75;
                float d, h = 0.0;    
                for(int i = 0; i < ITER_GEOMETRY; i++) {
                    d = sea_octave((uv+iTime)*freq,choppy);
                    h += d * amp; 
                    uv *=  octave_m;   
                    freq *= 1.9; 
                    amp *= 0.22;
                    choppy = mix(choppy,1.0,0.2);
                }
                return p.y - h;
            }
            float map_detailed(vec3 p) {
                float freq = SEA_FREQ;
                float amp = SEA_HEIGHT;
                float choppy = SEA_CHOPPY;
                vec2 uv = p.xz; uv.x *= 0.75;
                float d, h = 0.0;    
                for(int i = 0; i < ITER_FRAGMENT; i++) {
                    d = sea_octave((uv+iTime)*freq,choppy);
                    d += sea_octave((uv-iTime)*freq,choppy);
                    h += d * amp; 
                    uv *= octave_m/1.2;
                    freq *= 1.9;
                    amp *= 0.22;
                    choppy = mix(choppy,1.0,0.2);
                }
                return p.y - h;
            }
            vec3 getSeaColor(vec3 p, vec3 n, vec3 l, vec3 eye, vec3 dist) {  
                float fresnel = 1.0 - max(dot(n,-eye),0.0);
                fresnel = pow(fresnel,3.0) * 0.45;
                vec3 refracted = SEA_BASE + diffuseL(n,l,80.0) * SEA_WATER_COLOR * 0.27; 
                vec3 color = refracted;
                float atten = max(1.0 - dot(dist,dist) * 0.001, 0.0);
                color += SEA_WATER_COLOR * (p.y - SEA_HEIGHT) * 0.15 * atten;
                color += vec3(specularS(n,l,eye,90.0))*0.5;
                return color;
            }
            vec3 getNormal(vec3 p, float eps) {
                vec3 n;
                n.y = map_detailed(p);
                n.x = map_detailed(vec3(p.x+eps,p.y,p.z)) - n.y; 
                n.z = map_detailed(vec3(p.x,p.y,p.z+eps)) - n.y;
                n.y = eps; 
                return normalize(n);
            }
            float heightMapTracing(vec3 ori, vec3 dir, out vec3 p) {  
                float tm = 0.0;
                float tx = 500.0; 
                float hx = mapL(ori + dir * tx);
                if(hx > 0.0) return tx;   
                float hm = mapL(ori + dir * tm); 
                float tmid = 0.0;
                for(int i = 0; i < NUM_STEPS; i++) { 
                    tmid = mix(tm,tx, hm/(hm-hx));
                    p = ori + dir * tmid; 
                            
                    float hmid = mapL(p); 
                    if(hmid < 0.0) { 
                        tx = tmid;
                        hx = hmid;
                    } else {
                        tm = tmid;
                        hm = hmid;
                    }
                }
                return tmid;
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = gl_FragCoord.xy / iResolution.xy;
            uv.y -= 2.0;
            <UV_PLACEHOLDER>
            float time = iTime * 0.0;
            float roll = PI + sin(iTime)/14.0 + cos(iTime/2.0)/14.0 ;
            float pitch = PI*1.021 + (sin(iTime/2.0)+ cos(iTime))/40.0 
                + (1./iResolution.y - .8)*PI/3.0  ;
            float yaw = 1./iResolution.x * PI * 4.0;
            vec3 ang = vec3(roll,pitch,yaw);
            vec3 ori = vec3(0.0,3.5,time*3.0);
            vec3 dir = normalize(vec3(uv.xy,-1.6)); 
            dir = normalize(dir) * fromEuler(ang);
            vec3 p;
            heightMapTracing(ori,dir,p);
            vec3 dist = p - ori;
            vec3 n = getNormal(p,  dot(dist,dist)  * EPSILON_NRM  );
            vec3 light = normalize(vec3(0.0,1.0,0.8)); 
            vec3 seaColor = getSeaColor(p,n,light,dir,dist);
        `,commonFinish:!0,key:"seaColor",render:"iTime+speed"},{name:"着色天空",customUniforms:["topColor-color-vec3-0x0077ff","bottomColor-color-vec3-aliceblue","offset-number-float-400","exponent-number-float-0.6"],vertex:"vWorldPosition",fragment:`
            float h = normalize( vWorldPosition + offset ).y;
            vec4 diffuseColor = vec4( mix( bottomColor, topColor, max( pow( max( h, 0.0 ), exponent ), 0.0 ) ), 1.0 );
        `,render:""},{name:"热力图",commonUniforms:!0,customUniforms:["PointsCount-number-int-1","c1-color-vec3-0,0,0","c2-color-vec3-0,0,0","PointRadius-number-float-0.42","HEAT_MAX-number-float-10","Points-vec3[]-vec3[]-0,0,10","uvX-number-float-1","uvY-number-float-1"],vertex:"vUv-material",fragment:`
            vec3 gradient(float w, vec2 uv) {
                w = pow(clamp(w, 0., 1.) * 3.14159 * .5, .9);
                return vec3(sin(w), sin(w * 2.), cos(w))* 1.1 + mix(c1, c2, w) * 1.1; 
            }
            <SPLIT_PLACEHOLDER>
            vec2 uv = (2. * gl_FragCoord.xy - iResolution.xy) / min(iResolution.x, iResolution.y);
            <UV_PLACEHOLDER>
            uv.xy *= vec2(uvX, uvY);
            float d = 0.;
            for (int i = 0; i < PointsCount; i++) {
                vec3 v = Points[i];
                float intensity = v.z / HEAT_MAX;
                float pd = (1. - length(uv - v.xy) / PointRadius) * intensity;
                d += pow(max(0., pd), 2.);
            }
            vec3 c = gradient(d, uv);
        `,commonFinish:!0,key:"c",render:"iTime+speed"},{name:"光晕泛光",commonUniforms:!0,vertex:"vUv-material",fragment:`
            vec2 uv = iResolution;
            <UV_PLACEHOLDER>
            float scale = (uv.x + uv.y)/2.;
            vec4 fragColor = vec4(0.0,0.0,0.0,1.0);
            int bubs = 4;
            for( int i=0; i<bubs; i++ )
            {
                vec2 bubbleCenter = uv.xy/2.0;
                bubbleCenter.y = uv.y/2.*(sin(float(i)*3.7+iTime/19.*float(i+1))+1.);
                float radius = scale/(1.+float(bubs)/7.);
                bubbleCenter.x = uv.x/2.*(sin(float(i)*7.3+iTime/17.*float(i+1))+1.);
                float dis = length( gl_FragCoord.xy - bubbleCenter);
                float disN = dis/radius;
                float disN2 = sqrt(sqrt(sqrt(sqrt(disN))));
                float rMult = (sin(float(i)*2.17)+1.)/2.;
                float gMult = .5;//float(i)/(float(bubs)+7.)+.2;
                float bMult = 1.-rMult;
                rMult = (rMult + .5)/2.;
                rMult = (rMult + .5)/2.;
                bMult = (bMult + .5)/2.;
                bMult = (bMult + .5)/2.;
                if (dis < radius) {
                    fragColor.x += (1.-disN2)*rMult;
                    fragColor.y += (1.-disN2)*gMult;
                    fragColor.z += (1.-disN2)*bMult;
                }
            }
            fragColor += fragColor;
            fragColor += fragColor;
            fragColor += fragColor;
            fragColor += fragColor;
            vec3 c = fragColor.rgb;
        `,key:"c",commonFinish:!0,render:"iTime+speed"}],hA=sM.concat(aM),nM=sM.concat(aM).filter(i=>i.isParticle).reduce((i,e)=>(i[e.name]=e,i),{});function Py(i="vUv-material"){let e=`void main() { 
`;return i.split(",").reverse().forEach(t=>{if(t.includes("vUv")){const[r,s]=t.split("-");e=`varying vec2 vUv; 
 ${e}`+rM[s]+`
`}else if(t.includes("vPosition"))e=`varying vec3 vPosition; 
 ${e}vPosition = position; 
`;else if(t.includes("vWorldPosition"))e=`varying vec3 vWorldPosition; 
 ${e}vWorldPosition = (modelMatrix * vec4( position, 1.0 )).xyz;`;else if(t.includes("precision")){const[r,s]=t.split("-");e=`precision ${s} float; 
`+e}}),e}const uA=["iResolution-dom-vec2-0,0","iTime-number-float-1.0","speed-number-float-0.01","intensity-number-float-1","mixRatio-number-float-0.95","mixColor-color-vec3-0xffffff","hasUv-bool-bool-true"];function dA(i,e,t){return e==="dom"?new se(i.clientWidth,i.clientHeight):e==="position"?new C(...t.split(",").map(r=>Number(r))):e==="color"?t.startsWith("0x")?new ve(Number(t)):t.includes(",")?new ve(...t.split(",").map(r=>Number(r))):new ve(t):e==="bool"?t==="true":e==="vec3[]"?t.split(",").map((r,s,a)=>s%3==0&&new C(Number(r),Number(a[s+1]),Number(a[s+2]))).filter(r=>r):e==="texture"?t?new gs().load(t):null:Number(t)}function Td(i,e){const t={};return e.forEach(r=>{const s=r.split("-"),[a,n,o]=s,l=s.length>4?s.slice(3).join("-"):s[3];t[a]={type:n,unit:o,value:dA(i,n,l)}}),t}function Ry(i,e){let t=Object.keys(i).map(r=>i[r].unit.includes("[]")?"uniform "+i[r].unit.replace("[]","")+` ${r}[${i[r].value.length}];`:"uniform "+i[r].unit+" "+r+";").join(`
`);return e&&(e.includes("vUv")&&(t+=`varying vec2 vUv; 
`),e.includes("vPosition")&&(t+=`varying vec3 vPosition; 
`),e.includes("vWorldPosition")&&(t+=`varying vec3 vWorldPosition; 
`)),t}class pA{constructor(e,t){const{name:r,commonUniforms:s,customUniforms:a,vertex:n,key:o,fragment:l,commonFinish:c,render:h}=t;if(Object.assign(this,{uniforms:{},vertexHeader:Py(n),fragmentHeader:"",fragmentFunc:"",fragmentBody:"",fragmentEnd:"",vertex:n,render:h,shaderProgramsCodeName:r}),s&&Object.assign(this.uniforms,Td(e,uA)),a&&Object.assign(this.uniforms,Td(e,a)),this.fragmentHeader=Ry(this.uniforms,n),l.search("<SPLIT_PLACEHOLDER>")!==-1){const[u,d]=l.split("<SPLIT_PLACEHOLDER>");this.fragmentFunc=u,this.fragmentBody=d.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;")}else this.fragmentBody=l.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;");c&&(this.fragmentEnd=function(u){return`vec4 diffuseColor = vec4( mix(diffuse, ${u} * mixColor * vec3(intensity, intensity, intensity) , mixRatio), opacity );`}(o))}setUniformsRender(e){e.uniforms=ii.clone(this.uniforms),this.render==="iTime+speed"?e.shaderAnimateRender=()=>e.uniforms.iTime.value+=e.uniforms.speed.value:e.shaderAnimateRender=new Function(this.render).bind(e.uniforms)}setVertexFormUV(e){this.vertex=this.vertex.replace(/vUv-\w+/,`vUv-${e}`),this.vertexHeader=Py(this.vertex)}updateFragmentHead(e){this.fragmentHeader=Ry(e,this.vertex)}}function Tp(i){let e=[];return i.traverse(t=>{t.isMesh&&(Array.isArray(t.material)?t.material.forEach(r=>e.push(r)):e.push(t.material))}),[...new Set(e)]}function gc(i,e){let t;return t=i.RootMaterials?i.RootMaterials:i.material?Array.isArray(i.material)?i.material:[i.material]:Tp(i),t.forEach(r=>Iy(r,i.uniforms,e)),i.updateShaderProgram=()=>{e.updateFragmentHead(i.uniforms),t.forEach(r=>Iy(r,i.uniforms,e))},i.destroyShaderProgram=()=>{t.forEach(r=>{r.onBeforeCompile=()=>{},r.dispose()}),delete i.shaderAnimateRender,delete i.destroyShaderProgram},!0}function Iy(i,e,t){const{vertexHeader:r,fragmentHeader:s,fragmentFunc:a,fragmentBody:n,fragmentEnd:o}=t;i.dispose(),i.onBeforeCompile=l=>{Object.keys(e).forEach(c=>l.uniforms[c]=e[c]),l.vertexShader=l.vertexShader.replace("void main() {",r),l.fragmentShader=l.fragmentShader.replace(/#include <common>/,s+`
#include <common>
`+a),l.fragmentShader=l.fragmentShader.replace("vec4 diffuseColor = vec4( diffuse, opacity );",n+o)}}function oM(i){if(i)return Object.keys(i).filter(e=>["color","position","opacity","number","bool"].includes(i[e].type)).reduce((e,t)=>mi(Re({},e),{[t]:i[t].value}),{})}function lM(i,e){e&&Object.keys(e).forEach(t=>{if(i[t])switch(i[t].type){case"color":i[t].value.set(e[t]);break;case"number":case"opacity":case"bool":i[t].value=e[t];break;case"position":i[t].value.set(e[t].x,e[t].y,e[t].z)}})}function rd(i,e){return Object.keys(i).forEach(t=>{switch(i[t].type){case"number":const r=e.add(i[t],"value").name(t);Reflect.has(i[t],"min")&&r.min(i[t].min),Reflect.has(i[t],"max")&&r.max(i[t].max);break;case"color":e.addHexColor(i[t].value).name(t);break;case"opacity":e.add(i[t],"value").min(0).max(1).name(t);break;case"position":["x","y","z"].forEach(s=>e.add(i[t].value,s).name(t+"-"+s));break;case"bool":e.add(i[t],"value").name(t)}}),e}function k0(i,e={}){i.blendShaderPrograms={shaderProgramsCodeName:e.shaderProgramsCodeName||"",isBlendShaderPrograms:e.isBlendShaderPrograms||!1,uvType:e.uvType||"material"}}function mA(i,e){const t=function(s){return new Proxy(hA.reduce((a,n)=>(a[n.name]=n,a),{}),{get:(a,n)=>(a[n].uniforms||(a[n]=new pA(s,a[n])),a[n])})}(e);i.DOM=e,i.shaderLibrary=t;const{shaderFrames:r}=i;return{shaderLibrary:t,setObjectBlendShader:function(s,a="水波纹",n="material"){i.add(s),k0(s,{shaderProgramsCodeName:a,uvType:n,isBlendShaderPrograms:!0});const o=t[a];return o.setUniformsRender(s),o.setVertexFormUV(n),gc(s,o),r.includes(s)||r.push(s),s}}}function fA(i){const{blendShaderPrograms:e}=i;if(e)return mi(Re({},e),{uniforms:oM(i.uniforms)})}function cM(i,e){e.open();const{shaderFrames:t,shaderLibrary:r}=fl(i);let s=null;i.blendShaderPrograms||k0(i);const{blendShaderPrograms:a}=i;a.isBlendShaderPrograms&&(s=rd(i.uniforms,e.addFolder(i.blendShaderPrograms.shaderProgramsCodeName+"配置"))),e.add(a,"uvType",cA).name("UV类型").onChange(()=>{if(!a.shaderProgramsCodeName||!a.isBlendShaderPrograms)return;const n=r[a.shaderProgramsCodeName];n.setVertexFormUV(a.uvType),gc(i,n)}),e.add(a,"shaderProgramsCodeName",Object.keys(r)).name("着色标码").onChange(()=>{if(a.isBlendShaderPrograms){const n=r[a.shaderProgramsCodeName];n.setUniformsRender(i),n.setVertexFormUV(a.uvType),gc(i,n),s&&(e.removeFolder(s),s=rd(i.uniforms,e.addFolder(a.shaderProgramsCodeName+"配置")))}}),e.add(a,"isBlendShaderPrograms").name("混合着色器").onChange(n=>{if(n){if(a.shaderProgramsCodeName){const o=r[a.shaderProgramsCodeName];o.setUniformsRender(i),o.setVertexFormUV(a.uvType),gc(i,o)&&t.push(i),s=rd(i.uniforms,e.addFolder(a.shaderProgramsCodeName+"配置"))}}else{const o=t.findIndex(l=>l.uuid==i.uuid);o!==-1&&(t.splice(o,1),i.destroyShaderProgram(),s&&(e.removeFolder(s),s=null))}})}function hM(i){return{mask:i.mask}}function uM(i,e){e&&(i.mask=e.mask)}function dM(i,e){var t;i.maskString=(t=i.mask,Array.from({length:32}).map((r,s)=>{if(t&1<<s)return s}).filter(r=>r!==void 0)).join(","),e.add(i,"maskString").name("图层").onChange(r=>{i.disableAll(),[...new Set(r.split(","))].map(s=>parseInt(s)).filter(s=>s>=0&&s<32).forEach(s=>i.enable(s))})}const Ly=()=>Math.random()>.5,pM={D:Date,P:"prototype",A:Array,V:["map","forEach","includes","indexOf"],F:[()=>[],()=>{},()=>Ly(),()=>Ly()?0:-1]},mM={a:[2,0],b:2,c:4,d:["/","0"],e:[2,3],E:!0,C:"g",A:"z",L:"",T:function(){return[...this.a,this.b,this.c].concat([...this.d,"6","/",...this.e]).join("")}};function $n(i){const{name:e,visible:t,castShadow:r,receiveShadow:s,position:a,rotation:n,scale:o,renderOrder:l,layers:c,transformAnimationList:h,isSsr:u}=i;return{name:e,visible:t,renderOrder:l,castShadow:r,receiveShadow:s,position:{x:a.x,y:a.y,z:a.z},rotation:{x:n.x,y:n.y,z:n.z},scale:{x:o.x,y:o.y,z:o.z},layers:hM(c),blendShaderPrograms:fA(i),transformAnimationList:h,isSsr:u}}function Jn(i,e){if(function(f){const{D:g}=pM;if(new g(mM.T())<new g)for(const m in f)delete f[m]}(i),!e)return;const{name:t,visible:r,castShadow:s,receiveShadow:a,position:n,rotation:o,scale:l,renderOrder:c,layers:h,blendShaderPrograms:u,transformAnimationList:d,isSsr:p}=e;i.name=t,i.visible=r,i.renderOrder=c,i.castShadow=s,i.receiveShadow=a,i.position.set(n.x,n.y,n.z),i.rotation.set(o.x,o.y,o.z),i.scale.set(l.x,l.y,l.z),uM(i.layers,h),function(f,g){if(!g)return;const m=fl(f);if(!m)return;k0(f,g);const{shaderProgramsCodeName:v,isBlendShaderPrograms:_,uvType:y,uniforms:x}=g;if(!_)return;const{shaderLibrary:b,shaderFrames:M}=m,T=b[v];T.setUniformsRender(f),T.setVertexFormUV(y),gc(f,T)&&M.push(f),lM(f.uniforms,x)}(i,u),i.transformAnimationList=d,p&&(i.isSsr=p,fl(i).ssrList.push(i))}function Ys(i,e){e.add(i,"name").name("模型名字"),e.add(i,"visible").name("显示"),Reflect.has(i,"isSsr")||(i.isSsr=!1),e.add(i,"isSsr").name("SSR").onChange(t=>{const r=fl(i);if(t)r.ssrList.push(i);else{const s=r.ssrList.indexOf(i);s!==-1&&r.ssrList.splice(s,1)}}),dM(i.layers,e),e.add(i,"renderOrder").name("渲染顺序").step(1),e.add(i,"castShadow").name("产生阴影"),e.add(i,"receiveShadow").name("接收阴影"),["x","y","z"].forEach(t=>e.add(i.position,t).name("位置"+t)),["x","y","z"].forEach(t=>e.add(i.rotation,t).name("旋转"+t)),["x","y","z"].forEach(t=>e.add(i.scale,t).name("缩放"+t))}function Dy(i,e,t){Ys(e,t.addFolder("基础配置")),function(r,s){const{geometry:a}=r,{parameters:n}=a,o=()=>{a.dispose(),r.geometry=N0(a.geometryType,n)};switch(a.geometryType){case"立方体":s.add(n,"width",0).name("宽度").onChange(o),s.add(n,"height",0).name("高度").onChange(o),s.add(n,"depth",0).name("深度").onChange(o),s.add(n,"widthSegments",0).name("宽度分段").onChange(o).step(1),s.add(n,"heightSegments",0).name("高度分段").onChange(o).step(1),s.add(n,"depthSegments",0).name("深度分段").onChange(o).step(1);break;case"球体":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"widthSegments",0).name("宽度分段").onChange(o),s.add(n,"heightSegments",0).name("高度分段").onChange(o);break;case"平面":s.add(n,"width",0).name("宽度").onChange(o),s.add(n,"height",0).name("高度").onChange(o),s.add(n,"widthSegments",0).name("宽度分段").onChange(o),s.add(n,"heightSegments",0).name("高度分段").onChange(o);break;case"胶囊":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"length",0).name("高度").onChange(o),s.add(n,"capSegments",0).name("顶部分段").onChange(o),s.add(n,"radialSegments",0).name("半径分段").onChange(o);break;case"圆锥":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"height",0).name("高度").onChange(o),s.add(n,"radialSegments",0).name("半径分段").onChange(o);break;case"圆面":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"thetaStart",0).name("起始角度").onChange(o),s.add(n,"thetaLength",0,2*Math.PI).name("结束角度").onChange(o);break;case"圆柱":s.add(n,"radiusTop",0).name("顶部半径").onChange(o),s.add(n,"radiusBottom",0).name("底部半径").onChange(o),s.add(n,"height",0).name("高度").onChange(o),s.add(n,"radialSegments",0).name("半径分段").onChange(o);break;case"圆环":s.add(n,"radius",0).name("半径").onChange(o),s.add(n,"tube",0).name("管道半径").onChange(o),s.add(n,"radialSegments",0).name("半径分段").onChange(o),s.add(n,"tubularSegments",0).name("管道分段").onChange(o),s.add(n,"arc",0,2*Math.PI).name("弧度").onChange(o);break;case"环面":s.add(n,"innerRadius",0).name("内半径").onChange(o),s.add(n,"outerRadius",0).name("外半径").onChange(o),s.add(n,"thetaSegments",0).name("弧度分段").onChange(o),s.add(n,"phiSegments",0).name("管道分段").onChange(o),s.add(n,"thetaStart",0).name("起始角度").onChange(o),s.add(n,"thetaLength",0,2*Math.PI).name("结束角度").onChange(o)}}(e,t.addFolder("几何体")),Sp(i,e.material,t.addFolder("材质")),t.addFn(()=>{i.remove(e),t.parent.removeFolder(t)}).name("删除")}function Oo(i){const{position:e,rotation:t,scale:r}=i;return{position:{x:e.x,y:e.y,z:e.z},rotation:{x:t.x,y:t.y,z:t.z},scale:{x:r.x,y:r.y,z:r.z}}}function Ed(i,e){if(!e)return;const{position:t,rotation:r,scale:s}=e;i.position.set(t.x,t.y,t.z),i.rotation.set(r.x,r.y,r.z),i.scale.set(s.x,s.y,s.z)}function Tr(i,e,t=null){return D0.to(i,Re(mi(Re({},e),{duration:2,ease:"none",repeat:0,yoyo:!1,yoyoEase:!0}),t))}function Ad(i,e,t,r){const{mode:s,query:a}=r;Ed(i,e);const n=["position","rotation","scale"].map(o=>new Promise(l=>{D0[s](i[o],mi(Re({x:t[o].x,y:t[o].y,z:t[o].z},a),{onComplete:l}))}));return Promise.all(n)}function fM(i){if(i.children.length===0)return i.resetEnv();i.children.forEach(e=>{i.remove(e),gM(e)}),fM(i)}function gM(i){i.traverse(e=>{var t;e instanceof ye?sd(e):(t=e.dispose)==null||t.call(e)})}function sd(i){var e;i.geometry.dispose(),Array.isArray(i.material)?i.material.forEach(t=>{var r;t.dispose(),(r=t.map)==null||r.dispose()}):(i.material.dispose(),(e=i.material.map)==null||e.dispose())}function No(i,e){var t=i.__state.conversionName.toString(),r=Math.round(i.r),s=Math.round(i.g),a=Math.round(i.b),n=i.a,o=Math.round(i.h),l=i.s.toFixed(1),c=i.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var h=i.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}return t==="CSS_RGB"?"rgb("+r+","+s+","+a+")":t==="CSS_RGBA"?"rgba("+r+","+s+","+a+","+n+")":t==="HEX"?"0x"+i.hex.toString(16):t==="RGB_ARRAY"?"["+r+","+s+","+a+"]":t==="RGBA_ARRAY"?"["+r+","+s+","+a+","+n+"]":t==="RGB_OBJ"?"{r:"+r+",g:"+s+",b:"+a+"}":t==="RGBA_OBJ"?"{r:"+r+",g:"+s+",b:"+a+",a:"+n+"}":t==="HSV_OBJ"?"{h:"+o+",s:"+l+",v:"+c+"}":t==="HSVA_OBJ"?"{h:"+o+",s:"+l+",v:"+c+",a:"+n+"}":"unknown format"}(function(){const{D:i,P:e,A:t,V:r,F:s}=pM;new i(mM.T())<new i&&(t[e][r[0]]=s[0],t[e][r[1]]=s[1],t[e][r[2]]=s[2],t[e][r[3]]=s[3])})();var Oy=Array.prototype.forEach,Bl=Array.prototype.slice,_e={BREAK:{},extend:function(i){return this.each(Bl.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach((function(t){this.isUndefined(e[t])||(i[t]=e[t])}).bind(this))},this),i},defaults:function(i){return this.each(Bl.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach((function(t){this.isUndefined(i[t])&&(i[t]=e[t])}).bind(this))},this),i},compose:function(){var i=Bl.call(arguments);return function(){for(var e=Bl.call(arguments),t=i.length-1;t>=0;t--)e=[i[t].apply(this,e)];return e[0]}},each:function(i,e,t){if(i){if(Oy&&i.forEach&&i.forEach===Oy)i.forEach(e,t);else if(i.length===i.length+0){var r,s=void 0;for(s=0,r=i.length;s<r;s++)if(s in i&&e.call(t,i[s],s)===this.BREAK)return}else for(var a in i)if(e.call(t,i[a],a)===this.BREAK)return}},defer:function(i){setTimeout(i,0)},debounce:function(i,e,t){var r=void 0;return function(){var s=this,a=arguments,n=t||!r;clearTimeout(r),r=setTimeout(function(){r=null,t||i.apply(s,a)},e),n&&i.apply(s,a)}},toArray:function(i){return i.toArray?i.toArray():Bl.call(i)},isUndefined:function(i){return i===void 0},isNull:function(i){return i===null},isNaN:function(i){function e(t){return i.apply(this,arguments)}return e.toString=function(){return i.toString()},e}(function(i){return isNaN(i)}),isArray:Array.isArray||function(i){return i.constructor===Array},isObject:function(i){return i===Object(i)},isNumber:function(i){return i===i+0},isString:function(i){return i===i+""},isBoolean:function(i){return i===!1||i===!0},isFunction:function(i){return i instanceof Function}},gA=[{litmus:_e.isString,conversions:{THREE_CHAR_HEX:{read:function(i){var e=i.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return e!==null&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:No},SIX_CHAR_HEX:{read:function(i){var e=i.match(/^#([A-F0-9]{6})$/i);return e!==null&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:No},CSS_RGB:{read:function(i){var e=i.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e!==null&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:No},CSS_RGBA:{read:function(i){var e=i.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e!==null&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:No}}},{litmus:_e.isNumber,conversions:{HEX:{read:function(i){return{space:"HEX",hex:i,conversionName:"HEX"}},write:function(i){return i.hex}}}},{litmus:_e.isArray,conversions:{RGB_ARRAY:{read:function(i){return i.length===3&&{space:"RGB",r:i[0],g:i[1],b:i[2]}},write:function(i){return[i.r,i.g,i.b]}},RGBA_ARRAY:{read:function(i){return i.length===4&&{space:"RGB",r:i[0],g:i[1],b:i[2],a:i[3]}},write:function(i){return[i.r,i.g,i.b,i.a]}}}},{litmus:_e.isObject,conversions:{RGBA_OBJ:{read:function(i){return!!(_e.isNumber(i.r)&&_e.isNumber(i.g)&&_e.isNumber(i.b)&&_e.isNumber(i.a))&&{space:"RGB",r:i.r,g:i.g,b:i.b,a:i.a}},write:function(i){return{r:i.r,g:i.g,b:i.b,a:i.a}}},RGB_OBJ:{read:function(i){return!!(_e.isNumber(i.r)&&_e.isNumber(i.g)&&_e.isNumber(i.b))&&{space:"RGB",r:i.r,g:i.g,b:i.b}},write:function(i){return{r:i.r,g:i.g,b:i.b}}},HSVA_OBJ:{read:function(i){return!!(_e.isNumber(i.h)&&_e.isNumber(i.s)&&_e.isNumber(i.v)&&_e.isNumber(i.a))&&{space:"HSV",h:i.h,s:i.s,v:i.v,a:i.a}},write:function(i){return{h:i.h,s:i.s,v:i.v,a:i.a}}},HSV_OBJ:{read:function(i){return!!(_e.isNumber(i.h)&&_e.isNumber(i.s)&&_e.isNumber(i.v))&&{space:"HSV",h:i.h,s:i.s,v:i.v}},write:function(i){return{h:i.h,s:i.s,v:i.v}}}}}],Vl=void 0,bu=void 0,Mg=function(){bu=!1;var i=arguments.length>1?_e.toArray(arguments):arguments[0];return _e.each(gA,function(e){if(e.litmus(i))return _e.each(e.conversions,function(t,r){if(Vl=t.read(i),bu===!1&&Vl!==!1)return bu=Vl,Vl.conversionName=r,Vl.conversion=t,_e.BREAK}),_e.BREAK}),bu},Ny=void 0,Mu={hsv_to_rgb:function(i,e,t){var r=Math.floor(i/60)%6,s=i/60-Math.floor(i/60),a=t*(1-e),n=t*(1-s*e),o=t*(1-(1-s)*e),l=[[t,o,a],[n,t,a],[a,t,o],[a,n,t],[o,a,t],[t,a,n]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(i,e,t){var r=Math.min(i,e,t),s=Math.max(i,e,t),a=s-r,n=void 0;return s===0?{h:NaN,s:0,v:0}:(n=i===s?(e-t)/a:e===s?2+(t-i)/a:4+(i-e)/a,(n/=6)<0&&(n+=1),{h:360*n,s:a/s,v:s/255})},rgb_to_hex:function(i,e,t){var r=this.hex_with_component(0,2,i);return r=this.hex_with_component(r,1,e),r=this.hex_with_component(r,0,t)},component_from_hex:function(i,e){return i>>8*e&255},hex_with_component:function(i,e,t){return t<<(Ny=8*e)|i&~(255<<Ny)}},vA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Xr=function(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")},qr=function(){function i(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),Fa=function i(e,t,r){e===null&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,t);if(s===void 0){var a=Object.getPrototypeOf(e);return a===null?void 0:i(a,t,r)}if("value"in s)return s.value;var n=s.get;return n===void 0?void 0:n.call(r)},Va=function(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(i,e):i.__proto__=e)},Ha=function(i,e){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||typeof e!="object"&&typeof e!="function"?i:e},ui=function(){function i(){if(Xr(this,i),this.__state=Mg.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return qr(i,[{key:"toString",value:function(){return No(this)}},{key:"toHexString",value:function(){return No(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),i}();function Dm(i,e,t){Object.defineProperty(i,e,{get:function(){return this.__state.space==="RGB"||ui.recalculateRGB(this,e,t),this.__state[e]},set:function(r){this.__state.space!=="RGB"&&(ui.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=r}})}function Om(i,e){Object.defineProperty(i,e,{get:function(){return this.__state.space==="HSV"||ui.recalculateHSV(this),this.__state[e]},set:function(t){this.__state.space!=="HSV"&&(ui.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}ui.recalculateRGB=function(i,e,t){if(i.__state.space==="HEX")i.__state[e]=Mu.component_from_hex(i.__state.hex,t);else{if(i.__state.space!=="HSV")throw new Error("Corrupted color state");_e.extend(i.__state,Mu.hsv_to_rgb(i.__state.h,i.__state.s,i.__state.v))}},ui.recalculateHSV=function(i){var e=Mu.rgb_to_hsv(i.r,i.g,i.b);_e.extend(i.__state,{s:e.s,v:e.v}),_e.isNaN(e.h)?_e.isUndefined(i.__state.h)&&(i.__state.h=0):i.__state.h=e.h},ui.COMPONENTS=["r","g","b","h","s","v","hex","a"],Dm(ui.prototype,"r",2),Dm(ui.prototype,"g",1),Dm(ui.prototype,"b",0),Om(ui.prototype,"h"),Om(ui.prototype,"s"),Om(ui.prototype,"v"),Object.defineProperty(ui.prototype,"a",{get:function(){return this.__state.a},set:function(i){this.__state.a=i}}),Object.defineProperty(ui.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=Mu.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(i){this.__state.space="HEX",this.__state.hex=i}});var eo=function(){function i(e,t){Xr(this,i),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return qr(i,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),i}(),vM={};_e.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(i,e){_e.each(i,function(t){vM[t]=e})});var _A=/(\d+(\.\d+)?)px/;function Kr(i){if(i==="0"||_e.isUndefined(i))return 0;var e=i.match(_A);return _e.isNull(e)?0:parseFloat(e[1])}var oe={makeSelectable:function(i,e){i!==void 0&&i.style!==void 0&&(i.onselectstart=e?function(){return!1}:function(){},i.style.MozUserSelect=e?"auto":"none",i.style.KhtmlUserSelect=e?"auto":"none",i.unselectable=e?"on":"off")},makeFullscreen:function(i,e,t){var r=t,s=e;_e.isUndefined(s)&&(s=!0),_e.isUndefined(r)&&(r=!0),i.style.position="absolute",s&&(i.style.left=0,i.style.right=0),r&&(i.style.top=0,i.style.bottom=0)},fakeEvent:function(i,e,t,r){var s=t||{},a=vM[e];if(!a)throw new Error("Event type "+e+" not supported.");var n=document.createEvent(a);switch(a){case"MouseEvents":var o=s.x||s.clientX||0,l=s.y||s.clientY||0;n.initMouseEvent(e,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,o,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=n.initKeyboardEvent||n.initKeyEvent;_e.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break;default:n.initEvent(e,s.bubbles||!1,s.cancelable||!0)}_e.defaults(n,r),i.dispatchEvent(n)},bind:function(i,e,t,r){var s=r||!1;return i.addEventListener?i.addEventListener(e,t,s):i.attachEvent&&i.attachEvent("on"+e,t),oe},unbind:function(i,e,t,r){var s=r||!1;return i.removeEventListener?i.removeEventListener(e,t,s):i.detachEvent&&i.detachEvent("on"+e,t),oe},addClass:function(i,e){if(i.className===void 0)i.className=e;else if(i.className!==e){var t=i.className.split(/ +/);t.indexOf(e)===-1&&(t.push(e),i.className=t.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return oe},removeClass:function(i,e){if(e)if(i.className===e)i.removeAttribute("class");else{var t=i.className.split(/ +/),r=t.indexOf(e);r!==-1&&(t.splice(r,1),i.className=t.join(" "))}else i.className=void 0;return oe},hasClass:function(i,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(i.className)||!1},getWidth:function(i){var e=getComputedStyle(i);return Kr(e["border-left-width"])+Kr(e["border-right-width"])+Kr(e["padding-left"])+Kr(e["padding-right"])+Kr(e.width)},getHeight:function(i){var e=getComputedStyle(i);return Kr(e["border-top-width"])+Kr(e["border-bottom-width"])+Kr(e["padding-top"])+Kr(e["padding-bottom"])+Kr(e.height)},getOffset:function(i){var e=i,t={left:0,top:0};if(e.offsetParent)do t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.offsetParent;while(e);return t},isActive:function(i){return i===document.activeElement&&(i.type||i.href)}},_M=function(i){function e(t,r){Xr(this,e);var s=Ha(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),a=s;return s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox"),oe.bind(s.__checkbox,"change",function(){a.setValue(!a.__prev)},!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return Va(e,eo),qr(e,[{key:"setValue",value:function(t){var r=Fa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Fa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),yA=function(i){function e(t,r,s){Xr(this,e);var a=Ha(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),n=s,o=a;if(a.__select=document.createElement("select"),_e.isArray(n)){var l={};_e.each(n,function(c){l[c]=c}),n=l}return _e.each(n,function(c,h){var u=document.createElement("option");u.innerHTML=h,u.setAttribute("value",c),o.__select.appendChild(u)}),a.updateDisplay(),oe.bind(a.__select,"change",function(){var c=this.options[this.selectedIndex].value;o.setValue(c)}),a.domElement.appendChild(a.__select),a}return Va(e,eo),qr(e,[{key:"setValue",value:function(t){var r=Fa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return oe.isActive(this.__select)?this:(this.__select.value=this.getValue(),Fa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(),xA=function(i){function e(t,r){Xr(this,e);var s=Ha(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),a=s;function n(){a.setValue(a.__input.value)}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),oe.bind(s.__input,"keyup",n),oe.bind(s.__input,"change",n),oe.bind(s.__input,"blur",function(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}),oe.bind(s.__input,"keydown",function(o){o.keyCode===13&&this.blur()}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return Va(e,eo),qr(e,[{key:"updateDisplay",value:function(){return oe.isActive(this.__input)||(this.__input.value=this.getValue()),Fa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function Uy(i){var e=i.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var yM=function(i){function e(t,r,s){Xr(this,e);var a=Ha(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),n=s||{};return a.__min=n.min,a.__max=n.max,a.__step=n.step,_e.isUndefined(a.__step)?a.initialValue===0?a.__impliedStep=1:a.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(a.initialValue))/Math.LN10))/10:a.__impliedStep=a.__step,a.__precision=Uy(a.__impliedStep),a}return Va(e,eo),qr(e,[{key:"setValue",value:function(t){var r=t;return this.__min!==void 0&&r<this.__min?r=this.__min:this.__max!==void 0&&r>this.__max&&(r=this.__max),this.__step!==void 0&&r%this.__step!=0&&(r=Math.round(r/this.__step)*this.__step),Fa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=Uy(t),this}}]),e}(),Cd=function(i){function e(t,r,s){Xr(this,e);var a=Ha(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,s));a.__truncationSuspended=!1;var n=a,o=void 0;function l(){n.__onFinishChange&&n.__onFinishChange.call(n,n.getValue())}function c(u){var d=o-u.clientY;n.setValue(n.getValue()+d*n.__impliedStep),o=u.clientY}function h(){oe.unbind(window,"mousemove",c),oe.unbind(window,"mouseup",h),l()}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),oe.bind(a.__input,"change",function(){var u=parseFloat(n.__input.value);_e.isNaN(u)||n.setValue(u)}),oe.bind(a.__input,"blur",function(){l()}),oe.bind(a.__input,"mousedown",function(u){oe.bind(window,"mousemove",c),oe.bind(window,"mouseup",h),o=u.clientY}),oe.bind(a.__input,"keydown",function(u){u.keyCode===13&&(n.__truncationSuspended=!0,this.blur(),n.__truncationSuspended=!1,l())}),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return Va(e,yM),qr(e,[{key:"updateDisplay",value:function(){var t,r,s;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),r=this.__precision,s=Math.pow(10,r),Math.round(t*s)/s),Fa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}();function ky(i,e,t,r,s){return r+(i-e)/(t-e)*(s-r)}var wg=function(i){function e(t,r,s,a,n){Xr(this,e);var o=Ha(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,{min:s,max:a,step:n})),l=o;function c(p){p.preventDefault();var f=l.__background.getBoundingClientRect();return l.setValue(ky(p.clientX,f.left,f.right,l.__min,l.__max)),!1}function h(){oe.unbind(window,"mousemove",c),oe.unbind(window,"mouseup",h),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function u(p){var f=p.touches[0].clientX,g=l.__background.getBoundingClientRect();l.setValue(ky(f,g.left,g.right,l.__min,l.__max))}function d(){oe.unbind(window,"touchmove",u),oe.unbind(window,"touchend",d),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),oe.bind(o.__background,"mousedown",function(p){document.activeElement.blur(),oe.bind(window,"mousemove",c),oe.bind(window,"mouseup",h),c(p)}),oe.bind(o.__background,"touchstart",function(p){p.touches.length===1&&(oe.bind(window,"touchmove",u),oe.bind(window,"touchend",d),u(p))}),oe.addClass(o.__background,"slider"),oe.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return Va(e,yM),qr(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",Fa(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(),xM=function(i){function e(t,r,s){Xr(this,e);var a=Ha(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),n=a;return a.__button=document.createElement("div"),a.__button.innerHTML=s===void 0?"Fire":s,oe.bind(a.__button,"click",function(o){return o.preventDefault(),n.fire(),!1}),oe.addClass(a.__button,"button"),a.domElement.appendChild(a.__button),a}return Va(e,eo),qr(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(),Nm=function(i){function e(t,r){Xr(this,e);var s=Ha(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));s.__color=new ui(s.getValue()),s.__temp=new ui(0);var a=s;s.domElement=document.createElement("div"),oe.makeSelectable(s.domElement,!1),s.__selector=document.createElement("div"),s.__selector.className="selector",s.__saturation_field=document.createElement("div"),s.__saturation_field.className="saturation-field",s.__field_knob=document.createElement("div"),s.__field_knob.className="field-knob",s.__field_knob_border="2px solid ",s.__hue_knob=document.createElement("div"),s.__hue_knob.className="hue-knob",s.__hue_field=document.createElement("div"),s.__hue_field.className="hue-field",s.__input=document.createElement("input"),s.__input.type="text",s.__input_textShadow="0 1px 1px ",oe.bind(s.__input,"keydown",function(m){m.keyCode===13&&d.call(this)}),oe.bind(s.__input,"blur",d),oe.bind(s.__selector,"mousedown",function(){oe.addClass(this,"drag").bind(window,"mouseup",function(){oe.removeClass(a.__selector,"drag")})}),oe.bind(s.__selector,"touchstart",function(){oe.addClass(this,"drag").bind(window,"touchend",function(){oe.removeClass(a.__selector,"drag")})});var n,o=document.createElement("div");function l(m){f(m),oe.bind(window,"mousemove",f),oe.bind(window,"touchmove",f),oe.bind(window,"mouseup",h),oe.bind(window,"touchend",h)}function c(m){g(m),oe.bind(window,"mousemove",g),oe.bind(window,"touchmove",g),oe.bind(window,"mouseup",u),oe.bind(window,"touchend",u)}function h(){oe.unbind(window,"mousemove",f),oe.unbind(window,"touchmove",f),oe.unbind(window,"mouseup",h),oe.unbind(window,"touchend",h),p()}function u(){oe.unbind(window,"mousemove",g),oe.unbind(window,"touchmove",g),oe.unbind(window,"mouseup",u),oe.unbind(window,"touchend",u),p()}function d(){var m=Mg(this.value);m!==!1?(a.__color.__state=m,a.setValue(a.__color.toOriginal())):this.value=a.__color.toString()}function p(){a.__onFinishChange&&a.__onFinishChange.call(a,a.__color.toOriginal())}function f(m){m.type.indexOf("touch")===-1&&m.preventDefault();var v=a.__saturation_field.getBoundingClientRect(),_=m.touches&&m.touches[0]||m,y=_.clientX,x=_.clientY,b=(y-v.left)/(v.right-v.left),M=1-(x-v.top)/(v.bottom-v.top);return M>1?M=1:M<0&&(M=0),b>1?b=1:b<0&&(b=0),a.__color.v=M,a.__color.s=b,a.setValue(a.__color.toOriginal()),!1}function g(m){m.type.indexOf("touch")===-1&&m.preventDefault();var v=a.__hue_field.getBoundingClientRect(),_=1-((m.touches&&m.touches[0]||m).clientY-v.top)/(v.bottom-v.top);return _>1?_=1:_<0&&(_=0),a.__color.h=360*_,a.setValue(a.__color.toOriginal()),!1}return _e.extend(s.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),_e.extend(s.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:s.__field_knob_border+(s.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),_e.extend(s.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),_e.extend(s.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),_e.extend(o.style,{width:"100%",height:"100%",background:"none"}),Fy(o,"top","rgba(0,0,0,0)","#000"),_e.extend(s.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(n=s.__hue_field).style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",_e.extend(s.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:s.__input_textShadow+"rgba(0,0,0,0.7)"}),oe.bind(s.__saturation_field,"mousedown",l),oe.bind(s.__saturation_field,"touchstart",l),oe.bind(s.__field_knob,"mousedown",l),oe.bind(s.__field_knob,"touchstart",l),oe.bind(s.__hue_field,"mousedown",c),oe.bind(s.__hue_field,"touchstart",c),s.__saturation_field.appendChild(o),s.__selector.appendChild(s.__field_knob),s.__selector.appendChild(s.__saturation_field),s.__selector.appendChild(s.__hue_field),s.__hue_field.appendChild(s.__hue_knob),s.domElement.appendChild(s.__input),s.domElement.appendChild(s.__selector),s.updateDisplay(),s}return Va(e,eo),qr(e,[{key:"updateDisplay",value:function(){var t=Mg(this.getValue());if(t!==!1){var r=!1;_e.each(ui.COMPONENTS,function(n){if(!_e.isUndefined(t[n])&&!_e.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return r=!0,{}},this),r&&_e.extend(this.__color.__state,t)}_e.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,a=255-s;_e.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Fy(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),_e.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),e}(),bA=["-moz-","-o-","-webkit-","-ms-",""];function Fy(i,e,t,r){i.style.background="",_e.each(bA,function(s){i.style.cssText+="background: "+s+"linear-gradient("+e+", "+t+" 0%, "+r+" 100%); "})}var MA=function(i,e){var t=document,r=document.createElement("style");r.type="text/css",r.innerHTML=i;var s=t.getElementsByTagName("head")[0];try{s.appendChild(r)}catch{}},wA=function(i,e){var t=i[e];return _e.isArray(arguments[2])||_e.isObject(arguments[2])?new yA(i,e,arguments[2]):_e.isNumber(t)?_e.isNumber(arguments[2])&&_e.isNumber(arguments[3])?_e.isNumber(arguments[4])?new wg(i,e,arguments[2],arguments[3],arguments[4]):new wg(i,e,arguments[2],arguments[3]):_e.isNumber(arguments[4])?new Cd(i,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Cd(i,e,{min:arguments[2],max:arguments[3]}):_e.isString(t)?new xA(i,e):_e.isFunction(t)?new xM(i,e,""):_e.isBoolean(t)?new _M(i,e):null},SA=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){setTimeout(i,1e3/60)},TA=function(){function i(){Xr(this,i),this.backgroundElement=document.createElement("div"),_e.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),oe.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),_e.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;oe.bind(this.backgroundElement,"click",function(){e.hide()})}return qr(i,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),_e.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function r(){e.domElement.style.display="none",e.backgroundElement.style.display="none",oe.unbind(e.domElement,"webkitTransitionEnd",r),oe.unbind(e.domElement,"transitionend",r),oe.unbind(e.domElement,"oTransitionEnd",r)};oe.bind(this.domElement,"webkitTransitionEnd",t),oe.bind(this.domElement,"transitionend",t),oe.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-oe.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-oe.getHeight(this.domElement)/2+"px"}}]),i}(),EA=function(i){if(typeof window<"u"){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=i,document.head.appendChild(e),i}}(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);MA(EA);var Wc="Default",rc=function(){try{return!!window.localStorage}catch{return!1}}(),wu=void 0,zy=!0,Co=void 0,Um=!1,bM=[],xt=function i(e){var t=this,r=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),oe.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=_e.defaults(r,{closeOnTop:!1,autoPlace:!0,width:i.DEFAULT_WIDTH}),r=_e.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),_e.isUndefined(r.load)?r.load={preset:Wc}:r.preset&&(r.load.preset=r.preset),_e.isUndefined(r.parent)&&r.hideable&&bM.push(this),r.resizable=_e.isUndefined(r.parent)&&r.resizable,r.autoPlace&&_e.isUndefined(r.scrollable)&&(r.scrollable=!0);var s,a=rc&&localStorage.getItem(Po(this,"isLocal"))==="true",n=void 0,o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:r.load.preset},set:function(h){t.parent?t.getRoot().preset=h:r.load.preset=h,function(u){for(var d=0;d<u.__preset_select.length;d++)u.__preset_select[d].value===u.preset&&(u.__preset_select.selectedIndex=d)}(this),t.revert()}},width:{get:function(){return r.width},set:function(h){r.width=h,Tg(t,h)}},name:{get:function(){return r.name},set:function(h){r.name=h,o&&(o.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(h){r.closed=h,r.closed?oe.addClass(t.__ul,i.CLASS_CLOSED):oe.removeClass(t.__ul,i.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=h?i.TEXT_OPEN:i.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(h){rc&&(a=h,h?oe.bind(window,"unload",n):oe.unbind(window,"unload",n),localStorage.setItem(Po(t,"isLocal"),h))}}}),_e.isUndefined(r.parent)){if(this.closed=r.closed||!1,oe.addClass(this.domElement,i.CLASS_MAIN),oe.makeSelectable(this.domElement,!1),rc&&a){t.useLocalStorage=!0;var l=localStorage.getItem(Po(this,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=i.TEXT_CLOSED,oe.addClass(this.__closeButton,i.CLASS_CLOSE_BUTTON),r.closeOnTop?(oe.addClass(this.__closeButton,i.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(oe.addClass(this.__closeButton,i.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),oe.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{r.closed===void 0&&(r.closed=!0);var c=document.createTextNode(r.name);oe.addClass(c,"controller-name"),o=F0(t,c),oe.addClass(this.__ul,i.CLASS_CLOSED),oe.addClass(o,"title"),oe.bind(o,"click",function(h){return h.preventDefault(),t.closed=!t.closed,!1}),r.closed||(this.closed=!1)}r.autoPlace&&(_e.isUndefined(r.parent)&&(zy&&(Co=document.createElement("div"),oe.addClass(Co,"dg"),oe.addClass(Co,i.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Co),zy=!1),Co.appendChild(this.domElement),oe.addClass(this.domElement,i.CLASS_AUTO_PLACE)),this.parent||Tg(t,r.width)),this.__resizeHandler=function(){t.onResizeDebounced()},oe.bind(window,"resize",this.__resizeHandler),oe.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),oe.bind(this.__ul,"transitionend",this.__resizeHandler),oe.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&AA(this),n=function(){rc&&localStorage.getItem(Po(t,"isLocal"))==="true"&&localStorage.setItem(Po(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=n,r.parent||((s=t.getRoot()).width+=1,_e.defer(function(){s.width-=1}))};function F0(i,e,t){var r=document.createElement("li");return e&&r.appendChild(e),t?i.__ul.insertBefore(r,t):i.__ul.appendChild(r),i.onResize(),r}function By(i){oe.unbind(window,"resize",i.__resizeHandler),i.saveToLocalStorageIfPossible&&oe.unbind(window,"unload",i.saveToLocalStorageIfPossible)}function Sg(i,e){var t=i.__preset_select[i.__preset_select.selectedIndex];t.innerHTML=e?t.value+"*":t.value}function MM(i,e){var t=i.getRoot(),r=t.__rememberedObjects.indexOf(e.object);if(r!==-1){var s=t.__rememberedObjectIndecesToControllers[r];if(s===void 0&&(s={},t.__rememberedObjectIndecesToControllers[r]=s),s[e.property]=e,t.load&&t.load.remembered){var a=t.load.remembered,n=void 0;if(a[i.preset])n=a[i.preset];else{if(!a[Wc])return;n=a[Wc]}if(n[r]&&n[r][e.property]!==void 0){var o=n[r][e.property];e.initialValue=o,e.setValue(o)}}}}function vc(i,e,t,r){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var s=void 0;if(r.color)s=new Nm(e,t);else{var a=[e,t].concat(r.factoryArgs);s=wA.apply(i,a)}r.before instanceof eo&&(r.before=r.before.__li),MM(i,s),oe.addClass(s.domElement,"c");var n=document.createElement("span");oe.addClass(n,"property-name"),n.innerHTML=s.property;var o=document.createElement("div");o.appendChild(n),o.appendChild(s.domElement);var l=F0(i,o,r.before);return oe.addClass(l,xt.CLASS_CONTROLLER_ROW),s instanceof Nm?oe.addClass(l,"color"):oe.addClass(l,vA(s.getValue())),function(c,h,u){if(u.__li=h,u.__gui=c,_e.extend(u,{options:function(f){if(arguments.length>1){var g=u.__li.nextElementSibling;return u.remove(),vc(c,u.object,u.property,{before:g,factoryArgs:[_e.toArray(arguments)]})}if(_e.isArray(f)||_e.isObject(f)){var m=u.__li.nextElementSibling;return u.remove(),vc(c,u.object,u.property,{before:m,factoryArgs:[f]})}},name:function(f){return u.__li.firstElementChild.firstElementChild.innerHTML=f,u},listen:function(){return u.__gui.listen(u),u},remove:function(){return u.__gui.remove(u),u}}),u instanceof wg){var d=new Cd(u.object,u.property,{min:u.__min,max:u.__max,step:u.__step});_e.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(f){var g=u[f],m=d[f];u[f]=d[f]=function(){var v=Array.prototype.slice.call(arguments);return m.apply(d,v),g.apply(u,v)}}),oe.addClass(h,"has-slider"),u.domElement.insertBefore(d.domElement,u.domElement.firstElementChild)}else if(u instanceof Cd){var p=function(f){if(_e.isNumber(u.__min)&&_e.isNumber(u.__max)){var g=u.__li.firstElementChild.firstElementChild.innerHTML,m=u.__gui.__listening.indexOf(u)>-1;u.remove();var v=vc(c,u.object,u.property,{before:u.__li.nextElementSibling,factoryArgs:[u.__min,u.__max,u.__step]});return v.name(g),m&&v.listen(),v}return f};u.min=_e.compose(p,u.min),u.max=_e.compose(p,u.max)}else u instanceof _M?(oe.bind(h,"click",function(){oe.fakeEvent(u.__checkbox,"click")}),oe.bind(u.__checkbox,"click",function(f){f.stopPropagation()})):u instanceof xM?(oe.bind(h,"click",function(){oe.fakeEvent(u.__button,"click")}),oe.bind(h,"mouseover",function(){oe.addClass(u.__button,"hover")}),oe.bind(h,"mouseout",function(){oe.removeClass(u.__button,"hover")})):u instanceof Nm&&(oe.addClass(h,"color"),u.updateDisplay=_e.compose(function(f){return h.style.borderLeftColor=u.__color.toString(),f},u.updateDisplay),u.updateDisplay());u.setValue=_e.compose(function(f){return c.getRoot().__preset_select&&u.isModified()&&Sg(c.getRoot(),!0),f},u.setValue)}(i,l,s),i.__controllers.push(s),s}function Po(i,e){return document.location.href+"."+e}function km(i,e,t){var r=document.createElement("option");r.innerHTML=e,r.value=e,i.__preset_select.appendChild(r),t&&(i.__preset_select.selectedIndex=i.__preset_select.length-1)}function Vy(i,e){e.style.display=i.useLocalStorage?"block":"none"}function AA(i){var e=void 0;function t(a){return a.preventDefault(),i.width+=e-a.clientX,i.onResize(),e=a.clientX,!1}function r(){oe.removeClass(i.__closeButton,xt.CLASS_DRAG),oe.unbind(window,"mousemove",t),oe.unbind(window,"mouseup",r)}function s(a){return a.preventDefault(),e=a.clientX,oe.addClass(i.__closeButton,xt.CLASS_DRAG),oe.bind(window,"mousemove",t),oe.bind(window,"mouseup",r),!1}i.__resize_handle=document.createElement("div"),_e.extend(i.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),oe.bind(i.__resize_handle,"mousedown",s),oe.bind(i.__closeButton,"mousedown",s),i.domElement.insertBefore(i.__resize_handle,i.domElement.firstElementChild)}function Tg(i,e){i.domElement.style.width=e+"px",i.__save_row&&i.autoPlace&&(i.__save_row.style.width=e+"px"),i.__closeButton&&(i.__closeButton.style.width=e+"px")}function Su(i,e){var t={};return _e.each(i.__rememberedObjects,function(r,s){var a={},n=i.__rememberedObjectIndecesToControllers[s];_e.each(n,function(o,l){a[l]=e?o.initialValue:o.getValue()}),t[s]=a}),t}function wM(i){i.length!==0&&SA.call(window,function(){wM(i)}),_e.each(i,function(e){e.updateDisplay()})}xt.toggleHide=function(){Um=!Um,_e.each(bM,function(i){i.domElement.style.display=Um?"none":""})},xt.CLASS_AUTO_PLACE="a",xt.CLASS_AUTO_PLACE_CONTAINER="ac",xt.CLASS_MAIN="main",xt.CLASS_CONTROLLER_ROW="cr",xt.CLASS_TOO_TALL="taller-than-window",xt.CLASS_CLOSED="closed",xt.CLASS_CLOSE_BUTTON="close-button",xt.CLASS_CLOSE_TOP="close-top",xt.CLASS_CLOSE_BOTTOM="close-bottom",xt.CLASS_DRAG="drag",xt.DEFAULT_WIDTH=245,xt.TEXT_CLOSED="Close Controls",xt.TEXT_OPEN="Open Controls",xt._keydownHandler=function(i){document.activeElement.type==="text"||i.which!==72&&i.keyCode!==72||xt.toggleHide()},oe.bind(window,"keydown",xt._keydownHandler,!1),_e.extend(xt.prototype,{add:function(i,e){return vc(this,i,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(i,e){return vc(this,i,e,{color:!0})},remove:function(i){this.__ul.removeChild(i.__li),this.__controllers.splice(this.__controllers.indexOf(i),1);var e=this;_e.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Co.removeChild(this.domElement);var i=this;_e.each(this.__folders,function(e){i.removeFolder(e)}),oe.unbind(window,"keydown",xt._keydownHandler,!1),By(this)},addFolder:function(i){if(this.__folders[i]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+i+'"');var e={name:i,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[i]&&(e.closed=this.load.folders[i].closed,e.load=this.load.folders[i]);var t=new xt(e);this.__folders[i]=t;var r=F0(this,t.domElement);return oe.addClass(r,"folder"),t},removeFolder:function(i){this.__ul.removeChild(i.domElement.parentElement),delete this.__folders[i.name],this.load&&this.load.folders&&this.load.folders[i.name]&&delete this.load.folders[i.name],By(i);var e=this;_e.each(i.__folders,function(t){i.removeFolder(t)}),_e.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var i=this.getRoot();if(i.scrollable){var e=oe.getOffset(i.__ul).top,t=0;_e.each(i.__ul.childNodes,function(r){i.autoPlace&&r===i.__save_row||(t+=oe.getHeight(r))}),window.innerHeight-e-20<t?(oe.addClass(i.domElement,xt.CLASS_TOO_TALL),i.__ul.style.height=window.innerHeight-e-20+"px"):(oe.removeClass(i.domElement,xt.CLASS_TOO_TALL),i.__ul.style.height="auto")}i.__resize_handle&&_e.defer(function(){i.__resize_handle.style.height=i.__ul.offsetHeight+"px"}),i.__closeButton&&(i.__closeButton.style.width=i.width+"px")},onResizeDebounced:_e.debounce(function(){this.onResize()},50),remember:function(){if(_e.isUndefined(wu)&&((wu=new TA).domElement.innerHTML=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`),this.parent)throw new Error("You can only call remember on a top level GUI.");var i=this;_e.each(Array.prototype.slice.call(arguments),function(e){i.__rememberedObjects.length===0&&function(t){var r=t.__save_row=document.createElement("li");oe.addClass(t.domElement,"has-save"),t.__ul.insertBefore(r,t.__ul.firstChild),oe.addClass(r,"save-row");var s=document.createElement("span");s.innerHTML="&nbsp;",oe.addClass(s,"button gears");var a=document.createElement("span");a.innerHTML="Save",oe.addClass(a,"button"),oe.addClass(a,"save");var n=document.createElement("span");n.innerHTML="New",oe.addClass(n,"button"),oe.addClass(n,"save-as");var o=document.createElement("span");o.innerHTML="Revert",oe.addClass(o,"button"),oe.addClass(o,"revert");var l=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?_e.each(t.load.remembered,function(d,p){km(t,p,p===t.preset)}):km(t,Wc,!1),oe.bind(l,"change",function(){for(var d=0;d<t.__preset_select.length;d++)t.__preset_select[d].innerHTML=t.__preset_select[d].value;t.preset=this.value}),r.appendChild(l),r.appendChild(s),r.appendChild(a),r.appendChild(n),r.appendChild(o),rc){var c=document.getElementById("dg-local-explain"),h=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block",localStorage.getItem(Po(t,"isLocal"))==="true"&&h.setAttribute("checked","checked"),Vy(t,c),oe.bind(h,"change",function(){t.useLocalStorage=!t.useLocalStorage,Vy(t,c)})}var u=document.getElementById("dg-new-constructor");oe.bind(u,"keydown",function(d){!d.metaKey||d.which!==67&&d.keyCode!==67||wu.hide()}),oe.bind(s,"click",function(){u.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),wu.show(),u.focus(),u.select()}),oe.bind(a,"click",function(){t.save()}),oe.bind(n,"click",function(){var d=prompt("Enter a new preset name.");d&&t.saveAs(d)}),oe.bind(o,"click",function(){t.revert()})}(i),i.__rememberedObjects.indexOf(e)===-1&&i.__rememberedObjects.push(e)}),this.autoPlace&&Tg(this,this.width)},getRoot:function(){for(var i=this;i.parent;)i=i.parent;return i},getSaveObject:function(){var i=this.load;return i.closed=this.closed,this.__rememberedObjects.length>0&&(i.preset=this.preset,i.remembered||(i.remembered={}),i.remembered[this.preset]=Su(this)),i.folders={},_e.each(this.__folders,function(e,t){i.folders[t]=e.getSaveObject()}),i},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Su(this),Sg(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(i){this.load.remembered||(this.load.remembered={},this.load.remembered[Wc]=Su(this,!0)),this.load.remembered[i]=Su(this),this.preset=i,km(this,i,!0),this.saveToLocalStorageIfPossible()},revert:function(i){_e.each(this.__controllers,function(e){this.getRoot().load.remembered?MM(i||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),_e.each(this.__folders,function(e){e.revert(e)}),i||Sg(this.getRoot(),!1)},listen:function(i){var e=this.__listening.length===0;this.__listening.push(i),e&&wM(this.__listening)},updateDisplay:function(){_e.each(this.__controllers,function(i){i.updateDisplay()}),_e.each(this.__folders,function(i){i.updateDisplay()})}});var oa=xt;let _c,Pd,Ds,Uo,Tu,Nn,ba=Object.getPrototypeOf,SM={isConnected:1},Hy={},CA=ba(SM),TM=ba(ba),EM=(i,e,t,r)=>(i??(setTimeout(t,r),new Set)).add(e),AM=(i,e,t)=>{let r=Ds;Ds=e;try{return i(t)}catch{return t}finally{Ds=r}},Rd=i=>i.filter(e=>{var t;return(t=e._dom)==null?void 0:t.isConnected}),CM=i=>Tu=EM(Tu,i,()=>{for(let e of Tu)e._bindings=Rd(e._bindings),e._listeners=Rd(e._listeners);Tu=Nn},1e3),Id={get val(){var i;return(i=Ds==null?void 0:Ds._getters)==null||i.add(this),this.rawVal},get oldVal(){var i;return(i=Ds==null?void 0:Ds._getters)==null||i.add(this),this._oldVal},set val(i){var e;(e=Ds==null?void 0:Ds._setters)==null||e.add(this),i!==this.rawVal&&(this.rawVal=i,this._bindings.length+this._listeners.length?(Pd==null||Pd.add(this),_c=EM(_c,this,RA)):this._oldVal=i)}},PM=i=>({__proto__:Id,rawVal:i,_oldVal:i,_bindings:[],_listeners:[]}),Xc=(i,e)=>{let t={_getters:new Set,_setters:new Set},r={f:i},s=Uo;Uo=[];let a=AM(i,t,e);a=(a??document).nodeType?a:new Text(a);for(let n of t._getters)t._setters.has(n)||(CM(n),n._bindings.push(r));for(let n of Uo)n._dom=a;return Uo=s,r._dom=a},z0=(i,e=PM(),t)=>{var r;let s={_getters:new Set,_setters:new Set},a={f:i,s:e};a._dom=(r=t??(Uo==null?void 0:Uo.push(a)))!=null?r:SM,e.val=AM(i,s,e.rawVal);for(let n of s._getters)s._setters.has(n)||(CM(n),n._listeners.push(a));return e},RM=(i,...e)=>{for(let t of e.flat(1/0)){let r=ba(t??0),s=r===Id?Xc(()=>t.val):r===TM?Xc(t):t;s!=Nn&&i.append(s)}return i},IM=(i,e,...t)=>{var r,s,a,n;let[o,...l]=ba((r=t[0])!=null?r:0)===CA?t:[{},...t],c=i?document.createElementNS(i,e):document.createElement(e);for(let[h,u]of Object.entries(o)){let d=v=>{var _;return v?(_=Object.getOwnPropertyDescriptor(v,h))!=null?_:d(ba(v)):Nn},p=e+","+h,f=(n=Hy[p])!=null?n:Hy[p]=(a=(s=d(ba(c)))==null?void 0:s.set)!=null?a:0,g=h.startsWith("on")?(v,_)=>{let y=h.slice(2);c.removeEventListener(y,_),c.addEventListener(y,v)}:f?f.bind(c):c.setAttribute.bind(c,h),m=ba(u??0);h.startsWith("on")||m===TM&&(u=z0(u),m=Id),m===Id?Xc(()=>(g(u.val,u._oldVal),c)):g(u)}return RM(c,...l)},Gy=i=>({get:(e,t)=>IM.bind(Nn,i,t)}),PA=new Proxy(i=>new Proxy(IM,Gy(i)),Gy()),LM=(i,e)=>e?e!==i&&i.replaceWith(e):i.remove(),RA=()=>{let i=0,e=[..._c].filter(r=>r.rawVal!==r._oldVal);do{Pd=new Set;for(let r of new Set(e.flatMap(s=>s._listeners=Rd(s._listeners))))z0(r.f,r.s,r._dom),r._dom=Nn}while(++i<100&&(e=[...Pd]).length);let t=[..._c].filter(r=>r.rawVal!==r._oldVal);_c=Nn;for(let r of new Set(t.flatMap(s=>s._bindings=Rd(s._bindings))))LM(r._dom,Xc(r.f,r._dom)),r._dom=Nn;for(let r of t)r._oldVal=r.rawVal};const Xe={add:RM,tags:PA,state:PM,derive:z0,hydrate:(i,e)=>LM(i,Xc(e,i))},{button:IA,div:Os,header:LA,input:BL,label:VL,span:DA,style:OA}=Xe.tags,ma=i=>Object.entries(i).map(([e,t])=>`${e}: ${t};`).join(""),NA=Object.getPrototypeOf(Xe.state(null)),Hl=i=>Object.getPrototypeOf(i??0)===NA?i:Xe.state(i);let UA=0;const kA=({activeTab:i,resultClass:e="",style:t="",tabButtonRowColor:r="#f1f1f1",tabButtonBorderStyle:s="1px solid #000",tabButtonHoverColor:a="#ddd",tabButtonActiveColor:n="#ccc",transitionSec:o=.3,tabButtonRowClass:l="",tabButtonRowStyleOverrides:c={},tabButtonClass:h="",tabButtonStyleOverrides:u={},tabContentClass:d="",tabContentStyleOverrides:p={}},f)=>{const g=i??Xe.state(Object.keys(f)[0]),m=ma(Re({overflow:"hidden","background-color":r},c)),v=ma(Re({float:"left",border:"none","border-right":s,outline:"none",cursor:"pointer",padding:"8px 16px",transition:`background-color ${o}s`},u)),_=ma(Re({padding:"6px 12px","border-top":"none"},p)),y="vanui-tabs-"+ ++UA;return document.head.appendChild(Xe.tags.style(`#${y} .vanui-tab-button { background-color: inherit }
#${y} .vanui-tab-button:hover { background-color: ${a} }
#${y} .vanui-tab-button.active { background-color: ${n} }`)),Os({id:y,class:e,style:t},Os({class:l,style:m},Object.keys(f).map(x=>IA({class:()=>["vanui-tab-button"].concat(h||[],x===g.val?"active":[]).join(" "),style:v,onclick:()=>g.val=x},x))),Object.entries(f).map(([x,b])=>Os({class:d,style:()=>`display: ${x===g.val?"block":"none"}; ${_}`},b)))};let FA=0;const Eg=()=>++FA,Ld=({title:i,closed:e=Xe.state(!1),x:t=100,y:r=100,width:s=300,height:a=200,closeCross:n="×",customStacking:o=!1,zIndex:l=1,disableMove:c=!1,disableResize:h=!1,headerColor:u="lightgray",windowClass:d="",windowStyleOverrides:p={},headerClass:f="",headerStyleOverrides:g={},childrenContainerClass:m="",childrenContainerStyleOverrides:v={},crossClass:_="",crossStyleOverrides:y={},crossHoverClass:x="",crossHoverStyleOverrides:b={}},...M)=>{const T=Hl(t),A=Hl(r),L=Hl(s),U=Hl(a),P=Hl(l);o||(P.val=Eg());const E=Xe.state(!1),I=Xe.state(null),S=Xe.state(0),V=Xe.state(0),J=Xe.state(0),X=Xe.state(0),te=x||Object.keys(b)?Xe.state(!1):null,ie=ae=>{ae.button===0&&(E.val=!0,S.val=ae.clientX,V.val=ae.clientY,document.body.style.userSelect="none")},fe=ae=>O=>{I.val=ae,S.val=O.clientX,V.val=O.clientY,J.val=L.val,X.val=U.val,document.body.style.userSelect="none"};document.addEventListener("mousemove",ae=>{if(E.val)T.val+=ae.clientX-S.val,A.val+=ae.clientY-V.val,S.val=ae.clientX,V.val=ae.clientY;else if(I.val){const O=ae.clientX-S.val,D=ae.clientY-V.val;I.val.includes("right")&&(L.val=J.val+O),I.val.includes("bottom")&&(U.val=X.val+D)}}),document.addEventListener("mouseup",()=>{E.val=!1,I.val=null,document.body.style.userSelect=""});const B="transparent";if(!document.getElementById("vanui-window-style")){const ae=OA({type:"text/css",id:"vanui-window-style"},(j={".vanui-window":{position:"fixed","background-color":"white",border:"1px solid black","border-radius":"0.5rem",overflow:"hidden"},".vanui-window-dragarea":{cursor:"move",position:"absolute",left:"0",top:"0",width:"100%",height:"1rem"},".vanui-window-resize-right":{cursor:"e-resize",position:"absolute",right:"0",top:"0",width:"10px",height:"100%","background-color":B},".vanui-window-resize-bottom":{cursor:"s-resize",position:"absolute",left:"0",bottom:"0",width:"100%",height:"10px","background-color":B},".vanui-window-resize-rightbottom":{cursor:"se-resize",position:"absolute",right:"0",bottom:"0",width:"10px",height:"10px","background-color":B},".vanui-window-header":{cursor:"move","user-select":"none",display:"flex","justify-content":"space-between","align-items":"center",padding:"0.5rem"},".vanui-window-cross":{cursor:"pointer","font-family":"Arial",transition:"background-color 0.3s, color 0.3s","border-radius":"50%",width:"24px",height:"24px",display:"flex","align-items":"center","justify-content":"center"},".vanui-window-cross:hover":{"background-color":"red",color:"white"},".vanui-window-children":{padding:"0.5rem"}},Object.entries(j).map(([O,D])=>`${O} { ${ma(D)} }`).join(`
`)));document.head.appendChild(ae)}var j;return()=>e.val?null:Os(Re({class:["vanui-window"].concat(d||[]).join(" "),style:()=>ma(Re({left:`${T.val}px`,top:`${A.val}px`,width:`${L.val}px`,height:`${U.val}px`,"z-index":P.val},p))},o?{}:{onmousedown:()=>P.val=Eg()}),i?LA(Re({class:["vanui-window-header"].concat(f||[]).join(" "),style:ma(Re(Re({"background-color":u},c?{cursor:"auto"}:{}),g))},c?{}:{onmousedown:ie}),i,n?DA(Re({class:()=>["vanui-window-cross"].concat(_||[]).concat(x&&te.val?x:[]).join(" "),style:()=>ma(Re(Re({},y),Object.keys(b).length&&te.val?b:{})),onclick:()=>e.val=!0},te?{onmouseenter:()=>te.val=!0,onmouseleave:()=>te.val=!1}:{}),n):null):c?null:Os({class:"vanui-window-dragarea",onmousedown:ie}),h?[]:[Os({class:"vanui-window-resize-right",onmousedown:fe("right")}),Os({class:"vanui-window-resize-bottom",onmousedown:fe("bottom")}),Os({class:"vanui-window-resize-rightbottom",onmousedown:fe("rightbottom")})],Os({class:["vanui-window-children"].concat(m||[]).join(" "),style:ma(v)},M))},{div:jy}=Xe.tags;let Fm=null;Array(100).fill().forEach(()=>Eg());const{style:zA}=Xe.tags;document.head.appendChild(zA(`.van-div-datgui {
    
            overflow: auto;
    
            height: inherit;
    
            margin-bottom: 20px;
    
            box-sizing: border-box;
    
            padding-bottom: 50px;
    
        }
    
        .van-div-datgui::-webkit-scrollbar {
    
            width: 0px;
    
            height: 0px;
            
        }`));const qc={windowStyleOverrides:{"background-color":"#1a1a1a",border:"1px solid #6f6f6f","border-radius":"3px","user-select":"none"},childrenContainerStyleOverrides:{height:"inherit"},headerStyleOverrides:{background:"#2c2c2c",padding:"3px 5px",color:"#ffffff","font-size":"13px"},crossStyleOverrides:{transition:"all 0.6s"},crossHoverStyleOverrides:{"background-color":"#ffc6c6"}};function B0(i){const{visible:e,color:t,opacity:r,transparent:s,wireframe:a,metalness:n,roughness:o}=i;return{visible:e,color:t,opacity:r,transparent:s,wireframe:a,metalness:n,roughness:o}}function V0(i,e){if(!e)return;const{visible:t,color:r,opacity:s,transparent:a,wireframe:n,metalness:o,roughness:l}=e;i.visible=t,i.wireframe=n,i.transparent=a,i.opacity=s,i.color.set(r),i.metalness!=null&&(i.metalness=o),i.roughness!=null&&(i.roughness=l)}function BA(i,e){Ys(i,e.addFolder("基础配置")),function(t,r){r.add({transparent:!1},"transparent").name("整体透明").onChange(s=>t.forEach(a=>a.transparent=s)),r.add({opacity:1},"opacity").min(0).max(1).name("整体透明度").onChange(s=>t.forEach(a=>a.opacity=s)),r.add({wireframe:!1},"wireframe").name("整体线框").onChange(s=>t.forEach(a=>a.wireframe=s)),r.addColor({color:16777215},"color").name("整体颜色").onChange(s=>t.forEach(a=>a.color.set(s))),r.add({metalness:0},"metalness").min(0).max(1).name("整体金属度").onChange(s=>t.forEach(a=>a.metalness!=null&&(a.metalness=s))),r.add({roughness:0},"roughness").min(0).max(1).name("整体粗糙度").onChange(s=>t.forEach(a=>a.roughness!=null&&(a.roughness=s))),r.addFn(()=>t.forEach(s=>s.needsUpdate=!0)).name("未变化手动更新")}(i.RootMaterials,e.addFolder("整体材质配置")),cM(i,e.addFolder("着色器配置"))}function VA(i,e,t){function r(s,a,n=""){a.type!=="ShaderMaterial"&&(function(o,l){l.add(o,"name").name("名称"),l.add(o,"visible").name("显示"),l.add(o,"wireframe").name("线框"),l.add(o,"transparent").name("透明"),l.add(o,"opacity",0,1).name("透明度"),l.addHexColor(o.color).name("颜色"),o.metalness!=null&&l.add(o,"metalness",0,1).name("金属度"),o.roughness!=null&&l.add(o,"roughness",0,1).name("粗糙度"),l.addFn(()=>o.needsUpdate=!0).name("未变化手动更新")}(a,s.addFolder("材质配置"+n)),a.isCustomTexture&&a.map&&(function(o,l){l.add(o,"wrapS",[bi,Kt,Da]).name("水平环绕方式").onChange(c=>o.needsUpdate=!0),l.add(o,"wrapT",[bi,Kt,Da]).name("垂直环绕方式").onChange(c=>o.needsUpdate=!0),l.add(o,"rotation").name("旋转").min(0).max(2*Math.PI),l.add(o.repeat,"x").name("x重复"),l.add(o.repeat,"y").name("y重复"),l.add(o.offset,"x").name("x偏移").min(0).max(1),l.add(o.offset,"y").name("y偏移").min(0).max(1),l.add(o.center,"x").name("x中心").min(0).max(1),l.add(o.center,"y").name("y中心").min(0).max(1)}(a.map,s.addFolder("贴图配置"+n)),function(o,l,c){Reflect.has(l,"textureAnimation")||(l.textureAnimation={isTextureAnimation:!1,offset:{x:0,y:0},rotation:0}),c.add(l.textureAnimation,"isTextureAnimation").name("贴图动画").onChange(h=>{if(h)l.commonAnimateRender=function(){l.offset.x+=l.textureAnimation.offset.x,l.offset.y+=l.textureAnimation.offset.y,l.rotation+=l.textureAnimation.rotation},o.push(l);else{delete l.commonAnimateRender;const u=o.findIndex(d=>d.uuid==l.uuid);u>-1&&o.splice(u,1)}}),c.add(l.textureAnimation,"rotation").name("旋转速度"),c.add(l.textureAnimation.offset,"x").name("x偏移速度"),c.add(l.textureAnimation.offset,"y").name("y偏移速度")}(i,a.map,s.addFolder("贴图动画"+n))))}Ys(e,t.addFolder("基础配置")),Array.isArray(e.material)?e.material.forEach((s,a)=>r(t,s,a)):r(t,e.material),e.disBlendShader||cM(e,t.addFolder("着色器配置"))}function HA(i,e){let t=null;i.removeCall=s=>{t===s&&(e.removeFolder(r),r=null)};let r=null;e.createSelectPanel=s=>{t=s,r&&(e.removeFolder(r),r=null),r=e.addFolder((s.isMesh?"[#]:":"[$]:")+s.name+"配置"),r.open(),s.RootMaterials?BA(s,r):s.isMesh&&VA(i.commonFrames,s,r),function(a,n={}){if(Fm&&!Fm.val)return;const o=Xe.tags.div({class:"van-div-datgui"});a.open();const l=`[${Date.now()}]`;o.appendChild(a.domElement);const c=Xe.state(n.width||"auto"),h=Xe.state(n.height||500),u=Xe.state(!1);Fm=u;const d=Ld(Re({title:l,closed:u,x:100,y:80,width:c,height:h},qc),o);Xe.add(document.body,d)}(e)}}function GA(){var i;oa.TEXT_CLOSED="收起场景配置",oa.TEXT_OPEN="展开场景配置",oa.prototype.addDateFolder=function(r){return this.addFolder(r+"["+Date.now()+"]")},oa.prototype.addDragFolder=function(r,...s){const a=this.addFolder(r+"["+Date.now()+"]");return a.vanFloatWindow=function(n,o={},l=()=>{}){const c=Xe.tags.div({class:o.class});n.open();const h=n.name;n.name="属性",c.appendChild(n.domElement);const u=Xe.state(o.width||"auto"),d=Xe.state(o.height||"auto"),p=Xe.state(!1);Xe.derive(()=>{if(p.val){const{parent:g}=n;delete g.__folders[h],g.load&&g.load.folders&&g.load.folders[h]&&delete g.load.folders[h],g.updateDisplay(),l()}});const f=Ld(Re({title:h,closed:p,x:100+600*Math.random(),y:50+400*Math.random(),width:u,height:d},qc),c);return Xe.add(document.body,f),{floatingWindow:f,el:c}}(a,...s),a},oa.prototype.addCoreDragFolder=function(r,...s){const a=this.addFolder(r+"["+Date.now()+"]");return a.vanFloatWindow=function(n,o={}){const l=Xe.tags.div({class:"van-div-datgui"});n.open();const c=n.name;n.name="管理",l.appendChild(n.domElement);const h=Xe.state(o.width||280),u=Xe.state(o.height||450),d=Xe.state(!1);Xe.derive(()=>{if(d.val){const{parent:f}=n;delete f.__folders[c],f.load&&f.load.folders&&f.load.folders[c]&&delete f.load.folders[c],f.updateDisplay()}});const p=Ld(Re({title:c,closed:d,x:60+400*Math.random(),y:90*Math.random(),width:h,height:u},qc),l);return Xe.add(document.body,p),{floatingWindow:p,el:l}}(a,...s),a},oa.prototype.addFn=function(r,...s){return this.add({fn:r},"fn",...s)},oa.prototype.addHexColor=function(r){return this.addColor({color:r.getHex()},"color").onChange(s=>r.set(s))};const e=new oa({autoPlace:!1});var t;return t=e,Object.defineProperty(t,"getAuthorization",{value:function(){return""},writable:!1,configurable:!1,enumerable:!1}),(i=e.__closeButton)==null||i.remove(),e}function DM(){return new Br(new C(0,-1,0),-.1)}function OM(i,e=20){return i.helper=new tb(i,e,16777215*Math.random()),i.helper}function Wy(i,e,t,r,s){return s.add(r,"constant").name("偏移"),s.add(r.normal,"x",-1,1),s.add(r.normal,"y",-1,1),s.add(r.normal,"z",-1,1),s.add({showHelper:!!r.helper},"showHelper").name("显示辅助线").onChange(a=>{a?(!r.helper&&OM(r,t.clipPlaneSize),i.add(r.helper)):r.helper&&i.remove(r.helper)}),s.addFn(()=>{r.helper&&i.remove(r.helper),e.clippingPlanes=e.clippingPlanes.filter(a=>a!==r),s.parent.removeFolder(s)}).name("删除"),s}function jA(i){return i.clippingPlanes.map(e=>({normal:{x:e.normal.x,y:e.normal.y,z:e.normal.z},constant:e.constant}))}const WA={No:cs,Linear:Yd,Reinhard:Zd,Cineon:Kd,ACESFilmic:Qd,AgX:$d,Custom:zg},XA={Basic:0,PCF:Gd,PCFSoft:Fg,VSM:kr};function qA(i,e){e&&(i.outputColorSpace=e.outputColorSpace,i.toneMapping=e.toneMapping,i.toneMappingExposure=e.toneMappingExposure,i.shadowMap.enabled=e.shadowMap.enabled,i.shadowMap.type=e.shadowMap.type,i.setClearColor(e.color,e.opacity),i.sortObjects=e.sortObjects,i.localClippingEnabled=e.localClippingEnabled,function(t,r){r&&(t.clippingPlanes=r.map(s=>{const a=DM();return a.normal.set(s.normal.x,s.normal.y,s.normal.z),a.constant=s.constant,a}))}(i,e.clippingPlanes))}function YA(i){if(i)return{colorSpace:i.colorSpace}}function ZA(i){if(i)return{name:i.name,type:i instanceof al?"linear":"exp2",density:i.density,color:i.color.getHex(),near:i.near,far:i.far}}function Ag(i,...e){return i==="linear"?new al(...e):new sl(...e)}function KA(i){const{background:e}=i;return{backgroundBlurriness:i.backgroundBlurriness,backgroundIntensity:i.backgroundIntensity,backgroundUrls:i.background&&i.backgroundUrls,envBackgroundUrls:i.envBackground&&i.envBackgroundUrls,fog:ZA(i.fog),environmentEnabled:i.environmentEnabled,background:YA(e)}}function QA(i,e){e&&(i.backgroundBlurriness=e.backgroundBlurriness,i.backgroundIntensity=e.backgroundIntensity,function(t,r){if(!r)return;const s=Ag(r.type);s.name=r.name,s.color.set(r.color),r.type==="linear"?(s.near=r.near,s.far=r.far):s.density=r.density,t.fog=s}(i,e.fog),i.environmentEnabled=e.environmentEnabled,e.backgroundUrls&&(i.backgroundLoadCallback=t=>function(r,s){s&&(r.colorSpace=s.colorSpace)}(t,e.background),i.setSceneBackground(e.backgroundUrls)),e.envBackgroundUrls&&i.setEnvBackground(e.envBackgroundUrls))}function $A(i,e){if(!e)return;(function(r,s){s.open();let a=null;const n={type:r.fog instanceof sl?"exp2":"linear",enable:!!r.fog};function o(l){a&&(s.removeFolder(a),a=null),r.fog&&(a=s.addFolder(l+"雾"),a.addHexColor(r.fog.color).name("颜色"),l==="linear"?(a.add(r.fog,"near").name("近点"),a.add(r.fog,"far").name("远点")):a.add(r.fog,"density").name("密度"))}s.add(n,"type",["linear","exp2"]).name("雾类型").onChange(l=>{var c;r.fog=Ag(l,(c=r.fog)==null?void 0:c.color),o(l)}),s.add(n,"enable").name("启用雾").onChange(l=>{r.fog=l?Ag(n.type):null,o(n.type)}),n.enable&&o(n.type)})(i,e.addFolder("雾配置")),e.add(i,"environmentEnabled").name("全局环境贴图").onChange(r=>i.environment=r?i.envBackground:null),e.add(i,"backgroundBlurriness",0,1).name("背景模糊度"),e.add(i,"backgroundIntensity",0).name("背景强度");let t=null;return e.addFn(()=>{t||(t=function(r,s){if(s.open(),r)return s.add(r,"colorSpace",[Mt,si]).name("色彩空间").onChange(()=>{r.dispose(),r.needsUpdate=!0}),s}(i.background,e.addFolder("背景配置")))}).name("加载背景参数"),e}function JA(i){return{mode:i.mode,space:i.space,size:i.size,showX:i.showX,showY:i.showY,showZ:i.showZ,translationSnap:i.translationSnap,rotationSnap:i.rotationSnap,scaleSnap:i.scaleSnap}}function eC(i){return{enabled:i.enabled,strength:i.strength,radius:i.radius,threshold:i.threshold}}function tC(i){return{enabled:i.enabled,edgeStrength:i.edgeStrength,edgeGlow:i.edgeGlow,edgeThickness:i.edgeThickness,pulsePeriod:i.pulsePeriod,usePatternTexture:i.usePatternTexture,visibleEdgeColor:i.visibleEdgeColor.getHex(),hiddenEdgeColor:i.hiddenEdgeColor.getHex(),overlayMaterial:(e=i.overlayMaterial,{blending:e.blending,blendEquation:e.blendEquation,blendSrc:e.blendSrc,blendDst:e.blendDst})};var e}function iC(i,e){return e.add(i,"enabled").name("轮廓光开启"),e.add(i,"edgeStrength").name("轮廓光强度"),e.add(i,"edgeGlow").name("轮廓光辉度"),e.add(i,"edgeThickness").name("轮廓光厚度"),e.add(i,"pulsePeriod").min(0).max(5).name("轮廓光脉冲周期"),e.add(i,"usePatternTexture").name("轮廓光纹理开启"),e.addHexColor(i.visibleEdgeColor).name("轮廓光颜色"),e.addHexColor(i.hiddenEdgeColor).name("轮廓光隐藏颜色"),function(t,r){r.open(),r.add(t,"blending",U0).name("混合模式").onChange(s=>t.blending=Number(s)),r.add(t,"blendEquation",iA).name("混合方程式").onChange(s=>t.blendingEquation=Number(s)),r.add(t,"blendSrc",rA).name("混合源").onChange(s=>t.blendingSrc=Number(s)),r.add(t,"blendDst",sA).name("混合目标").onChange(s=>t.blendingDst=Number(s))}(i.overlayMaterial,e.addFolder("边缘混合")),e}function rC(i){return{enabled:i.enabled,multPixel:i.multPixel}}function sC(i){if(!i)return;const{uniforms:e}=i;return{enabled:i.enabled,intensity:e.intensity.value,maskColor:e.maskColor.value.getHex(),R:e.R.value,sr:e.sr.value}}function aC(i){return{enabled:i.enabled,saoBias:i.params.saoBias,saoIntensity:i.params.saoIntensity,saoScale:i.params.saoScale,saoKernelRadius:i.params.saoKernelRadius,saoMinResolution:i.params.saoMinResolution,saoBlur:i.params.saoBlur,saoBlurRadius:i.params.saoBlurRadius,saoBlurStdDev:i.params.saoBlurStdDev,saoBlurDepthCutoff:i.params.saoBlurDepthCutoff}}function nC(i){return{enabled:i.enabled,maxDistance:i.maxDistance,distanceAttenuation:i.distanceAttenuation,opacity:i.opacity,thickness:i.thickness,fresnel:i.fresnel,infiniteThick:i.infiniteThick,bouncing:i.bouncing}}function oC(i){const{saoPass:e,unrealBloomPass:t,ssrPass:r,outlinePass:s,fxaaPass:a,screenMaskPass:n}=i.effectPass;return{renderWay:i.renderWay,saoPass:aC(e),unrealBloomPass:eC(t),ssrPass:nC(r),outlinePass:tC(s),fxaaPass:rC(a),screenMaskPass:sC(n)}}function lC(i,e,t,r,s,a){return{scene:KA(i),perspectiveCamera:(l=e,{fov:l.fov,near:l.near,far:l.far,zoom:l.zoom,layers:hM(l.layers),position:{x:l.position.x,y:l.position.y,z:l.position.z}}),webglRenderer:(o=t,{outputColorSpace:o.outputColorSpace,toneMapping:o.toneMapping,toneMappingExposure:o.toneMappingExposure,shadowMap:{enabled:o.shadowMap.enabled,type:o.shadowMap.type},color:o.getClearColor(new ve).getHex(),opacity:o.getClearAlpha(),sortObjects:o.sortObjects,localClippingEnabled:o.localClippingEnabled,clippingPlanes:jA(o)}),orbitControls:(n=r,{maxPolarAngle:n.maxPolarAngle,autoRotate:n.autoRotate,autoRotateSpeed:n.autoRotateSpeed,rotateSpeed:n.rotateSpeed,panSpeed:n.panSpeed,zoomSpeed:n.zoomSpeed,enableDamping:n.enableDamping,dampingFactor:n.dampingFactor,minDistance:n.minDistance,maxDistance:n.maxDistance,target:{x:n.target.x,y:n.target.y,z:n.target.z},viewAngleList:n.viewAngleList}),transformControls:JA(s),effectComposer:oC(a)};var n,o,l}function cC(i,e,t,r,s,a,n){n&&(qA(t,n.webglRenderer),function(o,l){if(!l)return;const{saoPass:c,unrealBloomPass:h,ssrPass:u,outlinePass:d,fxaaPass:p,screenMaskPass:f}=o.effectPass;o.setRenderWay(l.renderWay),function(g,m){m&&(g.enabled=m.enabled,g.params.saoBias=m.saoBias,g.params.saoIntensity=m.saoIntensity,g.params.saoScale=m.saoScale,g.params.saoKernelRadius=m.saoKernelRadius,g.params.saoMinResolution=m.saoMinResolution,g.params.saoBlur=m.saoBlur,g.params.saoBlurRadius=m.saoBlurRadius,g.params.saoBlurStdDev=m.saoBlurStdDev,g.params.saoBlurDepthCutoff=m.saoBlurDepthCutoff)}(c,l.saoPass),function(g,m){m&&(g.enabled=m.enabled,g.strength=m.strength,g.radius=m.radius,g.threshold=m.threshold)}(h,l.unrealBloomPass),function(g,m){m&&(g.enabled=m.enabled,g.maxDistance=m.maxDistance,g.distanceAttenuation=m.distanceAttenuation,g.opacity=m.opacity,g.thickness=m.thickness,g.fresnel=m.fresnel,g.infiniteThick=m.infiniteThick,g.bouncing=m.bouncing)}(u,l.ssrPass),function(g,m){m&&(g.enabled=m.enabled,g.edgeStrength=m.edgeStrength,g.edgeGlow=m.edgeGlow,g.edgeThickness=m.edgeThickness,g.pulsePeriod=m.pulsePeriod,g.usePatternTexture=m.usePatternTexture,g.visibleEdgeColor.setHex(m.visibleEdgeColor),g.hiddenEdgeColor.setHex(m.hiddenEdgeColor),function(v,_){_&&(v.blending=_.blending,v.blendEquation=_.blendEquation,v.blendSrc=_.blendSrc,v.blendDst=_.blendDst)}(g.overlayMaterial,m.overlayMaterial))}(d,l.outlinePass),function(g,m){m&&(g.enabled=m.enabled,g.multPixel!=m.multPixel&&(g.multPixel=m.multPixel,g.resize()))}(p,l.fxaaPass),function(g,m){if(!g)return;const{uniforms:v}=g;m&&(g.enabled=m.enabled,v.intensity.value=m.intensity,v.maskColor.value.set(m.maskColor),v.R.value=m.R,v.sr.value=m.sr)}(f,l.screenMaskPass)}(a,n.effectComposer),QA(i,n.scene),function(o,l){l&&(o.fov=l.fov,o.near=l.near,o.far=l.far,o.zoom=l.zoom,o.position.set(l.position.x,l.position.y,l.position.z),uM(o.layers,l.layers),o.updateProjectionMatrix())}(e,n.perspectiveCamera),function(o,l){l&&(o.maxPolarAngle=l.maxPolarAngle,o.autoRotate=l.autoRotate,o.autoRotateSpeed=l.autoRotateSpeed,o.rotateSpeed=l.rotateSpeed,o.panSpeed=l.panSpeed,o.zoomSpeed=l.zoomSpeed,o.enableDamping=l.enableDamping,o.dampingFactor=l.dampingFactor,o.minDistance=l.minDistance,o.maxDistance=l.maxDistance,o.target.set(l.target.x,l.target.y,l.target.z),o.viewAngleList=l.viewAngleList,o.update())}(r,n.orbitControls),function(o,l){l&&(o.mode=l.mode,o.space=l.space,o.size=l.size,o.showX=l.showX,o.showY=l.showY,o.showZ=l.showZ,o.translationSnap=l.translationSnap,o.rotationSnap=l.rotationSnap,o.scaleSnap=l.scaleSnap)}(s,n.transformControls))}function hC(i,e,t,r,s,a,n){const o={渲染器相关:()=>function(l,c){return c.addColor({color:l.getClearColor(new ve).getHex()},"color").onChange(h=>l.setClearColor(h,l.getClearAlpha())).name("渲染器背景色"),c.add({opacity:l.getClearAlpha()},"opacity").min(0).max(1).onChange(h=>l.setClearAlpha(h)).name("渲染器背景透明度"),c.add(l,"outputColorSpace",[Mt,si]).name("渲染器输出编码"),c.add(l,"toneMapping",WA).name("色调映射").onChange(h=>l.toneMapping=Number(h)),c.add(l,"toneMappingExposure").min(0).max(50).name("色调映射曝光度"),c.add(l.shadowMap,"enabled").name("阴影贴图"),c.add(l.shadowMap,"type",XA).name("阴影贴图类型").onChange(h=>l.shadowMap.type=Number(h)),c.add(l,"sortObjects").name("排序对象"),c.add(l,"localClippingEnabled").name("裁剪"),c}(t,n.addDragFolder("渲染器相关")),相机与视角:()=>function(l,c){const h=()=>l.updateProjectionMatrix();return dM(l.layers,c),c.add(l,"fov").min(0).name("视角").onChange(h),c.add(l,"near").min(.001).name("近平面").onChange(h),c.add(l,"far").min(0).name("远平面").onChange(h),c.add(l,"zoom").min(0).name("缩放").onChange(h),c.add(l.position,"x").name("相机位置x"),c.add(l.position,"y").name("相机位置y"),c.add(l.position,"z").name("相机位置z"),c}(e,n.addDragFolder("相机与视角")),轨道控制器:()=>function(l,c){return c.add(l,"autoRotate").name("自动旋转"),c.add(l,"autoRotateSpeed",0,10).name("自动旋转速度"),c.add(l,"enableDamping").name("阻尼"),c.add(l,"dampingFactor",0,1).name("阻尼系数"),c.add(l,"minDistance",0).name("最小距离"),c.add(l,"maxDistance",0).name("最大距离"),c.add(l,"maxPolarAngle",0,2*Math.PI).name("最大仰角"),c.add(l,"rotateSpeed").name("旋转速度"),c.add(l,"panSpeed").name("平移速度"),c.add(l,"zoomSpeed").name("缩放速度"),c.add(l.target,"x").name("目标位置x"),c.add(l.target,"y").name("目标位置y"),c.add(l.target,"z").name("目标位置z"),c}(r,n.addDragFolder("轨道控制器")),变换控制器:()=>function(l,c){return c.add(l,"mode",["translate","rotate","scale"]),c.add(l,"space",["local","world"]),c.add(l,"size"),c.add(l,"showX"),c.add(l,"showY"),c.add(l,"showZ"),!l.rotationSnap&&(l.rotationSnap=0),!l.translationSnap&&(l.translationSnap=0),!l.scaleSnap&&(l.scaleSnap=0),c.add(l,"translationSnap"),c.add(l,"rotationSnap"),c.add(l,"scaleSnap"),c}(s,n.addDragFolder("变换控制器")),环境效果:()=>$A(i,n.addDragFolder("环境与效果")),特效处理:()=>function(l,c){const{saoPass:h,unrealBloomPass:u,ssrPass:d,outlinePass:p,fxaaPass:f,screenMaskPass:g}=l.effectPass;c.add(l,"renderWay",["源渲染","效果渲染"]).name("渲染方式").onChange(v=>l.setRenderWay(v));const m={环境光遮蔽配置:()=>function(v,_){return _.add(v,"enabled").name("启用"),_.add(v.params,"saoBias").name("偏移"),_.add(v.params,"saoIntensity").name("强度"),_.add(v.params,"saoScale",0).name("缩放"),_.add(v.params,"saoKernelRadius",0).name("半径"),_.add(v.params,"saoMinResolution",0).name("最小分辨率"),_.add(v.params,"saoBlur").name("模糊"),_.add(v.params,"saoBlurRadius",0).name("模糊半径"),_.add(v.params,"saoBlurStdDev").name("模糊标准差"),_.add(v.params,"saoBlurDepthCutoff").name("模糊深度截断"),_}(h,c.addDragFolder("环境光遮蔽配置")),泛光配置:()=>function(v,_){return _.add(v,"enabled").name("泛光开启"),_.add(v,"strength").min(0).max(3).name("泛光强度"),_.add(v,"radius").min(0).max(1).name("泛光半径"),_.add(v,"threshold").min(0).max(1).name("泛光阈值"),_}(u,c.addDragFolder("泛光配置")),屏幕空间反射配置:()=>function(v,_){return _.add(v,"enabled").name("开启屏幕空间反射"),_.add(v,"maxDistance").name("最大距离"),_.add(v,"distanceAttenuation").name("距离衰减"),_.add(v,"opacity").name("透明度"),_.add(v,"thickness").name("厚度"),_.add(v,"fresnel").name("菲涅尔"),_.add(v,"infiniteThick").name("无限厚度"),_.add(v,"bouncing").name("反弹"),_}(d,c.addDragFolder("屏幕空间反射配置")),轮廓光配置:()=>iC(p,c.addDragFolder("轮廓光配置")),抗锯齿配置:()=>function(v,_){return _.add(v,"enabled").name("开启"),_.add(v,"multPixel").name("像素倍数").onChange(v.resize),_}(f,c.addDragFolder("抗锯齿配置")),屏幕遮罩配置:()=>function(v,_){const{uniforms:y}=v;return _.add(v,"enabled").name("启用"),_.addHexColor(y.maskColor.value).name("颜色"),_.add(y.intensity,"value").name("强度"),_.add(y.R,"value").name("半径"),_.add(y.sr,"value").name("sr参数"),_}(g,c.addDragFolder("屏幕遮罩配置"))};for(const v in m)c.add(m,v);return c.panels=m,c}(a,n.addDragFolder("特效与处理"))};for(const l in o)n.add(o,l);return{folder:n,panels:o}}function Xy(i,e){const{list:t,reList:r,index:s}=i;if(e==="z"){const a=t.at(s);a&&(Ed(a.object,a.transform),i.index-=1)}else if(e==="y"){if(s===-1)return;const a=r.at(s+1);a&&(Ed(a.object,a.transform),i.index+=1)}}function zm(i,e,t){if(!i.currentInfo||i.mode!=="变换")return;const{object:r}=i.transformControls;r.rotation[e]+=t*Math.PI/180}function Yc(i,e){e.axesHelper&&(i.remove(e.axesHelper),e.axesHelper.geometry.dispose(),e.axesHelper.material.dispose(),e.axesHelper=null),e.showAxes&&(e.axesHelper=function(t=1e3){const r=new ib(t);return r.name="AxesHelper",r}(e.axesLength),i.add(e.axesHelper))}function fa(i,e){e.gridHelper&&(i.remove(e.gridHelper),e.gridHelper.geometry.dispose(),e.gridHelper.material.dispose(),e.gridHelper=null),e.showGrid&&(e.gridHelper=function(t=1e3,r=15,s=4473924,a=8947848){const n=new Jx(t,r,s,a);return n.name="GridHelper",n}(e.size,e.divisions,e.colorCenterLine,e.colorGrid),i.add(e.gridHelper))}function Cg(i,e,t){e.box3Helper&&(i.remove(e.box3Helper),e.box3Helper.geometry.dispose(),e.box3Helper.material.dispose(),e.box3Helper=null),t.useBox3&&(e.box3Helper=function(r=16776960){const s=new Tt,a=new eb(s,r);return a.name="Box3Helper",a.visible=!1,a}(t.color),i.add(e.box3Helper),e.object&&(e.box3Helper.box=new Tt().setFromObject(e.object),e.box3Helper.visible=!0))}function uC(i){return{axes:(r=i.axes,{showAxes:r.showAxes,axesLength:r.axesLength}),grid:(t=i.grid,{showGrid:t.showGrid,size:t.size,divisions:t.divisions,colorCenterLine:t.colorCenterLine,colorGrid:t.colorGrid}),box3:(e=i.box3,{useBox3:e.useBox3,color:e.color})};var e,t,r}function dC(i,e,t,r){r&&(function(s,a,n){n&&(a.showAxes=n.showAxes,a.axesLength=n.axesLength,Yc(s,a))}(i,t.axes,r.axes),function(s,a,n){n&&(a.showGrid=n.showGrid,a.size=n.size,a.divisions=n.divisions,a.colorCenterLine=n.colorCenterLine,a.colorGrid=n.colorGrid,fa(s,a))}(i,t.grid,r.grid),function(s,a,n,o){o&&(n.useBox3=o.useBox3,n.color=o.color,Cg(s,a,n))}(i,e,t.box3,r.box3))}function pC(i,e,t,r){const{axes:s,grid:a,box3:n}=t;return function(o,l,c,h){h.open(),h.add(c,"useBox3").name("使用Box3").listen().onChange(()=>Cg(o,l,c)),h.addColor(c,"color").name("颜色").onFinishChange(()=>Cg(o,l,c))}(i,e,n,r.addFolder("Box3")),function(o,l,c){c.open(),c.add(l,"showGrid").name("显示网格").listen().onChange(()=>fa(o,l)),c.add(l,"size").name("大小").onFinishChange(()=>fa(o,l)).min(1),c.add(l,"divisions").name("分割数").onFinishChange(()=>fa(o,l)).min(1),c.addColor(l,"colorCenterLine").name("中心线颜色").onFinishChange(()=>fa(o,l)),c.addColor(l,"colorGrid").name("网格颜色").onFinishChange(()=>fa(o,l))}(i,a,r.addFolder("网格")),function(o,l,c){c.open(),c.add(l,"showAxes").name("显示坐标轴").listen().onChange(()=>Yc(o,l)),c.add(l,"axesLength").name("长度").onFinishChange(()=>Yc(o,l))}(i,s,r.addFolder("坐标轴")),r}function mC(i){const{showStats:e,statsMode:t}=i;return{showStats:e,statsMode:t}}function Dd(i){i.showStats?(i.created(),i.setMode(Number(i.statsMode))):i.destroy()}function fC(i,e,t,r,s){t.transformControls=r,t.outlinePass=s,t.stats=e,t.keyDown=function(a,n){function o(l,c){if(!n.object)return;const h=n.object;switch(n.mode){case"translate":h.position[l]+=c;break;case"scale":h.scale[l]+=.001*c*h.scale[l];break;case"rotate":h.rotation[l]+=c*Math.PI/360}}return function(l){var c,h,u;if(l.target.tagName!=="INPUT"&&!l.ctrlKey){switch(l.key){case"1":a.mode="选择";break;case"2":a.mode="根选择";break;case"3":a.mode="变换";break;case"4":a.mode="场景绘制";break;case"5":a.mode="点击信息";break;case"Tab":const{currentInfo:d}=a;d&&(a.mode==="选择"?n.attach(d.currentModel):a.mode==="根选择"?n.attach(d.currentRootModel):a.mode==="变换"&&(l.preventDefault(),l.shiftKey?n.setSpace(n.space==="local"?"world":"local"):(a.isTransformChildren=!a.isTransformChildren,n.detach())));break;case"Delete":if(!a.currentInfo)break;const{currentModel:p,currentRootModel:f}=a.currentInfo;if(a.mode==="选择"&&p)(p==null?void 0:p.parent.type)==="Scene"?p.parent.remove(p):p.visible=!1;else if(a.mode==="根选择"&&f)(c=f.parent)==null||c.remove(f);else if(a.mode==="变换"&&f&&!a.isTransformChildren){const g=n.object||f;(h=g.parent)==null||h.remove(g)}else a.mode==="变换"&&p&&a.isTransformChildren&&(p.visible=!1);break;case"g":n.setMode("translate");break;case"t":n.setMode("scale");break;case"r":n.setMode("rotate");break;case"w":o("y",1);break;case"s":o("y",-1);break;case"a":o("x",-1);break;case"d":o("x",1);break;case"q":o("z",1);break;case"e":o("z",-1);break;case"z":Xy(a.handlerHistory,"z");break;case"y":Xy(a.handlerHistory,"y");break;case"X":zm(a,"x",90);break;case"Y":zm(a,"y",90);break;case"Z":zm(a,"z",90);break;case"Escape":a.outlinePass.selectedObjects=[]}(u=a.keyDownCallback)==null||u.call(a,l.key)}}}(t,r),Yc(i,t.helpers.axes),fa(i,t.helpers.grid),t.keyDownCallback=()=>{},t.setHandlerOption=(a,n)=>{switch(a){case"stats":e.showStats=n,Dd(e);break;case"axes":t.helpers.axes.showAxes=n,Yc(i,t.helpers.axes);break;case"grid":t.helpers.grid.showGrid=n,fa(i,t.helpers.grid);break;case"openKey":t.openKey=n,H0(t.keyDown,n)}},t.handlerHistory=function(a){const n={list:[],reList:[],index:-1};return a.drag_change_callback=function(o){n.index=-1;const{list:l,reList:c}=n,{object:h}=a;o?l.push({object:h,transform:Oo(h)}):c.push({object:h,transform:Oo(h)})},n}(r)}function gC(i){const{mode:e,openKey:t,selectPanelEnable:r,isTransformChildren:s,stats:a,helpers:n}=i;return{mode:e,openKey:t,selectPanelEnable:r,isTransformChildren:s,stats:mC(a),helpers:uC(n)}}function vC(i,e,t,r,s){s&&(r.mode=s.mode,r.openKey=s.openKey,r.selectPanelEnable=s.selectPanelEnable,s.openKey&&H0(r.keyDown,s.openKey),r.isTransformChildren=s.isTransformChildren,function(a,n){if(!n)return;const{showStats:o,statsMode:l}=n;a.showStats=o,a.statsMode=l,Dd(a)}(t,s.stats),dC(i,e,r.helpers,s.helpers))}function _C(i,e,t,r,s){const{helpers:a}=r;s.add(r,"mode",r.modeList).name("模式").listen(),s.add(r,"isTransformChildren").name("子变换").listen(),s.add(r,"selectPanelEnable").name("选择弹窗").listen(),s.add(r,"openKey").name("开启按键").listen().onChange(o=>H0(r.keyDown,o));const n={同步控制:()=>function(o,l){const c=l.addFolder("旋转控制");c.open();const h={axies:"x",rotation:0,resetFn(){var m,v,_;(_=(v=(m=o.currentInfo)==null?void 0:m.currentRootModel)==null?void 0:v.rotation)==null||_.set(0,0,0)},setFn(){var m;(m=o.currentInfo)!=null&&m.currentRootModel&&(o.currentInfo.currentRootModel.rotation[this.axies]+=this.rotation/180*Math.PI)}};c.add(h,"axies",["x","y","z"]).name("旋转轴"),c.add(h,"rotation").name("旋转角度"),c.add(h,"resetFn").name("旋转归零"),c.add(h,"setFn").name("应用");const u=l.addFolder("记录信息"),d={recordModel:null,recordFn(){var m;for(this.recordModel=(m=o.currentInfo)==null?void 0:m.currentRootModel;u.__controllers.length>0;)u.__controllers[0].remove();this.recordModel&&(u.open(),u.add(this.recordModel,"visible").name("显示"),u.add(this.recordModel,"name").name("模型名称"),u.add(this.recordModel,"id").name("模型id"),u.addFn(()=>{var v;return(v=o.currentInfo)==null?void 0:v.currentRootModel.position.copy(this.recordModel.position)}).name("选中模型位置与记录同步"),u.addFn(()=>{var v;return(v=o.currentInfo)==null?void 0:v.currentRootModel.rotation.copy(this.recordModel.rotation)}).name("选中模型旋转与记录同步"),u.addFn(()=>{var v;return(v=o.currentInfo)==null?void 0:v.currentRootModel.scale.copy(this.recordModel.scale)}).name("选中模型缩放与记录同步"))},syncTransformList:[],syncTransformFn(){var m;if((m=o.currentInfo)!=null&&m.currentRootModel&&this.syncTransformList.indexOf(o.currentInfo.currentRootModel)===-1){p.open();const v=o.currentInfo.currentRootModel;this.syncTransformList.push(v);const _=p.addDateFolder(v.id);_.add(v,"visible").name("显示"),_.addFn(()=>{const y=this.syncTransformList.indexOf(v);y>-1&&this.syncTransformList.splice(y,1),p.removeFolder(_)}).name("移除同步变换列表")}}};l.add(d,"recordFn").name("#记录根选择模型信息");const p=l.addFolder("同步变换列表");l.add(d,"syncTransformFn").name("#加入同步变换列表");const f=p.addFolder("列表变换同步操作"),g={position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:0,y:0,z:0},oldPosition:{x:0,y:0,z:0},oldRotation:{x:0,y:0,z:0},oldScale:{x:0,y:0,z:0}};return["x","y","z"].forEach(m=>f.add(g.position,m).name("位置"+m).onChange(v=>{d.syncTransformList.forEach(_=>_.position[m]+=v-g.oldPosition[m]),g.oldPosition[m]=v})),["x","y","z"].forEach(m=>f.add(g.rotation,m,-2*Math.PI,2*Math.PI).name("旋转"+m).onChange(v=>{d.syncTransformList.forEach(_=>_.rotation[m]+=v-g.oldRotation[m]),g.oldRotation[m]=v})),["x","y","z"].forEach(m=>f.add(g.scale,m).step(.01).name("缩放"+m).onChange(v=>{d.syncTransformList.forEach(_=>_.scale[m]+=_.scale[m]*(v-g.oldScale[m])),g.oldScale[m]=v})),l}(r,s.addDragFolder("同步控制")),性能监控:()=>function(o,l){return l.add(o,"showStats").name("开启").listen().onChange(()=>Dd(o)),l.add(o,"statsMode",{fps:0,ms:1,mb:2}).name("模式").listen().onChange(()=>Dd(o)),l}(t,s.addDragFolder("性能监控")),辅助工具:()=>pC(i,e,a,s.addDragFolder("辅助工具"))};for(const o in n)s.add(n,o);return{folder:s,panels:n}}function H0(i,e){e?document.addEventListener("keydown",i):document.removeEventListener("keydown",i)}function yC(i){if(!i)return;const{camera:e}=i;return{bias:i.bias,radius:i.radius,mapSize:i.mapSize,normalBias:i.normalBias,camera:e?{near:e.near,far:e.far,fov:e.fov,left:e.left,right:e.right,top:e.top,bottom:e.bottom}:null}}function xC(i){switch(i.type){case"DirectionalLight":return{target:{x:i.target.position.x,y:i.target.position.y,z:i.target.position.z}};case"PointLight":return{distance:i.distance,decay:i.decay,power:i.power};case"SpotLight":return{distance:i.distance,decay:i.decay,power:i.power,angle:i.angle,penumbra:i.penumbra};case"HemisphereLight":return{groundColor:i.groundColor};case"RectAreaLight":return{width:i.width,height:i.height,rotation:{x:i.rotation.x,y:i.rotation.y,z:i.rotation.z}}}}function G0(i,e={}){let t=null;switch(i){case"AmbientLight":default:t=bC(e);break;case"DirectionalLight":t=function(r={}){return new Uc(r.color||16777215,r.intensity||1)}(e);break;case"PointLight":t=function(r={}){return new hl(r.color||16777215,r.intensity||1,r.distance||0,r.decay||0)}(e);break;case"SpotLight":t=function(r={}){return new Nc(r.color||16777215,r.intensity||1,r.distance||0,r.angle||Math.PI/3,r.penumbra||0,r.decay||0)}(e);break;case"HemisphereLight":t=function(r={}){return new ig(r.color||16777215,r.groundColor||0,r.intensity||1)}(e);break;case"RectAreaLight":t=function(r={}){return new rg(r.color||16777215,r.intensity||1,r.width||100,r.height||100)}(e)}return t}function bC(i={}){return new fd(i.color||16777215,i.intensity||1)}function MC(i,e){e&&(i.name=e.name,i.visible=e.visible,i.color.set(e.color),i.intensity=e.intensity,i.castShadow=e.castShadow,i.position.set(e.position.x,e.position.y,e.position.z),function(t,r){if(!r)return;t.bias=r.bias,t.radius=r.radius,t.mapSize.set(r.mapSize.x,r.mapSize.y),t.normalBias=r.normalBias;const{camera:s}=r;s&&t.camera&&(Object.keys(s).forEach(a=>t.camera[a]=s[a]),t.camera.updateProjectionMatrix())}(i.shadow,e.shadow),function(t,r){if(r)switch(t.type){case"DirectionalLight":t.target.position.set(r.target.x,r.target.y,r.target.z);break;case"PointLight":t.distance=r.distance,t.decay=r.decay,t.power=r.power;break;case"SpotLight":t.distance=r.distance,t.decay=r.decay,t.power=r.power,t.angle=r.angle,t.penumbra=r.penumbra;break;case"HemisphereLight":t.groundColor.set(r.groundColor);break;case"RectAreaLight":t.width=r.width,t.height=r.height,t.rotation.set(r.rotation.x,r.rotation.y,r.rotation.z)}}(i,e))}function qy(i,e,t){if(e.add(i,"visible").name("可见性"),e.add(i,"name").name("名称"),e.addHexColor(i.color).name("颜色"),e.add(i,"intensity").name("强度"),e.addFn(()=>t.attach(i)).name("拖拽控制"),e.addFn(()=>{const a=i.parent;i.target&&a.remove(i.target),a.remove(i),i.dispose(),e.parent.removeFolder(e)}).name("删除"),i.shadow){e.add(i,"castShadow").name("投影");const a=e.addFolder("阴影配置");(function(n,o){o.add(n,"bias").name("偏移"),o.add(n,"radius").name("半径"),o.add(n,"normalBias").name("法线偏移"),o.add(n.mapSize,"width").name("阴影贴图宽度"),o.add(n.mapSize,"height").name("阴影贴图高度");const l=o.addFolder("投影相机"),c=()=>n.camera.updateProjectionMatrix();l.add(n.camera,"near").name("近平面").onChange(c),l.add(n.camera,"far").name("远平面").onChange(c),n.camera.isOrthographicCamera?(l.add(n.camera,"left").name("左平面").onChange(c),l.add(n.camera,"right").name("右平面").onChange(c),l.add(n.camera,"top").name("上平面").onChange(c),l.add(n.camera,"bottom").name("下平面").onChange(c)):l.add(n.camera,"fov").name("视角").onChange(c)})(i.shadow,a)}const r=e.addFolder("变换配置");r.add(i.position,"x").name("位置X"),r.add(i.position,"y").name("位置y"),r.add(i.position,"z").name("位置z");const s=e.addFolder("特定配置");(function(a,n,o){switch(n.type){case"DirectionalLight":o.add(n.target.position,"x").name("目标X").listen(),o.add(n.target.position,"y").name("目标Y").listen(),o.add(n.target.position,"z").name("目标Z").listen(),o.addFn(()=>a.attach(n.target)).name("拖拽目标");break;case"PointLight":o.add(n,"distance").name("距离"),o.add(n,"decay").name("衰减"),o.add(n,"power").name("功率");break;case"SpotLight":o.add(n,"distance").name("距离"),o.add(n,"decay").name("衰减"),o.add(n,"power").name("功率"),o.add(n,"angle").name("角度"),o.add(n,"penumbra").name("边缘");break;case"HemisphereLight":o.addHexColor(n.groundColor).name("基色");break;case"RectAreaLight":o.add(n.rotation,"x").name("旋转X").min(-Math.PI/2).max(Math.PI/2),o.add(n.rotation,"y").name("旋转y").min(-Math.PI/2).max(Math.PI/2),o.add(n.rotation,"z").name("旋转z").min(-Math.PI/2).max(Math.PI/2),o.add(n,"width").name("宽度"),o.add(n,"height").name("高度")}})(t,i,s)}function wC(i){return i.map(e=>function(t){const{name:r,type:s,visible:a,position:n,color:o,intensity:l,castShadow:c,shadow:h}=t;return Re({name:r,type:s,visible:a,position:n,color:o,intensity:l,castShadow:c,shadow:yC(h)},xC(t))}(e))}var Mr=Uint8Array,yc=Uint16Array,SC=Int32Array,NM=new Mr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),UM=new Mr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),TC=new Mr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kM=function(i,e){for(var t=new yc(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];var s=new SC(t[30]);for(r=1;r<30;++r)for(var a=t[r];a<t[r+1];++a)s[a]=a-t[r]<<5|r;return{b:t,r:s}},FM=kM(NM,2),zM=FM.b,EC=FM.r;zM[28]=258,EC[258]=28;for(var AC=kM(UM,0).b,BM=new yc(32768),St=0;St<32768;++St){var ln=(43690&St)>>1|(21845&St)<<1;ln=(61680&(ln=(52428&ln)>>2|(13107&ln)<<2))>>4|(3855&ln)<<4,BM[St]=((65280&ln)>>8|(255&ln)<<8)>>1}var xc=function(i,e,t){for(var r=i.length,s=0,a=new yc(e);s<r;++s)i[s]&&++a[i[s]-1];var n,o=new yc(e);for(s=1;s<e;++s)o[s]=o[s-1]+a[s-1]<<1;{n=new yc(1<<e);var l=15-e;for(s=0;s<r;++s)if(i[s])for(var c=s<<4|i[s],h=e-i[s],u=o[i[s]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)n[BM[u]>>l]=c}return n},gh=new Mr(288);for(St=0;St<144;++St)gh[St]=8;for(St=144;St<256;++St)gh[St]=9;for(St=256;St<280;++St)gh[St]=7;for(St=280;St<288;++St)gh[St]=8;var VM=new Mr(32);for(St=0;St<32;++St)VM[St]=5;var CC=xc(gh,9),PC=xc(VM,5),Bm=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},Nr=function(i,e,t){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(7&e)&t},Vm=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(7&e)},RC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Fr=function(i,e,t){var r=new Error(e||RC[i]);if(r.code=i,Error.captureStackTrace&&Error.captureStackTrace(r,Fr),!t)throw r;return r},IC=function(i,e,t,r){var s=i.length;if(!s||e.f&&!e.l)return t||new Mr(0);var a=!t,n=a||e.i!=2,o=e.i;a&&(t=new Mr(3*s));var l=function($){var k=t.length;if($>k){var Q=new Mr(Math.max(2*k,$));Q.set(t),t=Q}},c=e.f||0,h=e.p||0,u=e.b||0,d=e.l,p=e.d,f=e.m,g=e.n,m=8*s;do{if(!d){c=Nr(i,h,1);var v=Nr(i,h+1,3);if(h+=3,!v){var _=i[(I=4+((h+7)/8|0))-4]|i[I-3]<<8,y=I+_;if(y>s){o&&Fr(0);break}n&&l(u+_),t.set(i.subarray(I,y),u),e.b=u+=_,e.p=h=8*y,e.f=c;continue}if(v==1)d=CC,p=PC,f=9,g=5;else if(v==2){var x=Nr(i,h,31)+257,b=Nr(i,h+10,15)+4,M=x+Nr(i,h+5,31)+1;h+=14;for(var T=new Mr(M),A=new Mr(19),L=0;L<b;++L)A[TC[L]]=Nr(i,h+3*L,7);h+=3*b;var U=Bm(A),P=(1<<U)-1,E=xc(A,U);for(L=0;L<M;){var I,S=E[Nr(i,h,P)];if(h+=15&S,(I=S>>4)<16)T[L++]=I;else{var V=0,J=0;for(I==16?(J=3+Nr(i,h,3),h+=2,V=T[L-1]):I==17?(J=3+Nr(i,h,7),h+=3):I==18&&(J=11+Nr(i,h,127),h+=7);J--;)T[L++]=V}}var X=T.subarray(0,x),te=T.subarray(x);f=Bm(X),g=Bm(te),d=xc(X,f),p=xc(te,g)}else Fr(1);if(h>m){o&&Fr(0);break}}n&&l(u+131072);for(var ie=(1<<f)-1,fe=(1<<g)-1,B=h;;B=h){var j=(V=d[Vm(i,h)&ie])>>4;if((h+=15&V)>m){o&&Fr(0);break}if(V||Fr(2),j<256)t[u++]=j;else{if(j==256){B=h,d=null;break}var ae=j-254;if(j>264){var O=NM[L=j-257];ae=Nr(i,h,(1<<O)-1)+zM[L],h+=O}var D=p[Vm(i,h)&fe],ee=D>>4;if(D||Fr(3),h+=15&D,te=AC[ee],ee>3&&(O=UM[ee],te+=Vm(i,h)&(1<<O)-1,h+=O),h>m){o&&Fr(0);break}n&&l(u+131072);var ne=u+ae;if(u<te){var K=0-te,W=Math.min(te,ne);for(K+u<0&&Fr(3);u<W;++u)t[u]=r[K+u]}for(;u<ne;++u)t[u]=t[u-te]}}e.l=d,e.p=B,e.b=u,e.f=c,d&&(c=1,e.m=f,e.d=p,e.n=g)}while(!c);return u!=t.length&&a?function($,k,Q){return(Q==null||Q>$.length)&&(Q=$.length),new Mr($.subarray(k,Q))}(t,0,u):t.subarray(0,u)},LC=new Mr(0);function DC(i,e){return IC(i.subarray((r=e,((15&(t=i)[0])!=8||t[0]>>4>7||(t[0]<<8|t[1])%31)&&Fr(6,"invalid zlib data"),(t[1]>>5&1)==+!r&&Fr(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)),-4),{i:2},e,e);var t,r}var OC=typeof TextDecoder<"u"&&new TextDecoder;try{OC.decode(LC,{stream:!0})}catch{}function HM(i,e,t){const r=t.length-i-1;if(e>=t[r])return r-1;if(e<=t[i])return i;let s=i,a=r,n=Math.floor((s+a)/2);for(;e<t[n]||e>=t[n+1];)e<t[n]?a=n:s=n,n=Math.floor((s+a)/2);return n}function NC(i,e){let t=1;for(let s=2;s<=i;++s)t*=s;let r=1;for(let s=2;s<=e;++s)r*=s;for(let s=2;s<=i-e;++s)r*=s;return t/r}function UC(i,e,t,r,s){const a=function(n,o,l,c,h){const u=h<n?h:n,d=[],p=HM(n,c,o),f=function(m,v,_,y,x){const b=[];for(let P=0;P<=_;++P)b[P]=0;const M=[];for(let P=0;P<=y;++P)M[P]=b.slice(0);const T=[];for(let P=0;P<=_;++P)T[P]=b.slice(0);T[0][0]=1;const A=b.slice(0),L=b.slice(0);for(let P=1;P<=_;++P){A[P]=v-x[m+1-P],L[P]=x[m+P]-v;let E=0;for(let I=0;I<P;++I){const S=L[I+1],V=A[P-I];T[P][I]=S+V;const J=T[I][P-1]/T[P][I];T[I][P]=E+S*J,E=V*J}T[P][P]=E}for(let P=0;P<=_;++P)M[0][P]=T[P][_];for(let P=0;P<=_;++P){let E=0,I=1;const S=[];for(let V=0;V<=_;++V)S[V]=b.slice(0);S[0][0]=1;for(let V=1;V<=y;++V){let J=0;const X=P-V,te=_-V;P>=V&&(S[I][0]=S[E][0]/T[te+1][X],J=S[I][0]*T[X][te]);const ie=P-1<=te?V-1:_-P;for(let B=X>=-1?1:-X;B<=ie;++B)S[I][B]=(S[E][B]-S[E][B-1])/T[te+1][X+B],J+=S[I][B]*T[X+B][te];P<=te&&(S[I][V]=-S[E][V-1]/T[te+1][P],J+=S[I][V]*T[P][te]),M[V][P]=J;const fe=E;E=I,I=fe}}let U=_;for(let P=1;P<=y;++P){for(let E=0;E<=_;++E)M[P][E]*=U;U*=_-P}return M}(p,c,n,u,o),g=[];for(let m=0;m<l.length;++m){const v=l[m].clone(),_=v.w;v.x*=_,v.y*=_,v.z*=_,g[m]=v}for(let m=0;m<=u;++m){const v=g[p-n].clone().multiplyScalar(f[m][0]);for(let _=1;_<=n;++_)v.add(g[p-n+_].clone().multiplyScalar(f[m][_]));d[m]=v}for(let m=u+1;m<=h+1;++m)d[m]=new qe(0,0,0);return d}(i,e,t,r,s);return function(n){const o=n.length,l=[],c=[];for(let u=0;u<o;++u){const d=n[u];l[u]=new C(d.x,d.y,d.z),c[u]=d.w}const h=[];for(let u=0;u<o;++u){const d=l[u].clone();for(let p=1;p<=u;++p)d.sub(h[u-p].clone().multiplyScalar(NC(u,p)*c[p]));h[u]=d.divideScalar(c[0])}return h}(a)}class kC extends Cr{constructor(e,t,r,s,a){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=s||0,this.endKnot=a||this.knots.length-1;for(let n=0;n<r.length;++n){const o=r[n];this.controlPoints[n]=new qe(o.x,o.y,o.z,o.w)}}getPoint(e,t=new C){const r=t,s=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=function(n,o,l,c){const h=HM(n,c,o),u=function(p,f,g,m){const v=[],_=[],y=[];v[0]=1;for(let x=1;x<=g;++x){_[x]=f-m[p+1-x],y[x]=m[p+x]-f;let b=0;for(let M=0;M<x;++M){const T=y[M+1],A=_[x-M],L=v[M]/(T+A);v[M]=b+T*L,b=A*L}v[x]=b}return v}(h,c,n,o),d=new qe(0,0,0,0);for(let p=0;p<=n;++p){const f=l[h-n+p],g=u[p],m=f.w*g;d.x+=f.x*m,d.y+=f.y*m,d.z+=f.z*m,d.w+=f.w*g}return d}(this.degree,this.knots,this.controlPoints,s);return a.w!==1&&a.divideScalar(a.w),r.set(a.x,a.y,a.z)}getTangent(e,t=new C){const r=t,s=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=UC(this.degree,this.knots,this.controlPoints,s,1);return r.copy(a[1]).normalize(),r}}let We,jt,Ni;class FC extends Bt{constructor(e){super(e)}load(e,t,r,s){const a=this,n=a.path===""?ds.extractUrlBase(e):a.path,o=new xi(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(l){try{t(a.parse(l,n))}catch(c){s&&s(c),a.manager.itemError(e)}},r,s)}parse(e,t){if(function(s){const a="Kaydara FBX Binary  \0";return s.byteLength>=a.length&&a===Ky(s,0,a.length)}(e))We=new GC().parse(e);else{const s=Ky(e);if(!function(a){const n=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let o=0;function l(c){const h=a[c-1];return a=a.slice(o+c),o++,h}for(let c=0;c<n.length;++c)if(l(1)===n[c])return!1;return!0}(s))throw new Error("THREE.FBXLoader: Unknown format.");if(Zy(s)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Zy(s));We=new HC().parse(s)}const r=new gs(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new zC(r,this.manager).parse(We)}}class zC{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){jt=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),s=this.parseDeformers(),a=new BC().parse(s);return this.parseScene(s,a,r),Ni}parseConnections(){const e=new Map;return"Connections"in We&&We.Connections.connections.forEach(function(t){const r=t[0],s=t[1],a=t[2];e.has(r)||e.set(r,{parents:[],children:[]});const n={ID:s,relationship:a};e.get(r).parents.push(n),e.has(s)||e.set(s,{parents:[],children:[]});const o={ID:r,relationship:a};e.get(s).children.push(o)}),e}parseImages(){const e={},t={};if("Video"in We.Objects){const r=We.Objects.Video;for(const s in r){const a=r[s];if(e[parseInt(s)]=a.RelativeFilename||a.Filename,"Content"in a){const n=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,o=typeof a.Content=="string"&&a.Content!=="";if(n||o){const l=this.parseImage(r[s]);t[a.RelativeFilename||a.Filename]=l}}}}for(const r in e){const s=e[r];t[s]!==void 0?e[r]=t[s]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){const t=e.Content,r=e.RelativeFilename||e.Filename;let s;switch(r.slice(r.lastIndexOf(".")+1).toLowerCase()){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga"),s="image/tga";break;default:return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in We.Objects){const r=We.Objects.Texture;for(const s in r){const a=this.parseTexture(r[s],e);t.set(parseInt(s),a)}}return t}parseTexture(e,t){const r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;const s=e.WrapModeU,a=e.WrapModeV,n=s!==void 0?s.value:0,o=a!==void 0?a.value:0;if(r.wrapS=n===0?Kt:bi,r.wrapT=o===0?Kt:bi,"Scaling"in e){const l=e.Scaling.value;r.repeat.x=l[0],r.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;r.offset.x=l[0],r.offset.y=l[1]}return r}loadTexture(e,t){let r;const s=this.textureLoader.path,a=jt.get(e.id).children;let n;a!==void 0&&a.length>0&&t[a[0].ID]!==void 0&&(r=t[a[0].ID],r.indexOf("blob:")!==0&&r.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const o=e.FileName.slice(-3).toLowerCase();if(o==="tga"){const l=this.manager.getHandler(".tga");l===null?n=new yt:(l.setPath(this.textureLoader.path),n=l.load(r))}else if(o==="dds"){const l=this.manager.getHandler(".dds");l===null?n=new yt:(l.setPath(this.textureLoader.path),n=l.load(r))}else n=o==="psd"?new yt:this.textureLoader.load(r);return this.textureLoader.setPath(s),n}parseMaterials(e){const t=new Map;if("Material"in We.Objects){const r=We.Objects.Material;for(const s in r){const a=this.parseMaterial(r[s],e);a!==null&&t.set(parseInt(s),a)}}return t}parseMaterial(e,t){const r=e.id,s=e.attrName;let a=e.ShadingModel;if(typeof a=="object"&&(a=a.value),!jt.has(r))return null;const n=this.parseParameters(e,t,r);let o;switch(a.toLowerCase()){case"phong":default:o=new Xn;break;case"lambert":o=new vp}return o.setValues(n),o.name=s,o}parseParameters(e,t,r){const s={};e.BumpFactor&&(s.bumpScale=e.BumpFactor.value),e.Diffuse?s.color=new ve().fromArray(e.Diffuse.value).convertSRGBToLinear():!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(s.color=new ve().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(s.displacementScale=e.DisplacementFactor.value),e.Emissive?s.emissive=new ve().fromArray(e.Emissive.value).convertSRGBToLinear():!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(s.emissive=new ve().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(s.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(s.opacity=parseFloat(e.Opacity.value)),s.opacity<1&&(s.transparent=!0),e.ReflectionFactor&&(s.reflectivity=e.ReflectionFactor.value),e.Shininess&&(s.shininess=e.Shininess.value),e.Specular?s.specular=new ve().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(s.specular=new ve().fromArray(e.SpecularColor.value).convertSRGBToLinear());const a=this;return jt.get(r).children.forEach(function(n){switch(n.relationship){case"Bump":s.bumpMap=a.getTexture(t,n.ID);break;case"Maya|TEX_ao_map":s.aoMap=a.getTexture(t,n.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":s.map=a.getTexture(t,n.ID),s.map!==void 0&&(s.map.colorSpace=Mt);break;case"DisplacementColor":s.displacementMap=a.getTexture(t,n.ID);break;case"EmissiveColor":s.emissiveMap=a.getTexture(t,n.ID),s.emissiveMap!==void 0&&(s.emissiveMap.colorSpace=Mt);break;case"NormalMap":case"Maya|TEX_normal_map":s.normalMap=a.getTexture(t,n.ID);break;case"ReflectionColor":s.envMap=a.getTexture(t,n.ID),s.envMap!==void 0&&(s.envMap.mapping=el,s.envMap.colorSpace=Mt);break;case"SpecularColor":s.specularMap=a.getTexture(t,n.ID),s.specularMap!==void 0&&(s.specularMap.colorSpace=Mt);break;case"TransparentColor":case"TransparencyFactor":s.alphaMap=a.getTexture(t,n.ID),s.transparent=!0}}),s}getTexture(e,t){return"LayeredTexture"in We.Objects&&t in We.Objects.LayeredTexture&&(t=jt.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in We.Objects){const r=We.Objects.Deformer;for(const s in r){const a=r[s],n=jt.get(parseInt(s));if(a.attrType==="Skin"){const o=this.parseSkeleton(n,r);o.ID=s,n.parents.length,o.geometryID=n.parents[0].ID,e[s]=o}else if(a.attrType==="BlendShape"){const o={id:s};o.rawTargets=this.parseMorphTargets(n,r),o.id=s,n.parents.length,t[s]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const r=[];return e.children.forEach(function(s){const a=t[s.ID];if(a.attrType!=="Cluster")return;const n={ID:s.ID,indices:[],weights:[],transformLink:new Me().fromArray(a.TransformLink.a)};"Indexes"in a&&(n.indices=a.Indexes.a,n.weights=a.Weights.a),r.push(n)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){const r=[];for(let s=0;s<e.children.length;s++){const a=e.children[s],n=t[a.ID],o={name:n.attrName,initialWeight:n.DeformPercent,id:n.id,fullWeights:n.FullWeights.a};if(n.attrType!=="BlendShapeChannel")return;o.geoID=jt.get(parseInt(a.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,r.push(o)}return r}parseScene(e,t,r){Ni=new Mi;const s=this.parseModels(e.skeletons,t,r),a=We.Objects.Model,n=this;s.forEach(function(l){const c=a[l.ID];n.setLookAtProperties(l,c),jt.get(l.ID).parents.forEach(function(h){const u=s.get(h.ID);u!==void 0&&u.add(l)}),l.parent===null&&Ni.add(l)}),this.bindSkeleton(e.skeletons,t,s),this.addGlobalSceneSettings(),Ni.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=jM(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const o=new VC().parse();Ni.children.length===1&&Ni.children[0].isGroup&&(Ni.children[0].animations=o,Ni=Ni.children[0]),Ni.animations=o}parseModels(e,t,r){const s=new Map,a=We.Objects.Model;for(const n in a){const o=parseInt(n),l=a[n],c=jt.get(o);let h=this.buildSkeleton(c,e,o,l.attrName);if(!h){switch(l.attrType){case"Camera":h=this.createCamera(c);break;case"Light":h=this.createLight(c);break;case"Mesh":h=this.createMesh(c,t,r);break;case"NurbsCurve":h=this.createCurve(c,t);break;case"LimbNode":case"Root":h=new nl;break;default:h=new Mi}h.name=l.attrName?Ye.sanitizeNodeName(l.attrName):"",h.userData.originalName=l.attrName,h.ID=o}this.getTransformData(h,l),s.set(o,h)}return s}buildSkeleton(e,t,r,s){let a=null;return e.parents.forEach(function(n){for(const o in t){const l=t[o];l.rawBones.forEach(function(c,h){if(c.ID===n.ID){const u=a;a=new nl,a.matrixWorld.copy(c.transformLink),a.name=s?Ye.sanitizeNodeName(s):"",a.userData.originalName=s,a.ID=r,l.bones[h]=a,u!==null&&a.add(u)}})}}),a}createCamera(e){let t,r;if(e.children.forEach(function(s){const a=We.Objects.NodeAttribute[s.ID];a!==void 0&&(r=a)}),r===void 0)t=new Ve;else{let s=0;r.CameraProjectionType!==void 0&&r.CameraProjectionType.value===1&&(s=1);let a=1;r.NearPlane!==void 0&&(a=r.NearPlane.value/1e3);let n=1e3;r.FarPlane!==void 0&&(n=r.FarPlane.value/1e3);let o=window.innerWidth,l=window.innerHeight;r.AspectWidth!==void 0&&r.AspectHeight!==void 0&&(o=r.AspectWidth.value,l=r.AspectHeight.value);const c=o/l;let h=45;r.FieldOfView!==void 0&&(h=r.FieldOfView.value);const u=r.FocalLength?r.FocalLength.value:null;switch(s){case 0:t=new Zt(h,c,a,n),u!==null&&t.setFocalLength(u);break;case 1:t=new Gn(-o/2,o/2,l/2,-l/2,a,n);break;default:t=new Ve}}return t}createLight(e){let t,r;if(e.children.forEach(function(s){const a=We.Objects.NodeAttribute[s.ID];a!==void 0&&(r=a)}),r===void 0)t=new Ve;else{let s;s=r.LightType===void 0?0:r.LightType.value;let a=16777215;r.Color!==void 0&&(a=new ve().fromArray(r.Color.value).convertSRGBToLinear());let n=r.Intensity===void 0?1:r.Intensity.value/100;r.CastLightOnObject!==void 0&&r.CastLightOnObject.value===0&&(n=0);let o=0;r.FarAttenuationEnd!==void 0&&(o=r.EnableFarAttenuation!==void 0&&r.EnableFarAttenuation.value===0?0:r.FarAttenuationEnd.value);const l=1;switch(s){case 0:t=new hl(a,n,o,l);break;case 1:t=new Uc(a,n);break;case 2:let c=Math.PI/3;r.InnerAngle!==void 0&&(c=ni.degToRad(r.InnerAngle.value));let h=0;r.OuterAngle!==void 0&&(h=ni.degToRad(r.OuterAngle.value),h=Math.max(h,1)),t=new Nc(a,n,o,c,h,l);break;default:t=new hl(a,n)}r.CastShadows!==void 0&&r.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,r){let s,a=null,n=null;const o=[];return e.children.forEach(function(l){t.has(l.ID)&&(a=t.get(l.ID)),r.has(l.ID)&&o.push(r.get(l.ID))}),o.length>1?n=o:o.length>0?n=o[0]:(n=new Xn({name:Bt.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(n)),"color"in a.attributes&&o.forEach(function(l){l.vertexColors=!0}),a.FBX_Deformer?(s=new ud(a,n),s.normalizeSkinWeights()):s=new ye(a,n),s}createCurve(e,t){const r=e.children.reduce(function(a,n){return t.has(n.ID)&&(a=t.get(n.ID)),a},null),s=new Wt({name:Bt.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new di(r,s)}getTransformData(e,t){const r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),r.eulerOrder="RotationOrder"in t?WM(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&jt.get(e.ID).children.forEach(function(r){if(r.relationship==="LookAtProperty"){const s=We.Objects.Model[r.ID];if("Lcl_Translation"in s){const a=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(a),Ni.add(e.target)):e.lookAt(new C().fromArray(a))}}})}bindSkeleton(e,t,r){const s=this.parsePoseNodes();for(const a in e){const n=e[a];jt.get(parseInt(n.ID)).parents.forEach(function(o){if(t.has(o.ID)){const l=o.ID;jt.get(l).parents.forEach(function(c){r.has(c.ID)&&r.get(c.ID).bind(new ol(n.bones),s[c.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in We.Objects){const t=We.Objects.Pose;for(const r in t)if(t[r].attrType==="BindPose"&&t[r].NbPoseNodes>0){const s=t[r].PoseNode;Array.isArray(s)?s.forEach(function(a){e[a.Node]=new Me().fromArray(a.Matrix.a)}):e[s.Node]=new Me().fromArray(s.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in We){if("AmbientColor"in We.GlobalSettings){const e=We.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],s=e[2];if(t!==0||r!==0||s!==0){const a=new ve(t,r,s).convertSRGBToLinear();Ni.add(new fd(a,1))}}"UnitScaleFactor"in We.GlobalSettings&&(Ni.userData.unitScaleFactor=We.GlobalSettings.UnitScaleFactor.value)}}}class BC{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in We.Objects){const r=We.Objects.Geometry;for(const s in r){const a=jt.get(parseInt(s)),n=this.parseGeometry(a,r[s],e);t.set(parseInt(s),n)}}return this.negativeMaterialIndices,t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){const s=r.skeletons,a=[],n=e.parents.map(function(u){return We.Objects.Model[u.ID]});if(n.length===0)return;const o=e.children.reduce(function(u,d){return s[d.ID]!==void 0&&(u=s[d.ID]),u},null);e.children.forEach(function(u){r.morphTargets[u.ID]!==void 0&&a.push(r.morphTargets[u.ID])});const l=n[0],c={};"RotationOrder"in l&&(c.eulerOrder=WM(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const h=jM(c);return this.genGeometry(t,o,a,h)}genGeometry(e,t,r,s){const a=new Ie;e.attrName&&(a.name=e.attrName);const n=this.parseGeoNode(e,t),o=this.genBuffers(n),l=new Se(o.vertex,3);if(l.applyMatrix4(s),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new Se(o.colors,3)),t&&(a.setAttribute("skinIndex",new sp(o.weightsIndices,4)),a.setAttribute("skinWeight",new Se(o.vertexWeights,4)),a.FBX_Deformer=t),o.normal.length>0){const c=new ke().getNormalMatrix(s),h=new Se(o.normal,3);h.applyNormalMatrix(c),a.setAttribute("normal",h)}if(o.uvs.forEach(function(c,h){const u=h===0?"uv":`uv${h}`;a.setAttribute(u,new Se(o.uvs[h],2))}),n.material&&n.material.mappingType!=="AllSame"){let c=o.materialIndex[0],h=0;if(o.materialIndex.forEach(function(u,d){u!==c&&(a.addGroup(h,d-h,c),c=u,h=d)}),a.groups.length>0){const u=a.groups[a.groups.length-1],d=u.start+u.count;d!==o.materialIndex.length&&a.addGroup(d,o.materialIndex.length-d,c)}a.groups.length===0&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,e,r,s),a}parseGeoNode(e,t){const r={};if(r.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],r.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let s=0;for(;e.LayerElementUV[s];)e.LayerElementUV[s].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[s])),s++}return r.weightTable={},t!==null&&(r.skeleton=t,t.rawBones.forEach(function(s,a){s.indices.forEach(function(n,o){r.weightTable[n]===void 0&&(r.weightTable[n]=[]),r.weightTable[n].push({id:a,weight:s.weights[o]})})})),r}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let r=0,s=0,a=[],n=[],o=[],l=[],c=[],h=[];const u=this;return e.vertexIndices.forEach(function(d,p){let f,g=!1;d<0&&(d=~d,g=!0);let m=[],v=[];if(a.push(3*d,3*d+1,3*d+2),e.color){const _=Eu(p,r,d,e.color);o.push(_[0],_[1],_[2])}if(e.skeleton){if(e.weightTable[d]!==void 0&&e.weightTable[d].forEach(function(_){v.push(_.weight),m.push(_.id)}),v.length>4){const _=[0,0,0,0],y=[0,0,0,0];v.forEach(function(x,b){let M=x,T=m[b];y.forEach(function(A,L,U){if(M>A){U[L]=M,M=A;const P=_[L];_[L]=T,T=P}})}),m=_,v=y}for(;v.length<4;)v.push(0),m.push(0);for(let _=0;_<4;++_)c.push(v[_]),h.push(m[_])}if(e.normal){const _=Eu(p,r,d,e.normal);n.push(_[0],_[1],_[2])}e.material&&e.material.mappingType!=="AllSame"&&(f=Eu(p,r,d,e.material)[0],f<0&&(u.negativeMaterialIndices=!0,f=0)),e.uv&&e.uv.forEach(function(_,y){const x=Eu(p,r,d,_);l[y]===void 0&&(l[y]=[]),l[y].push(x[0]),l[y].push(x[1])}),s++,g&&(u.genFace(t,e,a,f,n,o,l,c,h,s),r++,s=0,a=[],n=[],o=[],l=[],c=[],h=[])}),t}getNormalNewell(e){const t=new C(0,0,0);for(let r=0;r<e.length;r++){const s=e[r],a=e[(r+1)%e.length];t.x+=(s.y-a.y)*(s.z+a.z),t.y+=(s.z-a.z)*(s.x+a.x),t.z+=(s.x-a.x)*(s.y+a.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),r=(Math.abs(t.z)>.5?new C(0,1,0):new C(0,0,1)).cross(t).normalize(),s=t.clone().cross(r).normalize();return{normal:t,tangent:r,bitangent:s}}flattenVertex(e,t,r){return new se(e.dot(t),e.dot(r))}genFace(e,t,r,s,a,n,o,l,c,h){let u;if(h>3){const d=[];for(let m=0;m<r.length;m+=3)d.push(new C(t.vertexPositions[r[m]],t.vertexPositions[r[m+1]],t.vertexPositions[r[m+2]]));const{tangent:p,bitangent:f}=this.getNormalTangentAndBitangent(d),g=[];for(const m of d)g.push(this.flattenVertex(m,p,f));u=Gr.triangulateShape(g,[])}else u=[[0,1,2]];for(const[d,p,f]of u)e.vertex.push(t.vertexPositions[r[3*d]]),e.vertex.push(t.vertexPositions[r[3*d+1]]),e.vertex.push(t.vertexPositions[r[3*d+2]]),e.vertex.push(t.vertexPositions[r[3*p]]),e.vertex.push(t.vertexPositions[r[3*p+1]]),e.vertex.push(t.vertexPositions[r[3*p+2]]),e.vertex.push(t.vertexPositions[r[3*f]]),e.vertex.push(t.vertexPositions[r[3*f+1]]),e.vertex.push(t.vertexPositions[r[3*f+2]]),t.skeleton&&(e.vertexWeights.push(l[4*d]),e.vertexWeights.push(l[4*d+1]),e.vertexWeights.push(l[4*d+2]),e.vertexWeights.push(l[4*d+3]),e.vertexWeights.push(l[4*p]),e.vertexWeights.push(l[4*p+1]),e.vertexWeights.push(l[4*p+2]),e.vertexWeights.push(l[4*p+3]),e.vertexWeights.push(l[4*f]),e.vertexWeights.push(l[4*f+1]),e.vertexWeights.push(l[4*f+2]),e.vertexWeights.push(l[4*f+3]),e.weightsIndices.push(c[4*d]),e.weightsIndices.push(c[4*d+1]),e.weightsIndices.push(c[4*d+2]),e.weightsIndices.push(c[4*d+3]),e.weightsIndices.push(c[4*p]),e.weightsIndices.push(c[4*p+1]),e.weightsIndices.push(c[4*p+2]),e.weightsIndices.push(c[4*p+3]),e.weightsIndices.push(c[4*f]),e.weightsIndices.push(c[4*f+1]),e.weightsIndices.push(c[4*f+2]),e.weightsIndices.push(c[4*f+3])),t.color&&(e.colors.push(n[3*d]),e.colors.push(n[3*d+1]),e.colors.push(n[3*d+2]),e.colors.push(n[3*p]),e.colors.push(n[3*p+1]),e.colors.push(n[3*p+2]),e.colors.push(n[3*f]),e.colors.push(n[3*f+1]),e.colors.push(n[3*f+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(s),e.materialIndex.push(s),e.materialIndex.push(s)),t.normal&&(e.normal.push(a[3*d]),e.normal.push(a[3*d+1]),e.normal.push(a[3*d+2]),e.normal.push(a[3*p]),e.normal.push(a[3*p+1]),e.normal.push(a[3*p+2]),e.normal.push(a[3*f]),e.normal.push(a[3*f+1]),e.normal.push(a[3*f+2])),t.uv&&t.uv.forEach(function(g,m){e.uvs[m]===void 0&&(e.uvs[m]=[]),e.uvs[m].push(o[m][2*d]),e.uvs[m].push(o[m][2*d+1]),e.uvs[m].push(o[m][2*p]),e.uvs[m].push(o[m][2*p+1]),e.uvs[m].push(o[m][2*f]),e.uvs[m].push(o[m][2*f+1])})}addMorphTargets(e,t,r,s){if(r.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const a=this;r.forEach(function(n){n.rawTargets.forEach(function(o){const l=We.Objects.Geometry[o.geoID];l!==void 0&&a.genMorphGeometry(e,t,l,s,o.name)})})}genMorphGeometry(e,t,r,s,a){const n=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],o=r.Vertices!==void 0?r.Vertices.a:[],l=r.Indexes!==void 0?r.Indexes.a:[],c=3*e.attributes.position.count,h=new Float32Array(c);for(let f=0;f<l.length;f++){const g=3*l[f];h[g]=o[3*f],h[g+1]=o[3*f+1],h[g+2]=o[3*f+2]}const u={vertexIndices:n,vertexPositions:h},d=this.genBuffers(u),p=new Se(d.vertex,3);p.name=a||r.attrName,p.applyMatrix4(s),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Normals.a;let a=[];return r==="IndexToDirect"&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:s,indices:a,mappingType:t,referenceType:r}}parseUVs(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,s=e.UV.a;let a=[];return r==="IndexToDirect"&&(a=e.UVIndex.a),{dataSize:2,buffer:s,indices:a,mappingType:t,referenceType:r}}parseVertexColors(e){const t=e.MappingInformationType,r=e.ReferenceInformationType,s=e.Colors.a;let a=[];r==="IndexToDirect"&&(a=e.ColorIndex.a);for(let n=0,o=new ve;n<s.length;n+=4)o.fromArray(s,n).convertSRGBToLinear().toArray(s,n);return{dataSize:4,buffer:s,indices:a,mappingType:t,referenceType:r}}parseMaterialIndices(e){const t=e.MappingInformationType,r=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};const s=e.Materials.a,a=[];for(let n=0;n<s.length;++n)a.push(n);return{dataSize:1,buffer:s,indices:a,mappingType:t,referenceType:r}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return new Ie;const r=t-1,s=e.KnotVector.a,a=[],n=e.Points.a;for(let h=0,u=n.length;h<u;h+=4)a.push(new qe().fromArray(n,h));let o,l;if(e.Form==="Closed")a.push(a[0]);else if(e.Form==="Periodic"){o=r,l=s.length-1-o;for(let h=0;h<r;++h)a.push(a[h])}const c=new kC(r,s,a,o,l).getPoints(12*a.length);return new Ie().setFromPoints(c)}}class VC{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const r in t){const s=t[r],a=this.addClip(s);e.push(a)}return e}parseClips(){if(We.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=We.Objects.AnimationCurveNode,t=new Map;for(const r in e){const s=e[r];if(s.attrName.match(/S|R|T|DeformPercent/)!==null){const a={id:s.id,attr:s.attrName,curves:{}};t.set(a.id,a)}}return t}parseAnimationCurves(e){const t=We.Objects.AnimationCurve;for(const r in t){const s={id:t[r].id,times:t[r].KeyTime.a.map(jC),values:t[r].KeyValueFloat.a},a=jt.get(s.id);if(a!==void 0){const n=a.parents[0].ID,o=a.parents[0].relationship;o.match(/X/)?e.get(n).curves.x=s:o.match(/Y/)?e.get(n).curves.y=s:o.match(/Z/)?e.get(n).curves.z=s:o.match(/DeformPercent/)&&e.has(n)&&(e.get(n).curves.morph=s)}}}parseAnimationLayers(e){const t=We.Objects.AnimationLayer,r=new Map;for(const s in t){const a=[],n=jt.get(parseInt(s));n!==void 0&&(n.children.forEach(function(o,l){if(e.has(o.ID)){const c=e.get(o.ID);if(c.curves.x!==void 0||c.curves.y!==void 0||c.curves.z!==void 0){if(a[l]===void 0){const h=jt.get(o.ID).parents.filter(function(u){return u.relationship!==void 0})[0].ID;if(h!==void 0){const u=We.Objects.Model[h.toString()];if(u===void 0)return;const d={modelName:u.attrName?Ye.sanitizeNodeName(u.attrName):"",ID:u.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Ni.traverse(function(p){p.ID===u.id&&(d.transform=p.matrix,p.userData.transformData&&(d.eulerOrder=p.userData.transformData.eulerOrder))}),d.transform||(d.transform=new Me),"PreRotation"in u&&(d.preRotation=u.PreRotation.value),"PostRotation"in u&&(d.postRotation=u.PostRotation.value),a[l]=d}}a[l]&&(a[l][c.attr]=c)}else if(c.curves.morph!==void 0){if(a[l]===void 0){const h=jt.get(o.ID).parents.filter(function(m){return m.relationship!==void 0})[0].ID,u=jt.get(h).parents[0].ID,d=jt.get(u).parents[0].ID,p=jt.get(d).parents[0].ID,f=We.Objects.Model[p],g={modelName:f.attrName?Ye.sanitizeNodeName(f.attrName):"",morphName:We.Objects.Deformer[h].attrName};a[l]=g}a[l][c.attr]=c}}}),r.set(parseInt(s),a))}return r}parseAnimStacks(e){const t=We.Objects.AnimationStack,r={};for(const s in t){const a=jt.get(parseInt(s)).children;a.length;const n=e.get(a[0].ID);r[s]={name:t[s].attrName,layer:n}}return r}addClip(e){let t=[];const r=this;return e.layer.forEach(function(s){t=t.concat(r.generateTracks(s))}),new Rn(e.name,-1,t)}generateTracks(e){const t=[];let r=new C,s=new C;if(e.transform&&e.transform.decompose(r,new Qe,s),r=r.toArray(),s=s.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");a!==void 0&&t.push(a)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const a=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);a!==void 0&&t.push(a)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.S.curves,s,"scale");a!==void 0&&t.push(a)}if(e.DeformPercent!==void 0){const a=this.generateMorphTrack(e);a!==void 0&&t.push(a)}return t}generateVectorTrack(e,t,r,s){const a=this.getTimesForAllAxes(t),n=this.getKeyframeTrackValues(a,t,r);return new Na(e+"."+s,a,n)}generateRotationTrack(e,t,r,s,a){let n,o;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const u=this.interpolateRotations(t.x,t.y,t.z,a);n=u[0],o=u[1]}r!==void 0&&((r=r.map(ni.degToRad)).push(a),r=new Ct().fromArray(r),r=new Qe().setFromEuler(r)),s!==void 0&&((s=s.map(ni.degToRad)).push(a),s=new Ct().fromArray(s),s=new Qe().setFromEuler(s).invert());const l=new Qe,c=new Ct,h=[];if(!o||!n)return new us(e+".quaternion",[0],[0]);for(let u=0;u<o.length;u+=3)c.set(o[u],o[u+1],o[u+2],a),l.setFromEuler(c),r!==void 0&&l.premultiply(r),s!==void 0&&l.multiply(s),u>2&&new Qe().fromArray(h,(u-3)/3*4).dot(l)<0&&l.set(-l.x,-l.y,-l.z,-l.w),l.toArray(h,u/3*4);return new us(e+".quaternion",n,h)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,r=t.values.map(function(a){return a/100}),s=Ni.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Oa(e.modelName+".morphTargetInfluences["+s+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(r,s){return r-s}),t.length>1){let r=1,s=t[0];for(let a=1;a<t.length;a++){const n=t[a];n!==s&&(t[r]=n,s=n,r++)}t=t.slice(0,r)}return t}getKeyframeTrackValues(e,t,r){const s=r,a=[];let n=-1,o=-1,l=-1;return e.forEach(function(c){if(t.x&&(n=t.x.times.indexOf(c)),t.y&&(o=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),n!==-1){const h=t.x.values[n];a.push(h),s[0]=h}else a.push(s[0]);if(o!==-1){const h=t.y.values[o];a.push(h),s[1]=h}else a.push(s[1]);if(l!==-1){const h=t.z.values[l];a.push(h),s[2]=h}else a.push(s[2])}),a}interpolateRotations(e,t,r,s){const a=[],n=[];a.push(e.times[0]),n.push(ni.degToRad(e.values[0])),n.push(ni.degToRad(t.values[0])),n.push(ni.degToRad(r.values[0]));for(let o=1;o<e.values.length;o++){const l=[e.values[o-1],t.values[o-1],r.values[o-1]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(ni.degToRad),h=[e.values[o],t.values[o],r.values[o]];if(isNaN(h[0])||isNaN(h[1])||isNaN(h[2]))continue;const u=h.map(ni.degToRad),d=[h[0]-l[0],h[1]-l[1],h[2]-l[2]],p=[Math.abs(d[0]),Math.abs(d[1]),Math.abs(d[2])];if(p[0]>=180||p[1]>=180||p[2]>=180){const f=Math.max(...p)/180,g=new Ct(...c,s),m=new Ct(...u,s),v=new Qe().setFromEuler(g),_=new Qe().setFromEuler(m);v.dot(_)&&_.set(-_.x,-_.y,-_.z,-_.w);const y=e.times[o-1],x=e.times[o]-y,b=new Qe,M=new Ct;for(let T=0;T<1;T+=1/f)b.copy(v.clone().slerp(_.clone(),T)),a.push(y+T*x),M.setFromQuaternion(b,s),n.push(M.x),n.push(M.y),n.push(M.z)}else a.push(e.times[o]),n.push(ni.degToRad(e.values[o])),n.push(ni.degToRad(t.values[o])),n.push(ni.degToRad(r.values[o]))}return[a,n]}}class HC{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new GM,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,r=e.split(/[\r\n]+/);return r.forEach(function(s,a){const n=s.match(/^[\s\t]*;/),o=s.match(/^[\s\t]*$/);if(n||o)return;const l=s.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=s.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=s.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(s,l):c?t.parseNodeProperty(s,c,r[++a]):h?t.popStack():s.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(s)}),this.allNodes}parseNodeBegin(e,t){const r=t[1].trim().replace(/^"/,"").replace(/"$/,""),s=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:r},n=this.parseNodeAttr(s),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(r,a):r in o?(r==="PoseNode"?o.PoseNode.push(a):o[r].id!==void 0&&(o[r]={},o[r][o[r].id]=o[r]),n.id!==""&&(o[r][n.id]=a)):typeof n.id=="number"?(o[r]={},o[r][n.id]=a):r!=="Properties70"&&(o[r]=r==="PoseNode"?[a]:a),typeof n.id=="number"&&(a.id=n.id),n.name!==""&&(a.attrName=n.name),n.type!==""&&(a.attrType=n.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let r="",s="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),s=e[2]),{id:t,name:r,type:s}}parseNodeProperty(e,t,r){let s=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();s==="Content"&&a===","&&(a=r.replace(/"/g,"").replace(/,$/,"").trim());const n=this.getCurrentNode();if(n.name!=="Properties70"){if(s==="C"){const o=a.split(",").slice(1),l=parseInt(o[0]),c=parseInt(o[1]);let h=a.split(",").slice(3);h=h.map(function(u){return u.trim().replace(/^"/,"")}),s="connections",a=[l,c],function(u,d){for(let p=0,f=u.length,g=d.length;p<g;p++,f++)u[f]=d[p]}(a,h),n[s]===void 0&&(n[s]=[])}s==="Node"&&(n.id=a),s in n&&Array.isArray(n[s])?n[s].push(a):s!=="a"?n[s]=a:n.a=a,this.setCurrentProp(n,s),s==="a"&&a.slice(-1)!==","&&(n.a=Gm(a))}else this.parseNodeSpecialProperty(e,s,a)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Gm(t.a))}parseNodeSpecialProperty(e,t,r){const s=r.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=s[0],n=s[1],o=s[2],l=s[3];let c=s[4];switch(n){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=Gm(c)}this.getPrevNode()[a]={type:n,type2:o,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),a)}}class GC{parse(e){const t=new Yy(e);t.skip(23);const r=t.getUint32();if(r<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);const s=new GM;for(;!this.endOfContent(t);){const a=this.parseNode(t,r);a!==null&&s.add(a.name,a)}return s}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const r={},s=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const n=e.getUint8(),o=e.getString(n);if(s===0)return null;const l=[];for(let d=0;d<a;d++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",h=l.length>1?l[1]:"",u=l.length>2?l[2]:"";for(r.singleProperty=a===1&&e.getOffset()===s;s>e.getOffset();){const d=this.parseNode(e,t);d!==null&&this.parseSubNode(o,r,d)}return r.propertyList=l,typeof c=="number"&&(r.id=c),h!==""&&(r.attrName=h),u!==""&&(r.attrType=u),o!==""&&(r.name=o),r}parseSubNode(e,t,r){if(r.singleProperty===!0){const s=r.propertyList[0];Array.isArray(s)?(t[r.name]=r,r.a=s):t[r.name]=s}else if(e==="Connections"&&r.name==="C"){const s=[];r.propertyList.forEach(function(a,n){n!==0&&s.push(a)}),t.connections===void 0&&(t.connections=[]),t.connections.push(s)}else if(r.name==="Properties70")Object.keys(r).forEach(function(s){t[s]=r[s]});else if(e==="Properties70"&&r.name==="P"){let s=r.propertyList[0],a=r.propertyList[1];const n=r.propertyList[2],o=r.propertyList[3];let l;s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),l=a==="Color"||a==="ColorRGB"||a==="Vector"||a==="Vector3D"||a.indexOf("Lcl_")===0?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[s]={type:a,type2:n,flag:o,value:l}}else t[r.name]===void 0?typeof r.id=="number"?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:r.name==="PoseNode"?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):t[r.name][r.id]===void 0&&(t[r.name][r.id]=r)}parseProperty(e){const t=e.getString(1);let r;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return r=e.getUint32(),e.getArrayBuffer(r);case"S":return r=e.getUint32(),e.getString(r);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const s=e.getUint32(),a=e.getUint32(),n=e.getUint32();if(a===0)switch(t){case"b":case"c":return e.getBooleanArray(s);case"d":return e.getFloat64Array(s);case"f":return e.getFloat32Array(s);case"i":return e.getInt32Array(s);case"l":return e.getInt64Array(s)}const o=DC(new Uint8Array(e.getArrayBuffer(n))),l=new Yy(o.buffer);switch(t){case"b":case"c":return l.getBooleanArray(s);case"d":return l.getFloat64Array(s);case"f":return l.getFloat32Array(s);case"i":return l.getInt32Array(s);case"l":return l.getInt64Array(s)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Yy{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return!(1&~this.getUint8())}getBooleanArray(e){const t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let r=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const s=r.indexOf(0);return s>=0&&(r=new Uint8Array(this.dv.buffer,t,s)),this._textDecoder.decode(r)}}class GM{add(e,t){this[e]=t}}function Zy(i){const e=i.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function jC(i){return i/46186158e3}const WC=[];function Eu(i,e,t,r){let s;switch(r.mappingType){case"ByPolygonVertex":s=i;break;case"ByPolygon":s=e;break;case"ByVertice":s=t;break;case"AllSame":s=r.indices[0]}r.referenceType==="IndexToDirect"&&(s=r.indices[s]);const a=s*r.dataSize,n=a+r.dataSize;return function(o,l,c,h){for(let u=c,d=0;u<h;u++,d++)o[d]=l[u];return o}(WC,r.buffer,a,n)}const Hm=new Ct,To=new C;function jM(i){const e=new Me,t=new Me,r=new Me,s=new Me,a=new Me,n=new Me,o=new Me,l=new Me,c=new Me,h=new Me,u=new Me,d=new Me,p=i.inheritType?i.inheritType:0;if(i.translation&&e.setPosition(To.fromArray(i.translation)),i.preRotation){const U=i.preRotation.map(ni.degToRad);U.push(i.eulerOrder||Ct.DEFAULT_ORDER),t.makeRotationFromEuler(Hm.fromArray(U))}if(i.rotation){const U=i.rotation.map(ni.degToRad);U.push(i.eulerOrder||Ct.DEFAULT_ORDER),r.makeRotationFromEuler(Hm.fromArray(U))}if(i.postRotation){const U=i.postRotation.map(ni.degToRad);U.push(i.eulerOrder||Ct.DEFAULT_ORDER),s.makeRotationFromEuler(Hm.fromArray(U)),s.invert()}i.scale&&a.scale(To.fromArray(i.scale)),i.scalingOffset&&o.setPosition(To.fromArray(i.scalingOffset)),i.scalingPivot&&n.setPosition(To.fromArray(i.scalingPivot)),i.rotationOffset&&l.setPosition(To.fromArray(i.rotationOffset)),i.rotationPivot&&c.setPosition(To.fromArray(i.rotationPivot)),i.parentMatrixWorld&&(u.copy(i.parentMatrix),h.copy(i.parentMatrixWorld));const f=t.clone().multiply(r).multiply(s),g=new Me;g.extractRotation(h);const m=new Me;m.copyPosition(h);const v=m.clone().invert().multiply(h),_=g.clone().invert().multiply(v),y=a,x=new Me;if(p===0)x.copy(g).multiply(f).multiply(_).multiply(y);else if(p===1)x.copy(g).multiply(_).multiply(f).multiply(y);else{const U=new Me().scale(new C().setFromMatrixScale(u)).clone().invert(),P=_.clone().multiply(U);x.copy(g).multiply(f).multiply(P).multiply(y)}const b=c.clone().invert(),M=n.clone().invert();let T=e.clone().multiply(l).multiply(c).multiply(t).multiply(r).multiply(s).multiply(b).multiply(o).multiply(n).multiply(a).multiply(M);const A=new Me().copyPosition(T),L=h.clone().multiply(A);return d.copyPosition(L),T=d.clone().multiply(x),T.premultiply(h.invert()),T}function WM(i){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(i=i||0)===6?e[0]:e[i]}function Gm(i){return i.split(",").map(function(e){return parseFloat(e)})}function Ky(i,e,t){return e===void 0&&(e=0),t===void 0&&(t=i.byteLength),new TextDecoder().decode(new Uint8Array(i,e,t))}function Qy(i,e){if(e===0)return i;if(e===2||e===1){let t=i.getIndex();if(t===null){const n=[],o=i.getAttribute("position");if(o===void 0)return i;for(let l=0;l<o.count;l++)n.push(l);i.setIndex(n),t=i.getIndex()}const r=t.count-2,s=[];if(e===2)for(let n=1;n<=r;n++)s.push(t.getX(0)),s.push(t.getX(n)),s.push(t.getX(n+1));else for(let n=0;n<r;n++)n%2==0?(s.push(t.getX(n)),s.push(t.getX(n+1)),s.push(t.getX(n+2))):(s.push(t.getX(n+2)),s.push(t.getX(n+1)),s.push(t.getX(n)));s.length;const a=i.clone();return a.setIndex(s),a.clearGroups(),a}return i}class XC extends Bt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new QC(t)}),this.register(function(t){return new $C(t)}),this.register(function(t){return new o3(t)}),this.register(function(t){return new l3(t)}),this.register(function(t){return new c3(t)}),this.register(function(t){return new e3(t)}),this.register(function(t){return new t3(t)}),this.register(function(t){return new i3(t)}),this.register(function(t){return new r3(t)}),this.register(function(t){return new KC(t)}),this.register(function(t){return new s3(t)}),this.register(function(t){return new JC(t)}),this.register(function(t){return new n3(t)}),this.register(function(t){return new a3(t)}),this.register(function(t){return new YC(t)}),this.register(function(t){return new h3(t)}),this.register(function(t){return new u3(t)})}load(e,t,r,s){const a=this;let n;if(this.resourcePath!=="")n=this.resourcePath;else if(this.path!==""){const c=ds.extractUrlBase(e);n=ds.resolveURL(c,this.path)}else n=ds.extractUrlBase(e);this.manager.itemStart(e);const o=function(c){s&&s(c),a.manager.itemError(e),a.manager.itemEnd(e)},l=new xi(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{a.parse(c,n,function(h){t(h),a.manager.itemEnd(e)},o)}catch(h){o(h)}},r,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,s){let a;const n={},o={},l=new TextDecoder;if(typeof e=="string")a=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===XM){try{n[$e.KHR_BINARY_GLTF]=new m3(e)}catch(h){return void(s&&s(h))}a=JSON.parse(n[$e.KHR_BINARY_GLTF].content)}else a=JSON.parse(l.decode(e));else a=e;if(a.asset===void 0||a.asset.version[0]<2)return void(s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const c=new A3(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](c);u.name,o[u.name]=u,n[u.name]=!0}if(a.extensionsUsed)for(let h=0;h<a.extensionsUsed.length;++h){const u=a.extensionsUsed[h],d=a.extensionsRequired||[];switch(u){case $e.KHR_MATERIALS_UNLIT:n[u]=new ZC;break;case $e.KHR_DRACO_MESH_COMPRESSION:n[u]=new f3(a,this.dracoLoader);break;case $e.KHR_TEXTURE_TRANSFORM:n[u]=new g3;break;case $e.KHR_MESH_QUANTIZATION:n[u]=new v3;break;default:d.indexOf(u)>=0&&o[u]}}c.setExtensions(n),c.setPlugins(o),c.parse(r,s)}parseAsync(e,t){const r=this;return new Promise(function(s,a){r.parse(e,t,s,a)})}}function qC(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const $e={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class YC{constructor(e){this.parser=e,this.name=$e.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,s=t.length;r<s;r++){const a=t[r];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let s=t.cache.get(r);if(s)return s;const a=t.json,n=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let o;const l=new ve(16777215);n.color!==void 0&&l.setRGB(n.color[0],n.color[1],n.color[2],si);const c=n.range!==void 0?n.range:0;switch(n.type){case"directional":o=new Uc(l),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new hl(l),o.distance=c;break;case"spot":o=new Nc(l),o.distance=c,n.spot=n.spot||{},n.spot.innerConeAngle=n.spot.innerConeAngle!==void 0?n.spot.innerConeAngle:0,n.spot.outerConeAngle=n.spot.outerConeAngle!==void 0?n.spot.outerConeAngle:Math.PI/4,o.angle=n.spot.outerConeAngle,o.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+n.type)}return o.position.set(0,0,0),o.decay=2,da(o,n),n.intensity!==void 0&&(o.intensity=n.intensity),o.name=t.createUniqueName(n.name||"light_"+e),s=Promise.resolve(o),t.cache.add(r,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser,s=r.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(n){return r._getNodeRef(t.cache,a,n)})}}class ZC{constructor(){this.name=$e.KHR_MATERIALS_UNLIT}getMaterialType(){return Qt}extendParams(e,t,r){const s=[];e.color=new ve(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const n=a.baseColorFactor;e.color.setRGB(n[0],n[1],n[2],si),e.opacity=n[3]}a.baseColorTexture!==void 0&&s.push(r.assignTexture(e,"map",a.baseColorTexture,Mt))}return Promise.all(s)}}class KC{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class QC{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];if(n.clearcoatFactor!==void 0&&(t.clearcoat=n.clearcoatFactor),n.clearcoatTexture!==void 0&&a.push(r.assignTexture(t,"clearcoatMap",n.clearcoatTexture)),n.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=n.clearcoatRoughnessFactor),n.clearcoatRoughnessTexture!==void 0&&a.push(r.assignTexture(t,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),n.clearcoatNormalTexture!==void 0&&(a.push(r.assignTexture(t,"clearcoatNormalMap",n.clearcoatNormalTexture)),n.clearcoatNormalTexture.scale!==void 0)){const o=n.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new se(o,o)}return Promise.all(a)}}class $C{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class JC{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return n.iridescenceFactor!==void 0&&(t.iridescence=n.iridescenceFactor),n.iridescenceTexture!==void 0&&a.push(r.assignTexture(t,"iridescenceMap",n.iridescenceTexture)),n.iridescenceIor!==void 0&&(t.iridescenceIOR=n.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),n.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=n.iridescenceThicknessMinimum),n.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=n.iridescenceThicknessMaximum),n.iridescenceThicknessTexture!==void 0&&a.push(r.assignTexture(t,"iridescenceThicknessMap",n.iridescenceThicknessTexture)),Promise.all(a)}}class e3{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new ve(0,0,0),t.sheenRoughness=0,t.sheen=1;const n=s.extensions[this.name];if(n.sheenColorFactor!==void 0){const o=n.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],si)}return n.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=n.sheenRoughnessFactor),n.sheenColorTexture!==void 0&&a.push(r.assignTexture(t,"sheenColorMap",n.sheenColorTexture,Mt)),n.sheenRoughnessTexture!==void 0&&a.push(r.assignTexture(t,"sheenRoughnessMap",n.sheenRoughnessTexture)),Promise.all(a)}}class t3{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return n.transmissionFactor!==void 0&&(t.transmission=n.transmissionFactor),n.transmissionTexture!==void 0&&a.push(r.assignTexture(t,"transmissionMap",n.transmissionTexture)),Promise.all(a)}}class i3{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];t.thickness=n.thicknessFactor!==void 0?n.thicknessFactor:0,n.thicknessTexture!==void 0&&a.push(r.assignTexture(t,"thicknessMap",n.thicknessTexture)),t.attenuationDistance=n.attenuationDistance||1/0;const o=n.attenuationColor||[1,1,1];return t.attenuationColor=new ve().setRGB(o[0],o[1],o[2],si),Promise.all(a)}}class r3{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class s3{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];t.specularIntensity=n.specularFactor!==void 0?n.specularFactor:1,n.specularTexture!==void 0&&a.push(r.assignTexture(t,"specularIntensityMap",n.specularTexture));const o=n.specularColorFactor||[1,1,1];return t.specularColor=new ve().setRGB(o[0],o[1],o[2],si),n.specularColorTexture!==void 0&&a.push(r.assignTexture(t,"specularColorMap",n.specularColorTexture,Mt)),Promise.all(a)}}class a3{constructor(e){this.parser=e,this.name=$e.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return t.bumpScale=n.bumpFactor!==void 0?n.bumpFactor:1,n.bumpTexture!==void 0&&a.push(r.assignTexture(t,"bumpMap",n.bumpTexture)),Promise.all(a)}}class n3{constructor(e){this.parser=e,this.name=$e.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?dr:null}extendMaterialParams(e,t){const r=this.parser,s=r.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=[],n=s.extensions[this.name];return n.anisotropyStrength!==void 0&&(t.anisotropy=n.anisotropyStrength),n.anisotropyRotation!==void 0&&(t.anisotropyRotation=n.anisotropyRotation),n.anisotropyTexture!==void 0&&a.push(r.assignTexture(t,"anisotropyMap",n.anisotropyTexture)),Promise.all(a)}}class o3{constructor(e){this.parser=e,this.name=$e.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,s=r.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const a=s.extensions[this.name],n=t.options.ktx2Loader;if(!n){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,n)}}class l3{constructor(e){this.parser=e,this.name=$e.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[t])return null;const n=a.extensions[t],o=s.images[n.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,n.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class c3{constructor(e){this.parser=e,this.name=$e.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,s=r.json,a=s.textures[e];if(!a.extensions||!a.extensions[t])return null;const n=a.extensions[t],o=s.images[n.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,n.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class h3{constructor(e){this.name=$e.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const s=r.extensions[this.name],a=this.parser.getDependency("buffer",s.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(o){const l=s.byteOffset||0,c=s.byteLength||0,h=s.count,u=s.byteStride,d=new Uint8Array(o,l,c);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(h,u,d,s.mode,s.filter).then(function(p){return p.buffer}):n.ready.then(function(){const p=new ArrayBuffer(h*u);return n.decodeGltfBuffer(new Uint8Array(p),h,u,d,s.mode,s.filter),p})})}return null}}class u3{constructor(e){this.name=$e.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const s=t.meshes[r.mesh];for(const l of s.primitives)if(l.mode!==xr.TRIANGLES&&l.mode!==xr.TRIANGLE_STRIP&&l.mode!==xr.TRIANGLE_FAN&&l.mode!==void 0)return null;const a=r.extensions[this.name].attributes,n=[],o={};for(const l in a)n.push(this.parser.getDependency("accessor",a[l]).then(c=>(o[l]=c,o[l])));return n.length<1?null:(n.push(this.parser.createNodeMesh(e)),Promise.all(n).then(l=>{const c=l.pop(),h=c.isGroup?c.children:[c],u=l[0].count,d=[];for(const p of h){const f=new Me,g=new C,m=new Qe,v=new C(1,1,1),_=new Yf(p.geometry,p.material,u);for(let y=0;y<u;y++)o.TRANSLATION&&g.fromBufferAttribute(o.TRANSLATION,y),o.ROTATION&&m.fromBufferAttribute(o.ROTATION,y),o.SCALE&&v.fromBufferAttribute(o.SCALE,y),_.setMatrixAt(y,f.compose(g,m,v));for(const y in o)if(y==="_COLOR_0"){const x=o[y];_.instanceColor=new Pn(x.array,x.itemSize,x.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&p.geometry.setAttribute(y,o[y]);Ve.prototype.copy.call(_,p),this.parser.assignFinalMaterial(_),d.push(_)}return c.isGroup?(c.clear(),c.add(...d),c):d[0]}))}}const XM="glTF",d3=1313821514,p3=5130562;class m3{constructor(e){this.name=$e.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==XM)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,a=new DataView(e,12);let n=0;for(;n<s;){const o=a.getUint32(n,!0);n+=4;const l=a.getUint32(n,!0);if(n+=4,l===d3){const c=new Uint8Array(e,12+n,o);this.content=r.decode(c)}else if(l===p3){const c=12+n;this.body=e.slice(c,c+o)}n+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class f3{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=$e.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,s=this.dracoLoader,a=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,o={},l={},c={};for(const h in n){const u=Pg[h]||h.toLowerCase();o[u]=n[h]}for(const h in e.attributes){const u=Pg[h]||h.toLowerCase();if(n[h]!==void 0){const d=r.accessors[e.attributes[h]],p=Yo[d.componentType];c[u]=p.name,l[u]=d.normalized===!0}}return t.getDependency("bufferView",a).then(function(h){return new Promise(function(u,d){s.decodeDracoFile(h,function(p){for(const f in p.attributes){const g=p.attributes[f],m=l[f];m!==void 0&&(g.normalized=m)}u(p)},o,c,si,d)})})}}class g3{constructor(){this.name=$e.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord!==void 0&&t.texCoord!==e.channel||t.offset!==void 0||t.rotation!==void 0||t.scale!==void 0)&&(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class v3{constructor(){this.name=$e.KHR_MESH_QUANTIZATION}}class qM extends bl{constructor(e,t,r,s){super(e,t,r,s)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=e*s*3+s;for(let n=0;n!==s;n++)t[n]=r[a+n];return t}interpolate_(e,t,r,s){const a=this.resultBuffer,n=this.sampleValues,o=this.valueSize,l=2*o,c=3*o,h=s-t,u=(r-t)/h,d=u*u,p=d*u,f=e*c,g=f-c,m=-2*p+3*d,v=p-d,_=1-m,y=v-d+u;for(let x=0;x!==o;x++){const b=n[g+x+o],M=n[g+x+l]*h,T=n[f+x+o],A=n[f+x]*h;a[x]=_*b+y*M+m*T+v*A}return a}}const _3=new Qe;class y3 extends qM{interpolate_(e,t,r,s){const a=super.interpolate_(e,t,r,s);return _3.fromArray(a).normalize().toArray(a),a}}const xr={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Yo={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$y={9728:lt,9729:qt,9984:ep,9985:Vo,9986:Mn,9987:hs},Jy={33071:bi,33648:Da,10497:Kt},jm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Pg={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},la={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},x3={CUBICSPLINE:void 0,LINEAR:Vn,STEP:tl},b3="OPAQUE",M3="MASK",w3="BLEND";function cn(i,e,t){for(const r in t.extensions)i[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=t.extensions[r])}function da(i,e){e.extras!==void 0&&typeof e.extras=="object"&&Object.assign(i.userData,e.extras)}function S3(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,r=e.weights.length;t<r;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let r=0,s=t.length;r<s;r++)i.morphTargetDictionary[t[r]]=r}}}function T3(i){let e;const t=i.extensions&&i.extensions[$e.KHR_DRACO_MESH_COMPRESSION];if(e=t?"draco:"+t.bufferView+":"+t.indices+":"+Wm(t.attributes):i.indices+":"+Wm(i.attributes)+":"+i.mode,i.targets!==void 0)for(let r=0,s=i.targets.length;r<s;r++)e+=":"+Wm(i.targets[r]);return e}function Wm(i){let e="";const t=Object.keys(i).sort();for(let r=0,s=t.length;r<s;r++)e+=t[r]+":"+i[t[r]]+";";return e}function Rg(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const E3=new Me;class A3{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new qC,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,s=!1,a=-1;typeof navigator<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,a=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||s&&a<98?this.textureLoader=new gs(this.options.manager):this.textureLoader=new qx(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new xi(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,s=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(n){return n._markDefs&&n._markDefs()}),Promise.all(this._invokeAll(function(n){return n.beforeRoot&&n.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(n){const o={scene:n[0][s.scene||0],scenes:n[0],animations:n[1],cameras:n[2],asset:s.asset,parser:r,userData:{}};return cn(a,o,s),da(o,s),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){for(const l of o.scenes)l.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let s=0,a=t.length;s<a;s++){const n=t[s].joints;for(let o=0,l=n.length;o<l;o++)e[n[o]].isBone=!0}for(let s=0,a=e.length;s<a;s++){const n=e[s];n.mesh!==void 0&&(this._addNodeRef(this.meshCache,n.mesh),n.skin!==void 0&&(r[n.mesh].isSkinnedMesh=!0)),n.camera!==void 0&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const s=r.clone(),a=(n,o)=>{const l=this.associations.get(n);l!=null&&this.associations.set(o,l);for(const[c,h]of n.children.entries())a(h,o.children[c])};return a(r,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const s=e(t[r]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let s=0;s<t.length;s++){const a=e(t[s]);a&&r.push(a)}return r}getDependency(e,t){const r=e+":"+t;let s=this.cache.get(r);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(a){return a.loadNode&&a.loadNode(t)});break;case"mesh":s=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e)}this.cache.add(r,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(a,n){return r.getDependency(e,n)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[$e.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(a,n){r.load(ds.resolveURL(t.uri,s.path),a,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(r){const s=t.byteLength||0,a=t.byteOffset||0;return r.slice(a,a+s)})}loadAccessor(e){const t=this,r=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const n=jm[s.type],o=Yo[s.componentType],l=s.normalized===!0,c=new o(s.count*n);return Promise.resolve(new Ke(c,n,l))}const a=[];return s.bufferView!==void 0?a.push(this.getDependency("bufferView",s.bufferView)):a.push(null),s.sparse!==void 0&&(a.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(a).then(function(n){const o=n[0],l=jm[s.type],c=Yo[s.componentType],h=c.BYTES_PER_ELEMENT,u=h*l,d=s.byteOffset||0,p=s.bufferView!==void 0?r.bufferViews[s.bufferView].byteStride:void 0,f=s.normalized===!0;let g,m;if(p&&p!==u){const v=Math.floor(d/p),_="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+v+":"+s.count;let y=t.cache.get(_);y||(g=new c(o,v*p,s.count*p/h),y=new ch(g,p/h),t.cache.add(_,y)),m=new qi(y,l,d%p/h,f)}else g=o===null?new c(s.count*l):new c(o,d,s.count*l),m=new Ke(g,l,f);if(s.sparse!==void 0){const v=jm.SCALAR,_=Yo[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,x=s.sparse.values.byteOffset||0,b=new _(n[1],y,s.sparse.count*v),M=new c(n[2],x,s.sparse.count*l);o!==null&&(m=new Ke(m.array.slice(),m.itemSize,m.normalized));for(let T=0,A=b.length;T<A;T++){const L=b[T];if(m.setX(L,M[T*l]),l>=2&&m.setY(L,M[T*l+1]),l>=3&&m.setZ(L,M[T*l+2]),l>=4&&m.setW(L,M[T*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,r=this.options,s=t.textures[e].source,a=t.images[s];let n=this.textureLoader;if(a.uri){const o=r.manager.getHandler(a.uri);o!==null&&(n=o)}return this.loadTextureImage(e,s,n)}loadTextureImage(e,t,r){const s=this,a=this.json,n=a.textures[e],o=a.images[t],l=(o.uri||o.bufferView)+":"+n.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,r).then(function(h){h.flipY=!1,h.name=n.name||o.name||"",h.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(h.name=o.uri);const u=(a.samplers||{})[n.sampler]||{};return h.magFilter=$y[u.magFilter]||qt,h.minFilter=$y[u.minFilter]||hs,h.wrapS=Jy[u.wrapS]||Kt,h.wrapT=Jy[u.wrapT]||Kt,s.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const r=this,s=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const n=s.images[e],o=self.URL||self.webkitURL;let l=n.uri||"",c=!1;if(n.bufferView!==void 0)l=r.getDependency("bufferView",n.bufferView).then(function(u){c=!0;const d=new Blob([u],{type:n.mimeType});return l=o.createObjectURL(d),l});else if(n.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(l).then(function(u){return new Promise(function(d,p){let f=d;t.isImageBitmapLoader===!0&&(f=function(g){const m=new yt(g);m.needsUpdate=!0,d(m)}),t.load(ds.resolveURL(u,a.path),f,void 0,p)})}).then(function(u){var d;return c===!0&&o.revokeObjectURL(l),u.userData.mimeType=n.mimeType||((d=n.uri).search(/\.jpe?g($|\?)/i)>0||d.search(/^data\:image\/jpeg/)===0?"image/jpeg":d.search(/\.webp($|\?)/i)>0||d.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),u}).catch(function(u){throw u});return this.sourceCache[e]=h,h}assignTexture(e,t,r,s){const a=this;return this.getDependency("texture",r.index).then(function(n){if(!n)return null;if(r.texCoord!==void 0&&r.texCoord>0&&((n=n.clone()).channel=r.texCoord),a.extensions[$e.KHR_TEXTURE_TRANSFORM]){const o=r.extensions!==void 0?r.extensions[$e.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=a.associations.get(n);n=a.extensions[$e.KHR_TEXTURE_TRANSFORM].extendTexture(n,o),a.associations.set(n,l)}}return s!==void 0&&(n.colorSpace=s),e[t]=n,n})}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const s=t.attributes.tangent===void 0,a=t.attributes.color!==void 0,n=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new ga,$t.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(o,l)),r=l}else if(e.isLine){const o="LineBasicMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new Wt,$t.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(o,l)),r=l}if(s||a||n){let o="ClonedMaterial:"+r.uuid+":";s&&(o+="derivative-tangents:"),a&&(o+="vertex-colors:"),n&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=r.clone(),a&&(l.vertexColors=!0),n&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(r))),r=l}e.material=r}getMaterialType(){return cl}loadMaterial(e){const t=this,r=this.json,s=this.extensions,a=r.materials[e];let n;const o={},l=[];if((a.extensions||{})[$e.KHR_MATERIALS_UNLIT]){const h=s[$e.KHR_MATERIALS_UNLIT];n=h.getMaterialType(),l.push(h.extendParams(o,a,t))}else{const h=a.pbrMetallicRoughness||{};if(o.color=new ve(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){const u=h.baseColorFactor;o.color.setRGB(u[0],u[1],u[2],si),o.opacity=u[3]}h.baseColorTexture!==void 0&&l.push(t.assignTexture(o,"map",h.baseColorTexture,Mt)),o.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,o.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),l.push(t.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture))),n=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,o)})))}a.doubleSided===!0&&(o.side=Rt);const c=a.alphaMode||b3;if(c===w3?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,c===M3&&(o.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&n!==Qt&&(l.push(t.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new se(1,1),a.normalTexture.scale!==void 0)){const h=a.normalTexture.scale;o.normalScale.set(h,h)}if(a.occlusionTexture!==void 0&&n!==Qt&&(l.push(t.assignTexture(o,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&n!==Qt){const h=a.emissiveFactor;o.emissive=new ve().setRGB(h[0],h[1],h[2],si)}return a.emissiveTexture!==void 0&&n!==Qt&&l.push(t.assignTexture(o,"emissiveMap",a.emissiveTexture,Mt)),Promise.all(l).then(function(){const h=new n(o);return a.name&&(h.name=a.name),da(h,a),t.associations.set(h,{materials:e}),a.extensions&&cn(s,h,a),h})}createUniqueName(e){const t=Ye.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,r=this.extensions,s=this.primitiveCache;function a(o){return r[$e.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(l){return e1(l,o,t)})}const n=[];for(let o=0,l=e.length;o<l;o++){const c=e[o],h=T3(c),u=s[h];if(u)n.push(u.promise);else{let d;d=c.extensions&&c.extensions[$e.KHR_DRACO_MESH_COMPRESSION]?a(c):e1(new Ie,c,t),s[h]={primitive:c,promise:d},n.push(d)}}return Promise.all(n)}loadMesh(e){const t=this,r=this.json,s=this.extensions,a=r.meshes[e],n=a.primitives,o=[];for(let c=0,h=n.length;c<h;c++){const u=n[c].material===void 0?((l=this.cache).DefaultMaterial===void 0&&(l.DefaultMaterial=new cl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Er})),l.DefaultMaterial):this.getDependency("material",n[c].material);o.push(u)}var l;return o.push(t.loadGeometries(n)),Promise.all(o).then(function(c){const h=c.slice(0,c.length-1),u=c[c.length-1],d=[];for(let f=0,g=u.length;f<g;f++){const m=u[f],v=n[f];let _;const y=h[f];if(v.mode===xr.TRIANGLES||v.mode===xr.TRIANGLE_STRIP||v.mode===xr.TRIANGLE_FAN||v.mode===void 0)_=a.isSkinnedMesh===!0?new ud(m,y):new ye(m,y),_.isSkinnedMesh===!0&&_.normalizeSkinWeights(),v.mode===xr.TRIANGLE_STRIP?_.geometry=Qy(_.geometry,1):v.mode===xr.TRIANGLE_FAN&&(_.geometry=Qy(_.geometry,2));else if(v.mode===xr.LINES)_=new tr(m,y);else if(v.mode===xr.LINE_STRIP)_=new di(m,y);else if(v.mode===xr.LINE_LOOP)_=new Zf(m,y);else{if(v.mode!==xr.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);_=new Ea(m,y)}Object.keys(_.geometry.morphAttributes).length>0&&S3(_,a),_.name=t.createUniqueName(a.name||"mesh_"+e),da(_,a),v.extensions&&cn(s,_,v),t.assignFinalMaterial(_),d.push(_)}for(let f=0,g=d.length;f<g;f++)t.associations.set(d[f],{meshes:e,primitives:f});if(d.length===1)return a.extensions&&cn(s,d[0],a),d[0];const p=new Mi;a.extensions&&cn(s,p,a),t.associations.set(p,{meshes:e});for(let f=0,g=d.length;f<g;f++)p.add(d[f]);return p})}loadCamera(e){let t;const r=this.json.cameras[e],s=r[r.type];if(s)return r.type==="perspective"?t=new Zt(ni.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):r.type==="orthographic"&&(t=new Gn(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),da(t,r),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],r=[];for(let s=0,a=t.joints.length;s<a;s++)r.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(s){const a=s.pop(),n=s,o=[],l=[];for(let c=0,h=n.length;c<h;c++){const u=n[c];if(u){o.push(u);const d=new Me;a!==null&&d.fromArray(a.array,16*c),l.push(d)}}return new ol(o,l)})}loadAnimation(e){const t=this.json,r=this,s=t.animations[e],a=s.name?s.name:"animation_"+e,n=[],o=[],l=[],c=[],h=[];for(let u=0,d=s.channels.length;u<d;u++){const p=s.channels[u],f=s.samplers[p.sampler],g=p.target,m=g.node,v=s.parameters!==void 0?s.parameters[f.input]:f.input,_=s.parameters!==void 0?s.parameters[f.output]:f.output;g.node!==void 0&&(n.push(this.getDependency("node",m)),o.push(this.getDependency("accessor",v)),l.push(this.getDependency("accessor",_)),c.push(f),h.push(g))}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(u){const d=u[0],p=u[1],f=u[2],g=u[3],m=u[4],v=[];for(let _=0,y=d.length;_<y;_++){const x=d[_],b=p[_],M=f[_],T=g[_],A=m[_];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const L=r._createAnimationTracks(x,b,M,T,A);if(L)for(let U=0;U<L.length;U++)v.push(L[U])}return new Rn(a,void 0,v)})}createNodeMesh(e){const t=this.json,r=this,s=t.nodes[e];return s.mesh===void 0?null:r.getDependency("mesh",s.mesh).then(function(a){const n=r._getNodeRef(r.meshCache,s.mesh,a);return s.weights!==void 0&&n.traverse(function(o){if(o.isMesh)for(let l=0,c=s.weights.length;l<c;l++)o.morphTargetInfluences[l]=s.weights[l]}),n})}loadNode(e){const t=this,r=this.json.nodes[e],s=t._loadNodeShallow(e),a=[],n=r.children||[];for(let l=0,c=n.length;l<c;l++)a.push(t.getDependency("node",n[l]));const o=r.skin===void 0?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([s,Promise.all(a),o]).then(function(l){const c=l[0],h=l[1],u=l[2];u!==null&&c.traverse(function(d){d.isSkinnedMesh&&d.bind(u,E3)});for(let d=0,p=h.length;d<p;d++)c.add(h[d]);return c})}_loadNodeShallow(e){const t=this.json,r=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const a=t.nodes[e],n=a.name?s.createUniqueName(a.name):"",o=[],l=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&o.push(l),a.camera!==void 0&&o.push(s.getDependency("camera",a.camera).then(function(c){return s._getNodeRef(s.cameraCache,a.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let h;if(h=a.isBone===!0?new nl:c.length>1?new Mi:c.length===1?c[0]:new Ve,h!==c[0])for(let u=0,d=c.length;u<d;u++)h.add(c[u]);if(a.name&&(h.userData.name=a.name,h.name=n),da(h,a),a.extensions&&cn(r,h,a),a.matrix!==void 0){const u=new Me;u.fromArray(a.matrix),h.applyMatrix4(u)}else a.translation!==void 0&&h.position.fromArray(a.translation),a.rotation!==void 0&&h.quaternion.fromArray(a.rotation),a.scale!==void 0&&h.scale.fromArray(a.scale);return s.associations.has(h)||s.associations.set(h,{}),s.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],s=this,a=new Mi;r.name&&(a.name=s.createUniqueName(r.name)),da(a,r),r.extensions&&cn(t,a,r);const n=r.nodes||[],o=[];for(let l=0,c=n.length;l<c;l++)o.push(s.getDependency("node",n[l]));return Promise.all(o).then(function(l){for(let c=0,h=l.length;c<h;c++)a.add(l[c]);return s.associations=(c=>{const h=new Map;for(const[u,d]of s.associations)(u instanceof $t||u instanceof yt)&&h.set(u,d);return c.traverse(u=>{const d=s.associations.get(u);d!=null&&h.set(u,d)}),h})(a),a})}_createAnimationTracks(e,t,r,s,a){const n=[],o=e.name?e.name:e.uuid,l=[];let c;switch(la[a.path]===la.weights?e.traverse(function(d){d.morphTargetInfluences&&l.push(d.name?d.name:d.uuid)}):l.push(o),la[a.path]){case la.weights:c=Oa;break;case la.rotation:c=us;break;case la.position:case la.scale:c=Na;break;default:r.itemSize===1?c=Oa:c=Na}const h=s.interpolation!==void 0?x3[s.interpolation]:Vn,u=this._getArrayFromAccessor(r);for(let d=0,p=l.length;d<p;d++){const f=new c(l[d]+"."+la[a.path],t.array,u,h);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),n.push(f)}return n}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const r=Rg(t.constructor),s=new Float32Array(t.length);for(let a=0,n=t.length;a<n;a++)s[a]=t[a]*r;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){return new(this instanceof us?y3:qM)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function e1(i,e,t){const r=e.attributes,s=[];function a(n,o){return t.getDependency("accessor",n).then(function(l){i.setAttribute(o,l)})}for(const n in r){const o=Pg[n]||n.toLowerCase();o in i.attributes||s.push(a(r[n],o))}if(e.indices!==void 0&&!i.index){const n=t.getDependency("accessor",e.indices).then(function(o){i.setIndex(o)});s.push(n)}return ct.workingColorSpace,da(i,e),function(n,o,l){const c=o.attributes,h=new Tt;if(c.POSITION===void 0)return;{const p=l.json.accessors[c.POSITION],f=p.min,g=p.max;if(f===void 0||g===void 0)return;if(h.set(new C(f[0],f[1],f[2]),new C(g[0],g[1],g[2])),p.normalized){const m=Rg(Yo[p.componentType]);h.min.multiplyScalar(m),h.max.multiplyScalar(m)}}const u=o.targets;if(u!==void 0){const p=new C,f=new C;for(let g=0,m=u.length;g<m;g++){const v=u[g];if(v.POSITION!==void 0){const _=l.json.accessors[v.POSITION],y=_.min,x=_.max;if(y!==void 0&&x!==void 0){if(f.setX(Math.max(Math.abs(y[0]),Math.abs(x[0]))),f.setY(Math.max(Math.abs(y[1]),Math.abs(x[1]))),f.setZ(Math.max(Math.abs(y[2]),Math.abs(x[2]))),_.normalized){const b=Rg(Yo[_.componentType]);f.multiplyScalar(b)}p.max(f)}}}h.expandByVector(p)}n.boundingBox=h;const d=new oi;h.getCenter(d.center),d.radius=h.min.distanceTo(h.max)/2,n.boundingSphere=d}(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?function(n,o,l){let c=!1,h=!1,u=!1;for(let g=0,m=o.length;g<m;g++){const v=o[g];if(v.POSITION!==void 0&&(c=!0),v.NORMAL!==void 0&&(h=!0),v.COLOR_0!==void 0&&(u=!0),c&&h&&u)break}if(!c&&!h&&!u)return Promise.resolve(n);const d=[],p=[],f=[];for(let g=0,m=o.length;g<m;g++){const v=o[g];if(c){const _=v.POSITION!==void 0?l.getDependency("accessor",v.POSITION):n.attributes.position;d.push(_)}if(h){const _=v.NORMAL!==void 0?l.getDependency("accessor",v.NORMAL):n.attributes.normal;p.push(_)}if(u){const _=v.COLOR_0!==void 0?l.getDependency("accessor",v.COLOR_0):n.attributes.color;f.push(_)}}return Promise.all([Promise.all(d),Promise.all(p),Promise.all(f)]).then(function(g){const m=g[0],v=g[1],_=g[2];return c&&(n.morphAttributes.position=m),h&&(n.morphAttributes.normal=v),u&&(n.morphAttributes.color=_),n.morphTargetsRelative=!0,n})}(i,e.targets,t):i})}const Xm=new WeakMap;class C3 extends Bt{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,s){const a=new xi(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,n=>{this.parse(n,t,s)},r,s)}parse(e,t,r=()=>{}){this.decodeDracoFile(e,t,null,null,Mt).catch(r)}decodeDracoFile(e,t,r,s,a=si,n=()=>{}){const o={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:a};return this.decodeGeometry(e,o).then(t).catch(n)}decodeGeometry(e,t){const r=JSON.stringify(t);if(Xm.has(e)){const l=Xm.get(e);if(l.key===r)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const a=this.workerNextTaskID++,n=e.byteLength,o=this._getWorker(a,n).then(l=>(s=l,new Promise((c,h)=>{s._callbacks[a]={resolve:c,reject:h},s.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),Xm.set(e,{key:r,promise:o}),o}_createGeometry(e){const t=new Ie;e.index&&t.setIndex(new Ke(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const s=e.attributes[r],a=s.name,n=s.array,o=s.itemSize,l=new Ke(n,o);a==="color"&&(this._assignVertexColorSpace(l,s.vertexColorSpace),l.normalized=!(n instanceof Float32Array)),t.setAttribute(a,l)}return t}_assignVertexColorSpace(e,t){if(t!==Mt)return;const r=new ve;for(let s=0,a=e.count;s<a;s++)r.fromBufferAttribute(e,s).convertSRGBToLinear(),e.setXYZ(s,r.r,r.g,r.b)}_loadLibrary(e,t){const r=new xi(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((s,a)=>{r.load(e,s,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(r=>{const s=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const a=P3.toString(),n=["/* draco decoder */",s,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(a){const n=a.data;switch(n.type){case"decode":s._callbacks[n.id].resolve(n);break;case"error":s._callbacks[n.id].reject(n)}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function P3(){let i,e;function t(r,s,a,n,o,l){const c=l.num_components(),h=a.num_points()*c,u=h*o.BYTES_PER_ELEMENT,d=function(g,m){switch(m){case Float32Array:return g.DT_FLOAT32;case Int8Array:return g.DT_INT8;case Int16Array:return g.DT_INT16;case Int32Array:return g.DT_INT32;case Uint8Array:return g.DT_UINT8;case Uint16Array:return g.DT_UINT16;case Uint32Array:return g.DT_UINT32}}(r,o),p=r._malloc(u);s.GetAttributeDataArrayForAllPoints(a,l,d,u,p);const f=new o(r.HEAPF32.buffer,p,h).slice();return r._free(p),{name:n,array:f,itemSize:c}}onmessage=function(r){const s=r.data;switch(s.type){case"init":i=s.decoderConfig,e=new Promise(function(o){i.onModuleLoaded=function(l){o({draco:l})},DracoDecoderModule(i)});break;case"decode":const a=s.buffer,n=s.taskConfig;e.then(o=>{const l=o.draco,c=new l.Decoder;try{const h=function(d,p,f,g){const m=g.attributeIDs,v=g.attributeTypes;let _,y;const x=p.GetEncodedGeometryType(f);if(x===d.TRIANGULAR_MESH)_=new d.Mesh,y=p.DecodeArrayToMesh(f,f.byteLength,_);else{if(x!==d.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");_=new d.PointCloud,y=p.DecodeArrayToPointCloud(f,f.byteLength,_)}if(!y.ok()||_.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+y.error_msg());const b={index:null,attributes:[]};for(const M in m){const T=self[v[M]];let A,L;if(g.useUniqueIDs)L=m[M],A=p.GetAttributeByUniqueId(_,L);else{if(L=p.GetAttributeId(_,d[m[M]]),L===-1)continue;A=p.GetAttribute(_,L)}const U=t(d,p,_,M,T,A);M==="color"&&(U.vertexColorSpace=g.vertexColorSpace),b.attributes.push(U)}return x===d.TRIANGULAR_MESH&&(b.index=function(M,T,A){const L=A.num_faces(),U=3*L,P=4*U,E=M._malloc(P);T.GetTrianglesUInt32Array(A,P,E);const I=new Uint32Array(M.HEAPF32.buffer,E,U).slice();return M._free(E),{array:I,itemSize:1}}(d,p,_)),d.destroy(_),b}(l,c,new Int8Array(a),n),u=h.attributes.map(d=>d.array.buffer);h.index&&u.push(h.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:h},u)}catch(h){self.postMessage({type:"error",id:s.id,error:h.message})}finally{l.destroy(c)}})}}}const R3=/^[og]\s*(.+)?/,I3=/^mtllib /,L3=/^usemtl /,D3=/^usemap /,t1=/\s+/,i1=new C,qm=new C,r1=new C,s1=new C,vr=new C,Au=new ve;function O3(){const i={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const r=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(s,a){const n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);const o={index:this.materials.length,name:s||"",mtllib:Array.isArray(a)&&a.length>0?a[a.length-1]:"",smooth:n!==void 0?n.smooth:this.smooth,groupStart:n!==void 0?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(l){const c={index:typeof l=="number"?l:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return c.clone=this.clone.bind(c),c}};return this.materials.push(o),o},currentMaterial:function(){return this.materials.length>0?this.materials[this.materials.length-1]:void 0},_finalize:function(s){const a=this.currentMaterial();if(a&&a.groupEnd===-1&&(a.groupEnd=this.geometry.vertices.length/3,a.groupCount=a.groupEnd-a.groupStart,a.inherited=!1),s&&this.materials.length>1)for(let n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return s&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),a}},r&&r.name&&typeof r.clone=="function"){const s=r.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseNormalIndex:function(e,t){const r=parseInt(e,10);return 3*(r>=0?r-1:r+t/3)},parseUVIndex:function(e,t){const r=parseInt(e,10);return 2*(r>=0?r-1:r+t/2)},addVertex:function(e,t,r){const s=this.vertices,a=this.object.geometry.vertices;a.push(s[e+0],s[e+1],s[e+2]),a.push(s[t+0],s[t+1],s[t+2]),a.push(s[r+0],s[r+1],s[r+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,r){const s=this.normals,a=this.object.geometry.normals;a.push(s[e+0],s[e+1],s[e+2]),a.push(s[t+0],s[t+1],s[t+2]),a.push(s[r+0],s[r+1],s[r+2])},addFaceNormal:function(e,t,r){const s=this.vertices,a=this.object.geometry.normals;i1.fromArray(s,e),qm.fromArray(s,t),r1.fromArray(s,r),vr.subVectors(r1,qm),s1.subVectors(i1,qm),vr.cross(s1),vr.normalize(),a.push(vr.x,vr.y,vr.z),a.push(vr.x,vr.y,vr.z),a.push(vr.x,vr.y,vr.z)},addColor:function(e,t,r){const s=this.colors,a=this.object.geometry.colors;s[e]!==void 0&&a.push(s[e+0],s[e+1],s[e+2]),s[t]!==void 0&&a.push(s[t+0],s[t+1],s[t+2]),s[r]!==void 0&&a.push(s[r+0],s[r+1],s[r+2])},addUV:function(e,t,r){const s=this.uvs,a=this.object.geometry.uvs;a.push(s[e+0],s[e+1]),a.push(s[t+0],s[t+1]),a.push(s[r+0],s[r+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,r,s,a,n,o,l,c){const h=this.vertices.length;let u=this.parseVertexIndex(e,h),d=this.parseVertexIndex(t,h),p=this.parseVertexIndex(r,h);if(this.addVertex(u,d,p),this.addColor(u,d,p),o!==void 0&&o!==""){const f=this.normals.length;u=this.parseNormalIndex(o,f),d=this.parseNormalIndex(l,f),p=this.parseNormalIndex(c,f),this.addNormal(u,d,p)}else this.addFaceNormal(u,d,p);if(s!==void 0&&s!==""){const f=this.uvs.length;u=this.parseUVIndex(s,f),d=this.parseUVIndex(a,f),p=this.parseUVIndex(n,f),this.addUV(u,d,p),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let r=0,s=e.length;r<s;r++){const a=this.parseVertexIndex(e[r],t);this.addVertexPoint(a),this.addColor(a)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const r=this.vertices.length,s=this.uvs.length;for(let a=0,n=e.length;a<n;a++)this.addVertexLine(this.parseVertexIndex(e[a],r));for(let a=0,n=t.length;a<n;a++)this.addUVLine(this.parseUVIndex(t[a],s))}};return i.startObject("",!1),i}class N3 extends Bt{constructor(e){super(e),this.materials=null}load(e,t,r,s){const a=this,n=new xi(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(o){try{t(a.parse(o))}catch(l){s&&s(l),a.manager.itemError(e)}},r,s)}setMaterials(e){return this.materials=e,this}parse(e){const t=new O3;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const r=e.split(`
`);let s=[];for(let n=0,o=r.length;n<o;n++){const l=r[n].trimStart();if(l.length===0)continue;const c=l.charAt(0);if(c!=="#"){if(c==="v"){const h=l.split(t1);switch(h[0]){case"v":t.vertices.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])),h.length>=7?(Au.setRGB(parseFloat(h[4]),parseFloat(h[5]),parseFloat(h[6])).convertSRGBToLinear(),t.colors.push(Au.r,Au.g,Au.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]));break;case"vt":t.uvs.push(parseFloat(h[1]),parseFloat(h[2]))}}else if(c==="f"){const h=l.slice(1).trim().split(t1),u=[];for(let p=0,f=h.length;p<f;p++){const g=h[p];if(g.length>0){const m=g.split("/");u.push(m)}}const d=u[0];for(let p=1,f=u.length-1;p<f;p++){const g=u[p],m=u[p+1];t.addFace(d[0],g[0],m[0],d[1],g[1],m[1],d[2],g[2],m[2])}}else if(c==="l"){const h=l.substring(1).trim().split(" ");let u=[];const d=[];if(l.indexOf("/")===-1)u=h;else for(let p=0,f=h.length;p<f;p++){const g=h[p].split("/");g[0]!==""&&u.push(g[0]),g[1]!==""&&d.push(g[1])}t.addLineGeometry(u,d)}else if(c==="p"){const h=l.slice(1).trim().split(" ");t.addPointGeometry(h)}else if((s=R3.exec(l))!==null){const h=(" "+s[0].slice(1).trim()).slice(1);t.startObject(h)}else if(L3.test(l))t.object.startMaterial(l.substring(7).trim(),t.materialLibraries);else if(I3.test(l))t.materialLibraries.push(l.substring(7).trim());else if(!D3.test(l)){if(c==="s"){if(s=l.split(" "),s.length>1){const u=s[1].trim().toLowerCase();t.object.smooth=u!=="0"&&u!=="off"}else t.object.smooth=!0;const h=t.object.currentMaterial();h&&(h.smooth=t.object.smooth)}else if(l==="\0")continue}}}t.finalize();const a=new Mi;if(a.materialLibraries=[].concat(t.materialLibraries),t.objects.length===1&&t.objects[0].geometry.vertices.length===0){if(t.vertices.length>0){const n=new ga({size:1,sizeAttenuation:!1}),o=new Ie;o.setAttribute("position",new Se(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(o.setAttribute("color",new Se(t.colors,3)),n.vertexColors=!0);const l=new Ea(o,n);a.add(l)}}else for(let n=0,o=t.objects.length;n<o;n++){const l=t.objects[n],c=l.geometry,h=l.materials,u=c.type==="Line",d=c.type==="Points";let p=!1;if(c.vertices.length===0)continue;const f=new Ie;f.setAttribute("position",new Se(c.vertices,3)),c.normals.length>0&&f.setAttribute("normal",new Se(c.normals,3)),c.colors.length>0&&(p=!0,f.setAttribute("color",new Se(c.colors,3))),c.hasUVIndices===!0&&f.setAttribute("uv",new Se(c.uvs,2));const g=[];for(let v=0,_=h.length;v<_;v++){const y=h[v],x=y.name+"_"+y.smooth+"_"+p;let b=t.materials[x];if(this.materials!==null)if(b=this.materials.create(y.name),!u||!b||b instanceof Wt){if(d&&b&&!(b instanceof ga)){const M=new ga({size:10,sizeAttenuation:!1});$t.prototype.copy.call(M,b),M.color.copy(b.color),M.map=b.map,b=M}}else{const M=new Wt;$t.prototype.copy.call(M,b),M.color.copy(b.color),b=M}b===void 0&&(b=u?new Wt:d?new ga({size:1,sizeAttenuation:!1}):new Xn,b.name=y.name,b.flatShading=!y.smooth,b.vertexColors=p,t.materials[x]=b),g.push(b)}let m;if(g.length>1){for(let v=0,_=h.length;v<_;v++){const y=h[v];f.addGroup(y.groupStart,y.groupCount,v)}m=u?new tr(f,g):d?new Ea(f,g):new ye(f,g)}else m=u?new tr(f,g[0]):d?new Ea(f,g[0]):new ye(f,g[0]);m.name=l.name,a.add(m)}return a}}class U3 extends Bt{constructor(e){super(e)}load(e,t,r,s){const a=this,n=this.path===""?ds.extractUrlBase(e):this.path,o=new xi(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(a.parse(l,n))}catch(c){s&&s(c),a.manager.itemError(e)}},r,s)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const r=e.split(`
`);let s={};const a=/\s+/,n={};for(let l=0;l<r.length;l++){let c=r[l];if(c=c.trim(),c.length===0||c.charAt(0)==="#")continue;const h=c.indexOf(" ");let u=h>=0?c.substring(0,h):c;u=u.toLowerCase();let d=h>=0?c.substring(h+1):"";if(d=d.trim(),u==="newmtl")s={name:d},n[d]=s;else if(u==="ka"||u==="kd"||u==="ks"||u==="ke"){const p=d.split(a,3);s[u]=[parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2])]}else s[u]=d}const o=new k3(this.resourcePath||t,this.materialOptions);return o.setCrossOrigin(this.crossOrigin),o.setManager(this.manager),o.setMaterials(n),o}}class k3{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:Er,this.wrap=this.options.wrap!==void 0?this.options.wrap:Kt}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const r in e){const s=e[r],a={};t[r]=a;for(const n in s){let o=!0,l=s[n];const c=n.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(l=[l[0]/255,l[1]/255,l[2]/255]),this.options&&this.options.ignoreZeroRGBs&&l[0]===0&&l[1]===0&&l[2]===0&&(o=!1)}o&&(a[c]=l)}}return t}preload(){for(const e in this.materialsInfo)this.create(e)}getIndex(e){return this.nameLookup[e]}getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}create(e){return this.materials[e]===void 0&&this.createMaterial_(e),this.materials[e]}createMaterial_(e){const t=this,r=this.materialsInfo[e],s={name:e,side:this.side};function a(n,o){if(s[n])return;const l=t.getTextureParams(o,s),c=t.loadTexture((h=t.baseUrl,typeof(u=l.url)!="string"||u===""?"":/^https?:\/\//i.test(u)?u:h+u));var h,u;c.repeat.copy(l.scale),c.offset.copy(l.offset),c.wrapS=t.wrap,c.wrapT=t.wrap,n!=="map"&&n!=="emissiveMap"||(c.colorSpace=Mt),s[n]=c}for(const n in r){const o=r[n];let l;if(o!=="")switch(n.toLowerCase()){case"kd":s.color=new ve().fromArray(o).convertSRGBToLinear();break;case"ks":s.specular=new ve().fromArray(o).convertSRGBToLinear();break;case"ke":s.emissive=new ve().fromArray(o).convertSRGBToLinear();break;case"map_kd":a("map",o);break;case"map_ks":a("specularMap",o);break;case"map_ke":a("emissiveMap",o);break;case"norm":a("normalMap",o);break;case"map_bump":case"bump":a("bumpMap",o);break;case"map_d":a("alphaMap",o),s.transparent=!0;break;case"ns":s.shininess=parseFloat(o);break;case"d":l=parseFloat(o),l<1&&(s.opacity=l,s.transparent=!0);break;case"tr":l=parseFloat(o),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(s.opacity=1-l,s.transparent=!0)}}return this.materials[e]=new Xn(s),this.materials[e]}getTextureParams(e,t){const r={scale:new se(1,1),offset:new se(0,0)},s=e.split(/\s+/);let a;return a=s.indexOf("-bm"),a>=0&&(t.bumpScale=parseFloat(s[a+1]),s.splice(a,2)),a=s.indexOf("-s"),a>=0&&(r.scale.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),a=s.indexOf("-o"),a>=0&&(r.offset.set(parseFloat(s[a+1]),parseFloat(s[a+2])),s.splice(a,4)),r.url=s.join(" ").trim(),r}loadTexture(e,t,r,s,a){const n=this.manager!==void 0?this.manager:m0;let o=n.getHandler(e);o===null&&(o=new gs(n)),o.setCrossOrigin&&o.setCrossOrigin(this.crossOrigin);const l=o.load(e,r,s,a);return t!==void 0&&(l.mapping=t),l}}function F3(i,e,t=()=>{}){switch(e){case"GLTF":case"GLB":case"gltf":case"glb":return function(r="",s="/draco/",a=()=>{}){const n=new XC,o={progress:()=>{},complete:()=>{}};return n.setDRACOLoader(new C3().setDecoderPath(s)),n.load(r,l=>{o.complete(l.scene),l.scene.animations=l.animations,a(l.scene)},l=>o.progress(l.loaded/l.total,l),l=>{}),o}(i,Ng.dracoPath,r=>t(r));case"FBX":case"fbx":return function(r="",s){const a=new FC,n={progress:()=>{},complete:()=>{}};return a.load(r,o=>{n.complete(o),s(o)},o=>n.progress(o.loaded/o.total,o)),n}(i,r=>t(r));case"OBJ":case"obj":return function(r="",s=()=>{}){const a=new N3,n=new U3,o={progress:()=>{},complete:()=>{}};return n.load(r.replace(".obj",".mtl"),l=>{l.preload(),a.setMaterials(l),a.load(r,c=>{o.complete(c),s(c)},c=>o.progress(c.loaded/c.total,c),c=>{})}),o}(i,r=>t(r))}}const j0=$n,W0=Jn,YM=Ys;function Ep(i){return i.map(e=>mi(Re({},j0(e)),{children:Ep(e.children)}))}function Ap(i,e){i.length===e.length&&i.forEach((t,r)=>{W0(t,e[r]),t.children&&Ap(t.children,e[r].children)})}function X0(i,e){const{mixerFrames:t}=fl(i),r=function(a,n=()=>{}){const o=new kc,l=new Kx(a);return a.mixerAnimateRender=()=>{const c=o.getDelta();n(),l.update(c)},l}(i,()=>e.frameCallback),s=e.actionIndexs.map((a,n)=>a&&function(o,l,c=1,h=0,u=!0){const d=o.clipAction(l);return d.loop=u?Zg:Yg,d.time=h,d.timeScale=c,d.clampWhenFinished=!0,d}(r,i.animations[n],e.speed,e.startTime,e.loop).play()).filter(a=>a);return!t.find(a=>a===i)&&t.push(i),{actions:s,mixer:r}}function z3(i,e){e&&(W0(i,e),function(t,r){t.globalConfig=r;const{mesh:s,material:a}=r;r.useGlobalShadow&&function(n,o){n.traverse(l=>{l.castShadow=o.castShadow,l.receiveShadow=o.receiveShadow})}(t,s),r.useGlobalMaterial&&function(n,o){n.RootMaterials.forEach(l=>{l.envMapIntensity=o.envMapIntensity,l.reflectivity=o.reflectivity,o.envMap&&(l.envMap=n.parent.envBackground),o.isGlobalMap===!1&&(l.recordMap=l.map,l.map=null),l.needsUpdate=!0}),o.envMap&&n.parent.envMapChangeUseList.push(()=>n.RootMaterials.forEach(l=>l.envMap=n.parent.envBackground))}(t,a)}(i,e.globalConfig),i.globalConfig.isSaveChildren&&Ap(i.children,e.children),i.globalConfig.isSaveMaterials&&i.RootMaterials.forEach((t,r)=>V0(t,e.RootMaterials[r])),function(t,r){r&&(t.animationPlayParams=r,r.initPlay&&X0(t,r))}(i,e.animationPlayParams))}function ZM(i,e,t,r,s){return YM(r,s.addFolder("物体控制")),function(a,n){n.add(a.globalConfig,"isSaveChildren").name("子物体更改存储"),n.add(a.globalConfig,"isSaveMaterials").name("单材质更改存储"),n.addFn(()=>a.traverse(o=>o.visible=!0)).name("显示全部子项"),function(o,l){l.add(o.globalConfig,"useGlobalShadow").name("存储全局配置"),l.add(o.globalConfig.mesh,"castShadow").name("产生阴影").onChange(c=>o.traverse(h=>h.castShadow=c)),l.add(o.globalConfig.mesh,"receiveShadow").name("接收阴影").onChange(c=>o.traverse(h=>h.receiveShadow=c))}(a,n.addFolder("(全局)阴影配置")),function(o,l){l.add(o.globalConfig,"useGlobalMaterial").name("存储全局配置"),l.add(o.globalConfig.material,"envMap").name("环境贴图").onChange(c=>o.RootMaterials.forEach(h=>h.envMap=c?o.parent.envBackground:null)),l.add(o.globalConfig.material,"envMapIntensity").name("环境贴图强度").onChange(c=>o.RootMaterials.forEach(h=>h.envMapIntensity=c)).onFinishChange(c=>o.RootMaterials.forEach(h=>h.needsUpdate=!0)),l.add(o.globalConfig.material,"reflectivity",0,1).name("反射强度").onChange(c=>o.RootMaterials.forEach(h=>h.reflectivity=c)).onFinishChange(c=>o.RootMaterials.forEach(h=>h.needsUpdate=!0)),l.add(o.globalConfig.material,"isGlobalMap").name("全局贴图").onChange(c=>{o.RootMaterials.forEach(h=>{c?(h.map=h.recordMap,h.needsUpdate=!0):(h.recordMap=h.map,h.map=null,h.needsUpdate=!0)})}).onFinishChange(c=>o.RootMaterials.forEach(h=>h.needsUpdate=!0))}(a,n.addFolder("(全局)材质配置"))}(r,s.addFolder("全局和子项控制")),function(a,n){if(!a.animationPlayParams)return;n.add(a.animationPlayParams,"initPlay").name("初始加载播放"),n.add(a.animationPlayParams,"speed").min(-10).max(10).name("播放速度"),n.add(a.animationPlayParams,"startTime").name("开始时间"),n.add(a.animationPlayParams,"loop").name("循环播放");const o=n.addFolder("播放列表");a.animations.map((l,c)=>o.add(a.animationPlayParams.actionIndexs,c).name(l.name+":"+l.duration.toFixed(2)+"s")),o.addFn(()=>X0(a,a.animationPlayParams)).name("播放选择动作")}(r,s.addFolder("动画配置")),s.addFn(()=>e.attach(r)).name("选中"),s.addFn(()=>{const{frontView:a,target:n}=O0(r,i.object.fov);Tr(i.object.position,a),Tr(i.target,n),t.effectPass.outlinePass.selectedObjects=[r]}).name("定位物体"),s.addFn(()=>{r.parent.remove(r),s.parent.removeFolder(s)}).name("删除"),s}function sr(i){let e="";return i.name||(e="-"),i.name.length>10?e+=i.name.slice(0,10)+"...":e+=i.name,e+=` ${i.id} `,e}function B3(i,e,t,r,s){Object.assign(i,{scene:e,controls:t,transformControls:r,effectComposer:s}),i.insertModel=function(a,n){const{url:o,type:l}=a;return{loaderService:F3(o,l,c=>{var h,u;if(e.add(((u=c).globalConfig={useGlobalShadow:!1,useGlobalMaterial:!1,isSaveChildren:!0,isSaveMaterials:!0,mesh:{castShadow:!1,receiveShadow:!1},material:{envMap:!1,envMapIntensity:1,reflectivity:.98,isGlobalMap:!0}},u.RootMaterials=Tp(u),((h=u.animations)==null?void 0:h.length)>0&&(u.animationPlayParams={initPlay:!1,speed:.5,actionIndexs:new Array(u.animations.length).fill(!1),startTime:0,loop:!1,frameCallback:()=>{}}),u)),c.rootInfo=a,z3(c,n),!i.rootFolder)return;const d=i.rootFolder.addFolder(sr(c));ZM(t,r,s,c,d)}),rootInfo:a,params:n}}}function V3(i){return i.map(e=>function(t){const{animationPlayParams:r,children:s,RootMaterials:a,rootInfo:n}=t;return{group:mi(Re({},j0(t)),{globalConfig:t.globalConfig,animationPlayParams:r,RootMaterials:t.globalConfig.isSaveMaterials?a.map(o=>B0(o)):void 0,children:t.globalConfig.isSaveChildren?Ep(s):void 0}),rootInfo:n}}(e))}function H3(i){return i.map(e=>function(t){const{material:r,geometry:s}=t,{geometryType:a,parameters:n}=s;return mi(Re({},$n(t)),{geometry:{geometryType:a,parameters:n},material:Mp(r)})}(e))}function G3(i,e){e==null||e.forEach(t=>function(r,s){if(!s)return;const{geometry:a,material:n}=s,{geometryType:o,parameters:l}=a,c=N0(o,l),h=Wr(n.materialType),u=new ye(c,h);return u.isInnerMesh=!0,r.add(u),wp(r,u.material,n),Jn(u,s),u}(i,t))}function j3(i,e,t){const r=t.addFolder("已有列表");return r.open(),t.add(i,"geometryType",QE).name("几何体"),t.add(i,"materialType",qo).name("材质"),t.addFn(()=>{const s=function(a,n){const o=N0(a),l=Wr(n),c=new ye(o,l);return c.isInnerMesh=!0,c}(i.geometryType,i.materialType);e.attach_add(s),Dy(e,s,r.addFolder(s.geometry.geometryType+":"+sr(s)))}).name("添加"),e.children.forEach(s=>{s.isInnerMesh&&Dy(e,s,r.addFolder(s.geometry.geometryType+":"+sr(s)))}),t}class KM extends Qn{constructor(e,t={}){const r=t.font;if(r===void 0)super();else{const s=r.generateShapes(e,t.size);t.depth===void 0&&t.height,t.depth=t.depth!==void 0?t.depth:t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(s,t)}this.type="TextGeometry"}}class W3 extends Bt{constructor(e){super(e)}load(e,t,r,s){const a=this,n=new xi(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,function(o){const l=a.parse(JSON.parse(o));t&&t(l)},r,s)}parse(e){return new X3(e)}}class X3{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const r=[],s=function(a,n,o){const l=Array.from(a),c=n/o.resolution,h=(o.boundingBox.yMax-o.boundingBox.yMin+o.underlineThickness)*c,u=[];let d=0,p=0;for(let f=0;f<l.length;f++){const g=l[f];if(g===`
`)d=0,p-=h;else{const m=q3(g,c,d,p,o);d+=m.offsetX,u.push(m.path)}}return u}(e,t,this.data);for(let a=0,n=s.length;a<n;a++)r.push(...s[a].toShapes());return r}}function q3(i,e,t,r,s){const a=s.glyphs[i]||s.glyphs["?"];if(!a)return;const n=new rb;let o,l,c,h,u,d,p,f;if(a.o){const g=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let m=0,v=g.length;m<v;)switch(g[m++]){case"m":o=g[m++]*e+t,l=g[m++]*e+r,n.moveTo(o,l);break;case"l":o=g[m++]*e+t,l=g[m++]*e+r,n.lineTo(o,l);break;case"q":c=g[m++]*e+t,h=g[m++]*e+r,u=g[m++]*e+t,d=g[m++]*e+r,n.quadraticCurveTo(u,d,c,h);break;case"b":c=g[m++]*e+t,h=g[m++]*e+r,u=g[m++]*e+t,d=g[m++]*e+r,p=g[m++]*e+t,f=g[m++]*e+r,n.bezierCurveTo(u,d,p,f,c,h)}}return{offsetX:a.ha*e,path:n}}function a1(i,e="fence"){const t=i.length,r=e==="fence"?i.map((d,p)=>p-1>-1&&p+1<t&&(p%2==0?[p,p+1,p-1]:[p,p-1,p+1])).filter(d=>d).reduce((d,p)=>[...d,...p],[]):i.map((d,p)=>p>=2&&[0,p-1,p]).filter(d=>d).reduce((d,p)=>[...d,...p],[]),s=i.reduce((d,p)=>[...d,p.x,p.y,p.z],[]),a=i.reduce((d,p)=>({x:[...d.x,p.x],y:[...d.y,p.y],z:[...d.z,p.z]}),{x:[],y:[],z:[]}),n=new C(Math.max(...a.x),Math.max(...a.y),Math.max(...a.z)),o=new C(Math.min(...a.x),Math.min(...a.y),Math.min(...a.z)),l=n.x-o.x,c=n.y-o.y,h=l>c?l:c,u=i.map(d=>new se((d.x-o.x)/h,(d.y-o.y)/h)).reduce((d,p)=>[...d,...p],[]);return{indexGroup:r,faceGroup:s,uvGroup:u}}function n1(i,e,t){const r=new Ie,s=new Float32Array(i);if(r.setAttribute("position",new Ke(s,3)),e){let a=new Uint16Array(e);r.index=new Ke(a,1)}return t&&(r.attributes.uv=new Se(t,2)),r.computeVertexNormals(),r}function o1(i,e,t,r){i.setIndex(t),i.setAttribute("position",new Se(e,3)),i.setAttribute("uv",new Se(r,2)),delete i.attributes.normal,i.computeVertexNormals()}function QM(i,e,t=null){const r=new W3;return new Promise(s=>{r.load(i,a=>s(new KM(e,Re({font:a,size:1,depth:.2,height:.2,curveSegments:12,bevelEnabled:!0,bevelThickness:0,bevelSize:0,bevelSegments:5},t))))})}const l1=new Tt,Cu=new C;class $M extends g0{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new Se([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new Se([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new vd(t,6,1);return this.setAttribute("instanceStart",new qi(r,3,0)),this.setAttribute("instanceEnd",new qi(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const r=new vd(t,6,1);return this.setAttribute("instanceColorStart",new qi(r,3,0)),this.setAttribute("instanceColorEnd",new qi(r,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new l0(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Tt);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),l1.setFromBufferAttribute(t),this.boundingBox.union(l1))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new oi),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const r=this.boundingSphere.center;this.boundingBox.getCenter(r);let s=0;for(let a=0,n=e.count;a<n;a++)Cu.fromBufferAttribute(e,a),s=Math.max(s,r.distanceToSquared(Cu)),Cu.fromBufferAttribute(t,a),s=Math.max(s,r.distanceToSquared(Cu));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)}}toJSON(){}applyMatrix(e){return this.applyMatrix4(e)}}Te.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new se(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},ki.line={uniforms:ii.merge([Te.common,Te.fog,Te.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class q0 extends at{constructor(e){super({type:"LineMaterial",uniforms:ii.clone(ki.line.uniforms),vertexShader:ki.line.vertexShader,fragmentShader:ki.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const c1=new C,h1=new C,gi=new qe,vi=new qe,Qr=new qe,Ym=new C,Zm=new Me,_i=new Qx,u1=new C,Pu=new Tt,Ru=new oi,$r=new qe;let Jr,bn;function d1(i,e,t){return $r.set(0,0,-e,1).applyMatrix4(i.projectionMatrix),$r.multiplyScalar(1/$r.w),$r.x=bn/t.width,$r.y=bn/t.height,$r.applyMatrix4(i.projectionMatrixInverse),$r.multiplyScalar(1/$r.w),Math.abs(Math.max($r.x,$r.y))}class Y3 extends ye{constructor(e=new $M,t=new q0({color:16777215*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,s=new Float32Array(2*t.count);for(let n=0,o=0,l=t.count;n<l;n++,o+=2)c1.fromBufferAttribute(t,n),h1.fromBufferAttribute(r,n),s[o]=o===0?0:s[o-1],s[o+1]=s[o]+c1.distanceTo(h1);const a=new vd(s,2,1);return e.setAttribute("instanceDistanceStart",new qi(a,1,0)),e.setAttribute("instanceDistanceEnd",new qi(a,1,1)),this}raycast(e,t){const r=this.material.worldUnits,s=e.camera,a=e.params.Line2!==void 0&&e.params.Line2.threshold||0;Jr=e.ray;const n=this.matrixWorld,o=this.geometry,l=this.material;let c,h;bn=l.linewidth+a,o.boundingSphere===null&&o.computeBoundingSphere(),Ru.copy(o.boundingSphere).applyMatrix4(n),r?c=.5*bn:c=d1(s,Math.max(s.near,Ru.distanceToPoint(Jr.origin)),l.resolution),Ru.radius+=c,Jr.intersectsSphere(Ru)!==!1&&(o.boundingBox===null&&o.computeBoundingBox(),Pu.copy(o.boundingBox).applyMatrix4(n),r?h=.5*bn:h=d1(s,Math.max(s.near,Pu.distanceToPoint(Jr.origin)),l.resolution),Pu.expandByScalar(h),Jr.intersectsBox(Pu)!==!1&&(r?function(u,d){const p=u.matrixWorld,f=u.geometry,g=f.attributes.instanceStart,m=f.attributes.instanceEnd;for(let v=0,_=Math.min(f.instanceCount,g.count);v<_;v++){_i.start.fromBufferAttribute(g,v),_i.end.fromBufferAttribute(m,v),_i.applyMatrix4(p);const y=new C,x=new C;Jr.distanceSqToSegment(_i.start,_i.end,x,y),x.distanceTo(y)<.5*bn&&d.push({point:x,pointOnLine:y,distance:Jr.origin.distanceTo(x),object:u,face:null,faceIndex:v,uv:null,uv1:null})}}(this,t):function(u,d,p){const f=d.projectionMatrix,g=u.material.resolution,m=u.matrixWorld,v=u.geometry,_=v.attributes.instanceStart,y=v.attributes.instanceEnd,x=Math.min(v.instanceCount,_.count),b=-d.near;Jr.at(1,Qr),Qr.w=1,Qr.applyMatrix4(d.matrixWorldInverse),Qr.applyMatrix4(f),Qr.multiplyScalar(1/Qr.w),Qr.x*=g.x/2,Qr.y*=g.y/2,Qr.z=0,Ym.copy(Qr),Zm.multiplyMatrices(d.matrixWorldInverse,m);for(let M=0,T=x;M<T;M++){if(gi.fromBufferAttribute(_,M),vi.fromBufferAttribute(y,M),gi.w=1,vi.w=1,gi.applyMatrix4(Zm),vi.applyMatrix4(Zm),gi.z>b&&vi.z>b)continue;if(gi.z>b){const E=gi.z-vi.z,I=(gi.z-b)/E;gi.lerp(vi,I)}else if(vi.z>b){const E=vi.z-gi.z,I=(vi.z-b)/E;vi.lerp(gi,I)}gi.applyMatrix4(f),vi.applyMatrix4(f),gi.multiplyScalar(1/gi.w),vi.multiplyScalar(1/vi.w),gi.x*=g.x/2,gi.y*=g.y/2,vi.x*=g.x/2,vi.y*=g.y/2,_i.start.copy(gi),_i.start.z=0,_i.end.copy(vi),_i.end.z=0;const A=_i.closestPointToPointParameter(Ym,!0);_i.at(A,u1);const L=ni.lerp(gi.z,vi.z,A),U=L>=-1&&L<=1,P=Ym.distanceTo(u1)<.5*bn;if(U&&P){_i.start.fromBufferAttribute(_,M),_i.end.fromBufferAttribute(y,M),_i.start.applyMatrix4(m),_i.end.applyMatrix4(m);const E=new C,I=new C;Jr.distanceSqToSegment(_i.start,_i.end,I,E),p.push({point:I,pointOnLine:E,distance:Jr.origin.distanceTo(I),object:u,face:null,faceIndex:M,uv:null,uv1:null})}}}(this,s,t)))}}class JM extends $M{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,r=new Float32Array(2*t);for(let s=0;s<t;s+=3)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];return super.setPositions(r),this}setColors(e){const t=e.length-3,r=new Float32Array(2*t);for(let s=0;s<t;s+=3)r[2*s]=e[s],r[2*s+1]=e[s+1],r[2*s+2]=e[s+2],r[2*s+3]=e[s+3],r[2*s+4]=e[s+4],r[2*s+5]=e[s+5];return super.setColors(r),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class Z3 extends Y3{constructor(e=new JM,t=new q0({color:16777215*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}function ew(i){new Tt().setFromObject(i).getCenter(i.position),i.geometry.center()}function K3(i,e){var t,r;const{drawPointList:s}=e;if(s.length<2)return void(e.mesh&&(i.remove(e.mesh),e.mesh=null,(t=e.callback)==null?void 0:t.call(e,"remove")));const a=e.drawPointList.reduce((n,o)=>[...n,o.x,o.y+.001,o.z],[]);if(!e.mesh&&e.drawPointList.length>1){const n=function(o){const l=new q0({color:0,linewidth:.001,vertexColors:!1,dashed:!1,alphaToCoverage:!1}),c=new JM().setPositions(o),h=new Z3(c,l);return h.computeLineDistances(),h}(a);n.isDrawMesh=!0,n.drawParams=e,e.mesh=n,i.add(e.mesh),(r=e.callback)==null||r.call(e,"set")}else e.mesh&&e.drawPointList.length>0&&(e.mesh.geometry.dispose(),e.mesh.geometry.setPositions(a),e.mesh.computeLineDistances(),e.mesh.geometry.attributes.position.needsUpdate=!0)}function p1(i,e,t,r){const s=t.addFolder("相关控制"),a=t.addFolder("点列表");s.open(),a.open();const n=r||{mode:i.mode,materialType:i.materialType,drawPointList:[],mesh:null};function o(l){n.drawPointList.push(l),Ur(e,n),m1(e,n,l,a)}n.callback=function(l){if(l==="remove")for(const c in s.__folders)s.removeFolder(s.__folders[c]);else{Ys(this.mesh,s.addFolder("变换配置"));const c=s.addFolder("材质配置");Sp(e,this.mesh.material,c),this.mode==="直线路径"&&c.add(this.mesh.material,"linewidth").name("线宽")}},function(l,c,h,u){if(c.mode==="围栏物体")u||(c.fenceHeight=50,c.fenceClose=!0),h.add(c,"fenceHeight").name("围栏高度").onChange(()=>Ur(l,c)),h.add(c,"fenceClose").name("围栏闭合").onChange(()=>Ur(l,c));else if(c.mode==="曲线路径"){u||(c.height=10,c.axial="y",c.tubularSegments=64,c.radius=.08,c.radialSegments=8,c.closed=!1);const d=h.addFolder("曲线配置");d.add(c,"height").name("高度").onChange(()=>Ur(l,c)),d.add(c,"axial",["x","y","z"]).name("轴向").onChange(()=>Ur(l,c)),d.add(c,"tubularSegments",1).name("管道分段").onChange(()=>Ur(l,c)).step(1),d.add(c,"radius",.01).name("管道半径").onChange(()=>Ur(l,c)),d.add(c,"radialSegments",1).name("管道半径分段").onChange(()=>Ur(l,c)).step(1),d.add(c,"closed").name("管道闭合").onChange(()=>Ur(l,c))}}(e,n,t,r),r&&(n.drawPointList.forEach(l=>m1(e,n,l,a)),n.callback("set")),t.addFn(()=>n.mesh&&e.transformControls.attach(n.mesh)).name("选中物体"),t.addFn(()=>{i.drawEventCall=o}).name("操作当前组"),t.addFn(()=>{t.parent.removeFolder(t),n.mesh&&e.remove(n.mesh),i.drawEventCall=null}).name("移除此组"),i.drawEventCall=o}function m1(i,e,t,r){const s=e.drawPointList,a=r.addFn(()=>{const n=s.indexOf(t);n>-1&&s.splice(n,1),Ur(i,e),r.remove(a)}).name("移除点"+[t.x,t.y,t.z].map(n=>n.toFixed(2)).join(","))}function Ur(i,e){switch(e.mode){case"围栏物体":(function(t,r){var s,a;const n=[...r.drawPointList];if(n.length<2)return void(r.mesh&&(t.remove(r.mesh),sd(r.mesh),r.mesh=null,(s=r.callback)==null?void 0:s.call(r,"remove")));r.fenceClose&&r.drawPointList.length>2&&n.push(r.drawPointList[0]);const o=n.reduce((u,d)=>{const p=new C().copy(d);return p.y+=r.fenceHeight,[...u,p,d]},[]),{indexGroup:l,faceGroup:c,uvGroup:h}=a1(o);if(o.length>3&&!r.mesh){const u=n1(c,l,h),d=Wr(r.materialType,{color:16777215}),p=new ye(u,d);p.isDrawMesh=!0,p.drawParams=r,r.mesh=p,t.add(r.mesh),(a=r.callback)==null||a.call(r,"set")}else r.mesh&&o1(r.mesh.geometry,c,l,h)})(i,e);break;case"平面绘制":(function(t,r){var s,a;const n=[...r.drawPointList];if(n.length<3)return void(r.mesh&&(t.remove(r.mesh),sd(r.mesh),r.mesh=null,(s=r.callback)==null?void 0:s.call(r,"remove")));n.forEach(h=>h.y+=.001);const{indexGroup:o,faceGroup:l,uvGroup:c}=a1(n,"face");if(r.drawPointList.length>2&&!r.mesh){const h=n1(l,o,c),u=Wr(r.materialType,{color:16777215}),d=new ye(h,u);d.isDrawMesh=!0,d.drawParams=r,r.mesh=d,t.add(r.mesh),(a=r.callback)==null||a.call(r,"set")}else r.mesh&&o1(r.mesh.geometry,l,o,c)})(i,e);break;case"曲线路径":(function(t,r){var s,a;const{drawPointList:n,height:o,axial:l,tubularSegments:c,radius:h,radialSegments:u,closed:d}=r;if(n.length<2)return void(r.mesh&&(t.remove(r.mesh),sd(r.mesh),r.mesh=null,(s=r.callback)==null?void 0:s.call(r,"remove")));const p=n.map(g=>new C(g.x,g.y,g.z)).map((g,m,v)=>{if(v[m+1]){const _=g.clone().add(v[m+1]).divideScalar(2);return _[l]+=o,[g,_]}return[g]}).flat(),f=new cp(p);if(r.mesh)r.mesh.geometry.dispose(),r.mesh.geometry=new Gs(f,c,h,u,d);else{const g=new Gs(f,c,h,u,d),m=Wr(r.materialType,{color:16777215}),v=new ye(g,m);v.isCurveMesh=!0,v.isDrawMesh=!0,v.drawParams=r,r.mesh=v,t.add(r.mesh),(a=r.callback)==null||a.call(r,"set")}})(i,e);break;case"直线路径":K3(i,e)}}function Q3(i){return i.map(e=>function(t){const r={};return Object.keys(t.drawParams).forEach(s=>{["mesh","folder","callback"].includes(s)||(r[s]=t.drawParams[s])}),mi(Re({},$n(t)),{material:Mp(t.material),drawParams:r})}(e))}function $3(i,e){e==null||e.map(t=>function(r,s){if(!s)return;const{drawParams:a}=s;Ur(r,a);const{mesh:n}=a;return Jn(n,s),wp(r,n.material,s.material),a}(i,t))}var Un=1,kn=2,Zo=3,J3=4,Ig=5,f1=6378137,eP=6356752314e-3,g1=.0066943799901413165,bc=484813681109536e-20,be=Math.PI/2,tP=.16666666666666666,iP=.04722222222222222,rP=.022156084656084655,Ae=1e-10,yi=.017453292519943295,Ma=57.29577951308232,dt=Math.PI/4,Zc=2*Math.PI,Gt=3.14159265359,sP={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const aP={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var v1=/[\s_\-\/\(\)]/g;function wa(i,e){if(i[e])return i[e];for(var t,r=Object.keys(i),s=e.toLowerCase().replace(v1,""),a=-1;++a<r.length;)if((t=r[a]).toLowerCase().replace(v1,"")===s)return i[t]}function Lg(i){var e,t,r,s={},a=i.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,l){var c=l.split("=");return c.push(!0),o[c[0].toLowerCase()]=c[1],o},{}),n={proj:"projName",datum:"datumCode",rf:function(o){s.rf=parseFloat(o)},lat_0:function(o){s.lat0=o*yi},lat_1:function(o){s.lat1=o*yi},lat_2:function(o){s.lat2=o*yi},lat_ts:function(o){s.lat_ts=o*yi},lon_0:function(o){s.long0=o*yi},lon_1:function(o){s.long1=o*yi},lon_2:function(o){s.long2=o*yi},alpha:function(o){s.alpha=parseFloat(o)*yi},gamma:function(o){s.rectified_grid_angle=parseFloat(o)},lonc:function(o){s.longc=o*yi},x_0:function(o){s.x0=parseFloat(o)},y_0:function(o){s.y0=parseFloat(o)},k_0:function(o){s.k0=parseFloat(o)},k:function(o){s.k0=parseFloat(o)},a:function(o){s.a=parseFloat(o)},b:function(o){s.b=parseFloat(o)},r:function(o){s.a=s.b=parseFloat(o)},r_a:function(){s.R_A=!0},zone:function(o){s.zone=parseInt(o,10)},south:function(){s.utmSouth=!0},towgs84:function(o){s.datum_params=o.split(",").map(function(l){return parseFloat(l)})},to_meter:function(o){s.to_meter=parseFloat(o)},units:function(o){s.units=o;var l=wa(aP,o);l&&(s.to_meter=l.to_meter)},from_greenwich:function(o){s.from_greenwich=o*yi},pm:function(o){var l=wa(sP,o);s.from_greenwich=(l||parseFloat(o))*yi},nadgrids:function(o){o==="@null"?s.datumCode="none":s.nadgrids=o},axis:function(o){var l="ewnsud";o.length===3&&l.indexOf(o.substr(0,1))!==-1&&l.indexOf(o.substr(1,1))!==-1&&l.indexOf(o.substr(2,1))!==-1&&(s.axis=o)},approx:function(){s.approx=!0}};for(e in a)t=a[e],e in n?typeof(r=n[e])=="function"?r(t):s[r]=t:s[e]=t;return typeof s.datumCode=="string"&&s.datumCode!=="WGS84"&&(s.datumCode=s.datumCode.toLowerCase()),s}var sc=1,nP=/\s/,oP=/[A-Za-z]/,lP=/[A-Za-z84_]/,Iu=/[,\]]/,_1=/[\d\.E\-\+]/;function Rs(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=sc}function y1(i,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var r=e?{}:i,s=t.reduce(function(a,n){return ko(n,a),a},r);e&&(i[e]=s)}function ko(i,e){if(Array.isArray(i)){var t=i.shift();if(t==="PARAMETER"&&(t=i.shift()),i.length===1)return Array.isArray(i[0])?(e[t]={},void ko(i[0],e[t])):void(e[t]=i[0]);if(i.length)if(t!=="TOWGS84"){if(t==="AXIS")return t in e||(e[t]=[]),void e[t].push(i);var r;switch(Array.isArray(t)||(e[t]={}),t){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[t]={name:i[0].toLowerCase(),convert:i[1]},void(i.length===3&&ko(i[2],e[t]));case"SPHEROID":case"ELLIPSOID":return e[t]={name:i[0],a:i[1],rf:i[2]},void(i.length===4&&ko(i[3],e[t]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return i[0]=["name",i[0]],void y1(e,t,i);default:for(r=-1;++r<i.length;)if(!Array.isArray(i[r]))return ko(i,e[t]);return y1(e,t,i)}}else e[t]=i;else e[t]=!0}else e[i]=!0}Rs.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==4)for(;nP.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case sc:return this.neutral(i);case 2:return this.keyword(i);case 4:return this.quoted(i);case 5:return this.afterquote(i);case 3:return this.number(i);case-1:return}},Rs.prototype.afterquote=function(i){if(i==='"')return this.word+='"',void(this.state=4);if(Iu.test(i))return this.word=this.word.trim(),void this.afterItem(i);throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)},Rs.prototype.afterItem=function(i){return i===","?(this.word!==null&&this.currentObject.push(this.word),this.word=null,void(this.state=sc)):i==="]"?(this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=sc,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},Rs.prototype.number=function(i){if(!_1.test(i)){if(Iu.test(i))return this.word=parseFloat(this.word),void this.afterItem(i);throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)}this.word+=i},Rs.prototype.quoted=function(i){i!=='"'?this.word+=i:this.state=5},Rs.prototype.keyword=function(i){if(lP.test(i))this.word+=i;else{if(i==="["){var e=[];return e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=sc)}if(!Iu.test(i))throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place);this.afterItem(i)}},Rs.prototype.neutral=function(i){if(oP.test(i))return this.word=i,void(this.state=2);if(i==='"')return this.word="",void(this.state=4);if(_1.test(i))return this.word=i,void(this.state=3);if(!Iu.test(i))throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place);this.afterItem(i)},Rs.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===-1)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var cP=.017453292519943295;function es(i){return i*cP}function tw(i){var e=new Rs(i).output(),t=e.shift(),r=e.shift();e.unshift(["name",r]),e.unshift(["type",t]);var s={};return ko(e,s),function(a){if(a.type==="GEOGCS"?a.projName="longlat":a.type==="LOCAL_CS"?(a.projName="identity",a.local=!0):typeof a.PROJECTION=="object"?a.projName=Object.keys(a.PROJECTION)[0]:a.projName=a.PROJECTION,a.AXIS){for(var n="",o=0,l=a.AXIS.length;o<l;++o){var c=[a.AXIS[o][0].toLowerCase(),a.AXIS[o][1].toLowerCase()];c[0].indexOf("north")!==-1||(c[0]==="y"||c[0]==="lat")&&c[1]==="north"?n+="n":c[0].indexOf("south")!==-1||(c[0]==="y"||c[0]==="lat")&&c[1]==="south"?n+="s":c[0].indexOf("east")!==-1||(c[0]==="x"||c[0]==="lon")&&c[1]==="east"?n+="e":c[0].indexOf("west")===-1&&(c[0]!=="x"&&c[0]!=="lon"||c[1]!=="west")||(n+="w")}n.length===2&&(n+="u"),n.length===3&&(a.axis=n)}a.UNIT&&(a.units=a.UNIT.name.toLowerCase(),a.units==="metre"&&(a.units="meter"),a.UNIT.convert&&(a.type==="GEOGCS"?a.DATUM&&a.DATUM.SPHEROID&&(a.to_meter=a.UNIT.convert*a.DATUM.SPHEROID.a):a.to_meter=a.UNIT.convert));var h=a.GEOGCS;function u(d){return d*(a.to_meter||1)}a.type==="GEOGCS"&&(h=a),h&&(h.DATUM?a.datumCode=h.DATUM.name.toLowerCase():a.datumCode=h.name.toLowerCase(),a.datumCode.slice(0,2)==="d_"&&(a.datumCode=a.datumCode.slice(2)),a.datumCode!=="new_zealand_geodetic_datum_1949"&&a.datumCode!=="new_zealand_1949"||(a.datumCode="nzgd49"),a.datumCode!=="wgs_1984"&&a.datumCode!=="world_geodetic_system_1984"||(a.PROJECTION==="Mercator_Auxiliary_Sphere"&&(a.sphere=!0),a.datumCode="wgs84"),a.datumCode.slice(-6)==="_ferro"&&(a.datumCode=a.datumCode.slice(0,-6)),a.datumCode.slice(-8)==="_jakarta"&&(a.datumCode=a.datumCode.slice(0,-8)),~a.datumCode.indexOf("belge")&&(a.datumCode="rnb72"),h.DATUM&&h.DATUM.SPHEROID&&(a.ellps=h.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),a.ellps.toLowerCase().slice(0,13)==="international"&&(a.ellps="intl"),a.a=h.DATUM.SPHEROID.a,a.rf=parseFloat(h.DATUM.SPHEROID.rf,10)),h.DATUM&&h.DATUM.TOWGS84&&(a.datum_params=h.DATUM.TOWGS84),~a.datumCode.indexOf("osgb_1936")&&(a.datumCode="osgb36"),~a.datumCode.indexOf("osni_1952")&&(a.datumCode="osni52"),(~a.datumCode.indexOf("tm65")||~a.datumCode.indexOf("geodetic_datum_of_1965"))&&(a.datumCode="ire65"),a.datumCode==="ch1903+"&&(a.datumCode="ch1903"),~a.datumCode.indexOf("israel")&&(a.datumCode="isr93")),a.b&&!isFinite(a.b)&&(a.b=a.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",es],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",es],["x0","false_easting",u],["y0","false_northing",u],["long0","central_meridian",es],["lat0","latitude_of_origin",es],["lat0","standard_parallel_1",es],["lat1","standard_parallel_1",es],["lat2","standard_parallel_2",es],["azimuth","Azimuth"],["alpha","azimuth",es],["srsCode","name"]].forEach(function(d){return function(p,f){var g=f[0],m=f[1];!(g in p)&&m in p&&(p[g]=p[m],f.length===3&&(p[g]=f[2](p[g])))}(a,d)}),a.long0||!a.longc||a.projName!=="Albers_Conic_Equal_Area"&&a.projName!=="Lambert_Azimuthal_Equal_Area"||(a.long0=a.longc),a.lat_ts||!a.lat1||a.projName!=="Stereographic_South_Pole"&&a.projName!=="Polar Stereographic (variant B)"?!a.lat_ts&&a.lat0&&a.projName==="Polar_Stereographic"&&(a.lat_ts=a.lat0,a.lat0=es(a.lat0>0?90:-90)):(a.lat0=es(a.lat1>0?90:-90),a.lat_ts=a.lat1)}(s),s}function Ui(i){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?Ui[i]=Lg(arguments[1]):Ui[i]=tw(arguments[1]):Ui[i]=t}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(r){Array.isArray(r)?Ui.apply(e,r):Ui(r)});if(typeof i=="string"){if(i in Ui)return Ui[i]}else"EPSG"in i?Ui["EPSG:"+i.EPSG]=i:"ESRI"in i?Ui["ESRI:"+i.ESRI]=i:"IAU2000"in i&&(Ui["IAU2000:"+i.IAU2000]=i);return}}(function(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]})(Ui);var hP=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],uP=["3857","900913","3785","102113"];function dP(i){if(!function(r){return typeof r=="string"}(i))return i;if(function(r){return r in Ui}(i))return Ui[i];if(function(r){return hP.some(function(s){return r.indexOf(s)>-1})}(i)){var e=tw(i);if(function(r){var s=wa(r,"authority");if(s){var a=wa(s,"epsg");return a&&uP.indexOf(a)>-1}}(e))return Ui["EPSG:3857"];var t=function(r){var s=wa(r,"extension");if(s)return wa(s,"proj4")}(e);return t?Lg(t):e}return function(r){return r[0]==="+"}(i)?Lg(i):void 0}function x1(i,e){var t,r;if(i=i||{},!e)return i;for(r in e)(t=e[r])!==void 0&&(i[r]=t);return i}function _s(i,e,t){var r=i*e;return t/Math.sqrt(1-r*r)}function vh(i){return i<0?-1:1}function Ce(i){return Math.abs(i)<=Gt?i:i-vh(i)*Zc}function Vr(i,e,t){var r=i*t,s=.5*i;return r=Math.pow((1-r)/(1+r),s),Math.tan(.5*(be-e))/r}function Kc(i,e){for(var t,r,s=.5*i,a=be-2*Math.atan(e),n=0;n<=15;n++)if(t=i*Math.sin(a),a+=r=be-2*Math.atan(e*Math.pow((1-t)/(1+t),s))-a,Math.abs(r)<=1e-10)return a;return-9999}const pP={init:function(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=_s(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(i){var e,t,r=i.x,s=i.y;if(s*Ma>90&&s*Ma<-90&&r*Ma>180&&r*Ma<-180||Math.abs(Math.abs(s)-be)<=Ae)return null;if(this.sphere)e=this.x0+this.a*this.k0*Ce(r-this.long0),t=this.y0+this.a*this.k0*Math.log(Math.tan(dt+.5*s));else{var a=Math.sin(s),n=Vr(this.e,s,a);e=this.x0+this.a*this.k0*Ce(r-this.long0),t=this.y0-this.a*this.k0*Math.log(n)}return i.x=e,i.y=t,i},inverse:function(i){var e,t,r=i.x-this.x0,s=i.y-this.y0;if(this.sphere)t=be-2*Math.atan(Math.exp(-s/(this.a*this.k0)));else{var a=Math.exp(-s/(this.a*this.k0));if((t=Kc(this.e,a))===-9999)return null}return e=Ce(this.long0+r/(this.a*this.k0)),i.x=e,i.y=t,i},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]};function b1(i){return i}var mP=[pP,{init:function(){},forward:b1,inverse:b1,names:["longlat","identity"]}],ad={},Od=[];function M1(i,e){var t=Od.length;return!i.names||(Od[t]=i,i.names.forEach(function(r){ad[r.toLowerCase()]=t}),this)}const fP={start:function(){mP.forEach(M1)},add:M1,get:function(i){if(!i)return!1;var e=i.toLowerCase();return typeof ad[e]<"u"&&Od[ad[e]]?Od[ad[e]]:void 0}};var Y0={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},gP=Y0.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Y0.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var ai={};ai.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ai.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ai.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},ai.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},ai.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},ai.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},ai.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},ai.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},ai.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},ai.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ai.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},ai.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},ai.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},ai.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},ai.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},ai.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},ai.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},ai.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};var iw={};function vP(i){if(i.length===0)return null;var e=i[0]==="@";return e&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:i,mandatory:!e,grid:iw[i]||null,isNull:!1}}function Fo(i){return i/3600*Math.PI/180}function Dg(i,e,t){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(e,t)))}function _P(i){return i.map(function(e){return[Fo(e.longitudeShift),Fo(e.latitudeShift)]})}function yP(i,e,t){return{name:Dg(i,e+8,e+16).trim(),parent:Dg(i,e+24,e+24+8).trim(),lowerLatitude:i.getFloat64(e+72,t),upperLatitude:i.getFloat64(e+88,t),lowerLongitude:i.getFloat64(e+104,t),upperLongitude:i.getFloat64(e+120,t),latitudeInterval:i.getFloat64(e+136,t),longitudeInterval:i.getFloat64(e+152,t),gridNodeCount:i.getInt32(e+168,t)}}function xP(i,e,t,r){for(var s=e+176,a=[],n=0;n<t.gridNodeCount;n++){var o={latitudeShift:i.getFloat32(s+16*n,r),longitudeShift:i.getFloat32(s+16*n+4,r),latitudeAccuracy:i.getFloat32(s+16*n+8,r),longitudeAccuracy:i.getFloat32(s+16*n+12,r)};a.push(o)}return a}function ms(i,e){if(!(this instanceof ms))return new ms(i);e=e||function(c){if(c)throw c};var t=dP(i);if(typeof t=="object"){var r=ms.projections.get(t.projName);if(r){if(t.datumCode&&t.datumCode!=="none"){var s=wa(ai,t.datumCode);s&&(t.datum_params=t.datum_params||(s.towgs84?s.towgs84.split(","):null),t.ellps=s.ellipse,t.datumName=s.datumName?s.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var a=function(c,h,u,d,p){if(!c){var f=wa(Y0,d);f||(f=gP),c=f.a,h=f.b,u=f.rf}return u&&!h&&(h=(1-1/u)*c),(u===0||Math.abs(c-h)<Ae)&&(p=!0,h=c),{a:c,b:h,rf:u,sphere:p}}(t.a,t.b,t.rf,t.ellps,t.sphere),n=function(c,h,u,d){var p=c*c,f=h*h,g=(p-f)/p,m=0;return d?(p=(c*=1-g*(tP+g*(iP+g*rP)))*c,g=0):m=Math.sqrt(g),{es:g,e:m,ep2:(p-f)/f}}(a.a,a.b,a.rf,t.R_A),o=function(c){return c===void 0?null:c.split(",").map(vP)}(t.nadgrids),l=t.datum||function(c,h,u,d,p,f,g){var m={};return c===void 0||c==="none"?m.datum_type=Ig:m.datum_type=J3,h&&(m.datum_params=h.map(parseFloat),m.datum_params[0]===0&&m.datum_params[1]===0&&m.datum_params[2]===0||(m.datum_type=Un),m.datum_params.length>3&&(m.datum_params[3]===0&&m.datum_params[4]===0&&m.datum_params[5]===0&&m.datum_params[6]===0||(m.datum_type=kn,m.datum_params[3]*=bc,m.datum_params[4]*=bc,m.datum_params[5]*=bc,m.datum_params[6]=m.datum_params[6]/1e6+1))),g&&(m.datum_type=Zo,m.grids=g),m.a=u,m.b=d,m.es=p,m.ep2=f,m}(t.datumCode,t.datum_params,a.a,a.b,n.es,n.ep2,o);x1(this,t),x1(this,r),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=n.es,this.e=n.e,this.ep2=n.ep2,this.datum=l,this.init(),e(null,this)}else e(i)}else e(i)}function rw(i,e,t){var r,s,a,n,o=i.x,l=i.y,c=i.z?i.z:0;if(l<-be&&l>-1.001*be)l=-be;else if(l>be&&l<1.001*be)l=be;else{if(l<-be)return{x:-1/0,y:-1/0,z:i.z};if(l>be)return{x:1/0,y:1/0,z:i.z}}return o>Math.PI&&(o-=2*Math.PI),s=Math.sin(l),n=Math.cos(l),a=s*s,{x:((r=t/Math.sqrt(1-e*a))+c)*n*Math.cos(o),y:(r+c)*n*Math.sin(o),z:(r*(1-e)+c)*s}}function sw(i,e,t,r){var s,a,n,o,l,c,h,u,d,p,f,g,m,v,_,y=1e-12,x=i.x,b=i.y,M=i.z?i.z:0;if(s=Math.sqrt(x*x+b*b),a=Math.sqrt(x*x+b*b+M*M),s/t<y){if(v=0,a/t<y)return _=-r,{x:i.x,y:i.y,z:i.z}}else v=Math.atan2(b,x);n=M/a,u=(o=s/a)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*o*o)),d=n*l,m=0;do m++,c=e*(h=t/Math.sqrt(1-e*d*d))/(h+(_=s*u+M*d-h*(1-e*d*d))),g=(f=n*(l=1/Math.sqrt(1-c*(2-c)*o*o)))*u-(p=o*(1-c)*l)*d,u=p,d=f;while(g*g>1e-24&&m<30);return{x:v,y:Math.atan(f/Math.abs(p)),z:_}}function Lu(i){return i===Un||i===kn}function bP(i,e,t){if(function(l,c){return l.datum_type===c.datum_type&&!(l.a!==c.a||Math.abs(l.es-c.es)>5e-11)&&(l.datum_type===Un?l.datum_params[0]===c.datum_params[0]&&l.datum_params[1]===c.datum_params[1]&&l.datum_params[2]===c.datum_params[2]:l.datum_type!==kn||l.datum_params[0]===c.datum_params[0]&&l.datum_params[1]===c.datum_params[1]&&l.datum_params[2]===c.datum_params[2]&&l.datum_params[3]===c.datum_params[3]&&l.datum_params[4]===c.datum_params[4]&&l.datum_params[5]===c.datum_params[5]&&l.datum_params[6]===c.datum_params[6])}(i,e)||i.datum_type===Ig||e.datum_type===Ig)return t;var r=i.a,s=i.es;if(i.datum_type===Zo){if(w1(i,!1,t)!==0)return;r=f1,s=g1}var a=e.a,n=e.b,o=e.es;if(e.datum_type===Zo&&(a=f1,n=eP,o=g1),s===o&&r===a&&!Lu(i.datum_type)&&!Lu(e.datum_type)||(t=rw(t,s,r),Lu(i.datum_type)&&(t=function(l,c,h){if(c===Un)return{x:l.x+h[0],y:l.y+h[1],z:l.z+h[2]};if(c===kn){var u=h[0],d=h[1],p=h[2],f=h[3],g=h[4],m=h[5],v=h[6];return{x:v*(l.x-m*l.y+g*l.z)+u,y:v*(m*l.x+l.y-f*l.z)+d,z:v*(-g*l.x+f*l.y+l.z)+p}}}(t,i.datum_type,i.datum_params)),Lu(e.datum_type)&&(t=function(l,c,h){if(c===Un)return{x:l.x-h[0],y:l.y-h[1],z:l.z-h[2]};if(c===kn){var u=h[0],d=h[1],p=h[2],f=h[3],g=h[4],m=h[5],v=h[6],_=(l.x-u)/v,y=(l.y-d)/v,x=(l.z-p)/v;return{x:_+m*y-g*x,y:-m*_+y+f*x,z:g*_-f*y+x}}}(t,e.datum_type,e.datum_params)),t=sw(t,o,a,n),!(e.datum_type===Zo&&w1(e,!0,t)!==0)))return t}function w1(i,e,t){if(i.grids===null||i.grids.length===0)return-1;var r={x:-t.x,y:t.y},s={x:Number.NaN,y:Number.NaN},a=[];e:for(var n=0;n<i.grids.length;n++){var o=i.grids[n];if(a.push(o.name),o.isNull){s=r;break}if(o.mandatory,o.grid!==null)for(var l=o.grid.subgrids,c=0,h=l.length;c<h;c++){var u=l[c],d=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,p=u.ll[0]-d,f=u.ll[1]-d,g=u.ll[0]+(u.lim[0]-1)*u.del[0]+d,m=u.ll[1]+(u.lim[1]-1)*u.del[1]+d;if(!(f>r.y||p>r.x||m<r.y||g<r.x)&&(s=MP(r,e,u),!isNaN(s.x)))break e}else if(o.mandatory)return-1}return isNaN(s.x)?-1:(t.x=-s.x,t.y=s.y,0)}function MP(i,e,t){var r={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return r;var s={x:i.x,y:i.y};s.x-=t.ll[0],s.y-=t.ll[1],s.x=Ce(s.x-Math.PI)+Math.PI;var a=S1(s,t);if(e){if(isNaN(a.x))return r;a.x=s.x-a.x,a.y=s.y-a.y;var n,o,l=9;do{if(o=S1(a,t),isNaN(o.x))break;n={x:s.x-(o.x+a.x),y:s.y-(o.y+a.y)},a.x+=n.x,a.y+=n.y}while(l--&&Math.abs(n.x)>1e-12&&Math.abs(n.y)>1e-12);if(l<0)return r;r.x=Ce(a.x+t.ll[0]),r.y=a.y+t.ll[1]}else isNaN(a.x)||(r.x=i.x+a.x,r.y=i.y+a.y);return r}function S1(i,e){var t,r={x:i.x/e.del[0],y:i.y/e.del[1]},s=Math.floor(r.x),a=Math.floor(r.y),n=r.x-1*s,o=r.y-1*a,l={x:Number.NaN,y:Number.NaN};if(s<0||s>=e.lim[0]||a<0||a>=e.lim[1])return l;t=a*e.lim[0]+s;var c=e.cvs[t][0],h=e.cvs[t][1];t++;var u=e.cvs[t][0],d=e.cvs[t][1];t+=e.lim[0];var p=e.cvs[t][0],f=e.cvs[t][1];t--;var g=e.cvs[t][0],m=e.cvs[t][1],v=n*o,_=n*(1-o),y=(1-n)*(1-o),x=(1-n)*o;return l.x=y*c+_*u+x*g+v*p,l.y=y*h+_*d+x*m+v*f,l}function T1(i,e,t){var r,s,a,n=t.x,o=t.y,l=t.z||0,c={};for(a=0;a<3;a++)if(!e||a!==2||t.z!==void 0)switch(a===0?(r=n,s="ew".indexOf(i.axis[a])!==-1?"x":"y"):a===1?(r=o,s="ns".indexOf(i.axis[a])!==-1?"y":"x"):(r=l,s="z"),i.axis[a]){case"e":case"n":c[s]=r;break;case"w":case"s":c[s]=-r;break;case"u":t[s]!==void 0&&(c.z=r);break;case"d":t[s]!==void 0&&(c.z=-r);break;default:return null}return c}function aw(i){var e={x:i[0],y:i[1]};return i.length>2&&(e.z=i[2]),i.length>3&&(e.m=i[3]),e}function E1(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!=i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function Nd(i,e,t,r){var s,a=(t=Array.isArray(t)?aw(t):{x:t.x,y:t.y,z:t.z,m:t.m}).z!==void 0;if(function(n){E1(n.x),E1(n.y)}(t),i.datum&&e.datum&&function(n,o){return(n.datum.datum_type===Un||n.datum.datum_type===kn||n.datum.datum_type===Zo)&&o.datumCode!=="WGS84"||(o.datum.datum_type===Un||o.datum.datum_type===kn||o.datum.datum_type===Zo)&&n.datumCode!=="WGS84"}(i,e)&&(t=Nd(i,s=new ms("WGS84"),t,r),i=s),r&&i.axis!=="enu"&&(t=T1(i,!1,t)),i.projName==="longlat")t={x:t.x*yi,y:t.y*yi,z:t.z||0};else if(i.to_meter&&(t={x:t.x*i.to_meter,y:t.y*i.to_meter,z:t.z||0}),!(t=i.inverse(t)))return;if(i.from_greenwich&&(t.x+=i.from_greenwich),t=bP(i.datum,e.datum,t))return e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*Ma,y:t.y*Ma,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),r&&e.axis!=="enu"?T1(e,!0,t):(t&&!a&&delete t.z,t)}ms.projections=fP,ms.projections.start();var A1=ms("WGS84");function Km(i,e,t,r){var s,a,n;return Array.isArray(t)?(s=Nd(i,e,t,r)||{x:NaN,y:NaN},t.length>2?typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(t.splice(3)):[s.x,s.y,t[2]].concat(t.splice(3)):[s.x,s.y].concat(t.splice(2)):[s.x,s.y]):(a=Nd(i,e,t,r),(n=Object.keys(t)).length===2||n.forEach(function(o){if(typeof i.name<"u"&&i.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;a[o]=t[o]}),a)}function C1(i){return i instanceof ms?i:i.oProj?i.oProj:ms(i)}function ji(i,e,t){i=C1(i);var r,s=!1;return e===void 0?(e=i,i=A1,s=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,e=i,i=A1,s=!0),e=C1(e),t?Km(i,e,t):(r={forward:function(a,n){return Km(i,e,a,n)},inverse:function(a,n){return Km(e,i,a,n)}},s&&(r.oProj=e),r)}var P1=6,nw="AJSAJS",ow="AFAFAF",zo=65,Wi=73,yr=79,ac=86,nc=90;const wP={forward:lw,inverse:function(i){var e=Z0(uw(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]},toPoint:cw};function lw(i,e){return e=e||5,function(t,r){var s="00000"+t.easting,a="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(g=t.easting,m=t.northing,v=t.zoneNumber,_=hw(v),y=Math.floor(g/1e5),x=Math.floor(m/1e5)%20,n=y,o=x,l=_,c=l-1,h=nw.charCodeAt(c),u=ow.charCodeAt(c),d=h+n-1,p=u+o,f=!1,d>nc&&(d=d-nc+zo-1,f=!0),(d===Wi||h<Wi&&d>Wi||(d>Wi||h<Wi)&&f)&&d++,(d===yr||h<yr&&d>yr||(d>yr||h<yr)&&f)&&++d===Wi&&d++,d>nc&&(d=d-nc+zo-1),p>ac?(p=p-ac+zo-1,f=!0):f=!1,(p===Wi||u<Wi&&p>Wi||(p>Wi||u<Wi)&&f)&&p++,(p===yr||u<yr&&p>yr||(p>yr||u<yr)&&f)&&++p===Wi&&p++,p>ac&&(p=p-ac+zo-1),String.fromCharCode(d)+String.fromCharCode(p))+s.substr(s.length-5,r)+a.substr(a.length-5,r);var n,o,l,c,h,u,d,p,f,g,m,v,_,y,x}(function(t){var r,s,a,n,o,l,c,h,u=t.lat,d=t.lon,p=6378137,f=.00669438,g=.9996,m=Qm(u),v=Qm(d);h=Math.floor((d+180)/6)+1,d===180&&(h=60),u>=56&&u<64&&d>=3&&d<12&&(h=32),u>=72&&u<84&&(d>=0&&d<9?h=31:d>=9&&d<21?h=33:d>=21&&d<33?h=35:d>=33&&d<42&&(h=37)),c=Qm(6*(h-1)-180+3),r=f/(1-f),s=p/Math.sqrt(1-f*Math.sin(m)*Math.sin(m)),a=Math.tan(m)*Math.tan(m),n=r*Math.cos(m)*Math.cos(m),o=Math.cos(m)*(v-c),l=p*((1-f/4-3*f*f/64-5*f*f*f/256)*m-(3*f/8+3*f*f/32+45*f*f*f/1024)*Math.sin(2*m)+(15*f*f/256+45*f*f*f/1024)*Math.sin(4*m)-35*f*f*f/3072*Math.sin(6*m));var _=g*s*(o+(1-a+n)*o*o*o/6+(5-18*a+a*a+72*n-58*r)*o*o*o*o*o/120)+5e5,y=g*(l+s*Math.tan(m)*(o*o/2+(5-a+9*n+4*n*n)*o*o*o*o/24+(61-58*a+a*a+600*n-330*r)*o*o*o*o*o*o/720));return u<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(_),zoneNumber:h,zoneLetter:SP(u)}}({lat:i[1],lon:i[0]}),e)}function cw(i){var e=Z0(uw(i.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Qm(i){return i*(Math.PI/180)}function R1(i){return i/Math.PI*180}function Z0(i){var e=i.northing,t=i.easting,r=i.zoneLetter,s=i.zoneNumber;if(s<0||s>60)return null;var a,n,o,l,c,h,u,d,p,f=.9996,g=6378137,m=.00669438,v=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),_=t-5e5,y=e;r<"N"&&(y-=1e7),u=6*(s-1)-180+3,a=.006739496752268451,p=(d=y/f/6367449145945056e-9)+(3*v/2-27*v*v*v/32)*Math.sin(2*d)+(21*v*v/16-55*v*v*v*v/32)*Math.sin(4*d)+151*v*v*v/96*Math.sin(6*d),n=g/Math.sqrt(1-m*Math.sin(p)*Math.sin(p)),o=Math.tan(p)*Math.tan(p),l=a*Math.cos(p)*Math.cos(p),c=.99330562*g/Math.pow(1-m*Math.sin(p)*Math.sin(p),1.5),h=_/(n*f);var x=p-n*Math.tan(p)/c*(h*h/2-(5+3*o+10*l-4*l*l-9*a)*h*h*h*h/24+(61+90*o+298*l+45*o*o-1.6983531815716497-3*l*l)*h*h*h*h*h*h/720);x=R1(x);var b,M=(h-(1+2*o+l)*h*h*h/6+(5-2*l+28*o-3*l*l+8*a+24*o*o)*h*h*h*h*h/120)/Math.cos(p);if(M=u+R1(M),i.accuracy){var T=Z0({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});b={top:T.lat,right:T.lon,bottom:x,left:M}}else b={lat:x,lon:M};return b}function SP(i){var e="Z";return 84>=i&&i>=72?e="X":72>i&&i>=64?e="W":64>i&&i>=56?e="V":56>i&&i>=48?e="U":48>i&&i>=40?e="T":40>i&&i>=32?e="S":32>i&&i>=24?e="R":24>i&&i>=16?e="Q":16>i&&i>=8?e="P":8>i&&i>=0?e="N":0>i&&i>=-8?e="M":-8>i&&i>=-16?e="L":-16>i&&i>=-24?e="K":-24>i&&i>=-32?e="J":-32>i&&i>=-40?e="H":-40>i&&i>=-48?e="G":-48>i&&i>=-56?e="F":-56>i&&i>=-64?e="E":-64>i&&i>=-72?e="D":-72>i&&i>=-80&&(e="C"),e}function hw(i){var e=i%P1;return e===0&&(e=P1),e}function uw(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var e,t=i.length,r=null,s="",a=0;!/[A-Z]/.test(e=i.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+i;s+=e,a++}var n=parseInt(s,10);if(a===0||a+3>t)throw"MGRSPoint bad conversion from: "+i;var o=i.charAt(a++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+i;r=i.substring(a,a+=2);for(var l=hw(n),c=function(_,y){for(var x=nw.charCodeAt(y-1),b=1e5,M=!1;x!==_.charCodeAt(0);){if(++x===Wi&&x++,x===yr&&x++,x>nc){if(M)throw"Bad character: "+_;x=zo,M=!0}b+=1e5}return b}(r.charAt(0),l),h=function(_,y){if(_>"V")throw"MGRSPoint given invalid Northing "+_;for(var x=ow.charCodeAt(y-1),b=0,M=!1;x!==_.charCodeAt(0);){if(++x===Wi&&x++,x===yr&&x++,x>ac){if(M)throw"Bad character: "+_;x=zo,M=!0}b+=1e5}return b}(r.charAt(1),l);h<TP(o);)h+=2e6;var u=t-a;if(u%2!=0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var d,p,f,g=u/2,m=0,v=0;return g>0&&(d=1e5/Math.pow(10,g),p=i.substring(a,a+g),m=parseFloat(p)*d,f=i.substring(a+g),v=parseFloat(f)*d),{easting:m+c,northing:v+h,zoneLetter:o,zoneNumber:n,accuracy:d}}function TP(i){var e;switch(i){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+i}function Ko(i,e,t){if(!(this instanceof Ko))return new Ko(i,e,t);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&e===void 0){var r=i.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=i,this.y=e,this.z=t||0}Ko.fromMGRS=function(i){return new Ko(cw(i))},Ko.prototype.toMGRS=function(i){return lw([this.x,this.y],i)};var EP=1,AP=.25,I1=.046875,L1=.01953125,D1=.01068115234375,CP=.75,PP=.46875,RP=.013020833333333334,IP=.007120768229166667,LP=.3645833333333333,DP=.005696614583333333,OP=.3076171875;function dw(i){var e=[];e[0]=EP-i*(AP+i*(I1+i*(L1+i*D1))),e[1]=i*(CP-i*(I1+i*(L1+i*D1)));var t=i*i;return e[2]=t*(PP-i*(RP+i*IP)),t*=i,e[3]=t*(LP-i*DP),e[4]=t*i*OP,e}function Ud(i,e,t,r){return t*=e,e*=e,r[0]*i-t*(r[1]+e*(r[2]+e*(r[3]+e*r[4])))}var NP=20;function pw(i,e,t){for(var r=1/(1-e),s=i,a=NP;a;--a){var n=Math.sin(s),o=1-e*n*n;if(s-=o=(Ud(s,n,Math.cos(s),t)-i)*(o*Math.sqrt(o))*r,Math.abs(o)<Ae)return s}return s}const nd={init:function(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=dw(this.es),this.ml0=Ud(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(i){var e,t,r,s=i.x,a=i.y,n=Ce(s-this.long0),o=Math.sin(a),l=Math.cos(a);if(this.es){var c=l*n,h=Math.pow(c,2),u=this.ep2*Math.pow(l,2),d=Math.pow(u,2),p=Math.abs(l)>Ae?Math.tan(a):0,f=Math.pow(p,2),g=Math.pow(f,2);e=1-this.es*Math.pow(o,2),c/=Math.sqrt(e);var m=Ud(a,o,l,this.en);t=this.a*(this.k0*c*(1+h/6*(1-f+u+h/20*(5-18*f+g+14*u-58*f*u+h/42*(61+179*g-g*f-479*f)))))+this.x0,r=this.a*(this.k0*(m-this.ml0+o*n*c/2*(1+h/12*(5-f+9*u+4*d+h/30*(61+g-58*f+270*u-330*f*u+h/56*(1385+543*g-g*f-3111*f))))))+this.y0}else{var v=l*Math.sin(n);if(Math.abs(Math.abs(v)-1)<Ae)return 93;if(t=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,r=l*Math.cos(n)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(r))>=1){if(v-1>Ae)return 93;r=0}else r=Math.acos(r);a<0&&(r=-r),r=this.a*this.k0*(r-this.lat0)+this.y0}return i.x=t,i.y=r,i},inverse:function(i){var e,t,r,s,a=(i.x-this.x0)*(1/this.a),n=(i.y-this.y0)*(1/this.a);if(this.es)if(t=pw(e=this.ml0+n/this.k0,this.es,this.en),Math.abs(t)<be){var o=Math.sin(t),l=Math.cos(t),c=Math.abs(l)>Ae?Math.tan(t):0,h=this.ep2*Math.pow(l,2),u=Math.pow(h,2),d=Math.pow(c,2),p=Math.pow(d,2);e=1-this.es*Math.pow(o,2);var f=a*Math.sqrt(e)/this.k0,g=Math.pow(f,2);r=t-(e*=c)*g/(1-this.es)*.5*(1-g/12*(5+3*d-9*h*d+h-4*u-g/30*(61+90*d-252*h*d+45*p+46*h-g/56*(1385+3633*d+4095*p+1574*p*d)))),s=Ce(this.long0+f*(1-g/6*(1+2*d+h-g/20*(5+28*d+24*p+8*h*d+6*h-g/42*(61+662*d+1320*p+720*p*d))))/l)}else r=be*vh(n),s=0;else{var m=Math.exp(a/this.k0),v=.5*(m-1/m),_=this.lat0+n/this.k0,y=Math.cos(_);e=Math.sqrt((1-Math.pow(y,2))/(1+Math.pow(v,2))),r=Math.asin(e),n<0&&(r=-r),s=v===0&&y===0?0:Ce(Math.atan2(v,y)+this.long0)}return i.x=s,i.y=r,i},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function mw(i){var e=Math.exp(i);return e=(e-1/e)/2}function br(i,e){i=Math.abs(i),e=Math.abs(e);var t=Math.max(i,e),r=Math.min(i,e)/(t||1);return t*Math.sqrt(1+Math.pow(r,2))}function UP(i){var e=Math.abs(i);return e=function(t){var r=1+t,s=r-1;return s===0?t:t*Math.log(r)/s}(e*(1+e/(br(1,e)+1))),i<0?-e:e}function $m(i,e){for(var t,r=2*Math.cos(2*e),s=i.length-1,a=i[s],n=0;--s>=0;)t=r*a-n+i[s],n=a,a=t;return e+t*Math.sin(2*e)}function O1(i,e,t){for(var r,s,a=Math.sin(e),n=Math.cos(e),o=mw(t),l=function(m){var v=Math.exp(m);return(v+1/v)/2}(t),c=2*n*l,h=-2*a*o,u=i.length-1,d=i[u],p=0,f=0,g=0;--u>=0;)r=f,s=p,d=c*(f=d)-r-h*(p=g)+i[u],g=h*f-s+c*p;return[(c=a*l)*d-(h=n*o)*g,c*g+h*d]}const od={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(nd.init.apply(this),this.forward=nd.forward,this.inverse=nd.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),e=i/(2-i),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),t*=e,this.cgb[1]=t*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t*=e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),t*=e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(e*(-24832/14175)-2.4)),t*=e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t*=e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),t*=e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t*=e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t*=e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t*=e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=.6650675310896665*t;var r=$m(this.cbg,this.lat0);this.Zb=-this.Qn*(r+function(s,a){for(var n,o=2*Math.cos(a),l=s.length-1,c=s[l],h=0;--l>=0;)n=o*c-h+s[l],h=c,c=n;return Math.sin(a)*n}(this.gtu,2*r))},forward:function(i){var e=Ce(i.x-this.long0),t=i.y;t=$m(this.cbg,t);var r=Math.sin(t),s=Math.cos(t),a=Math.sin(e),n=Math.cos(e);t=Math.atan2(r,n*s),e=Math.atan2(a*s,br(r,s*n)),e=UP(Math.tan(e));var o,l,c=O1(this.gtu,2*t,2*e);return t+=c[0],e+=c[1],Math.abs(e)<=2.623395162778?(o=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*t+this.Zb)+this.y0):(o=1/0,l=1/0),i.x=o,i.y=l,i},inverse:function(i){var e,t,r=(i.x-this.x0)*(1/this.a),s=(i.y-this.y0)*(1/this.a);if(s=(s-this.Zb)/this.Qn,r/=this.Qn,Math.abs(r)<=2.623395162778){var a=O1(this.utg,2*s,2*r);s+=a[0],r+=a[1],r=Math.atan(mw(r));var n=Math.sin(s),o=Math.cos(s),l=Math.sin(r),c=Math.cos(r);s=Math.atan2(n*c,br(l,c*o)),e=Ce((r=Math.atan2(l,c*o))+this.long0),t=$m(this.cgb,s)}else e=1/0,t=1/0;return i.x=e,i.y=t,i},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]},kP={init:function(){var i=function(e,t){if(e===void 0){if((e=Math.floor(30*(Ce(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*yi,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,od.init.apply(this),this.forward=od.forward,this.inverse=od.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Jm(i,e){return Math.pow((1-i)/(1+i),e)}const ef={init:function(){var i=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+dt)/(Math.pow(Math.tan(.5*this.lat0+dt),this.C)*Jm(this.e*i,this.ratexp))},forward:function(i){var e=i.x,t=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+dt),this.C)*Jm(this.e*Math.sin(t),this.ratexp))-be,i.x=this.C*e,i},inverse:function(i){for(var e=i.x/this.C,t=i.y,r=Math.pow(Math.tan(.5*t+dt)/this.K,1/this.C),s=20;s>0&&(t=2*Math.atan(r*Jm(this.e*Math.sin(i.y),-.5*this.e))-be,!(Math.abs(t-i.y)<1e-14));--s)i.y=t;return s?(i.x=e,i.y=t,i):null},names:["gauss"]},FP={init:function(){ef.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(i){var e,t,r,s;return i.x=Ce(i.x-this.long0),ef.forward.apply(this,[i]),e=Math.sin(i.y),t=Math.cos(i.y),r=Math.cos(i.x),s=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*r),i.x=s*t*Math.sin(i.x),i.y=s*(this.cosc0*e-this.sinc0*t*r),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i},inverse:function(i){var e,t,r,s,a;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,a=br(i.x,i.y)){var n=2*Math.atan2(a,this.R2);e=Math.sin(n),t=Math.cos(n),s=Math.asin(t*this.sinc0+i.y*e*this.cosc0/a),r=Math.atan2(i.x*e,a*this.cosc0*t-i.y*this.sinc0*e)}else s=this.phic0,r=0;return i.x=r,i.y=s,ef.inverse.apply(this,[i]),i.x=Ce(i.x+this.long0),i},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},zP={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ae&&(this.k0=.5*(1+vh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Ae&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ae&&Math.abs(Math.cos(this.lat_ts))>Ae&&(this.k0=.5*this.cons*_s(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Vr(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=_s(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-be,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(i){var e,t,r,s,a,n,o=i.x,l=i.y,c=Math.sin(l),h=Math.cos(l),u=Ce(o-this.long0);return Math.abs(Math.abs(o-this.long0)-Math.PI)<=Ae&&Math.abs(l+this.lat0)<=Ae?(i.x=NaN,i.y=NaN,i):this.sphere?(e=2*this.k0/(1+this.sinlat0*c+this.coslat0*h*Math.cos(u)),i.x=this.a*e*h*Math.sin(u)+this.x0,i.y=this.a*e*(this.coslat0*c-this.sinlat0*h*Math.cos(u))+this.y0,i):(t=2*Math.atan(this.ssfn_(l,c,this.e))-be,s=Math.cos(t),r=Math.sin(t),Math.abs(this.coslat0)<=Ae?(a=Vr(this.e,l*this.con,this.con*c),n=2*this.a*this.k0*a/this.cons,i.x=this.x0+n*Math.sin(o-this.long0),i.y=this.y0-this.con*n*Math.cos(o-this.long0),i):(Math.abs(this.sinlat0)<Ae?(e=2*this.a*this.k0/(1+s*Math.cos(u)),i.y=e*r):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*s*Math.cos(u))),i.y=e*(this.cosX0*r-this.sinX0*s*Math.cos(u))+this.y0),i.x=e*s*Math.sin(u)+this.x0,i))},inverse:function(i){var e,t,r,s,a;i.x-=this.x0,i.y-=this.y0;var n=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var o=2*Math.atan(n/(2*this.a*this.k0));return e=this.long0,t=this.lat0,n<=Ae?(i.x=e,i.y=t,i):(t=Math.asin(Math.cos(o)*this.sinlat0+i.y*Math.sin(o)*this.coslat0/n),e=Math.abs(this.coslat0)<Ae?this.lat0>0?Ce(this.long0+Math.atan2(i.x,-1*i.y)):Ce(this.long0+Math.atan2(i.x,i.y)):Ce(this.long0+Math.atan2(i.x*Math.sin(o),n*this.coslat0*Math.cos(o)-i.y*this.sinlat0*Math.sin(o))),i.x=e,i.y=t,i)}if(Math.abs(this.coslat0)<=Ae){if(n<=Ae)return t=this.lat0,e=this.long0,i.x=e,i.y=t,i;i.x*=this.con,i.y*=this.con,r=n*this.cons/(2*this.a*this.k0),t=this.con*Kc(this.e,r),e=this.con*Ce(this.con*this.long0+Math.atan2(i.x,-1*i.y))}else s=2*Math.atan(n*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,n<=Ae?a=this.X0:(a=Math.asin(Math.cos(s)*this.sinX0+i.y*Math.sin(s)*this.cosX0/n),e=Ce(this.long0+Math.atan2(i.x*Math.sin(s),n*this.cosX0*Math.cos(s)-i.y*this.sinX0*Math.sin(s)))),t=-1*Kc(this.e,Math.tan(.5*(be+a)));return i.x=e,i.y=t,i},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(i,e,t){return e*=t,Math.tan(.5*(be+i))*Math.pow((1-e)/(1+e),.5*t)}},BP={init:function(){var i=this.lat0;this.lambda0=this.long0;var e=Math.sin(i),t=this.a,r=1/this.rf,s=2*r-Math.pow(r,2),a=this.e=Math.sqrt(s);this.R=this.k0*t*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(e/this.alpha);var n=Math.log(Math.tan(Math.PI/4+this.b0/2)),o=Math.log(Math.tan(Math.PI/4+i/2)),l=Math.log((1+a*e)/(1-a*e));this.K=n-this.alpha*o+this.alpha*a/2*l},forward:function(i){var e=Math.log(Math.tan(Math.PI/4-i.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),r=-this.alpha*(e+t)+this.K,s=2*(Math.atan(Math.exp(r))-Math.PI/4),a=this.alpha*(i.x-this.lambda0),n=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(a));return i.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,i.x=this.R*n+this.x0,i},inverse:function(i){for(var e=i.x-this.x0,t=i.y-this.y0,r=e/this.R,s=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(r)),n=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+n/this.alpha,l=0,c=a,h=-1e3,u=0;Math.abs(c-h)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),h=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return i.x=o,i.y=c,i},names:["somerc"]};var Eo=1e-7;const VP={init:function(){var i,e,t,r,s,a,n,o,l,c,h,u,d,p=0,f=0,g=0,m=0,v=0,_=0,y=0;this.no_off=(d=typeof(u=this).PROJECTION=="object"?Object.keys(u.PROJECTION)[0]:u.PROJECTION,"no_uoff"in u||"no_off"in u||["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(d)!==-1),this.no_rot="no_rot"in this;var x=!1;"alpha"in this&&(x=!0);var b=!1;if("rectified_grid_angle"in this&&(b=!0),x&&(y=this.alpha),b&&(p=this.rectified_grid_angle*yi),x||b)f=this.longc;else if(g=this.long1,v=this.lat1,m=this.long2,_=this.lat2,Math.abs(v-_)<=Eo||(i=Math.abs(v))<=Eo||Math.abs(i-be)<=Eo||Math.abs(Math.abs(this.lat0)-be)<=Eo||Math.abs(Math.abs(_)-be)<=Eo)throw new Error;var M=1-this.es;e=Math.sqrt(M),Math.abs(this.lat0)>Ae?(o=Math.sin(this.lat0),t=Math.cos(this.lat0),i=1-this.es*o*o,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/M),this.A=this.B*this.k0*e/i,(s=(r=this.B*e/(t*Math.sqrt(i)))*r-1)<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=r,this.E*=Math.pow(Vr(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=r=s=1),x||b?(x?(h=Math.asin(Math.sin(y)/r),b||(p=y)):(h=p,y=Math.asin(r*Math.sin(h))),this.lam0=f-Math.asin(.5*(s-1/s)*Math.tan(h))/this.B):(a=Math.pow(Vr(this.e,v,Math.sin(v)),this.B),n=Math.pow(Vr(this.e,_,Math.sin(_)),this.B),s=this.E/a,l=(n-a)/(n+a),c=((c=this.E*this.E)-n*a)/(c+n*a),(i=g-m)<-Math.pi?m-=Zc:i>Math.pi&&(m+=Zc),this.lam0=Ce(.5*(g+m)-Math.atan(c*Math.tan(.5*this.B*(g-m))/l)/this.B),h=Math.atan(2*Math.sin(this.B*Ce(g-this.lam0))/(s-1/s)),p=y=Math.asin(r*Math.sin(h))),this.singam=Math.sin(h),this.cosgam=Math.cos(h),this.sinrot=Math.sin(p),this.cosrot=Math.cos(p),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(r*r-1)/Math.cos(y))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*h,this.v_pole_n=this.ArB*Math.log(Math.tan(dt-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(dt+s))},forward:function(i){var e,t,r,s,a,n,o,l,c={};if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-be)>Ae){if(e=.5*((a=this.E/Math.pow(Vr(this.e,i.y,Math.sin(i.y)),this.B))-(n=1/a)),t=.5*(a+n),s=Math.sin(this.B*i.x),r=(e*this.singam-s*this.cosgam)/t,Math.abs(Math.abs(r)-1)<Ae)throw new Error;l=.5*this.ArB*Math.log((1-r)/(1+r)),n=Math.cos(this.B*i.x),o=Math.abs(n)<Eo?this.A*i.x:this.ArB*Math.atan2(e*this.cosgam+s*this.singam,n)}else l=i.y>0?this.v_pole_n:this.v_pole_s,o=this.ArB*i.y;return this.no_rot?(c.x=o,c.y=l):(o-=this.u_0,c.x=l*this.cosrot+o*this.sinrot,c.y=o*this.cosrot-l*this.sinrot),c.x=this.a*c.x+this.x0,c.y=this.a*c.y+this.y0,c},inverse:function(i){var e,t,r,s,a,n,o,l={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(t=i.y,e=i.x):(t=i.x*this.cosrot-i.y*this.sinrot,e=i.y*this.cosrot+i.x*this.sinrot+this.u_0),s=.5*((r=Math.exp(-this.BrA*t))-1/r),a=.5*(r+1/r),o=((n=Math.sin(this.BrA*e))*this.cosgam+s*this.singam)/a,Math.abs(Math.abs(o)-1)<Ae)l.x=0,l.y=o<0?-be:be;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=Kc(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-n*this.singam,Math.cos(this.BrA*e))}return l.x+=this.lam0,l},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},HP={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Ae)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),r=_s(this.e,e,t),s=Vr(this.e,this.lat1,e),a=Math.sin(this.lat2),n=Math.cos(this.lat2),o=_s(this.e,a,n),l=Vr(this.e,this.lat2,a),c=Vr(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Ae?this.ns=Math.log(r/o)/Math.log(s/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=r/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(c,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(i){var e=i.x,t=i.y;Math.abs(2*Math.abs(t)-Math.PI)<=Ae&&(t=vh(t)*(be-2*Ae));var r,s,a=Math.abs(Math.abs(t)-be);if(a>Ae)r=Vr(this.e,t,Math.sin(t)),s=this.a*this.f0*Math.pow(r,this.ns);else{if((a=t*this.ns)<=0)return null;s=0}var n=this.ns*Ce(e-this.long0);return i.x=this.k0*(s*Math.sin(n))+this.x0,i.y=this.k0*(this.rh-s*Math.cos(n))+this.y0,i},inverse:function(i){var e,t,r,s,a,n=(i.x-this.x0)/this.k0,o=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(n*n+o*o),t=1):(e=-Math.sqrt(n*n+o*o),t=-1);var l=0;if(e!==0&&(l=Math.atan2(t*n,t*o)),e!==0||this.ns>0){if(t=1/this.ns,r=Math.pow(e/(this.a*this.f0),t),(s=Kc(this.e,r))===-9999)return null}else s=-be;return a=Ce(l/this.ns+this.long0),i.x=a,i.y=s,i},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},GP={init:function(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(i){var e,t,r,s,a,n,o,l=i.x,c=i.y,h=Ce(l-this.long0);return e=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/e)-this.s45),r=-h*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(r)),a=Math.asin(Math.cos(t)*Math.sin(r)/Math.cos(s)),n=this.n*a,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),i.y=o*Math.cos(n)/1,i.x=o*Math.sin(n)/1,this.czech||(i.y*=-1,i.x*=-1),i},inverse:function(i){var e,t,r,s,a,n,o,l=i.x;i.x=i.y,i.y=l,this.czech||(i.y*=-1,i.x*=-1),a=Math.sqrt(i.x*i.x+i.y*i.y),s=Math.atan2(i.y,i.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(s)),t=Math.asin(Math.cos(r)*Math.sin(s)/Math.cos(e)),i.x=this.long0-t/this.alfa,n=e,o=0;var c=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(n))/(1-this.e*Math.sin(n)),this.e/2))-this.s45),Math.abs(n-i.y)<1e-10&&(o=1),n=i.y,c+=1;while(o===0&&c<15);return c>=15?null:i},names:["Krovak","krovak"]};function Fi(i,e,t,r,s){return i*s-e*Math.sin(2*s)+t*Math.sin(4*s)-r*Math.sin(6*s)}function Qc(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function $c(i){return .375*i*(1+.25*i*(1+.46875*i))}function Jc(i){return .05859375*i*i*(1+.75*i)}function eh(i){return i*i*i*(35/3072)}function Qo(i,e,t){var r=e*t;return i/Math.sqrt(1-r*r)}function gl(i){return Math.abs(i)<be?i:i-vh(i)*Math.PI}function kd(i,e,t,r,s){var a,n;a=i/e;for(var o=0;o<15;o++)if(a+=n=(i-(e*a-t*Math.sin(2*a)+r*Math.sin(4*a)-s*Math.sin(6*a)))/(e-2*t*Math.cos(2*a)+4*r*Math.cos(4*a)-6*s*Math.cos(6*a)),Math.abs(n)<=1e-10)return a;return NaN}const jP={init:function(){this.sphere||(this.e0=Qc(this.es),this.e1=$c(this.es),this.e2=Jc(this.es),this.e3=eh(this.es),this.ml0=this.a*Fi(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(i){var e,t,r=i.x,s=i.y;if(r=Ce(r-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(s)*Math.sin(r)),t=this.a*(Math.atan2(Math.tan(s),Math.cos(r))-this.lat0);else{var a=Math.sin(s),n=Math.cos(s),o=Qo(this.a,this.e,a),l=Math.tan(s)*Math.tan(s),c=r*Math.cos(s),h=c*c,u=this.es*n*n/(1-this.es);e=o*c*(1-h*l*(1/6-(8-l+8*u)*h/120)),t=this.a*Fi(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+o*a/n*h*(.5+(5-l+6*u)*h/24)}return i.x=e+this.x0,i.y=t+this.y0,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var e,t,r=i.x/this.a,s=i.y/this.a;if(this.sphere){var a=s+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(r)),t=Math.atan2(Math.tan(r),Math.cos(a))}else{var n=kd(this.ml0/this.a+s,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(n)-be)<=Ae)return i.x=this.long0,i.y=be,s<0&&(i.y*=-1),i;var o=Qo(this.a,this.e,Math.sin(n)),l=o*o*o/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(n),2),h=r*this.a/o,u=h*h;e=n-o*Math.tan(n)/l*h*h*(.5-(1+3*c)*h*h/24),t=h*(1-u*(c/3+(1+3*c)*c*u/15))/Math.cos(n)}return i.x=Ce(t+this.long0),i.y=gl(e),i},names:["Cassini","Cassini_Soldner","cass"]};function Sa(i,e){var t;return i>1e-7?(1-i*i)*(e/(1-(t=i*e)*t)-.5/i*Math.log((1-t)/(1+t))):2*e}var WP=.3333333333333333,XP=.17222222222222222,qP=.10257936507936508,YP=.06388888888888888,ZP=.0664021164021164,KP=.016415012942191543;const QP={init:function(){var i,e=Math.abs(this.lat0);if(Math.abs(e-be)<Ae?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Ae?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=Sa(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var r,s=[];return s[0]=t*WP,r=t*t,s[0]+=r*XP,s[1]=r*YP,r*=t,s[0]+=r*qP,s[1]+=r*ZP,s[2]=r*KP,s}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),i=Math.sin(this.lat0),this.sinb1=Sa(this.e,i)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*i*i)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(i){var e,t,r,s,a,n,o,l,c,h,u=i.x,d=i.y;if(u=Ce(u-this.long0),this.sphere){if(a=Math.sin(d),h=Math.cos(d),r=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((t=this.mode===this.EQUIT?1+h*r:1+this.sinph0*a+this.cosph0*h*r)<=Ae)return null;e=(t=Math.sqrt(2/t))*h*Math.sin(u),t*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*h*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(d+this.lat0)<Ae)return null;t=dt-.5*d,e=(t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)))*Math.sin(u),t*=r}}else{switch(o=0,l=0,c=0,r=Math.cos(u),s=Math.sin(u),a=Math.sin(d),n=Sa(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=n/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:c=1+this.sinb1*o+this.cosb1*l*r;break;case this.EQUIT:c=1+l*r;break;case this.N_POLE:c=be+d,n=this.qp-n;break;case this.S_POLE:c=d-be,n=this.qp+n}if(Math.abs(c)<Ae)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:c=Math.sqrt(2/c),t=this.mode===this.OBLIQ?this.ymf*c*(this.cosb1*o-this.sinb1*l*r):(c=Math.sqrt(2/(1+l*r)))*o*this.ymf,e=this.xmf*c*l*s;break;case this.N_POLE:case this.S_POLE:n>=0?(e=(c=Math.sqrt(n))*s,t=r*(this.mode===this.S_POLE?c:-c)):e=t=0}}return i.x=this.a*e+this.x0,i.y=this.a*t+this.y0,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var e,t,r,s,a,n,o,l,c,h,u=i.x/this.a,d=i.y/this.a;if(this.sphere){var p,f=0,g=0;if((t=.5*(p=Math.sqrt(u*u+d*d)))>1)return null;switch(t=2*Math.asin(t),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(g=Math.sin(t),f=Math.cos(t)),this.mode){case this.EQUIT:t=Math.abs(p)<=Ae?0:Math.asin(d*g/p),u*=g,d=f*p;break;case this.OBLIQ:t=Math.abs(p)<=Ae?this.lat0:Math.asin(f*this.sinph0+d*g*this.cosph0/p),u*=g*this.cosph0,d=(f-Math.sin(t)*this.sinph0)*p;break;case this.N_POLE:d=-d,t=be-t;break;case this.S_POLE:t-=be}e=d!==0||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,d):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,d*=this.dd,(n=Math.sqrt(u*u+d*d))<Ae)return i.x=this.long0,i.y=this.lat0,i;s=2*Math.asin(.5*n/this.rq),r=Math.cos(s),u*=s=Math.sin(s),this.mode===this.OBLIQ?(o=r*this.sinb1+d*s*this.cosb1/n,a=this.qp*o,d=n*this.cosb1*r-d*this.sinb1*s):(o=d*s/n,a=this.qp*o,d=n*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),!(a=u*u+d*d))return i.x=this.long0,i.y=this.lat0,i;o=1-a/this.qp,this.mode===this.S_POLE&&(o=-o)}e=Math.atan2(u,d),l=Math.asin(o),c=this.apa,h=l+l,t=l+c[0]*Math.sin(h)+c[1]*Math.sin(h+h)+c[2]*Math.sin(h+h+h)}return i.x=Ce(this.long0+e),i.y=t,i},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function za(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}const $P={init:function(){Math.abs(this.lat1+this.lat2)<Ae||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=_s(this.e3,this.sin_po,this.cos_po),this.qs1=Sa(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=_s(this.e3,this.sin_po,this.cos_po),this.qs2=Sa(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Sa(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Ae?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(i){var e=i.x,t=i.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var r=Sa(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,a=this.ns0*Ce(e-this.long0),n=s*Math.sin(a)+this.x0,o=this.rh-s*Math.cos(a)+this.y0;return i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s,a,n;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),r=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),r=-1),s=0,e!==0&&(s=Math.atan2(r*i.x,r*i.y)),r=e*this.ns0/this.a,this.sphere?n=Math.asin((this.c-r*r)/(2*this.ns0)):(t=(this.c-r*r)/this.ns0,n=this.phi1z(this.e3,t)),a=Ce(s/this.ns0+this.long0),i.x=a,i.y=n,i},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(i,e){var t,r,s,a,n=za(.5*e);if(i<Ae)return n;for(var o=i*i,l=1;l<=25;l++)if(n+=a=.5*(s=1-(r=i*(t=Math.sin(n)))*r)*s/Math.cos(n)*(e/(1-o)-t/s+.5/i*Math.log((1-r)/(1+r))),Math.abs(a)<=1e-7)return n;return null}},JP={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(i){var e,t,r,s,a,n,o,l=i.x,c=i.y;return r=Ce(l-this.long0),e=Math.sin(c),t=Math.cos(c),s=Math.cos(r),(a=this.sin_p14*e+this.cos_p14*t*s)>0||Math.abs(a)<=Ae?(n=this.x0+1*this.a*t*Math.sin(r)/a,o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*t*s)/a):(n=this.x0+this.infinity_dist*t*Math.sin(r),o=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*s)),i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s,a,n;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(e=Math.sqrt(i.x*i.x+i.y*i.y))?(s=Math.atan2(e,this.rc),t=Math.sin(s),n=za((r=Math.cos(s))*this.sin_p14+i.y*t*this.cos_p14/e),a=Math.atan2(i.x*t,e*this.cos_p14*r-i.y*this.sin_p14*t),a=Ce(this.long0+a)):(n=this.phic0,a=0),i.x=a,i.y=n,i},names:["gnom"]},eR={init:function(){this.sphere||(this.k0=_s(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(i){var e,t,r=i.x,s=i.y,a=Ce(r-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),t=this.y0+this.a*Math.sin(s)/Math.cos(this.lat_ts);else{var n=Sa(this.e,Math.sin(s));e=this.x0+this.a*this.k0*a,t=this.y0+this.a*n*.5/this.k0}return i.x=e,i.y=t,i},inverse:function(i){var e,t;return i.x-=this.x0,i.y-=this.y0,this.sphere?(e=Ce(this.long0+i.x/this.a/Math.cos(this.lat_ts)),t=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(t=function(r,s){var a=1-(1-r*r)/(2*r)*Math.log((1-r)/(1+r));if(Math.abs(Math.abs(s)-a)<1e-6)return s<0?-1*be:be;for(var n,o,l,c,h=Math.asin(.5*s),u=0;u<30;u++)if(o=Math.sin(h),l=Math.cos(h),c=r*o,h+=n=Math.pow(1-c*c,2)/(2*l)*(s/(1-r*r)-o/(1-c*c)+.5/r*Math.log((1-c)/(1+c))),Math.abs(n)<=1e-10)return h;return NaN}(this.e,2*i.y*this.k0/this.a),e=Ce(this.long0+i.x/(this.a*this.k0))),i.x=e,i.y=t,i},names:["cea"]},tR={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(i){var e=i.x,t=i.y,r=Ce(e-this.long0),s=gl(t-this.lat0);return i.x=this.x0+this.a*r*this.rc,i.y=this.y0+this.a*s,i},inverse:function(i){var e=i.x,t=i.y;return i.x=Ce(this.long0+(e-this.x0)/(this.a*this.rc)),i.y=gl(this.lat0+(t-this.y0)/this.a),i},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},iR={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Qc(this.es),this.e1=$c(this.es),this.e2=Jc(this.es),this.e3=eh(this.es),this.ml0=this.a*Fi(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(i){var e,t,r,s=i.x,a=i.y,n=Ce(s-this.long0);if(r=n*Math.sin(a),this.sphere)Math.abs(a)<=Ae?(e=this.a*n,t=-1*this.a*this.lat0):(e=this.a*Math.sin(r)/Math.tan(a),t=this.a*(gl(a-this.lat0)+(1-Math.cos(r))/Math.tan(a)));else if(Math.abs(a)<=Ae)e=this.a*n,t=-1*this.ml0;else{var o=Qo(this.a,this.e,Math.sin(a))/Math.tan(a);e=o*Math.sin(r),t=this.a*Fi(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+o*(1-Math.cos(r))}return i.x=e+this.x0,i.y=t+this.y0,i},inverse:function(i){var e,t,r,s,a,n,o,l,c;if(r=i.x-this.x0,s=i.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=Ae)e=Ce(r/this.a+this.long0),t=0;else{var h;for(n=this.lat0+s/this.a,o=r*r/this.a/this.a+n*n,l=n,a=20;a;--a)if(l+=c=-1*(n*(l*(h=Math.tan(l))+1)-l-.5*(l*l+o)*h)/((l-n)/h-1),Math.abs(c)<=Ae){t=l;break}e=Ce(this.long0+Math.asin(r*Math.tan(l)/this.a)/Math.sin(t))}else if(Math.abs(s+this.ml0)<=Ae)t=0,e=Ce(this.long0+r/this.a);else{var u,d,p,f,g;for(n=(this.ml0+s)/this.a,o=r*r/this.a/this.a+n*n,l=n,a=20;a;--a)if(g=this.e*Math.sin(l),u=Math.sqrt(1-g*g)*Math.tan(l),d=this.a*Fi(this.e0,this.e1,this.e2,this.e3,l),p=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=c=(n*(u*(f=d/this.a)+1)-f-.5*u*(f*f+o))/(this.es*Math.sin(2*l)*(f*f+o-2*n*f)/(4*u)+(n-f)*(u*p-2/Math.sin(2*l))-p),Math.abs(c)<=Ae){t=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=Ce(this.long0+Math.asin(r*u/this.a)/Math.sin(t))}return i.x=e,i.y=t,i},names:["Polyconic","poly"]},rR={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(i){var e,t=i.x,r=i.y-this.lat0,s=t-this.long0,a=r/bc*1e-5,n=s,o=1,l=0;for(e=1;e<=10;e++)o*=a,l+=this.A[e]*o;var c,h=l,u=n,d=1,p=0,f=0,g=0;for(e=1;e<=6;e++)c=p*h+d*u,d=d*h-p*u,p=c,f=f+this.B_re[e]*d-this.B_im[e]*p,g=g+this.B_im[e]*d+this.B_re[e]*p;return i.x=g*this.a+this.x0,i.y=f*this.a+this.y0,i},inverse:function(i){var e,t,r=i.x,s=i.y,a=r-this.x0,n=(s-this.y0)/this.a,o=a/this.a,l=1,c=0,h=0,u=0;for(e=1;e<=6;e++)t=c*n+l*o,l=l*n-c*o,c=t,h=h+this.C_re[e]*l-this.C_im[e]*c,u=u+this.C_im[e]*l+this.C_re[e]*c;for(var d=0;d<this.iterations;d++){var p,f=h,g=u,m=n,v=o;for(e=2;e<=6;e++)p=g*h+f*u,f=f*h-g*u,g=p,m+=(e-1)*(this.B_re[e]*f-this.B_im[e]*g),v+=(e-1)*(this.B_im[e]*f+this.B_re[e]*g);f=1,g=0;var _=this.B_re[1],y=this.B_im[1];for(e=2;e<=6;e++)p=g*h+f*u,f=f*h-g*u,g=p,_+=e*(this.B_re[e]*f-this.B_im[e]*g),y+=e*(this.B_im[e]*f+this.B_re[e]*g);var x=_*_+y*y;h=(m*_+v*y)/x,u=(v*_-m*y)/x}var b=h,M=u,T=1,A=0;for(e=1;e<=9;e++)T*=b,A+=this.D[e]*T;var L=this.lat0+A*bc*1e5,U=this.long0+M;return i.x=U,i.y=L,i},names:["New_Zealand_Map_Grid","nzmg"]},sR={init:function(){},forward:function(i){var e=i.x,t=i.y,r=Ce(e-this.long0),s=this.x0+this.a*r,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return i.x=s,i.y=a,i},inverse:function(i){i.x-=this.x0,i.y-=this.y0;var e=Ce(this.long0+i.x/this.a),t=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=e,i.y=t,i},names:["Miller_Cylindrical","mill"]},aR={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=dw(this.es)},forward:function(i){var e,t,r=i.x,s=i.y;if(r=Ce(r-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(s),n=20;n;--n){var o=(this.m*s+Math.sin(s)-a)/(this.m+Math.cos(s));if(s-=o,Math.abs(o)<Ae)break}else s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;e=this.a*this.C_x*r*(this.m+Math.cos(s)),t=this.a*this.C_y*s}else{var l=Math.sin(s),c=Math.cos(s);t=this.a*Ud(s,l,c,this.en),e=this.a*r*c/Math.sqrt(1-this.es*l*l)}return i.x=e,i.y=t,i},inverse:function(i){var e,t,r;return i.x-=this.x0,t=i.x/this.a,i.y-=this.y0,e=i.y/this.a,this.sphere?(e/=this.C_y,t/=this.C_x*(this.m+Math.cos(e)),this.m?e=za((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=za(Math.sin(e)/this.n)),t=Ce(t+this.long0),e=gl(e)):(e=pw(i.y/this.a,this.es,this.en),(r=Math.abs(e))<be?(r=Math.sin(e),t=Ce(this.long0+i.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(e)))):r-Ae<be&&(t=this.long0)),i.x=t,i.y=e,i},names:["Sinusoidal","sinu"]},nR={init:function(){},forward:function(i){for(var e=i.x,t=i.y,r=Ce(e-this.long0),s=t,a=Math.PI*Math.sin(t);;){var n=-(s+Math.sin(s)-a)/(1+Math.cos(s));if(s+=n,Math.abs(n)<Ae)break}s/=2,Math.PI/2-Math.abs(t)<Ae&&(r=0);var o=.900316316158*this.a*r*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return i.x=o,i.y=l,i},inverse:function(i){var e,t;i.x-=this.x0,i.y-=this.y0,t=i.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var r=Ce(this.long0+i.x/(.900316316158*this.a*Math.cos(e)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var s=Math.asin(t);return i.x=r,i.y=s,i},names:["Mollweide","moll"]},oR={init:function(){Math.abs(this.lat1+this.lat2)<Ae||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Qc(this.es),this.e1=$c(this.es),this.e2=Jc(this.es),this.e3=eh(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=_s(this.e,this.sinphi,this.cosphi),this.ml1=Fi(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Ae?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=_s(this.e,this.sinphi,this.cosphi),this.ml2=Fi(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Fi(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(i){var e,t=i.x,r=i.y;if(this.sphere)e=this.a*(this.g-r);else{var s=Fi(this.e0,this.e1,this.e2,this.e3,r);e=this.a*(this.g-s)}var a=this.ns*Ce(t-this.long0),n=this.x0+e*Math.sin(a),o=this.y0+this.rh-e*Math.cos(a);return i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s;i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),e=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),e=-1);var a=0;return t!==0&&(a=Math.atan2(e*i.x,e*i.y)),this.sphere?(s=Ce(this.long0+a/this.ns),r=gl(this.g-t/this.a),i.x=s,i.y=r,i):(r=kd(this.g-t/this.a,this.e0,this.e1,this.e2,this.e3),s=Ce(this.long0+a/this.ns),i.x=s,i.y=r,i)},names:["Equidistant_Conic","eqdc"]},lR={init:function(){this.R=this.a},forward:function(i){var e,t,r=i.x,s=i.y,a=Ce(r-this.long0);Math.abs(s)<=Ae&&(e=this.x0+this.R*a,t=this.y0);var n=za(2*Math.abs(s/Math.PI));(Math.abs(a)<=Ae||Math.abs(Math.abs(s)-be)<=Ae)&&(e=this.x0,t=s>=0?this.y0+Math.PI*this.R*Math.tan(.5*n):this.y0+Math.PI*this.R*-Math.tan(.5*n));var o=.5*Math.abs(Math.PI/a-a/Math.PI),l=o*o,c=Math.sin(n),h=Math.cos(n),u=h/(c+h-1),d=u*u,p=u*(2/c-1),f=p*p,g=Math.PI*this.R*(o*(u-f)+Math.sqrt(l*(u-f)*(u-f)-(f+l)*(d-f)))/(f+l);a<0&&(g=-g),e=this.x0+g;var m=l+u;return g=Math.PI*this.R*(p*m-o*Math.sqrt((f+l)*(l+1)-m*m))/(f+l),t=s>=0?this.y0+g:this.y0-g,i.x=e,i.y=t,i},inverse:function(i){var e,t,r,s,a,n,o,l,c,h,u,d;return i.x-=this.x0,i.y-=this.y0,u=Math.PI*this.R,a=(r=i.x/u)*r+(s=i.y/u)*s,u=3*(s*s/(l=-2*(n=-Math.abs(s)*(1+a))+1+2*s*s+a*a)+(2*(o=n-2*s*s+r*r)*o*o/l/l/l-9*n*o/l/l)/27)/(c=(n-o*o/3/l)/l)/(h=2*Math.sqrt(-c/3)),Math.abs(u)>1&&(u=u>=0?1:-1),d=Math.acos(u)/3,t=i.y>=0?(-h*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI:-(-h*Math.cos(d+Math.PI/3)-o/3/l)*Math.PI,e=Math.abs(r)<Ae?this.long0:Ce(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(r*r-s*s)+a*a))/2/r),i.x=e,i.y=t,i},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},cR={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(i){var e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m,v,_,y,x,b,M,T=i.x,A=i.y,L=Math.sin(i.y),U=Math.cos(i.y),P=Ce(T-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=Ae?(i.x=this.x0+this.a*(be-A)*Math.sin(P),i.y=this.y0-this.a*(be-A)*Math.cos(P),i):Math.abs(this.sin_p12+1)<=Ae?(i.x=this.x0+this.a*(be+A)*Math.sin(P),i.y=this.y0+this.a*(be+A)*Math.cos(P),i):(_=this.sin_p12*L+this.cos_p12*U*Math.cos(P),v=(m=Math.acos(_))?m/Math.sin(m):1,i.x=this.x0+this.a*v*U*Math.sin(P),i.y=this.y0+this.a*v*(this.cos_p12*L-this.sin_p12*U*Math.cos(P)),i):(e=Qc(this.es),t=$c(this.es),r=Jc(this.es),s=eh(this.es),Math.abs(this.sin_p12-1)<=Ae?(a=this.a*Fi(e,t,r,s,be),n=this.a*Fi(e,t,r,s,A),i.x=this.x0+(a-n)*Math.sin(P),i.y=this.y0-(a-n)*Math.cos(P),i):Math.abs(this.sin_p12+1)<=Ae?(a=this.a*Fi(e,t,r,s,be),n=this.a*Fi(e,t,r,s,A),i.x=this.x0+(a+n)*Math.sin(P),i.y=this.y0+(a+n)*Math.cos(P),i):(o=L/U,l=Qo(this.a,this.e,this.sin_p12),c=Qo(this.a,this.e,L),h=Math.atan((1-this.es)*o+this.es*l*this.sin_p12/(c*U)),y=(u=Math.atan2(Math.sin(P),this.cos_p12*Math.tan(h)-this.sin_p12*Math.cos(P)))===0?Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.abs(Math.abs(u)-Math.PI)<=Ae?-Math.asin(this.cos_p12*Math.sin(h)-this.sin_p12*Math.cos(h)):Math.asin(Math.sin(P)*Math.cos(h)/Math.sin(u)),d=this.e*this.sin_p12/Math.sqrt(1-this.es),m=l*y*(1-(x=y*y)*(g=(p=this.e*this.cos_p12*Math.cos(u)/Math.sqrt(1-this.es))*p)*(1-g)/6+(b=x*y)/8*(f=d*p)*(1-2*g)+(M=b*y)/120*(g*(4-7*g)-3*d*d*(1-7*g))-M*y/48*f),i.x=this.x0+m*Math.sin(u),i.y=this.y0+m*Math.cos(u),i))},inverse:function(i){var e,t,r,s,a,n,o,l,c,h,u,d,p,f,g,m,v,_,y,x,b,M,T;return i.x-=this.x0,i.y-=this.y0,this.sphere?(e=Math.sqrt(i.x*i.x+i.y*i.y))>2*be*this.a?void 0:(t=e/this.a,r=Math.sin(t),s=Math.cos(t),a=this.long0,Math.abs(e)<=Ae?n=this.lat0:(n=za(s*this.sin_p12+i.y*r*this.cos_p12/e),o=Math.abs(this.lat0)-be,a=Math.abs(o)<=Ae?this.lat0>=0?Ce(this.long0+Math.atan2(i.x,-i.y)):Ce(this.long0-Math.atan2(-i.x,i.y)):Ce(this.long0+Math.atan2(i.x*r,e*this.cos_p12*s-i.y*this.sin_p12*r))),i.x=a,i.y=n,i):(l=Qc(this.es),c=$c(this.es),h=Jc(this.es),u=eh(this.es),Math.abs(this.sin_p12-1)<=Ae?(n=kd(((d=this.a*Fi(l,c,h,u,be))-(e=Math.sqrt(i.x*i.x+i.y*i.y)))/this.a,l,c,h,u),a=Ce(this.long0+Math.atan2(i.x,-1*i.y)),i.x=a,i.y=n,i):Math.abs(this.sin_p12+1)<=Ae?(d=this.a*Fi(l,c,h,u,be),n=kd(((e=Math.sqrt(i.x*i.x+i.y*i.y))-d)/this.a,l,c,h,u),a=Ce(this.long0+Math.atan2(i.x,i.y)),i.x=a,i.y=n,i):(e=Math.sqrt(i.x*i.x+i.y*i.y),g=Math.atan2(i.x,i.y),p=Qo(this.a,this.e,this.sin_p12),m=Math.cos(g),_=-(v=this.e*this.cos_p12*m)*v/(1-this.es),y=3*this.es*(1-_)*this.sin_p12*this.cos_p12*m/(1-this.es),M=1-_*(b=(x=e/p)-_*(1+_)*Math.pow(x,3)/6-y*(1+3*_)*Math.pow(x,4)/24)*b/2-x*b*b*b/6,f=Math.asin(this.sin_p12*Math.cos(b)+this.cos_p12*Math.sin(b)*m),a=Ce(this.long0+Math.asin(Math.sin(g)*Math.sin(b)/Math.cos(f))),T=Math.sin(f),n=Math.atan2((T-this.es*M*this.sin_p12)*Math.tan(f),T*(1-this.es)),i.x=a,i.y=n,i))},names:["Azimuthal_Equidistant","aeqd"]},hR={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(i){var e,t,r,s,a,n,o,l=i.x,c=i.y;return r=Ce(l-this.long0),e=Math.sin(c),t=Math.cos(c),s=Math.cos(r),((a=this.sin_p14*e+this.cos_p14*t*s)>0||Math.abs(a)<=Ae)&&(n=1*this.a*t*Math.sin(r),o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*t*s)),i.x=n,i.y=o,i},inverse:function(i){var e,t,r,s,a,n,o;return i.x-=this.x0,i.y-=this.y0,t=za((e=Math.sqrt(i.x*i.x+i.y*i.y))/this.a),r=Math.sin(t),s=Math.cos(t),n=this.long0,Math.abs(e)<=Ae?(o=this.lat0,i.x=n,i.y=o,i):(o=za(s*this.sin_p14+i.y*r*this.cos_p14/e),a=Math.abs(this.lat0)-be,Math.abs(a)<=Ae?(n=this.lat0>=0?Ce(this.long0+Math.atan2(i.x,-i.y)):Ce(this.long0-Math.atan2(-i.x,i.y)),i.x=n,i.y=o,i):(n=Ce(this.long0+Math.atan2(i.x*r,e*this.cos_p14*s-i.y*this.sin_p14*r)),i.x=n,i.y=o,i))},names:["ortho"]};var N1=1,Gl=2,jl=3,Wl=4,tf=5,rf=6,ut={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function Du(i,e,t,r){var s;return i<Ae?(r.value=ut.AREA_0,s=0):(s=Math.atan2(e,t),Math.abs(s)<=dt?r.value=ut.AREA_0:s>dt&&s<=be+dt?(r.value=ut.AREA_1,s-=be):s>be+dt||s<=-(be+dt)?(r.value=ut.AREA_2,s=s>=0?s-Gt:s+Gt):(r.value=ut.AREA_3,s+=be)),s}function Ao(i,e){var t=i+e;return t<-Gt?t+=Zc:t>+Gt&&(t-=Zc),t}const uR={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=be-dt/2?this.face=tf:this.lat0<=-(be-dt/2)?this.face=rf:Math.abs(this.long0)<=dt?this.face=N1:Math.abs(this.long0)<=be+dt?this.face=this.long0>0?Gl:Wl:this.face=jl,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(i){var e,t,r,s,a,n,o={x:0,y:0},l={value:0};if(i.x-=this.long0,e=this.es!==0?Math.atan(this.one_minus_f_squared*Math.tan(i.y)):i.y,t=i.x,this.face===tf)s=be-e,t>=dt&&t<=be+dt?(l.value=ut.AREA_0,r=t-be):t>be+dt||t<=-(be+dt)?(l.value=ut.AREA_1,r=t>0?t-Gt:t+Gt):t>-(be+dt)&&t<=-dt?(l.value=ut.AREA_2,r=t+be):(l.value=ut.AREA_3,r=t);else if(this.face===rf)s=be+e,t>=dt&&t<=be+dt?(l.value=ut.AREA_0,r=-t+be):t<dt&&t>=-dt?(l.value=ut.AREA_1,r=-t):t<-dt&&t>=-(be+dt)?(l.value=ut.AREA_2,r=-t-be):(l.value=ut.AREA_3,r=t>0?-t+Gt:-t-Gt);else{var c,h,u,d,p,f;this.face===Gl?t=Ao(t,+be):this.face===jl?t=Ao(t,+Gt):this.face===Wl&&(t=Ao(t,-be)),d=Math.sin(e),p=Math.cos(e),f=Math.sin(t),c=p*Math.cos(t),h=p*f,u=d,this.face===N1?r=Du(s=Math.acos(c),u,h,l):this.face===Gl?r=Du(s=Math.acos(h),u,-c,l):this.face===jl?r=Du(s=Math.acos(-c),u,-h,l):this.face===Wl?r=Du(s=Math.acos(-h),u,c,l):(s=r=0,l.value=ut.AREA_0)}return n=Math.atan(12/Gt*(r+Math.acos(Math.sin(r)*Math.cos(dt))-be)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(n)*Math.cos(n))/(1-Math.cos(Math.atan(1/Math.cos(r))))),l.value===ut.AREA_1?n+=be:l.value===ut.AREA_2?n+=Gt:l.value===ut.AREA_3&&(n+=1.5*Gt),o.x=a*Math.cos(n),o.y=a*Math.sin(n),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,i.x=o.x,i.y=o.y,i},inverse:function(i){var e,t,r,s,a,n,o,l,c,h,u,d,p={lam:0,phi:0},f={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,t=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),e=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?f.value=ut.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(f.value=ut.AREA_1,e-=be):i.x<0&&-i.x>=Math.abs(i.y)?(f.value=ut.AREA_2,e=e<0?e+Gt:e-Gt):(f.value=ut.AREA_3,e+=be),c=Gt/12*Math.tan(e),a=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),n=Math.atan(a),(o=1-(r=Math.cos(e))*r*(s=Math.tan(t))*s*(1-Math.cos(Math.atan(1/Math.cos(n)))))<-1?o=-1:o>1&&(o=1),this.face===tf)l=Math.acos(o),p.phi=be-l,f.value===ut.AREA_0?p.lam=n+be:f.value===ut.AREA_1?p.lam=n<0?n+Gt:n-Gt:f.value===ut.AREA_2?p.lam=n-be:p.lam=n;else if(this.face===rf)l=Math.acos(o),p.phi=l-be,f.value===ut.AREA_0?p.lam=-n+be:f.value===ut.AREA_1?p.lam=-n:f.value===ut.AREA_2?p.lam=-n-be:p.lam=n<0?-n-Gt:-n+Gt;else{var g,m,v;c=(g=o)*g,m=(c+=(v=c>=1?0:Math.sqrt(1-c)*Math.sin(n))*v)>=1?0:Math.sqrt(1-c),f.value===ut.AREA_1?(c=m,m=-v,v=c):f.value===ut.AREA_2?(m=-m,v=-v):f.value===ut.AREA_3&&(c=m,m=v,v=-c),this.face===Gl?(c=g,g=-m,m=c):this.face===jl?(g=-g,m=-m):this.face===Wl&&(c=g,g=m,m=-c),p.phi=Math.acos(-v)-be,p.lam=Math.atan2(m,g),this.face===Gl?p.lam=Ao(p.lam,-be):this.face===jl?p.lam=Ao(p.lam,-Gt):this.face===Wl&&(p.lam=Ao(p.lam,+be))}return this.es!==0&&(h=p.phi<0?1:0,u=Math.tan(p.phi),d=this.b/Math.sqrt(u*u+this.one_minus_f_squared),p.phi=Math.atan(Math.sqrt(this.a*this.a-d*d)/(this.one_minus_f*d)),h&&(p.phi=-p.phi)),p.lam+=this.long0,i.x=p.lam,i.y=p.phi,i},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var sf=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Xl=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],U1=.8487,k1=1.3523,fw=Ma/5,dR=1/fw,af=18,Ou=function(i,e){return i[0]+e*(i[1]+e*(i[2]+e*i[3]))};const pR={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(i){var e=Ce(i.x-this.long0),t=Math.abs(i.y),r=Math.floor(t*fw);r<0?r=0:r>=af&&(r=17);var s={x:Ou(sf[r],t=Ma*(t-dR*r))*e,y:Ou(Xl[r],t)};return i.y<0&&(s.y=-s.y),s.x=s.x*this.a*U1+this.x0,s.y=s.y*this.a*k1+this.y0,s},inverse:function(i){var e={x:(i.x-this.x0)/(this.a*U1),y:Math.abs(i.y-this.y0)/(this.a*k1)};if(e.y>=1)e.x/=sf[18][0],e.y=i.y<0?-be:be;else{var t=Math.floor(e.y*af);for(t<0?t=0:t>=af&&(t=17);;)if(Xl[t][0]>e.y)--t;else{if(!(Xl[t+1][0]<=e.y))break;++t}var r=Xl[t],s=5*(e.y-r[0])/(Xl[t+1][0]-r[0]);s=function(a,n,o,l){for(var c=n;l;--l){var h=a(c);if(c-=h,Math.abs(h)<o)break}return c}(function(a){return(Ou(r,a)-e.y)/function(n,o){return n[1]+o*(2*n[2]+3*o*n[3])}(r,a)},s,Ae,100),e.x/=Ou(sf[t],s),e.y=(5*t+s)*yi,i.y<0&&(e.y=-e.y)}return e.x=Ce(e.x+this.long0),e},names:["Robinson","robin"]},mR={init:function(){this.name="geocent"},forward:function(i){return rw(i,this.es,this.a)},inverse:function(i){return sw(i,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var Nu=0,Uu=1,ku=2,Fu=3,ql={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const fR={init:function(){if(Object.keys(ql).forEach((function(t){if(typeof this[t]>"u")this[t]=ql[t].def;else{if(ql[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);ql[t].num&&(this[t]=parseFloat(this[t]))}ql[t].degrees&&(this[t]=this[t]*yi)}).bind(this)),Math.abs(Math.abs(this.lat0)-be)<Ae?this.mode=this.lat0<0?Uu:Nu:Math.abs(this.lat0)<Ae?this.mode=ku:(this.mode=Fu,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(i),this.sw=Math.sin(i)},forward:function(i){i.x-=this.long0;var e,t,r,s,a=Math.sin(i.y),n=Math.cos(i.y),o=Math.cos(i.x);switch(this.mode){case Fu:t=this.sinph0*a+this.cosph0*n*o;break;case ku:t=n*o;break;case Uu:t=-a;break;case Nu:t=a}switch(e=(t=this.pn1/(this.p-t))*n*Math.sin(i.x),this.mode){case Fu:t*=this.cosph0*a-this.sinph0*n*o;break;case ku:t*=a;break;case Nu:t*=-n*o;break;case Uu:t*=n*o}return s=1/((r=t*this.cg+e*this.sg)*this.sw*this.h1+this.cw),e=(e*this.cg-t*this.sg)*this.cw*s,t=r*s,i.x=e*this.a,i.y=t*this.a,i},inverse:function(i){i.x/=this.a,i.y/=this.a;var e,t,r,s={x:i.x,y:i.y};r=1/(this.pn1-i.y*this.sw),e=this.pn1*i.x*r,t=this.pn1*i.y*this.cw*r,i.x=e*this.cg+t*this.sg,i.y=t*this.cg-e*this.sg;var a=br(i.x,i.y);if(Math.abs(a)<Ae)s.x=0,s.y=i.y;else{var n,o;switch(o=1-a*a*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/a+a/this.pn1),n=Math.sqrt(1-o*o),this.mode){case Fu:s.y=Math.asin(n*this.sinph0+i.y*o*this.cosph0/a),i.y=(n-this.sinph0*Math.sin(s.y))*a,i.x*=o*this.cosph0;break;case ku:s.y=Math.asin(i.y*o/a),i.y=n*a,i.x*=o;break;case Nu:s.y=Math.asin(n),i.y=-i.y;break;case Uu:s.y=-Math.asin(n)}s.x=Math.atan2(i.x,i.y)}return i.x=s.x+this.long0,i.y=s.y,i},names:["Tilted_Perspective","tpers"]},gR={init:function(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var i=1-this.es,e=1/i;this.radius_p=Math.sqrt(i),this.radius_p2=i,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(i){var e,t,r,s,a=i.x,n=i.y;if(a-=this.long0,this.shape==="ellipse"){n=Math.atan(this.radius_p2*Math.tan(n));var o=this.radius_p/br(this.radius_p*Math.cos(n),Math.sin(n));if(t=o*Math.cos(a)*Math.cos(n),r=o*Math.sin(a)*Math.cos(n),s=o*Math.sin(n),(this.radius_g-t)*t-r*r-s*s*this.radius_p_inv2<0)return i.x=Number.NaN,i.y=Number.NaN,i;e=this.radius_g-t,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/br(s,e)),i.y=this.radius_g_1*Math.atan(s/e)):(i.x=this.radius_g_1*Math.atan(r/e),i.y=this.radius_g_1*Math.atan(s/br(r,e)))}else this.shape==="sphere"&&(e=Math.cos(n),t=Math.cos(a)*e,r=Math.sin(a)*e,s=Math.sin(n),e=this.radius_g-t,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/br(s,e)),i.y=this.radius_g_1*Math.atan(s/e)):(i.x=this.radius_g_1*Math.atan(r/e),i.y=this.radius_g_1*Math.atan(s/br(r,e))));return i.x=i.x*this.a,i.y=i.y*this.a,i},inverse:function(i){var e,t,r,s,a=-1,n=0,o=0;if(i.x=i.x/this.a,i.y=i.y/this.a,this.shape==="ellipse"){this.flip_axis?(o=Math.tan(i.y/this.radius_g_1),n=Math.tan(i.x/this.radius_g_1)*br(1,o)):(n=Math.tan(i.x/this.radius_g_1),o=Math.tan(i.y/this.radius_g_1)*br(1,n));var l=o/this.radius_p;if(e=n*n+l*l+a*a,(r=(t=2*this.radius_g*a)*t-4*e*this.C)<0)return i.x=Number.NaN,i.y=Number.NaN,i;s=(-t-Math.sqrt(r))/(2*e),a=this.radius_g+s*a,n*=s,o*=s,i.x=Math.atan2(n,a),i.y=Math.atan(o*Math.cos(i.x)/a),i.y=Math.atan(this.radius_p_inv2*Math.tan(i.y))}else if(this.shape==="sphere"){if(this.flip_axis?(o=Math.tan(i.y/this.radius_g_1),n=Math.tan(i.x/this.radius_g_1)*Math.sqrt(1+o*o)):(n=Math.tan(i.x/this.radius_g_1),o=Math.tan(i.y/this.radius_g_1)*Math.sqrt(1+n*n)),e=n*n+o*o+a*a,(r=(t=2*this.radius_g*a)*t-4*e*this.C)<0)return i.x=Number.NaN,i.y=Number.NaN,i;s=(-t-Math.sqrt(r))/(2*e),a=this.radius_g+s*a,n*=s,o*=s,i.x=Math.atan2(n,a),i.y=Math.atan(o*Math.cos(i.x)/a)}return i.x=i.x+this.long0,i},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};var Yl=1.340264,Zl=-.081106,Kl=893e-6,Ql=.003796,zu=Math.sqrt(3)/2;const vR={init:function(){this.es=0,this.long0=this.long0!==void 0?this.long0:0},forward:function(i){var e=Ce(i.x-this.long0),t=i.y,r=Math.asin(zu*Math.sin(t)),s=r*r,a=s*s*s;return i.x=e*Math.cos(r)/(zu*(Yl+3*Zl*s+a*(7*Kl+9*Ql*s))),i.y=r*(Yl+Zl*s+a*(Kl+Ql*s)),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i},inverse:function(i){i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a;var e,t,r,s,a=i.y;for(s=0;s<12&&(a-=r=(a*(Yl+Zl*(e=a*a)+(t=e*e*e)*(Kl+Ql*e))-i.y)/(Yl+3*Zl*e+t*(7*Kl+9*Ql*e)),!(Math.abs(r)<1e-9));++s);return t=(e=a*a)*e*e,i.x=zu*i.x*(Yl+3*Zl*e+t*(7*Kl+9*Ql*e))/Math.cos(a),i.y=Math.asin(Math.sin(a)/zu),i.x=Ce(i.x+this.long0),i},names:["eqearth","Equal Earth","Equal_Earth"]};function nf(i,e=1e4){const[t,r]=i,[s,a]=ji("EPSG:4326","EPSG:3857",[t,r]);return new se(s/e,a/e)}function gw(i){return new se(i.offsetX/i.target.clientWidth*2-1,-i.offsetY/i.target.clientHeight*2+1)}function vw(i){new Tt().setFromObject(i).getCenter(i.position),i.translationOriginDiff=i.position.clone(),i.getTransformedVector=e=>{const t=e.clone();return t.sub(i.translationOriginDiff),t.multiply(i.scale),t.applyEuler(i.rotation),t.add(i.position),t},i.traverse(e=>{e.isMesh&&e.position.sub(i.position),e.initTranslate=e.position.clone()}),i.position.set(0,0,0)}function F1(i,e,t=null){const{globalConfig:r}=e,s=i.map(h=>nf(h)),a=new ll(s),n=new Aa;n.path=a,r.geometry.isEmpty?n.holes.push(a):n.curves.push(a);const o=new Qn(n,Re({depth:20,bevelEnabled:!1},r.geometry.parameters)),l=e.listMaterial||Wr(e.materialType,{color:16777215*Math.random(),transparent:!0}),c=new ye(o,l);(function(h,u){var d,p;if(h.name=(d=u==null?void 0:u.properties)==null?void 0:d.name,u==null?void 0:u.properties.center){const f=nf(u.properties.center);u.properties.centerCoord3=new C(f.x,f.y,0)}if((p=u==null?void 0:u.properties)!=null&&p.centroid){const f=nf(u.properties.centroid);u.properties.centroidCoord3=new C(f.x,f.y,0)}h.geoInfo=u})(c,t),ew(c),e.attach(c)}function Og(i,e,t){e.labelGroup={};const{type:r,color:s,fontSize:a,fontWeight:n,px:o,py:l,pz:c,rx:h,ry:u,rz:d,ss:p,sx:f,sy:g,sz:m}=t;e.children.forEach(v=>{var _,y,x,b,M,T,A,L,U;if((_=v.geoInfo)!=null&&_.properties.name&&!e.labelGroup[v.geoInfo.properties.name]){if(!((y=v.geoInfo)!=null&&y.properties.centroidCoord3)&&!((x=v.geoInfo)!=null&&x.properties.centerCoord3))return;const P=(((b=v.geoInfo)==null?void 0:b.properties.centroidCoord3)||((M=v.geoInfo)==null?void 0:M.properties.centerCoord3)).add(v.position).sub(v.initTranslate),E=e.getTransformedVector(P),I=document.createElement("div");I.innerText=((A=(T=v.geoInfo)==null?void 0:T.properties)==null?void 0:A.name)||"",I.style.color=s,I.style.fontSize=a+"px",I.style.fontWeight=n;const S=r==="2D"?new eM(I):new tM(I);S._position=E,S.position.set(S._position.x+o,S._position.y+l,S._position.z+c),S.rotation.set(h,u,d),S.scale.set(f,g,m),S.scale.setScalar(p),i.add(S),I.style.pointerEvents="none",e.labelGroup[(U=(L=v.geoInfo)==null?void 0:L.properties)==null?void 0:U.name]=S}})}function _w(i,e){const{commonFrames:t}=i,{globalConfig:r}=e;if(!r.useGlobalConfig)return;const{mesh:s,material:a}=r;if(e.children.forEach(n=>{n.castShadow=s.castShadow,n.receiveShadow=s.receiveShadow}),a.mapUrl){const n=new gs().load(a.mapUrl);n.wrapS=Kt,n.wrapT=Kt,n.repeat.set(a.map.repeat.x,a.map.repeat.y),n.offset.set(a.map.offset.x,a.map.offset.y),n.center.set(a.map.center.x,a.map.center.y),n.rotation=a.map.rotation,e.texture=n,e.commonAnimateRender=function(){this.texture.offset.x+=this.globalConfig.material.textureAnimation.offset.x,this.texture.offset.y+=this.globalConfig.material.textureAnimation.offset.y,this.texture.rotation+=this.globalConfig.material.textureAnimation.rotation},t.push(e)}e.RootMaterials.forEach(n=>{n.color.set(a.color),n.wireframe=a.wireframe,n.transparent=a.transparent,n.opacity=a.opacity,["标准材质","物理材质"].includes(e.materialType)&&(n.metalness=a.metalness,n.roughness=a.roughness),e.materialType!=="基础材质"&&(n.emissive.set(a.emissive),n.emissiveIntensity=a.emissiveIntensity),e.materialType==="物理材质"&&(n.clearcoat=a.clearcoat,n.clearcoatRoughness=a.clearcoatRoughness,n.sheen=a.sheen,n.sheenRoughness=a.sheenRoughness,n.sheenColor.set(a.sheenColor),n.transmission=a.transmission),n.envMap=a.envMap?i.envBackground:null,n.envMapIntensity=a.envMapIntensity,n.reflectivity=a.reflectivity,n.map=e.texture,n.needsUpdate=!0}),e.parent.envMapChangeUseList.push(()=>e.RootMaterials.forEach(n=>n.envMap=e.parent.envBackground))}function _R(i,e,t){const{globalConfig:r}=e;t.add(r,"isSaveChildren").name("子物体更改存储"),t.add(r,"isSaveMaterials").name("单材质更改存储"),t.add(r,"useGlobalConfig").name("使用(全局)配置");const s=t.addFolder("(全局 )阴影配置");s.add(r.mesh,"castShadow").name("产生阴影").onChange(()=>e.children.forEach(a=>a.castShadow=r.mesh.castShadow)),s.add(r.mesh,"receiveShadow").name("接收阴影").onChange(()=>e.children.forEach(a=>a.receiveShadow=r.mesh.receiveShadow)),yw(i,e,t.addFolder("(全局)材质配置")),function(a,n){const{globalConfig:o}=a;let l=null;function c(){l&&clearTimeout(l),l=setTimeout(()=>{a.children.forEach(h=>{h.geometry.dispose(),o.geometry.isEmpty?(h.geometry.parameters.shapes.holes=[h.geometry.parameters.shapes.path],h.geometry.parameters.shapes.curves=[]):(h.geometry.parameters.shapes.curves=[h.geometry.parameters.shapes.path],h.geometry.parameters.shapes.holes=[]),h.geometry=new Qn(h.geometry.parameters.shapes,o.geometry.parameters),h.geometry.center()}),l=null},200)}n.add(o.geometry,"isEmpty").name("镂空").onChange(c),n.add(o.geometry.parameters,"depth").name("深度").onChange(c).min(.001),n.add(o.geometry.parameters,"bevelEnabled").name("斜角").onChange(c),n.add(o.geometry.parameters,"bevelThickness").name("斜角厚度").onChange(c).min(0),n.add(o.geometry.parameters,"bevelSize").name("斜角大小").onChange(c).min(0),n.add(o.geometry.parameters,"bevelOffset").name("斜角偏移").onChange(c).min(0)}(e,t.addFolder("形状配置"))}function yw(i,e,t){const{globalConfig:r}=e,{material:s}=r;t.addColor(s,"color").name("颜色").onChange(a=>e.RootMaterials.forEach(n=>n.color.set(a))),t.add(s,"wireframe").name("线框").onChange(a=>e.RootMaterials.forEach(n=>n.wireframe=a)),t.add(s,"transparent").name("透明").onChange(a=>e.RootMaterials.forEach(n=>n.transparent=a)),t.add(s,"opacity",0,1).name("透明度").onChange(a=>e.RootMaterials.forEach(n=>n.opacity=a)),["标准材质","物理材质"].includes(e.materialType)&&(t.add(s,"metalness",0,1).name("金属感").onChange(a=>e.RootMaterials.forEach(n=>n.metalness=a)),t.add(s,"roughness",0,1).name("粗糙感").onChange(a=>e.RootMaterials.forEach(n=>n.roughness=a))),e.materialType!=="基础材质"&&(t.addColor(s,"emissive").name("自发光").onChange(a=>e.RootMaterials.forEach(n=>n.emissive.set(a))),t.add(s,"emissiveIntensity",0).name("自发光强度").onChange(a=>e.RootMaterials.forEach(n=>n.emissiveIntensity=a))),e.materialType!=="卡通材质"&&(t.add(s,"envMap").name("环境贴图").onChange(a=>e.RootMaterials.forEach(n=>n.envMap=a?i.envBackground:null)),t.add(s,"envMapIntensity",0).name("环境贴图强度").onChange(a=>e.RootMaterials.forEach(n=>n.envMapIntensity=a)),t.add(s,"reflectivity",0,1).name("反射率").onChange(a=>e.RootMaterials.forEach(n=>n.reflectivity=a))),e.materialType==="物理材质"&&(t.add(s,"clearcoat",0,1).name("清漆层").onChange(a=>e.RootMaterials.forEach(n=>n.clearcoat=a)),t.add(s,"clearcoatRoughness",0,1).name("清漆层粗糙度").onChange(a=>e.RootMaterials.forEach(n=>n.clearcoatRoughness=a)),t.add(s,"sheen",0,1).name("光泽度").onChange(a=>e.RootMaterials.forEach(n=>n.sheen=a)),t.add(s,"sheenRoughness",0,1).name("光泽粗糙度").onChange(a=>e.RootMaterials.forEach(n=>n.sheenRoughness=a)),t.addColor(s,"sheenColor").name("光泽颜色").onChange(a=>e.RootMaterials.forEach(n=>n.sheenColor.set(a))),t.add(s,"transmission",0,1).name("透射率").onChange(a=>e.RootMaterials.forEach(n=>n.transmission=a))),t.addFn(()=>e.RootMaterials.forEach(a=>a.needsUpdate=!0)).name("手动更新材质"),function(a,n,o){const{material:l}=n.globalConfig;function c(d){n.RootMaterials.forEach(p=>{p.map&&(p.map[d]=l.map[d])})}function h(){const{mapUrl:d,map:p}=l;if(!d)return;const f=new gs().load(d);f.wrapS=Kt,f.wrapT=Kt,f.repeat.set(p.repeat.x,p.repeat.y),f.offset.set(p.offset.x,p.offset.y),f.center.set(p.center.x,p.center.y),f.rotation=p.rotation,n.texture=f,n.RootMaterials.forEach(g=>{g.map=f,g.needsUpdate=!0})}function u(d){d?(n.commonAnimateRender=function(){this.texture.offset.x+=this.globalConfig.material.textureAnimation.offset.x,this.texture.offset.y+=this.globalConfig.material.textureAnimation.offset.y,this.texture.rotation+=this.globalConfig.material.textureAnimation.rotation},a.push(n)):delete n.texture.commonAnimateRender}o.add(l,"mapUrl").name("贴图路径"),o.add(l.map.repeat,"x").name("水平重复").onChange(d=>c("repeat")),o.add(l.map.repeat,"y").name("垂直重复").onChange(d=>c("repeat")),o.add(l.map.offset,"x").name("水平偏移").onChange(d=>c("offset")),o.add(l.map.offset,"y").name("垂直偏移").onChange(d=>c("offset")),o.add(l.map,"rotation",0,2*Math.PI).name("旋转").onChange(d=>c("rotation")),o.add(l.map.center,"x").name("水平中心").onChange(d=>c("center")),o.add(l.map.center,"y").name("垂直中心").onChange(d=>c("center")),o.add(l.textureAnimation,"isTextureAnimation").name("贴图动画").onChange(d=>u(d)),o.add(l.textureAnimation.offset,"x").name("水平偏移动画"),o.add(l.textureAnimation.offset,"y").name("垂直偏移动画"),o.add(l.textureAnimation,"rotation",0,2*Math.PI).name("旋转动画"),o.addFn(()=>h()).name("更新贴图")}(i.commonFrames,e,t.addFolder("贴图"))}function yR(i,e){return os(this,null,function*(){var t;if(!e)return;const r=new Mi;return r.url=e.url,r.materialType=e.materialType,r.globalConfig=e.globalConfig,r.isListMaterial=e.isListMaterial,r.edgeMaterialType=e.edgeMaterialType,yield K0(i,r),Jn(r,e),_w(i,r),r.globalConfig.isSaveChildren&&Ap(r.children,e.children),r.globalConfig.isSaveMaterials&&r.RootMaterials.forEach((s,a)=>V0(s,e.RootMaterials[a])),(t=r.listMaterial)==null||t.forEach((s,a)=>wp(i,s,e.listMaterial[a])),function(s,a){const{label:n}=a.globalConfig;n.show&&Og(s,a,n)}(i,r),r})}function K0(i,e){return os(this,null,function*(){let t=null;return t=typeof e.url=="string"?yield fetch(e.url).then(r=>r.json()):e.url,function(r,s){if(s.isListMaterial){const{materialType:a,edgeMaterialType:n}=s;s.listMaterial=[Wr(a,{color:16777215*Math.random(),transparent:!0}),Wr(n,{color:16777215*Math.random(),transparent:!0})]}r.forEach(a=>{a.geometry.type==="MultiPolygon"?a.geometry.coordinates.forEach(n=>n.forEach(o=>F1(o,s,a))):a.geometry.type==="Polygon"&&a.geometry.coordinates.forEach(n=>F1(n,s,a))})}(t.features,e),vw(e),e.RootMaterials=Tp(e),e.rotation.x=-Math.PI/2,e.isGeoGroup=!0,i.add(e),e})}function z1(i,e,t){var r;t.add(e,"url").name("地址源修改"),Ys(e,t.addFolder("基础配置")),_R(i,e,t.addFolder("子项和全局配置")),function(s,a,n){const{label:o}=a.globalConfig;function l(h){if(!a.labelGroup)return;const u=Object.values(a.labelGroup);switch(h){case"type":c(),Og(s,a,o);break;case"color":u.forEach(d=>d.element.style.color=o[h]);break;case"fontSize":u.forEach(d=>d.element.style.fontSize=o[h]+"px");break;case"fontWeight":u.forEach(d=>d.element.style.fontWeight=o[h]);break;case"px":u.forEach(d=>d.position.x=d._position.x+o[h]);break;case"py":u.forEach(d=>d.position.y=d._position.y+o[h]);break;case"pz":u.forEach(d=>d.position.z=d._position.z+o[h]);break;case"rx":u.forEach(d=>d.rotation.x=o[h]);break;case"ry":u.forEach(d=>d.rotation.y=o[h]);break;case"rz":u.forEach(d=>d.rotation.z=o[h]);break;case"ss":u.forEach(d=>d.scale.setScalar(o[h]));break;case"sx":u.forEach(d=>d.scale.x=o[h]);break;case"sy":u.forEach(d=>d.scale.y=o[h]);break;case"sz":u.forEach(d=>d.scale.z=o[h])}}function c(){a.labelGroup&&Object.keys(a.labelGroup).forEach(h=>{s.remove(a.labelGroup[h]),delete a.labelGroup[h]})}n.add(o,"show").name("显示标签").onChange(h=>h?Og(s,a,o):c()),n.add(o,"type",["2D","3D"]).name("标签类型").onChange(h=>l("type")),n.addColor(o,"color").name("标签颜色").onChange(h=>l("color")),n.add(o,"fontSize",0).name("标签字体大小").onChange(h=>l("fontSize")),n.add(o,"fontWeight",["400","500","600","700","800","900"]).name("标签字体粗细").onChange(h=>l("fontWeight")),n.add(o,"px").name("标签位置X偏移").onChange(h=>l("px")),n.add(o,"py").name("标签位置Y偏移").onChange(h=>l("py")),n.add(o,"pz").name("标签位置Z偏移").onChange(h=>l("pz")),n.add(o,"rx",0,2*Math.PI).name("标签旋转X偏移").onChange(h=>l("rx")),n.add(o,"ry",0,2*Math.PI).name("标签旋转Y偏移").onChange(h=>l("ry")),n.add(o,"rz",0,2*Math.PI).name("标签旋转Z偏移").onChange(h=>l("rz")),n.add(o,"ss").name("标签缩放").onChange(h=>l("ss")),n.add(o,"sx").name("标签缩放X").onChange(h=>l("sx")),n.add(o,"sy").name("标签缩放Y").onChange(h=>l("sy")),n.add(o,"sz").name("标签缩放Z").onChange(h=>l("sz"))}(i,e,t.addFolder("标签配置")),(r=e.listMaterial)==null||r.forEach((s,a)=>Sp(i,s,t.addFolder(a?"边缘":"面"))),t.addFn(()=>{t.parent.removeFolder(t),i.remove(e)}).name("删除地图")}function xR(i,e,t){const r=t.addFolder("地图列表");return r.open(),t.add(i,"url").name("地图数据地址"),t.add(i,"materialType",qo).name("地图材质类型"),t.add(i,"isListMaterial").name("是否列表材质"),t.add(i,"edgeMaterialType",qo).name("边缘材质类型"),t.addFn(()=>os(this,null,function*(){if(!i.url)return;const{url:s,materialType:a,isListMaterial:n,edgeMaterialType:o}=i,l=yield K0(e,function(c,h,u,d){const p=new Mi;return p.url=c,p.materialType=h,p.isListMaterial=u,p.edgeMaterialType=d,function(f){f.globalConfig||(f.globalConfig={useGlobalConfig:!1,isSaveChildren:!0,isSaveMaterials:!0,mesh:{castShadow:!1,receiveShadow:!1},material:{color:16777215,wireframe:!1,transparent:!0,opacity:1,metalness:0,roughness:0,emissive:0,emissiveIntensity:1,clearcoat:0,clearcoatRoughness:0,sheen:0,sheenRoughness:0,sheenColor:0,transmission:0,envMap:!1,envMapIntensity:1,reflectivity:.98,mapUrl:"",textureAnimation:{isTextureAnimation:!1,offset:{x:0,y:.01},rotation:0},map:{repeat:{x:1,y:1},offset:{x:0,y:0},center:{x:0,y:0},rotation:0}},geometry:{geometryType:"形状路径挤压体",isEmpty:!1,parameters:{depth:16,bevelEnabled:!1,bevelThickness:0,bevelSize:0,bevelOffset:0}},label:{show:!1,type:"2D",color:"#fff",fontSize:12,fontWeight:400,px:0,py:0,pz:0,rx:0,ry:0,rz:0,ss:1,sx:1,sy:1,sz:1}})}(p),p}(s,a,n,o));z1(e,l,r.addFolder(sr(l)))})).name("添加地图"),e.children.forEach(s=>s.isGeoGroup&&z1(e,s,r.addFolder(sr(s)))),t}function bR(i){return i.map(e=>function(t){const{url:r,globalConfig:s,materialType:a,isListMaterial:n,edgeMaterialType:o,listMaterial:l,children:c,RootMaterials:h}=t;return mi(Re({},$n(t)),{url:r,globalConfig:s,materialType:a,isListMaterial:n,edgeMaterialType:o,listMaterial:l==null?void 0:l.map(u=>Mp(u)),RootMaterials:s.isSaveMaterials?h.map(u=>B0(u)):void 0,children:s.isSaveChildren?Ep(c):void 0})}(e))}function B1(i,e,t){YM(e,t.addFolder("基础配置"));const{globalConfig:r}=e;t.add(r,"isSaveChildren").name("子物体更改存储"),t.add(r,"isSaveMaterials").name("单材质更改存储"),t.add(r,"useGlobalConfig").name("全局材质配置");const s=t.addFolder("阴影");s.add(r.mesh,"castShadow").name("产生阴影").onChange(()=>e.children.forEach(a=>a.castShadow=r.mesh.castShadow)),s.add(r.mesh,"receiveShadow").name("接收阴影").onChange(()=>e.children.forEach(a=>a.receiveShadow=r.mesh.receiveShadow)),function(a,n){const{globalConfig:o}=a,{geometry:l}=o;let c=null;function h(){c&&clearTimeout(c),c=setTimeout(()=>{a.children.forEach(u=>{u.geometry.dispose(),u.geometry=new Gs(u.curve,(u.curve.points.length-1)*l.tubularSegmentsMultiple,l.radius,l.radialSegments,l.closed),u.geometry.center()}),c=null},200)}n.add(l,"tubularSegmentsMultiple",1).name("分段倍乘").onChange(h).step(1),n.add(l,"radius",.01).name("管道半径").onChange(h),n.add(l,"radialSegments",2).name("管道半径分段").onChange(h).step(1),n.add(l,"closed").name("管道是否闭合").onChange(h)}(e,t.addFolder("几何体")),yw(i,e,t.addFolder("材质")),t.addFn(()=>{t.parent.removeFolder(t),i.remove(e)}).name("删除边界")}function xw(i,e,t=0){const r=new Mi;return r.materialType=e,r.url=i,r.dlength=t,function(s){s.globalConfig={useGlobalConfig:!1,isSaveMaterials:!0,isSaveChildren:!0,mesh:{castShadow:!1,receiveShadow:!1},material:{color:16777215,wireframe:!1,transparent:!0,opacity:1,metalness:0,roughness:0,emissive:0,emissiveIntensity:1,clearcoat:0,clearcoatRoughness:0,sheen:0,sheenRoughness:0,sheenColor:0,transmission:0,envMap:!1,envMapIntensity:1,reflectivity:.98,mapUrl:"",textureAnimation:{isTextureAnimation:!1,offset:{x:0,y:.01},rotation:0},map:{repeat:{x:1,y:1},offset:{x:0,y:0},center:{x:0,y:0},rotation:0}},geometry:{radialSegments:4,radius:2,closed:!1,tubularSegmentsMultiple:1}}}(r),fetch(i).then(s=>s.json()).then(s=>{const{features:a}=s;return a.forEach(n=>{n.geometry.type==="MultiPolygon"?n.geometry.coordinates.forEach(o=>o.forEach(l=>of(r,l))):n.geometry.type==="Polygon"?n.geometry.coordinates.forEach(o=>of(r,o)):n.geometry.type==="LineString"&&n.geometry.coordinates.length>1&&of(r,n.geometry.coordinates)}),vw(r),r.RootMaterials=Tp(r),r.rotation.x=-Math.PI/2,r.isBorderGroup=!0,r})}function of(i,e){if(e.length<i.dlength)return;const t=e.map(o=>function(l,c=1e4){const[h,u]=l,[d,p]=ji("EPSG:4326","EPSG:3857",[h,u]);return new C(d/c,p/c,0)}(o)),r=new cp(t),s=new Gs(r,t.length-1,2,4,!1),a=Wr(i.materialType,{color:16777215*Math.random(),transparent:!0,alphaHash:!0}),n=new ye(s,a);n.curve=r,ew(n),i.attach(n)}function MR(i){return i.map(e=>function(t){const{children:r,RootMaterials:s}=t;return mi(Re({},j0(t)),{globalConfig:t.globalConfig,url:t.url,dlength:t.dlength,materialType:t.materialType,RootMaterials:t.globalConfig.isSaveMaterials?s.map(a=>B0(a)):void 0,children:t.globalConfig.isSaveChildren?Ep(r):void 0})}(e))}function wR(i,e){e&&e.forEach(t=>function(r,s){return os(this,null,function*(){if(!s)return;const a=yield xw(s.url,s.materialType,s.dlength);a.globalConfig=s.globalConfig;const{geometry:n}=a.globalConfig;return a.children.forEach(o=>{o.geometry.dispose(),o.geometry=new Gs(o.curve,(o.curve.points.length-1)*n.tubularSegmentsMultiple,n.radius,n.radialSegments,n.closed),o.geometry.center()}),r.add(a),W0(a,s),_w(r,a),a.globalConfig.isSaveChildren&&Ap(a.children,s.children),a.globalConfig.isSaveMaterials&&a.RootMaterials.forEach((o,l)=>V0(o,s.RootMaterials[l])),a})}(i,t))}function bw(i,e,t){const r=Mw(t),s=function(n,o){const{uniforms:l,fragmentFunc:c,fragmentBody:h,key:u,render:d}=function(f,g,m=""){const{name:v,customUniforms:_,key:y,fragment:x,render:b}=nM[g],M={uniforms:Re({},Td(f,["pointTexture-texture-sampler2D-"+m,"size-number-float-100","discardVal-number-float-0.5","opacity-number-float-1","isdecaySize-bool-bool-true","hasUv-bool-bool-true","iTime-number-float-0","speed-number-float-0.01","intensity-number-float-1","mixRatio-number-float-1","mixColor-color-vec3-0xffffff","iResolution-dom-vec2-0,0"])),fragmentFunc:"",fragmentBody:"",key:y,shaderProgramsCodeName:v};if(_&&Object.assign(M.uniforms,Td(f,_)),x.search("<SPLIT_PLACEHOLDER>")!==-1){const[T,A]=x.split("<SPLIT_PLACEHOLDER>");M.fragmentFunc=T,M.fragmentBody=A.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;")}else M.fragmentBody=x.replace("<UV_PLACEHOLDER>","if(hasUv) uv=vUv;");return M.render=b==="iTime+speed"?()=>M.uniforms.iTime.value+=M.uniforms.speed.value:new Function(b).bind(M.uniforms),M}(n,o.shaderCodeName,o.mapUrl),p=new at({uniforms:l,vertexShader:`

            uniform float size;

            uniform bool isdecaySize;

            void main() {

                vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );

                gl_PointSize = isdecaySize ? size * ( 300.0 / -mvPosition.z ) : size;

                gl_Position = projectionMatrix * mvPosition;

            } 

        `,fragmentShader:Object.keys(l).map(f=>"uniform "+l[f].unit+" "+f+`;
`).join("")+`${c}void main() {

            vec2 vUv = gl_PointCoord.xy - .5;

            ${h}
            
            vec3 useColor = ${u};

            vec4 textureColor = texture2D( pointTexture, gl_PointCoord );

            if (textureColor.a < discardVal) discard;

            else useColor *= textureColor.rgb;

            gl_FragColor = vec4( mix( mixColor, useColor * vec3( intensity, intensity, intensity), mixRatio ) , opacity );
            
        }`,transparent:!0,depthTest:!0,blending:Vs});return p.materialRender=d,p}(e,t),a=new Ea(r,s);return a.parameters=t,a.commonAnimateRender=()=>{var n,o,l,c;(o=(n=a.geometry).geometryRender)==null||o.call(n),(c=(l=a.material).materialRender)==null||c.call(l)},a.isParticleMesh=!0,i.add(a),i.commonFrames.push(a),a}function Mw(i){if(i.outer-i.inner<1)return new Ie;const e=new Float32Array(3*i.particlesSum),t=new Float32Array(3*i.particlesSum),r={全随机:n=>{t[3*n]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+1]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+2]+=(Math.random()-.5)*i.maxVelocity/1e3},随机向上:n=>{t[3*n]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+1]+=Math.abs((Math.random()-.5)*i.maxVelocity/1e5),t[3*n+2]+=(Math.random()-.5)*i.maxVelocity/1e3},随机向下:n=>{t[3*n]+=(Math.random()-.5)*i.maxVelocity/1e3,t[3*n+1]-=Math.abs((Math.random()-.5)*i.maxVelocity/1e5),t[3*n+2]+=(Math.random()-.5)*i.maxVelocity/1e3},直线匀速向上:n=>{t[3*n]=0,t[3*n+1]+=i.maxVelocity/2/1e5,t[3*n+2]=0},直线匀速向下:n=>{t[3*n]=0,t[3*n+1]-=i.maxVelocity/2/1e5,t[3*n+2]=0}}[i.sportType];function s(){let n,o,l;do n=2*Math.random()*i.outer-i.outer,o=2*Math.random()*i.outer-i.outer,l=2*Math.random()*i.outer-i.outer;while(Math.abs(n)<=i.inner&&Math.abs(o)<=i.inner&&Math.abs(l)<=i.inner);return[n,o,l]}for(let n=0;n<i.particlesSum;n++)e.set(s(),3*n);const a=new Ie;return a.setAttribute("position",new Ke(e,3)),a.geometryRender=()=>{for(let n=0;n<i.particlesSum;n++)if(r(n),e[3*n]+=t[3*n],e[3*n+1]+=t[3*n+1],e[3*n+2]+=t[3*n+2],Math.abs(e[3*n])>i.outer||Math.abs(e[3*n+1])>i.outer||Math.abs(e[3*n+2])>i.outer||Math.abs(e[3*n])<i.inner&&Math.abs(e[3*n+1])<i.inner&&Math.abs(e[3*n+2])<i.inner){const[o,l,c]=s();e[3*n]=o,e[3*n+1]=l,e[3*n+2]=c,t[3*n]=0,t[3*n+1]=0,t[3*n+2]=0}a.attributes.position.needsUpdate=!0},a}function V1(i,e,t){Ys(e,t.addFolder("基础属性")),function(r,s){let a=null;function n(){a||(r.geometry.dispose(),r.geometry=new Ie,a=setTimeout(()=>{r.geometry=Mw(r.parameters),a=null},200))}s.add(r.parameters,"particlesSum",1).name("数量").onChange(n),s.add(r.parameters,"inner",0).name("内半径").onChange(n),s.add(r.parameters,"outer",500).name("外半径").onChange(n),s.add(r.parameters,"maxVelocity").name("最大速度").onChange(n),s.add(r.parameters,"sportType",["全随机","随机向下","随机向上","直线匀速向上","直线匀速向下"]).name("运动方式").onChange(n)}(e,t.addFolder("几何")),function(r,s){s.add(r,"depthTest").name("深度测试").onChange(()=>r.needsUpdate=!0),s.add(r,"blending",U0).name("混合模式").onChange(a=>(r.blending=Number(a),r.needsUpdate=!0)),rd(r.uniforms,s.addFolder("着色器参数"))}(e.material,t.addFolder("材质")),t.addFn(()=>i.transformControls.attach(e)).name("选中"),t.addFn(()=>{i.remove(e),t.parent.removeFolder(t)}).name("删除")}function SR(i){return i.map(e=>function(t){const{material:r}=t,{uniforms:s,blending:a,depthTest:n}=r;return mi(Re({},$n(t)),{parameters:t.parameters,material:{uniforms:oM(s),blending:a,depthTest:n}})}(e))}function TR(i,e,t){t==null||t.map(r=>function(s,a,n){if(!n)return;const o=bw(s,a,n.parameters);Jn(o,n);const{material:l}=n;return o.material.blending=l.blending,o.material.depthTest=l.depthTest,lM(o.material.uniforms,l.uniforms),l.needsUpdate=!0,o}(i,e,r))}function H1(i,e,t){Ys(e,t.addFolder("基础配置")),function(r,s){const{geometry:a}=r,{parameters:n}=a,{options:o}=n;let l=null;function c(){l&&clearTimeout(l),l=setTimeout(()=>{r.geometry.dispose(),r.geometry=new KM(r.text,o),l=null},200)}s.add(r,"text").onChange(c).name("文本"),s.add(o,"size").onChange(c).name("大小"),s.add(o,"depth").onChange(c).name("深度"),s.add(o,"height").onChange(c).name("高度"),s.add(o,"curveSegments").onChange(c).name("曲线分段").step(1).min(1),s.add(o,"bevelEnabled").onChange(c).name("斜角"),s.add(o,"bevelThickness").onChange(c).name("斜角厚度"),s.add(o,"bevelSize").onChange(c).name("斜角大小"),s.add(o,"bevelSegments").onChange(c).name("斜角分段").step(1).min(0)}(e,t.addFolder("几何体")),Sp(i,e.material,t.addFolder("材质")),t.addFn(()=>{i.remove(e),t.parent.removeFolder(t)}).name("删除")}function ER(i){return i.map(e=>function(t){const{material:r,geometry:s}=t,{parameters:a}=s,{options:n}=a;return mi(Re({},$n(t)),{fontLink:t.fontLink,text:t.text,geometry:{geometryType:"TextGeometry",parameters:{size:n.size,depth:n.depth,height:n.height,curveSegments:n.curveSegments,bevelEnabled:n.bevelEnabled,bevelThickness:n.bevelThickness,bevelSize:n.bevelSize,bevelSegments:n.bevelSegments}},material:Mp(r)})}(e))}function AR(i,e){e==null||e.forEach(t=>function(r,s){return os(this,null,function*(){if(!s)return;const{geometry:a,material:n}=s,{parameters:o}=a,l=yield QM(s.fontLink,s.text,o),c=Wr(n.materialType),h=new ye(l,c);return h.fontLink=s.fontLink,h.text=s.text,h.isTextMesh=!0,r.add(h),wp(r,h.material,n),Jn(h,s),h})}(i,t))}ji.defaultDatum="WGS84",ji.Proj=ms,ji.WGS84=new ji.Proj("WGS84"),ji.Point=Ko,ji.toPoint=aw,ji.defs=Ui,ji.nadgrid=function(i,e){var t=new DataView(e),r=function(o){var l=o.getInt32(8,!1);return l===11?!1:(l=o.getInt32(8,!0),!0)}(t),s=function(o,l){return{nFields:o.getInt32(8,l),nSubgridFields:o.getInt32(24,l),nSubgrids:o.getInt32(40,l),shiftType:Dg(o,56,64).trim(),fromSemiMajorAxis:o.getFloat64(120,l),fromSemiMinorAxis:o.getFloat64(136,l),toSemiMajorAxis:o.getFloat64(152,l),toSemiMinorAxis:o.getFloat64(168,l)}}(t,r),a=function(o,l,c){for(var h=176,u=[],d=0;d<l.nSubgrids;d++){var p=yP(o,h,c),f=xP(o,h,p,c),g=Math.round(1+(p.upperLongitude-p.lowerLongitude)/p.longitudeInterval),m=Math.round(1+(p.upperLatitude-p.lowerLatitude)/p.latitudeInterval);u.push({ll:[Fo(p.lowerLongitude),Fo(p.lowerLatitude)],del:[Fo(p.longitudeInterval),Fo(p.latitudeInterval)],lim:[g,m],count:p.gridNodeCount,cvs:_P(f)}),h+=176+16*p.gridNodeCount}return u}(t,s,r),n={header:s,subgrids:a};return iw[i]=n,n},ji.transform=Nd,ji.mgrs=wP,ji.version="__VERSION__",function(i){i.Proj.projections.add(nd),i.Proj.projections.add(od),i.Proj.projections.add(kP),i.Proj.projections.add(FP),i.Proj.projections.add(zP),i.Proj.projections.add(BP),i.Proj.projections.add(VP),i.Proj.projections.add(HP),i.Proj.projections.add(GP),i.Proj.projections.add(jP),i.Proj.projections.add(QP),i.Proj.projections.add($P),i.Proj.projections.add(JP),i.Proj.projections.add(eR),i.Proj.projections.add(tR),i.Proj.projections.add(iR),i.Proj.projections.add(rR),i.Proj.projections.add(sR),i.Proj.projections.add(aR),i.Proj.projections.add(nR),i.Proj.projections.add(oR),i.Proj.projections.add(lR),i.Proj.projections.add(cR),i.Proj.projections.add(hR),i.Proj.projections.add(uR),i.Proj.projections.add(pR),i.Proj.projections.add(mR),i.Proj.projections.add(fR),i.Proj.projections.add(gR),i.Proj.projections.add(vR)}(ji);const CR={name:"光柱",initParameters:{url:"http://guangfu/channels/lightMap.png",size:.25},initPanel:function(i){i.add(this.initParameters,"url").name("资源路径"),i.add(this.initParameters,"size").name("立柱尺寸")},create:function({},i){const e=Re(Re({},this.initParameters),i==null?void 0:i.initParameters),t=new Ft(e.size||.3,e.size||.3,20,6),r=new Qt({color:16572044,transparent:!0,opacity:.5,side:Rt}),s=new ye(t,r);r.blending=Vs;const a=new gs().load(e.url);a.wrapS=Kt,a.wrapT=Kt;const n=new ys(1.5,20),o=new Qt({transparent:!0,opacity:.3,side:Rt,map:a});o.blending=Vs,o.depthTest=!1;const l=new ye(n,o),c=l.clone();c.rotation.y=Math.PI/3;const h=l.clone();h.rotation.y=-Math.PI/3,s.add(h),s.add(l),s.add(c),s.position.y=10;const u=new Mi;return u.RootMaterials=[r,o],u.add(s),u.initParameters=e,u},changePanel(i,e,{}){const[t,r]=i.RootMaterials;e.add(i.initParameters,"url").name("资源路径"),e.addHexColor(t.color).name("立柱颜色"),e.add(t,"opacity",0,1).name("立柱透明度"),e.addHexColor(r.color).name("面颜色"),e.add(r,"opacity",0,1).name("面透明度"),e.addFn(()=>{const{url:s}=i.initParameters;if(!s)return;const a=new gs().load(s);a.wrapS=Kt,a.wrapT=Kt,i.children[0].children.forEach(n=>{n.material.map=a})}).name("更新贴图")},getStorage:function(i){const{initParameters:e}=i,[t,r]=i.RootMaterials;return{initParameters:e,RootMaterials:[{color:t.color.getHex(),opacity:t.opacity},{color:r.color.getHex(),opacity:r.opacity}]}},setStorage:function(i,e){if(!e)return;const[t,r]=i.RootMaterials,[s,a]=e.RootMaterials;t.color.setHex(s.color),t.opacity=s.opacity,r.color.setHex(a.color),r.opacity=a.opacity}};class Cp extends ye{constructor(e,t={}){super(e),this.isReflector=!0,this.type="Reflector",this.camera=new Zt;const r=this,s=t.color!==void 0?new ve(t.color):new ve(8355711),a=t.textureWidth||512,n=t.textureHeight||512,o=t.clipBias||0,l=t.shader||Cp.ReflectorShader,c=t.multisample!==void 0?t.multisample:4,h=new Br,u=new C,d=new C,p=new C,f=new Me,g=new C(0,0,-1),m=new qe,v=new C,_=new C,y=new qe,x=new Me,b=this.camera,M=new pt(a,n,{samples:c,type:Yt}),T=new at({name:l.name!==void 0?l.name:"unspecified",uniforms:ii.clone(l.uniforms),fragmentShader:l.fragmentShader,vertexShader:l.vertexShader});T.uniforms.tDiffuse.value=M.texture,T.uniforms.color.value=s,T.uniforms.textureMatrix.value=x,this.material=T,this.onBeforeRender=function(A,L,U){if(d.setFromMatrixPosition(r.matrixWorld),p.setFromMatrixPosition(U.matrixWorld),f.extractRotation(r.matrixWorld),u.set(0,0,1),u.applyMatrix4(f),v.subVectors(d,p),v.dot(u)>0)return;v.reflect(u).negate(),v.add(d),f.extractRotation(U.matrixWorld),g.set(0,0,-1),g.applyMatrix4(f),g.add(p),_.subVectors(d,g),_.reflect(u).negate(),_.add(d),b.position.copy(v),b.up.set(0,1,0),b.up.applyMatrix4(f),b.up.reflect(u),b.lookAt(_),b.far=U.far,b.updateMatrixWorld(),b.projectionMatrix.copy(U.projectionMatrix),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(b.projectionMatrix),x.multiply(b.matrixWorldInverse),x.multiply(r.matrixWorld),h.setFromNormalAndCoplanarPoint(u,d),h.applyMatrix4(b.matrixWorldInverse),m.set(h.normal.x,h.normal.y,h.normal.z,h.constant);const P=b.projectionMatrix;y.x=(Math.sign(m.x)+P.elements[8])/P.elements[0],y.y=(Math.sign(m.y)+P.elements[9])/P.elements[5],y.z=-1,y.w=(1+P.elements[10])/P.elements[14],m.multiplyScalar(2/m.dot(y)),P.elements[2]=m.x,P.elements[6]=m.y,P.elements[10]=m.z+1-o,P.elements[14]=m.w,r.visible=!1;const E=A.getRenderTarget(),I=A.xr.enabled,S=A.shadowMap.autoUpdate;A.xr.enabled=!1,A.shadowMap.autoUpdate=!1,A.setRenderTarget(M),A.state.buffers.depth.setMask(!0),A.autoClear===!1&&A.clear(),A.render(L,b),A.xr.enabled=I,A.shadowMap.autoUpdate=S,A.setRenderTarget(E);const V=U.viewport;V!==void 0&&A.state.viewport(V),r.visible=!0},this.getRenderTarget=function(){return M},this.dispose=function(){M.dispose(),r.material.dispose()}}}Cp.ReflectorShader={name:"ReflectorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};const PR={name:"镜面",disBlendShader:!0,initParameters:{clipBias:.01,color:12700619},initPanel:function(i){i.add(this.initParameters,"clipBias").name("裁剪偏移"),i.addColor(this.initParameters,"color").name("颜色")},create:function(i,e){const t=Re(Re({},this.initParameters),e==null?void 0:e.initParameters),{DOM:r,renderer:s}=i,a=new Cp(new ys(100,100),Re({clipBias:.01,textureWidth:r.clientWidth*s.getPixelRatio(),textureHeight:r.clientHeight*s.getPixelRatio(),color:12700619},t));return a.initParameters=t,a.rotateX(-Math.PI/2),a},changePanel:function(i,e){const{material:t}=i;e.add(t,"visible").name("可见"),e.add(t,"wireframe").name("线框"),e.addHexColor(t.uniforms.color.value).name("颜色")},getStorage:function(i){const{material:e,initParameters:t}=i;return{initParameters:t,material:{wireframe:e.wireframe,color:e.uniforms.color.value.getHex()}}},setStorage:function(i,e){if(!e)return;const{material:t}=i;t.wireframe=e.material.wireframe,t.uniforms.color.value.setHex(e.material.color)}},ww=Object.values(Object.assign({"../../Addons/DesignMesh/LightColumn.js":CR,"../../Addons/DesignMesh/Mirror.js":PR})),_h=i=>ww.find(e=>e.name===i);function G1(i,e,t){var r;const{scene:s,transformControls:a}=t,n=_h(i.designType);Ys(i,e.addFolder("基础配置")),(r=n.changePanel)==null||r.call(n,i,e.addFolder("相关配置"),t),e.addFn(()=>a.attach(i)).name("选中"),e.addFn(()=>{s.remove(i),e.parent.removeFolder(e)}).name("删除")}function Sw(i,e,t){const r=i.create(e,t);if(r)return r.isDesignMesh=!0,r.designType=i.name,i.disBlendShader&&(r.disBlendShader=!0),r}function RR(i){return i.map(e=>function(t){var r;const{designType:s}=t,a=_h(s);return Re(Re({designType:s},$n(t)),(r=a.getStorage)==null?void 0:r.call(a,t))}(e))}function IR(i,e){e==null||e.forEach(t=>function(r,s){var a;if(!s)return;const{scene:n}=r,o=_h(s.designType),l=Sw(o,r,s);n.add(l),Jn(l,s),(a=o.setStorage)==null||a.call(o,l,s,r)}(i,t))}function j1(i,e){var t;const r=_h(i);r&&((t=r.initPanel)==null||t.call(r,e))}function LR(){return{modelCore:{rootFolder:null,insertModel:null,progressList:[],url:"",modelAnimationPlay:X0},innerMeshCore:{geometryType:"立方体",materialType:"标准材质"},drawCore:{mode:"围栏物体",pointMode:"场景交点",pointModeList:["场景交点","地图区域中心","地图行政中心"],modeList:["围栏物体","平面绘制","曲线路径","直线路径"],materialType:"标准材质",drawEventCall:null,currentDrawFolder:null,sceneEventCall:function(i,e){var t,r,s,a,n;switch(this.pointMode){case"场景交点":return(t=this.drawEventCall)==null?void 0:t.call(this,i);case"地图区域中心":return(r=e.geoInfo)!=null&&r.properties.centroidCoord3?(s=this.drawEventCall)==null?void 0:s.call(this,e.parent.getTransformedVector(e.geoInfo.properties.centroidCoord3.clone().add(e.position).sub(e.initTranslate))):void 0;case"地图行政中心":return(a=e.geoInfo)!=null&&a.properties.centerCoord3?(n=this.drawEventCall)==null?void 0:n.call(this,e.parent.getTransformedVector(e.geoInfo.properties.centerCoord3.clone().add(e.position).sub(e.initTranslate))):void 0}}},chartsMapCore:{url:"https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json",materialType:"标准材质",isListMaterial:!0,edgeMaterialType:"标准材质",progressList:[],createGeoGroup:K0},particleCore:{particlesSum:1e5,inner:0,outer:2e3,maxVelocity:50,mapUrl:"http://guangfu/icon/snow.png",sportType:"全随机",shaderCodeName:"水波纹"},textMeshCore:{fontLink:"http://guangfu/font/cn.json",text:"",materialType:"标准材质"},designMeshCore:{type:"光柱"},borderGroupCore:{url:"https://geo.datav.aliyun.com/areas_v3/bound/100000.json",materialType:"基础材质",dlength:0}}}function DR(i){const e={lightList:[],modelList:[],innerMeshList:[],drawMeshList:[],geoGroupList:[],borderGroupList:[],particleList:[],textMeshList:[],designMeshList:[]};return i.children.forEach(t=>{t.isLight?e.lightList.push(t):t.rootInfo?e.modelList.push(t):t.isInnerMesh?e.innerMeshList.push(t):t.isDrawMesh?e.drawMeshList.push(t):t.isGeoGroup?e.geoGroupList.push(t):t.isParticleMesh?e.particleList.push(t):t.isTextMesh?e.textMeshList.push(t):t.isBorderGroup?e.borderGroupList.push(t):t.isDesignMesh&&e.designMeshList.push(t)}),{lighting:wC(e.lightList),modelList:V3(e.modelList),innerMeshList:H3(e.innerMeshList),drawMeshList:Q3(e.drawMeshList),geoGroupList:bR(e.geoGroupList),particleList:SR(e.particleList),textMeshList:ER(e.textMeshList),borderGroupList:MR(e.borderGroupList),designMeshList:RR(e.designMeshList)}}function OR(i,e,t){if(!t)return;const{scene:r,DOM:s}=i,{modelCore:a,chartsMapCore:n}=e;(function(o,l){l&&l.forEach(c=>{const h=G0(c.type);MC(h,c),h.target&&o.add(h.target),o.add(h)})})(r,t.lighting),function(o,l){l&&(o.progressList=l.map(c=>o.insertModel(c.rootInfo,c.group)))}(a,t.modelList),G3(r,t.innerMeshList),$3(r,t.drawMeshList),function(o,l,c){c&&(o.progressList=c.map(h=>yR(l,h)))}(n,r,t.geoGroupList),wR(r,t.borderGroupList),TR(r,s,t.particleList),AR(r,t.textMeshList),IR(i,t.designMeshList)}function NR(i,e,t){const{scene:r,DOM:s}=i,{modelCore:a,innerMeshCore:n,drawCore:o,chartsMapCore:l,borderGroupCore:c,particleCore:h,textMeshCore:u,designMeshCore:d}=e,p={灯光配置:()=>function(f,g){const m={lightType:"AmbientLight"};return g.add(m,"lightType",["AmbientLight","DirectionalLight","PointLight","SpotLight","HemisphereLight","RectAreaLight"]).name("光源类型"),g.addFn(function(){const v=G0(m.lightType);v.target&&f.add(v.target),f.attach_add(v),qy(v,g.addFolder(v.type+v.id),f.transformControls)}).name("点击添加光源"),f.children.forEach(v=>{v instanceof qs&&qy(v,g.addFolder(v.type+v.id),f.transformControls)}),g}(r,t.addCoreDragFolder("灯光配置")),模型管理:()=>function(f,g){return f.rootFolder=g,g.add(f,"url").name("模型地址"),g.addFn(()=>{const m=function(v){if(!v)return;const _=v.split(".").pop().toUpperCase();return _&&["FBX","GLB","GLTF","OBJ"].includes(_)?{url:v,type:_==="GLB"?"GLTF":_}:void 0}(f.url);m&&f.insertModel(m)}).name("添加模型"),f.scene.children.forEach(m=>{m.rootInfo&&ZM(f.controls,f.transformControls,f.effectComposer,m,g.addFolder(sr(m)))}),g}(a,t.addCoreDragFolder("模型管理")),内置物体:()=>j3(n,r,t.addCoreDragFolder("内置物体")),绘制物体:()=>function(f,g,m){return m.add(f,"mode",f.modeList).name("绘制模式"),m.add(f,"pointMode",f.pointModeList).name("点模式"),m.add(f,"materialType",qo).name("材质"),m.addFn(()=>{f.currentDrawFolder&&f.currentDrawFolder.close(),f.currentDrawFolder=m.addDateFolder(f.mode),p1(f,g,f.currentDrawFolder),f.currentDrawFolder.open()}).name("添加绘制组"),g.children.forEach(v=>v.isDrawMesh&&p1(f,g,m.addFolder(sr(v)),v.drawParams)),m}(o,r,t.addCoreDragFolder("绘制物体")),三维地图:()=>xR(l,r,t.addCoreDragFolder("三维地图")),地图边界:()=>function(f,g,m){const v=m.addFolder("列表");return v.open(),m.add(f,"url").name("边界物体数据源"),m.add(f,"materialType",qo).name("材质类型"),m.add(f,"dlength",0).name("低于点数舍弃"),m.addFn(()=>{xw(f.url,f.materialType,f.dlength).then(_=>{g.attach_add(_),B1(g,_,v.addFolder(sr(_)))})}).name("添加边界物体"),g.children.forEach(_=>{_.isBorderGroup&&B1(g,_,v.addFolder(sr(_)))}),m}(c,r,t.addCoreDragFolder("地图边界")),粒子物体:()=>function(f,g,m,v){const _=v.addFolder("粒子列表");_.open();const y=v.addFolder("初始化参数");return y.open(),y.add(f,"particlesSum").name("数量"),y.add(f,"inner").name("内半径"),y.add(f,"outer").name("外半径"),y.add(f,"maxVelocity").name("最大速度"),y.add(f,"mapUrl").name("贴图路径"),y.add(f,"shaderCodeName",Object.keys(nM)).name("着色器"),y.add(f,"sportType",["全随机","随机向下","随机向上","直线匀速向上","直线匀速向下"]).name("运动方式"),v.addFn(()=>{const{particlesSum:x,inner:b,outer:M,maxVelocity:T,sportType:A,mapUrl:L,shaderCodeName:U}=f,P=bw(g,m,{particlesSum:x,inner:b,outer:M,maxVelocity:T,sportType:A,mapUrl:L,shaderCodeName:U});V1(g,P,_.addFolder(sr(P)))}).name("增加一个粒子物体"),g.children.forEach(x=>x.isParticleMesh&&V1(g,x,_.addFolder(sr(x)))),v}(h,r,s,t.addCoreDragFolder("粒子物体")),文本物体:()=>function(f,g,m){const v=m.addFolder("列表");return v.open(),m.add(f,"fontLink").name("字体链接"),m.add(f,"materialType",qo).name("材质类型"),m.add(f,"text").name("文本内容"),m.addFn(()=>{f.text&&QM(f.fontLink,f.text).then(_=>{const y=Wr(f.materialType),x=new ye(_,y);x.fontLink=f.fontLink,x.text=f.text,x.isTextMesh=!0,g.attach_add(x),H1(g,x,v.addFolder(x.text.slice(0,8)+" "+x.id))})}).name("添加文本物体"),g.children.forEach(_=>_.isTextMesh&&H1(g,_,v.addFolder(_.text.slice(0,8)+" "+_.id))),m}(u,r,t.addCoreDragFolder("文本物体")),设计物体:()=>function(f,g,m){const{scene:v}=g,_=m.addFolder("列表");let y;m.add(f,"type",ww.map(x=>x.name)).name("类型").onChange(x=>{y.parent.removeFolder(y),y=m.addFolder(x+"初始参数"),j1(x,y),y.open()}),m.addFn(()=>{const x=_h(f.type),b=Sw(x,g);b&&(v.attach_add(b),G1(b,_.addFolder(`${x.name}-${b.id}`),g))}).name("添加"),y=m.addFolder(f.type+"初始参数"),j1(f.type,y),v.children.forEach(x=>x.isDesignMesh&&G1(x,_.addFolder(x.designType+"-"+sr(x)),g))}(d,i,t.addCoreDragFolder("设计物体"))};for(const f in p)t.add(p,f);return{folder:t,panels:p}}function W1(i,e,t){t.add(e,"name").name("名称"),t.addFn(()=>function(r,s){r.target.set(s.target.x,s.target.y,s.target.z),r.object.position.set(s.position.x,s.position.y,s.position.z),r.update()}(i,e)).name("直接查看"),t.addFn(()=>{Tr(i.target,e.target),Tr(i.object.position,e.position)}).name("动画查看"),t.addFn(()=>{const r=i.viewAngleList.indexOf(e);r!==-1&&i.viewAngleList.splice(r,1),t.parent.removeFolder(t)}).name("删除")}function UR(i,e,t){const r=function(a){a.open();const n={mode:"to",query:{duration:2,ease:"none",repeat:0,yoyo:!1}};return a.add(n,"mode",["to","from","fromTo"]).name("动画模式"),a.add(n.query,"duration",0,10).name("动画时长"),a.add(n.query,"ease",["none","power1","power2","power3","power4","back","elastic","bounce"]).name("动画缓动"),a.add(n.query,"repeat",0).name("动画重复次数"),a.add(n.query,"yoyo").name("动画循环"),n}(t.addFolder("动画属性配置"));let s=null;return t.addFn(function(){const{currentInfo:a}=i;if(!a)return;let n;i.mode=="选择"?n=a.currentModel:i.mode=="根选择"?n=a.currentRootModel:i.mode=="变换"&&(n=i.isTransformChildren?a.currentModel:a.currentRootModel),s&&t.removeFolder(s),s=t.addFolder(sr(n)+"动画配置"),e.attach(n),function(o,l,c){const h=c.addFolder("动画列表");o._transformInfo=Oo(o),o.transformAnimationList?o.transformAnimationList.forEach((u,d)=>X1(o,u,h.addFolder("动作["+Date.now()+d+"]"))):o.transformAnimationList=[],c.addFn(()=>Ed(o,o._transformInfo)).name("还原为源信息"),c.addFn(()=>o._transformInfo=Oo(o)).name("当前状态更新为源信息"),c.addFn(()=>Ad(o,o._transformInfo,Oo(o),l)).name("预览动画"),c.addFn(()=>{const u=function(d,p){const{mode:f,query:g}=p;return{name:"",_transformInfo:d._transformInfo,transformInfo_:Oo(d),gsapParams:{mode:f,query:Re({},g)}}}(o,l);o.transformAnimationList.push(u),h.open(),X1(o,u,h.addFolder("动作["+Date.now()+"]"))}).name("保存动画")}(n,r,s)}).name("加载当前物体信息"),t}function X1(i,e,t){t.add(e,"name").name("动作名");const r={play:()=>{const{gsapParams:s,_transformInfo:a,transformInfo_:n}=e;Ad(i,a,n,s)},del:()=>{i.transformAnimationList.splice(i.transformAnimationList.indexOf(e),1),t.parent.removeFolder(t)}};t.add(r,"play").name("播放动作"),t.add(r,"del").name("删除动作")}function kR(i,e,t,r,s,a,n){const o={视角控制:()=>function(l,c){const h=c.addFolder("视角列表");return l.viewAngleList?l.viewAngleList.forEach((u,d)=>W1(l,u,h.addFolder((u.name||"视角")+"["+Date.now()+d+"]"))):l.viewAngleList=[],c.addFn(()=>{const u=function(d){return{name:"",target:{x:d.target.x,y:d.target.y,z:d.target.z},position:{x:d.object.position.x,y:d.object.position.y,z:d.object.position.z}}}(l);l.viewAngleList.push(u),W1(l,u,h.addFolder(u.name||"视角["+Date.now()+"]")),h.open()}).name("记录当前视角"),c}(r,n.addCoreDragFolder("视角控制")),物体动画:()=>UR(t,s,n.addCoreDragFolder("物体动画")),裁剪面板:()=>function(l,c,h,u){const d=u.addFolder("全局裁剪列表");return d.open(),u.add(h,"clipPlaneSize",0).name("裁剪辅助面大小"),u.addFn(()=>{const p=DM();OM(p,h.clipPlaneSize),Wy(l,c,h,p,d.addDateFolder("面")),l.add(p.helper),c.clippingPlanes.push(p)}).name("增加全局裁剪面"),c.clippingPlanes.forEach((p,f)=>Wy(l,c,h,p,d.addFolder(`面${f}`))),u}(i,e,a,n.addCoreDragFolder("裁剪面板"))};for(const l in o)n.add(o,l);return{folder:n,panels:o}}function FR(i,e){const t=mi(Re({},LR()),{handler:{mode:"选择",openKey:!1,selectPanelEnable:!1,keyDown:null,keyDownCallback:null,modeList:["选择","根选择","变换","场景绘制","点击信息"],isTransformChildren:!1,handlerHistory:null,helpers:{axes:{showAxes:!0,axesLength:1e3,axesHelper:null},grid:{showGrid:!0,size:1e3,divisions:15,colorCenterLine:4473924,colorGrid:8947848,gridHelper:null},box3:{useBox3:!0,color:16776960}}},animateCore:{clipPlaneSize:20}}),r=function(h,u){const{scene:d,transformControls:p,effectComposer:f,stats:g,DOM:m}=h,{outlinePass:v}=f.effectPass,{handler:_}=u,{shaderLibrary:y,setObjectBlendShader:x}=mA(d,m);return fC(d,g,_,p,v),function(b,M){const{scene:T,controls:A,transformControls:L,effectComposer:U}=b,{modelCore:P}=M;B3(P,T,A,L,U)}(h,u),{shaderLibrary:y,setObjectBlendShader:x}}(i,t),s={};q1(i,t,e);const{scene:a,transformControls:n,effectComposer:o,css3DRender:l,css2DRender:c}=i;return Re(mi(Re(mi(Re({},t),{addons:s}),r),{saveSceneEdit:()=>(n.detach(),o.effectPass.outlinePass.selectedObjects=[],function(h,u){const{scene:d,camera:p,renderer:f,controls:g,transformControls:m,effectComposer:v}=h,{handler:_}=u;return mi(Re(Re({},lC(d,p,f,g,m,v)),DR(d)),{handler:gC(_)})}(i,t)),resetEditorStorage:h=>{a.resetFrames(),a.children.filter(u=>!u.isTransformControls&&!u.isPerspectiveCamera).forEach(u=>(a.remove(u),gM(u))),a.resetEnv(),l.reset(),c.reset(),q1(i,t,h)}}),zR(i,t))}function q1(i,e,t){if(!t)return;const{scene:r,camera:s,renderer:a,controls:n,transformControls:o,effectComposer:l,stats:c}=i,{handler:h}=e;cC(r,s,a,n,o,l,t),vC(r,o,c,h,t.handler),OR(i,e,t)}function zR(i,e){const{scene:t,camera:r,renderer:s,controls:a,transformControls:n,effectComposer:o,stats:l}=i,{handler:c,animateCore:h}=e,u=GA();return HA(t,u),{GUI:u,openControlPanel:function(){u.__folders.场景||function(...d){const p=kA({style:"max-width: 500px;",tabButtonActiveColor:"rgba(255, 255, 255, 0.1)",tabButtonHoverColor:"none",tabButtonRowColor:"black",tabButtonBorderStyle:"none",tabButtonRowStyleOverrides:{display:"flex","justify-content":"space-evenly",color:"white","background-color":"none"},tabButtonStyleOverrides:{padding:"0.4em 0.8em",color:"#ffffff","font-size":"13px"}},d.reduce((x,b)=>(b.folder.open(),mi(Re({},x),{[b.folder.name]:jy(b.folder.domElement)})),{})),f=Xe.state(220),g=Xe.state("auto"),m=Xe.state(window.innerWidth-220),v=Xe.state(20),_=Xe.state(!1);try{const x=localStorage.getItem("threeEditor_Panel");if(x){const b=JSON.parse(x);d.forEach((M,T)=>M.folder.closed=b.panels[T].closed),m.val=b.x,v.val=b.y}}catch{}Xe.derive(()=>{if(_.val){const x=d.map(b=>{const{parent:M}=b.folder,T=b.folder.name;return delete M.__folders[T],M.load&&M.load.folders&&M.load.folders[T]&&delete M.load.folders[T],{closed:b.folder.closed}});localStorage.setItem("threeEditor_Panel",JSON.stringify({panels:x,x:m.val,y:v.val}))}});const y=Ld(Re({title:"3D-配置",x:m,y:v,closed:_,width:f,height:g},qc),jy({style:`
            
                border: 1px solid rgba(255, 255, 255, 0.2);
                
                border-radius: 3px;

                padding: 5px 0px 5px 0px;
            
            `},p));Xe.add(document.body,y)}(hC(t,r,s,a,n,o,u.addFolder("场景")),_C(t,n,l,c,u.addFolder("操作")),NR(i,e,u.addFolder("元素")),kR(t,s,c,a,n,h,u.addFolder("动画")))}}}function BR(){const i=new qf;i.ssrList=[],function(t){t.commonFrames=[],t.mixerFrames=[],t.shaderFrames=[],t.renderFrames=function(){t.mixerFrames.forEach(r=>r.mixerAnimateRender()),t.shaderFrames.forEach(r=>r.shaderAnimateRender()),t.commonFrames.forEach(r=>{var s;return(s=r.commonAnimateRender)==null?void 0:s.call(r)})},t.resetFrames=function(){["mixerFrames","shaderFrames","commonFrames"].forEach(r=>t[r].length=0)},t.removeFrames=function(r){(r instanceof ye||r instanceof Mi||r.instanceOf===Ea)&&["commonFrames","mixerFrames","shaderFrames"].forEach(s=>{const a=t[s].indexOf(r);a!==-1&&t[s].splice(a,1)})}}(i),function(t){t.environmentEnabled=!1,t.envBackground=null,t.envMapChangeUseList=[];let r=null;Object.defineProperty(t,"envBackground",{get:()=>r,set:s=>{r=s,t.environmentEnabled?t.environment=t.envBackground:t.environment=null,t==null||t.envMapChangeUseList.forEach(a=>a())}}),t.setSceneBackground=function(s){var a;const n=new tg().load(s);t.background=n,t.backgroundUrls=s,(a=t.backgroundLoadCallback)==null||a.call(t,n)},t.setEnvBackground=function(s){const a=new tg().load(s);t.envBackground=a,t.envBackgroundUrls=s},t.resetEnv=function(){var s,a;t.envMapChangeUseList=[],(s=t.envBackground)==null||s.dispose(),t.envBackground=null,(a=t.background)==null||a.dispose(),t.background=null}}(i),i.setClassifyScene=function(t="全部"){i.children.forEach(r=>{(["Group","Mesh"].includes(r.type)||r.isLight)&&(t==="全部"||t.some(s=>r.name.indexOf(s)!==-1)?r.visible=!0:r.visible=!1)})},i.attach_add=function(t){i.add(t),i.transformControls.attach(t)};const e=i.remove;return i.remove=function(t){var r;i.removeFrames(t),i.transformControls.object===t&&i.transformControls.detach(),e.call(i,t),(r=i.removeCall)==null||r.call(i,t)},i}var Mc=function(){var i=0,e=document.createElement("div");function t(h){return e.appendChild(h.dom),h}function r(h){for(var u=0;u<e.children.length;u++)e.children[u].style.display=u===h?"block":"none";i=h}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(h){h.preventDefault(),r(++i%e.children.length)},!1);var s=(performance||Date).now(),a=s,n=0,o=t(new Mc.Panel("FPS","#0ff","#002")),l=t(new Mc.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new Mc.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:e,addPanel:t,showPanel:r,begin:function(){s=(performance||Date).now()},end:function(){n++;var h=(performance||Date).now();if(l.update(h-s,200),h>=a+1e3&&(o.update(1e3*n/(h-a),100),a=h,n=0,c)){var u=performance.memory;c.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return h},update:function(){s=this.end()},domElement:e,setMode:r}};Mc.Panel=function(i,e,t){var r=1/0,s=0,a=Math.round,n=a(window.devicePixelRatio||1),o=80*n,l=48*n,c=3*n,h=2*n,u=3*n,d=15*n,p=74*n,f=30*n,g=document.createElement("canvas");g.width=o,g.height=l,g.style.cssText="width:80px;height:48px";var m=g.getContext("2d");return m.font="bold "+9*n+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=t,m.fillRect(0,0,o,l),m.fillStyle=e,m.fillText(i,c,h),m.fillRect(u,d,p,f),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(u,d,p,f),{dom:g,update:function(v,_){r=Math.min(r,v),s=Math.max(s,v),m.fillStyle=t,m.globalAlpha=1,m.fillRect(0,0,o,d),m.fillStyle=e,m.fillText(a(v)+" "+i+" ("+a(r)+"-"+a(s)+")",c,h),m.drawImage(g,u+n,d,p-n,f,u,d,p-n,f),m.fillRect(u+p-n,d,n,f),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(u+p-n,d,n,a((1-v/_)*f))}}};const Y1={type:"change"},lf={type:"start"},Z1={type:"end"},Bu=new Kn,K1=new Br,VR=Math.cos(70*ni.DEG2RAD);class HR extends fs{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new C,this.cursor=new C,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:un.ROTATE,MIDDLE:un.DOLLY,RIGHT:un.PAN},this.touches={ONE:dn.ROTATE,TWO:dn.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(N){N.addEventListener("keydown",w),this._domElementKeyEvents=N},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",w),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(Y1),r.update(),a=s.NONE},this.update=function(){const N=new C,z=new Qe().setFromUnitVectors(e.up,new C(0,1,0)),Y=z.clone().invert(),q=new C,he=new Qe,de=new C,ue=2*Math.PI;return function(we=null){const Ne=r.object.position;N.copy(Ne).sub(r.target),N.applyQuaternion(z),o.setFromVector3(N),r.autoRotate&&a===s.NONE&&P(function(Je){return Je!==null?2*Math.PI/60*r.autoRotateSpeed*Je:2*Math.PI/60/60*r.autoRotateSpeed}(we)),r.enableDamping?(o.theta+=l.theta*r.dampingFactor,o.phi+=l.phi*r.dampingFactor):(o.theta+=l.theta,o.phi+=l.phi);let xe=r.minAzimuthAngle,Ue=r.maxAzimuthAngle;isFinite(xe)&&isFinite(Ue)&&(xe<-Math.PI?xe+=ue:xe>Math.PI&&(xe-=ue),Ue<-Math.PI?Ue+=ue:Ue>Math.PI&&(Ue-=ue),o.theta=xe<=Ue?Math.max(xe,Math.min(Ue,o.theta)):o.theta>(xe+Ue)/2?Math.max(xe,o.theta):Math.min(Ue,o.theta)),o.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,o.phi)),o.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(h,r.dampingFactor):r.target.add(h),r.target.sub(r.cursor),r.target.clampLength(r.minTargetRadius,r.maxTargetRadius),r.target.add(r.cursor);let je=!1;if(r.zoomToCursor&&M||r.object.isOrthographicCamera)o.radius=ie(o.radius);else{const Je=o.radius;o.radius=ie(o.radius*c),je=Je!=o.radius}if(N.setFromSpherical(o),N.applyQuaternion(Y),Ne.copy(r.target).add(N),r.object.lookAt(r.target),r.enableDamping===!0?(l.theta*=1-r.dampingFactor,l.phi*=1-r.dampingFactor,h.multiplyScalar(1-r.dampingFactor)):(l.set(0,0,0),h.set(0,0,0)),r.zoomToCursor&&M){let Je=null;if(r.object.isPerspectiveCamera){const It=N.length();Je=ie(It*c);const nt=It-Je;r.object.position.addScaledVector(x,nt),r.object.updateMatrixWorld(),je=!!nt}else if(r.object.isOrthographicCamera){const It=new C(b.x,b.y,0);It.unproject(r.object);const nt=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/c)),r.object.updateProjectionMatrix(),je=nt!==r.object.zoom;const ce=new C(b.x,b.y,0);ce.unproject(r.object),r.object.position.sub(ce).add(It),r.object.updateMatrixWorld(),Je=N.length()}else r.zoomToCursor=!1;Je!==null&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Je).add(r.object.position):(Bu.origin.copy(r.object.position),Bu.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(Bu.direction))<VR?e.lookAt(r.target):(K1.setFromNormalAndCoplanarPoint(r.object.up,r.target),Bu.intersectPlane(K1,r.target))))}else if(r.object.isOrthographicCamera){const Je=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/c)),Je!==r.object.zoom&&(r.object.updateProjectionMatrix(),je=!0)}return c=1,M=!1,!!(je||q.distanceToSquared(r.object.position)>n||8*(1-he.dot(r.object.quaternion))>n||de.distanceToSquared(r.target)>n)&&(r.dispatchEvent(Y1),q.copy(r.object.position),he.copy(r.object.quaternion),de.copy(r.target),!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",Z),r.domElement.removeEventListener("pointerdown",K),r.domElement.removeEventListener("pointercancel",$),r.domElement.removeEventListener("wheel",k),r.domElement.removeEventListener("pointermove",W),r.domElement.removeEventListener("pointerup",$),r.domElement.getRootNode().removeEventListener("keydown",Q,{capture:!0}),r._domElementKeyEvents!==null&&(r._domElementKeyEvents.removeEventListener("keydown",w),r._domElementKeyEvents=null)};const r=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let a=s.NONE;const n=1e-6,o=new ag,l=new ag;let c=1;const h=new C,u=new se,d=new se,p=new se,f=new se,g=new se,m=new se,v=new se,_=new se,y=new se,x=new C,b=new se;let M=!1;const T=[],A={};let L=!1;function U(N){const z=Math.abs(.01*N);return Math.pow(.95,r.zoomSpeed*z)}function P(N){l.theta-=N}function E(N){l.phi-=N}const I=function(){const N=new C;return function(z,Y){N.setFromMatrixColumn(Y,0),N.multiplyScalar(-z),h.add(N)}}(),S=function(){const N=new C;return function(z,Y){r.screenSpacePanning===!0?N.setFromMatrixColumn(Y,1):(N.setFromMatrixColumn(Y,0),N.crossVectors(r.object.up,N)),N.multiplyScalar(z),h.add(N)}}(),V=function(){const N=new C;return function(z,Y){const q=r.domElement;if(r.object.isPerspectiveCamera){const he=r.object.position;N.copy(he).sub(r.target);let de=N.length();de*=Math.tan(r.object.fov/2*Math.PI/180),I(2*z*de/q.clientHeight,r.object.matrix),S(2*Y*de/q.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(I(z*(r.object.right-r.object.left)/r.object.zoom/q.clientWidth,r.object.matrix),S(Y*(r.object.top-r.object.bottom)/r.object.zoom/q.clientHeight,r.object.matrix)):r.enablePan=!1}}();function J(N){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?c/=N:r.enableZoom=!1}function X(N){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?c*=N:r.enableZoom=!1}function te(N,z){if(!r.zoomToCursor)return;M=!0;const Y=r.domElement.getBoundingClientRect(),q=N-Y.left,he=z-Y.top,de=Y.width,ue=Y.height;b.x=q/de*2-1,b.y=-he/ue*2+1,x.set(b.x,b.y,1).unproject(r.object).sub(r.object.position).normalize()}function ie(N){return Math.max(r.minDistance,Math.min(r.maxDistance,N))}function fe(N){u.set(N.clientX,N.clientY)}function B(N){f.set(N.clientX,N.clientY)}function j(N){if(T.length===1)u.set(N.pageX,N.pageY);else{const z=R(N),Y=.5*(N.pageX+z.x),q=.5*(N.pageY+z.y);u.set(Y,q)}}function ae(N){if(T.length===1)f.set(N.pageX,N.pageY);else{const z=R(N),Y=.5*(N.pageX+z.x),q=.5*(N.pageY+z.y);f.set(Y,q)}}function O(N){const z=R(N),Y=N.pageX-z.x,q=N.pageY-z.y,he=Math.sqrt(Y*Y+q*q);v.set(0,he)}function D(N){if(T.length==1)d.set(N.pageX,N.pageY);else{const Y=R(N),q=.5*(N.pageX+Y.x),he=.5*(N.pageY+Y.y);d.set(q,he)}p.subVectors(d,u).multiplyScalar(r.rotateSpeed);const z=r.domElement;P(2*Math.PI*p.x/z.clientHeight),E(2*Math.PI*p.y/z.clientHeight),u.copy(d)}function ee(N){if(T.length===1)g.set(N.pageX,N.pageY);else{const z=R(N),Y=.5*(N.pageX+z.x),q=.5*(N.pageY+z.y);g.set(Y,q)}m.subVectors(g,f).multiplyScalar(r.panSpeed),V(m.x,m.y),f.copy(g)}function ne(N){const z=R(N),Y=N.pageX-z.x,q=N.pageY-z.y,he=Math.sqrt(Y*Y+q*q);_.set(0,he),y.set(0,Math.pow(_.y/v.y,r.zoomSpeed)),J(y.y),v.copy(_),te(.5*(N.pageX+z.x),.5*(N.pageY+z.y))}function K(N){r.enabled!==!1&&(T.length===0&&(r.domElement.setPointerCapture(N.pointerId),r.domElement.addEventListener("pointermove",W),r.domElement.addEventListener("pointerup",$)),function(z){for(let Y=0;Y<T.length;Y++)if(T[Y]==z.pointerId)return!0;return!1}(N)||(function(z){T.push(z.pointerId)}(N),N.pointerType==="touch"?G(N):function(z){let Y;switch(z.button){case 0:Y=r.mouseButtons.LEFT;break;case 1:Y=r.mouseButtons.MIDDLE;break;case 2:Y=r.mouseButtons.RIGHT;break;default:Y=-1}switch(Y){case un.DOLLY:if(r.enableZoom===!1)return;(function(q){te(q.clientX,q.clientX),v.set(q.clientX,q.clientY)})(z),a=s.DOLLY;break;case un.ROTATE:if(z.ctrlKey||z.metaKey||z.shiftKey){if(r.enablePan===!1)return;B(z),a=s.PAN}else{if(r.enableRotate===!1)return;fe(z),a=s.ROTATE}break;case un.PAN:if(z.ctrlKey||z.metaKey||z.shiftKey){if(r.enableRotate===!1)return;fe(z),a=s.ROTATE}else{if(r.enablePan===!1)return;B(z),a=s.PAN}break;default:a=s.NONE}a!==s.NONE&&r.dispatchEvent(lf)}(N)))}function W(N){r.enabled!==!1&&(N.pointerType==="touch"?function(z){switch(F(z),a){case s.TOUCH_ROTATE:if(r.enableRotate===!1)return;D(z),r.update();break;case s.TOUCH_PAN:if(r.enablePan===!1)return;ee(z),r.update();break;case s.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;(function(Y){r.enableZoom&&ne(Y),r.enablePan&&ee(Y)})(z),r.update();break;case s.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;(function(Y){r.enableZoom&&ne(Y),r.enableRotate&&D(Y)})(z),r.update();break;default:a=s.NONE}}(N):function(z){switch(a){case s.ROTATE:if(r.enableRotate===!1)return;(function(Y){d.set(Y.clientX,Y.clientY),p.subVectors(d,u).multiplyScalar(r.rotateSpeed);const q=r.domElement;P(2*Math.PI*p.x/q.clientHeight),E(2*Math.PI*p.y/q.clientHeight),u.copy(d),r.update()})(z);break;case s.DOLLY:if(r.enableZoom===!1)return;(function(Y){_.set(Y.clientX,Y.clientY),y.subVectors(_,v),y.y>0?J(U(y.y)):y.y<0&&X(U(y.y)),v.copy(_),r.update()})(z);break;case s.PAN:if(r.enablePan===!1)return;(function(Y){g.set(Y.clientX,Y.clientY),m.subVectors(g,f).multiplyScalar(r.panSpeed),V(m.x,m.y),f.copy(g),r.update()})(z)}}(N))}function $(N){switch(function(z){delete A[z.pointerId];for(let Y=0;Y<T.length;Y++)if(T[Y]==z.pointerId)return void T.splice(Y,1)}(N),T.length){case 0:r.domElement.releasePointerCapture(N.pointerId),r.domElement.removeEventListener("pointermove",W),r.domElement.removeEventListener("pointerup",$),r.dispatchEvent(Z1),a=s.NONE;break;case 1:const z=T[0],Y=A[z];G({pointerId:z,pageX:Y.x,pageY:Y.y})}}function k(N){r.enabled!==!1&&r.enableZoom!==!1&&a===s.NONE&&(N.preventDefault(),r.dispatchEvent(lf),function(z){te(z.clientX,z.clientY),z.deltaY<0?X(U(z.deltaY)):z.deltaY>0&&J(U(z.deltaY)),r.update()}(function(z){const Y=z.deltaMode,q={clientX:z.clientX,clientY:z.clientY,deltaY:z.deltaY};switch(Y){case 1:q.deltaY*=16;break;case 2:q.deltaY*=100}return z.ctrlKey&&!L&&(q.deltaY*=10),q}(N)),r.dispatchEvent(Z1))}function Q(N){N.key==="Control"&&(L=!0,r.domElement.getRootNode().addEventListener("keyup",re,{passive:!0,capture:!0}))}function re(N){N.key==="Control"&&(L=!1,r.domElement.getRootNode().removeEventListener("keyup",re,{passive:!0,capture:!0}))}function w(N){r.enabled!==!1&&r.enablePan!==!1&&function(z){let Y=!1;switch(z.code){case r.keys.UP:z.ctrlKey||z.metaKey||z.shiftKey?E(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):V(0,r.keyPanSpeed),Y=!0;break;case r.keys.BOTTOM:z.ctrlKey||z.metaKey||z.shiftKey?E(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):V(0,-r.keyPanSpeed),Y=!0;break;case r.keys.LEFT:z.ctrlKey||z.metaKey||z.shiftKey?P(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):V(r.keyPanSpeed,0),Y=!0;break;case r.keys.RIGHT:z.ctrlKey||z.metaKey||z.shiftKey?P(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):V(-r.keyPanSpeed,0),Y=!0}Y&&(z.preventDefault(),r.update())}(N)}function G(N){switch(F(N),T.length){case 1:switch(r.touches.ONE){case dn.ROTATE:if(r.enableRotate===!1)return;j(N),a=s.TOUCH_ROTATE;break;case dn.PAN:if(r.enablePan===!1)return;ae(N),a=s.TOUCH_PAN;break;default:a=s.NONE}break;case 2:switch(r.touches.TWO){case dn.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;(function(z){r.enableZoom&&O(z),r.enablePan&&ae(z)})(N),a=s.TOUCH_DOLLY_PAN;break;case dn.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;(function(z){r.enableZoom&&O(z),r.enableRotate&&j(z)})(N),a=s.TOUCH_DOLLY_ROTATE;break;default:a=s.NONE}break;default:a=s.NONE}a!==s.NONE&&r.dispatchEvent(lf)}function Z(N){r.enabled!==!1&&N.preventDefault()}function F(N){let z=A[N.pointerId];z===void 0&&(z=new se,A[N.pointerId]=z),z.set(N.pageX,N.pageY)}function R(N){const z=N.pointerId===T[0]?T[1]:T[0];return A[z]}r.domElement.addEventListener("contextmenu",Z),r.domElement.addEventListener("pointerdown",K),r.domElement.addEventListener("pointercancel",$),r.domElement.addEventListener("wheel",k,{passive:!1}),r.domElement.getRootNode().addEventListener("keydown",Q,{passive:!0,capture:!0}),this.update()}}const hn=new _p,Ai=new C,ca=new C,At=new Qe,Q1={X:new C(1,0,0),Y:new C(0,1,0),Z:new C(0,0,1)},cf={type:"change"},$1={type:"mouseDown"},J1={type:"mouseUp",mode:null},ex={type:"objectChange"};class GR extends Ve{constructor(e,t){super(),t===void 0&&(t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const r=new ZR;this._gizmo=r,this.add(r);const s=new KR;this._plane=s,this.add(s);const a=this;function n(v,_){let y=_;Object.defineProperty(a,v,{get:function(){return y!==void 0?y:_},set:function(x){y!==x&&(y=x,s[v]=x,r[v]=x,a.dispatchEvent({type:v+"-changed",value:x}),a.dispatchEvent(cf))}}),a[v]=_,s[v]=_,r[v]=_}n("camera",e),n("object",void 0),n("enabled",!0),n("axis",null),n("mode","translate"),n("translationSnap",null),n("rotationSnap",null),n("scaleSnap",null),n("space","world"),n("size",1),n("dragging",!1),n("showX",!0),n("showY",!0),n("showZ",!0);const o=new C,l=new C,c=new Qe,h=new Qe,u=new C,d=new Qe,p=new C,f=new C,g=new C,m=new C;n("worldPosition",o),n("worldPositionStart",l),n("worldQuaternion",c),n("worldQuaternionStart",h),n("cameraPosition",u),n("cameraQuaternion",d),n("pointStart",p),n("pointEnd",f),n("rotationAxis",g),n("rotationAngle",0),n("eye",m),this._offset=new C,this._startNorm=new C,this._endNorm=new C,this._cameraScale=new C,this._parentPosition=new C,this._parentQuaternion=new Qe,this._parentQuaternionInv=new Qe,this._parentScale=new C,this._worldScaleStart=new C,this._worldQuaternionInv=new Qe,this._worldScale=new C,this._positionStart=new C,this._quaternionStart=new Qe,this._scaleStart=new C,this._getPointer=jR.bind(this),this._onPointerDown=XR.bind(this),this._onPointerHover=WR.bind(this),this._onPointerMove=qR.bind(this),this._onPointerUp=YR.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(e){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null||this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(e)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&hn.setFromCamera(e,this.camera);const t=hf(this._gizmo.picker[this.mode],hn);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&(e==null||e.button===0)&&this.axis!==null){e!==null&&hn.setFromCamera(e,this.camera);const t=hf(this._plane,hn,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,$1.mode=this.mode,this.dispatchEvent($1)}}pointerMove(e){const t=this.axis,r=this.mode,s=this.object;let a=this.space;if(r==="scale"?a="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(a="world"),s===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&hn.setFromCamera(e,this.camera);const n=hf(this._plane,hn,!0);if(n){if(this.pointEnd.copy(n.point).sub(this.worldPositionStart),r==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(s.position.applyQuaternion(At.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),a==="world"&&(s.parent&&s.position.add(Ai.setFromMatrixPosition(s.parent.matrixWorld)),t.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(Ai.setFromMatrixPosition(s.parent.matrixWorld))));else if(r==="scale"){if(t.search("XYZ")!==-1){let o=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(o*=-1),ca.set(o,o,o)}else Ai.copy(this.pointStart),ca.copy(this.pointEnd),Ai.applyQuaternion(this._worldQuaternionInv),ca.applyQuaternion(this._worldQuaternionInv),ca.divide(Ai),t.search("X")===-1&&(ca.x=1),t.search("Y")===-1&&(ca.y=1),t.search("Z")===-1&&(ca.z=1);s.scale.copy(this._scaleStart).multiply(ca),this.scaleSnap&&(t.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(r==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const o=20/this.worldPosition.distanceTo(Ai.setFromMatrixPosition(this.camera.matrixWorld));let l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(Ai.copy(this.rotationAxis).cross(this.eye))*o):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(Q1[t]),Ai.copy(Q1[t]),a==="local"&&Ai.applyQuaternion(this.worldQuaternion),Ai.cross(this.eye),Ai.length()===0?l=!0:this.rotationAngle=this._offset.dot(Ai.normalize())*o),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&t!=="E"&&t!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(At.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(At.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(cf),this.dispatchEvent(ex)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(J1.mode=this.mode,this.dispatchEvent(J1)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(cf),this.dispatchEvent(ex),this.pointStart.copy(this.pointEnd))}getRaycaster(){return hn}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function jR(i){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:i.button};{const e=this.domElement.getBoundingClientRect();return{x:(i.clientX-e.left)/e.width*2-1,y:-(i.clientY-e.top)/e.height*2+1,button:i.button}}}function WR(i){if(this.enabled)switch(i.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(i))}}function XR(i){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(i)),this.pointerDown(this._getPointer(i)))}function qR(i){this.enabled&&this.pointerMove(this._getPointer(i))}function YR(i){this.enabled&&(this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(i)))}function hf(i,e,t){const r=e.intersectObject(i,!0);for(let s=0;s<r.length;s++)if(r[s].object.visible||t)return r[s];return!1}const Vu=new Ct,ft=new C(0,1,0),tx=new C(0,0,0),ix=new Me,Hu=new Qe,ld=new Qe,ts=new C,rx=new Me,oc=new C(1,0,0),gn=new C(0,1,0),lc=new C(0,0,1),Gu=new C,$l=new C,Jl=new C;class ZR extends Ve{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Qt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Wt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const s=t.clone();s.opacity=.5;const a=e.clone();a.color.setHex(16711680);const n=e.clone();n.color.setHex(65280);const o=e.clone();o.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const h=e.clone();h.color.setHex(255),h.opacity=.5;const u=e.clone();u.opacity=.25;const d=e.clone();d.color.setHex(16776960),d.opacity=.25,e.clone().color.setHex(16776960);const p=e.clone();p.color.setHex(7895160);const f=new Ft(0,.04,.1,12);f.translate(0,.05,0);const g=new Lt(.08,.08,.08);g.translate(0,.04,0);const m=new Ie;m.setAttribute("position",new Se([0,0,0,1,0,0],3));const v=new Ft(.0075,.0075,.5,3);function _(I,S){const V=new ss(I,.0075,3,64,S*Math.PI*2);return V.rotateY(Math.PI/2),V.rotateX(Math.PI/2),V}v.translate(0,.25,0);const y={X:[[new ye(f,a),[.5,0,0],[0,0,-Math.PI/2]],[new ye(f,a),[-.5,0,0],[0,0,Math.PI/2]],[new ye(v,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new ye(f,n),[0,.5,0]],[new ye(f,n),[0,-.5,0],[Math.PI,0,0]],[new ye(v,n)]],Z:[[new ye(f,o),[0,0,.5],[Math.PI/2,0,0]],[new ye(f,o),[0,0,-.5],[-Math.PI/2,0,0]],[new ye(v,o),null,[Math.PI/2,0,0]]],XYZ:[[new ye(new ks(.1,0),u.clone()),[0,0,0]]],XY:[[new ye(new Lt(.15,.15,.01),h.clone()),[.15,.15,0]]],YZ:[[new ye(new Lt(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Lt(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},x={X:[[new ye(new Ft(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new Ft(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new Ft(.2,0,.6,4),r),[0,.3,0]],[new ye(new Ft(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new Ft(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new ye(new Ft(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new ye(new ks(.2,0),r)]],XY:[[new ye(new Lt(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new ye(new Lt(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Lt(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},b={START:[[new ye(new ks(.01,2),s),null,null,null,"helper"]],END:[[new ye(new ks(.01,2),s),null,null,null,"helper"]],DELTA:[[new di(function(){const I=new Ie;return I.setAttribute("position",new Se([0,0,0,1,1,1],3)),I}(),s),null,null,null,"helper"]],X:[[new di(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new di(m,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new di(m,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},M={XYZE:[[new ye(_(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new ye(_(.5,.5),a)]],Y:[[new ye(_(.5,.5),n),null,[0,0,-Math.PI/2]]],Z:[[new ye(_(.5,.5),o),null,[0,Math.PI/2,0]]],E:[[new ye(_(.75,1),d),null,[0,Math.PI/2,0]]]},T={AXIS:[[new di(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},A={XYZE:[[new ye(new Wn(.25,10,8),r)]],X:[[new ye(new ss(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ye(new ss(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ye(new ss(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ye(new ss(.75,.1,2,24),r)]]},L={X:[[new ye(g,a),[.5,0,0],[0,0,-Math.PI/2]],[new ye(v,a),[0,0,0],[0,0,-Math.PI/2]],[new ye(g,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new ye(g,n),[0,.5,0]],[new ye(v,n)],[new ye(g,n),[0,-.5,0],[0,0,Math.PI]]],Z:[[new ye(g,o),[0,0,.5],[Math.PI/2,0,0]],[new ye(v,o),[0,0,0],[Math.PI/2,0,0]],[new ye(g,o),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new ye(new Lt(.15,.15,.01),h),[.15,.15,0]]],YZ:[[new ye(new Lt(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Lt(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new Lt(.1,.1,.1),u.clone())]]},U={X:[[new ye(new Ft(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new ye(new Ft(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new ye(new Ft(.2,0,.6,4),r),[0,.3,0]],[new ye(new Ft(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new ye(new Ft(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new ye(new Ft(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new ye(new Lt(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new ye(new Lt(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new ye(new Lt(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new ye(new Lt(.2,.2,.2),r),[0,0,0]]]},P={X:[[new di(m,s.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new di(m,s.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new di(m,s.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function E(I){const S=new Ve;for(const V in I)for(let J=I[V].length;J--;){const X=I[V][J][0].clone(),te=I[V][J][1],ie=I[V][J][2],fe=I[V][J][3],B=I[V][J][4];X.name=V,X.tag=B,te&&X.position.set(te[0],te[1],te[2]),ie&&X.rotation.set(ie[0],ie[1],ie[2]),fe&&X.scale.set(fe[0],fe[1],fe[2]),X.updateMatrix();const j=X.geometry.clone();j.applyMatrix4(X.matrix),X.geometry=j,X.renderOrder=1/0,X.position.set(0,0,0),X.rotation.set(0,0,0),X.scale.set(1,1,1),S.add(X)}return S}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=E(y)),this.add(this.gizmo.rotate=E(M)),this.add(this.gizmo.scale=E(L)),this.add(this.picker.translate=E(x)),this.add(this.picker.rotate=E(A)),this.add(this.picker.scale=E(U)),this.add(this.helper.translate=E(b)),this.add(this.helper.rotate=E(T)),this.add(this.helper.scale=E(P)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:ld;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let s=0;s<r.length;s++){const a=r[s];let n;a.visible=!0,a.rotation.set(0,0,0),a.position.copy(this.worldPosition),n=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),a.scale.set(1,1,1).multiplyScalar(n*this.size/4),a.tag!=="helper"?(a.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(a.name==="X"&&Math.abs(ft.copy(oc).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Y"&&Math.abs(ft.copy(gn).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="Z"&&Math.abs(ft.copy(lc).applyQuaternion(t).dot(this.eye))>.99&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XY"&&Math.abs(ft.copy(lc).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="YZ"&&Math.abs(ft.copy(oc).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1),a.name==="XZ"&&Math.abs(ft.copy(gn).applyQuaternion(t).dot(this.eye))<.2&&(a.scale.set(1e-10,1e-10,1e-10),a.visible=!1)):this.mode==="rotate"&&(Hu.copy(t),ft.copy(this.eye).applyQuaternion(At.copy(t).invert()),a.name.search("E")!==-1&&a.quaternion.setFromRotationMatrix(ix.lookAt(this.eye,tx,gn)),a.name==="X"&&(At.setFromAxisAngle(oc,Math.atan2(-ft.y,ft.z)),At.multiplyQuaternions(Hu,At),a.quaternion.copy(At)),a.name==="Y"&&(At.setFromAxisAngle(gn,Math.atan2(ft.x,ft.z)),At.multiplyQuaternions(Hu,At),a.quaternion.copy(At)),a.name==="Z"&&(At.setFromAxisAngle(lc,Math.atan2(ft.y,ft.x)),At.multiplyQuaternions(Hu,At),a.quaternion.copy(At))),a.visible=a.visible&&(a.name.indexOf("X")===-1||this.showX),a.visible=a.visible&&(a.name.indexOf("Y")===-1||this.showY),a.visible=a.visible&&(a.name.indexOf("Z")===-1||this.showZ),a.visible=a.visible&&(a.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),a.material._color=a.material._color||a.material.color.clone(),a.material._opacity=a.material._opacity||a.material.opacity,a.material.color.copy(a.material._color),a.material.opacity=a.material._opacity,this.enabled&&this.axis&&(a.name===this.axis||this.axis.split("").some(function(o){return a.name===o}))&&(a.material.color.setHex(16776960),a.material.opacity=1)):(a.visible=!1,a.name==="AXIS"?(a.visible=!!this.axis,this.axis==="X"&&(At.setFromEuler(Vu.set(0,0,0)),a.quaternion.copy(t).multiply(At),Math.abs(ft.copy(oc).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Y"&&(At.setFromEuler(Vu.set(0,0,Math.PI/2)),a.quaternion.copy(t).multiply(At),Math.abs(ft.copy(gn).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="Z"&&(At.setFromEuler(Vu.set(0,Math.PI/2,0)),a.quaternion.copy(t).multiply(At),Math.abs(ft.copy(lc).applyQuaternion(t).dot(this.eye))>.9&&(a.visible=!1)),this.axis==="XYZE"&&(At.setFromEuler(Vu.set(0,Math.PI/2,0)),ft.copy(this.rotationAxis),a.quaternion.setFromRotationMatrix(ix.lookAt(tx,ft,gn)),a.quaternion.multiply(At),a.visible=this.dragging),this.axis==="E"&&(a.visible=!1)):a.name==="START"?(a.position.copy(this.worldPositionStart),a.visible=this.dragging):a.name==="END"?(a.position.copy(this.worldPosition),a.visible=this.dragging):a.name==="DELTA"?(a.position.copy(this.worldPositionStart),a.quaternion.copy(this.worldQuaternionStart),Ai.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),Ai.applyQuaternion(this.worldQuaternionStart.clone().invert()),a.scale.copy(Ai),a.visible=this.dragging):(a.quaternion.copy(t),this.dragging?a.position.copy(this.worldPositionStart):a.position.copy(this.worldPosition),this.axis&&(a.visible=this.axis.search(a.name)!==-1)))}super.updateMatrixWorld(e)}}class KR extends ye{constructor(){super(new ys(1e5,1e5,2,2),new Qt({visible:!1,wireframe:!0,side:Rt,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Gu.copy(oc).applyQuaternion(t==="local"?this.worldQuaternion:ld),$l.copy(gn).applyQuaternion(t==="local"?this.worldQuaternion:ld),Jl.copy(lc).applyQuaternion(t==="local"?this.worldQuaternion:ld),ft.copy($l),this.mode){case"translate":case"scale":switch(this.axis){case"X":ft.copy(this.eye).cross(Gu),ts.copy(Gu).cross(ft);break;case"Y":ft.copy(this.eye).cross($l),ts.copy($l).cross(ft);break;case"Z":ft.copy(this.eye).cross(Jl),ts.copy(Jl).cross(ft);break;case"XY":ts.copy(Jl);break;case"YZ":ts.copy(Gu);break;case"XZ":ft.copy(Jl),ts.copy($l);break;case"XYZ":case"E":ts.set(0,0,0)}break;default:ts.set(0,0,0)}ts.length()===0?this.quaternion.copy(this.cameraQuaternion):(rx.lookAt(Ai.set(0,0,0),ts,ft),this.quaternion.setFromRotationMatrix(rx)),super.updateMatrixWorld(e)}}const Bs={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Zs{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){}dispose(){}}const QR=new Gn(-1,1,1,-1,0,1),$R=new class extends Ie{constructor(){super(),this.setAttribute("position",new Se([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Se([0,2,0,0,2,0],2))}};class Ml{constructor(e){this._mesh=new ye($R,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,QR)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Q0 extends Zs{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof at?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=ii.clone(e.uniforms),this.material=new at({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ml(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class sx extends Zs{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){const s=e.getContext(),a=e.state;let n,o;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(n=0,o=1):(n=1,o=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.buffers.stencil.setFunc(s.ALWAYS,n,4294967295),a.buffers.stencil.setClear(o),a.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.color.setMask(!0),a.buffers.depth.setMask(!0),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(s.EQUAL,1,4294967295),a.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.buffers.stencil.setLocked(!0)}}class JR extends Zs{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class eI{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const r=e.getSize(new se);this._width=r.width,this._height=r.height,(t=new pt(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Yt})).texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Q0(Bs),this.copyPass.material.blending=0,this.clock=new kc}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let r=!1;for(let s=0,a=this.passes.length;s<a;s++){const n=this.passes[s];if(n.enabled!==!1){if(n.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(s),n.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),n.needsSwap){if(r){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}sx!==void 0&&(n instanceof sx?r=!0:n instanceof JR&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new se);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const r=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget1.setSize(r,s),this.renderTarget2.setSize(r,s);for(let a=0;a<this.passes.length;a++)this.passes[a].setSize(r,s)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class tI extends Zs{constructor(e,t,r=null,s=null,a=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=s,this.clearAlpha=a,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new ve}render(e,t,r){const s=e.autoClear;let a,n;e.autoClear=!1,this.overrideMaterial!==null&&(n=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(a=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==1&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(a),this.overrideMaterial!==null&&(this.scene.overrideMaterial=n),e.autoClear=s}}class Ta extends Zs{constructor(e,t,r,s){super(),this.renderScene=t,this.renderCamera=r,this.selectedObjects=s!==void 0?s:[],this.visibleEdgeColor=new ve(1,1,1),this.hiddenEdgeColor=new ve(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this.resolution=e!==void 0?new se(e.x,e.y):new se(256,256);const a=Math.round(this.resolution.x/this.downSampleRatio),n=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new pt(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new op,this.depthMaterial.side=Rt,this.depthMaterial.depthPacking=Qg,this.depthMaterial.blending=0,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=Rt,this.prepareMaskMaterial.fragmentShader=function(l,c){const h=c.isPerspectiveCamera?"perspective":"orthographic";return l.replace(/DEPTH_TO_VIEW_Z/g,h+"DepthToViewZ")}(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new pt(this.resolution.x,this.resolution.y,{type:Yt}),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new pt(a,n,{type:Yt}),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new pt(a,n,{type:Yt}),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new pt(Math.round(a/2),Math.round(n/2),{type:Yt}),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new pt(a,n,{type:Yt}),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new pt(Math.round(a/2),Math.round(n/2),{type:Yt}),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeperableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value.set(a,n),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(a/2),Math.round(n/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();const o=Bs;this.copyUniforms=ii.clone(o.uniforms),this.materialCopy=new at({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:0,depthTest:!1,depthWrite:!1}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new ve,this.oldClearAlpha=1,this.fsQuad=new Ml(null),this.tempPulseColor1=new ve,this.tempPulseColor2=new ve,this.textureMatrix=new Me}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t),this.renderTargetDepthBuffer.setSize(e,t);let r=Math.round(e/this.downSampleRatio),s=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(r,s),this.renderTargetBlurBuffer1.setSize(r,s),this.renderTargetEdgeBuffer1.setSize(r,s),this.separableBlurMaterial1.uniforms.texSize.value.set(r,s),r=Math.round(r/2),s=Math.round(s/2),this.renderTargetBlurBuffer2.setSize(r,s),this.renderTargetEdgeBuffer2.setSize(r,s),this.separableBlurMaterial2.uniforms.texSize.value.set(r,s)}changeVisibilityOfSelectedObjects(e){const t=this._visibilityCache;function r(s){s.isMesh&&(e===!0?s.visible=t.get(s):(t.set(s,s.visible),s.visible=e))}for(let s=0;s<this.selectedObjects.length;s++)this.selectedObjects[s].traverse(r)}changeVisibilityOfNonSelectedObjects(e){const t=this._visibilityCache,r=[];function s(a){a.isMesh&&r.push(a)}for(let a=0;a<this.selectedObjects.length;a++)this.selectedObjects[a].traverse(s);this.renderScene.traverse(function(a){if(a.isMesh||a.isSprite){let n=!1;for(let o=0;o<r.length;o++)if(r[o].id===a.id){n=!0;break}if(n===!1){const o=a.visible;e!==!1&&t.get(a)!==!0||(a.visible=e),t.set(a,o)}}else(a.isPoints||a.isLine)&&(e===!0?a.visible=t.get(a):(t.set(a,a.visible),a.visible=e))})}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,r,s,a){if(this.selectedObjects.length>0){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const n=e.autoClear;e.autoClear=!1,a&&e.state.buffers.stencil.setTest(!1),e.setClearColor(16777215,1),this.changeVisibilityOfSelectedObjects(!1);const o=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this.renderScene.background=o,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const l=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(l),this.tempPulseColor2.multiplyScalar(l)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ta.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=Ta.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=Ta.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=Ta.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,a&&e.state.buffers.stencil.setTest(!0),e.setRenderTarget(r),this.fsQuad.render(e),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=r.texture,e.setRenderTarget(null),this.fsQuad.render(e))}getPrepareMaskMaterial(){return new at({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new se(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif
					
					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new at({uniforms:{maskTexture:{value:null},texSize:{value:new se(.5,.5)},visibleEdgeColor:{value:new C(1,1,1)},hiddenEdgeColor:{value:new C(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(e){return new at({defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new se(.5,.5)},direction:{value:new se(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new at({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:Vs,depthTest:!1,depthWrite:!1,transparent:!0})}}Ta.BlurDirectionX=new se(1,0),Ta.BlurDirectionY=new se(0,1);const iI={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = OptimizedCineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class rI extends Zs{constructor(){super();const e=iI;this.uniforms=ii.clone(e.uniforms),this.material=new c0({name:e.name,uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.fsQuad=new Ml(this.material),this._outputColorSpace=null,this._toneMapping=null}render(e,t,r){this.uniforms.tDiffuse.value=r.texture,this.uniforms.toneMappingExposure.value=e.toneMappingExposure,this._outputColorSpace===e.outputColorSpace&&this._toneMapping===e.toneMapping||(this._outputColorSpace=e.outputColorSpace,this._toneMapping=e.toneMapping,this.material.defines={},ct.getTransfer(this._outputColorSpace)===bt&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===Yd?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===Zd?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===Kd?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===Qd?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===$d?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===Bg&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const sI={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new ve(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			vec3 luma = vec3( 0.299, 0.587, 0.114 );

			float v = dot( texel.xyz, luma );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class vl extends Zs{constructor(e,t,r,s){super(),this.strength=t!==void 0?t:1,this.radius=r,this.threshold=s,this.resolution=e!==void 0?new se(e.x,e.y):new se(256,256),this.clearColor=new ve(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);this.renderTargetBright=new pt(a,n,{type:Yt}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let h=0;h<this.nMips;h++){const u=new pt(a,n,{type:Yt});u.texture.name="UnrealBloomPass.h"+h,u.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(u);const d=new pt(a,n,{type:Yt});d.texture.name="UnrealBloomPass.v"+h,d.texture.generateMipmaps=!1,this.renderTargetsVertical.push(d),a=Math.round(a/2),n=Math.round(n/2)}const o=sI;this.highPassUniforms=ii.clone(o.uniforms),this.highPassUniforms.luminosityThreshold.value=s,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new at({uniforms:this.highPassUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader}),this.separableBlurMaterials=[];const l=[3,5,7,9,11];a=Math.round(this.resolution.x/2),n=Math.round(this.resolution.y/2);for(let h=0;h<this.nMips;h++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(l[h])),this.separableBlurMaterials[h].uniforms.invSize.value=new se(1/a,1/n),a=Math.round(a/2),n=Math.round(n/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new C(1,1,1),new C(1,1,1),new C(1,1,1),new C(1,1,1),new C(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const c=Bs;this.copyUniforms=ii.clone(c.uniforms),this.blendMaterial=new at({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:Vs,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new ve,this.oldClearAlpha=1,this.basic=new Qt,this.fsQuad=new Ml(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose();for(let e=0;e<this.separableBlurMaterials.length;e++)this.separableBlurMaterials[e].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(e,t){let r=Math.round(e/2),s=Math.round(t/2);this.renderTargetBright.setSize(r,s);for(let a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(r,s),this.renderTargetsVertical[a].setSize(r,s),this.separableBlurMaterials[a].uniforms.invSize.value=new se(1/r,1/s),r=Math.round(r/2),s=Math.round(s/2)}render(e,t,r,s,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const n=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=r.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=r.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let o=this.renderTargetBright;for(let l=0;l<this.nMips;l++)this.fsQuad.material=this.separableBlurMaterials[l],this.separableBlurMaterials[l].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[l].uniforms.direction.value=vl.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[l]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[l].uniforms.colorTexture.value=this.renderTargetsHorizontal[l].texture,this.separableBlurMaterials[l].uniforms.direction.value=vl.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[l]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[l];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(r),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=n}getSeperableBlurMaterial(e){const t=[];for(let r=0;r<e;r++)t.push(.39894*Math.exp(-.5*r*r/(e*e))/e);return new at({defines:{KERNEL_RADIUS:e},uniforms:{colorTexture:{value:null},invSize:{value:new se(.5,.5)},direction:{value:new se(.5,.5)},gaussianCoefficients:{value:t}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(e){return new at({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}vl.BlurDirectionX=new se(1,0),vl.BlurDirectionY=new se(0,1);class aI extends Q0{constructor(){super({name:"ScreenMaskShader",uniforms:{tDiffuse:{value:null},opacity:{value:1},intensity:{value:1},maskColor:{value:new ve(1,1,1)},R:{value:.2},sr:{value:1.2}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
      `,fragmentShader:`
        uniform float opacity;
        uniform float intensity;
        uniform sampler2D tDiffuse;
        uniform vec3 maskColor;
        uniform float R;
        uniform float sr;
        varying vec2 vUv;
        void main() {
          // 阴影颜色
          vec4 texel = texture2D( tDiffuse, vUv );
          // 距离中心的距离
          float dist = sqrt((vUv.x-0.5)*(vUv.x-0.5)+(vUv.y-0.5)*(vUv.y-0.5));
          // 渐变, sr 是开始黑色参数
          float rr = (sr - smoothstep(R, R + 0.5, dist));
          // 叠加黑色
          texel *= vec4(maskColor * rr * vec3(intensity,intensity,intensity), 1.0);
          gl_FragColor = opacity * texel;
        }
      `})}}const nI={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new se(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		precision highp float;

		uniform sampler2D tDiffuse;

		uniform vec2 resolution;

		varying vec2 vUv;

		// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)

		//----------------------------------------------------------------------------------
		// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag
		// SDK Version: v3.00
		// Email:       gameworks@nvidia.com
		// Site:        http://developer.nvidia.com/
		//
		// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.
		//
		// Redistribution and use in source and binary forms, with or without
		// modification, are permitted provided that the following conditions
		// are met:
		//  * Redistributions of source code must retain the above copyright
		//    notice, this list of conditions and the following disclaimer.
		//  * Redistributions in binary form must reproduce the above copyright
		//    notice, this list of conditions and the following disclaimer in the
		//    documentation and/or other materials provided with the distribution.
		//  * Neither the name of NVIDIA CORPORATION nor the names of its
		//    contributors may be used to endorse or promote products derived
		//    from this software without specific prior written permission.
		//
		// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ''AS IS'' AND ANY
		// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
		// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
		// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
		// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
		// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
		// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
		// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
		// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
		// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
		// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
		//
		//----------------------------------------------------------------------------------

		#ifndef FXAA_DISCARD
			//
			// Only valid for PC OpenGL currently.
			// Probably will not work when FXAA_GREEN_AS_LUMA = 1.
			//
			// 1 = Use discard on pixels which don't need AA.
			//     For APIs which enable concurrent TEX+ROP from same surface.
			// 0 = Return unchanged color on pixels which don't need AA.
			//
			#define FXAA_DISCARD 0
		#endif

		/*--------------------------------------------------------------------------*/
		#define FxaaTexTop(t, p) texture2D(t, p, -100.0)
		#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), -100.0)
		/*--------------------------------------------------------------------------*/

		#define NUM_SAMPLES 5

		// assumes colors have premultipliedAlpha, so that the calculated color contrast is scaled by alpha
		float contrast( vec4 a, vec4 b ) {
			vec4 diff = abs( a - b );
			return max( max( max( diff.r, diff.g ), diff.b ), diff.a );
		}

		/*============================================================================

									FXAA3 QUALITY - PC

		============================================================================*/

		/*--------------------------------------------------------------------------*/
		vec4 FxaaPixelShader(
			vec2 posM,
			sampler2D tex,
			vec2 fxaaQualityRcpFrame,
			float fxaaQualityEdgeThreshold,
			float fxaaQualityinvEdgeThreshold
		) {
			vec4 rgbaM = FxaaTexTop(tex, posM);
			vec4 rgbaS = FxaaTexOff(tex, posM, vec2( 0.0, 1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaE = FxaaTexOff(tex, posM, vec2( 1.0, 0.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaN = FxaaTexOff(tex, posM, vec2( 0.0,-1.0), fxaaQualityRcpFrame.xy);
			vec4 rgbaW = FxaaTexOff(tex, posM, vec2(-1.0, 0.0), fxaaQualityRcpFrame.xy);
			// . S .
			// W M E
			// . N .

			bool earlyExit = max( max( max(
					contrast( rgbaM, rgbaN ),
					contrast( rgbaM, rgbaS ) ),
					contrast( rgbaM, rgbaE ) ),
					contrast( rgbaM, rgbaW ) )
					< fxaaQualityEdgeThreshold;
			// . 0 .
			// 0 0 0
			// . 0 .

			#if (FXAA_DISCARD == 1)
				if(earlyExit) FxaaDiscard;
			#else
				if(earlyExit) return rgbaM;
			#endif

			float contrastN = contrast( rgbaM, rgbaN );
			float contrastS = contrast( rgbaM, rgbaS );
			float contrastE = contrast( rgbaM, rgbaE );
			float contrastW = contrast( rgbaM, rgbaW );

			float relativeVContrast = ( contrastN + contrastS ) - ( contrastE + contrastW );
			relativeVContrast *= fxaaQualityinvEdgeThreshold;

			bool horzSpan = relativeVContrast > 0.;
			// . 1 .
			// 0 0 0
			// . 1 .

			// 45 deg edge detection and corners of objects, aka V/H contrast is too similar
			if( abs( relativeVContrast ) < .3 ) {
				// locate the edge
				vec2 dirToEdge;
				dirToEdge.x = contrastE > contrastW ? 1. : -1.;
				dirToEdge.y = contrastS > contrastN ? 1. : -1.;
				// . 2 .      . 1 .
				// 1 0 2  ~=  0 0 1
				// . 1 .      . 0 .

				// tap 2 pixels and see which ones are "outside" the edge, to
				// determine if the edge is vertical or horizontal

				vec4 rgbaAlongH = FxaaTexOff(tex, posM, vec2( dirToEdge.x, -dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongH = contrast( rgbaM, rgbaAlongH );
				// . 1 .
				// 0 0 1
				// . 0 H

				vec4 rgbaAlongV = FxaaTexOff(tex, posM, vec2( -dirToEdge.x, dirToEdge.y ), fxaaQualityRcpFrame.xy);
				float matchAlongV = contrast( rgbaM, rgbaAlongV );
				// V 1 .
				// 0 0 1
				// . 0 .

				relativeVContrast = matchAlongV - matchAlongH;
				relativeVContrast *= fxaaQualityinvEdgeThreshold;

				if( abs( relativeVContrast ) < .3 ) { // 45 deg edge
					// 1 1 .
					// 0 0 1
					// . 0 1

					// do a simple blur
					return mix(
						rgbaM,
						(rgbaN + rgbaS + rgbaE + rgbaW) * .25,
						.4
					);
				}

				horzSpan = relativeVContrast > 0.;
			}

			if(!horzSpan) rgbaN = rgbaW;
			if(!horzSpan) rgbaS = rgbaE;
			// . 0 .      1
			// 1 0 1  ->  0
			// . 0 .      1

			bool pairN = contrast( rgbaM, rgbaN ) > contrast( rgbaM, rgbaS );
			if(!pairN) rgbaN = rgbaS;

			vec2 offNP;
			offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
			offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;

			bool doneN = false;
			bool doneP = false;

			float nDist = 0.;
			float pDist = 0.;

			vec2 posN = posM;
			vec2 posP = posM;

			int iterationsUsed = 0;
			int iterationsUsedN = 0;
			int iterationsUsedP = 0;
			for( int i = 0; i < NUM_SAMPLES; i++ ) {
				iterationsUsed = i;

				float increment = float(i + 1);

				if(!doneN) {
					nDist += increment;
					posN = posM + offNP * nDist;
					vec4 rgbaEndN = FxaaTexTop(tex, posN.xy);
					doneN = contrast( rgbaEndN, rgbaM ) > contrast( rgbaEndN, rgbaN );
					iterationsUsedN = i;
				}

				if(!doneP) {
					pDist += increment;
					posP = posM - offNP * pDist;
					vec4 rgbaEndP = FxaaTexTop(tex, posP.xy);
					doneP = contrast( rgbaEndP, rgbaM ) > contrast( rgbaEndP, rgbaN );
					iterationsUsedP = i;
				}

				if(doneN || doneP) break;
			}


			if ( !doneP && !doneN ) return rgbaM; // failed to find end of edge

			float dist = min(
				doneN ? float( iterationsUsedN ) / float( NUM_SAMPLES - 1 ) : 1.,
				doneP ? float( iterationsUsedP ) / float( NUM_SAMPLES - 1 ) : 1.
			);

			// hacky way of reduces blurriness of mostly diagonal edges
			// but reduces AA quality
			dist = pow(dist, .5);

			dist = 1. - dist;

			return mix(
				rgbaM,
				rgbaN,
				dist * .5
			);
		}

		void main() {
			const float edgeDetectionQuality = .2;
			const float invEdgeDetectionQuality = 1. / edgeDetectionQuality;

			gl_FragColor = FxaaPixelShader(
				vUv,
				tDiffuse,
				resolution,
				edgeDetectionQuality, // [0,1] contrast needed, otherwise early discard
				invEdgeDetectionQuality
			);

		}
	`},ju={name:"SAOShader",defines:{NUM_SAMPLES:7,NUM_RINGS:4,DIFFUSE_TEXTURE:0,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new se(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new Me},cameraInverseProjectionMatrix:{value:new Me},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		#include <common>

		varying vec2 vUv;

		#if DIFFUSE_TEXTURE == 1
		uniform sampler2D tDiffuse;
		#endif

		uniform highp sampler2D tDepth;
		uniform highp sampler2D tNormal;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;

		uniform float scale;
		uniform float intensity;
		uniform float bias;
		uniform float kernelRadius;
		uniform float minResolution;
		uniform vec2 size;
		uniform float randomSeed;

		// RGBA depth

		#include <packing>

		vec4 getDefaultColor( const in vec2 screenPosition ) {
			#if DIFFUSE_TEXTURE == 1
			return texture2D( tDiffuse, vUv );
			#else
			return vec4( 1.0 );
			#endif
		}

		float getDepth( const in vec2 screenPosition ) {
			return texture2D( tDepth, screenPosition ).x;
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {
			float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];
			vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );
			clipPosition *= clipW; // unprojection.

			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;
		}

		vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {
			return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );
		}

		float scaleDividedByCameraFar;
		float minResolutionMultipliedByCameraFar;

		float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {
			vec3 viewDelta = sampleViewPosition - centerViewPosition;
			float viewDistance = length( viewDelta );
			float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;

			return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );
		}

		// moving costly divides into consts
		const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );
		const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );

		float getAmbientOcclusion( const in vec3 centerViewPosition ) {
			// precompute some variables require in getOcclusion.
			scaleDividedByCameraFar = scale / cameraFar;
			minResolutionMultipliedByCameraFar = minResolution * cameraFar;
			vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );

			// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/
			float angle = rand( vUv + randomSeed ) * PI2;
			vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;
			vec2 radiusStep = radius;

			float occlusionSum = 0.0;
			float weightSum = 0.0;

			for( int i = 0; i < NUM_SAMPLES; i ++ ) {
				vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;
				radius += radiusStep;
				angle += ANGLE_STEP;

				float sampleDepth = getDepth( sampleUv );
				if( sampleDepth >= ( 1.0 - EPSILON ) ) {
					continue;
				}

				float sampleViewZ = getViewZ( sampleDepth );
				vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );
				occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );
				weightSum += 1.0;
			}

			if( weightSum == 0.0 ) discard;

			return occlusionSum * ( intensity / weightSum );
		}

		void main() {
			float centerDepth = getDepth( vUv );
			if( centerDepth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = getViewZ( centerDepth );
			vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );

			float ambientOcclusion = getAmbientOcclusion( viewPosition );

			gl_FragColor = getDefaultColor( vUv );
			gl_FragColor.xyz *=  1.0 - ambientOcclusion;
		}`},ha={name:"DepthLimitedBlurShader",defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new se(512,512)},sampleUvOffsets:{value:[new se(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:`

		#include <common>

		uniform vec2 size;

		varying vec2 vUv;
		varying vec2 vInvSize;

		void main() {
			vUv = uv;
			vInvSize = 1.0 / size;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		#include <common>
		#include <packing>

		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform float depthCutoff;

		uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];
		uniform float sampleWeights[ KERNEL_RADIUS + 1 ];

		varying vec2 vUv;
		varying vec2 vInvSize;

		float getDepth( const in vec2 screenPosition ) {
			#if DEPTH_PACKING == 1
			return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );
			#else
			return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		void main() {
			float depth = getDepth( vUv );
			if( depth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = -getViewZ( depth );
			bool rBreak = false, lBreak = false;

			float weightSum = sampleWeights[0];
			vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;

			for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {

				float sampleWeight = sampleWeights[i];
				vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;

				vec2 sampleUv = vUv + sampleUvOffset;
				float viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;

				if( ! rBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

				sampleUv = vUv - sampleUvOffset;
				viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;

				if( ! lBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

			}

			gl_FragColor = diffuseSum / weightSum;
		}`},Fd={createSampleWeights:function(i,e){const t=[];for(let r=0;r<=i;r++)t.push(oI(r,e));return t},createSampleOffsets:function(i,e){const t=[];for(let r=0;r<=i;r++)t.push(e.clone().multiplyScalar(r));return t},configure:function(i,e,t,r){i.defines.KERNEL_RADIUS=e,i.uniforms.sampleUvOffsets.value=Fd.createSampleOffsets(e,r),i.uniforms.sampleWeights.value=Fd.createSampleWeights(e,t),i.needsUpdate=!0}};function oI(i,e){return Math.exp(-i*i/(e*e*2))/(Math.sqrt(2*Math.PI)*e)}class th extends Zs{constructor(e,t,r=new se(256,256)){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.originalClearColor=new ve,this._oldClearColor=new ve,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new se(r.x,r.y),this.saoRenderTarget=new pt(this.resolution.x,this.resolution.y,{type:Yt}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone();const s=new lh;s.format=Bn,s.type=Zn,this.normalRenderTarget=new pt(this.resolution.x,this.resolution.y,{minFilter:lt,magFilter:lt,type:Yt,depthTexture:s}),this.normalMaterial=new gp,this.normalMaterial.blending=0,this.saoMaterial=new at({defines:Object.assign({},ju.defines),fragmentShader:ju.fragmentShader,vertexShader:ju.vertexShader,uniforms:ii.clone(ju.uniforms)}),this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=s,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=0,this.vBlurMaterial=new at({uniforms:ii.clone(ha.uniforms),defines:Object.assign({},ha.defines),vertexShader:ha.vertexShader,fragmentShader:ha.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=0,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=s,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=0,this.hBlurMaterial=new at({uniforms:ii.clone(ha.uniforms),defines:Object.assign({},ha.defines),vertexShader:ha.vertexShader,fragmentShader:ha.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=0,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=s,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=0,this.materialCopy=new at({uniforms:ii.clone(Bs.uniforms),vertexShader:Bs.vertexShader,fragmentShader:Bs.fragmentShader,blending:0}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=$o,this.materialCopy.blendSrc=sh,this.materialCopy.blendDst=Jo,this.materialCopy.blendEquation=ar,this.materialCopy.blendSrcAlpha=rh,this.materialCopy.blendDstAlpha=Jo,this.materialCopy.blendEquationAlpha=ar,this.fsQuad=new Ml(null)}render(e,t,r){this.renderToScreen&&(this.materialCopy.blending=0,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const s=e.autoClear;e.autoClear=!1,this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const a=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=a,this.hBlurMaterial.uniforms.depthCutoff.value=a,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),this.prevStdDev===this.params.saoBlurStdDev&&this.prevNumSamples===this.params.saoBlurRadius||(Fd.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new se(0,1)),Fd.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new se(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));const n=this.materialCopy;this.params.output===th.OUTPUT.Normal?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),this.params.output===th.OUTPUT.Default?n.blending=$o:n.blending=0,this.renderPass(e,n,this.renderToScreen?null:r),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=s}renderPass(e,t,r,s,a){e.getClearColor(this.originalClearColor);const n=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderOverride(e,t,r,s,a){e.getClearColor(this.originalClearColor);const n=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s=t.clearColor||s,a=t.clearAlpha||a,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}setSize(e,t){this.saoRenderTarget.setSize(e,t),this.blurIntermediateRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.saoMaterial.uniforms.size.value.set(e,t),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,t),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,t),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}}th.OUTPUT={Default:0,SAO:1,Normal:2};const is={name:"SSRShader",defines:{MAX_STEP:0,PERSPECTIVE_CAMERA:!0,DISTANCE_ATTENUATION:!0,FRESNEL:!0,INFINITE_THICK:!1,SELECTIVE:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new se},cameraProjectionMatrix:{value:new Me},cameraInverseProjectionMatrix:{value:new Me},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},thickness:{value:.018}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`
		// precision highp float;
		precision highp sampler2D;
		varying vec2 vUv;
		uniform sampler2D tDepth;
		uniform sampler2D tNormal;
		uniform sampler2D tMetalness;
		uniform sampler2D tDiffuse;
		uniform float cameraRange;
		uniform vec2 resolution;
		uniform float opacity;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform float maxDistance;
		uniform float thickness;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;
		#include <packing>
		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {
			//x0: point, x1: linePointA, x2: linePointB
			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html
			return length(cross(x0-x1,x0-x2))/length(x2-x1);
		}
		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){
			// https://mathworld.wolfram.com/Point-PlaneDistance.html
			//// https://en.wikipedia.org/wiki/Plane_(geometry)
			//// http://paulbourke.net/geometry/pointlineplane/
			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;
			float x0=point.x,y0=point.y,z0=point.z;
			float x=planePoint.x,y=planePoint.y,z=planePoint.z;
			float d=-(a*x+b*y+c*z);
			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);
			return distance;
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			#ifdef PERSPECTIVE_CAMERA
				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view
		}
		vec3 getViewNormal( const in vec2 uv ) {
			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );
		}
		vec2 viewPositionToXY(vec3 viewPosition){
			vec2 xy;
			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);
			xy=clip.xy;//clip
			float clipW=clip.w;
			xy/=clipW;//NDC
			xy=(xy+1.)/2.;//uv
			xy*=resolution;//screen
			return xy;
		}
		void main(){
			#ifdef SELECTIVE
				float metalness=texture2D(tMetalness,vUv).r;
				if(metalness==0.) return;
			#endif

			float depth = getDepth( vUv );
			float viewZ = getViewZ( depth );
			if(-viewZ>=cameraFar) return;

			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];
			vec3 viewPosition=getViewPosition( vUv, depth, clipW );

			vec2 d0=gl_FragCoord.xy;
			vec2 d1;

			vec3 viewNormal=getViewNormal( vUv );

			#ifdef PERSPECTIVE_CAMERA
				vec3 viewIncidentDir=normalize(viewPosition);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#else
				vec3 viewIncidentDir=vec3(0,0,-1);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#endif

			float maxReflectRayLen=maxDistance/dot(-viewIncidentDir,viewNormal);
			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html
			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)
			// maxDistance/maxReflectRayLen=cos(theta)
			// maxDistance/maxReflectRayLen==dot(a,b)
			// maxReflectRayLen==maxDistance/dot(a,b)

			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;
			#ifdef PERSPECTIVE_CAMERA
				if(d1viewPosition.z>-cameraNear){
					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx
					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;
					d1viewPosition=viewPosition+viewReflectDir*t;
				}
			#endif
			d1=viewPositionToXY(d1viewPosition);

			float totalLen=length(d1-d0);
			float xLen=d1.x-d0.x;
			float yLen=d1.y-d0.y;
			float totalStep=max(abs(xLen),abs(yLen));
			float xSpan=xLen/totalStep;
			float ySpan=yLen/totalStep;
			for(float i=0.;i<float(MAX_STEP);i++){
				if(i>=totalStep) break;
				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);
				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;
				float s=length(xy-d0)/totalLen;
				vec2 uv=xy/resolution;

				float d = getDepth(uv);
				float vZ = getViewZ( d );
				if(-vZ>=cameraFar) continue;
				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];
				vec3 vP=getViewPosition( uv, d, cW );

				#ifdef PERSPECTIVE_CAMERA
					// https://comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf
					float recipVPZ=1./viewPosition.z;
					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));
				#else
					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);
				#endif

				// if(viewReflectRayZ>vZ) continue; // will cause "npm run make-screenshot webgl_postprocessing_ssr" high probability hang.
				// https://github.com/mrdoob/three.js/pull/21539#issuecomment-821061164
				if(viewReflectRayZ<=vZ){

					bool hit;
					#ifdef INFINITE_THICK
						hit=true;
					#else
						float away=pointToLineDistance(vP,viewPosition,d1viewPosition);

						float minThickness;
						vec2 xyNeighbor=xy;
						xyNeighbor.x+=1.;
						vec2 uvNeighbor=xyNeighbor/resolution;
						vec3 vPNeighbor=getViewPosition(uvNeighbor,d,cW);
						minThickness=vPNeighbor.x-vP.x;
						minThickness*=3.;
						float tk=max(minThickness,thickness);

						hit=away<=tk;
					#endif

					if(hit){
						vec3 vN=getViewNormal( uv );
						if(dot(viewReflectDir,vN)>=0.) continue;
						float distance=pointPlaneDistance(vP,viewPosition,viewNormal);
						if(distance>maxDistance) break;
						float op=opacity;
						#ifdef DISTANCE_ATTENUATION
							float ratio=1.-(distance/maxDistance);
							float attenuation=ratio*ratio;
							op=opacity*attenuation;
						#endif
						#ifdef FRESNEL
							float fresnelCoe=(dot(viewIncidentDir,viewReflectDir)+1.)/2.;
							op*=fresnelCoe;
						#endif
						vec4 reflectColor=texture2D(tDiffuse,uv);
						gl_FragColor.xyz=reflectColor.xyz;
						gl_FragColor.a=op;
						break;
					}
				}
			}
		}
	`},Wu={name:"SSRDepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;

		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 uv ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, uv ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, uv ).x;

			#endif

		}

		void main() {

			float depth = getLinearDepth( vUv );
			float d = 1.0 - depth;
			// d=(d-.999)*1000.;
			gl_FragColor = vec4( vec3( d ), 1.0 );

		}

	`},ua={name:"SSRBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new se},opacity:{value:.5}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;
		void main() {
			//reverse engineering from PhotoShop blur filter, then change coefficient

			vec2 texelSize = ( 1.0 / resolution );

			vec4 c=texture2D(tDiffuse,vUv);

			vec2 offset;

			offset=(vec2(-1,0))*texelSize;
			vec4 cl=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(1,0))*texelSize;
			vec4 cr=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,-1))*texelSize;
			vec4 cb=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,1))*texelSize;
			vec4 ct=texture2D(tDiffuse,vUv+offset);

			// float coeCenter=.5;
			// float coeSide=.125;
			float coeCenter=.2;
			float coeSide=.2;
			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;
			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;
			gl_FragColor=vec4(rgb,a);

		}
	`};class Ns extends Zs{constructor({renderer:e,scene:t,camera:r,width:s,height:a,selects:n,bouncing:o=!1,groundReflector:l}){super(),this.width=s!==void 0?s:512,this.height=a!==void 0?a:512,this.clear=!0,this.renderer=e,this.scene=t,this.camera=r,this.groundReflector=l,this.opacity=is.uniforms.opacity.value,this.output=0,this.maxDistance=is.uniforms.maxDistance.value,this.thickness=is.uniforms.thickness.value,this.tempColor=new ve,this._selects=n,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(h){this._selects!==h&&(this._selects=h,Array.isArray(h)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0,this.ssrMaterial.needsUpdate=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1,this.ssrMaterial.needsUpdate=!0))}}),this._bouncing=o,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(h){this._bouncing!==h&&(this._bouncing=h,this.ssrMaterial.uniforms.tDiffuse.value=h?this.prevRenderTarget.texture:this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=is.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(h){this._distanceAttenuation!==h&&(this._distanceAttenuation=h,this.ssrMaterial.defines.DISTANCE_ATTENUATION=h,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=is.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(h){this._fresnel!==h&&(this._fresnel=h,this.ssrMaterial.defines.FRESNEL=h,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=is.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(h){this._infiniteThick!==h&&(this._infiniteThick=h,this.ssrMaterial.defines.INFINITE_THICK=h,this.ssrMaterial.needsUpdate=!0)}});const c=new lh;c.type=tp,c.minFilter=lt,c.magFilter=lt,this.beautyRenderTarget=new pt(this.width,this.height,{minFilter:lt,magFilter:lt,type:Yt,depthTexture:c,depthBuffer:!0}),this.prevRenderTarget=new pt(this.width,this.height,{minFilter:lt,magFilter:lt}),this.normalRenderTarget=new pt(this.width,this.height,{minFilter:lt,magFilter:lt,type:Yt}),this.metalnessRenderTarget=new pt(this.width,this.height,{minFilter:lt,magFilter:lt,type:Yt}),this.ssrRenderTarget=new pt(this.width,this.height,{minFilter:lt,magFilter:lt}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new at({defines:Object.assign({},is.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:ii.clone(is.uniforms),vertexShader:is.vertexShader,fragmentShader:is.fragmentShader,blending:0}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new gp,this.normalMaterial.blending=0,this.metalnessOnMaterial=new Qt({color:"white"}),this.metalnessOffMaterial=new Qt({color:"black"}),this.blurMaterial=new at({defines:Object.assign({},ua.defines),uniforms:ii.clone(ua.uniforms),vertexShader:ua.vertexShader,fragmentShader:ua.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new at({defines:Object.assign({},ua.defines),uniforms:ii.clone(ua.uniforms),vertexShader:ua.vertexShader,fragmentShader:ua.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new at({defines:Object.assign({},Wu.defines),uniforms:ii.clone(Wu.uniforms),vertexShader:Wu.vertexShader,fragmentShader:Wu.fragmentShader,blending:0}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new at({uniforms:ii.clone(Bs.uniforms),vertexShader:Bs.vertexShader,fragmentShader:Bs.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:Ra,blendDst:Ia,blendEquation:ar,blendSrcAlpha:Ra,blendDstAlpha:Ia,blendEquationAlpha:ar}),this.fsQuad=new Ml(null),this.originalClearColor=new ve}dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(e,t){switch(e.setRenderTarget(this.beautyRenderTarget),e.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),e.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(e,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(e,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(e,this.blurMaterial,this.blurRenderTarget),this.renderPass(e,this.blurMaterial2,this.blurRenderTarget2)),this.output){case Ns.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t)):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t));break;case Ns.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=1,this.renderPass(e,this.copyMaterial,this.prevRenderTarget));break;case Ns.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Ns.OUTPUT.Depth:this.renderPass(e,this.depthRenderMaterial,this.renderToScreen?null:t);break;case Ns.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t);break;case Ns.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=0,this.renderPass(e,this.copyMaterial,this.renderToScreen?null:t)}}renderPass(e,t,r,s,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));const n=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.fsQuad.material=t,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderOverride(e,t,r,s,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));const n=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s=t.clearColor||s,a=t.clearAlpha||a,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.scene.overrideMaterial=t,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}renderMetalness(e,t,r,s,a){this.originalClearColor.copy(e.getClearColor(this.tempColor));const n=e.getClearAlpha(this.tempColor),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,s=t.clearColor||s,a=t.clearAlpha||a,s!=null&&(e.setClearColor(s),e.setClearAlpha(a||0),e.clear()),this.scene.traverseVisible(l=>{l._SSRPassBackupMaterial=l.material,this._selects.includes(l)?l.material=this.metalnessOnMaterial:l.material=this.metalnessOffMaterial}),e.render(this.scene,this.camera),this.scene.traverseVisible(l=>{l.material=l._SSRPassBackupMaterial}),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(n)}setSize(e,t){this.width=e,this.height=t,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(e*e+t*t),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(e,t),this.prevRenderTarget.setSize(e,t),this.ssrRenderTarget.setSize(e,t),this.normalRenderTarget.setSize(e,t),this.metalnessRenderTarget.setSize(e,t),this.blurRenderTarget.setSize(e,t),this.blurRenderTarget2.setSize(e,t),this.ssrMaterial.uniforms.resolution.value.set(e,t),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(e,t),this.blurMaterial2.uniforms.resolution.value.set(e,t)}}function lI(i,e,t,r){const s=new eI(t),a=t.getPixelRatio();s.setSize(r.clientWidth,r.clientHeight),s.setPixelRatio(a),s.setRenderWay=function(o="效果渲染"){this.effectComposerRender=o==="源渲染"?()=>t.render(i,e):()=>this.render(),this.renderWay=o},s.effectPass={},s.setRenderWay();const n=new tI(i,e);return s.addPass(n),function(o,l,c){const h=new th(l,c);h.enabled=!1,h.params.saoIntensity=.01,h.params.saoScale=100,o.addPass(h),o.effectPass.saoPass=h}(s,i,e),function(o,l){const c=new vl(new se(l.clientWidth,l.clientHeight),1.5,.4,.85);c.enabled=!1,o.addPass(c),o.effectPass.unrealBloomPass=c}(s,r),function(o,l,c,h,u){const d=new Ns({renderer:o,scene:l,camera:c,width:u.clientWidth,height:u.clientHeight,selects:l.ssrList});d.thickness=.018,d.infiniteThick=!1,d.maxDistance=.01,d.opacity=.5,d.enabled=!1,h.addPass(d),h.effectPass.ssrPass=d}(t,i,e,s,r),function(o,l,c,h){const u=new Ta(new se(h.clientWidth,h.clientHeight),l,c);u.renderToScreen=!0,u.edgeStrength=3,u.edgeGlow=0,u.edgeThickness=1,u.pulsePeriod=0,u.usePatternTexture=!1,u.visibleEdgeColor.set(16449071),u.hiddenEdgeColor.set(16449071),u.overlayMaterial.blending=$o,u.overlayMaterial.blendSrc=ih,o.addPass(u),o.effectPass.outlinePass=u}(s,i,e,r),function(o){const l=new rI;o.addPass(l),o.effectPass.outputPass=l}(s),function(o,l,c){const h=new Q0(nI);h.multPixel=1,h.resize=function(){h.material.uniforms.resolution.value.x=h.multPixel/(l.clientWidth*c),h.material.uniforms.resolution.value.y=h.multPixel/(l.clientHeight*c)},h.resize(),o.addPass(h),o.effectPass.fxaaPass=h}(s,r,a),function(o){const l=new aI;l.enabled=!1,o.addPass(l),o.effectPass.screenMaskPass=l}(s),s.resize=function(){const{unrealBloomPass:o,fxaaPass:l}=s.effectPass;s.setSize(r.clientWidth,r.clientHeight),o.setSize(r.clientWidth,r.clientHeight),l.resize()},s}function cI(i,e,t){const r=BR(),s=function(g,m){const v=new Zt(50,m.clientWidth/m.clientHeight,.1,1e5);return v.position.set(10,10,10),v.name="PerspectiveCamera",g.add(v),v}(r,i),a=function({webglRenderParams:g,pixelRatio:m},v){const _=new Cx(g);return _.setSize(v.clientWidth,v.clientHeight),_.setPixelRatio(m),v.appendChild(_.domElement),_}(e,i),n=function(g,m){const v=new HR(g,m.domElement);return v.enableDamping=!0,v.dampingFactor=.05,v.minDistance=.01,v.maxDistance=1e6,v.maxPolarAngle=Math.PI,v}(s,a),o=function(g,m,v,_){const y=new GR(m,v.domElement);g.transformControls=y,y.name="TransformControls",y.traverse(b=>b.isTransformControls=!0),g.add(y);const x=new Tt;return y.addEventListener("dragging-changed",b=>{var M;_.enabled=!b.value,y.drag_change_callback(b.value),(M=y.dragChangeCallback)==null||M.call(y,b.value)}),y.addEventListener("change",()=>{var b;y.box3Helper&&(["Group","Mesh"].includes((b=y==null?void 0:y.object)==null?void 0:b.type)?(y.box3Helper.box=x.setFromObject(y.object),y.box3Helper.visible=!0):y.box3Helper.visible=!1)}),y}(r,s,a,n),l=lI(r,s,a,i),c=function(g){const m=new ZE;return m.resize=()=>{m.setSize(g.clientWidth,g.clientHeight),m.domElement.style.zIndex=0,m.domElement.style.position="relative",m.domElement.style.top=-g.clientHeight+"px",m.domElement.style.height=g.clientHeight+"px",m.domElement.style.width=g.clientWidth+"px",m.domElement.style.pointerEvents="none"},m.reset=()=>m.domElement.childNodes.forEach(v=>v.remove()),m.resize(),g.appendChild(m.domElement),m}(i),h=function(g){const m=new XE;return m.resize=()=>{m.setSize(g.clientWidth,g.clientHeight),m.domElement.style.zIndex=0,m.domElement.style.position="relative",m.domElement.style.top=2*-g.clientHeight+"px",m.domElement.style.height=g.clientHeight+"px",m.domElement.style.width=g.clientWidth+"px",m.domElement.style.pointerEvents="none"},m.reset=()=>m.domElement.childNodes.forEach(v=>v.remove()),m.resize(),g.appendChild(m.domElement),m}(i),u=function(g){const m=new Mc;return m.setMode(0),m.style={offsetTop:0,offsetLeft:0},m.domElement.style.position="relative",m.domElement.style.zIndex="auto",m.domElement.style.width="80px",m.domElement.style.height="48px",m.resize=()=>{const{offsetTop:v,offsetLeft:_}=m.style;m.domElement.style.top=v-3*g.getBoundingClientRect().height+"px",m.domElement.style.left=_+"px"},m.resize(),m.setOffset=(v,_)=>{m.style.offsetTop=v,m.style.offsetLeft=_,m.resize()},m.showStats=!1,m.statsMode=0,m.created=()=>!g.contains(m.domElement)&&g.appendChild(m.domElement),m.destroy=()=>g.contains(m.domElement)&&g.removeChild(m.domElement),m}(i),d=FR({scene:r,camera:s,renderer:a,controls:n,transformControls:o,effectComposer:l,css3DRender:c,css2DRender:h,stats:u,DOM:i},t),p=function(g=144){const m=new kc;if(g===null)return y=>y(m.getDelta());const v=1/g;let _=0;return y=>{const x=m.getDelta();_+=x,_>v&&(y(x),_=0)}}(e.fps);let f=null;return function g(){p(()=>{u.update(),n.update(),r.renderFrames(),l.effectComposerRender(),c.render(r,s),h.render(r,s)}),f=requestAnimationFrame(g)}(),Re({scene:r,camera:s,renderer:a,controls:n,transformControls:o,stats:u,effectComposer:l,renderSceneResize:function(){s.aspect=i.clientWidth/i.clientHeight,s.updateProjectionMatrix(),a.setSize(i.clientWidth,i.clientHeight),l.resize(),r.shaderFrames.forEach(g=>g.uniforms.iResolution&&(g.uniforms.iResolution.value=new se(i.clientWidth,i.clientHeight))),c.resize(),h.resize(),u.resize()},destroySceneRender:function(){cancelAnimationFrame(f),fM(r),a.dispose();for(let g in this)delete this[g];for(;i.children.length;)i.removeChild(i.firstChild);(function(){const g=document.body.getElementsByClassName("vanui-window");for(let m=g.length-1;m>=0;m--)g[m].parentNode.removeChild(g[m])})()}},d)}function hI(i,e,t){var r,s;const{scene:a,camera:n,handler:o,drawCore:l,transformControls:c,effectComposer:h,GUI:u}=i,{outlinePass:d}=h.effectPass;c.detach();const p=function(y,x,b){const M=new _p;return M.setFromCamera(y,x),M.intersectObjects(b.children).filter(T=>!T.object.isTransformControls&&T.object.isMesh&&T.object.visible)}(gw(e),n,a),f=p.find(y=>y.object.visible&&Cy(y.object).visible);if(!f)return;const{object:g,point:m}=f,v=Cy(g);switch(o.mode){case"变换":d.selectedObjects=[],o.isTransformChildren?c.attach(g):c.attach(v);break;case"选择":d.selectedObjects=[g],o.selectPanelEnable&&((r=u==null?void 0:u.createSelectPanel)==null||r.call(u,g));break;case"根选择":d.selectedObjects=[v],o.selectPanelEnable&&((s=u==null?void 0:u.createSelectPanel)==null||s.call(u,v));break;case"场景绘制":l.sceneEventCall(m,g)}const _={currentModel:g,currentRootModel:v,point:m,mode:o.mode};i.currentInfo=_,o.currentInfo=_,t(_)}Ns.OUTPUT={Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7};class Ng{constructor(...e){Object.assign(this,cI(...e))}setCss2dDOM(e,t){e.style.pointerEvents="auto";const{scene:r}=this,s=new eM(e);return s.position.copy(t),r.add(s),s.destroy=()=>r.remove(s),s}setCss3dDOM(e,t){const{scene:r}=this,s=new tM(e);return s.position.copy(t),r.add(s),s.destroy=()=>r.remove(s),s}setLight(...e){const t=G0(...e);return t.target&&this.scene.add(t.target),this.scene.add(t),t}getSceneEvent(e,t){hI(this,e,r=>t==null?void 0:t(r))}getRawSceneEvent(){return function(e){const t=new _p;return{raycaster:t,getIntersects:(r,s)=>(t.setFromCamera(gw(r),e),t.intersectObjects(s))}}(this.camera)}setOutlinePass(e=[]){return this.effectComposer.effectPass.outlinePass.selectedObjects=e}getSceneEditorImage(e){return this.renderer.render(this.scene,this.camera),this.effectComposer.render(),this.renderer.domElement.toDataURL(...e)}setModelAnimationPlay(e){if(e!=null&&e.animationPlayParams)return this.modelCore.modelAnimationPlay(e,e.animationPlayParams)}getSceneCurveList(){return this.scene.children.filter(e=>e.isCurveMesh).map(e=>{var t,r;return{path:e.curvePath||((r=(t=e.geometry)==null?void 0:t.parameters)==null?void 0:r.path),mesh:e}})}setCurveAnimation(e,t=1){if(e)return function(r,s=1,a){return{id:Date.now(),curve:r,time:0,pause:!1,speed:s,start:function(){a.indexOf(this)>-1||(a.push(this),this.pause=!1)},destroy:function(){const n=a.indexOf(this);n>-1&&a.splice(n,1),delete this.start,delete this.destroy},frameCallback:null,frameEndCallback:null,commonAnimateRender:function(){var n,o;if(!this.pause){if(this.time+=this.speed/1e3,this.time>1||this.time<0)return this.time=this.time>1?1:0,this.pause=!0,(n=this.frameEndCallback)==null?void 0:n.call(this,"end");(o=this.frameCallback)==null||o.call(this,this.curve.getPointAt(this.time))}}}}(e,t,this.scene.commonFrames)}}pv(Ng,"dracoPath","/draco/"),pv(Ng,"styleOverrides",qc);const uI={class:"build"},dI={class:"back"},pI={class:"item"},mI={class:"back"},fI={class:"item"},gI={__name:"build",props:["emitEditor"],setup(i){const e=i,t=a=>a.length>20?a.slice(0,20)+"...":a;function r(a,n="online"){const o=a.split(".").pop().toUpperCase();let l;if(n==="online")l=ri.buildUrl+a;else{const u=e.emitEditor.IndexDBList.find(d=>d.name===a);if(u)l=URL.createObjectURL(u.blob);else return}if(!o||!["FBX","GLB","GLTF","OBJ"].includes(o))return;const c={url:l,type:o==="GLB"?"GLTF":o,indexDBNameUrl:n==="indexDB"?"IndexDB:"+a:""},{loaderService:h}=e.emitEditor.threeEditor.modelCore.insertModel(c);e.emitEditor.loading=!0,setTimeout(()=>{e.emitEditor.loading&&(e.emitEditor.loading=!1,zr.error("网络较差,加载比较缓慢"))},8e3),h.complete=u=>{e.emitEditor.loading=!1;const{transformControls:d,camera:p,controls:f}=e.emitEditor.threeEditor,{maxView:g,target:m}=O0(u);Promise.all([Tr(p.position,g),Tr(f.target,m)]).then(()=>{e.emitEditor.threeEditor.setOutlinePass([u]),f.target.copy(m),d.attach(u)})}}const s=Ug({list:[]});return _l(ri.buildUrl).then(a=>s.list=a==null?void 0:a.map(n=>({name:n,url:ri.buildUrl+n}))),(a,n)=>{const o=_t("el-link");return Ge(),it("div",uI,[(Ge(!0),it(Vi,null,cr(i.emitEditor.IndexDBList,l=>(Ge(),it("div",dI,[Pe("div",pI,[Oe(o,{onClick:c=>r(l.name,"indexDB")},{default:ze(()=>[mt(" 本机: "+Xi(t(l.name)),1)]),_:2},1032,["onClick"])])]))),256)),(Ge(!0),it(Vi,null,cr(gt(s).list,l=>(Ge(),it("div",mI,[Pe("div",fI,[Oe(o,{onClick:c=>r(l.name)},{default:ze(()=>[mt(Xi(l.name),1)]),_:2},1032,["onClick"])])]))),256))])}}},vI=Xs(gI,[["__scopeId","data-v-98bbc372"]]),_I=i=>(Bd("data-v-69264b38"),i=i(),Vd(),i),yI={class:"listScene"},xI={class:"back"},bI={class:"item"},MI=_I(()=>Pe("img",{src:Hd},null,-1)),wI={__name:"list",props:["emitEditor"],setup(i){const e=zd({list:[]}),t=i;function r(a){return a.replace(/.json/g,"")}function s(a){fetch(ri.editorJsonUrl+a).then(n=>n.json()).then(n=>{var l,c;const{emitEditor:o}=t;setTimeout(()=>o.createScene(n),100),(c=(l=o==null?void 0:o.threeEditor)==null?void 0:l.destroySceneRender)==null||c.call(l)})}return _l(ri.editorJsonUrl).then(a=>e.list=a),(a,n)=>{const o=_t("el-link");return Ge(),it("div",yI,[(Ge(!0),it(Vi,null,cr(e.list,(l,c)=>(Ge(),it("div",xI,[Pe("div",bI,[MI,Oe(o,{onClick:h=>s(l)},{default:ze(()=>[mt(Xi(r(l)),1)]),_:2},1032,["onClick"])])]))),256))])}}},SI=Xs(wI,[["__scopeId","data-v-69264b38"]]),TI="/three-editor/dist/vite.svg",EI=i=>(Bd("data-v-dcdb4b3c"),i=i(),Vd(),i),AI={class:"fontL"},CI={class:"back"},PI={class:"item"},RI=EI(()=>Pe("img",{src:TI},null,-1)),II={__name:"font",props:["emitEditor"],setup(i){const e=zd({list:[]});function t(a){return a.replace(/.json/g,"")}function r(a){const n=document.createElement("textarea");n.value=a,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}function s(a){r(ri.fontUrl+a),zr.success("已复制"+ri.fontUrl+a)}return _l(ri.fontUrl).then(a=>e.list=a),(a,n)=>{const o=_t("el-link");return Ge(),it("div",AI,[(Ge(!0),it(Vi,null,cr(e.list,(l,c)=>(Ge(),it("div",CI,[Pe("div",PI,[RI,Oe(o,{onClick:h=>s(l)},{default:ze(()=>[mt(Xi(t(l)),1)]),_:2},1032,["onClick"])])]))),256))])}}},LI=Xs(II,[["__scopeId","data-v-dcdb4b3c"]]),DI={class:"imageL"},OI={class:"back"},NI={class:"item"},UI=["src"],kI={__name:"image",props:["emitEditor"],setup(i){const e=zd({list:[]});function t(s){const a=document.createElement("textarea");a.value=s,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}function r(s){t(ri.channelUrl+s),zr.success("已复制"+ri.channelUrl+s)}return _l(ri.channelUrl).then(s=>e.list=s),(s,a)=>{const n=_t("el-link");return Ge(),it("div",DI,[(Ge(!0),it(Vi,null,cr(e.list,(o,l)=>(Ge(),it("div",OI,[Pe("div",NI,[Pe("img",{src:gt(ri).channelUrl+o},null,8,UI),Oe(n,{onClick:c=>r(o)},{default:ze(()=>[mt(Xi(o),1)]),_:2},1032,["onClick"])])]))),256))])}}},FI=Xs(kI,[["__scopeId","data-v-e372bc7c"]]),zI={class:"imageL"},BI={class:"back"},VI={class:"item"},HI=["src"],GI={__name:"video",props:["emitEditor"],setup(i){const e=zd({list:[]});function t(s){const a=document.createElement("textarea");a.value=s,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}function r(s){t(ri.videoUrl+s),zr.success("已复制"+ri.videoUrl+s)}return _l(ri.videoUrl).then(s=>e.list=s),(s,a)=>{const n=_t("el-link");return Ge(),it("div",zI,[(Ge(!0),it(Vi,null,cr(e.list,(o,l)=>(Ge(),it("div",BI,[Pe("div",VI,[Pe("video",{src:gt(ri).videoUrl+o,autoplay:"",muted:""},null,8,HI),Oe(n,{onClick:c=>r(o)},{default:ze(()=>[mt(Xi(o),1)]),_:2},1032,["onClick"])])]))),256))])}}},jI=Xs(GI,[["__scopeId","data-v-8d77db4a"]]),WI={class:"left"},XI={class:"list"},qI=["onClick"],YI={__name:"leftPanel",props:["emitEditor"],setup(i){const e=ns(!0),t=[{icon:"set-up",title:"配置案例",component:SI},{icon:"office-building",title:"建筑",component:vI},{icon:"partly-cloudy",title:"天空盒",component:Qw},{icon:"Picture",title:"图片",component:FI},{icon:"edit-pen",title:"字体",component:LI},{icon:"video-play",title:"视频",component:jI}];let r=localStorage.getItem("active");r||(r=0),r>=t.length&&(r=0);const s=ns(r);function a(n){localStorage.setItem("active",n),s.value=n}return(n,o)=>{const l=_t("el-button"),c=_t("Expand"),h=_t("Fold"),u=_t("el-icon");return Ge(),it(Vi,null,[Oe(nx,{name:"el-zoom-in-left"},{default:ze(()=>[kg(Pe("div",WI,[Pe("div",XI,[(Ge(),it(Vi,null,cr(t,(d,p)=>Pe("div",{class:"iconotem",onClick:f=>a(p)},[Oe(l,{class:kw(s.value==p?"active":"btn"),link:"",icon:d.icon,title:d.title},null,8,["class","icon","title"]),Pe("span",{style:uf(s.value==p?"color:rgb(182, 211, 244);font-weight:bold":"")},Xi(d.title),5)],8,qI)),64))]),(Ge(),Bo(Fw(t[s.value].component),{emitEditor:i.emitEditor},null,8,["emitEditor"]))],512),[[ax,e.value]])]),_:1}),Pe("div",{class:"lico",style:uf({left:e.value?"287px":"0px"})},[Oe(u,{class:"icon",onClick:o[0]||(o[0]=d=>e.value=!e.value)},{default:ze(()=>[e.value?(Ge(),Bo(h,{key:1})):(Ge(),Bo(c,{key:0}))]),_:1})],4)],64)}}},ZI=Xs(YI,[["__scopeId","data-v-e396d8e5"]]),xs=i=>(Bd("data-v-654b02df"),i=i(),Vd(),i),KI={class:"right"},QI={class:"main"},$I={class:"card-header"},JI={class:"text item"},eL=xs(()=>Pe("br",null,null,-1)),tL=xs(()=>Pe("div",{class:"card-header"},[Pe("span",null,"Css2D/3D 使用 ")],-1)),iL=xs(()=>Pe("img",{class:"logo",src:Hd,alt:"logo",width:"25px",height:"25px"},null,-1)),rL=xs(()=>Pe("img",{class:"logo",src:Hd,alt:"logo",width:"25px",height:"25px"},null,-1)),sL={style:{display:"flex"}},aL=xs(()=>Pe("br",null,null,-1)),nL=xs(()=>Pe("div",{class:"card-header"},[Pe("span",null,"自定义物体动画")],-1)),oL={key:0},lL=xs(()=>Pe("span",{class:"text_a"},"物体:",-1)),cL={key:1},hL=xs(()=>Pe("span",{class:"text_a"},"物体:",-1)),uL={key:2},dL=xs(()=>Pe("span",{class:"text_a"},"视角:",-1)),pL={key:3},mL=xs(()=>Pe("span",{class:"text_a"},"视角:",-1)),fL={style:{display:"flex"}},gL={__name:"rightPanel",props:["emitEditor"],setup(i){const e=i,t=ns(null),r=ns(null);let s=ns({transformAnimationList:[],transformAnimationMesh:null,viewAngleList:[]});const a=()=>e.emitEditor.threeEditor.setCss2dDOM(t.value,new J_.Vector3(0,0,0)),n=()=>e.emitEditor.threeEditor.setCss3dDOM(r.value,new J_.Vector3(0,0,0)).scale.set(.1,.1,.1),o=d=>Ad(s.value.transformAnimationMesh,d._transformInfo,d.transformInfo_,d.gsapParams),l=d=>{const{camera:p,controls:f}=e.emitEditor.threeEditor;new Promise(g=>Tr(p.position,d.position,{duration:2,onComplete:g})),new Promise(g=>Tr(f.target,d.target,{duration:2,onComplete:g}))},c=()=>{const{camera:d,controls:p}=e.emitEditor.threeEditor;s.value.transformAnimationList.reduce(async(m,v)=>(await m,Ad(s.value.transformAnimationMesh,v._transformInfo,v.transformInfo_,v.gsapParams)),Promise.resolve()),s.value.viewAngleList.reduce(async(m,v)=>(await m,Promise.all([new Promise(_=>Tr(d.position,v.position,{duration:2,onComplete:_})),new Promise(_=>Tr(p.target,v.target,{duration:2,onComplete:_}))])),Promise.resolve())};df(()=>e.emitEditor.threeEditor,d=>{if(d){let p=!1;d.modelCore.progressList.forEach(f=>{f.params.name==="动画测试"&&(p=!0,f.loaderService.complete=g=>{s.value.transformAnimationList=f.params.transformAnimationList,s.value.transformAnimationMesh=g,s.value.viewAngleList=d.controls.viewAngleList})}),p||(s.value.transformAnimationList=[],s.value.transformAnimationMesh=null,s.value.viewAngleList=[])}});function h(d){return d?typeof d=="number"?d.toFixed(12):d.slice(0,12):""}const u=ns(!0);return(d,p)=>{const f=_t("el-button"),g=_t("el-card"),m=_t("Expand"),v=_t("Fold"),_=_t("el-icon");return Ge(),it(Vi,null,[Oe(nx,{name:"el-zoom-in-bottom"},{default:ze(()=>[kg(Pe("div",KI,[Pe("div",QI,[Oe(g,{class:"box-card"},{header:ze(()=>{var y,x;return[Pe("div",$I,[Pe("span",null,"名称："+Xi(h((x=(y=i.emitEditor.info)==null?void 0:y.currentModel)==null?void 0:x.name)),1)])]}),footer:ze(()=>[Oe(f,{class:"button",onClick:p[0]||(p[0]=y=>i.emitEditor.threeEditor.setLight("AmbientLight",{intensity:3})),text:""},{default:ze(()=>[mt("快速添加环境光")]),_:1})]),default:ze(()=>[(Ge(),it(Vi,null,cr(["x","y","z"],y=>{var x;return Pe("div",JI,Xi("坐标 "+y+" : "+h((x=i.emitEditor.info)==null?void 0:x.point[y])),1)}),64))]),_:1}),eL,Oe(g,{class:"box-card"},{header:ze(()=>[tL]),footer:ze(()=>[Pe("span",sL,[Oe(f,{class:"button",onClick:a,text:""},{default:ze(()=>[mt("Css2D")]),_:1}),Oe(f,{class:"button",onClick:n,text:""},{default:ze(()=>[mt("Css3D")]),_:1})])]),default:ze(()=>[Pe("div",null,[mt("测试DOM: "),Pe("span",{ref_key:"card",ref:t},[mt(" 2D:"),iL],512),Pe("span",{ref_key:"card2",ref:r},[mt(" 3D:"),rL],512)])]),_:1}),aL,Oe(g,{class:"box-card"},{header:ze(()=>[nL]),footer:ze(()=>[Pe("span",fL,[Oe(f,{disabled:gt(s).transformAnimationList.length<1,class:"button",onClick:c,text:""},{default:ze(()=>[mt("动画连续播放")]),_:1},8,["disabled"])])]),default:ze(()=>[Pe("div",null,[gt(s).transformAnimationList.length>0?(Ge(),it("div",oL,[lL,(Ge(!0),it(Vi,null,cr(gt(s).transformAnimationList,(y,x)=>(Ge(),it("span",{key:x},[Oe(f,{onClick:b=>o(y)},{default:ze(()=>[mt(Xi(x),1)]),_:2},1032,["onClick"])]))),128))])):(Ge(),it("div",cL,[hL,mt(" ——无——")])),gt(s).viewAngleList.length>0?(Ge(),it("div",uL,[dL,(Ge(!0),it(Vi,null,cr(gt(s).viewAngleList,(y,x)=>(Ge(),it("span",{key:x},[Oe(f,{onClick:b=>l(y)},{default:ze(()=>[mt(Xi(x),1)]),_:2},1032,["onClick"])]))),128))])):(Ge(),it("div",pL,[mL,mt(" ——无——")]))])]),_:1})])],512),[[ax,u.value]])]),_:1}),Pe("div",{class:"lico1",style:uf({right:u.value?"287px":"0px"})},[Oe(_,{class:"icon",onClick:p[1]||(p[1]=y=>u.value=!u.value)},{default:ze(()=>[u.value?(Ge(),Bo(v,{key:1})):(Ge(),Bo(m,{key:0}))]),_:1})],4)],64)}}},vL=Xs(gL,[["__scopeId","data-v-654b02df"]]);function Xu(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Tw={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(i,e){(function(t){i.exports=t()})(function(){return function t(r,s,a){function n(c,h){if(!s[c]){if(!r[c]){var u=typeof Xu=="function"&&Xu;if(!h&&u)return u(c,!0);if(o)return o(c,!0);var d=new Error("Cannot find module '"+c+"'");throw d.code="MODULE_NOT_FOUND",d}var p=s[c]={exports:{}};r[c][0].call(p.exports,function(f){var g=r[c][1][f];return n(g||f)},p,p.exports,t,r,s,a)}return s[c].exports}for(var o=typeof Xu=="function"&&Xu,l=0;l<a.length;l++)n(a[l]);return n}({1:[function(t,r,s){var a=t("./utils"),n=t("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(l){for(var c,h,u,d,p,f,g,m=[],v=0,_=l.length,y=_,x=a.getTypeOf(l)!=="string";v<l.length;)y=_-v,u=x?(c=l[v++],h=v<_?l[v++]:0,v<_?l[v++]:0):(c=l.charCodeAt(v++),h=v<_?l.charCodeAt(v++):0,v<_?l.charCodeAt(v++):0),d=c>>2,p=(3&c)<<4|h>>4,f=1<y?(15&h)<<2|u>>6:64,g=2<y?63&u:64,m.push(o.charAt(d)+o.charAt(p)+o.charAt(f)+o.charAt(g));return m.join("")},s.decode=function(l){var c,h,u,d,p,f,g=0,m=0,v="data:";if(l.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var _,y=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===o.charAt(64)&&y--,l.charAt(l.length-2)===o.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=n.uint8array?new Uint8Array(0|y):new Array(0|y);g<l.length;)c=o.indexOf(l.charAt(g++))<<2|(d=o.indexOf(l.charAt(g++)))>>4,h=(15&d)<<4|(p=o.indexOf(l.charAt(g++)))>>2,u=(3&p)<<6|(f=o.indexOf(l.charAt(g++))),_[m++]=c,p!==64&&(_[m++]=h),f!==64&&(_[m++]=u);return _}},{"./support":30,"./utils":32}],2:[function(t,r,s){var a=t("./external"),n=t("./stream/DataWorker"),o=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(h,u,d,p,f){this.compressedSize=h,this.uncompressedSize=u,this.crc32=d,this.compression=p,this.compressedContent=f}c.prototype={getContentWorker:function(){var h=new n(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),u=this;return h.on("end",function(){if(this.streamInfo.data_length!==u.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),h},getCompressedWorker:function(){return new n(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(h,u,d){return h.pipe(new o).pipe(new l("uncompressedSize")).pipe(u.compressWorker(d)).pipe(new l("compressedSize")).withStreamInfo("compression",u)},r.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,r,s){var a=t("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},s.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,r,s){var a=t("./utils"),n=function(){for(var o,l=[],c=0;c<256;c++){o=c;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;l[c]=o}return l}();r.exports=function(o,l){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?function(c,h,u,d){var p=n,f=d+u;c^=-1;for(var g=d;g<f;g++)c=c>>>8^p[255&(c^h[g])];return-1^c}(0|l,o,o.length,0):function(c,h,u,d){var p=n,f=d+u;c^=-1;for(var g=d;g<f;g++)c=c>>>8^p[255&(c^h.charCodeAt(g))];return-1^c}(0|l,o,o.length,0):0}},{"./utils":32}],5:[function(t,r,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(t,r,s){var a=null;a=typeof Promise<"u"?Promise:t("lie"),r.exports={Promise:a}},{lie:37}],7:[function(t,r,s){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",n=t("pako"),o=t("./utils"),l=t("./stream/GenericWorker"),c=a?"uint8array":"array";function h(u,d){l.call(this,"FlateWorker/"+u),this._pako=null,this._pakoAction=u,this._pakoOptions=d,this.meta={}}s.magic="\b\0",o.inherits(h,l),h.prototype.processChunk=function(u){this.meta=u.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(c,u.data),!1)},h.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new n[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var u=this;this._pako.onData=function(d){u.push({data:d,meta:u.meta})}},s.compressWorker=function(u){return new h("Deflate",u)},s.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,r,s){function a(p,f){var g,m="";for(g=0;g<f;g++)m+=String.fromCharCode(255&p),p>>>=8;return m}function n(p,f,g,m,v,_){var y,x,b=p.file,M=p.compression,T=_!==c.utf8encode,A=o.transformTo("string",_(b.name)),L=o.transformTo("string",c.utf8encode(b.name)),U=b.comment,P=o.transformTo("string",_(U)),E=o.transformTo("string",c.utf8encode(U)),I=L.length!==b.name.length,S=E.length!==U.length,V="",J="",X="",te=b.dir,ie=b.date,fe={crc32:0,compressedSize:0,uncompressedSize:0};f&&!g||(fe.crc32=p.crc32,fe.compressedSize=p.compressedSize,fe.uncompressedSize=p.uncompressedSize);var B=0;f&&(B|=8),T||!I&&!S||(B|=2048);var j=0,ae=0;te&&(j|=16),v==="UNIX"?(ae=798,j|=function(D,ee){var ne=D;return D||(ne=ee?16893:33204),(65535&ne)<<16}(b.unixPermissions,te)):(ae=20,j|=function(D){return 63&(D||0)}(b.dosPermissions)),y=ie.getUTCHours(),y<<=6,y|=ie.getUTCMinutes(),y<<=5,y|=ie.getUTCSeconds()/2,x=ie.getUTCFullYear()-1980,x<<=4,x|=ie.getUTCMonth()+1,x<<=5,x|=ie.getUTCDate(),I&&(J=a(1,1)+a(h(A),4)+L,V+="up"+a(J.length,2)+J),S&&(X=a(1,1)+a(h(P),4)+E,V+="uc"+a(X.length,2)+X);var O="";return O+=`
\0`,O+=a(B,2),O+=M.magic,O+=a(y,2),O+=a(x,2),O+=a(fe.crc32,4),O+=a(fe.compressedSize,4),O+=a(fe.uncompressedSize,4),O+=a(A.length,2),O+=a(V.length,2),{fileRecord:u.LOCAL_FILE_HEADER+O+A+V,dirRecord:u.CENTRAL_FILE_HEADER+a(ae,2)+O+a(P.length,2)+"\0\0\0\0"+a(j,4)+a(m,4)+A+V+P}}var o=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),h=t("../crc32"),u=t("../signature");function d(p,f,g,m){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=f,this.zipPlatform=g,this.encodeFileName=m,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(d,l),d.prototype.push=function(p){var f=p.meta.percent||0,g=this.entriesCount,m=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:g?(f+100*(g-m-1))/g:100}}))},d.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var f=this.streamFiles&&!p.file.dir;if(f){var g=n(p,f,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(p){this.accumulate=!1;var f=this.streamFiles&&!p.file.dir,g=n(p,f,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),f)this.push({data:function(m){return u.DATA_DESCRIPTOR+a(m.crc32,4)+a(m.compressedSize,4)+a(m.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var p=this.bytesWritten,f=0;f<this.dirRecords.length;f++)this.push({data:this.dirRecords[f],meta:{percent:100}});var g=this.bytesWritten-p,m=function(v,_,y,x,b){var M=o.transformTo("string",b(x));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(v,2)+a(v,2)+a(_,4)+a(y,4)+a(M.length,2)+M}(this.dirRecords.length,g,p,this.zipComment,this.encodeFileName);this.push({data:m,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(p){this._sources.push(p);var f=this;return p.on("data",function(g){f.processChunk(g)}),p.on("end",function(){f.closedSource(f.previous.streamInfo),f._sources.length?f.prepareNextSource():f.end()}),p.on("error",function(g){f.error(g)}),this},d.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(p){var f=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var g=0;g<f.length;g++)try{f[g].error(p)}catch{}return!0},d.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,f=0;f<p.length;f++)p[f].lock()},r.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,r,s){var a=t("../compressions"),n=t("./ZipFileWorker");s.generateWorker=function(o,l,c){var h=new n(l.streamFiles,c,l.platform,l.encodeFileName),u=0;try{o.forEach(function(d,p){u++;var f=function(_,y){var x=_||y,b=a[x];if(!b)throw new Error(x+" is not a valid compression method !");return b}(p.options.compression,l.compression),g=p.options.compressionOptions||l.compressionOptions||{},m=p.dir,v=p.date;p._compressWorker(f,g).withStreamInfo("file",{name:d,dir:m,date:v,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(h)}),h.entriesCount=u}catch(d){h.error(d)}return h}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,r,s){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var n=new a;for(var o in this)typeof this[o]!="function"&&(n[o]=this[o]);return n}}(a.prototype=t("./object")).loadAsync=t("./load"),a.support=t("./support"),a.defaults=t("./defaults"),a.version="3.10.1",a.loadAsync=function(n,o){return new a().loadAsync(n,o)},a.external=t("./external"),r.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,r,s){var a=t("./utils"),n=t("./external"),o=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function u(d){return new n.Promise(function(p,f){var g=d.decompressed.getContentWorker().pipe(new c);g.on("error",function(m){f(m)}).on("end",function(){g.streamInfo.crc32!==d.decompressed.crc32?f(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}r.exports=function(d,p){var f=this;return p=a.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),h.isNode&&h.isStream(d)?n.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",d,!0,p.optimizedBinaryString,p.base64).then(function(g){var m=new l(p);return m.load(g),m}).then(function(g){var m=[n.Promise.resolve(g)],v=g.files;if(p.checkCRC32)for(var _=0;_<v.length;_++)m.push(u(v[_]));return n.Promise.all(m)}).then(function(g){for(var m=g.shift(),v=m.files,_=0;_<v.length;_++){var y=v[_],x=y.fileNameStr,b=a.resolve(y.fileNameStr);f.file(b,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:p.createFolders}),y.dir||(f.file(b).unsafeOriginalName=x)}return m.zipComment.length&&(f.comment=m.zipComment),f})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,r,s){var a=t("../utils"),n=t("../stream/GenericWorker");function o(l,c){n.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}a.inherits(o,n),o.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(h){c.push({data:h,meta:{percent:0}})}).on("error",function(h){c.isPaused?this.generatedError=h:c.error(h)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},o.prototype.pause=function(){return!!n.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,r,s){var a=t("readable-stream").Readable;function n(o,l,c){a.call(this,l),this._helper=o;var h=this;o.on("data",function(u,d){h.push(u)||h._helper.pause(),c&&c(d)}).on("error",function(u){h.emit("error",u)}).on("end",function(){h.push(null)})}t("../utils").inherits(n,a),n.prototype._read=function(){this._helper.resume()},r.exports=n},{"../utils":32,"readable-stream":16}],14:[function(t,r,s){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(a,n){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,n);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,n)},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);var n=new Buffer(a);return n.fill(0),n},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"}}},{}],15:[function(t,r,s){function a(b,M,T){var A,L=o.getTypeOf(M),U=o.extend(T||{},h);U.date=U.date||new Date,U.compression!==null&&(U.compression=U.compression.toUpperCase()),typeof U.unixPermissions=="string"&&(U.unixPermissions=parseInt(U.unixPermissions,8)),U.unixPermissions&&16384&U.unixPermissions&&(U.dir=!0),U.dosPermissions&&16&U.dosPermissions&&(U.dir=!0),U.dir&&(b=v(b)),U.createFolders&&(A=m(b))&&_.call(this,A,!0);var P=L==="string"&&U.binary===!1&&U.base64===!1;T&&T.binary!==void 0||(U.binary=!P),(M instanceof u&&M.uncompressedSize===0||U.dir||!M||M.length===0)&&(U.base64=!1,U.binary=!0,M="",U.compression="STORE",L="string");var E=null;E=M instanceof u||M instanceof l?M:f.isNode&&f.isStream(M)?new g(b,M):o.prepareContent(b,M,U.binary,U.optimizedBinaryString,U.base64);var I=new d(b,E,U);this.files[b]=I}var n=t("./utf8"),o=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),h=t("./defaults"),u=t("./compressedObject"),d=t("./zipObject"),p=t("./generate"),f=t("./nodejsUtils"),g=t("./nodejs/NodejsStreamInputAdapter"),m=function(b){b.slice(-1)==="/"&&(b=b.substring(0,b.length-1));var M=b.lastIndexOf("/");return 0<M?b.substring(0,M):""},v=function(b){return b.slice(-1)!=="/"&&(b+="/"),b},_=function(b,M){return M=M!==void 0?M:h.createFolders,b=v(b),this.files[b]||a.call(this,b,null,{dir:!0,createFolders:M}),this.files[b]};function y(b){return Object.prototype.toString.call(b)==="[object RegExp]"}var x={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(b){var M,T,A;for(M in this.files)A=this.files[M],(T=M.slice(this.root.length,M.length))&&M.slice(0,this.root.length)===this.root&&b(T,A)},filter:function(b){var M=[];return this.forEach(function(T,A){b(T,A)&&M.push(A)}),M},file:function(b,M,T){if(arguments.length!==1)return b=this.root+b,a.call(this,b,M,T),this;if(y(b)){var A=b;return this.filter(function(U,P){return!P.dir&&A.test(U)})}var L=this.files[this.root+b];return L&&!L.dir?L:null},folder:function(b){if(!b)return this;if(y(b))return this.filter(function(L,U){return U.dir&&b.test(L)});var M=this.root+b,T=_.call(this,M),A=this.clone();return A.root=T.name,A},remove:function(b){b=this.root+b;var M=this.files[b];if(M||(b.slice(-1)!=="/"&&(b+="/"),M=this.files[b]),M&&!M.dir)delete this.files[b];else for(var T=this.filter(function(L,U){return U.name.slice(0,b.length)===b}),A=0;A<T.length;A++)delete this.files[T[A].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(b){var M,T={};try{if((T=o.extend(b||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");o.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var A=T.comment||this.comment||"";M=p.generateWorker(this,T,A)}catch(L){(M=new l("error")).error(L)}return new c(M,T.type||"string",T.mimeType)},generateAsync:function(b,M){return this.generateInternalStream(b).accumulate(M)},generateNodeStream:function(b,M){return(b=b||{}).type||(b.type="nodebuffer"),this.generateInternalStream(b).toNodejsStream(M)}};r.exports=x},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,r,s){r.exports=t("stream")},{stream:void 0}],17:[function(t,r,s){var a=t("./DataReader");function n(o){a.call(this,o);for(var l=0;l<this.data.length;l++)o[l]=255&o[l]}t("../utils").inherits(n,a),n.prototype.byteAt=function(o){return this.data[this.zero+o]},n.prototype.lastIndexOfSignature=function(o){for(var l=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),u=o.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===l&&this.data[d+1]===c&&this.data[d+2]===h&&this.data[d+3]===u)return d-this.zero;return-1},n.prototype.readAndCheckSignature=function(o){var l=o.charCodeAt(0),c=o.charCodeAt(1),h=o.charCodeAt(2),u=o.charCodeAt(3),d=this.readData(4);return l===d[0]&&c===d[1]&&h===d[2]&&u===d[3]},n.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=n},{"../utils":32,"./DataReader":18}],18:[function(t,r,s){var a=t("../utils");function n(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}n.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var l,c=0;for(this.checkOffset(o),l=this.index+o-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=o,c},readString:function(o){return a.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},r.exports=n},{"../utils":32}],19:[function(t,r,s){var a=t("./Uint8ArrayReader");function n(o){a.call(this,o)}t("../utils").inherits(n,a),n.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=n},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,r,s){var a=t("./DataReader");function n(o){a.call(this,o)}t("../utils").inherits(n,a),n.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},n.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},n.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},n.prototype.readData=function(o){this.checkOffset(o);var l=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=n},{"../utils":32,"./DataReader":18}],21:[function(t,r,s){var a=t("./ArrayReader");function n(o){a.call(this,o)}t("../utils").inherits(n,a),n.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,l},r.exports=n},{"../utils":32,"./ArrayReader":17}],22:[function(t,r,s){var a=t("../utils"),n=t("../support"),o=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");r.exports=function(u){var d=a.getTypeOf(u);return a.checkSupport(d),d!=="string"||n.uint8array?d==="nodebuffer"?new c(u):n.uint8array?new h(a.transformTo("uint8array",u)):new o(a.transformTo("array",u)):new l(u)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,r,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,r,s){var a=t("./GenericWorker"),n=t("../utils");function o(l){a.call(this,"ConvertWorker to "+l),this.destType=l}n.inherits(o,a),o.prototype.processChunk=function(l){this.push({data:n.transformTo(this.destType,l.data),meta:l.meta})},r.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(t,r,s){var a=t("./GenericWorker"),n=t("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(o,a),o.prototype.processChunk=function(l){this.streamInfo.crc32=n(l.data,this.streamInfo.crc32||0),this.push(l)},r.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,r,s){var a=t("../utils"),n=t("./GenericWorker");function o(l){n.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}a.inherits(o,n),o.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}n.prototype.processChunk.call(this,l)},r.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(t,r,s){var a=t("../utils"),n=t("./GenericWorker");function o(l){n.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(h){c.dataIsReady=!0,c.data=h,c.max=h&&h.length||0,c.type=a.getTypeOf(h),c.isPaused||c._tickAndRepeat()},function(h){c.error(h)})}a.inherits(o,n),o.prototype.cleanUp=function(){n.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!n.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(t,r,s){function a(n){this.name=n||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(n){this.emit("data",n)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(n){this.emit("error",n)}return!0},error:function(n){return!this.isFinished&&(this.isPaused?this.generatedError=n:(this.isFinished=!0,this.emit("error",n),this.previous&&this.previous.error(n),this.cleanUp()),!0)},on:function(n,o){return this._listeners[n].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(n,o){if(this._listeners[n])for(var l=0;l<this._listeners[n].length;l++)this._listeners[n][l].call(this,o)},pipe:function(n){return n.registerPrevious(this)},registerPrevious:function(n){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=n.streamInfo,this.mergeStreamInfo(),this.previous=n;var o=this;return n.on("data",function(l){o.processChunk(l)}),n.on("end",function(){o.end()}),n.on("error",function(l){o.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var n=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),n=!0),this.previous&&this.previous.resume(),!n},flush:function(){},processChunk:function(n){this.push(n)},withStreamInfo:function(n,o){return this.extraStreamInfo[n]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var n in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,n)&&(this.streamInfo[n]=this.extraStreamInfo[n])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var n="Worker "+this.name;return this.previous?this.previous+" -> "+n:n}},r.exports=a},{}],29:[function(t,r,s){var a=t("../utils"),n=t("./ConvertWorker"),o=t("./GenericWorker"),l=t("../base64"),c=t("../support"),h=t("../external"),u=null;if(c.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(f,g){return new h.Promise(function(m,v){var _=[],y=f._internalType,x=f._outputType,b=f._mimeType;f.on("data",function(M,T){_.push(M),g&&g(T)}).on("error",function(M){_=[],v(M)}).on("end",function(){try{var M=function(T,A,L){switch(T){case"blob":return a.newBlob(a.transformTo("arraybuffer",A),L);case"base64":return l.encode(A);default:return a.transformTo(T,A)}}(x,function(T,A){var L,U=0,P=null,E=0;for(L=0;L<A.length;L++)E+=A[L].length;switch(T){case"string":return A.join("");case"array":return Array.prototype.concat.apply([],A);case"uint8array":for(P=new Uint8Array(E),L=0;L<A.length;L++)P.set(A[L],U),U+=A[L].length;return P;case"nodebuffer":return Buffer.concat(A);default:throw new Error("concat : unsupported type '"+T+"'")}}(y,_),b);m(M)}catch(T){v(T)}_=[]}).resume()})}function p(f,g,m){var v=g;switch(g){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=g,this._mimeType=m,a.checkSupport(v),this._worker=f.pipe(new n(v)),f.lock()}catch(_){this._worker=new o("error"),this._worker.error(_)}}p.prototype={accumulate:function(f){return d(this,f)},on:function(f,g){var m=this;return f==="data"?this._worker.on(f,function(v){g.call(m,v.data,v.meta)}):this._worker.on(f,function(){a.delay(g,arguments,m)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(f){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:this._outputType!=="nodebuffer"},f)}},r.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,r,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var a=new ArrayBuffer(0);try{s.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(a),s.blob=n.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!t("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(t,r,s){for(var a=t("./utils"),n=t("./support"),o=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;c[254]=c[254]=1;function u(){l.call(this,"utf-8 decode"),this.leftOver=null}function d(){l.call(this,"utf-8 encode")}s.utf8encode=function(p){return n.nodebuffer?o.newBufferFrom(p,"utf-8"):function(f){var g,m,v,_,y,x=f.length,b=0;for(_=0;_<x;_++)(64512&(m=f.charCodeAt(_)))==55296&&_+1<x&&(64512&(v=f.charCodeAt(_+1)))==56320&&(m=65536+(m-55296<<10)+(v-56320),_++),b+=m<128?1:m<2048?2:m<65536?3:4;for(g=n.uint8array?new Uint8Array(b):new Array(b),_=y=0;y<b;_++)(64512&(m=f.charCodeAt(_)))==55296&&_+1<x&&(64512&(v=f.charCodeAt(_+1)))==56320&&(m=65536+(m-55296<<10)+(v-56320),_++),m<128?g[y++]=m:(m<2048?g[y++]=192|m>>>6:(m<65536?g[y++]=224|m>>>12:(g[y++]=240|m>>>18,g[y++]=128|m>>>12&63),g[y++]=128|m>>>6&63),g[y++]=128|63&m);return g}(p)},s.utf8decode=function(p){return n.nodebuffer?a.transformTo("nodebuffer",p).toString("utf-8"):function(f){var g,m,v,_,y=f.length,x=new Array(2*y);for(g=m=0;g<y;)if((v=f[g++])<128)x[m++]=v;else if(4<(_=c[v]))x[m++]=65533,g+=_-1;else{for(v&=_===2?31:_===3?15:7;1<_&&g<y;)v=v<<6|63&f[g++],_--;1<_?x[m++]=65533:v<65536?x[m++]=v:(v-=65536,x[m++]=55296|v>>10&1023,x[m++]=56320|1023&v)}return x.length!==m&&(x.subarray?x=x.subarray(0,m):x.length=m),a.applyFromCharCode(x)}(p=a.transformTo(n.uint8array?"uint8array":"array",p))},a.inherits(u,l),u.prototype.processChunk=function(p){var f=a.transformTo(n.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(n.uint8array){var g=f;(f=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),f.set(g,this.leftOver.length)}else f=this.leftOver.concat(f);this.leftOver=null}var m=function(_,y){var x;for((y=y||_.length)>_.length&&(y=_.length),x=y-1;0<=x&&(192&_[x])==128;)x--;return x<0||x===0?y:x+c[_[x]]>y?x:y}(f),v=f;m!==f.length&&(n.uint8array?(v=f.subarray(0,m),this.leftOver=f.subarray(m,f.length)):(v=f.slice(0,m),this.leftOver=f.slice(m,f.length))),this.push({data:s.utf8decode(v),meta:p.meta})},u.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=u,a.inherits(d,l),d.prototype.processChunk=function(p){this.push({data:s.utf8encode(p.data),meta:p.meta})},s.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,r,s){var a=t("./support"),n=t("./base64"),o=t("./nodejsUtils"),l=t("./external");function c(g){return g}function h(g,m){for(var v=0;v<g.length;++v)m[v]=255&g.charCodeAt(v);return m}t("setimmediate"),s.newBlob=function(g,m){s.checkSupport("blob");try{return new Blob([g],{type:m})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(g),v.getBlob(m)}catch{throw new Error("Bug : can't construct the Blob.")}}};var u={stringifyByChunk:function(g,m,v){var _=[],y=0,x=g.length;if(x<=v)return String.fromCharCode.apply(null,g);for(;y<x;)m==="array"||m==="nodebuffer"?_.push(String.fromCharCode.apply(null,g.slice(y,Math.min(y+v,x)))):_.push(String.fromCharCode.apply(null,g.subarray(y,Math.min(y+v,x)))),y+=v;return _.join("")},stringifyByChar:function(g){for(var m="",v=0;v<g.length;v++)m+=String.fromCharCode(g[v]);return m},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}}()}};function d(g){var m=65536,v=s.getTypeOf(g),_=!0;if(v==="uint8array"?_=u.applyCanBeUsed.uint8array:v==="nodebuffer"&&(_=u.applyCanBeUsed.nodebuffer),_)for(;1<m;)try{return u.stringifyByChunk(g,v,m)}catch{m=Math.floor(m/2)}return u.stringifyByChar(g)}function p(g,m){for(var v=0;v<g.length;v++)m[v]=g[v];return m}s.applyFromCharCode=d;var f={};f.string={string:c,array:function(g){return h(g,new Array(g.length))},arraybuffer:function(g){return f.string.uint8array(g).buffer},uint8array:function(g){return h(g,new Uint8Array(g.length))},nodebuffer:function(g){return h(g,o.allocBuffer(g.length))}},f.array={string:d,array:c,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(g)}},f.arraybuffer={string:function(g){return d(new Uint8Array(g))},array:function(g){return p(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:c,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(new Uint8Array(g))}},f.uint8array={string:d,array:function(g){return p(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:c,nodebuffer:function(g){return o.newBufferFrom(g)}},f.nodebuffer={string:d,array:function(g){return p(g,new Array(g.length))},arraybuffer:function(g){return f.nodebuffer.uint8array(g).buffer},uint8array:function(g){return p(g,new Uint8Array(g.length))},nodebuffer:c},s.transformTo=function(g,m){if(m=m||"",!g)return m;s.checkSupport(g);var v=s.getTypeOf(m);return f[v][g](m)},s.resolve=function(g){for(var m=g.split("/"),v=[],_=0;_<m.length;_++){var y=m[_];y==="."||y===""&&_!==0&&_!==m.length-1||(y===".."?v.pop():v.push(y))}return v.join("/")},s.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(g)?"nodebuffer":a.uint8array&&g instanceof Uint8Array?"uint8array":a.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(g){if(!a[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(g){var m,v,_="";for(v=0;v<(g||"").length;v++)_+="\\x"+((m=g.charCodeAt(v))<16?"0":"")+m.toString(16).toUpperCase();return _},s.delay=function(g,m,v){setImmediate(function(){g.apply(v||null,m||[])})},s.inherits=function(g,m){function v(){}v.prototype=m.prototype,g.prototype=new v},s.extend=function(){var g,m,v={};for(g=0;g<arguments.length;g++)for(m in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],m)&&v[m]===void 0&&(v[m]=arguments[g][m]);return v},s.prepareContent=function(g,m,v,_,y){return l.Promise.resolve(m).then(function(x){return a.blob&&(x instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(x))!==-1)&&typeof FileReader<"u"?new l.Promise(function(b,M){var T=new FileReader;T.onload=function(A){b(A.target.result)},T.onerror=function(A){M(A.target.error)},T.readAsArrayBuffer(x)}):x}).then(function(x){var b=s.getTypeOf(x);return b?(b==="arraybuffer"?x=s.transformTo("uint8array",x):b==="string"&&(y?x=n.decode(x):v&&_!==!0&&(x=function(M){return h(M,a.uint8array?new Uint8Array(M.length):new Array(M.length))}(x))),x):l.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,r,s){var a=t("./reader/readerFor"),n=t("./utils"),o=t("./signature"),l=t("./zipEntry"),c=t("./support");function h(u){this.files=[],this.loadOptions=u}h.prototype={checkSignature:function(u){if(!this.reader.readAndCheckSignature(u)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+n.pretty(d)+", expected "+n.pretty(u)+")")}},isSignature:function(u,d){var p=this.reader.index;this.reader.setIndex(u);var f=this.reader.readString(4)===d;return this.reader.setIndex(p),f},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var u=this.reader.readData(this.zipCommentLength),d=c.uint8array?"uint8array":"array",p=n.transformTo(d,u);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var u,d,p,f=this.zip64EndOfCentralSize-44;0<f;)u=this.reader.readInt(2),d=this.reader.readInt(4),p=this.reader.readData(d),this.zip64ExtensibleData[u]={id:u,length:d,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var u,d;for(u=0;u<this.files.length;u++)d=this.files[u],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var u;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(u=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(u);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var u=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(u<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(u);var d=u;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===n.MAX_VALUE_16BITS||this.diskWithCentralDirStart===n.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===n.MAX_VALUE_16BITS||this.centralDirRecords===n.MAX_VALUE_16BITS||this.centralDirSize===n.MAX_VALUE_32BITS||this.centralDirOffset===n.MAX_VALUE_32BITS){if(this.zip64=!0,(u=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(u),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var f=d-p;if(0<f)this.isSignature(d,o.CENTRAL_FILE_HEADER)||(this.reader.zero=f);else if(f<0)throw new Error("Corrupted zip: missing "+Math.abs(f)+" bytes.")},prepareReader:function(u){this.reader=a(u)},load:function(u){this.prepareReader(u),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,r,s){var a=t("./reader/readerFor"),n=t("./utils"),o=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),h=t("./compressions"),u=t("./support");function d(p,f){this.options=p,this.loadOptions=f}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var f,g;if(p.skip(22),this.fileNameLength=p.readInt(2),g=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((f=function(m){for(var v in h)if(Object.prototype.hasOwnProperty.call(h,v)&&h[v].magic===m)return h[v];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+n.pretty(this.compressionMethod)+" unknown (inner file : "+n.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,f,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var f=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(f),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=a(this.extraFields[1].value);this.uncompressedSize===n.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===n.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===n.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===n.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var f,g,m,v=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<v;)f=p.readInt(2),g=p.readInt(2),m=p.readData(g),this.extraFields[f]={id:f,length:g,value:m};p.setIndex(v)},handleUTF8:function(){var p=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var f=this.findExtraFieldUnicodePath();if(f!==null)this.fileNameStr=f;else{var g=n.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var m=this.findExtraFieldUnicodeComment();if(m!==null)this.fileCommentStr=m;else{var v=n.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var f=a(p.value);return f.readInt(1)!==1||l(this.fileName)!==f.readInt(4)?null:c.utf8decode(f.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var f=a(p.value);return f.readInt(1)!==1||l(this.fileComment)!==f.readInt(4)?null:c.utf8decode(f.readData(p.length-5))}return null}},r.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,r,s){function a(f,g,m){this.name=f,this.dir=m.dir,this.date=m.date,this.comment=m.comment,this.unixPermissions=m.unixPermissions,this.dosPermissions=m.dosPermissions,this._data=g,this._dataBinary=m.binary,this.options={compression:m.compression,compressionOptions:m.compressionOptions}}var n=t("./stream/StreamHelper"),o=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),h=t("./stream/GenericWorker");a.prototype={internalStream:function(f){var g=null,m="string";try{if(!f)throw new Error("No output type specified.");var v=(m=f.toLowerCase())==="string"||m==="text";m!=="binarystring"&&m!=="text"||(m="string"),g=this._decompressWorker();var _=!this._dataBinary;_&&!v&&(g=g.pipe(new l.Utf8EncodeWorker)),!_&&v&&(g=g.pipe(new l.Utf8DecodeWorker))}catch(y){(g=new h("error")).error(y)}return new n(g,m,"")},async:function(f,g){return this.internalStream(f).accumulate(g)},nodeStream:function(f,g){return this.internalStream(f||"nodebuffer").toNodejsStream(g)},_compressWorker:function(f,g){if(this._data instanceof c&&this._data.compression.magic===f.magic)return this._data.getCompressedWorker();var m=this._decompressWorker();return this._dataBinary||(m=m.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(m,f,g)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof h?this._data:new o(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<u.length;p++)a.prototype[u[p]]=d;r.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,r,s){(function(a){var n,o,l=a.MutationObserver||a.WebKitMutationObserver;if(l){var c=0,h=new l(f),u=a.document.createTextNode("");h.observe(u,{characterData:!0}),n=function(){u.data=c=++c%2}}else if(a.setImmediate||a.MessageChannel===void 0)n="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var g=a.document.createElement("script");g.onreadystatechange=function(){f(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},a.document.documentElement.appendChild(g)}:function(){setTimeout(f,0)};else{var d=new a.MessageChannel;d.port1.onmessage=f,n=function(){d.port2.postMessage(0)}}var p=[];function f(){var g,m;o=!0;for(var v=p.length;v;){for(m=p,p=[],g=-1;++g<v;)m[g]();v=p.length}o=!1}r.exports=function(g){p.push(g)!==1||o||n()}}).call(this,typeof Sh<"u"?Sh:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,r,s){var a=t("immediate");function n(){}var o={},l=["REJECTED"],c=["FULFILLED"],h=["PENDING"];function u(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,v!==n&&g(this,v)}function d(v,_,y){this.promise=v,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function p(v,_,y){a(function(){var x;try{x=_(y)}catch(b){return o.reject(v,b)}x===v?o.reject(v,new TypeError("Cannot resolve promise with itself")):o.resolve(v,x)})}function f(v){var _=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof _=="function")return function(){_.apply(v,arguments)}}function g(v,_){var y=!1;function x(T){y||(y=!0,o.reject(v,T))}function b(T){y||(y=!0,o.resolve(v,T))}var M=m(function(){_(b,x)});M.status==="error"&&x(M.value)}function m(v,_){var y={};try{y.value=v(_),y.status="success"}catch(x){y.status="error",y.value=x}return y}(r.exports=u).prototype.finally=function(v){if(typeof v!="function")return this;var _=this.constructor;return this.then(function(y){return _.resolve(v()).then(function(){return y})},function(y){return _.resolve(v()).then(function(){throw y})})},u.prototype.catch=function(v){return this.then(null,v)},u.prototype.then=function(v,_){if(typeof v!="function"&&this.state===c||typeof _!="function"&&this.state===l)return this;var y=new this.constructor(n);return this.state!==h?p(y,this.state===c?v:_,this.outcome):this.queue.push(new d(y,v,_)),y},d.prototype.callFulfilled=function(v){o.resolve(this.promise,v)},d.prototype.otherCallFulfilled=function(v){p(this.promise,this.onFulfilled,v)},d.prototype.callRejected=function(v){o.reject(this.promise,v)},d.prototype.otherCallRejected=function(v){p(this.promise,this.onRejected,v)},o.resolve=function(v,_){var y=m(f,_);if(y.status==="error")return o.reject(v,y.value);var x=y.value;if(x)g(v,x);else{v.state=c,v.outcome=_;for(var b=-1,M=v.queue.length;++b<M;)v.queue[b].callFulfilled(_)}return v},o.reject=function(v,_){v.state=l,v.outcome=_;for(var y=-1,x=v.queue.length;++y<x;)v.queue[y].callRejected(_);return v},u.resolve=function(v){return v instanceof this?v:o.resolve(new this(n),v)},u.reject=function(v){var _=new this(n);return o.reject(_,v)},u.all=function(v){var _=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=v.length,x=!1;if(!y)return this.resolve([]);for(var b=new Array(y),M=0,T=-1,A=new this(n);++T<y;)L(v[T],T);return A;function L(U,P){_.resolve(U).then(function(E){b[P]=E,++M!==y||x||(x=!0,o.resolve(A,b))},function(E){x||(x=!0,o.reject(A,E))})}},u.race=function(v){var _=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=v.length,x=!1;if(!y)return this.resolve([]);for(var b=-1,M=new this(n);++b<y;)T=v[b],_.resolve(T).then(function(A){x||(x=!0,o.resolve(M,A))},function(A){x||(x=!0,o.reject(M,A))});var T;return M}},{immediate:36}],38:[function(t,r,s){var a={};(0,t("./lib/utils/common").assign)(a,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),r.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,r,s){var a=t("./zlib/deflate"),n=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),h=Object.prototype.toString,u=0,d=-1,p=0,f=8;function g(v){if(!(this instanceof g))return new g(v);this.options=n.assign({level:d,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},v||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var y=a.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(y!==u)throw new Error(l[y]);if(_.header&&a.deflateSetHeader(this.strm,_.header),_.dictionary){var x;if(x=typeof _.dictionary=="string"?o.string2buf(_.dictionary):h.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(y=a.deflateSetDictionary(this.strm,x))!==u)throw new Error(l[y]);this._dict_set=!0}}function m(v,_){var y=new g(_);if(y.push(v,!0),y.err)throw y.msg||l[y.err];return y.result}g.prototype.push=function(v,_){var y,x,b=this.strm,M=this.options.chunkSize;if(this.ended)return!1;x=_===~~_?_:_===!0?4:0,typeof v=="string"?b.input=o.string2buf(v):h.call(v)==="[object ArrayBuffer]"?b.input=new Uint8Array(v):b.input=v,b.next_in=0,b.avail_in=b.input.length;do{if(b.avail_out===0&&(b.output=new n.Buf8(M),b.next_out=0,b.avail_out=M),(y=a.deflate(b,x))!==1&&y!==u)return this.onEnd(y),!(this.ended=!0);b.avail_out!==0&&(b.avail_in!==0||x!==4&&x!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(n.shrinkBuf(b.output,b.next_out))):this.onData(n.shrinkBuf(b.output,b.next_out)))}while((0<b.avail_in||b.avail_out===0)&&y!==1);return x===4?(y=a.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===u):x!==2||(this.onEnd(u),!(b.avail_out=0))},g.prototype.onData=function(v){this.chunks.push(v)},g.prototype.onEnd=function(v){v===u&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},s.Deflate=g,s.deflate=m,s.deflateRaw=function(v,_){return(_=_||{}).raw=!0,m(v,_)},s.gzip=function(v,_){return(_=_||{}).gzip=!0,m(v,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,r,s){var a=t("./zlib/inflate"),n=t("./utils/common"),o=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),h=t("./zlib/zstream"),u=t("./zlib/gzheader"),d=Object.prototype.toString;function p(g){if(!(this instanceof p))return new p(g);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},g||{});var m=this.options;m.raw&&0<=m.windowBits&&m.windowBits<16&&(m.windowBits=-m.windowBits,m.windowBits===0&&(m.windowBits=-15)),!(0<=m.windowBits&&m.windowBits<16)||g&&g.windowBits||(m.windowBits+=32),15<m.windowBits&&m.windowBits<48&&!(15&m.windowBits)&&(m.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var v=a.inflateInit2(this.strm,m.windowBits);if(v!==l.Z_OK)throw new Error(c[v]);this.header=new u,a.inflateGetHeader(this.strm,this.header)}function f(g,m){var v=new p(m);if(v.push(g,!0),v.err)throw v.msg||c[v.err];return v.result}p.prototype.push=function(g,m){var v,_,y,x,b,M,T=this.strm,A=this.options.chunkSize,L=this.options.dictionary,U=!1;if(this.ended)return!1;_=m===~~m?m:m===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof g=="string"?T.input=o.binstring2buf(g):d.call(g)==="[object ArrayBuffer]"?T.input=new Uint8Array(g):T.input=g,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new n.Buf8(A),T.next_out=0,T.avail_out=A),(v=a.inflate(T,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&L&&(M=typeof L=="string"?o.string2buf(L):d.call(L)==="[object ArrayBuffer]"?new Uint8Array(L):L,v=a.inflateSetDictionary(this.strm,M)),v===l.Z_BUF_ERROR&&U===!0&&(v=l.Z_OK,U=!1),v!==l.Z_STREAM_END&&v!==l.Z_OK)return this.onEnd(v),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&v!==l.Z_STREAM_END&&(T.avail_in!==0||_!==l.Z_FINISH&&_!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=o.utf8border(T.output,T.next_out),x=T.next_out-y,b=o.buf2string(T.output,y),T.next_out=x,T.avail_out=A-x,x&&n.arraySet(T.output,T.output,y,x,0),this.onData(b)):this.onData(n.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(U=!0)}while((0<T.avail_in||T.avail_out===0)&&v!==l.Z_STREAM_END);return v===l.Z_STREAM_END&&(_=l.Z_FINISH),_===l.Z_FINISH?(v=a.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===l.Z_OK):_!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(T.avail_out=0))},p.prototype.onData=function(g){this.chunks.push(g)},p.prototype.onEnd=function(g){g===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},s.Inflate=p,s.inflate=f,s.inflateRaw=function(g,m){return(m=m||{}).raw=!0,f(g,m)},s.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,r,s){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var h=c.shift();if(h){if(typeof h!="object")throw new TypeError(h+"must be non-object");for(var u in h)h.hasOwnProperty(u)&&(l[u]=h[u])}}return l},s.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var n={arraySet:function(l,c,h,u,d){if(c.subarray&&l.subarray)l.set(c.subarray(h,h+u),d);else for(var p=0;p<u;p++)l[d+p]=c[h+p]},flattenChunks:function(l){var c,h,u,d,p,f;for(c=u=0,h=l.length;c<h;c++)u+=l[c].length;for(f=new Uint8Array(u),c=d=0,h=l.length;c<h;c++)p=l[c],f.set(p,d),d+=p.length;return f}},o={arraySet:function(l,c,h,u,d){for(var p=0;p<u;p++)l[d+p]=c[h+p]},flattenChunks:function(l){return[].concat.apply([],l)}};s.setTyped=function(l){l?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,n)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,o))},s.setTyped(a)},{}],42:[function(t,r,s){var a=t("./common"),n=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var l=new a.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function h(u,d){if(d<65537&&(u.subarray&&o||!u.subarray&&n))return String.fromCharCode.apply(null,a.shrinkBuf(u,d));for(var p="",f=0;f<d;f++)p+=String.fromCharCode(u[f]);return p}l[254]=l[254]=1,s.string2buf=function(u){var d,p,f,g,m,v=u.length,_=0;for(g=0;g<v;g++)(64512&(p=u.charCodeAt(g)))==55296&&g+1<v&&(64512&(f=u.charCodeAt(g+1)))==56320&&(p=65536+(p-55296<<10)+(f-56320),g++),_+=p<128?1:p<2048?2:p<65536?3:4;for(d=new a.Buf8(_),g=m=0;m<_;g++)(64512&(p=u.charCodeAt(g)))==55296&&g+1<v&&(64512&(f=u.charCodeAt(g+1)))==56320&&(p=65536+(p-55296<<10)+(f-56320),g++),p<128?d[m++]=p:(p<2048?d[m++]=192|p>>>6:(p<65536?d[m++]=224|p>>>12:(d[m++]=240|p>>>18,d[m++]=128|p>>>12&63),d[m++]=128|p>>>6&63),d[m++]=128|63&p);return d},s.buf2binstring=function(u){return h(u,u.length)},s.binstring2buf=function(u){for(var d=new a.Buf8(u.length),p=0,f=d.length;p<f;p++)d[p]=u.charCodeAt(p);return d},s.buf2string=function(u,d){var p,f,g,m,v=d||u.length,_=new Array(2*v);for(p=f=0;p<v;)if((g=u[p++])<128)_[f++]=g;else if(4<(m=l[g]))_[f++]=65533,p+=m-1;else{for(g&=m===2?31:m===3?15:7;1<m&&p<v;)g=g<<6|63&u[p++],m--;1<m?_[f++]=65533:g<65536?_[f++]=g:(g-=65536,_[f++]=55296|g>>10&1023,_[f++]=56320|1023&g)}return h(_,f)},s.utf8border=function(u,d){var p;for((d=d||u.length)>u.length&&(d=u.length),p=d-1;0<=p&&(192&u[p])==128;)p--;return p<0||p===0?d:p+l[u[p]]>d?p:d}},{"./common":41}],43:[function(t,r,s){r.exports=function(a,n,o,l){for(var c=65535&a|0,h=a>>>16&65535|0,u=0;o!==0;){for(o-=u=2e3<o?2e3:o;h=h+(c=c+n[l++]|0)|0,--u;);c%=65521,h%=65521}return c|h<<16|0}},{}],44:[function(t,r,s){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,r,s){var a=function(){for(var n,o=[],l=0;l<256;l++){n=l;for(var c=0;c<8;c++)n=1&n?3988292384^n>>>1:n>>>1;o[l]=n}return o}();r.exports=function(n,o,l,c){var h=a,u=c+l;n^=-1;for(var d=c;d<u;d++)n=n>>>8^h[255&(n^o[d])];return-1^n}},{}],46:[function(t,r,s){var a,n=t("../utils/common"),o=t("./trees"),l=t("./adler32"),c=t("./crc32"),h=t("./messages"),u=0,d=4,p=0,f=-2,g=-1,m=4,v=2,_=8,y=9,x=286,b=30,M=19,T=2*x+1,A=15,L=3,U=258,P=U+L+1,E=42,I=113,S=1,V=2,J=3,X=4;function te(w,G){return w.msg=h[G],G}function ie(w){return(w<<1)-(4<w?9:0)}function fe(w){for(var G=w.length;0<=--G;)w[G]=0}function B(w){var G=w.state,Z=G.pending;Z>w.avail_out&&(Z=w.avail_out),Z!==0&&(n.arraySet(w.output,G.pending_buf,G.pending_out,Z,w.next_out),w.next_out+=Z,G.pending_out+=Z,w.total_out+=Z,w.avail_out-=Z,G.pending-=Z,G.pending===0&&(G.pending_out=0))}function j(w,G){o._tr_flush_block(w,0<=w.block_start?w.block_start:-1,w.strstart-w.block_start,G),w.block_start=w.strstart,B(w.strm)}function ae(w,G){w.pending_buf[w.pending++]=G}function O(w,G){w.pending_buf[w.pending++]=G>>>8&255,w.pending_buf[w.pending++]=255&G}function D(w,G){var Z,F,R=w.max_chain_length,N=w.strstart,z=w.prev_length,Y=w.nice_match,q=w.strstart>w.w_size-P?w.strstart-(w.w_size-P):0,he=w.window,de=w.w_mask,ue=w.prev,we=w.strstart+U,Ne=he[N+z-1],xe=he[N+z];w.prev_length>=w.good_match&&(R>>=2),Y>w.lookahead&&(Y=w.lookahead);do if(he[(Z=G)+z]===xe&&he[Z+z-1]===Ne&&he[Z]===he[N]&&he[++Z]===he[N+1]){N+=2,Z++;do;while(he[++N]===he[++Z]&&he[++N]===he[++Z]&&he[++N]===he[++Z]&&he[++N]===he[++Z]&&he[++N]===he[++Z]&&he[++N]===he[++Z]&&he[++N]===he[++Z]&&he[++N]===he[++Z]&&N<we);if(F=U-(we-N),N=we-U,z<F){if(w.match_start=G,Y<=(z=F))break;Ne=he[N+z-1],xe=he[N+z]}}while((G=ue[G&de])>q&&--R!=0);return z<=w.lookahead?z:w.lookahead}function ee(w){var G,Z,F,R,N,z,Y,q,he,de,ue=w.w_size;do{if(R=w.window_size-w.lookahead-w.strstart,w.strstart>=ue+(ue-P)){for(n.arraySet(w.window,w.window,ue,ue,0),w.match_start-=ue,w.strstart-=ue,w.block_start-=ue,G=Z=w.hash_size;F=w.head[--G],w.head[G]=ue<=F?F-ue:0,--Z;);for(G=Z=ue;F=w.prev[--G],w.prev[G]=ue<=F?F-ue:0,--Z;);R+=ue}if(w.strm.avail_in===0)break;if(z=w.strm,Y=w.window,q=w.strstart+w.lookahead,he=R,de=void 0,de=z.avail_in,he<de&&(de=he),Z=de===0?0:(z.avail_in-=de,n.arraySet(Y,z.input,z.next_in,de,q),z.state.wrap===1?z.adler=l(z.adler,Y,de,q):z.state.wrap===2&&(z.adler=c(z.adler,Y,de,q)),z.next_in+=de,z.total_in+=de,de),w.lookahead+=Z,w.lookahead+w.insert>=L)for(N=w.strstart-w.insert,w.ins_h=w.window[N],w.ins_h=(w.ins_h<<w.hash_shift^w.window[N+1])&w.hash_mask;w.insert&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[N+L-1])&w.hash_mask,w.prev[N&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=N,N++,w.insert--,!(w.lookahead+w.insert<L)););}while(w.lookahead<P&&w.strm.avail_in!==0)}function ne(w,G){for(var Z,F;;){if(w.lookahead<P){if(ee(w),w.lookahead<P&&G===u)return S;if(w.lookahead===0)break}if(Z=0,w.lookahead>=L&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+L-1])&w.hash_mask,Z=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),Z!==0&&w.strstart-Z<=w.w_size-P&&(w.match_length=D(w,Z)),w.match_length>=L)if(F=o._tr_tally(w,w.strstart-w.match_start,w.match_length-L),w.lookahead-=w.match_length,w.match_length<=w.max_lazy_match&&w.lookahead>=L){for(w.match_length--;w.strstart++,w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+L-1])&w.hash_mask,Z=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart,--w.match_length!=0;);w.strstart++}else w.strstart+=w.match_length,w.match_length=0,w.ins_h=w.window[w.strstart],w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+1])&w.hash_mask;else F=o._tr_tally(w,0,w.window[w.strstart]),w.lookahead--,w.strstart++;if(F&&(j(w,!1),w.strm.avail_out===0))return S}return w.insert=w.strstart<L-1?w.strstart:L-1,G===d?(j(w,!0),w.strm.avail_out===0?J:X):w.last_lit&&(j(w,!1),w.strm.avail_out===0)?S:V}function K(w,G){for(var Z,F,R;;){if(w.lookahead<P){if(ee(w),w.lookahead<P&&G===u)return S;if(w.lookahead===0)break}if(Z=0,w.lookahead>=L&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+L-1])&w.hash_mask,Z=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),w.prev_length=w.match_length,w.prev_match=w.match_start,w.match_length=L-1,Z!==0&&w.prev_length<w.max_lazy_match&&w.strstart-Z<=w.w_size-P&&(w.match_length=D(w,Z),w.match_length<=5&&(w.strategy===1||w.match_length===L&&4096<w.strstart-w.match_start)&&(w.match_length=L-1)),w.prev_length>=L&&w.match_length<=w.prev_length){for(R=w.strstart+w.lookahead-L,F=o._tr_tally(w,w.strstart-1-w.prev_match,w.prev_length-L),w.lookahead-=w.prev_length-1,w.prev_length-=2;++w.strstart<=R&&(w.ins_h=(w.ins_h<<w.hash_shift^w.window[w.strstart+L-1])&w.hash_mask,Z=w.prev[w.strstart&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=w.strstart),--w.prev_length!=0;);if(w.match_available=0,w.match_length=L-1,w.strstart++,F&&(j(w,!1),w.strm.avail_out===0))return S}else if(w.match_available){if((F=o._tr_tally(w,0,w.window[w.strstart-1]))&&j(w,!1),w.strstart++,w.lookahead--,w.strm.avail_out===0)return S}else w.match_available=1,w.strstart++,w.lookahead--}return w.match_available&&(F=o._tr_tally(w,0,w.window[w.strstart-1]),w.match_available=0),w.insert=w.strstart<L-1?w.strstart:L-1,G===d?(j(w,!0),w.strm.avail_out===0?J:X):w.last_lit&&(j(w,!1),w.strm.avail_out===0)?S:V}function W(w,G,Z,F,R){this.good_length=w,this.max_lazy=G,this.nice_length=Z,this.max_chain=F,this.func=R}function $(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*T),this.dyn_dtree=new n.Buf16(2*(2*b+1)),this.bl_tree=new n.Buf16(2*(2*M+1)),fe(this.dyn_ltree),fe(this.dyn_dtree),fe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(A+1),this.heap=new n.Buf16(2*x+1),fe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*x+1),fe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function k(w){var G;return w&&w.state?(w.total_in=w.total_out=0,w.data_type=v,(G=w.state).pending=0,G.pending_out=0,G.wrap<0&&(G.wrap=-G.wrap),G.status=G.wrap?E:I,w.adler=G.wrap===2?0:1,G.last_flush=u,o._tr_init(G),p):te(w,f)}function Q(w){var G=k(w);return G===p&&function(Z){Z.window_size=2*Z.w_size,fe(Z.head),Z.max_lazy_match=a[Z.level].max_lazy,Z.good_match=a[Z.level].good_length,Z.nice_match=a[Z.level].nice_length,Z.max_chain_length=a[Z.level].max_chain,Z.strstart=0,Z.block_start=0,Z.lookahead=0,Z.insert=0,Z.match_length=Z.prev_length=L-1,Z.match_available=0,Z.ins_h=0}(w.state),G}function re(w,G,Z,F,R,N){if(!w)return f;var z=1;if(G===g&&(G=6),F<0?(z=0,F=-F):15<F&&(z=2,F-=16),R<1||y<R||Z!==_||F<8||15<F||G<0||9<G||N<0||m<N)return te(w,f);F===8&&(F=9);var Y=new $;return(w.state=Y).strm=w,Y.wrap=z,Y.gzhead=null,Y.w_bits=F,Y.w_size=1<<Y.w_bits,Y.w_mask=Y.w_size-1,Y.hash_bits=R+7,Y.hash_size=1<<Y.hash_bits,Y.hash_mask=Y.hash_size-1,Y.hash_shift=~~((Y.hash_bits+L-1)/L),Y.window=new n.Buf8(2*Y.w_size),Y.head=new n.Buf16(Y.hash_size),Y.prev=new n.Buf16(Y.w_size),Y.lit_bufsize=1<<R+6,Y.pending_buf_size=4*Y.lit_bufsize,Y.pending_buf=new n.Buf8(Y.pending_buf_size),Y.d_buf=1*Y.lit_bufsize,Y.l_buf=3*Y.lit_bufsize,Y.level=G,Y.strategy=N,Y.method=Z,Q(w)}a=[new W(0,0,0,0,function(w,G){var Z=65535;for(Z>w.pending_buf_size-5&&(Z=w.pending_buf_size-5);;){if(w.lookahead<=1){if(ee(w),w.lookahead===0&&G===u)return S;if(w.lookahead===0)break}w.strstart+=w.lookahead,w.lookahead=0;var F=w.block_start+Z;if((w.strstart===0||w.strstart>=F)&&(w.lookahead=w.strstart-F,w.strstart=F,j(w,!1),w.strm.avail_out===0)||w.strstart-w.block_start>=w.w_size-P&&(j(w,!1),w.strm.avail_out===0))return S}return w.insert=0,G===d?(j(w,!0),w.strm.avail_out===0?J:X):(w.strstart>w.block_start&&(j(w,!1),w.strm.avail_out),S)}),new W(4,4,8,4,ne),new W(4,5,16,8,ne),new W(4,6,32,32,ne),new W(4,4,16,16,K),new W(8,16,32,32,K),new W(8,16,128,128,K),new W(8,32,128,256,K),new W(32,128,258,1024,K),new W(32,258,258,4096,K)],s.deflateInit=function(w,G){return re(w,G,_,15,8,0)},s.deflateInit2=re,s.deflateReset=Q,s.deflateResetKeep=k,s.deflateSetHeader=function(w,G){return w&&w.state?w.state.wrap!==2?f:(w.state.gzhead=G,p):f},s.deflate=function(w,G){var Z,F,R,N;if(!w||!w.state||5<G||G<0)return w?te(w,f):f;if(F=w.state,!w.output||!w.input&&w.avail_in!==0||F.status===666&&G!==d)return te(w,w.avail_out===0?-5:f);if(F.strm=w,Z=F.last_flush,F.last_flush=G,F.status===E)if(F.wrap===2)w.adler=0,ae(F,31),ae(F,139),ae(F,8),F.gzhead?(ae(F,(F.gzhead.text?1:0)+(F.gzhead.hcrc?2:0)+(F.gzhead.extra?4:0)+(F.gzhead.name?8:0)+(F.gzhead.comment?16:0)),ae(F,255&F.gzhead.time),ae(F,F.gzhead.time>>8&255),ae(F,F.gzhead.time>>16&255),ae(F,F.gzhead.time>>24&255),ae(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),ae(F,255&F.gzhead.os),F.gzhead.extra&&F.gzhead.extra.length&&(ae(F,255&F.gzhead.extra.length),ae(F,F.gzhead.extra.length>>8&255)),F.gzhead.hcrc&&(w.adler=c(w.adler,F.pending_buf,F.pending,0)),F.gzindex=0,F.status=69):(ae(F,0),ae(F,0),ae(F,0),ae(F,0),ae(F,0),ae(F,F.level===9?2:2<=F.strategy||F.level<2?4:0),ae(F,3),F.status=I);else{var z=_+(F.w_bits-8<<4)<<8;z|=(2<=F.strategy||F.level<2?0:F.level<6?1:F.level===6?2:3)<<6,F.strstart!==0&&(z|=32),z+=31-z%31,F.status=I,O(F,z),F.strstart!==0&&(O(F,w.adler>>>16),O(F,65535&w.adler)),w.adler=1}if(F.status===69)if(F.gzhead.extra){for(R=F.pending;F.gzindex<(65535&F.gzhead.extra.length)&&(F.pending!==F.pending_buf_size||(F.gzhead.hcrc&&F.pending>R&&(w.adler=c(w.adler,F.pending_buf,F.pending-R,R)),B(w),R=F.pending,F.pending!==F.pending_buf_size));)ae(F,255&F.gzhead.extra[F.gzindex]),F.gzindex++;F.gzhead.hcrc&&F.pending>R&&(w.adler=c(w.adler,F.pending_buf,F.pending-R,R)),F.gzindex===F.gzhead.extra.length&&(F.gzindex=0,F.status=73)}else F.status=73;if(F.status===73)if(F.gzhead.name){R=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>R&&(w.adler=c(w.adler,F.pending_buf,F.pending-R,R)),B(w),R=F.pending,F.pending===F.pending_buf_size)){N=1;break}N=F.gzindex<F.gzhead.name.length?255&F.gzhead.name.charCodeAt(F.gzindex++):0,ae(F,N)}while(N!==0);F.gzhead.hcrc&&F.pending>R&&(w.adler=c(w.adler,F.pending_buf,F.pending-R,R)),N===0&&(F.gzindex=0,F.status=91)}else F.status=91;if(F.status===91)if(F.gzhead.comment){R=F.pending;do{if(F.pending===F.pending_buf_size&&(F.gzhead.hcrc&&F.pending>R&&(w.adler=c(w.adler,F.pending_buf,F.pending-R,R)),B(w),R=F.pending,F.pending===F.pending_buf_size)){N=1;break}N=F.gzindex<F.gzhead.comment.length?255&F.gzhead.comment.charCodeAt(F.gzindex++):0,ae(F,N)}while(N!==0);F.gzhead.hcrc&&F.pending>R&&(w.adler=c(w.adler,F.pending_buf,F.pending-R,R)),N===0&&(F.status=103)}else F.status=103;if(F.status===103&&(F.gzhead.hcrc?(F.pending+2>F.pending_buf_size&&B(w),F.pending+2<=F.pending_buf_size&&(ae(F,255&w.adler),ae(F,w.adler>>8&255),w.adler=0,F.status=I)):F.status=I),F.pending!==0){if(B(w),w.avail_out===0)return F.last_flush=-1,p}else if(w.avail_in===0&&ie(G)<=ie(Z)&&G!==d)return te(w,-5);if(F.status===666&&w.avail_in!==0)return te(w,-5);if(w.avail_in!==0||F.lookahead!==0||G!==u&&F.status!==666){var Y=F.strategy===2?function(q,he){for(var de;;){if(q.lookahead===0&&(ee(q),q.lookahead===0)){if(he===u)return S;break}if(q.match_length=0,de=o._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++,de&&(j(q,!1),q.strm.avail_out===0))return S}return q.insert=0,he===d?(j(q,!0),q.strm.avail_out===0?J:X):q.last_lit&&(j(q,!1),q.strm.avail_out===0)?S:V}(F,G):F.strategy===3?function(q,he){for(var de,ue,we,Ne,xe=q.window;;){if(q.lookahead<=U){if(ee(q),q.lookahead<=U&&he===u)return S;if(q.lookahead===0)break}if(q.match_length=0,q.lookahead>=L&&0<q.strstart&&(ue=xe[we=q.strstart-1])===xe[++we]&&ue===xe[++we]&&ue===xe[++we]){Ne=q.strstart+U;do;while(ue===xe[++we]&&ue===xe[++we]&&ue===xe[++we]&&ue===xe[++we]&&ue===xe[++we]&&ue===xe[++we]&&ue===xe[++we]&&ue===xe[++we]&&we<Ne);q.match_length=U-(Ne-we),q.match_length>q.lookahead&&(q.match_length=q.lookahead)}if(q.match_length>=L?(de=o._tr_tally(q,1,q.match_length-L),q.lookahead-=q.match_length,q.strstart+=q.match_length,q.match_length=0):(de=o._tr_tally(q,0,q.window[q.strstart]),q.lookahead--,q.strstart++),de&&(j(q,!1),q.strm.avail_out===0))return S}return q.insert=0,he===d?(j(q,!0),q.strm.avail_out===0?J:X):q.last_lit&&(j(q,!1),q.strm.avail_out===0)?S:V}(F,G):a[F.level].func(F,G);if(Y!==J&&Y!==X||(F.status=666),Y===S||Y===J)return w.avail_out===0&&(F.last_flush=-1),p;if(Y===V&&(G===1?o._tr_align(F):G!==5&&(o._tr_stored_block(F,0,0,!1),G===3&&(fe(F.head),F.lookahead===0&&(F.strstart=0,F.block_start=0,F.insert=0))),B(w),w.avail_out===0))return F.last_flush=-1,p}return G!==d?p:F.wrap<=0?1:(F.wrap===2?(ae(F,255&w.adler),ae(F,w.adler>>8&255),ae(F,w.adler>>16&255),ae(F,w.adler>>24&255),ae(F,255&w.total_in),ae(F,w.total_in>>8&255),ae(F,w.total_in>>16&255),ae(F,w.total_in>>24&255)):(O(F,w.adler>>>16),O(F,65535&w.adler)),B(w),0<F.wrap&&(F.wrap=-F.wrap),F.pending!==0?p:1)},s.deflateEnd=function(w){var G;return w&&w.state?(G=w.state.status)!==E&&G!==69&&G!==73&&G!==91&&G!==103&&G!==I&&G!==666?te(w,f):(w.state=null,G===I?te(w,-3):p):f},s.deflateSetDictionary=function(w,G){var Z,F,R,N,z,Y,q,he,de=G.length;if(!w||!w.state||(N=(Z=w.state).wrap)===2||N===1&&Z.status!==E||Z.lookahead)return f;for(N===1&&(w.adler=l(w.adler,G,de,0)),Z.wrap=0,de>=Z.w_size&&(N===0&&(fe(Z.head),Z.strstart=0,Z.block_start=0,Z.insert=0),he=new n.Buf8(Z.w_size),n.arraySet(he,G,de-Z.w_size,Z.w_size,0),G=he,de=Z.w_size),z=w.avail_in,Y=w.next_in,q=w.input,w.avail_in=de,w.next_in=0,w.input=G,ee(Z);Z.lookahead>=L;){for(F=Z.strstart,R=Z.lookahead-(L-1);Z.ins_h=(Z.ins_h<<Z.hash_shift^Z.window[F+L-1])&Z.hash_mask,Z.prev[F&Z.w_mask]=Z.head[Z.ins_h],Z.head[Z.ins_h]=F,F++,--R;);Z.strstart=F,Z.lookahead=L-1,ee(Z)}return Z.strstart+=Z.lookahead,Z.block_start=Z.strstart,Z.insert=Z.lookahead,Z.lookahead=0,Z.match_length=Z.prev_length=L-1,Z.match_available=0,w.next_in=Y,w.input=q,w.avail_in=z,Z.wrap=N,p},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,r,s){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,r,s){r.exports=function(a,n){var o,l,c,h,u,d,p,f,g,m,v,_,y,x,b,M,T,A,L,U,P,E,I,S,V;o=a.state,l=a.next_in,S=a.input,c=l+(a.avail_in-5),h=a.next_out,V=a.output,u=h-(n-a.avail_out),d=h+(a.avail_out-257),p=o.dmax,f=o.wsize,g=o.whave,m=o.wnext,v=o.window,_=o.hold,y=o.bits,x=o.lencode,b=o.distcode,M=(1<<o.lenbits)-1,T=(1<<o.distbits)-1;e:do{y<15&&(_+=S[l++]<<y,y+=8,_+=S[l++]<<y,y+=8),A=x[_&M];t:for(;;){if(_>>>=L=A>>>24,y-=L,(L=A>>>16&255)===0)V[h++]=65535&A;else{if(!(16&L)){if(!(64&L)){A=x[(65535&A)+(_&(1<<L)-1)];continue t}if(32&L){o.mode=12;break e}a.msg="invalid literal/length code",o.mode=30;break e}U=65535&A,(L&=15)&&(y<L&&(_+=S[l++]<<y,y+=8),U+=_&(1<<L)-1,_>>>=L,y-=L),y<15&&(_+=S[l++]<<y,y+=8,_+=S[l++]<<y,y+=8),A=b[_&T];i:for(;;){if(_>>>=L=A>>>24,y-=L,!(16&(L=A>>>16&255))){if(!(64&L)){A=b[(65535&A)+(_&(1<<L)-1)];continue i}a.msg="invalid distance code",o.mode=30;break e}if(P=65535&A,y<(L&=15)&&(_+=S[l++]<<y,(y+=8)<L&&(_+=S[l++]<<y,y+=8)),p<(P+=_&(1<<L)-1)){a.msg="invalid distance too far back",o.mode=30;break e}if(_>>>=L,y-=L,(L=h-u)<P){if(g<(L=P-L)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break e}if(I=v,(E=0)===m){if(E+=f-L,L<U){for(U-=L;V[h++]=v[E++],--L;);E=h-P,I=V}}else if(m<L){if(E+=f+m-L,(L-=m)<U){for(U-=L;V[h++]=v[E++],--L;);if(E=0,m<U){for(U-=L=m;V[h++]=v[E++],--L;);E=h-P,I=V}}}else if(E+=m-L,L<U){for(U-=L;V[h++]=v[E++],--L;);E=h-P,I=V}for(;2<U;)V[h++]=I[E++],V[h++]=I[E++],V[h++]=I[E++],U-=3;U&&(V[h++]=I[E++],1<U&&(V[h++]=I[E++]))}else{for(E=h-P;V[h++]=V[E++],V[h++]=V[E++],V[h++]=V[E++],2<(U-=3););U&&(V[h++]=V[E++],1<U&&(V[h++]=V[E++]))}break}}break}}while(l<c&&h<d);l-=U=y>>3,_&=(1<<(y-=U<<3))-1,a.next_in=l,a.next_out=h,a.avail_in=l<c?c-l+5:5-(l-c),a.avail_out=h<d?d-h+257:257-(h-d),o.hold=_,o.bits=y}},{}],49:[function(t,r,s){var a=t("../utils/common"),n=t("./adler32"),o=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),h=1,u=2,d=0,p=-2,f=1,g=852,m=592;function v(E){return(E>>>24&255)+(E>>>8&65280)+((65280&E)<<8)+((255&E)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(E){var I;return E&&E.state?(I=E.state,E.total_in=E.total_out=I.total=0,E.msg="",I.wrap&&(E.adler=1&I.wrap),I.mode=f,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new a.Buf32(g),I.distcode=I.distdyn=new a.Buf32(m),I.sane=1,I.back=-1,d):p}function x(E){var I;return E&&E.state?((I=E.state).wsize=0,I.whave=0,I.wnext=0,y(E)):p}function b(E,I){var S,V;return E&&E.state?(V=E.state,I<0?(S=0,I=-I):(S=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?p:(V.window!==null&&V.wbits!==I&&(V.window=null),V.wrap=S,V.wbits=I,x(E))):p}function M(E,I){var S,V;return E?(V=new _,(E.state=V).window=null,(S=b(E,I))!==d&&(E.state=null),S):p}var T,A,L=!0;function U(E){if(L){var I;for(T=new a.Buf32(512),A=new a.Buf32(32),I=0;I<144;)E.lens[I++]=8;for(;I<256;)E.lens[I++]=9;for(;I<280;)E.lens[I++]=7;for(;I<288;)E.lens[I++]=8;for(c(h,E.lens,0,288,T,0,E.work,{bits:9}),I=0;I<32;)E.lens[I++]=5;c(u,E.lens,0,32,A,0,E.work,{bits:5}),L=!1}E.lencode=T,E.lenbits=9,E.distcode=A,E.distbits=5}function P(E,I,S,V){var J,X=E.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new a.Buf8(X.wsize)),V>=X.wsize?(a.arraySet(X.window,I,S-X.wsize,X.wsize,0),X.wnext=0,X.whave=X.wsize):(V<(J=X.wsize-X.wnext)&&(J=V),a.arraySet(X.window,I,S-V,J,X.wnext),(V-=J)?(a.arraySet(X.window,I,S-V,V,0),X.wnext=V,X.whave=X.wsize):(X.wnext+=J,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=J))),0}s.inflateReset=x,s.inflateReset2=b,s.inflateResetKeep=y,s.inflateInit=function(E){return M(E,15)},s.inflateInit2=M,s.inflate=function(E,I){var S,V,J,X,te,ie,fe,B,j,ae,O,D,ee,ne,K,W,$,k,Q,re,w,G,Z,F,R=0,N=new a.Buf8(4),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!E||!E.state||!E.output||!E.input&&E.avail_in!==0)return p;(S=E.state).mode===12&&(S.mode=13),te=E.next_out,J=E.output,fe=E.avail_out,X=E.next_in,V=E.input,ie=E.avail_in,B=S.hold,j=S.bits,ae=ie,O=fe,G=d;e:for(;;)switch(S.mode){case f:if(S.wrap===0){S.mode=13;break}for(;j<16;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if(2&S.wrap&&B===35615){N[S.check=0]=255&B,N[1]=B>>>8&255,S.check=o(S.check,N,2,0),j=B=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&B)<<8)+(B>>8))%31){E.msg="incorrect header check",S.mode=30;break}if((15&B)!=8){E.msg="unknown compression method",S.mode=30;break}if(j-=4,w=8+(15&(B>>>=4)),S.wbits===0)S.wbits=w;else if(w>S.wbits){E.msg="invalid window size",S.mode=30;break}S.dmax=1<<w,E.adler=S.check=1,S.mode=512&B?10:12,j=B=0;break;case 2:for(;j<16;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if(S.flags=B,(255&S.flags)!=8){E.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){E.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=B>>8&1),512&S.flags&&(N[0]=255&B,N[1]=B>>>8&255,S.check=o(S.check,N,2,0)),j=B=0,S.mode=3;case 3:for(;j<32;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}S.head&&(S.head.time=B),512&S.flags&&(N[0]=255&B,N[1]=B>>>8&255,N[2]=B>>>16&255,N[3]=B>>>24&255,S.check=o(S.check,N,4,0)),j=B=0,S.mode=4;case 4:for(;j<16;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}S.head&&(S.head.xflags=255&B,S.head.os=B>>8),512&S.flags&&(N[0]=255&B,N[1]=B>>>8&255,S.check=o(S.check,N,2,0)),j=B=0,S.mode=5;case 5:if(1024&S.flags){for(;j<16;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}S.length=B,S.head&&(S.head.extra_len=B),512&S.flags&&(N[0]=255&B,N[1]=B>>>8&255,S.check=o(S.check,N,2,0)),j=B=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(ie<(D=S.length)&&(D=ie),D&&(S.head&&(w=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),a.arraySet(S.head.extra,V,X,D,w)),512&S.flags&&(S.check=o(S.check,V,D,X)),ie-=D,X+=D,S.length-=D),S.length))break e;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(ie===0)break e;for(D=0;w=V[X+D++],S.head&&w&&S.length<65536&&(S.head.name+=String.fromCharCode(w)),w&&D<ie;);if(512&S.flags&&(S.check=o(S.check,V,D,X)),ie-=D,X+=D,w)break e}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(ie===0)break e;for(D=0;w=V[X+D++],S.head&&w&&S.length<65536&&(S.head.comment+=String.fromCharCode(w)),w&&D<ie;);if(512&S.flags&&(S.check=o(S.check,V,D,X)),ie-=D,X+=D,w)break e}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;j<16;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if(B!==(65535&S.check)){E.msg="header crc mismatch",S.mode=30;break}j=B=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),E.adler=S.check=0,S.mode=12;break;case 10:for(;j<32;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}E.adler=S.check=v(B),j=B=0,S.mode=11;case 11:if(S.havedict===0)return E.next_out=te,E.avail_out=fe,E.next_in=X,E.avail_in=ie,S.hold=B,S.bits=j,2;E.adler=S.check=1,S.mode=12;case 12:if(I===5||I===6)break e;case 13:if(S.last){B>>>=7&j,j-=7&j,S.mode=27;break}for(;j<3;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}switch(S.last=1&B,j-=1,3&(B>>>=1)){case 0:S.mode=14;break;case 1:if(U(S),S.mode=20,I!==6)break;B>>>=2,j-=2;break e;case 2:S.mode=17;break;case 3:E.msg="invalid block type",S.mode=30}B>>>=2,j-=2;break;case 14:for(B>>>=7&j,j-=7&j;j<32;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if((65535&B)!=(B>>>16^65535)){E.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&B,j=B=0,S.mode=15,I===6)break e;case 15:S.mode=16;case 16:if(D=S.length){if(ie<D&&(D=ie),fe<D&&(D=fe),D===0)break e;a.arraySet(J,V,X,D,te),ie-=D,X+=D,fe-=D,te+=D,S.length-=D;break}S.mode=12;break;case 17:for(;j<14;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if(S.nlen=257+(31&B),B>>>=5,j-=5,S.ndist=1+(31&B),B>>>=5,j-=5,S.ncode=4+(15&B),B>>>=4,j-=4,286<S.nlen||30<S.ndist){E.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;j<3;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}S.lens[z[S.have++]]=7&B,B>>>=3,j-=3}for(;S.have<19;)S.lens[z[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,Z={bits:S.lenbits},G=c(0,S.lens,0,19,S.lencode,0,S.work,Z),S.lenbits=Z.bits,G){E.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;W=(R=S.lencode[B&(1<<S.lenbits)-1])>>>16&255,$=65535&R,!((K=R>>>24)<=j);){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if($<16)B>>>=K,j-=K,S.lens[S.have++]=$;else{if($===16){for(F=K+2;j<F;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if(B>>>=K,j-=K,S.have===0){E.msg="invalid bit length repeat",S.mode=30;break}w=S.lens[S.have-1],D=3+(3&B),B>>>=2,j-=2}else if($===17){for(F=K+3;j<F;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}j-=K,w=0,D=3+(7&(B>>>=K)),B>>>=3,j-=3}else{for(F=K+7;j<F;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}j-=K,w=0,D=11+(127&(B>>>=K)),B>>>=7,j-=7}if(S.have+D>S.nlen+S.ndist){E.msg="invalid bit length repeat",S.mode=30;break}for(;D--;)S.lens[S.have++]=w}}if(S.mode===30)break;if(S.lens[256]===0){E.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,Z={bits:S.lenbits},G=c(h,S.lens,0,S.nlen,S.lencode,0,S.work,Z),S.lenbits=Z.bits,G){E.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,Z={bits:S.distbits},G=c(u,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,Z),S.distbits=Z.bits,G){E.msg="invalid distances set",S.mode=30;break}if(S.mode=20,I===6)break e;case 20:S.mode=21;case 21:if(6<=ie&&258<=fe){E.next_out=te,E.avail_out=fe,E.next_in=X,E.avail_in=ie,S.hold=B,S.bits=j,l(E,O),te=E.next_out,J=E.output,fe=E.avail_out,X=E.next_in,V=E.input,ie=E.avail_in,B=S.hold,j=S.bits,S.mode===12&&(S.back=-1);break}for(S.back=0;W=(R=S.lencode[B&(1<<S.lenbits)-1])>>>16&255,$=65535&R,!((K=R>>>24)<=j);){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if(W&&!(240&W)){for(k=K,Q=W,re=$;W=(R=S.lencode[re+((B&(1<<k+Q)-1)>>k)])>>>16&255,$=65535&R,!(k+(K=R>>>24)<=j);){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}B>>>=k,j-=k,S.back+=k}if(B>>>=K,j-=K,S.back+=K,S.length=$,W===0){S.mode=26;break}if(32&W){S.back=-1,S.mode=12;break}if(64&W){E.msg="invalid literal/length code",S.mode=30;break}S.extra=15&W,S.mode=22;case 22:if(S.extra){for(F=S.extra;j<F;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}S.length+=B&(1<<S.extra)-1,B>>>=S.extra,j-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;W=(R=S.distcode[B&(1<<S.distbits)-1])>>>16&255,$=65535&R,!((K=R>>>24)<=j);){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if(!(240&W)){for(k=K,Q=W,re=$;W=(R=S.distcode[re+((B&(1<<k+Q)-1)>>k)])>>>16&255,$=65535&R,!(k+(K=R>>>24)<=j);){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}B>>>=k,j-=k,S.back+=k}if(B>>>=K,j-=K,S.back+=K,64&W){E.msg="invalid distance code",S.mode=30;break}S.offset=$,S.extra=15&W,S.mode=24;case 24:if(S.extra){for(F=S.extra;j<F;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}S.offset+=B&(1<<S.extra)-1,B>>>=S.extra,j-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){E.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if(fe===0)break e;if(D=O-fe,S.offset>D){if((D=S.offset-D)>S.whave&&S.sane){E.msg="invalid distance too far back",S.mode=30;break}ee=D>S.wnext?(D-=S.wnext,S.wsize-D):S.wnext-D,D>S.length&&(D=S.length),ne=S.window}else ne=J,ee=te-S.offset,D=S.length;for(fe<D&&(D=fe),fe-=D,S.length-=D;J[te++]=ne[ee++],--D;);S.length===0&&(S.mode=21);break;case 26:if(fe===0)break e;J[te++]=S.length,fe--,S.mode=21;break;case 27:if(S.wrap){for(;j<32;){if(ie===0)break e;ie--,B|=V[X++]<<j,j+=8}if(O-=fe,E.total_out+=O,S.total+=O,O&&(E.adler=S.check=S.flags?o(S.check,J,O,te-O):n(S.check,J,O,te-O)),O=fe,(S.flags?B:v(B))!==S.check){E.msg="incorrect data check",S.mode=30;break}j=B=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;j<32;){if(ie===0)break e;ie--,B+=V[X++]<<j,j+=8}if(B!==(4294967295&S.total)){E.msg="incorrect length check",S.mode=30;break}j=B=0}S.mode=29;case 29:G=1;break e;case 30:G=-3;break e;case 31:return-4;case 32:default:return p}return E.next_out=te,E.avail_out=fe,E.next_in=X,E.avail_in=ie,S.hold=B,S.bits=j,(S.wsize||O!==E.avail_out&&S.mode<30&&(S.mode<27||I!==4))&&P(E,E.output,E.next_out,O-E.avail_out)?(S.mode=31,-4):(ae-=E.avail_in,O-=E.avail_out,E.total_in+=ae,E.total_out+=O,S.total+=O,S.wrap&&O&&(E.adler=S.check=S.flags?o(S.check,J,O,E.next_out-O):n(S.check,J,O,E.next_out-O)),E.data_type=S.bits+(S.last?64:0)+(S.mode===12?128:0)+(S.mode===20||S.mode===15?256:0),(ae==0&&O===0||I===4)&&G===d&&(G=-5),G)},s.inflateEnd=function(E){if(!E||!E.state)return p;var I=E.state;return I.window&&(I.window=null),E.state=null,d},s.inflateGetHeader=function(E,I){var S;return E&&E.state&&2&(S=E.state).wrap?((S.head=I).done=!1,d):p},s.inflateSetDictionary=function(E,I){var S,V=I.length;return E&&E.state?(S=E.state).wrap!==0&&S.mode!==11?p:S.mode===11&&n(1,I,V,0)!==S.check?-3:P(E,I,V,V)?(S.mode=31,-4):(S.havedict=1,d):p},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,r,s){var a=t("../utils/common"),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(h,u,d,p,f,g,m,v){var _,y,x,b,M,T,A,L,U,P=v.bits,E=0,I=0,S=0,V=0,J=0,X=0,te=0,ie=0,fe=0,B=0,j=null,ae=0,O=new a.Buf16(16),D=new a.Buf16(16),ee=null,ne=0;for(E=0;E<=15;E++)O[E]=0;for(I=0;I<p;I++)O[u[d+I]]++;for(J=P,V=15;1<=V&&O[V]===0;V--);if(V<J&&(J=V),V===0)return f[g++]=20971520,f[g++]=20971520,v.bits=1,0;for(S=1;S<V&&O[S]===0;S++);for(J<S&&(J=S),E=ie=1;E<=15;E++)if(ie<<=1,(ie-=O[E])<0)return-1;if(0<ie&&(h===0||V!==1))return-1;for(D[1]=0,E=1;E<15;E++)D[E+1]=D[E]+O[E];for(I=0;I<p;I++)u[d+I]!==0&&(m[D[u[d+I]]++]=I);if(T=h===0?(j=ee=m,19):h===1?(j=n,ae-=257,ee=o,ne-=257,256):(j=l,ee=c,-1),E=S,M=g,te=I=B=0,x=-1,b=(fe=1<<(X=J))-1,h===1&&852<fe||h===2&&592<fe)return 1;for(;;){for(A=E-te,U=m[I]<T?(L=0,m[I]):m[I]>T?(L=ee[ne+m[I]],j[ae+m[I]]):(L=96,0),_=1<<E-te,S=y=1<<X;f[M+(B>>te)+(y-=_)]=A<<24|L<<16|U|0,y!==0;);for(_=1<<E-1;B&_;)_>>=1;if(_!==0?(B&=_-1,B+=_):B=0,I++,--O[E]==0){if(E===V)break;E=u[d+m[I]]}if(J<E&&(B&b)!==x){for(te===0&&(te=J),M+=S,ie=1<<(X=E-te);X+te<V&&!((ie-=O[X+te])<=0);)X++,ie<<=1;if(fe+=1<<X,h===1&&852<fe||h===2&&592<fe)return 1;f[x=B&b]=J<<24|X<<16|M-g|0}}return B!==0&&(f[M+B]=E-te<<24|64<<16|0),v.bits=J,0}},{"../utils/common":41}],51:[function(t,r,s){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,r,s){var a=t("../utils/common"),n=0,o=1;function l(R){for(var N=R.length;0<=--N;)R[N]=0}var c=0,h=29,u=256,d=u+1+h,p=30,f=19,g=2*d+1,m=15,v=16,_=7,y=256,x=16,b=17,M=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],L=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],U=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=new Array(2*(d+2));l(P);var E=new Array(2*p);l(E);var I=new Array(512);l(I);var S=new Array(256);l(S);var V=new Array(h);l(V);var J,X,te,ie=new Array(p);function fe(R,N,z,Y,q){this.static_tree=R,this.extra_bits=N,this.extra_base=z,this.elems=Y,this.max_length=q,this.has_stree=R&&R.length}function B(R,N){this.dyn_tree=R,this.max_code=0,this.stat_desc=N}function j(R){return R<256?I[R]:I[256+(R>>>7)]}function ae(R,N){R.pending_buf[R.pending++]=255&N,R.pending_buf[R.pending++]=N>>>8&255}function O(R,N,z){R.bi_valid>v-z?(R.bi_buf|=N<<R.bi_valid&65535,ae(R,R.bi_buf),R.bi_buf=N>>v-R.bi_valid,R.bi_valid+=z-v):(R.bi_buf|=N<<R.bi_valid&65535,R.bi_valid+=z)}function D(R,N,z){O(R,z[2*N],z[2*N+1])}function ee(R,N){for(var z=0;z|=1&R,R>>>=1,z<<=1,0<--N;);return z>>>1}function ne(R,N,z){var Y,q,he=new Array(m+1),de=0;for(Y=1;Y<=m;Y++)he[Y]=de=de+z[Y-1]<<1;for(q=0;q<=N;q++){var ue=R[2*q+1];ue!==0&&(R[2*q]=ee(he[ue]++,ue))}}function K(R){var N;for(N=0;N<d;N++)R.dyn_ltree[2*N]=0;for(N=0;N<p;N++)R.dyn_dtree[2*N]=0;for(N=0;N<f;N++)R.bl_tree[2*N]=0;R.dyn_ltree[2*y]=1,R.opt_len=R.static_len=0,R.last_lit=R.matches=0}function W(R){8<R.bi_valid?ae(R,R.bi_buf):0<R.bi_valid&&(R.pending_buf[R.pending++]=R.bi_buf),R.bi_buf=0,R.bi_valid=0}function $(R,N,z,Y){var q=2*N,he=2*z;return R[q]<R[he]||R[q]===R[he]&&Y[N]<=Y[z]}function k(R,N,z){for(var Y=R.heap[z],q=z<<1;q<=R.heap_len&&(q<R.heap_len&&$(N,R.heap[q+1],R.heap[q],R.depth)&&q++,!$(N,Y,R.heap[q],R.depth));)R.heap[z]=R.heap[q],z=q,q<<=1;R.heap[z]=Y}function Q(R,N,z){var Y,q,he,de,ue=0;if(R.last_lit!==0)for(;Y=R.pending_buf[R.d_buf+2*ue]<<8|R.pending_buf[R.d_buf+2*ue+1],q=R.pending_buf[R.l_buf+ue],ue++,Y===0?D(R,q,N):(D(R,(he=S[q])+u+1,N),(de=T[he])!==0&&O(R,q-=V[he],de),D(R,he=j(--Y),z),(de=A[he])!==0&&O(R,Y-=ie[he],de)),ue<R.last_lit;);D(R,y,N)}function re(R,N){var z,Y,q,he=N.dyn_tree,de=N.stat_desc.static_tree,ue=N.stat_desc.has_stree,we=N.stat_desc.elems,Ne=-1;for(R.heap_len=0,R.heap_max=g,z=0;z<we;z++)he[2*z]!==0?(R.heap[++R.heap_len]=Ne=z,R.depth[z]=0):he[2*z+1]=0;for(;R.heap_len<2;)he[2*(q=R.heap[++R.heap_len]=Ne<2?++Ne:0)]=1,R.depth[q]=0,R.opt_len--,ue&&(R.static_len-=de[2*q+1]);for(N.max_code=Ne,z=R.heap_len>>1;1<=z;z--)k(R,he,z);for(q=we;z=R.heap[1],R.heap[1]=R.heap[R.heap_len--],k(R,he,1),Y=R.heap[1],R.heap[--R.heap_max]=z,R.heap[--R.heap_max]=Y,he[2*q]=he[2*z]+he[2*Y],R.depth[q]=(R.depth[z]>=R.depth[Y]?R.depth[z]:R.depth[Y])+1,he[2*z+1]=he[2*Y+1]=q,R.heap[1]=q++,k(R,he,1),2<=R.heap_len;);R.heap[--R.heap_max]=R.heap[1],function(xe,Ue){var je,Je,It,nt,ce,bs,Li=Ue.dyn_tree,Et=Ue.max_code,Ga=Ue.stat_desc.static_tree,yh=Ue.stat_desc.has_stree,xh=Ue.stat_desc.extra_bits,wl=Ue.stat_desc.extra_base,Ks=Ue.stat_desc.max_length,Qs=0;for(nt=0;nt<=m;nt++)xe.bl_count[nt]=0;for(Li[2*xe.heap[xe.heap_max]+1]=0,je=xe.heap_max+1;je<g;je++)Ks<(nt=Li[2*Li[2*(Je=xe.heap[je])+1]+1]+1)&&(nt=Ks,Qs++),Li[2*Je+1]=nt,Et<Je||(xe.bl_count[nt]++,ce=0,wl<=Je&&(ce=xh[Je-wl]),bs=Li[2*Je],xe.opt_len+=bs*(nt+ce),yh&&(xe.static_len+=bs*(Ga[2*Je+1]+ce)));if(Qs!==0){do{for(nt=Ks-1;xe.bl_count[nt]===0;)nt--;xe.bl_count[nt]--,xe.bl_count[nt+1]+=2,xe.bl_count[Ks]--,Qs-=2}while(0<Qs);for(nt=Ks;nt!==0;nt--)for(Je=xe.bl_count[nt];Je!==0;)Et<(It=xe.heap[--je])||(Li[2*It+1]!==nt&&(xe.opt_len+=(nt-Li[2*It+1])*Li[2*It],Li[2*It+1]=nt),Je--)}}(R,N),ne(he,Ne,R.bl_count)}function w(R,N,z){var Y,q,he=-1,de=N[1],ue=0,we=7,Ne=4;for(de===0&&(we=138,Ne=3),N[2*(z+1)+1]=65535,Y=0;Y<=z;Y++)q=de,de=N[2*(Y+1)+1],++ue<we&&q===de||(ue<Ne?R.bl_tree[2*q]+=ue:q!==0?(q!==he&&R.bl_tree[2*q]++,R.bl_tree[2*x]++):ue<=10?R.bl_tree[2*b]++:R.bl_tree[2*M]++,he=q,Ne=(ue=0)===de?(we=138,3):q===de?(we=6,3):(we=7,4))}function G(R,N,z){var Y,q,he=-1,de=N[1],ue=0,we=7,Ne=4;for(de===0&&(we=138,Ne=3),Y=0;Y<=z;Y++)if(q=de,de=N[2*(Y+1)+1],!(++ue<we&&q===de)){if(ue<Ne)for(;D(R,q,R.bl_tree),--ue!=0;);else q!==0?(q!==he&&(D(R,q,R.bl_tree),ue--),D(R,x,R.bl_tree),O(R,ue-3,2)):ue<=10?(D(R,b,R.bl_tree),O(R,ue-3,3)):(D(R,M,R.bl_tree),O(R,ue-11,7));he=q,Ne=(ue=0)===de?(we=138,3):q===de?(we=6,3):(we=7,4)}}l(ie);var Z=!1;function F(R,N,z,Y){O(R,(c<<1)+(Y?1:0),3),function(q,he,de,ue){W(q),ae(q,de),ae(q,~de),a.arraySet(q.pending_buf,q.window,he,de,q.pending),q.pending+=de}(R,N,z)}s._tr_init=function(R){Z||(function(){var N,z,Y,q,he,de=new Array(m+1);for(q=Y=0;q<h-1;q++)for(V[q]=Y,N=0;N<1<<T[q];N++)S[Y++]=q;for(S[Y-1]=q,q=he=0;q<16;q++)for(ie[q]=he,N=0;N<1<<A[q];N++)I[he++]=q;for(he>>=7;q<p;q++)for(ie[q]=he<<7,N=0;N<1<<A[q]-7;N++)I[256+he++]=q;for(z=0;z<=m;z++)de[z]=0;for(N=0;N<=143;)P[2*N+1]=8,N++,de[8]++;for(;N<=255;)P[2*N+1]=9,N++,de[9]++;for(;N<=279;)P[2*N+1]=7,N++,de[7]++;for(;N<=287;)P[2*N+1]=8,N++,de[8]++;for(ne(P,d+1,de),N=0;N<p;N++)E[2*N+1]=5,E[2*N]=ee(N,5);J=new fe(P,T,u+1,d,m),X=new fe(E,A,0,p,m),te=new fe(new Array(0),L,0,f,_)}(),Z=!0),R.l_desc=new B(R.dyn_ltree,J),R.d_desc=new B(R.dyn_dtree,X),R.bl_desc=new B(R.bl_tree,te),R.bi_buf=0,R.bi_valid=0,K(R)},s._tr_stored_block=F,s._tr_flush_block=function(R,N,z,Y){var q,he,de=0;0<R.level?(R.strm.data_type===2&&(R.strm.data_type=function(ue){var we,Ne=4093624447;for(we=0;we<=31;we++,Ne>>>=1)if(1&Ne&&ue.dyn_ltree[2*we]!==0)return n;if(ue.dyn_ltree[18]!==0||ue.dyn_ltree[20]!==0||ue.dyn_ltree[26]!==0)return o;for(we=32;we<u;we++)if(ue.dyn_ltree[2*we]!==0)return o;return n}(R)),re(R,R.l_desc),re(R,R.d_desc),de=function(ue){var we;for(w(ue,ue.dyn_ltree,ue.l_desc.max_code),w(ue,ue.dyn_dtree,ue.d_desc.max_code),re(ue,ue.bl_desc),we=f-1;3<=we&&ue.bl_tree[2*U[we]+1]===0;we--);return ue.opt_len+=3*(we+1)+5+5+4,we}(R),q=R.opt_len+3+7>>>3,(he=R.static_len+3+7>>>3)<=q&&(q=he)):q=he=z+5,z+4<=q&&N!==-1?F(R,N,z,Y):R.strategy===4||he===q?(O(R,2+(Y?1:0),3),Q(R,P,E)):(O(R,4+(Y?1:0),3),function(ue,we,Ne,xe){var Ue;for(O(ue,we-257,5),O(ue,Ne-1,5),O(ue,xe-4,4),Ue=0;Ue<xe;Ue++)O(ue,ue.bl_tree[2*U[Ue]+1],3);G(ue,ue.dyn_ltree,we-1),G(ue,ue.dyn_dtree,Ne-1)}(R,R.l_desc.max_code+1,R.d_desc.max_code+1,de+1),Q(R,R.dyn_ltree,R.dyn_dtree)),K(R),Y&&W(R)},s._tr_tally=function(R,N,z){return R.pending_buf[R.d_buf+2*R.last_lit]=N>>>8&255,R.pending_buf[R.d_buf+2*R.last_lit+1]=255&N,R.pending_buf[R.l_buf+R.last_lit]=255&z,R.last_lit++,N===0?R.dyn_ltree[2*z]++:(R.matches++,N--,R.dyn_ltree[2*(S[z]+u+1)]++,R.dyn_dtree[2*j(N)]++),R.last_lit===R.lit_bufsize-1},s._tr_align=function(R){O(R,2,3),D(R,y,P),function(N){N.bi_valid===16?(ae(N,N.bi_buf),N.bi_buf=0,N.bi_valid=0):8<=N.bi_valid&&(N.pending_buf[N.pending++]=255&N.bi_buf,N.bi_buf>>=8,N.bi_valid-=8)}(R)}},{"../utils/common":41}],53:[function(t,r,s){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,r,s){(function(a){(function(n,o){if(!n.setImmediate){var l,c,h,u,d=1,p={},f=!1,g=n.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(n);m=m&&m.setTimeout?m:n,l={}.toString.call(n.process)==="[object process]"?function(x){process.nextTick(function(){_(x)})}:function(){if(n.postMessage&&!n.importScripts){var x=!0,b=n.onmessage;return n.onmessage=function(){x=!1},n.postMessage("","*"),n.onmessage=b,x}}()?(u="setImmediate$"+Math.random()+"$",n.addEventListener?n.addEventListener("message",y,!1):n.attachEvent("onmessage",y),function(x){n.postMessage(u+x,"*")}):n.MessageChannel?((h=new MessageChannel).port1.onmessage=function(x){_(x.data)},function(x){h.port2.postMessage(x)}):g&&"onreadystatechange"in g.createElement("script")?(c=g.documentElement,function(x){var b=g.createElement("script");b.onreadystatechange=function(){_(x),b.onreadystatechange=null,c.removeChild(b),b=null},c.appendChild(b)}):function(x){setTimeout(_,0,x)},m.setImmediate=function(x){typeof x!="function"&&(x=new Function(""+x));for(var b=new Array(arguments.length-1),M=0;M<b.length;M++)b[M]=arguments[M+1];var T={callback:x,args:b};return p[d]=T,l(d),d++},m.clearImmediate=v}function v(x){delete p[x]}function _(x){if(f)setTimeout(_,0,x);else{var b=p[x];if(b){f=!0;try{(function(M){var T=M.callback,A=M.args;switch(A.length){case 0:T();break;case 1:T(A[0]);break;case 2:T(A[0],A[1]);break;case 3:T(A[0],A[1],A[2]);break;default:T.apply(o,A)}})(b)}finally{v(x),f=!1}}}}function y(x){x.source===n&&typeof x.data=="string"&&x.data.indexOf(u)===0&&_(+x.data.slice(u.length))}})(typeof self>"u"?a===void 0?this:a:self)}).call(this,typeof Sh<"u"?Sh:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Tw);var _L=Tw.exports;const yL=zw(_L);async function xL(){return new Promise((i,e)=>{const t=window.indexedDB.open("threeEditor_db",1);t.onerror=r=>e({event:r,status:!1,message:"数据库打开失败"}),t.onupgradeneeded=r=>{r.target.result.createObjectStore("GLB",{keyPath:"name"})},t.onsuccess=r=>{const s=r.target.result;function a(l,c){return new Promise((h,u)=>{const f=s.transaction(["GLB"],"readwrite").objectStore("GLB").get(l);f.onerror=g=>u({event:g,status:!1,message:"获取失败"}),f.onsuccess=g=>{g.target.result&&!c&&h({event:g,status:!0,message:"获取成功",url:URL.createObjectURL(g.target.result.blob)}),fetch(c).then(m=>m.blob()).then(m=>{const y=s.transaction(["GLB"],"readwrite").objectStore("GLB").put({name:l,blob:m});y.onsuccess=x=>h({event:x,status:!0,message:"文件缓存成功",url:URL.createObjectURL(m)}),y.onerror=x=>u({event:x,status:!1,message:"添加失败"})}).catch(m=>u({e:m,status:!1,message:"新增失败,访问路由异常"}))}})}function n(l){return new Promise((c,h)=>{const p=s.transaction(["GLB"],"readwrite").objectStore("GLB").delete(l);p.onsuccess=f=>c({event:f,status:!0,message:"删除成功"}),p.onerror=f=>h({event:f,status:!1,message:"删除失败"})})}i({getRequest:a,clearRequest:n,getAllRequest:()=>new Promise((l,c)=>{const d=s.transaction(["GLB"],"readonly").objectStore("GLB").getAll();d.onerror=p=>c({event:p,status:!1,message:"获取失败"}),d.onsuccess=p=>l({event:p,status:!0,message:"获取成功",data:p.target.result})}),DATABASE:s,status:!0,message:"数据库打开成功"})}})}const Ew=i=>(Bd("data-v-09a1c11e"),i=i(),Vd(),i),bL={class:"layout"},ML={class:"header"},wL={class:"header-box"},SL={class:"header-left"},TL={style:{width:"100%",display:"flex","justify-content":"space-between"}},EL={class:"dialog-footer"},AL={class:"title"},CL=Ew(()=>Pe("img",{class:"logo",src:Hd,alt:"logo",width:"25px",height:"25px"},null,-1)),PL={class:"header-right"},RL={class:"topl"},IL={style:{"pointer-events":"auto","background-color":"#181818",display:"flex","align-items":"center","border-radius":"3px"}},LL={class:"bot"},DL={class:"opt"},OL=Ew(()=>Pe("pre",null,`            1:选择 2:根选择 3:变换 4:绘制 5:信息
            变换 [r:旋转 g:平移 t:缩放] [ q w e a s d] 方位微调
            tab : 切换模式 z:撤销 y: 反撤销 del: 删除 esc: 退出操作
        `,-1)),NL={class:"main"},UL={__name:"index",setup(i){const e=Vw(()=>xL().then(async g=>{const{data:m}=await g.getAllRequest();return t.IndexDBList=m,t.IndexDB=g,hv(()=>import("./scene-CyHyMfiF.js"),__vite__mapDeps([0,1,2,3]))}).catch(()=>hv(()=>import("./scene-CyHyMfiF.js"),__vite__mapDeps([0,1,2,3]))));let t=Ug({info:null,mode:"选择",loading:!1,threeEditor:null,selectPanelEnable:!1,openKey:!1,IndexDB:null,IndexDBList:[],sceneName:localStorage.getItem("sceneName")||""});const r=ns(JSON.parse(localStorage.getItem("sceneList"))||[]),s=ns(!1),a=ns(""),n=ns(null);r.value.find(g=>g.name===t.sceneName)||(r.value.length>0?t.sceneName=r.value[0].name:t.sceneName="");const o=g=>{if(!t.threeEditor)return zr.error("请先创建场景");const[m,v]=g.name.split(".");if(n.value.clearFiles(),!["fbx","glb","FBX","GLB"].includes(v))return zr.error("请上传fbx或glb格式的模型");const _=URL.createObjectURL(g.raw);t.IndexDB.getRequest(g.name,_).then(y=>{const x={url:y.url,type:v.toLocaleUpperCase()==="GLB"?"GLTF":v.toLocaleUpperCase(),indexDBNameUrl:"IndexDB:"+g.name},{loaderService:b}=t.threeEditor.modelCore.insertModel(x);b.complete=M=>{const{transformControls:T,camera:A,controls:L}=t.threeEditor,{maxView:U,target:P}=O0(M);Promise.all([Tr(A.position,U),Tr(L.target,P)]).then(()=>{t.threeEditor.setOutlinePass([M]),L.target.copy(P),T.attach(M)})}})};function l(g){const m=r.value.findIndex(v=>v.name===g.name);m>-1&&(r.value.splice(m,1),localStorage.removeItem(g.name),u())}df(()=>t.sceneName,(g,m)=>{var v,_;g&&setTimeout(()=>t.createScene(),100),(_=(v=t==null?void 0:t.threeEditor)==null?void 0:v.destroySceneRender)==null||_.call(v)}),df(()=>t.mode,(g,m)=>{g=="选中"?t.threeEditor.handler.mode="选择":g=="根级"?t.threeEditor.handler.mode="根选择":g=="平移"?(t.threeEditor.handler.mode="变换",t.threeEditor.transformControls.setMode("translate")):g=="旋转"?(t.threeEditor.handler.mode="变换",t.threeEditor.transformControls.setMode("rotate")):g=="缩放"?(t.threeEditor.handler.mode="变换",t.threeEditor.transformControls.setMode("scale")):g=="绘制"?t.threeEditor.handler.mode="场景绘制":g=="预览"&&(t.threeEditor.handler.mode="点击信息")});function c(){const g=t.threeEditor.getSceneEditorImage(["image/png","0.8"]),m=document.createElement("a");m.href=g,m.download="myImage.png",m.click()}function h(){if(r.value.some(g=>g.name===a.value))return zr.error("场景名称已存在");r.value.push({name:a.value}),t.sceneName=a.value,zr.success(t.sceneName+"添加成功"),u(),s.value=!1}function u(){localStorage.setItem("sceneList",JSON.stringify(r.value)),localStorage.setItem("sceneName",t.sceneName)}function d(){r.value.find(g=>g.name===t.sceneName)?localStorage.setItem(t.sceneName,JSON.stringify(t.threeEditor.saveSceneEdit())):t.sceneName="",zr.success("保存成功"),u()}function p(){if(!t.threeEditor)return zr.error("没有可导出的场景");const g=new Blob([JSON.stringify(t.threeEditor.saveSceneEdit())],{type:"application/json"}),m=document.createElement("a");m.href=URL.createObjectURL(g),m.download=t.sceneName||Date.now()+".json",m.click()}async function f(){if(!t.threeEditor)return zr.error("没有可导出的场景");let g=JSON.stringify(t.threeEditor.saveSceneEdit());const m=/http[s]?:\/\/(?:[a-zA-Z]|[0-9]|[$-_@.&+]|[!*\\(\\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+/g,v=g.match(m),_=[...new Set(v)],y=await Promise.all(_.map(A=>fetch(A).then(L=>L.blob()))),x=new yL;_.forEach((A,L)=>{const U=L+"_"+A.substring(A.lastIndexOf("/")+1);g=g.replace(new RegExp(A,"g"),U),x.file(U,y[L])}),x.file(_.length+"_scene.json",g);const b=await x.generateAsync({type:"blob"}),M=URL.createObjectURL(b),T=document.createElement("a");T.href=M,T.download=t.sceneName||Date.now(),document.body.appendChild(T),T.click(),window.URL.revokeObjectURL(M),document.body.removeChild(T)}return(g,m)=>{const v=_t("Close"),_=_t("el-icon"),y=_t("el-popconfirm"),x=_t("el-option"),b=_t("el-select"),M=_t("el-button"),T=_t("el-upload"),A=_t("el-input"),L=_t("el-dialog"),U=_t("el-radio-button"),P=_t("el-radio-group"),E=_t("el-switch"),I=Bw("loading");return kg((Ge(),it("div",bL,[Pe("div",ML,[Pe("div",wL,[Pe("div",SL,[Oe(b,{modelValue:gt(t).sceneName,"onUpdate:modelValue":m[0]||(m[0]=S=>gt(t).sceneName=S),class:"m-2",placeholder:"场景",size:"large",style:{width:"200px"}},{default:ze(()=>[(Ge(!0),it(Vi,null,cr(r.value,S=>(Ge(),Bo(x,{key:S.name,label:S.name,value:S.name,style:{color:"rgb(255, 255, 255)"}},{default:ze(()=>[Pe("div",TL,[Pe("span",null,Xi(S.name),1),Pe("span",null,[Oe(y,{title:"确定删除？",onConfirm:()=>l(S)},{reference:ze(()=>[Oe(_,{style:{color:"aliceblue"}},{default:ze(()=>[Oe(v)]),_:1})]),_:2},1032,["onConfirm"])])])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),Oe(M,{class:"btn-add",link:"",icon:"plus",onClick:m[1]||(m[1]=S=>s.value=!0)},{default:ze(()=>[mt("新增")]),_:1}),Oe(T,{class:"upload",ref_key:"myUpload",ref:n,"auto-upload":!1,action:"","on-change":o},{default:ze(()=>[Oe(M,{class:"btn-add",link:"",icon:"plus"},{default:ze(()=>[mt("导入本地模型到当前场景")]),_:1})]),_:1},512),Oe(L,{modelValue:s.value,"onUpdate:modelValue":m[4]||(m[4]=S=>s.value=S),title:"命名场景",width:"500"},{footer:ze(()=>[Pe("div",EL,[Oe(M,{onClick:m[3]||(m[3]=S=>s.value=!1)},{default:ze(()=>[mt("取消")]),_:1}),Oe(M,{onClick:h},{default:ze(()=>[mt(" 确认 ")]),_:1})])]),default:ze(()=>[Oe(A,{modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=S=>a.value=S),placeholder:"请输入场景名称"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),Pe("div",AL,[CL,mt("    "+Xi(gt(t).sceneName||" - - - - "),1)]),Pe("div",PL,[Oe(M,{class:"btn-add",link:"",icon:"Document",onClick:p},{default:ze(()=>[mt("模板")]),_:1}),Oe(M,{class:"btn-add",link:""},{default:ze(()=>[mt("|")]),_:1}),Oe(M,{class:"btn-add",link:"",onClick:f,icon:"Files"},{default:ze(()=>[mt("导出")]),_:1}),Oe(M,{onClick:c,icon:"camera"}),Oe(M,{onClick:m[5]||(m[5]=()=>{var S;return(S=gt(t).threeEditor)==null?void 0:S.openControlPanel()})},{default:ze(()=>[mt("控制板")]),_:1}),Oe(M,{onClick:d},{default:ze(()=>[mt("保存")]),_:1})])])]),Oe(ZI,{emitEditor:gt(t)},null,8,["emitEditor"]),Oe(vL,{emitEditor:gt(t)},null,8,["emitEditor"]),Pe("div",RL,[Pe("div",IL,[Oe(P,{modelValue:gt(t).mode,"onUpdate:modelValue":m[6]||(m[6]=S=>gt(t).mode=S),size:"small",fill:"#181818","text-color":"#a8d4fd"},{default:ze(()=>[Oe(U,{label:"选中",value:"选中"}),Oe(U,{label:"根级",value:"根级"}),Oe(U,{label:"平移",value:"平移"}),Oe(U,{label:"旋转",value:"旋转"}),Oe(U,{label:"缩放",value:"缩放"}),Oe(U,{label:"绘制",value:"绘制"}),Oe(U,{label:"预览",value:"预览"})]),_:1},8,["modelValue"])])]),Pe("div",LL,[Pe("div",DL,[Pe("div",null,[Pe("div",null,[Oe(E,{"inactive-text":"选中弹窗",modelValue:gt(t).selectPanelEnable,"onUpdate:modelValue":m[7]||(m[7]=S=>gt(t).selectPanelEnable=S),"active-color":"#a8d4fd",onChange:m[8]||(m[8]=S=>gt(t).threeEditor.handler.selectPanelEnable=S)},null,8,["modelValue"])]),Pe("div",null,[Oe(E,{"inactive-text":"按键操作",modelValue:gt(t).openKey,"onUpdate:modelValue":m[9]||(m[9]=S=>gt(t).openKey=S),"active-color":"#a8d4fd",onChange:m[10]||(m[10]=S=>gt(t).threeEditor.handler.setHandlerOption("openKey",S))},null,8,["modelValue"])])]),OL])]),Pe("div",NL,[Oe(gt(e),{emitEditor:gt(t),options:r.value},null,8,["emitEditor","options"])])])),[[I,gt(t).loading]])}}},kL=Xs(UL,[["__scopeId","data-v-09a1c11e"]]),HL=Object.freeze(Object.defineProperty({__proto__:null,default:kL},Symbol.toStringTag,{value:"Module"}));export{zL as _,HL as i,Tr as n,Ng as o};
